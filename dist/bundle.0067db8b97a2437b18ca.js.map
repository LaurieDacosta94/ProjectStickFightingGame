{"version":3,"file":"bundle.0067db8b97a2437b18ca.js","mappings":"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ASC,GAAUC,EAAQC,GACzB,OAAQA,EAAMC,MACZ,IAAK,YACL,IAAK,OACHlC,GAAME,KAAO8B,EACbC,EAAME,iBACN,MACF,IAAK,aACL,IAAK,OACHnC,GAAMG,MAAQ6B,EACdC,EAAME,iBACN,MACF,IAAK,UACL,IAAK,OACL,IAAK,QACHnC,GAAMI,KAAO4B,EACbC,EAAME,iBACN,MACF,IAAK,YACL,IAAK,OACHnC,GAAMK,KAAO2B,EACbC,EAAME,iBACN,MACF,IAAK,QACCH,IACFhC,GAAM0B,oBAAsB,EAC5BO,EAAME,kBAER,MACF,IAAK,SACCH,IACFhC,GAAM0B,mBAAqB,EAC3BO,EAAME,kBAER,MACF,IAAK,SACCH,IACFhC,GAAM4B,qBAAsB,EAC5BK,EAAME,kBAEV,IAAK,YACL,IAAK,aACCH,IACFhC,GAAMM,MAAO,EACb2B,EAAME,kBAER,MACF,IAAK,OACCH,IACFhC,GAAMyB,qBAAsB,EAC5BQ,EAAME,kBAER,MACF,IAAK,OACCH,IACFhC,GAAM6B,wBAAyB,EAC/BI,EAAME,kBAER,MACF,IAAK,OACL,IAAK,OACCH,GACFhC,GAAMO,gBAAiB,EACvBP,GAAMW,YAAa,EACnBsB,EAAME,mBAENnC,GAAMW,YAAa,EACnBsB,EAAME,kBAER,MACF,IAAK,OACCH,GACFhC,GAAMQ,eAAgB,EACtBR,GAAMY,WAAY,EAClBqB,EAAME,mBAENnC,GAAMY,WAAY,EAClBqB,EAAME,kBAER,MACF,IAAK,OACCH,IACFhC,GAAMS,gBAAiB,EACvBwB,EAAME,kBAER,MACF,IAAK,OACCH,IACFhC,GAAMU,kBAAmB,EACzBuB,EAAME,kBAER,MACF,IAAK,OACCH,IACFhC,GAAMa,2BAA4B,EAClCoB,EAAME,kBAER,MACF,IAAK,OACCH,IACFhC,GAAMc,mBAAqB,OAC3BmB,EAAME,kBAER,MACF,IAAK,OACCH,IACFhC,GAAMc,mBAAqB,SAC3BmB,EAAME,kBAER,MACF,IAAK,OACCH,IACFhC,GAAMc,mBAAqB,SAC3BmB,EAAME,kBAER,MACF,IAAK,OACCH,IACFhC,GAAM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","sources":["webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/styleTagTransform.js","webpack://project-stickfigure/./node_modules/css-loader/dist/runtime/api.js","webpack://project-stickfigure/./node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://project-stickfigure/./src/styles.css","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/insertStyleElement.js","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/insertBySelector.js","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/styleDomAPI.js","webpack://project-stickfigure/webpack/bootstrap","webpack://project-stickfigure/webpack/runtime/compat get default export","webpack://project-stickfigure/webpack/runtime/define property getters","webpack://project-stickfigure/webpack/runtime/hasOwnProperty shorthand","webpack://project-stickfigure/webpack/runtime/nonce","webpack://project-stickfigure/./src/styles.css?44b2","webpack://project-stickfigure/./src/environment/canvas.js","webpack://project-stickfigure/./src/config/environments.js","webpack://project-stickfigure/./src/state/resources.js","webpack://project-stickfigure/./src/state/environment.js","webpack://project-stickfigure/./src/state/camera.js","webpack://project-stickfigure/./src/core/input/index.js","webpack://project-stickfigure/./src/config/weapons.js","webpack://project-stickfigure/./src/config/constants.js","webpack://project-stickfigure/./src/config/squad.js","webpack://project-stickfigure/./src/state/entities.js","webpack://project-stickfigure/./src/state/weapons.js","webpack://project-stickfigure/./src/state/ammo.js","webpack://project-stickfigure/./src/core/combat/weapons.js","webpack://project-stickfigure/./src/core/audio/placeholder.js","webpack://project-stickfigure/./src/core/network/p2p.js","webpack://project-stickfigure/./src/config/network.js","webpack://project-stickfigure/./src/state/serverBrowser.js","webpack://project-stickfigure/./src/state/vehicles.js","webpack://project-stickfigure/./src/core/utils/math.js","webpack://project-stickfigure/./src/core/utils/time.js","webpack://project-stickfigure/./src/config/survival.js","webpack://project-stickfigure/./src/state/survival.js","webpack://project-stickfigure/./src/core/effects/ragdoll.js","webpack://project-stickfigure/./src/core/effects/damage.js","webpack://project-stickfigure/./src/core/gadgets/turret.js","webpack://project-stickfigure/./src/core/gadgets/grapple.js","webpack://project-stickfigure/./src/core/gadgets/shield.js","webpack://project-stickfigure/./src/core/gadgets/index.js","webpack://project-stickfigure/./src/core/combat/damageHandlers.js","webpack://project-stickfigure/./src/config/destructibles.js","webpack://project-stickfigure/./src/state/destructibles.js","webpack://project-stickfigure/./src/core/effects/particles.js","webpack://project-stickfigure/./src/core/combat/explosions.js","webpack://project-stickfigure/./src/core/world/destructibles.js","webpack://project-stickfigure/./src/config/buildings.js","webpack://project-stickfigure/./src/state/buildings.js","webpack://project-stickfigure/./src/core/effects/lighting.js","webpack://project-stickfigure/./src/core/combat/projectiles.js","webpack://project-stickfigure/./src/core/combat/throwables.js","webpack://project-stickfigure/./src/config/supplyDrops.js","webpack://project-stickfigure/./src/core/world/supplyDrops.js","webpack://project-stickfigure/./src/core/render/supplyDrops.js","webpack://project-stickfigure/./src/core/render/destructibles.js","webpack://project-stickfigure/./src/core/building/index.js","webpack://project-stickfigure/./src/core/survival/index.js","webpack://project-stickfigure/./src/core/world/enemySpawner.js","webpack://project-stickfigure/./src/config/spawn.js","webpack://project-stickfigure/./src/config/interactables.js","webpack://project-stickfigure/./src/state/interactables.js","webpack://project-stickfigure/./src/core/render/interactables.js","webpack://project-stickfigure/./src/core/events/polishDebug.js","webpack://project-stickfigure/./src/state/recoil.js","webpack://project-stickfigure/./src/core/world/arena.js","webpack://project-stickfigure/./src/core/squad/index.js","webpack://project-stickfigure/./src/core/vehicles/index.js","webpack://project-stickfigure/./src/core/render/index.js","webpack://project-stickfigure/./src/core/combat/playerActions.js","webpack://project-stickfigure/./src/core/world/interactables.js","webpack://project-stickfigure/./src/core/combat/melee.js","webpack://project-stickfigure/./src/core/world/enemyAI.js","webpack://project-stickfigure/./src/core/network/serverBrowser.js","webpack://project-stickfigure/./src/core/world/update.js","webpack://project-stickfigure/./src/core/resources/index.js","webpack://project-stickfigure/./src/core/world/trainingDummy.js","webpack://project-stickfigure/./src/main.js"],"sourcesContent":["\"use strict\";\n\n/* istanbul ignore next  */\nfunction setAttributesWithoutAttributes(styleElement) {\n  var nonce = typeof __webpack_nonce__ !== \"undefined\" ? __webpack_nonce__ : null;\n  if (nonce) {\n    styleElement.setAttribute(\"nonce\", nonce);\n  }\n}\nmodule.exports = setAttributesWithoutAttributes;","\"use strict\";\n\nvar stylesInDOM = [];\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n  for (var i = 0; i < stylesInDOM.length; i++) {\n    if (stylesInDOM[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n}\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var indexByIdentifier = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3],\n      supports: item[4],\n      layer: item[5]\n    };\n    if (indexByIdentifier !== -1) {\n      stylesInDOM[indexByIdentifier].references++;\n      stylesInDOM[indexByIdentifier].updater(obj);\n    } else {\n      var updater = addElementStyle(obj, options);\n      options.byIndex = i;\n      stylesInDOM.splice(i, 0, {\n        identifier: identifier,\n        updater: updater,\n        references: 1\n      });\n    }\n    identifiers.push(identifier);\n  }\n  return identifiers;\n}\nfunction addElementStyle(obj, options) {\n  var api = options.domAPI(options);\n  api.update(obj);\n  var updater = function updater(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap && newObj.supports === obj.supports && newObj.layer === obj.layer) {\n        return;\n      }\n      api.update(obj = newObj);\n    } else {\n      api.remove();\n    }\n  };\n  return updater;\n}\nmodule.exports = function (list, options) {\n  options = options || {};\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDOM[index].references--;\n    }\n    var newLastIdentifiers = modulesToDom(newList, options);\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n      var _index = getIndexByIdentifier(_identifier);\n      if (stylesInDOM[_index].references === 0) {\n        stylesInDOM[_index].updater();\n        stylesInDOM.splice(_index, 1);\n      }\n    }\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","\"use strict\";\n\n/* istanbul ignore next  */\nfunction styleTagTransform(css, styleElement) {\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css;\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild);\n    }\n    styleElement.appendChild(document.createTextNode(css));\n  }\n}\nmodule.exports = styleTagTransform;","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `* {\r\n  box-sizing: border-box;\r\n}\r\n\r\nbody {\r\n  margin: 0;\r\n  background-color: #0f1115;\r\n  color: #f0f3f7;\r\n  font-family: \"Segoe UI\", Arial, sans-serif;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  min-height: 100vh;\r\n}\r\n\r\ncanvas {\r\n  border: 2px solid #2a2d34;\r\n  background: linear-gradient(180deg, #1d2129 0%, #14161c 100%);\r\n  width: min(90vw, 960px);\r\n  max-width: 100%;\r\n  height: auto;\r\n}\r\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/styles.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,sBAAsB;AACxB;;AAEA;EACE,SAAS;EACT,yBAAyB;EACzB,cAAc;EACd,0CAA0C;EAC1C,aAAa;EACb,mBAAmB;EACnB,uBAAuB;EACvB,iBAAiB;AACnB;;AAEA;EACE,yBAAyB;EACzB,6DAA6D;EAC7D,uBAAuB;EACvB,eAAe;EACf,YAAY;AACd\",\"sourcesContent\":[\"* {\\r\\n  box-sizing: border-box;\\r\\n}\\r\\n\\r\\nbody {\\r\\n  margin: 0;\\r\\n  background-color: #0f1115;\\r\\n  color: #f0f3f7;\\r\\n  font-family: \\\"Segoe UI\\\", Arial, sans-serif;\\r\\n  display: flex;\\r\\n  align-items: center;\\r\\n  justify-content: center;\\r\\n  min-height: 100vh;\\r\\n}\\r\\n\\r\\ncanvas {\\r\\n  border: 2px solid #2a2d34;\\r\\n  background: linear-gradient(180deg, #1d2129 0%, #14161c 100%);\\r\\n  width: min(90vw, 960px);\\r\\n  max-width: 100%;\\r\\n  height: auto;\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/* istanbul ignore next  */\nfunction insertStyleElement(options) {\n  var element = document.createElement(\"style\");\n  options.setAttributes(element, options.attributes);\n  options.insert(element, options.options);\n  return element;\n}\nmodule.exports = insertStyleElement;","\"use strict\";\n\nvar memo = {};\n\n/* istanbul ignore next  */\nfunction getTarget(target) {\n  if (typeof memo[target] === \"undefined\") {\n    var styleTarget = document.querySelector(target);\n\n    // Special case to return head of iframe instead of iframe itself\n    if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n      try {\n        // This will throw an exception if access to iframe is blocked\n        // due to cross-origin restrictions\n        styleTarget = styleTarget.contentDocument.head;\n      } catch (e) {\n        // istanbul ignore next\n        styleTarget = null;\n      }\n    }\n    memo[target] = styleTarget;\n  }\n  return memo[target];\n}\n\n/* istanbul ignore next  */\nfunction insertBySelector(insert, style) {\n  var target = getTarget(insert);\n  if (!target) {\n    throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n  }\n  target.appendChild(style);\n}\nmodule.exports = insertBySelector;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction apply(styleElement, options, obj) {\n  var css = \"\";\n  if (obj.supports) {\n    css += \"@supports (\".concat(obj.supports, \") {\");\n  }\n  if (obj.media) {\n    css += \"@media \".concat(obj.media, \" {\");\n  }\n  var needLayer = typeof obj.layer !== \"undefined\";\n  if (needLayer) {\n    css += \"@layer\".concat(obj.layer.length > 0 ? \" \".concat(obj.layer) : \"\", \" {\");\n  }\n  css += obj.css;\n  if (needLayer) {\n    css += \"}\";\n  }\n  if (obj.media) {\n    css += \"}\";\n  }\n  if (obj.supports) {\n    css += \"}\";\n  }\n  var sourceMap = obj.sourceMap;\n  if (sourceMap && typeof btoa !== \"undefined\") {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  }\n\n  // For old IE\n  /* istanbul ignore if  */\n  options.styleTagTransform(css, styleElement, options.options);\n}\nfunction removeStyleElement(styleElement) {\n  // istanbul ignore if\n  if (styleElement.parentNode === null) {\n    return false;\n  }\n  styleElement.parentNode.removeChild(styleElement);\n}\n\n/* istanbul ignore next  */\nfunction domAPI(options) {\n  if (typeof document === \"undefined\") {\n    return {\n      update: function update() {},\n      remove: function remove() {}\n    };\n  }\n  var styleElement = options.insertStyleElement(options);\n  return {\n    update: function update(obj) {\n      apply(styleElement, options, obj);\n    },\n    remove: function remove() {\n      removeStyleElement(styleElement);\n    }\n  };\n}\nmodule.exports = domAPI;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","__webpack_require__.nc = undefined;","\n      import API from \"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../node_modules/css-loader/dist/cjs.js!./styles.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../node_modules/css-loader/dist/cjs.js!./styles.css\";\n       export default content && content.locals ? content.locals : undefined;\n","const canvas = document.getElementById(\"game-canvas\");\nconst context = canvas.getContext(\"2d\");\n\nif (!context) {\n  throw new Error(\"Canvas 2D context not available.\");\n}\n\nconst GROUND_Y = canvas.height - 60;\n\nexport { canvas, context, GROUND_Y };\r\n","import { canvas, GROUND_Y } from \"../environment/canvas.js\";\r\n\r\nconst LEVEL_SCALE = 4;\r\nconst baseLevelWidth = canvas.width;\r\nconst levelWidth = baseLevelWidth * LEVEL_SCALE;\r\nconst baseGround = GROUND_Y;\r\n\r\nfunction scaleX(value) {\r\n  return typeof value === \"number\" ? value * LEVEL_SCALE : value;\r\n}\r\n\r\nfunction scalePlatforms(list) {\r\n  return list.map((platform) => ({\r\n    ...platform,\r\n    x: scaleX(platform.x),\r\n    width: scaleX(platform.width)\r\n  }));\r\n}\r\n\r\nfunction scaleWaterZones(list) {\r\n  return list.map((zone) => ({\r\n    ...zone,\r\n    x: scaleX(zone.x),\r\n    width: scaleX(zone.width)\r\n  }));\r\n}\r\n\r\nfunction scaleDecor(list) {\r\n  return list.map((decor) => {\r\n    const scaled = { ...decor };\r\n    if (typeof scaled.x === \"number\") {\r\n      scaled.x = scaleX(scaled.x);\r\n    }\r\n    if (typeof scaled.baseX === \"number\") {\r\n      scaled.baseX = scaleX(scaled.baseX);\r\n    }\r\n    if (typeof scaled.width === \"number\") {\r\n      scaled.width = scaleX(scaled.width);\r\n    }\r\n    if (Array.isArray(scaled.points)) {\r\n      scaled.points = scaled.points.map((point) => ({\r\n        ...point,\r\n        x: scaleX(point.x)\r\n      }));\r\n    }\r\n    return scaled;\r\n  });\r\n}\r\n\r\nfunction scaleDestructibles(list) {\r\n  return list.map((item) => ({\r\n    ...item,\r\n    x: scaleX(item.x)\r\n  }));\r\n}\r\n\r\nfunction scaleInteractables(list) {\r\n  return list.map((item) => ({\r\n    ...item,\r\n    x: scaleX(item.x),\r\n    minX: scaleX(item.minX),\r\n    maxX: scaleX(item.maxX)\r\n  }));\r\n}\r\n\r\nfunction scaleAmbientLights(list) {\r\n  return list.map((light) => ({\r\n    ...light,\r\n    x: scaleX(light.x),\r\n    radius: typeof light.radius === \"number\" ? light.radius * LEVEL_SCALE : light.radius\r\n  }));\r\n}\r\n\r\nfunction addCentralWater(zones, overrides = {}) {\r\n  const widthRatio = overrides.widthRatio ?? 0.05;\r\n  const width = levelWidth * widthRatio;\r\n  const x = levelWidth * 0.5 - width / 2;\r\n  const topOffset = overrides.topOffset ?? 18;\r\n  const depth = overrides.depth ?? 26;\r\n  const centralZone = {\r\n    x,\r\n    width,\r\n    top: baseGround - topOffset,\r\n    depth,\r\n    highlight: overrides.highlight,\r\n    highlightColor: overrides.highlightColor,\r\n    topColor: overrides.topColor,\r\n    midColor: overrides.midColor,\r\n    bottomColor: overrides.bottomColor,\r\n    rippleColor: overrides.rippleColor\r\n  };\r\n  return [...zones, centralZone];\r\n}\r\n\r\nconst neoPlatforms = scalePlatforms([\r\n  { x: -240, y: baseGround - 26, width: 520, height: 26, type: \"street\" },\r\n  { x: 320, y: baseGround - 26, width: 420, height: 26, type: \"street\" },\r\n  { x: 820, y: baseGround - 26, width: 380, height: 26, type: \"street\" },\r\n  { x: 1220, y: baseGround - 26, width: 520, height: 26, type: \"street\" },\r\n  { x: 40, y: baseGround - 120, width: 260, height: 18, type: \"metro\" },\r\n  { x: 360, y: baseGround - 180, width: 280, height: 16, type: \"rooftop\" },\r\n  { x: 680, y: baseGround - 240, width: 220, height: 16, type: \"skybridge\" },\r\n  { x: 960, y: baseGround - 180, width: 320, height: 18, type: \"rooftop\" },\r\n  { x: 1240, y: baseGround - 140, width: 280, height: 16, type: \"terrace\" },\r\n  { x: 1460, y: baseGround - 220, width: 200, height: 14, type: \"balcony\" },\r\n  { x: 600, y: baseGround - 88, width: 260, height: 14, type: \"median\" },\r\n  { x: 980, y: baseGround - 96, width: 320, height: 14, type: \"median\" }\r\n]);\r\n\r\nconst neoWaterZones = addCentralWater(\r\n  scaleWaterZones([\r\n    { x: 580, width: 220, top: baseGround - 16, depth: 18 }\r\n  ]),\r\n  {\r\n    topOffset: 20,\r\n    depth: 28,\r\n    topColor: \"rgba(60, 112, 168, 0.88)\",\r\n    midColor: \"rgba(36, 76, 128, 0.92)\",\r\n    bottomColor: \"rgba(20, 48, 92, 0.95)\",\r\n    rippleColor: \"rgba(190, 220, 255, 0.2)\",\r\n    highlightColor: \"rgba(255, 236, 180, 0.25)\"\r\n  }\r\n);\r\n\r\nconst neoDecor = scaleDecor([\r\n  { type: \"building\", x: -120, y: baseGround - 360, width: 220, height: 360 },\r\n  { type: \"building\", x: 220, y: baseGround - 420, width: 180, height: 420 },\r\n  { type: \"building\", x: 520, y: baseGround - 360, width: 260, height: 360 },\r\n  { type: \"building\", x: 860, y: baseGround - 440, width: 220, height: 440 },\r\n  { type: \"building\", x: 1120, y: baseGround - 400, width: 260, height: 400 },\r\n  { type: \"building\", x: 1400, y: baseGround - 360, width: 200, height: 360 },\r\n  { type: \"billboard\", x: 320, y: baseGround - 210, width: 180, height: 90, text: \"Neo District\" },\r\n  { type: \"billboard\", x: 1040, y: baseGround - 230, width: 200, height: 96, text: \"Rail 7\" },\r\n  { type: \"streetlight\", x: 180, y: baseGround - 160 },\r\n  { type: \"streetlight\", x: 760, y: baseGround - 160 },\r\n  { type: \"streetlight\", x: 1280, y: baseGround - 160 },\r\n  { type: \"hovercar\", x: 560, y: baseGround - 120 },\r\n  { type: \"hovercar\", x: 1180, y: baseGround - 150 }\r\n]);\r\n\r\nconst neoDestructibles = scaleDestructibles([\r\n  { id: \"neo-barrier-west\", type: \"concreteBarrier\", x: 260, baseY: baseGround },\r\n  { id: \"neo-barrier-east\", type: \"concreteBarrier\", x: 1140, baseY: baseGround },\r\n  { id: \"neo-car-market\", type: \"streetCar\", x: 620, baseY: baseGround, facing: -1 },\r\n  { id: \"neo-car-docks\", type: \"streetCar\", x: 1340, baseY: baseGround, facing: 1 },\r\n  { id: \"neo-barrels-market\", type: \"fuelBarrelCluster\", x: 440, baseY: baseGround - 26 },\r\n  { id: \"neo-barrels-rail\", type: \"fuelBarrelCluster\", x: 920, baseY: baseGround - 26 }\r\n]);\r\n\r\nconst neoInteractables = scaleInteractables([\r\n  { id: \"neo-crate-market\", type: \"pushCrate\", x: 480, baseY: baseGround - 26, minX: 200, maxX: 860 },\r\n  { id: \"neo-crate-rooftop\", type: \"pushCrate\", x: 520, baseY: baseGround - 180, minX: 380, maxX: 620 },\r\n  { id: \"neo-barrel-metro\", type: \"kickBarrel\", x: 180, baseY: baseGround - 120, minX: 60, maxX: 280 },\r\n  { id: \"neo-barrel-skybridge\", type: \"kickBarrel\", x: 780, baseY: baseGround - 240, minX: 700, maxX: 880 },\r\n  { id: \"neo-trap-median\", type: \"shockTrap\", x: 680, baseY: baseGround - 88 },\r\n  { id: \"neo-trap-gate\", type: \"shockTrap\", x: 1260, baseY: baseGround - 26 }\r\n]);\r\n\r\nconst neoAmbientLights = scaleAmbientLights([\r\n  { id: \"neo-street-0\", type: \"point\", x: 180, y: baseGround - 160, radius: 220, intensity: 0.55, color: \"#8faaff\", smoothing: 6, flicker: 0.12 },\r\n  { id: \"neo-street-1\", type: \"point\", x: 760, y: baseGround - 160, radius: 220, intensity: 0.55, color: \"#8faaff\", smoothing: 6, flicker: 0.12 },\r\n  { id: \"neo-street-2\", type: \"point\", x: 1280, y: baseGround - 160, radius: 220, intensity: 0.55, color: \"#8faaff\", smoothing: 6, flicker: 0.12 }\r\n]);\r\n\r\nconst verdantPlatforms = scalePlatforms([\r\n  { x: -280, y: baseGround - 24, width: 520, height: 24, type: \"jungleFloor\" },\r\n  { x: 320, y: baseGround - 24, width: 420, height: 24, type: \"jungleFloor\" },\r\n  { x: 820, y: baseGround - 30, width: 380, height: 24, type: \"jungleFloor\" },\r\n  { x: 1220, y: baseGround - 36, width: 420, height: 26, type: \"jungleFloor\" },\r\n  { x: 120, y: baseGround - 150, width: 260, height: 18, type: \"stone\" },\r\n  { x: 460, y: baseGround - 210, width: 280, height: 16, type: \"canopy\" },\r\n  { x: 780, y: baseGround - 190, width: 240, height: 16, type: \"branch\" },\r\n  { x: 1120, y: baseGround - 250, width: 220, height: 14, type: \"branch\" }\r\n]);\r\n\r\nconst verdantWater = addCentralWater(\r\n  scaleWaterZones([\r\n    { x: 240, width: 280, top: baseGround - 16, depth: 14 },\r\n    { x: 940, width: 210, top: baseGround - 12, depth: 12 }\r\n  ]),\r\n  {\r\n    topOffset: 18,\r\n    depth: 24,\r\n    topColor: \"rgba(56, 128, 92, 0.85)\",\r\n    midColor: \"rgba(40, 96, 72, 0.88)\",\r\n    bottomColor: \"rgba(24, 64, 52, 0.93)\",\r\n    rippleColor: \"rgba(200, 255, 214, 0.22)\",\r\n    highlightColor: \"rgba(144, 255, 200, 0.22)\"\r\n  }\r\n);\r\n\r\nconst verdantDecor = scaleDecor([\r\n  { type: \"palm\", baseX: -60, baseY: baseGround, height: 220 },\r\n  { type: \"palm\", baseX: 220, baseY: baseGround - 8, height: 210 },\r\n  { type: \"palm\", baseX: 520, baseY: baseGround - 12, height: 240 },\r\n  { type: \"palm\", baseX: 960, baseY: baseGround - 10, height: 220 },\r\n  { type: \"ruin\", x: 440, y: baseGround - 220, width: 160, height: 190 },\r\n  { type: \"ruin\", x: 1080, y: baseGround - 240, width: 180, height: 210 },\r\n  { type: \"vineArch\", x: 760, y: baseGround - 170, width: 200, height: 140 },\r\n  { type: \"glowPlant\", x: 320, y: baseGround - 60 },\r\n  { type: \"glowPlant\", x: 980, y: baseGround - 58 },\r\n  { type: \"waterfall\", x: 1180, y: baseGround - 60, width: 90, height: 220 }\r\n]);\r\n\r\nconst verdantDestructibles = scaleDestructibles([\r\n  { id: \"wilds-timber-west\", type: \"timberWall\", x: 260, baseY: baseGround },\r\n  { id: \"wilds-timber-east\", type: \"timberWall\", x: 1220, baseY: baseGround },\r\n  {\r\n    id: \"wilds-spore-cell\",\r\n    type: \"plasmaCell\",\r\n    x: 520,\r\n    baseY: baseGround - 120,\r\n    templateOverrides: {\r\n      bodyColor: \"#2e9a63\",\r\n      accentColor: \"#8cffc1\",\r\n      stripeColor: \"#6bffad\",\r\n      damageHighlight: \"#b6ffd6\",\r\n      debrisColor: \"#1c5e3a\"\r\n    }\r\n  },\r\n  {\r\n    id: \"wilds-cache\",\r\n    type: \"sandbagLine\",\r\n    x: 880,\r\n    baseY: baseGround - 24,\r\n    templateOverrides: {\r\n      bodyColor: \"#4b6036\",\r\n      accentColor: \"#92b56a\",\r\n      damageHighlight: \"#c8e8a4\",\r\n      debrisColor: \"#2e4125\"\r\n    }\r\n  }\r\n]);\r\n\r\nconst verdantInteractables = scaleInteractables([\r\n  {\r\n    id: \"wilds-crate-lower\",\r\n    type: \"pushCrate\",\r\n    x: 360,\r\n    baseY: baseGround - 24,\r\n    minX: 160,\r\n    maxX: 560,\r\n    templateOverrides: {\r\n      bodyColor: \"#5f7a45\",\r\n      edgeColor: \"#2f4022\",\r\n      braceColor: \"#9fbd67\",\r\n      highlightColor: \"#d9ff8a\"\r\n    }\r\n  },\r\n  {\r\n    id: \"wilds-crate-canopy\",\r\n    type: \"pushCrate\",\r\n    x: 540,\r\n    baseY: baseGround - 210,\r\n    minX: 420,\r\n    maxX: 640,\r\n    templateOverrides: {\r\n      bodyColor: \"#4e6d3a\",\r\n      edgeColor: \"#283b1c\",\r\n      braceColor: \"#8fb76a\",\r\n      highlightColor: \"#c8ff99\"\r\n    }\r\n  },\r\n  {\r\n    id: \"wilds-barrel\",\r\n    type: \"kickBarrel\",\r\n    x: 200,\r\n    baseY: baseGround - 24,\r\n    minX: 80,\r\n    maxX: 360,\r\n    templateOverrides: {\r\n      bodyColor: \"#2f8f5d\",\r\n      stripeColor: \"#7dff9e\",\r\n      edgeColor: \"#174027\",\r\n      topColor: \"#44b574\"\r\n    }\r\n  },\r\n  {\r\n    id: \"wilds-trap\",\r\n    type: \"shockTrap\",\r\n    x: 700,\r\n    baseY: baseGround - 24,\r\n    templateOverrides: {\r\n      bodyColor: \"#1d3b2c\",\r\n      accentColor: \"#59ffbd\",\r\n      glowColor: \"#86ffd7\"\r\n    }\r\n  }\r\n]);\r\n\r\nconst verdantAmbientLights = scaleAmbientLights([\r\n  { id: \"wilds-glow-0\", type: \"point\", x: 320, y: baseGround - 80, radius: 220, intensity: 0.85, color: \"#78ffbf\", smoothing: 6, flicker: 0.35 },\r\n  { id: \"wilds-glow-1\", type: \"point\", x: 980, y: baseGround - 76, radius: 210, intensity: 0.82, color: \"#78ffbf\", smoothing: 6, flicker: 0.32 },\r\n  { id: \"wilds-falls\", type: \"point\", x: 1180, y: baseGround - 120, radius: 260, intensity: 0.9, color: \"#6ed8ff\", smoothing: 8, flicker: 0.25 }\r\n]);\r\n\r\nconst dunePlatforms = [\r\n  { x: -260, y: baseGround - 20, width: 540, height: 20, type: \"sand\" },\r\n  { x: 360, y: baseGround - 24, width: 340, height: 18, type: \"sand\" },\r\n  { x: 760, y: baseGround - 28, width: 380, height: 20, type: \"sand\" },\r\n  { x: 1180, y: baseGround - 26, width: 480, height: 22, type: \"sand\" },\r\n  { x: 120, y: baseGround - 140, width: 260, height: 16, type: \"cliff\" },\r\n  { x: 520, y: baseGround - 200, width: 260, height: 14, type: \"plateau\" },\r\n  { x: 900, y: baseGround - 180, width: 310, height: 14, type: \"plateau\" },\r\n  { x: 1280, y: baseGround - 240, width: 240, height: 12, type: \"plateau\" }\r\n];\r\n\r\nconst duneWater = addCentralWater(\r\n  scaleWaterZones([\r\n    { x: 520, width: 180, top: baseGround - 18, depth: 12 }\r\n  ]),\r\n  {\r\n    topOffset: 22,\r\n    depth: 24,\r\n    topColor: \"rgba(68, 156, 188, 0.85)\",\r\n    midColor: \"rgba(40, 124, 168, 0.9)\",\r\n    bottomColor: \"rgba(24, 74, 120, 0.95)\",\r\n    rippleColor: \"rgba(240, 255, 214, 0.18)\",\r\n    highlightColor: \"rgba(255, 204, 128, 0.26)\"\r\n  }\r\n);\r\n\r\nconst duneDecor = scaleDecor([\r\n  { type: \"dune\", baseX: 120, baseY: baseGround, width: 320, height: 120 },\r\n  { type: \"dune\", baseX: 620, baseY: baseGround, width: 280, height: 100 },\r\n  { type: \"dune\", baseX: 1080, baseY: baseGround, width: 340, height: 110 },\r\n  { type: \"rockSpire\", baseX: 420, baseY: baseGround, height: 260 },\r\n  { type: \"rockSpire\", baseX: 1160, baseY: baseGround, height: 230 },\r\n  { type: \"campfire\", baseX: 660, baseY: baseGround - 20 },\r\n  { type: \"antenna\", x: 920, y: baseGround - 300, height: 320 }\r\n]);\r\n\r\nconst duneDestructibles = scaleDestructibles([\r\n  {\r\n    id: \"dune-sandbag-west\",\r\n    type: \"sandbagLine\",\r\n    x: 280,\r\n    baseY: baseGround,\r\n    templateOverrides: {\r\n      bodyColor: \"#c8a070\",\r\n      accentColor: \"#edd0a0\",\r\n      damageHighlight: \"#ffe8b2\",\r\n      debrisColor: \"#8f6d45\"\r\n    }\r\n  },\r\n  {\r\n    id: \"dune-sandbag-east\",\r\n    type: \"sandbagLine\",\r\n    x: 1180,\r\n    baseY: baseGround,\r\n    templateOverrides: {\r\n      bodyColor: \"#c8a070\",\r\n      accentColor: \"#edd0a0\",\r\n      damageHighlight: \"#ffe8b2\",\r\n      debrisColor: \"#8f6d45\"\r\n    }\r\n  },\r\n  {\r\n    id: \"dune-rover\",\r\n    type: \"roverWreck\",\r\n    x: 760,\r\n    baseY: baseGround - 24,\r\n    facing: -1,\r\n    templateOverrides: {\r\n      bodyColor: \"#d1c296\",\r\n      accentColor: \"#fdf4c7\",\r\n      glassColor: \"#ffe8a1\",\r\n      damageHighlight: \"#fff0c1\",\r\n      debrisColor: \"#8f7b4a\"\r\n    }\r\n  },\r\n  {\r\n    id: \"dune-cell\",\r\n    type: \"plasmaCell\",\r\n    x: 540,\r\n    baseY: baseGround - 200,\r\n    templateOverrides: {\r\n      bodyColor: \"#f07f1f\",\r\n      accentColor: \"#ffd9a1\",\r\n      stripeColor: \"#ffeab9\",\r\n      damageHighlight: \"#fff1cb\",\r\n      debrisColor: \"#a95312\"\r\n    }\r\n  }\r\n]);\r\n\r\nconst duneInteractables = scaleInteractables([\r\n  {\r\n    id: \"dune-crate\",\r\n    type: \"pushCrate\",\r\n    x: 360,\r\n    baseY: baseGround - 24,\r\n    minX: 180,\r\n    maxX: 520,\r\n    templateOverrides: {\r\n      bodyColor: \"#bf9a62\",\r\n      edgeColor: \"#6f4f2f\",\r\n      braceColor: \"#dcb678\",\r\n      highlightColor: \"#ffe0a8\"\r\n    }\r\n  },\r\n  {\r\n    id: \"dune-barrel\",\r\n    type: \"kickBarrel\",\r\n    x: 820,\r\n    baseY: baseGround - 28,\r\n    minX: 720,\r\n    maxX: 960,\r\n    templateOverrides: {\r\n      bodyColor: \"#c7672d\",\r\n      stripeColor: \"#ffe49a\",\r\n      edgeColor: \"#531f05\",\r\n      topColor: \"#e4883d\"\r\n    }\r\n  },\r\n  {\r\n    id: \"dune-trap\",\r\n    type: \"shockTrap\",\r\n    x: 1020,\r\n    baseY: baseGround - 26,\r\n    templateOverrides: {\r\n      bodyColor: \"#3a2a14\",\r\n      accentColor: \"#ffcc6e\",\r\n      glowColor: \"#ffe9a6\"\r\n    }\r\n  }\r\n]);\r\n\r\nconst duneAmbientLights = scaleAmbientLights([\r\n  { id: \"dune-fire\", type: \"point\", x: 660, y: baseGround - 36, radius: 240, intensity: 1.2, color: \"#ffb36d\", smoothing: 6, flicker: 0.55 },\r\n  { id: \"dune-beacon\", type: \"point\", x: 920, y: baseGround - 200, radius: 260, intensity: 0.9, color: \"#8cc9ff\", smoothing: 8, flicker: 0.35 }\r\n]);\r\n\r\nconst orbitalPlatforms = scalePlatforms([\r\n  { x: -200, y: baseGround - 40, width: 540, height: 18, type: \"deck\" },\r\n  { x: 340, y: baseGround - 40, width: 360, height: 18, type: \"deck\" },\r\n  { x: 720, y: baseGround - 40, width: 400, height: 18, type: \"deck\" },\r\n  { x: 1200, y: baseGround - 40, width: 420, height: 18, type: \"deck\" },\r\n  { x: 160, y: baseGround - 160, width: 260, height: 14, type: \"catwalk\" },\r\n  { x: 520, y: baseGround - 220, width: 320, height: 14, type: \"catwalk\" },\r\n  { x: 920, y: baseGround - 200, width: 300, height: 14, type: \"maglev\" },\r\n  { x: 1280, y: baseGround - 260, width: 260, height: 12, type: \"maglev\" }\r\n]);\r\n\r\nconst orbitalWater = addCentralWater(\r\n  scaleWaterZones([]),\r\n  {\r\n    topOffset: 24,\r\n    depth: 30,\r\n    topColor: \"rgba(86, 128, 220, 0.82)\",\r\n    midColor: \"rgba(70, 104, 210, 0.88)\",\r\n    bottomColor: \"rgba(48, 72, 180, 0.94)\",\r\n    rippleColor: \"rgba(148, 208, 255, 0.28)\",\r\n    highlightColor: \"rgba(160, 220, 255, 0.3)\"\r\n  }\r\n);\r\n\r\nconst orbitalDecor = scaleDecor([\r\n  { type: \"spire\", baseX: 260, baseY: baseGround, height: 300 },\r\n  { type: \"spire\", baseX: 640, baseY: baseGround, height: 340 },\r\n  { type: \"spire\", baseX: 1100, baseY: baseGround, height: 320 },\r\n  { type: \"holoBillboard\", x: 820, y: baseGround - 220, width: 200, height: 100, text: \"SYN-42\" },\r\n  { type: \"energyCoil\", baseX: 520, baseY: baseGround - 20, height: 180 },\r\n  { type: \"energyCoil\", baseX: 1260, baseY: baseGround - 20, height: 200 },\r\n  { type: \"hovercar\", x: 420, y: baseGround - 160 },\r\n  { type: \"hovercar\", x: 1180, y: baseGround - 150 }\r\n]);\r\n\r\nconst orbitalDestructibles = scaleDestructibles([\r\n  {\r\n    id: \"orbital-barrier-west\",\r\n    type: \"sandbagLine\",\r\n    x: 320,\r\n    baseY: baseGround,\r\n    templateOverrides: {\r\n      bodyColor: \"#3b4b63\",\r\n      accentColor: \"#6c82b8\",\r\n      damageHighlight: \"#a9c4ff\",\r\n      debrisColor: \"#243145\"\r\n    }\r\n  },\r\n  {\r\n    id: \"orbital-barrier-east\",\r\n    type: \"sandbagLine\",\r\n    x: 1260,\r\n    baseY: baseGround,\r\n    templateOverrides: {\r\n      bodyColor: \"#3b4b63\",\r\n      accentColor: \"#6c82b8\",\r\n      damageHighlight: \"#a9c4ff\",\r\n      debrisColor: \"#243145\"\r\n    }\r\n  },\r\n  {\r\n    id: \"orbital-reactor\",\r\n    type: \"plasmaCell\",\r\n    x: 760,\r\n    baseY: baseGround - 40,\r\n    templateOverrides: {\r\n      bodyColor: \"#4a9fff\",\r\n      accentColor: \"#c4f5ff\",\r\n      stripeColor: \"#9ef7ff\",\r\n      damageHighlight: \"#d4fcff\"\r\n    }\r\n  },\r\n  {\r\n    id: \"orbital-rover\",\r\n    type: \"roverWreck\",\r\n    x: 540,\r\n    baseY: baseGround - 220,\r\n    facing: 1,\r\n    templateOverrides: {\r\n      bodyColor: \"#6f86ff\",\r\n      accentColor: \"#dfe6ff\",\r\n      glassColor: \"#9ffbff\",\r\n      damageHighlight: \"#bcd3ff\",\r\n      debrisColor: \"#3e4f9a\"\r\n    }\r\n  }\r\n]);\r\n\r\nconst orbitalInteractables = scaleInteractables([\r\n  {\r\n    id: \"orbital-crate-lower\",\r\n    type: \"pushCrate\",\r\n    x: 360,\r\n    baseY: baseGround - 40,\r\n    minX: 200,\r\n    maxX: 520,\r\n    templateOverrides: {\r\n      bodyColor: \"#4b5b87\",\r\n      edgeColor: \"#1b233a\",\r\n      braceColor: \"#7f96e8\",\r\n      highlightColor: \"#a8c2ff\"\r\n    }\r\n  },\r\n  {\r\n    id: \"orbital-crate-upper\",\r\n    type: \"pushCrate\",\r\n    x: 1080,\r\n    baseY: baseGround - 200,\r\n    minX: 960,\r\n    maxX: 1180,\r\n    templateOverrides: {\r\n      bodyColor: \"#566dac\",\r\n      edgeColor: \"#243154\",\r\n      braceColor: \"#8da4ff\",\r\n      highlightColor: \"#c3d1ff\"\r\n    }\r\n  },\r\n  {\r\n    id: \"orbital-barrel\",\r\n    type: \"kickBarrel\",\r\n    x: 680,\r\n    baseY: baseGround - 40,\r\n    minX: 620,\r\n    maxX: 880,\r\n    templateOverrides: {\r\n      bodyColor: \"#3d7cff\",\r\n      stripeColor: \"#8df5ff\",\r\n      edgeColor: \"#1c2550\",\r\n      topColor: \"#64a1ff\"\r\n    }\r\n  },\r\n  {\r\n    id: \"orbital-trap\",\r\n    type: \"shockTrap\",\r\n    x: 920,\r\n    baseY: baseGround - 40,\r\n    templateOverrides: {\r\n      bodyColor: \"#1f2850\",\r\n      accentColor: \"#86a6ff\",\r\n      glowColor: \"#b4ceff\"\r\n    }\r\n  }\r\n]);\r\n\r\nconst orbitalAmbientLights = scaleAmbientLights([\r\n  { id: \"orbital-coil-0\", type: \"point\", x: 520, y: baseGround - 120, radius: 280, intensity: 1.3, color: \"#7ce7ff\", smoothing: 10, flicker: 0.35 },\r\n  { id: \"orbital-coil-1\", type: \"point\", x: 1260, y: baseGround - 120, radius: 280, intensity: 1.3, color: \"#7ce7ff\", smoothing: 10, flicker: 0.35 },\r\n  { id: \"orbital-spire\", type: \"cone\", x: 260, y: baseGround - 320, radius: 320, intensity: 0.9, color: \"#55d9ff\", direction: 0, fov: Math.PI * 0.4, stretch: 0.6, smoothing: 14 }\r\n]);\r\n\r\nconst ENVIRONMENT_DEFINITIONS = {\r\n  neoDistrict: {\r\n    id: \"neoDistrict\",\r\n    name: \"Neo District\",\r\n    theme: \"urban\",\r\n    width: levelWidth,\r\n    background: {\r\n      gradientStops: [\r\n        { offset: 0, color: \"#111a2c\" },\r\n        { offset: 0.4, color: \"#182439\" },\r\n        { offset: 0.75, color: \"#1f2d44\" },\r\n        { offset: 1, color: \"#232f49\" }\r\n      ],\r\n      horizonBand: {\r\n        start: baseGround - 140,\r\n        height: 120,\r\n        topColor: \"rgba(46, 86, 126, 0.25)\",\r\n        bottomColor: \"rgba(28, 52, 84, 0)\"\r\n      },\r\n      groundColor: \"#1b2231\",\r\n      silhouettes: [\r\n        {\r\n          color: \"#1a2437\",\r\n          points: [\r\n            { x: 0, y: baseGround - 220 },\r\n            { x: scaleX(220), y: baseGround - 260 },\r\n            { x: scaleX(420), y: baseGround - 210 },\r\n            { x: scaleX(640), y: baseGround - 280 },\r\n            { x: scaleX(820), y: baseGround - 230 },\r\n            { x: scaleX(1040), y: baseGround - 260 },\r\n            { x: scaleX(1220), y: baseGround - 210 },\r\n            { x: scaleX(1380), y: baseGround - 260 },\r\n            { x: levelWidth, y: baseGround - 200 },\r\n            { x: levelWidth, y: baseGround },\r\n            { x: 0, y: baseGround }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    platforms: neoPlatforms,\r\n    waterZones: neoWaterZones,\r\n    decor: neoDecor,\r\n    destructibles: neoDestructibles,\r\n    interactables: neoInteractables,\r\n    ambientLights: neoAmbientLights,\r\n    spawn: {\r\n      player: { x: levelWidth * 0.5 },\r\n      trainingDummy: { x: levelWidth * 0.75 },\r\n      squadOffsets: [-120, 40, 120],\r\n      enemies: [levelWidth * 0.24, levelWidth * 0.68]\r\n    }\r\n  },\r\n  verdantWilds: {\r\n    id: \"verdantWilds\",\r\n    name: \"Verdant Wilds\",\r\n    theme: \"jungle\",\r\n    width: levelWidth,\r\n    background: {\r\n      gradientStops: [\r\n        { offset: 0, color: \"#0b1613\" },\r\n        { offset: 0.45, color: \"#123020\" },\r\n        { offset: 0.8, color: \"#1d4a37\" },\r\n        { offset: 1, color: \"#1c2d1f\" }\r\n      ],\r\n      horizonBand: {\r\n        start: baseGround - 160,\r\n        height: 140,\r\n        topColor: \"rgba(34, 84, 58, 0.32)\",\r\n        bottomColor: \"rgba(18, 42, 31, 0)\"\r\n      },\r\n      groundColor: \"#1c2519\",\r\n      silhouettes: [\r\n        {\r\n          color: \"#152718\",\r\n          points: [\r\n            { x: 0, y: baseGround - 200 },\r\n            { x: scaleX(160), y: baseGround - 230 },\r\n            { x: scaleX(360), y: baseGround - 210 },\r\n            { x: scaleX(540), y: baseGround - 250 },\r\n            { x: scaleX(760), y: baseGround - 220 },\r\n            { x: scaleX(980), y: baseGround - 240 },\r\n            { x: levelWidth, y: baseGround - 210 },\r\n            { x: levelWidth, y: baseGround },\r\n            { x: 0, y: baseGround }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    platforms: verdantPlatforms,\r\n    waterZones: verdantWater,\r\n    decor: verdantDecor,\r\n    destructibles: verdantDestructibles,\r\n    interactables: verdantInteractables,\r\n    ambientLights: verdantAmbientLights,\r\n    spawn: {\r\n      player: { x: levelWidth * 0.45 },\r\n      trainingDummy: { x: levelWidth * 0.8 },\r\n      squadOffsets: [-140, -10, 120],\r\n      enemies: [levelWidth * 0.2, levelWidth * 0.7]\r\n    }\r\n  },\r\n  sunsetDunes: {\r\n    id: \"sunsetDunes\",\r\n    name: \"Sunset Dunes\",\r\n    theme: \"desert\",\r\n    width: levelWidth,\r\n    background: {\r\n      gradientStops: [\r\n        { offset: 0, color: \"#32140c\" },\r\n        { offset: 0.45, color: \"#5c2814\" },\r\n        { offset: 0.78, color: \"#b35a1c\" },\r\n        { offset: 1, color: \"#d08b3e\" }\r\n      ],\r\n      horizonBand: {\r\n        start: baseGround - 150,\r\n        height: 120,\r\n        topColor: \"rgba(206, 124, 50, 0.28)\",\r\n        bottomColor: \"rgba(128, 68, 24, 0)\"\r\n      },\r\n      groundColor: \"#3c2717\",\r\n      silhouettes: [\r\n        {\r\n          color: \"#2a1b10\",\r\n          points: [\r\n            { x: 0, y: baseGround - 180 },\r\n            { x: scaleX(220), y: baseGround - 200 },\r\n            { x: scaleX(480), y: baseGround - 190 },\r\n            { x: scaleX(720), y: baseGround - 210 },\r\n            { x: scaleX(980), y: baseGround - 200 },\r\n            { x: levelWidth, y: baseGround - 190 },\r\n            { x: levelWidth, y: baseGround },\r\n            { x: 0, y: baseGround }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    platforms: dunePlatforms,\r\n    waterZones: duneWater,\r\n    decor: duneDecor,\r\n    destructibles: duneDestructibles,\r\n    interactables: duneInteractables,\r\n    ambientLights: duneAmbientLights,\r\n    spawn: {\r\n      player: { x: levelWidth * 0.46 },\r\n      trainingDummy: { x: levelWidth * 0.78 },\r\n      squadOffsets: [-140, -30, 110],\r\n      enemies: [levelWidth * 0.22, levelWidth * 0.68]\r\n    }\r\n  },\r\n  orbitalSpire: {\r\n    id: \"orbitalSpire\",\r\n    name: \"Orbital Spire\",\r\n    theme: \"sci-fi\",\r\n    width: levelWidth,\r\n    background: {\r\n      gradientStops: [\r\n        { offset: 0, color: \"#0d0f2a\" },\r\n        { offset: 0.5, color: \"#141a3d\" },\r\n        { offset: 0.82, color: \"#1c2856\" },\r\n        { offset: 1, color: \"#1e1f2c\" }\r\n      ],\r\n      horizonBand: {\r\n        start: baseGround - 160,\r\n        height: 140,\r\n        topColor: \"rgba(70, 120, 220, 0.22)\",\r\n        bottomColor: \"rgba(30, 40, 90, 0)\"\r\n      },\r\n      groundColor: \"#151726\",\r\n      silhouettes: [\r\n        {\r\n          color: \"#1a2650\",\r\n          points: [\r\n            { x: 0, y: baseGround - 240 },\r\n            { x: scaleX(200), y: baseGround - 320 },\r\n            { x: scaleX(280), y: baseGround - 200 },\r\n            { x: scaleX(520), y: baseGround - 340 },\r\n            { x: scaleX(720), y: baseGround - 260 },\r\n            { x: scaleX(900), y: baseGround - 320 },\r\n            { x: scaleX(1080), y: baseGround - 220 },\r\n            { x: scaleX(1280), y: baseGround - 340 },\r\n            { x: levelWidth, y: baseGround - 240 },\r\n            { x: levelWidth, y: baseGround },\r\n            { x: 0, y: baseGround }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    platforms: orbitalPlatforms,\r\n    waterZones: [],\r\n    decor: orbitalDecor,\r\n    destructibles: orbitalDestructibles,\r\n    interactables: orbitalInteractables,\r\n    ambientLights: orbitalAmbientLights,\r\n    spawn: {\r\n      player: { x: levelWidth * 0.5 },\r\n      trainingDummy: { x: levelWidth * 0.82 },\r\n      squadOffsets: [-130, -20, 120],\r\n      enemies: [levelWidth * 0.3, levelWidth * 0.7]\r\n    }\r\n  }\r\n};\r\n\r\nconst ENVIRONMENT_SEQUENCE = [\"neoDistrict\", \"verdantWilds\", \"sunsetDunes\", \"orbitalSpire\"];\r\n\r\nexport { ENVIRONMENT_DEFINITIONS, ENVIRONMENT_SEQUENCE };\r\n","const resourceState = {\r\n  materials: 120,\r\n  pickups: []\r\n};\r\n\r\nlet nextPickupId = 1;\r\n\r\nfunction getResourceState() {\r\n  return resourceState;\r\n}\r\n\r\nfunction getMaterialCount() {\r\n  return resourceState.materials;\r\n}\r\n\r\nfunction setMaterialCount(amount) {\r\n  resourceState.materials = Math.max(0, Math.floor(amount ?? 0));\r\n}\r\n\r\nfunction addMaterials(amount, source = \"\") {\r\n  if (!Number.isFinite(amount) || amount === 0) {\r\n    return;\r\n  }\r\n  resourceState.materials = Math.max(0, resourceState.materials + Math.round(amount));\r\n}\r\n\r\nfunction canAfford(cost) {\r\n  return resourceState.materials >= (cost ?? 0);\r\n}\r\n\r\nfunction spendMaterials(cost) {\r\n  const amount = Math.round(cost ?? 0);\r\n  if (amount <= 0) {\r\n    return true;\r\n  }\r\n  if (!canAfford(amount)) {\r\n    return false;\r\n  }\r\n  resourceState.materials -= amount;\r\n  return true;\r\n}\r\n\r\nfunction spawnSalvagePickup({ x = 0, y = 0, amount = 10, vx = (Math.random() - 0.5) * 80, vy = -120, ttl = 6 } = {}) {\r\n  const pickup = {\r\n    id: `salvage-${nextPickupId++}`,\r\n    x,\r\n    y,\r\n    vx,\r\n    vy,\r\n    amount: Math.max(1, Math.round(amount ?? 1)),\r\n    ttl,\r\n    maxTtl: ttl,\r\n    collected: false\r\n  };\r\n  resourceState.pickups.push(pickup);\r\n  return pickup;\r\n}\r\n\r\nfunction clearResourcePickups() {\r\n  resourceState.pickups.length = 0;\r\n}\r\n\r\nexport {\r\n  getResourceState,\r\n  getMaterialCount,\r\n  setMaterialCount,\r\n  addMaterials,\r\n  canAfford,\r\n  spendMaterials,\r\n  spawnSalvagePickup,\r\n  clearResourcePickups\r\n};\r\n","import { ENVIRONMENT_DEFINITIONS, ENVIRONMENT_SEQUENCE } from \"../config/environments.js\";\r\nimport { canvas } from \"../environment/canvas.js\";\r\nimport { clearResourcePickups } from \"./resources.js\";\r\n\r\nlet currentEnvironmentId = ENVIRONMENT_SEQUENCE[0] ?? Object.keys(ENVIRONMENT_DEFINITIONS)[0];\r\nconst listeners = new Set();\r\nlet controlsInitialized = false;\r\n\r\nfunction getEnvironmentDefinition(id = currentEnvironmentId) {\r\n  const definition = ENVIRONMENT_DEFINITIONS[id];\r\n  if (definition) {\r\n    return definition;\r\n  }\r\n  const fallbackId = ENVIRONMENT_SEQUENCE[0] ?? Object.keys(ENVIRONMENT_DEFINITIONS)[0];\r\n  currentEnvironmentId = fallbackId;\r\n  return ENVIRONMENT_DEFINITIONS[fallbackId];\r\n}\r\n\r\nfunction getEnvironmentWidth() {\r\n  const environment = getEnvironmentDefinition();\r\n  return typeof environment?.width === \"number\" ? environment.width : canvas.width;\r\n}\r\n\r\nfunction getEnvironmentId() {\r\n  return currentEnvironmentId;\r\n}\r\n\r\nfunction getEnvironmentPlatforms() {\r\n  const environment = getEnvironmentDefinition();\r\n  return Array.isArray(environment?.platforms) ? environment.platforms : [];\r\n}\r\n\r\nfunction getEnvironmentWaterZones() {\r\n  const environment = getEnvironmentDefinition();\r\n  return Array.isArray(environment?.waterZones) ? environment.waterZones : [];\r\n}\r\n\r\nfunction getEnvironmentDecor() {\r\n  const environment = getEnvironmentDefinition();\r\n  return Array.isArray(environment?.decor) ? environment.decor : [];\r\n}\r\n\r\nfunction getEnvironmentDestructibleSpawns() {\r\n  const environment = getEnvironmentDefinition();\r\n  return Array.isArray(environment?.destructibles) ? environment.destructibles : [];\r\n}\r\n\r\nfunction getEnvironmentInteractableSpawns() {\r\n  const environment = getEnvironmentDefinition();\r\n  return Array.isArray(environment?.interactables) ? environment.interactables : [];\r\n}\r\n\r\nfunction getEnvironmentAmbientLights() {\r\n  const environment = getEnvironmentDefinition();\r\n  return Array.isArray(environment?.ambientLights) ? environment.ambientLights : [];\r\n}\r\n\r\nfunction getEnvironmentSpawnSettings() {\r\n  const environment = getEnvironmentDefinition();\r\n  return environment?.spawn ?? {};\r\n}\r\n\r\nfunction notifyListeners() {\r\n  const definition = getEnvironmentDefinition();\r\n  for (const listener of listeners) {\r\n    try {\r\n      listener(definition);\r\n    } catch (error) {\r\n      if (typeof console !== \"undefined\" && console.error) {\r\n        console.error(\"Environment listener error\", error);\r\n      }\r\n    }\r\n  }\r\n  if (typeof window !== \"undefined\" && typeof window.dispatchEvent === \"function\") {\r\n    window.dispatchEvent(\r\n      new CustomEvent(\"environment:changed\", {\r\n        detail: { environment: definition, id: definition?.id ?? currentEnvironmentId }\r\n      })\r\n    );\r\n  }\r\n}\r\n\r\nfunction setEnvironment(environmentId) {\r\n  if (!environmentId || !ENVIRONMENT_DEFINITIONS[environmentId]) {\r\n    return false;\r\n  }\r\n  if (environmentId === currentEnvironmentId) {\r\n    return false;\r\n  }\r\n  currentEnvironmentId = environmentId;\r\n  clearResourcePickups();\r\n  notifyListeners();\r\n  return true;\r\n}\r\n\r\nfunction cycleEnvironment(direction = 1) {\r\n  if (!Array.isArray(ENVIRONMENT_SEQUENCE) || ENVIRONMENT_SEQUENCE.length === 0) {\r\n    return false;\r\n  }\r\n  const index = ENVIRONMENT_SEQUENCE.indexOf(currentEnvironmentId);\r\n  const normalizedIndex = index >= 0 ? index : 0;\r\n  const nextIndex = (normalizedIndex + direction + ENVIRONMENT_SEQUENCE.length) % ENVIRONMENT_SEQUENCE.length;\r\n  return setEnvironment(ENVIRONMENT_SEQUENCE[nextIndex]);\r\n}\r\n\r\nfunction onEnvironmentChange(listener, options = {}) {\r\n  if (typeof listener !== \"function\") {\r\n    return () => {};\r\n  }\r\n  listeners.add(listener);\r\n  if (options.immediate !== false) {\r\n    listener(getEnvironmentDefinition());\r\n  }\r\n  return () => {\r\n    listeners.delete(listener);\r\n  };\r\n}\r\n\r\nfunction handleEnvironmentHotkeys(event) {\r\n  if (!event.altKey || event.repeat) {\r\n    return;\r\n  }\r\n  if (event.code === \"Digit9\" || event.code === \"Digit0\") {\r\n    const direction = event.code === \"Digit9\" ? -1 : 1;\r\n    const changed = cycleEnvironment(direction);\r\n    if (changed && typeof event.preventDefault === \"function\") {\r\n      event.preventDefault();\r\n    }\r\n  }\r\n}\r\n\r\nfunction initializeEnvironmentControls() {\r\n  if (controlsInitialized || typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.addEventListener(\"keydown\", handleEnvironmentHotkeys);\r\n  controlsInitialized = true;\r\n}\r\n\r\nexport {\r\n  getEnvironmentDefinition,\r\n  getEnvironmentId,\r\n  getEnvironmentWidth,\r\n  getEnvironmentPlatforms,\r\n  getEnvironmentWaterZones,\r\n  getEnvironmentDecor,\r\n  getEnvironmentDestructibleSpawns,\r\n  getEnvironmentInteractableSpawns,\r\n  getEnvironmentAmbientLights,\r\n  getEnvironmentSpawnSettings,\r\n  setEnvironment,\r\n  cycleEnvironment,\r\n  onEnvironmentChange,\r\n  initializeEnvironmentControls\r\n};\r\n","import { canvas } from \"../environment/canvas.js\";\r\nimport { getEnvironmentWidth, onEnvironmentChange } from \"./environment.js\";\r\n\r\nconst cameraState = {\r\n  x: canvas.width * 0.5,\r\n  targetX: canvas.width * 0.5\r\n};\r\n\r\nfunction getHalfViewWidth() {\r\n  return canvas.width * 0.5;\r\n}\r\n\r\nfunction clampCameraX(value) {\r\n  const half = getHalfViewWidth();\r\n  const envWidth = getEnvironmentWidth();\r\n  if (envWidth <= canvas.width) {\r\n    return canvas.width * 0.5;\r\n  }\r\n  return Math.min(Math.max(value, half), envWidth - half);\r\n}\r\n\r\nfunction setCameraTargetX(x) {\r\n  cameraState.targetX = clampCameraX(x);\r\n}\r\n\r\nfunction snapCameraTo(x) {\r\n  cameraState.x = clampCameraX(x);\r\n  cameraState.targetX = cameraState.x;\r\n}\r\n\r\nfunction resetCamera() {\r\n  const envWidth = getEnvironmentWidth();\r\n  snapCameraTo(envWidth * 0.5);\r\n}\r\n\r\nfunction updateCamera(delta) {\r\n  const target = clampCameraX(cameraState.targetX);\r\n  const lerpSpeed = 6;\r\n  const t = Math.min(1, delta * lerpSpeed);\r\n  cameraState.x += (target - cameraState.x) * t;\r\n  cameraState.x = clampCameraX(cameraState.x);\r\n}\r\n\r\nfunction getCamera() {\r\n  const half = getHalfViewWidth();\r\n  const envWidth = getEnvironmentWidth();\r\n  const clampedX = clampCameraX(cameraState.x);\r\n  let left = clampedX - half;\r\n  if (envWidth <= canvas.width) {\r\n    left = Math.max(0, (envWidth * 0.5) - half);\r\n  } else {\r\n    left = Math.min(Math.max(0, left), envWidth - canvas.width);\r\n  }\r\n  const right = left + canvas.width;\r\n  return {\r\n    x: clampedX,\r\n    y: 0,\r\n    halfWidth: half,\r\n    left,\r\n    right,\r\n    offsetX: left\r\n  };\r\n}\r\n\r\nonEnvironmentChange(() => {\r\n  resetCamera();\r\n});\r\n\r\nresetCamera();\r\n\r\nexport { getCamera, setCameraTargetX, updateCamera, resetCamera };\r\n","const input = Object.seal({\r\n  left: false,\r\n  right: false,\r\n  jump: false,\r\n  down: false,\r\n  roll: false,\r\n  attackBuffered: false,\r\n  throwBuffered: false,\r\n  reloadBuffered: false,\r\n  interactBuffered: false,\r\n  attackDown: false,\r\n  throwDown: false,\r\n  squadCommandCycleBuffered: false,\r\n  squadCommandSelect: null,\r\n  serverBrowserToggleBuffered: false,\r\n  serverBrowserNavigate: 0,\r\n  serverBrowserJoinBuffered: false,\r\n  serverBrowserHostBuffered: false,\r\n  serverBrowserStopHostBuffered: false,\r\n  serverBrowserCopyOfferBuffered: false,\r\n  serverBrowserPasteOfferBuffered: false,\r\n  serverBrowserAcceptAnswerBuffered: false,\r\n  serverBrowserCopyCandidatesBuffered: false,\r\n  serverBrowserPasteCandidatesBuffered: false,\r\n  buildToggleBuffered: false,\r\n  buildCycleBuffered: 0,\r\n  buildConfirmBuffered: false,\r\n  buildCancelBuffered: false,\r\n  survivalToggleBuffered: false,\r\n});\r\n\r\nlet initialized = false;\r\n\r\nfunction handleKey(isDown, event) {\r\n  switch (event.code) {\r\n    case \"ArrowLeft\":\r\n    case \"KeyA\":\r\n      input.left = isDown;\r\n      event.preventDefault();\r\n      break;\r\n    case \"ArrowRight\":\r\n    case \"KeyD\":\r\n      input.right = isDown;\r\n      event.preventDefault();\r\n      break;\r\n    case \"ArrowUp\":\r\n    case \"KeyW\":\r\n    case \"Space\":\r\n      input.jump = isDown;\r\n      event.preventDefault();\r\n      break;\r\n    case \"ArrowDown\":\r\n    case \"KeyS\":\r\n      input.down = isDown;\r\n      event.preventDefault();\r\n      break;\r\n    case \"Comma\":\r\n      if (isDown) {\r\n        input.buildCycleBuffered = -1;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"Period\":\r\n      if (isDown) {\r\n        input.buildCycleBuffered = 1;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"Escape\":\r\n      if (isDown) {\r\n        input.buildCancelBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n    case \"ShiftLeft\":\r\n    case \"ShiftRight\":\r\n      if (isDown) {\r\n        input.roll = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyB\":\r\n      if (isDown) {\r\n        input.buildToggleBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyY\":\r\n      if (isDown) {\r\n        input.survivalToggleBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyJ\":\r\n    case \"KeyF\":\r\n      if (isDown) {\r\n        input.attackBuffered = true;\r\n        input.attackDown = true;\r\n        event.preventDefault();\r\n      } else {\r\n        input.attackDown = false;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyG\":\r\n      if (isDown) {\r\n        input.throwBuffered = true;\r\n        input.throwDown = true;\r\n        event.preventDefault();\r\n      } else {\r\n        input.throwDown = false;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyR\":\r\n      if (isDown) {\r\n        input.reloadBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyE\":\r\n      if (isDown) {\r\n        input.interactBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyT\":\r\n      if (isDown) {\r\n        input.squadCommandCycleBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyZ\":\r\n      if (isDown) {\r\n        input.squadCommandSelect = \"hold\";\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyX\":\r\n      if (isDown) {\r\n        input.squadCommandSelect = \"defend\";\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyC\":\r\n      if (isDown) {\r\n        input.squadCommandSelect = \"attack\";\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyV\":\r\n      if (isDown) {\r\n        input.squadCommandSelect = \"flank\";\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyL\":\r\n      if (isDown) {\r\n        input.serverBrowserToggleBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"BracketLeft\":\r\n      if (isDown) {\r\n        input.serverBrowserNavigate = -1;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"BracketRight\":\r\n      if (isDown) {\r\n        input.serverBrowserNavigate = 1;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"Slash\":\r\n      if (isDown) {\r\n        input.serverBrowserNavigate = 1;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"Enter\":\r\n      if (isDown) {\r\n        input.serverBrowserJoinBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyH\":\r\n      if (isDown) {\r\n        input.serverBrowserHostBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyU\":\r\n      if (isDown) {\r\n        input.serverBrowserStopHostBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyO\":\r\n      if (isDown) {\r\n        input.serverBrowserCopyOfferBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyP\":\r\n      if (isDown) {\r\n        input.serverBrowserPasteOfferBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyI\":\r\n      if (isDown) {\r\n        input.serverBrowserAcceptAnswerBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyM\":\r\n      if (isDown) {\r\n        input.serverBrowserCopyCandidatesBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyN\":\r\n      if (isDown) {\r\n        input.serverBrowserPasteCandidatesBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n}\r\n\r\nfunction handleMouseDown(event) {\r\n  if (event.button === 0) {\r\n    input.attackBuffered = true;\r\n    input.attackDown = true;\r\n    event.preventDefault();\r\n  } else if (event.button === 2) {\r\n    input.throwBuffered = true;\r\n    input.throwDown = true;\r\n    event.preventDefault();\r\n  }\r\n}\r\n\r\nfunction handleMouseUp(event) {\r\n  if (event.button === 0) {\r\n    input.attackDown = false;\r\n    event.preventDefault();\r\n  } else if (event.button === 2) {\r\n    input.throwDown = false;\r\n    event.preventDefault();\r\n  }\r\n}\r\n\r\nfunction resetInputs() {\r\n  input.left = false;\r\n  input.right = false;\r\n  input.jump = false;\r\n  input.down = false;\r\n  input.roll = false;\r\n  input.attackBuffered = false;\r\n  input.throwBuffered = false;\r\n  input.reloadBuffered = false;\r\n  input.interactBuffered = false;\r\n  input.attackDown = false;\r\n  input.throwDown = false;\r\n  input.squadCommandCycleBuffered = false;\r\n  input.squadCommandSelect = null;\r\n  input.serverBrowserToggleBuffered = false;\r\n  input.serverBrowserNavigate = 0;\r\n  input.serverBrowserJoinBuffered = false;\r\n  input.serverBrowserHostBuffered = false;\r\n  input.serverBrowserStopHostBuffered = false;\r\n  input.serverBrowserCopyOfferBuffered = false;\r\n  input.serverBrowserPasteOfferBuffered = false;\r\n  input.serverBrowserAcceptAnswerBuffered = false;\r\n  input.serverBrowserCopyCandidatesBuffered = false;\r\n  input.serverBrowserPasteCandidatesBuffered = false;\r\n}\r\n\r\nfunction initializeInput() {\r\n  if (initialized) {\r\n    return;\r\n  }\r\n  window.addEventListener(\"keydown\", (event) => handleKey(true, event));\r\n  window.addEventListener(\"keyup\", (event) => handleKey(false, event));\r\n  window.addEventListener(\"mousedown\", handleMouseDown);\r\n  window.addEventListener(\"mouseup\", handleMouseUp);\r\n  window.addEventListener(\"contextmenu\", (event) => event.preventDefault());\r\n  window.addEventListener(\"blur\", resetInputs);\r\n  initialized = true;\r\n}\r\n\r\nexport { input, initializeInput, resetInputs };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","const WEAPON_DEFINITIONS = {\r\n  combatFists: {\r\n    id: \"combatFists\",\r\n    name: \"Combat Fists\",\r\n    description: \"Baseline martial arts combo with balanced speed and control.\",\r\n    category: \"melee-short\",\r\n    attackChain: [\r\n      {\r\n        name: \"Quick Jab\",\r\n        windup: 0.06,\r\n        active: 0.12,\r\n        recovery: 0.14,\r\n        comboStart: 0.12,\r\n        comboWindow: 0.18,\r\n        range: 74,\r\n        heightOffset: -46,\r\n        radius: 26,\r\n        damage: 8,\r\n        knockback: 140,\r\n        launch: 0\r\n      },\r\n      {\r\n        name: \"Cross Strike\",\r\n        windup: 0.08,\r\n        active: 0.12,\r\n        recovery: 0.18,\r\n        comboStart: 0.18,\r\n        comboWindow: 0.2,\r\n        range: 82,\r\n        heightOffset: -40,\r\n        radius: 28,\r\n        damage: 12,\r\n        knockback: 180,\r\n        launch: 0\r\n      },\r\n      {\r\n        name: \"Rising Kick\",\r\n        windup: 0.1,\r\n        active: 0.14,\r\n        recovery: 0.24,\r\n        comboStart: 0.24,\r\n        comboWindow: 0.2,\r\n        range: 68,\r\n        heightOffset: -64,\r\n        radius: 30,\r\n        damage: 16,\r\n        knockback: 220,\r\n        launch: 160\r\n      }\r\n    ]\r\n  },\r\n  shockBaton: {\r\n    id: \"shockBaton\",\r\n    name: \"Shock Baton\",\r\n    description: \"Electrified staff built for crowd control and guard breaks.\",\r\n    category: \"melee-mid\",\r\n    attackChain: [\r\n      {\r\n        name: \"Jab Feint\",\r\n        windup: 0.06,\r\n        active: 0.08,\r\n        recovery: 0.14,\r\n        comboStart: 0.14,\r\n        comboWindow: 0.16,\r\n        range: 68,\r\n        heightOffset: -30,\r\n        radius: 26,\r\n        damage: 9,\r\n        knockback: 90,\r\n        launch: 0\r\n      },\r\n      {\r\n        name: \"Slide Sweep\",\r\n        windup: 0.1,\r\n        active: 0.12,\r\n        recovery: 0.2,\r\n        comboStart: 0.2,\r\n        comboWindow: 0.18,\r\n        range: 86,\r\n        heightOffset: -12,\r\n        radius: 34,\r\n        damage: 16,\r\n        knockback: 180,\r\n        launch: 30\r\n      },\r\n      {\r\n        name: \"Arc Burst\",\r\n        windup: 0.16,\r\n        active: 0.2,\r\n        recovery: 0.32,\r\n        comboStart: 0.32,\r\n        comboWindow: 0.2,\r\n        range: 94,\r\n        heightOffset: -28,\r\n        radius: 42,\r\n        damage: 26,\r\n        knockback: 280,\r\n        launch: 160\r\n      }\r\n    ]\r\n  },\r\n  strikerPistol: {\r\n    id: \"strikerPistol\",\r\n    name: \"Striker Pistol\",\r\n    description: \"Semi-auto sidearm. Tap fire for consistent ranged pressure.\",\r\n    category: \"ranged-short\",\r\n    attackChain: [],\r\n    projectile: {\r\n      radius: 6,\r\n      speed: 520,\r\n      damage: 14,\r\n      knockback: 90,\r\n      lifetime: 0.9,\r\n      gravityFactor: 0.25,\r\n      color: \"#ffca7a\"\r\n    },\r\n    ammo: {\r\n      magazine: 12,\r\n      reserve: 48,\r\n      reloadSeconds: 1.3\r\n    }\r\n  },\r\n  vectorSmg: {\r\n    id: \"vectorSmg\",\r\n    name: \"Vector SMG\",\r\n    description: \"Rapid PDW prototype tuned for controllable spray.\",\r\n    category: \"ranged-mid\",\r\n    attackChain: [],\r\n    projectile: {\r\n      radius: 5,\r\n      speed: 620,\r\n      damage: 10,\r\n      knockback: 70,\r\n      lifetime: 0.85,\r\n      gravityFactor: 0.18,\r\n      color: \"#98d8ff\"\r\n    },\r\n    ammo: {\r\n      magazine: 32,\r\n      reserve: 160,\r\n      reloadSeconds: 2.1\r\n    },\r\n    recoil: {\r\n      horizontal: 0.6,\r\n      vertical: 1.4,\r\n      decay: 10\r\n    },\r\n    spread: {\r\n      base: 1.5,\r\n      perShot: 0.6,\r\n      max: 6.5,\r\n      recovery: 3.2\r\n    }\r\n  },\r\n  fragGrenade: {\r\n    id: \"fragGrenade\",\r\n    name: \"Frag Grenade\",\r\n    description: \"Timed explosive. Toss, bounce, and detonate in a wide area.\",\r\n    category: \"throwable\",\r\n    attackChain: [],\r\n    throwable: {\r\n      fuseSeconds: 1.6,\r\n      explosionRadius: 120,\r\n      damage: 45,\r\n      knockback: 260,\r\n      arcVelocity: { vx: 280, vy: -420 },\r\n      gravityFactor: 0.5,\r\n      bounciness: 0.45,\r\n      color: \"#ffb347\",\r\n      radius: 16,\r\n      cooldownSeconds: 1.05,\r\n      explosionDuration: 0.32,\r\n      selfDamageScale: 0.55,\r\n      selfKnockbackScale: 0.5,\r\n      effectType: \"explosive\"\r\n    }\r\n  },\r\n  flashBang: {\r\n    id: \"flashBang\",\r\n    name: \"Flashbang\",\r\n    description: \"Blinding charge that staggers enemies caught in the burst.\",\r\n    category: \"throwable\",\r\n    attackChain: [],\r\n    throwable: {\r\n      fuseSeconds: 1.2,\r\n      explosionRadius: 160,\r\n      damage: 0,\r\n      knockback: 0,\r\n      arcVelocity: { vx: 260, vy: -420 },\r\n      gravityFactor: 0.45,\r\n      bounciness: 0.4,\r\n      color: \"#f9f2c7\",\r\n      radius: 14,\r\n      cooldownSeconds: 1.4,\r\n      explosionDuration: 0.24,\r\n      effectType: \"flash\",\r\n      stunDuration: 1.8,\r\n      playerStunDuration: 0.9\r\n    }\r\n  },\r\n  smokeCanister: {\r\n    id: \"smokeCanister\",\r\n    name: \"Smoke Canister\",\r\n    description: \"Rapid-deploy screen that slows foes and softens line of sight.\",\r\n    category: \"throwable\",\r\n    attackChain: [],\r\n    throwable: {\r\n      fuseSeconds: 0.9,\r\n      explosionRadius: 80,\r\n      damage: 0,\r\n      knockback: 0,\r\n      arcVelocity: { vx: 220, vy: -360 },\r\n      gravityFactor: 0.52,\r\n      bounciness: 0.35,\r\n      color: \"#aeb9c6\",\r\n      radius: 18,\r\n      cooldownSeconds: 2.3,\r\n      explosionDuration: 0.2,\r\n      effectType: \"smoke\",\r\n      smokeDuration: 4.6,\r\n      smokeRadius: 150,\r\n      smokeExpansion: 1.35,\r\n      smokeSlowMultiplier: 0.55,\r\n      smokeTickDuration: 0.45\r\n    }\r\n  },\r\n  turretDrone: {\r\n    id: \"turretDrone\",\r\n    name: \"Deployable Turret\",\r\n    description: \"Drops an auto-targeting sentry that covers a lane with suppressive fire.\",\r\n    category: \"gadget\",\r\n    attackChain: [],\r\n    gadget: {\r\n      type: \"turret\",\r\n      cooldownSeconds: 3.2,\r\n      duration: 8.5,\r\n      range: 260,\r\n      fireInterval: 0.55,\r\n      maxActive: 2,\r\n      height: 54,\r\n      spawnOffset: { x: 70, y: 0 },\r\n      baseColor: \"#6f7bff\",\r\n      headColor: \"#d6dcff\",\r\n      projectile: {\r\n        speed: 540,\r\n        radius: 4,\r\n        damage: 9,\r\n        knockback: 80,\r\n        lifetime: 1.1,\r\n        color: \"#9ae9ff\"\r\n      }\r\n    }\r\n  },\r\n  grappleRig: {\r\n    id: \"grappleRig\",\r\n    name: \"Grapple Rig\",\r\n    description: \"Launch, latch, and zip to an overhead anchor for quick repositioning.\",\r\n    category: \"gadget\",\r\n    attackChain: [],\r\n    gadget: {\r\n      type: \"grapple\",\r\n      cooldownSeconds: 1.8,\r\n      duration: 0.6,\r\n      maxLength: 320,\r\n      maxRise: 260,\r\n      travelSpeed: 900,\r\n      pullSpeed: 760,\r\n      color: \"#8cf1ff\",\r\n    }\r\n  },\r\n  thunderCannon: {\r\n    id: \"thunderCannon\",\r\n    name: \"Thunder Cannon\",\r\n    description: \"Supply drop-exclusive launcher that fires high-impact bolts.\",\r\n    category: \"ranged-heavy\",\r\n    attackChain: [],\r\n    projectile: {\r\n      radius: 10,\r\n      speed: 620,\r\n      damage: 42,\r\n      knockback: 260,\r\n      lifetime: 1.2,\r\n      gravityFactor: 0.18,\r\n      color: \"#ffd76a\"\r\n    },\r\n    ammo: {\r\n      magazine: 4,\r\n      reserve: 12,\r\n      reloadSeconds: 2.9\r\n    },\r\n    recoil: {\r\n      horizontal: 2.2,\r\n      vertical: 5.4,\r\n      recovery: 6.5\r\n    },\r\n    spread: {\r\n      base: 1.5,\r\n      max: 6,\r\n      increase: 1.1,\r\n      recovery: 3.5\r\n    }\r\n  },\r\n  shieldBubble: {\r\n    id: \"shieldBubble\",\r\n    name: \"Shield Bubble\",\r\n    description: \"Pop a temporary energy shell that soaks damage and keeps you grounded.\",\r\n    category: \"gadget\",\r\n    attackChain: [],\r\n    gadget: {\r\n      type: \"shield\",\r\n      cooldownSeconds: 4.5,\r\n      duration: 6,\r\n      strength: 90,\r\n      radius: 96,\r\n      color: \"#7cd6ff\"\r\n    }\r\n  }\r\n};\r\n\r\nconst DEFAULT_LOADOUT = [\"combatFists\", \"shockBaton\", \"strikerPistol\", \"fragGrenade\", \"flashBang\", \"smokeCanister\", \"turretDrone\", \"grappleRig\", \"shieldBubble\"];\r\n\r\nexport { WEAPON_DEFINITIONS, DEFAULT_LOADOUT };\r\n\r\n","const SPEED = 240;\nconst JUMP_SPEED = 460;\nconst ROLL_SPEED = 420;\nconst ROLL_DURATION = 0.32;\nconst GRAVITY = 1400;\n\nconst POSES = {\n  standing: {\n    headRadius: 16,\n    bodyLength: 34,\n    legLength: 36,\n    armLength: 28,\n    strideMultiplier: 1,\n    armSwingAmplitude: 12,\n    legSwingAmplitude: 12\n  },\n  crouching: {\n    headRadius: 16,\n    bodyLength: 24,\n    legLength: 24,\n    armLength: 22,\n    strideMultiplier: 0.6,\n    armSwingAmplitude: 6,\n    legSwingAmplitude: 6\n  },\n  rolling: {\n    headRadius: 16,\n    bodyLength: 18,\n    legLength: 18,\n    armLength: 18,\n    strideMultiplier: 0,\n    armSwingAmplitude: 0,\n    legSwingAmplitude: 0\n  }\n};\n\nexport {\n  SPEED,\n  JUMP_SPEED,\n  ROLL_SPEED,\n  ROLL_DURATION,\n  GRAVITY,\n  POSES\n};\r\n","const SQUAD_COMMANDS = [\n  {\n    id: \"hold\",\n    label: \"Hold\",\n    description: \"Regroup on you and stay close.\",\n    order: 0\n  },\n  {\n    id: \"defend\",\n    label: \"Defend\",\n    description: \"Form a defensive ring and cover your position.\",\n    order: 1\n  },\n  {\n    id: \"attack\",\n    label: \"Attack\",\n    description: \"Press the nearest enemy with ranged fire.\",\n    order: 2\n  },\n  {\n    id: \"flank\",\n    label: \"Flank\",\n    description: \"Split wide and pressure the enemy from the side.\",\n    order: 3\n  }\n];\n\nconst SQUAD_SETTINGS = {\n  maxSquadSize: 3,\n  commandRange: 640,\n  followRadius: 120,\n  defendRadius: 180,\n  flankOffset: 220,\n  commandCooldown: 1.4,\n  supportFireCooldown: 0.45,\n  projectileSpeed: 520,\n  projectileDamage: 12\n};\n\nexport { SQUAD_COMMANDS, SQUAD_SETTINGS };\r\n","import { canvas, GROUND_Y } from \"../environment/canvas.js\";\r\nimport { POSES } from \"../config/constants.js\";\r\nimport { SQUAD_COMMANDS } from \"../config/squad.js\";\r\nimport { getEnvironmentSpawnSettings, onEnvironmentChange, getEnvironmentWidth } from \"./environment.js\";\r\n\r\nfunction getTotalHeight(pose) {\r\n  return pose.headRadius * 2 + pose.bodyLength + pose.legLength;\r\n}\r\n\r\nfunction createGruntEnemy(spawnX, options = {}) {\r\n  const spawnSettings = getEnvironmentSpawnSettings();\r\n  const predefined = Array.isArray(spawnSettings?.enemies) ? spawnSettings.enemies : [];\r\n  const resolvedX = typeof spawnX === \"number\" ? spawnX : predefined[0] ?? getEnvironmentWidth() * 0.25;\r\n  const enemyHeight = 118;\r\n  const spawnY = spawnSettings?.enemyY ?? GROUND_Y - enemyHeight;\r\n  const contextTag = options.context ?? \"sandbox\";\r\n  const autoRespawn = options.autoRespawn ?? contextTag !== \"survival\";\r\n  const spawnSide = options.spawnSide ?? null;\r\n  const initialFacing = options.facing ?? 1;\r\n  const id = `grunt-${Math.random().toString(36).slice(2, 8)}`;\r\n\r\n  return {\r\n    id,\r\n    spawnX: resolvedX,\r\n    spawnY,\r\n    x: resolvedX,\r\n    y: spawnY,\r\n    vx: 0,\r\n    vy: 0,\r\n    radius: 22,\r\n    height: enemyHeight,\r\n    facing: initialFacing,\r\n    onGround: true,\r\n    state: \"patrol\",\r\n    stateTimer: 1 + Math.random(),\r\n    patrolRange: { min: resolvedX - 100, max: resolvedX + 220 },\r\n    aggressionRange: 360,\r\n    attackRange: 86,\r\n    moveSpeed: 160,\r\n    health: 120,\r\n    maxHealth: 120,\r\n    attackCooldown: 0,\r\n    attackWindup: 0,\r\n    attackActive: 0,\r\n    attackDamage: 12,\r\n    attackKnockback: 120,\r\n    attackLaunch: -80,\r\n    flashTimer: 0,\r\n    shakeTimer: 0,\r\n    shakeMagnitude: 0,\r\n    invulnerability: 0,\r\n    respawnTimer: 0,\r\n    stunTimer: 0,\r\n    smokeSlowTimer: 0,\r\n    smokeSlowStrength: 1,\r\n    spawnContext: contextTag,\r\n    autoRespawn,\r\n    spawnSide,\r\n    active: true\r\n  };\r\n}\r\n\r\nfunction createSquadmate(offsetX = 0, name = \"Ally\", baseX = getEnvironmentWidth() * 0.5) {\r\n  const spawnX = baseX + offsetX;\r\n  const spawnY = GROUND_Y - getTotalHeight(POSES.standing);\r\n  return {\r\n    id: `squad-${Math.random().toString(36).slice(2, 8)}`,\r\n    name,\r\n    x: spawnX,\r\n    y: spawnY,\r\n    vx: 0,\r\n    vy: 0,\r\n    facing: 1,\r\n    onGround: true,\r\n    state: \"follow\",\r\n    fireCooldown: 0,\r\n    commandTimer: 0,\r\n    targetEnemyId: null,\r\n    flashTimer: 0,\r\n    highlight: 0,\r\n    structureShieldTimer: 0,\r\n    structureShieldStrength: 0,\r\n    roleIndex: 0\r\n  };\r\n}\r\n\r\nconst spawnSettings = getEnvironmentSpawnSettings();\r\nconst standingHeight = getTotalHeight(POSES.standing);\r\nconst playerSpawnX = spawnSettings?.player?.x ?? getEnvironmentWidth() * 0.5;\r\nconst playerSpawnY = spawnSettings?.player?.y ?? GROUND_Y - standingHeight;\r\n\r\nconst stickman = {\r\n  x: playerSpawnX,\r\n  y: playerSpawnY,\r\n  vx: 0,\r\n  vy: 0,\r\n  facing: 1,\r\n  onGround: true,\r\n  controlMode: \"onFoot\",\r\n  vehicleId: null,\r\n  vehicleCandidateId: null,\r\n  squadCommandIndex: 0,\r\n  squadCommandId: SQUAD_COMMANDS[0]?.id ?? \"hold\",\r\n  squadCommandCooldown: 0,\r\n  rolling: false,\r\n  rollTimer: 0,\r\n  crouching: false,\r\n  currentPose: POSES.standing,\r\n  attacking: false,\r\n  attackIndex: -1,\r\n  currentAttack: null,\r\n  attackElapsed: 0,\r\n  attackInstanceId: 0,\r\n  comboWindowOpen: false,\r\n  comboWindowTimer: 0,\r\n  nextAttackQueued: false,\r\n  hitboxSpawned: false,\r\n  activeHitboxes: [],\r\n  health: 100,\r\n  maxHealth: 100,\r\n  invulnerability: 0,\r\n  deadTimer: 0,\r\n  throwCooldown: 0,\r\n  gadgetCooldown: 0,\r\n  reloading: false,\r\n  stunTimer: 0,\r\n  flashBlindTimer: 0,\r\n  smokeSlowTimer: 0,\r\n  smokeSlowStrength: 1,\r\n  structureShieldTimer: 0,\r\n  structureShieldStrength: 0,\r\n  equippedWeaponId: \"combatFists\"\r\n};\r\n\r\nconst squadOffsets = Array.isArray(spawnSettings?.squadOffsets)\r\n  ? spawnSettings.squadOffsets\r\n  : [-120, 40, 120];\r\n\r\nconst squadmates = [\r\n  createSquadmate(squadOffsets[0] ?? -120, \"Sparrow\", playerSpawnX),\r\n  createSquadmate(squadOffsets[1] ?? 40, \"Rook\", playerSpawnX),\r\n  createSquadmate(squadOffsets[2] ?? 120, \"Viper\", playerSpawnX)\r\n];\r\n\r\nconst remotePlayers = new Map();\r\n\r\nfunction upsertRemotePlayer(state) {\r\n  if (!state || !state.id) {\r\n    return;\r\n  }\r\n  const now = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n  const existing = remotePlayers.get(state.id) ?? {};\r\n  remotePlayers.set(state.id, {\r\n    id: state.id,\r\n    name: state.name ?? existing.name ?? \"Remote\",\r\n    x: state.x ?? existing.x ?? 0,\r\n    y: state.y ?? existing.y ?? GROUND_Y - standingHeight,\r\n    facing: state.facing ?? existing.facing ?? 1,\r\n    commandId: state.commandId ?? existing.commandId ?? \"hold\",\r\n    lastUpdate: now\r\n  });\r\n}\r\n\r\nfunction getRemotePlayers() {\r\n  return Array.from(remotePlayers.values());\r\n}\r\n\r\nfunction pruneRemotePlayers(maxAgeMs = 6000) {\r\n  const now = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n  for (const [id, player] of remotePlayers.entries()) {\r\n    if (now - (player.lastUpdate ?? now) > maxAgeMs) {\r\n      remotePlayers.delete(id);\r\n    }\r\n  }\r\n}\r\n\r\nconst trainingDummy = {\r\n  id: \"training-dummy\",\r\n  x: spawnSettings?.trainingDummy?.x ?? getEnvironmentWidth() * 0.75,\r\n  y: spawnSettings?.trainingDummy?.y ?? GROUND_Y - 120,\r\n  height: 120,\r\n  radius: 26,\r\n  maxHealth: 150,\r\n  health: 150,\r\n  flashTimer: 0,\r\n  shakeTimer: 0,\r\n  shakeMagnitude: 0,\r\n  respawnTimer: 0\r\n};\r\n\r\nconst enemySpawnXs = Array.isArray(spawnSettings?.enemies)\r\n  ? spawnSettings.enemies\r\n  : [getEnvironmentWidth() * 0.24, getEnvironmentWidth() * 0.68];\r\n\r\nconst enemies = [\r\n  createGruntEnemy(enemySpawnXs[0], { context: \"sandbox\", autoRespawn: true, spawnSide: 0, facing: 1 }),\r\n  createGruntEnemy(enemySpawnXs[1], { context: \"sandbox\", autoRespawn: true, spawnSide: 1, facing: -1 })\r\n];\r\n\r\nfunction initializeSandboxEnemy(enemy, index) {\r\n  enemy.spawnSide = index;\r\n  enemy.spawnContext = enemy.spawnContext ?? \"sandbox\";\r\n  enemy.autoRespawn = enemy.autoRespawn ?? true;\r\n  enemy.facing = index === 0 ? 1 : -1;\r\n}\r\n\r\nenemies.forEach((enemy, index) => {\r\n  initializeSandboxEnemy(enemy, index);\r\n});\r\n\r\nfunction ensureSandboxEnemies(spawn, playerX) {\r\n  const enemyXs = Array.isArray(spawn.enemies) ? spawn.enemies : [];\r\n  const requiredSandbox = Math.max(2, enemyXs.length || 0);\r\n  const sandboxEnemies = enemies.filter((enemy) => enemy.spawnContext === \"sandbox\");\r\n  const existingSides = new Set(sandboxEnemies.map((enemy) => enemy.spawnSide ?? sandboxEnemies.indexOf(enemy)));\r\n\r\n  for (let side = 0; side < requiredSandbox; side += 1) {\r\n    if (!existingSides.has(side)) {\r\n      const fallback = playerX + (side === 0 ? -320 : 320);\r\n      const spawnX = typeof enemyXs[side] === \"number\" ? enemyXs[side] : fallback;\r\n      const newEnemy = createGruntEnemy(spawnX, { context: \"sandbox\", autoRespawn: true, spawnSide: side, facing: side === 0 ? 1 : -1 });\r\n      enemies.push(newEnemy);\r\n      sandboxEnemies.push(newEnemy);\r\n      existingSides.add(side);\r\n    }\r\n  }\r\n\r\n  for (const enemy of sandboxEnemies) {\r\n    const side = enemy.spawnSide ?? 0;\r\n    const fallback = playerX + (side === 0 ? -320 : 320);\r\n    const spawnX = typeof enemyXs[side] === \"number\" ? enemyXs[side] : fallback;\r\n    const spawnY = spawn.enemyY ?? GROUND_Y - enemy.height;\r\n    enemy.spawnSide = side;\r\n    enemy.spawnContext = \"sandbox\";\r\n    enemy.autoRespawn = true;\r\n    enemy.spawnX = spawnX;\r\n    enemy.spawnY = spawnY;\r\n    enemy.x = spawnX;\r\n    enemy.y = spawnY;\r\n    enemy.vx = 0;\r\n    enemy.vy = 0;\r\n    enemy.health = enemy.maxHealth;\r\n    enemy.invulnerability = 0;\r\n    enemy.flashTimer = 0;\r\n    enemy.shakeTimer = 0;\r\n    enemy.shakeMagnitude = 0;\r\n    enemy.respawnTimer = 0;\r\n    enemy.state = \"patrol\";\r\n    enemy.stateTimer = 1 + Math.random();\r\n    enemy.patrolRange = { min: spawnX - 100, max: spawnX + 220 };\r\n    enemy.onGround = true;\r\n    enemy.facing = side === 0 ? 1 : -1;\r\n  }\r\n}\r\n\r\nfunction applyEnvironmentSpawn(environment) {\r\n  const spawn = environment?.spawn ?? {};\r\n  const playerX = spawn.player?.x ?? getEnvironmentWidth() * 0.5;\r\n  const poseHeight = getTotalHeight(stickman.currentPose ?? POSES.standing);\r\n  const playerY = spawn.player?.y ?? GROUND_Y - poseHeight;\r\n\r\n  stickman.x = playerX;\r\n  stickman.y = playerY;\r\n  stickman.vx = 0;\r\n  stickman.vy = 0;\r\n  stickman.onGround = true;\r\n  stickman.controlMode = \"onFoot\";\r\n  stickman.vehicleId = null;\r\n  stickman.vehicleCandidateId = null;\r\n  stickman.rollTimer = 0;\r\n  stickman.crouching = false;\r\n  stickman.attacking = false;\r\n  stickman.attackIndex = -1;\r\n  stickman.currentAttack = null;\r\n  stickman.attackElapsed = 0;\r\n  stickman.comboWindowOpen = false;\r\n  stickman.comboWindowTimer = 0;\r\n  stickman.nextAttackQueued = false;\r\n  stickman.hitboxSpawned = false;\r\n  stickman.activeHitboxes.length = 0;\r\n  stickman.deadTimer = 0;\r\n  stickman.health = stickman.maxHealth;\r\n  stickman.structureShieldTimer = 0;\r\n  stickman.structureShieldStrength = 0;\r\n  stickman.invulnerability = 0;\r\n\r\n  const offsets = Array.isArray(spawn.squadOffsets) ? spawn.squadOffsets : squadOffsets;\r\n  squadmates.forEach((ally, index) => {\r\n    const offset = offsets[index] ?? (index - 1) * 80;\r\n    const allyX = playerX + offset;\r\n    const allyY = GROUND_Y - getTotalHeight(POSES.standing);\r\n    ally.x = allyX;\r\n    ally.y = allyY;\r\n    ally.vx = 0;\r\n    ally.vy = 0;\r\n    ally.onGround = true;\r\n    ally.state = \"follow\";\r\n    ally.flashTimer = 0;\r\n    ally.highlight = 0;\r\n    ally.structureShieldTimer = 0;\r\n    ally.structureShieldStrength = 0;\r\n  });\r\n\r\n  trainingDummy.x = spawn.trainingDummy?.x ?? getEnvironmentWidth() * 0.75;\r\n  trainingDummy.y = spawn.trainingDummy?.y ?? GROUND_Y - trainingDummy.height;\r\n  trainingDummy.health = trainingDummy.maxHealth;\r\n  trainingDummy.flashTimer = 0;\r\n  trainingDummy.shakeTimer = 0;\r\n  trainingDummy.shakeMagnitude = 0;\r\n  trainingDummy.respawnTimer = 0;\r\n\r\n  ensureSandboxEnemies(spawn, playerX);\r\n}\r\n\r\nfunction removeSandboxEnemies() {\r\n  for (let i = enemies.length - 1; i >= 0; i -= 1) {\r\n    if (enemies[i].spawnContext === \"sandbox\") {\r\n      enemies.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction restoreSandboxEnemies() {\r\n  const spawn = getEnvironmentSpawnSettings();\r\n  const playerX = spawn.player?.x ?? getEnvironmentWidth() * 0.5;\r\n  ensureSandboxEnemies(spawn, playerX);\r\n}\r\n\r\n\r\nonEnvironmentChange((environment) => {\r\n  applyEnvironmentSpawn(environment);\r\n});\r\n\r\nexport {\r\n  stickman,\r\n  trainingDummy,\r\n  enemies,\r\n  squadmates,\r\n  remotePlayers,\r\n  createGruntEnemy,\r\n  createSquadmate,\r\n  upsertRemotePlayer,\r\n  getRemotePlayers,\r\n  pruneRemotePlayers,\r\n  getTotalHeight,\r\n  removeSandboxEnemies,\r\n  restoreSandboxEnemies\r\n};\r\n\r\n\r\n\r\n","import { DEFAULT_LOADOUT, WEAPON_DEFINITIONS } from \"../config/weapons.js\";\r\nimport { stickman } from \"./entities.js\";\r\n\r\nconst weaponState = {\r\n  inventory: [...DEFAULT_LOADOUT],\r\n  activeIndex: 0\r\n};\r\n\r\nfunction isValidIndex(index) {\r\n  return index >= 0 && index < weaponState.inventory.length;\r\n}\r\n\r\nfunction getCurrentWeaponId() {\r\n  return weaponState.inventory[weaponState.activeIndex];\r\n}\r\n\r\nfunction setActiveWeaponByIndex(index) {\r\n  if (!isValidIndex(index)) {\r\n    return false;\r\n  }\r\n  weaponState.activeIndex = index;\r\n  stickman.equippedWeaponId = weaponState.inventory[index];\r\n  return true;\r\n}\r\n\r\nfunction getWeaponInventory() {\r\n  return weaponState.inventory.slice();\r\n}\r\n\r\nfunction addWeaponToInventory(weaponId, { autoEquip = false } = {}) {\r\n  if (!weaponId || !WEAPON_DEFINITIONS[weaponId]) {\r\n    return false;\r\n  }\r\n  let index = weaponState.inventory.indexOf(weaponId);\r\n  if (index === -1) {\r\n    weaponState.inventory.push(weaponId);\r\n    index = weaponState.inventory.length - 1;\r\n  }\r\n  if (autoEquip) {\r\n    setActiveWeaponByIndex(index);\r\n  } else {\r\n    ensureEquippedWeaponValid();\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction getThrowableCount() {\r\n  return weaponState.inventory\r\n    .map((id) => WEAPON_DEFINITIONS?.[id]?.category)\r\n    .filter((category) => category === \"throwable\")\r\n    .length;\r\n}\r\n\r\nfunction ensureEquippedWeaponValid() {\r\n  const existingIndex = weaponState.inventory.indexOf(stickman.equippedWeaponId);\r\n  if (existingIndex >= 0) {\r\n    weaponState.activeIndex = existingIndex;\r\n    return;\r\n  }\r\n\r\n  weaponState.inventory[0] = weaponState.inventory[0] ?? DEFAULT_LOADOUT[0];\r\n  weaponState.activeIndex = 0;\r\n  stickman.equippedWeaponId = weaponState.inventory[0];\r\n}\r\n\r\nensureEquippedWeaponValid();\r\n\r\nexport { weaponState, getCurrentWeaponId, setActiveWeaponByIndex, getWeaponInventory, getThrowableCount, addWeaponToInventory };\r\n","import { WEAPON_DEFINITIONS } from \"../config/weapons.js\";\nimport { stickman } from \"./entities.js\";\n\nconst ammoState = new Map();\n\nfunction ensureAmmoEntry(weaponId) {\n  if (!weaponId) {\n    return null;\n  }\n  const def = WEAPON_DEFINITIONS[weaponId];\n  if (!def) {\n    ammoState.delete(weaponId);\n    return null;\n  }\n\n  const ammoDef = def.ammo;\n  const spreadDef = def.spread;\n\n  const hasAmmo = ammoDef !== undefined;\n  const capacity = hasAmmo ? Math.max(0, ammoDef.magazine ?? 0) : Number.POSITIVE_INFINITY;\n  const reserve = hasAmmo ? Math.max(0, ammoDef.reserve ?? 0) : Number.POSITIVE_INFINITY;\n  const reloadSeconds = hasAmmo ? Math.max(0.1, ammoDef.reloadSeconds ?? 1.2) : 0;\n\n  let entry = ammoState.get(weaponId);\n  if (!entry) {\n    entry = {\n      capacity,\n      magazine: capacity === Number.POSITIVE_INFINITY ? Number.POSITIVE_INFINITY : capacity,\n      reserve,\n      reloadSeconds,\n      reloadTimer: 0,\n      reloading: false,\n      spreadDef: spreadDef ?? null,\n      spread: spreadDef ? { current: spreadDef.base ?? 0 } : null\n    };\n    ammoState.set(weaponId, entry);\n  } else {\n    entry.capacity = capacity;\n    if (capacity === Number.POSITIVE_INFINITY) {\n      entry.magazine = Number.POSITIVE_INFINITY;\n    } else if (!hasAmmo) {\n      entry.magazine = capacity;\n    } else {\n      entry.magazine = Math.min(entry.magazine, capacity);\n    }\n    entry.reserve = reserve;\n    entry.reloadSeconds = reloadSeconds;\n    entry.spreadDef = spreadDef ?? null;\n    if (!entry.spread && spreadDef) {\n      entry.spread = { current: spreadDef.base ?? 0 };\n    }\n    if (!spreadDef) {\n      entry.spread = null;\n    }\n  }\n  return entry;\n}\n\nfunction getAmmoStatus(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry) {\n    return null;\n  }\n  return {\n    magazine: entry.magazine,\n    reserve: entry.reserve,\n    capacity: entry.capacity,\n    reloading: entry.reloading,\n    reloadTimer: entry.reloadTimer,\n    reloadSeconds: entry.reloadSeconds\n  };\n}\n\nfunction consumeAmmo(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry) {\n    return true;\n  }\n  if (entry.capacity === Number.POSITIVE_INFINITY) {\n    return true;\n  }\n  if (entry.reloading) {\n    return false;\n  }\n  if (entry.magazine <= 0) {\n    return false;\n  }\n  entry.magazine -= 1;\n  return true;\n}\n\nfunction startReload(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry) {\n    return false;\n  }\n  if (entry.capacity === Number.POSITIVE_INFINITY) {\n    return false;\n  }\n  if (entry.reloading) {\n    return false;\n  }\n  if (entry.magazine >= entry.capacity) {\n    return false;\n  }\n  if (entry.reserve <= 0) {\n    return false;\n  }\n  entry.reloading = true;\n  entry.reloadTimer = entry.reloadSeconds;\n  if (stickman.equippedWeaponId === weaponId) {\n    stickman.reloading = true;\n  }\n  return true;\n}\n\nfunction cancelReload(weaponId) {\n  const entry = ammoState.get(weaponId);\n  if (!entry) {\n    return;\n  }\n  entry.reloading = false;\n  entry.reloadTimer = 0;\n  if (stickman.equippedWeaponId === weaponId) {\n    stickman.reloading = false;\n  }\n}\n\nfunction registerShot(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  const def = entry?.spreadDef;\n  if (!entry || !def) {\n    return 0;\n  }\n\n  if (!entry.spread) {\n    entry.spread = { current: def.base ?? 0 };\n  }\n  const spreadState = entry.spread;\n  const base = def.base ?? 0;\n  const current = Math.max(base, spreadState.current ?? base);\n  const max = def.max ?? current;\n  const effectiveDegrees = Math.min(max, current);\n  const radians = effectiveDegrees * (Math.PI / 180);\n  const angle = radians > 0 ? (Math.random() * 2 - 1) * radians : 0;\n\n  const perShot = def.perShot ?? 0;\n  spreadState.current = Math.min(max, effectiveDegrees + perShot);\n\n  return angle;\n}\n\nfunction updateAmmoTimers(delta, activeWeaponId) {\n  const completedReloads = [];\n  for (const [weaponId, entry] of ammoState.entries()) {\n    const def = WEAPON_DEFINITIONS[weaponId];\n    if (!def) {\n      ammoState.delete(weaponId);\n      continue;\n    }\n\n    if (entry.reloading) {\n      entry.reloadTimer = Math.max(0, entry.reloadTimer - delta);\n      if (entry.reloadTimer <= 0) {\n        if (entry.capacity !== Number.POSITIVE_INFINITY) {\n          const needed = entry.capacity - entry.magazine;\n          if (needed > 0) {\n            const loaded = Math.min(needed, entry.reserve);\n            entry.magazine += loaded;\n            entry.reserve -= loaded;\n          }\n        }\n        entry.reloading = false;\n        entry.reloadTimer = 0;\n        completedReloads.push(weaponId);\n      }\n    }\n\n    if (entry.spread && entry.spreadDef) {\n      const base = entry.spreadDef.base ?? 0;\n      const recovery = entry.spreadDef.recovery ?? 0;\n      if (recovery > 0) {\n        entry.spread.current = Math.max(base, entry.spread.current - recovery * delta);\n      } else {\n        entry.spread.current = Math.max(base, entry.spread.current ?? base);\n      }\n    }\n  }\n\n  if (activeWeaponId) {\n    const entry = ammoState.get(activeWeaponId);\n    stickman.reloading = entry?.reloading ?? false;\n  } else {\n    stickman.reloading = false;\n  }\n\n  if (typeof window !== \"undefined\") {\n    for (const weaponId of completedReloads) {\n      window.dispatchEvent(new CustomEvent(\"weapon:reload-finish\", { detail: { weaponId } }));\n    }\n  }\n}\n\nfunction refillWeaponAmmo(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry || entry.capacity === Number.POSITIVE_INFINITY) {\n    return;\n  }\n  entry.magazine = entry.capacity;\n  entry.reserve = WEAPON_DEFINITIONS[weaponId]?.ammo?.reserve ?? entry.reserve;\n  entry.reloading = false;\n  entry.reloadTimer = 0;\n}\n\nexport {\n  ensureAmmoEntry,\n  getAmmoStatus,\n  consumeAmmo,\n  startReload,\n  cancelReload,\n  registerShot,\n  updateAmmoTimers,\n  refillWeaponAmmo\n};\r\n\r\n","import { WEAPON_DEFINITIONS } from \"../../config/weapons.js\";\nimport { stickman } from \"../../state/entities.js\";\nimport { weaponState, getCurrentWeaponId, setActiveWeaponByIndex, getWeaponInventory } from \"../../state/weapons.js\";\nimport { getAmmoStatus, ensureAmmoEntry, cancelReload } from \"../../state/ammo.js\";\n\nlet controlsInitialized = false;\n\nconst previousWeaponState = {\n  id: stickman.equippedWeaponId\n};\n\nequipWeaponIndex(weaponState.activeIndex);\n\nfunction getWeaponDefinitionById(id) {\n  return WEAPON_DEFINITIONS[id];\n}\n\nfunction getCurrentWeapon() {\n  const weaponId = getCurrentWeaponId();\n  return getWeaponDefinitionById(weaponId) ?? null;\n}\n\nfunction equipWeaponIndex(index) {\n  const previousId = stickman.equippedWeaponId;\n  if (!setActiveWeaponByIndex(index)) {\n    return false;\n  }\n  if (previousId && previousId !== stickman.equippedWeaponId) {\n    cancelReload(previousId);\n  }\n\n  ensureAmmoEntry(stickman.equippedWeaponId);\n\n  stickman.attacking = false;\n  stickman.currentAttack = null;\n  stickman.attackElapsed = 0;\n  stickman.comboWindowOpen = false;\n  stickman.comboWindowTimer = 0;\n  stickman.attackIndex = -1;\n  stickman.hitboxSpawned = false;\n\n  const ammoStatus = getAmmoStatus(stickman.equippedWeaponId);\n  stickman.reloading = ammoStatus?.reloading ?? false;\n\n  previousWeaponState.id = stickman.equippedWeaponId;\n  return true;\n}\n\nfunction equipWeaponBySlot(slotNumber) {\n  const index = slotNumber - 1;\n  equipWeaponIndex(index);\n}\n\nfunction getSlotFromCode(code) {\n  if (code.startsWith(\"Digit\")) {\n    return Number.parseInt(code.slice(5), 10);\n  }\n  if (code.startsWith(\"Numpad\")) {\n    return Number.parseInt(code.slice(6), 10);\n  }\n  return Number.NaN;\n}\n\nfunction handleWeaponKey(event) {\n  const slot = getSlotFromCode(event.code);\n  if (!Number.isNaN(slot) && slot >= 1) {\n    equipWeaponBySlot(slot);\n    event.preventDefault();\n  }\n}\n\nfunction initializeWeaponControls() {\n  if (controlsInitialized) {\n    return;\n  }\n  window.addEventListener(\"keydown\", handleWeaponKey);\n  controlsInitialized = true;\n}\n\nfunction getWeaponSlots() {\n  return getWeaponInventory().map((id) => WEAPON_DEFINITIONS[id] ?? { id, name: \"Unknown\" });\n}\n\nexport {\n  getCurrentWeapon,\n  getWeaponDefinitionById,\n  equipWeaponBySlot,\n  initializeWeaponControls,\n  getWeaponSlots\n};\r\n","let audioContext = null;\r\nlet initialized = false;\r\nconst lastTriggers = new Map();\r\n\r\nconst EVENT_SOUND_MAP = {\r\n  \"weapon:shot-fired\": { frequency: () => 880 + Math.random() * 220, duration: 0.08, gain: 0.05, shape: \"square\", cooldown: 40 },\r\n  \"weapon:muzzle-flash\": { frequency: () => 760 + Math.random() * 120, duration: 0.06, gain: 0.045, shape: \"sawtooth\", cooldown: 35 },\r\n  \"weapon:reload-start\": { frequency: 210, duration: 0.18, gain: 0.08, shape: \"triangle\", cooldown: 120 },\r\n  \"weapon:reload-finish\": { frequency: 320, duration: 0.16, gain: 0.09, shape: \"triangle\", cooldown: 120 },\r\n  \"weapon:recoil-kick\": { frequency: (detail) => 480 + (detail?.recoil?.horizontal ?? 0) * 60, duration: 0.12, gain: 0.045, shape: \"sine\", cooldown: 90 },\r\n  \"shield:hit\": { frequency: 140, duration: 0.22, gain: 0.1, shape: \"sine\", cooldown: 140 },\r\n  \"shield:shatter\": { frequency: 90, duration: 0.4, gain: 0.14, shape: \"sawtooth\", cooldown: 260 },\r\n  \"shield:end\": { frequency: 260, duration: 0.16, gain: 0.05, shape: \"triangle\", cooldown: 200 },\r\n  \"throwable:explosion\": { frequency: 180, duration: 0.35, gain: 0.12, shape: \"sawtooth\", cooldown: 240 },\r\n  \"throwable:flash-burst\": { frequency: () => 960 + Math.random() * 180, duration: 0.18, gain: 0.07, shape: \"triangle\", cooldown: 220 },\r\n  \"throwable:smoke-detonate\": { frequency: 220, duration: 0.32, gain: 0.055, shape: \"sine\", cooldown: 260 },\r\n  \"throwable:smoke-dissipate\": { frequency: 150, duration: 0.36, gain: 0.035, shape: \"sine\", cooldown: 320 },\r\n};\r\n\r\nfunction ensureAudioContext() {\r\n  if (audioContext || typeof window === \"undefined\") {\r\n    return audioContext;\r\n  }\r\n  const AudioCtor = window.AudioContext || window.webkitAudioContext;\r\n  if (!AudioCtor) {\r\n    return null;\r\n  }\r\n  audioContext = new AudioCtor();\r\n  return audioContext;\r\n}\r\n\r\nfunction resumeAudio() {\r\n  if (!audioContext) {\r\n    return;\r\n  }\r\n  if (audioContext.state === \"suspended\" && typeof audioContext.resume === \"function\") {\r\n    audioContext.resume().catch(() => {\r\n      /* ignore resume issues */\r\n    });\r\n  }\r\n}\r\n\r\nfunction scheduleTone(config, detail) {\r\n  const ctx = ensureAudioContext();\r\n  if (!ctx) {\r\n    return;\r\n  }\r\n  resumeAudio();\r\n\r\n  const now = performance.now();\r\n  const cooldown = config.cooldown ?? 80;\r\n  const key = config;\r\n  const last = lastTriggers.get(key) ?? 0;\r\n  if (now - last < cooldown) {\r\n    return;\r\n  }\r\n  lastTriggers.set(key, now);\r\n\r\n  const osc = ctx.createOscillator();\r\n  osc.type = config.shape ?? \"sine\";\r\n  const baseFrequency = typeof config.frequency === \"function\" ? config.frequency(detail) : config.frequency;\r\n  osc.frequency.setValueAtTime(Math.max(40, baseFrequency ?? 440), ctx.currentTime);\r\n\r\n  const gainNode = ctx.createGain();\r\n  const baseGain = Math.max(0.001, config.gain ?? 0.05);\r\n  const rampDuration = Math.max(0.05, config.duration ?? 0.12);\r\n  gainNode.gain.setValueAtTime(baseGain, ctx.currentTime);\r\n  gainNode.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + rampDuration);\r\n\r\n  osc.connect(gainNode);\r\n  gainNode.connect(ctx.destination);\r\n\r\n  osc.start();\r\n  osc.stop(ctx.currentTime + rampDuration);\r\n}\r\n\r\nfunction bindAudio(eventName) {\r\n  const config = EVENT_SOUND_MAP[eventName];\r\n  if (!config) {\r\n    return;\r\n  }\r\n  window.addEventListener(eventName, (event) => {\r\n    scheduleTone(config, event?.detail ?? {});\r\n  });\r\n}\r\n\r\nfunction primeAudioContext() {\r\n  resumeAudio();\r\n  window.removeEventListener(\"pointerdown\", primeAudioContext);\r\n  window.removeEventListener(\"keydown\", primeAudioContext);\r\n}\r\n\r\nfunction initializePlaceholderAudio() {\r\n  if (initialized || typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  initialized = true;\r\n  ensureAudioContext();\r\n  Object.keys(EVENT_SOUND_MAP).forEach(bindAudio);\r\n  window.addEventListener(\"pointerdown\", primeAudioContext);\r\n  window.addEventListener(\"keydown\", primeAudioContext);\r\n}\r\n\r\nexport { initializePlaceholderAudio };\r\n","\r\nfunction getP2P() {\r\n  if (typeof window === \"undefined\" || !window.P2P) {\r\n    const error = new Error(\"P2P module not loaded\");\r\n    error.code = \"P2P_NOT_AVAILABLE\";\r\n    throw error;\r\n  }\r\n  return window.P2P;\r\n}\r\nimport { GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { stickman, remotePlayers, upsertRemotePlayer, pruneRemotePlayers, getTotalHeight } from \"../../state/entities.js\";\r\n\r\nconst peerId = `peer-${Math.random().toString(36).slice(2, 8)}`;\r\nlet peerConnection = null;\r\nlet outboundChannel = null;\r\nlet inboundChannel = null;\r\nlet lastSendTime = 0;\r\nlet connectionStatus = \"disconnected\";\r\nlet localDescriptionString = null;\r\nconst localCandidates = [];\r\n\r\nfunction ensurePeerConnection() {\r\n  if (peerConnection || typeof window === \"undefined\" || !window.RTCPeerConnection) {\r\n    return peerConnection;\r\n  }\r\n  peerConnection = new RTCPeerConnection({ iceServers: [] });\r\n  connectionStatus = \"connecting\";\r\n\r\n  outboundChannel = peerConnection.createDataChannel(\"stickman\", { ordered: true });\r\n  setupDataChannel(outboundChannel);\r\n\r\n  peerConnection.addEventListener(\"icecandidate\", (event) => {\r\n    if (event.candidate) {\r\n      localCandidates.push(JSON.stringify(event.candidate));\r\n    }\r\n  });\r\n\r\n  peerConnection.addEventListener(\"connectionstatechange\", () => {\r\n    connectionStatus = peerConnection.connectionState ?? \"unknown\";\r\n  });\r\n\r\n  peerConnection.addEventListener(\"datachannel\", (event) => {\r\n    inboundChannel = event.channel;\r\n    setupDataChannel(inboundChannel);\r\n  });\r\n\r\n  return peerConnection;\r\n}\r\n\r\nfunction setupDataChannel(channel) {\r\n  if (!channel) {\r\n    return;\r\n  }\r\n  channel.addEventListener(\"open\", () => {\r\n    connectionStatus = \"connected\";\r\n  });\r\n  channel.addEventListener(\"close\", () => {\r\n    connectionStatus = \"disconnected\";\r\n  });\r\n  channel.addEventListener(\"message\", (event) => {\r\n    try {\r\n      const payload = JSON.parse(event.data);\r\n      handleIncomingMessage(payload);\r\n    } catch (error) {\r\n      console.warn(\"Failed to parse P2P payload\", error);\r\n    }\r\n  });\r\n}\r\n\r\nfunction handleIncomingMessage(payload) {\r\n  if (!payload || typeof payload !== \"object\") {\r\n    return;\r\n  }\r\n  switch (payload.type) {\r\n    case \"playerState\":\r\n      upsertRemotePlayer({\r\n        id: payload.id,\r\n        name: payload.name,\r\n        x: payload.x,\r\n        y: payload.y,\r\n        facing: payload.facing,\r\n        commandId: payload.commandId\r\n      });\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n}\r\n\r\nasync function createOffer() {\r\n  ensurePeerConnection();\r\n  const offer = await peerConnection.createOffer();\r\n  await peerConnection.setLocalDescription(offer);\r\n  localDescriptionString = JSON.stringify(offer);\r\n  return localDescriptionString;\r\n}\r\n\r\nasync function createAnswer(remoteDescriptionString) {\r\n  ensurePeerConnection();\r\n  const description = JSON.parse(remoteDescriptionString);\r\n  await peerConnection.setRemoteDescription(new RTCSessionDescription(description));\r\n  const answer = await peerConnection.createAnswer();\r\n  await peerConnection.setLocalDescription(answer);\r\n  localDescriptionString = JSON.stringify(answer);\r\n  return localDescriptionString;\r\n}\r\n\r\nasync function acceptRemoteDescription(remoteDescriptionString) {\r\n  ensurePeerConnection();\r\n  const description = JSON.parse(remoteDescriptionString);\r\n  await peerConnection.setRemoteDescription(new RTCSessionDescription(description));\r\n}\r\n\r\nasync function addRemoteCandidate(candidateString) {\r\n  if (!candidateString) {\r\n    return;\r\n  }\r\n  ensurePeerConnection();\r\n  const candidate = new RTCIceCandidate(JSON.parse(candidateString));\r\n  await peerConnection.addIceCandidate(candidate);\r\n}\r\n\r\nfunction getLocalDescription() {\r\n  return localDescriptionString;\r\n}\r\n\r\nfunction getLocalCandidates() {\r\n  return [...localCandidates];\r\n}\r\n\r\nfunction getConnectionStatus() {\r\n  return connectionStatus;\r\n}\r\n\r\nfunction updateP2P(delta) {\r\n  pruneRemotePlayers();\r\n  ensurePeerConnection();\r\n  if (!outboundChannel || outboundChannel.readyState !== \"open\") {\r\n    return;\r\n  }\r\n  const now = (typeof performance !== \"undefined\" ? performance.now() : Date.now());\r\n  if (now - lastSendTime < 60) {\r\n    return;\r\n  }\r\n  lastSendTime = now;\r\n  const payload = {\r\n    type: \"playerState\",\r\n    id: peerId,\r\n    name: \"Remote\",\r\n    x: stickman.x,\r\n    y: stickman.y,\r\n    facing: stickman.facing,\r\n    commandId: stickman.squadCommandId\r\n  };\r\n  try {\r\n    outboundChannel.send(JSON.stringify(payload));\r\n  } catch {\r\n    // ignore send errors\r\n  }\r\n}\r\n\r\nfunction initializeP2PNetworking() {\r\n  ensurePeerConnection();\r\n  if (typeof window !== \"undefined\") {\r\n    window.P2P = {\r\n      createOffer,\r\n      createAnswer,\r\n      acceptRemoteDescription,\r\n      addRemoteCandidate,\r\n      getLocalDescription,\r\n      getLocalCandidates,\r\n      getStatus: getP2PStatus,\r\n      close: closeConnection\r\n    };\r\n  }\r\n}\r\n\r\nfunction closeConnection() {\r\n  if (outboundChannel) {\r\n    outboundChannel.close();\r\n    outboundChannel = null;\r\n  }\r\n  if (inboundChannel) {\r\n    inboundChannel.close();\r\n    inboundChannel = null;\r\n  }\r\n  if (peerConnection) {\r\n    peerConnection.close();\r\n    peerConnection = null;\r\n  }\r\n  connectionStatus = \"disconnected\";\r\n}\r\n\r\nfunction getP2PStatus() {\r\n  return {\r\n    id: peerId,\r\n    status: connectionStatus,\r\n    localDescription: localDescriptionString,\r\n    localCandidates: [...localCandidates]\r\n  };\r\n}\r\n\r\nfunction getRemotePlayersList() {\r\n  return Array.from(remotePlayers.values());\r\n}\r\n\r\nexport { initializeP2PNetworking, updateP2P, getP2PStatus, getRemotePlayersList, getP2P };\r\n","const NETWORK_CONFIG = {\n  serverApiBase: \"https://projectstickfightinggame.onrender.com\",\n  refreshIntervalMs: 15000,\n  heartbeatIntervalMs: 45000,\n  hostTtlSeconds: 150,\n  hostSecret: \"sk-stickman-host-123456789987654321\", // set this to match SERVER_SECRET on Render\n  hostName: \"ProjectStickFightingGame Lobby\",\n  defaultRegion: \"na-west\"\n};\n\nexport { NETWORK_CONFIG };\n","import { NETWORK_CONFIG } from \"../config/network.js\";\r\n\r\nconst serverBrowserState = {\r\n  servers: [],\r\n  visible: false,\r\n  selectedIndex: 0,\r\n  lastFetch: 0,\r\n  fetching: false,\r\n  error: null,\r\n  statusMessage: null,\r\n  hosting: false,\r\n  hostingSessionId: null,\r\n  hostingLastHeartbeat: 0,\r\n  hostingExpiresAt: 0,\r\n  joinStatus: null,\r\n  joinError: null,\r\n  hostingMetrics: {\r\n    playerCount: 1,\r\n    enemyCount: 0,\r\n    alliesCount: 0\r\n  },\r\n  p2p: {\r\n    offer: null,\r\n    answer: null,\r\n    pendingOffer: false,\r\n    pendingAnswer: false,\r\n    pendingCandidates: false,\r\n    localCandidates: [],\r\n    remoteCandidates: [],\r\n    error: null\r\n  }\r\n};\r\n\r\nfunction getServerBrowserState() {\r\n  return serverBrowserState;\r\n}\r\n\r\nfunction setVisible(visible) {\r\n  serverBrowserState.visible = visible;\r\n  if (!visible) {\r\n    serverBrowserState.statusMessage = null;\r\n    serverBrowserState.error = null;\r\n  }\r\n}\r\n\r\nfunction toggleVisible() {\r\n  setVisible(!serverBrowserState.visible);\r\n}\r\n\r\nfunction setServers(list) {\r\n  const previousSelection = serverBrowserState.servers[serverBrowserState.selectedIndex]?.id;\r\n  serverBrowserState.servers = Array.isArray(list) ? list : [];\r\n  if (previousSelection) {\r\n    const matchedIndex = serverBrowserState.servers.findIndex((server) => server.id === previousSelection);\r\n    if (matchedIndex >= 0) {\r\n      serverBrowserState.selectedIndex = matchedIndex;\r\n    }\r\n  }\r\n  if (serverBrowserState.selectedIndex >= serverBrowserState.servers.length) {\r\n    serverBrowserState.selectedIndex = Math.max(0, serverBrowserState.servers.length - 1);\r\n  }\r\n}\r\n\r\nfunction setError(message) {\r\n  serverBrowserState.error = message;\r\n}\r\n\r\nfunction setStatusMessage(message) {\r\n  serverBrowserState.statusMessage = message;\r\n}\r\n\r\nfunction setJoinStatus(message) {\r\n  serverBrowserState.joinStatus = message;\r\n}\r\n\r\nfunction setJoinError(message) {\r\n  serverBrowserState.joinError = message;\r\n}\r\n\r\nfunction setJoinedSessionId(id) {\r\n  serverBrowserState.joinedSessionId = id ?? null;\r\n}\r\n\r\nfunction selectNext(delta) {\r\n  if (serverBrowserState.servers.length === 0) {\r\n    return;\r\n  }\r\n  serverBrowserState.selectedIndex = (serverBrowserState.selectedIndex + delta + serverBrowserState.servers.length) % serverBrowserState.servers.length;\r\n}\r\n\r\nfunction recordFetchTimestamp(timestamp) {\r\n  serverBrowserState.lastFetch = timestamp;\r\n}\r\n\r\nfunction setFetching(fetching) {\r\n  serverBrowserState.fetching = fetching;\r\n}\r\n\r\nfunction setHostingSession({ id, expiresAt }) {\r\n  serverBrowserState.hosting = Boolean(id);\r\n  serverBrowserState.hostingSessionId = id ?? null;\r\n  serverBrowserState.hostingLastHeartbeat = performance.now();\r\n  serverBrowserState.hostingExpiresAt = expiresAt ?? 0;\r\n}\r\n\r\nfunction updateHostingHeartbeatTimestamp(timestamp) {\r\n  serverBrowserState.hostingLastHeartbeat = timestamp;\r\n}\r\n \r\nfunction clearHosting() {\r\n  serverBrowserState.hosting = false;\r\n  serverBrowserState.hostingSessionId = null;\r\n  serverBrowserState.hostingExpiresAt = 0;\r\n  serverBrowserState.hostingLastHeartbeat = 0;\r\n  clearP2PState();\r\n}\r\nfunction setHostingMetrics(metrics = {}) {\r\n  if (Number.isFinite(metrics.playerCount)) {\r\n    serverBrowserState.hostingMetrics.playerCount = Math.max(1, Math.round(metrics.playerCount));\r\n  }\r\n  if (Number.isFinite(metrics.enemyCount)) {\r\n    serverBrowserState.hostingMetrics.enemyCount = Math.max(0, Math.round(metrics.enemyCount));\r\n  }\r\n  if (Number.isFinite(metrics.alliesCount)) {\r\n    serverBrowserState.hostingMetrics.alliesCount = Math.max(0, Math.round(metrics.alliesCount));\r\n  }\r\n}\r\n\r\nfunction setP2POffer(offer) {\r\n  serverBrowserState.p2p.offer = offer ?? null;\r\n}\r\n\r\nfunction setP2PAnswer(answer) {\r\n  serverBrowserState.p2p.answer = answer ?? null;\r\n}\r\n\r\nfunction setP2PLocalCandidates(candidates) {\r\n  if (!Array.isArray(candidates)) {\r\n    candidates = [];\r\n  }\r\n  const next = candidates.slice();\r\n  const current = serverBrowserState.p2p.localCandidates || [];\r\n  if (current.length === next.length && current.every((value, index) => value === next[index])) {\r\n    return;\r\n  }\r\n  serverBrowserState.p2p.localCandidates = next;\r\n}\r\n \r\nfunction setP2PRemoteCandidates(candidates) {\r\n  if (!Array.isArray(candidates)) {\r\n    candidates = [];\r\n  }\r\n  const next = candidates.slice();\r\n  const current = serverBrowserState.p2p.remoteCandidates || [];\r\n  if (current.length === next.length && current.every((value, index) => value === next[index])) {\r\n    return;\r\n  }\r\n  serverBrowserState.p2p.remoteCandidates = next;\r\n}\r\n\r\nfunction setP2PError(message) {\r\n  serverBrowserState.p2p.error = message ?? null;\r\n}\r\nfunction setP2PPending({ offer, answer, candidates }) {\r\n  if (typeof offer === \"boolean\") {\r\n    serverBrowserState.p2p.pendingOffer = offer;\r\n  }\r\n  if (typeof answer === \"boolean\") {\r\n    serverBrowserState.p2p.pendingAnswer = answer;\r\n  }\r\n  if (typeof candidates === \"boolean\") {\r\n    serverBrowserState.p2p.pendingCandidates = candidates;\r\n  }\r\n}\r\n\r\nfunction clearP2PState() {\r\n  serverBrowserState.p2p.offer = null;\r\n  serverBrowserState.p2p.answer = null;\r\n  serverBrowserState.p2p.pendingOffer = false;\r\n  serverBrowserState.p2p.pendingAnswer = false;\r\n  serverBrowserState.p2p.pendingCandidates = false;\r\n  serverBrowserState.p2p.localCandidates = [];\r\n  serverBrowserState.p2p.remoteCandidates = [];\r\n  serverBrowserState.p2p.error = null;\r\n}\r\n\r\nexport {\r\n  serverBrowserState,\r\n  getServerBrowserState,\r\n  setVisible,\r\n  toggleVisible,\r\n  setServers,\r\n  setError,\r\n  setStatusMessage,\r\n  setJoinStatus,\r\n  setJoinError,\r\n  setJoinedSessionId,\r\n  selectNext,\r\n  recordFetchTimestamp,\r\n  setFetching,\r\n  setHostingSession,\r\n  updateHostingHeartbeatTimestamp,\r\n  clearHosting,\r\n  setHostingMetrics,\r\n  setP2POffer,\r\n  setP2PAnswer,\r\n  setP2PLocalCandidates,\r\n  setP2PRemoteCandidates,\r\n  setP2PPending,\r\n  setP2PError,\r\n  clearP2PState\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { canvas, GROUND_Y } from \"../environment/canvas.js\";\nimport { getEnvironmentWidth } from \"./environment.js\";\r\n\r\nfunction clamp(value, min, max) {\r\n  return Math.max(min, Math.min(max, value));\r\n}\r\n\r\nconst VEHICLE_DEFINITIONS = {\r\n  buggy: {\r\n    label: \"Recon Buggy\",\r\n    movementType: \"ground\",\r\n    width: 132,\r\n    height: 48,\r\n    wheelRadius: 18,\r\n    wheelBase: 76,\r\n    driverSeat: { x: -6, y: 42 },\r\n    exitOffsets: [\r\n      { x: 72, y: 0 },\r\n      { x: -72, y: 0 }\r\n    ],\r\n    enterRadius: 96,\r\n    acceleration: 540,\r\n    braking: 880,\r\n    maxSpeed: 420,\r\n    idleDrag: 320,\r\n    airDrag: 0.92,\r\n    baseHealth: 280,\r\n    colorBody: \"#2e3147\",\r\n    colorAccent: \"#ffb84d\",\r\n    colorDetail: \"#f7f9ff\"\r\n  },\r\n  raptorHeli: {\r\n    label: \"Raptor Helicopter\",\r\n    movementType: \"air\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"raptorHeli.noseCannon\",\r\n        label: \"Nose Cannon\",\r\n        binding: \"primary\",\r\n        offset: { x: 32, y: 2 },\r\n        muzzles: [\r\n          { x: 46, y: -3 },\r\n          { x: 46, y: 3 }\r\n        ],\r\n        projectile: {\r\n          speed: 720,\r\n          damage: 14,\r\n          radius: 4,\r\n          color: \"#8cf4ff\",\r\n          gravityFactor: 0.04,\r\n          knockback: 70\r\n        },\r\n        scatter: 3.5,\r\n        fireInterval: 0.1,\r\n        flashDuration: 0.07,\r\n        flashRadius: 12,\r\n        barrelLength: 52,\r\n        barrelWidth: 5,\r\n        barrelColor: \"#8cf4ff\"\r\n      }\r\n    ],\r\n    width: 156,\r\n    height: 54,\r\n    driverSeat: { x: 6, y: 44 },\r\n    exitOffsets: [\r\n      { x: 88, y: 0 },\r\n      { x: -88, y: 0 }\r\n    ],\r\n    enterRadius: 128,\r\n    horizontalAcceleration: 320,\r\n    horizontalMaxSpeed: 300,\r\n    horizontalDrag: 180,\r\n    idleDrag: 140,\r\n    airDrag: 0.98,\r\n    liftPower: 880,\r\n    descendPower: 620,\r\n    gravityScale: 0.3,\r\n    maxVerticalSpeed: 240,\r\n    verticalDamping: 0.9,\r\n    hoverMinAltitude: 28,\r\n    hoverMaxAltitude: 260,\r\n    spawnHover: 60,\r\n    autopilotStrength: 5.2,\r\n    baseHealth: 420,\r\n    colorBody: \"#303952\",\r\n    colorAccent: \"#8cf4ff\",\r\n    colorDetail: \"#f4fbff\",\r\n    rotorSpan: 210,\r\n    rotorThickness: 7,\r\n    tailLength: 86\r\n  },\r\n  arrowJet: {\r\n    label: \"Arrow Fighter\",\r\n    movementType: \"air\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"arrowJet.rackRockets\",\r\n        label: \"Wing Rockets\",\r\n        binding: \"secondary\",\r\n        offset: { x: 12, y: -6 },\r\n        muzzles: [\r\n          { x: 52, y: -12 },\r\n          { x: 52, y: 12 }\r\n        ],\r\n        projectile: {\r\n          speed: 780,\r\n          damage: 24,\r\n          radius: 6,\r\n          color: \"#ff6b80\",\r\n          gravityFactor: 0.05,\r\n          knockback: 140\r\n        },\r\n        scatter: 4,\r\n        fireInterval: 0.28,\r\n        flashDuration: 0.09,\r\n        flashRadius: 15,\r\n        barrelLength: 54,\r\n        barrelWidth: 5,\r\n        barrelColor: \"#ff6b80\"\r\n      }\r\n    ],\r\n    width: 180,\r\n    height: 36,\r\n    driverSeat: { x: 0, y: 32 },\r\n    exitOffsets: [\r\n      { x: 96, y: -8 },\r\n      { x: -96, y: -8 }\r\n    ],\r\n    enterRadius: 140,\r\n    horizontalAcceleration: 520,\r\n    horizontalMaxSpeed: 520,\r\n    horizontalDrag: 120,\r\n    idleDrag: 80,\r\n    airDrag: 0.99,\r\n    liftPower: 780,\r\n    descendPower: 540,\r\n    gravityScale: 0.42,\r\n    maxVerticalSpeed: 280,\r\n    verticalDamping: 0.92,\r\n    hoverMinAltitude: 80,\r\n    hoverMaxAltitude: 360,\r\n    spawnHover: 120,\r\n    autopilotStrength: 3.8,\r\n    baseHealth: 350,\r\n    colorBody: \"#262c3e\",\r\n    colorAccent: \"#ff6b80\",\r\n    colorDetail: \"#f8f8ff\",\r\n    wingSpan: 230\r\n  },\r\n  tideSkiff: {\r\n    label: \"Tide Skiff\",\r\n    movementType: \"water\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"tideSkiff.prowCannon\",\r\n        label: \"Prow Cannon\",\r\n        binding: \"primary\",\r\n        offset: { x: 28, y: -18 },\r\n        muzzles: [\r\n          { x: 36, y: -4 }\r\n        ],\r\n        projectile: {\r\n          speed: 560,\r\n          damage: 18,\r\n          radius: 6,\r\n          color: \"#ffdd8a\",\r\n          gravityFactor: 0.08,\r\n          knockback: 110\r\n        },\r\n        scatter: 2.5,\r\n        fireInterval: 0.22,\r\n        flashDuration: 0.1,\r\n        flashRadius: 14,\r\n        barrelLength: 46,\r\n        barrelWidth: 6,\r\n        barrelColor: \"#5fd3ff\"\r\n      }\r\n    ],\r\n    width: 150,\r\n    height: 42,\r\n    driverSeat: { x: -10, y: 34 },\r\n    exitOffsets: [\r\n      { x: 92, y: -4 },\r\n      { x: -92, y: -4 }\r\n    ],\r\n    enterRadius: 120,\r\n    waterSurfaceOffset: 28,\r\n    waterAcceleration: 260,\r\n    waterMaxSpeed: 240,\r\n    waterReverseSpeed: 140,\r\n    waterIdleDrag: 180,\r\n    turnDrag: 220,\r\n    bobAmplitude: 6,\r\n    bobSpeed: 1.5,\r\n    buoyancyPoint: 0.58,\r\n    splashIntensity: 0.4,\r\n    baseHealth: 320,\r\n    colorBody: \"#1f2e3f\",\r\n    colorAccent: \"#5fd3ff\",\r\n    colorDetail: \"#f5fbff\"\r\n  },\r\n  stormBarge: {\r\n    label: \"Storm Barge\",\r\n    movementType: \"water\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"stormBarge.deckChaingun\",\r\n        label: \"Deck Chaingun\",\r\n        binding: \"primary\",\r\n        offset: { x: 18, y: -24 },\r\n        muzzles: [\r\n          { x: 58, y: -6 },\r\n          { x: 58, y: 6 }\r\n        ],\r\n        projectile: {\r\n          speed: 620,\r\n          damage: 16,\r\n          radius: 5,\r\n          color: \"#ffc86d\",\r\n          gravityFactor: 0.06,\r\n          knockback: 90\r\n        },\r\n        scatter: 5,\r\n        fireInterval: 0.12,\r\n        flashDuration: 0.08,\r\n        flashRadius: 16,\r\n        barrelLength: 58,\r\n        barrelWidth: 6,\r\n        barrelColor: \"#ffa94d\"\r\n      }\r\n    ],\r\n    width: 200,\r\n    height: 60,\r\n    driverSeat: { x: 14, y: 46 },\r\n    exitOffsets: [\r\n      { x: 110, y: -6 },\r\n      { x: -110, y: -6 }\r\n    ],\r\n    enterRadius: 132,\r\n    waterSurfaceOffset: 32,\r\n    waterAcceleration: 180,\r\n    waterMaxSpeed: 180,\r\n    waterReverseSpeed: 110,\r\n    waterIdleDrag: 260,\r\n    turnDrag: 320,\r\n    bobAmplitude: 4,\r\n    bobSpeed: 1.2,\r\n    buoyancyPoint: 0.62,\r\n    splashIntensity: 0.3,\r\n    baseHealth: 480,\r\n    colorBody: \"#232f3a\",\r\n    colorAccent: \"#ffa94d\",\r\n    colorDetail: \"#f0f4ff\"\r\n  },\r\n  abyssSub: {\r\n    label: \"Abyss Sub\",\r\n    movementType: \"water\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"abyssSub.torpedoLauncher\",\r\n        label: \"Twin Torpedoes\",\r\n        binding: \"secondary\",\r\n        offset: { x: 12, y: -10 },\r\n        muzzles: [\r\n          { x: 40, y: -6 },\r\n          { x: 40, y: 6 }\r\n        ],\r\n        projectile: {\r\n          speed: 480,\r\n          damage: 28,\r\n          radius: 7,\r\n          color: \"#8c9eff\",\r\n          gravityFactor: 0.02,\r\n          knockback: 160\r\n        },\r\n        scatter: 1.5,\r\n        fireInterval: 0.6,\r\n        flashDuration: 0.12,\r\n        flashRadius: 18,\r\n        barrelLength: 48,\r\n        barrelWidth: 7,\r\n        barrelColor: \"#8c9eff\"\r\n      }\r\n    ],\r\n    width: 132,\r\n    height: 48,\r\n    driverSeat: { x: 0, y: 36 },\r\n    exitOffsets: [\r\n      { x: 78, y: -10 },\r\n      { x: -78, y: -10 }\r\n    ],\r\n    enterRadius: 110,\r\n    waterSurfaceOffset: 36,\r\n    waterAcceleration: 300,\r\n    waterMaxSpeed: 260,\r\n    waterReverseSpeed: 160,\r\n    waterIdleDrag: 210,\r\n    turnDrag: 240,\r\n    bobAmplitude: 3,\r\n    bobSpeed: 1.1,\r\n    buoyancyPoint: 0.5,\r\n    submergedOffset: 18,\r\n    splashIntensity: 0.2,\r\n    baseHealth: 360,\r\n    colorBody: \"#182733\",\r\n    colorAccent: \"#8c9eff\",\r\n    colorDetail: \"#e9f1ff\"\r\n  },\r\n  scoutDrone: {\r\n    label: \"Scout Drone\",\r\n    movementType: \"air\",\r\n    width: 72,\r\n    height: 28,\r\n    driverSeat: { x: 0, y: 20 },\r\n    exitOffsets: [\r\n      { x: 48, y: 0 },\r\n      { x: -48, y: 0 }\r\n    ],\r\n    enterRadius: 90,\r\n    horizontalAcceleration: 280,\r\n    horizontalMaxSpeed: 260,\r\n    horizontalDrag: 220,\r\n    idleDrag: 200,\r\n    airDrag: 0.95,\r\n    liftPower: 660,\r\n    descendPower: 520,\r\n    gravityScale: 0.26,\r\n    maxVerticalSpeed: 200,\r\n    verticalDamping: 0.88,\r\n    hoverMinAltitude: 24,\r\n    hoverMaxAltitude: 220,\r\n    spawnHover: 48,\r\n    autopilotStrength: 6.2,\r\n    baseHealth: 180,\r\n    colorBody: \"#293444\",\r\n    colorAccent: \"#ffe066\",\r\n    colorDetail: \"#edf4ff\"\r\n  }\r\n};\r\n\r\nlet vehicleCounter = 0;\r\n\r\nfunction createVehicle(type, x, options = {}) {\r\n  const definition = VEHICLE_DEFINITIONS[type];\r\n  if (!definition) {\r\n    throw new Error(`Unknown vehicle type: ${type}`);\r\n  }\r\n\r\n  const movementType = definition.movementType ?? \"ground\";\r\n  const minX = definition.width * 0.5;\r\n  const envWidth = getEnvironmentWidth();\n  const maxX = Math.max(minX, envWidth - definition.width * 0.5);\r\n  const centerX = clamp(x ?? envWidth * 0.5, minX, maxX);\r\n\r\n  let top;\r\n  let onGround = true;\r\n  let waterLineY = null;\r\n  let preferredAltitude = options.hover ?? definition.spawnHover ?? 0;\r\n\r\n  if (movementType === \"air\") {\r\n    const minAltitude = definition.hoverMinAltitude ?? 0;\r\n    const maxAltitude = definition.hoverMaxAltitude ?? minAltitude;\r\n    const altitude = clamp(preferredAltitude, minAltitude, maxAltitude);\r\n    top = GROUND_Y - definition.height - altitude;\r\n    onGround = false;\r\n    preferredAltitude = altitude;\r\n  } else if (movementType === \"water\") {\r\n    const surfaceOffset = definition.waterSurfaceOffset ?? 24;\r\n    waterLineY = GROUND_Y - surfaceOffset;\r\n    const buoyancyPoint = clamp(definition.buoyancyPoint ?? 0.55, 0.2, 0.9);\r\n    const submergedOffset = definition.submergedOffset ?? 0;\r\n    top = waterLineY - definition.height * buoyancyPoint + submergedOffset;\r\n    onGround = false;\r\n    preferredAltitude = 0;\r\n  } else {\r\n    top = GROUND_Y - definition.height;\r\n  }\r\n\r\n  const vehicle = {\r\n    id: `vehicle-${type}-${vehicleCounter += 1}`,\r\n    type,\r\n    x: centerX,\r\n    y: top,\r\n    vx: 0,\r\n    vy: 0,\r\n    tilt: 0,\r\n    facing: 1,\r\n    driverId: null,\r\n    health: definition.baseHealth,\r\n    maxHealth: definition.baseHealth,\r\n    enterCooldown: 0,\r\n    damageFlash: 0,\r\n    onGround,\r\n    preferredAltitude: movementType === \"air\" ? preferredAltitude : 0,\r\n    waterLineY,\r\n    bobPhase: Math.random() * Math.PI * 2\r\n  };\r\n\r\n  vehicle.mounts = (definition.mountedWeapons ?? []).map((mountDef, index) => ({\r\n    id: mountDef.id ?? `${type}-mount-${index}`,\r\n    cooldown: 0,\r\n    flashTimer: 0,\r\n    muzzleIndex: 0,\r\n    lastMuzzleX: null,\r\n    lastMuzzleY: null\r\n  }));\r\n\r\n  return vehicle;\r\n}\r\n\r\nconst vehicles = [\r\n  createVehicle(\"buggy\", getEnvironmentWidth() * 0.14),\r\n  createVehicle(\"buggy\", getEnvironmentWidth() * 0.28),\r\n  createVehicle(\"tideSkiff\", getEnvironmentWidth() * 0.38),\r\n  createVehicle(\"raptorHeli\", getEnvironmentWidth() * 0.56, { hover: 140 }),\r\n  createVehicle(\"arrowJet\", getEnvironmentWidth() * 0.64, { hover: 200 }),\r\n  createVehicle(\"stormBarge\", getEnvironmentWidth() * 0.74),\r\n  createVehicle(\"abyssSub\", getEnvironmentWidth() * 0.78),\r\n  createVehicle(\"scoutDrone\", getEnvironmentWidth() * 0.9, { hover: 100 })\r\n];\r\n\r\nfunction getVehicleById(id) {\r\n  return vehicles.find((vehicle) => vehicle.id === id) ?? null;\r\n}\r\n\r\nexport { VEHICLE_DEFINITIONS, vehicles, createVehicle, getVehicleById };\r\n\r\n\r\n","function clamp(value, min, max) {\n  return Math.max(min, Math.min(max, value));\n}\n\nexport { clamp };\r\n","let elapsed = 0;\n\nfunction advanceTime(delta) {\n  elapsed += delta;\n}\n\nfunction getElapsedTime() {\n  return elapsed;\n}\n\nexport { advanceTime, getElapsedTime };\r\n","const SURVIVAL_SETTINGS = {\n  countdownDuration: 6,\n  restDuration: 12,\n  baseEnemies: 2,\n  enemiesPerWave: 0,\n  waveReward: 25,\n  rewardIncrement: 8,\n  killReward: 3\n};\n\nexport { SURVIVAL_SETTINGS };\r\n\r\n","import { SURVIVAL_SETTINGS } from \"../config/survival.js\";\nimport { onEnvironmentChange } from \"./environment.js\";\n\nconst survivalState = {\n  active: false,\n  stage: \"idle\",\n  timer: 0,\n  wave: 0,\n  enemiesAlive: 0,\n  lastReward: 0\n};\n\nfunction resetSurvivalState() {\n  survivalState.active = false;\n  survivalState.stage = \"idle\";\n  survivalState.timer = 0;\n  survivalState.wave = 0;\n  survivalState.enemiesAlive = 0;\n  survivalState.lastReward = 0;\n}\n\nfunction beginSurvivalCountdown() {\n  survivalState.active = true;\n  survivalState.wave = 0;\n  survivalState.lastReward = 0;\n  setSurvivalStage(\"countdown\", SURVIVAL_SETTINGS.countdownDuration);\n}\n\nfunction setSurvivalStage(stage, timer = 0) {\n  survivalState.stage = stage;\n  survivalState.timer = Math.max(0, timer ?? 0);\n}\n\nfunction incrementSurvivalWave() {\n  survivalState.wave += 1;\n}\n\nfunction setSurvivalTimer(value) {\n  survivalState.timer = Math.max(0, value ?? 0);\n}\n\nfunction setSurvivalEnemiesAlive(count) {\n  survivalState.enemiesAlive = Math.max(0, Math.floor(count ?? 0));\n}\n\nfunction setSurvivalLastReward(amount) {\n  survivalState.lastReward = Math.max(0, Math.round(amount ?? 0));\n}\n\nfunction getSurvivalState() {\n  return survivalState;\n}\n\nfunction isSurvivalActive() {\n  return survivalState.active;\n}\n\nonEnvironmentChange(() => {\n  resetSurvivalState();\n});\n\nexport {\n  getSurvivalState,\n  beginSurvivalCountdown,\n  setSurvivalStage,\n  incrementSurvivalWave,\n  setSurvivalTimer,\n  setSurvivalEnemiesAlive,\n  setSurvivalLastReward,\n  resetSurvivalState,\n  isSurvivalActive\n};\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { GRAVITY } from \"../../config/constants.js\";\r\n\r\nconst RAGDOLL_BLUEPRINTS = {\r\n  player: [\r\n    { radius: 16, offsetX: 0, offsetY: -42, color: \"#f4f7ff\" },\r\n    { radius: 12, offsetX: 0, offsetY: -14, color: \"#cfd3df\" },\r\n    { radius: 10, offsetX: -14, offsetY: 6, color: \"#f4f7ff\" },\r\n    { radius: 10, offsetX: 14, offsetY: 6, color: \"#f4f7ff\" },\r\n    { radius: 11, offsetX: -10, offsetY: 34, color: \"#cfd3df\" },\r\n    { radius: 11, offsetX: 10, offsetY: 34, color: \"#cfd3df\" }\r\n  ],\r\n  enemy: [\r\n    { radius: 16, offsetX: 0, offsetY: -40, color: \"#fa5b4a\" },\r\n    { radius: 12, offsetX: 0, offsetY: -12, color: \"#d94d3f\" },\r\n    { radius: 10, offsetX: -12, offsetY: 8, color: \"#ff9488\" },\r\n    { radius: 10, offsetX: 12, offsetY: 8, color: \"#ff9488\" },\r\n    { radius: 11, offsetX: -10, offsetY: 36, color: \"#d94d3f\" },\r\n    { radius: 11, offsetX: 10, offsetY: 36, color: \"#d94d3f\" }\r\n  ]\r\n};\r\n\r\nconst ragdolls = [];\r\n\r\nfunction spawnRagdoll(kind, originX, originY, facing = 1, baseVx = 0, baseVy = 0) {\r\n  const blueprint = RAGDOLL_BLUEPRINTS[kind];\r\n  if (!blueprint) {\r\n    return;\r\n  }\r\n\r\n  for (const part of blueprint) {\r\n    ragdolls.push({\r\n      x: originX + part.offsetX * facing,\r\n      y: originY + part.offsetY,\r\n      vx: baseVx + facing * (40 + Math.random() * 80) + (Math.random() - 0.5) * 60,\r\n      vy: baseVy - (80 + Math.random() * 140),\r\n      radius: part.radius,\r\n      color: part.color,\r\n      life: 1.6 + Math.random() * 0.8,\r\n      maxLife: 1.6 + Math.random() * 0.8\r\n    });\r\n  }\r\n}\r\n\r\nfunction updateRagdolls(delta, groundY) {\r\n  for (const piece of ragdolls) {\r\n    piece.life -= delta;\r\n    piece.vy += GRAVITY * delta * 0.9;\r\n    piece.x += piece.vx * delta;\r\n    piece.y += piece.vy * delta;\r\n    piece.vx *= 0.96;\r\n\r\n    if (piece.y + piece.radius >= groundY) {\r\n      piece.y = groundY - piece.radius;\r\n      piece.vy = -piece.vy * 0.35;\r\n      piece.vx *= 0.7;\r\n      if (Math.abs(piece.vy) < 20) {\r\n        piece.vy = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  for (let i = ragdolls.length - 1; i >= 0; i -= 1) {\r\n    if (ragdolls[i].life <= 0.05) {\r\n      ragdolls.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawRagdolls() {\r\n  context.save();\r\n  for (const piece of ragdolls) {\r\n    const alpha = clamp(piece.life / piece.maxLife, 0, 1);\r\n    context.globalAlpha = alpha * 0.85;\r\n    context.fillStyle = piece.color;\r\n    context.beginPath();\r\n    context.arc(piece.x, piece.y, piece.radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction getRagdolls() {\r\n  return ragdolls;\r\n}\r\n\r\nexport { spawnRagdoll, updateRagdolls, drawRagdolls, getRagdolls };\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst damagePopups = [];\r\n\r\nfunction spawnDamagePopup(x, y, value) {\r\n  damagePopups.push({\r\n    x,\r\n    y,\r\n    value,\r\n    life: 0.75,\r\n    maxLife: 0.75,\r\n    vx: (Math.random() - 0.5) * 24,\r\n    vy: -60 - Math.random() * 20\r\n  });\r\n}\r\n\r\nfunction updateDamagePopups(delta) {\r\n  for (const popup of damagePopups) {\r\n    popup.life -= delta;\r\n    popup.x += popup.vx * delta;\r\n    popup.y += popup.vy * delta;\r\n    popup.vy -= 40 * delta;\r\n  }\r\n\r\n  for (let i = damagePopups.length - 1; i >= 0; i -= 1) {\r\n    if (damagePopups[i].life <= 0) {\r\n      damagePopups.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawDamagePopups() {\r\n  context.save();\r\n  context.font = \"18px 'Segoe UI', Arial, sans-serif\";\r\n  context.textAlign = \"center\";\r\n  for (const popup of damagePopups) {\r\n    const opacity = clamp(popup.life / popup.maxLife, 0, 1);\r\n    context.fillStyle = `rgba(255, 214, 102, ${opacity})`;\r\n    context.fillText(`-${Math.round(popup.value)}`, popup.x, popup.y);\r\n  }\r\n  context.restore();\r\n}\r\n\r\nexport { spawnDamagePopup, updateDamagePopups, drawDamagePopups };\r\n","import { canvas, GROUND_Y, context } from \"../../environment/canvas.js\";\r\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { stickman, trainingDummy, enemies, getTotalHeight } from \"../../state/entities.js\";\r\nimport { spawnProjectile } from \"../combat/projectiles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst turrets = [];\r\n\r\nfunction createTurret(config, facing) {\r\n  const height = config.height ?? 54;\r\n  const spawnOffset = config.spawnOffset ?? { x: 64, y: 0 };\r\n  const baseHeight = getTotalHeight(stickman.currentPose ?? null) || 0;\r\n  const envWidth = getEnvironmentWidth();\r\n  const spawnX = clamp(stickman.x + facing * (spawnOffset.x ?? 64), 40, envWidth - 40);\r\n  const spawnYBase = stickman.y + baseHeight;\r\n  const spawnY = Math.min(spawnYBase + (spawnOffset.y ?? 0), GROUND_Y);\r\n  const y = Math.min(GROUND_Y - height, spawnY - height);\r\n\r\n  return {\r\n    id: `turret-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`,\r\n    x: spawnX,\r\n    y,\r\n    height,\r\n    facing,\r\n    range: config.range ?? 260,\r\n    fireInterval: Math.max(0.1, config.fireInterval ?? 0.6),\r\n    fireTimer: 0.1,\r\n    duration: config.duration ?? 8,\r\n    maxDuration: config.duration ?? 8,\r\n    projectile: {\r\n      speed: config.projectile?.speed ?? 520,\r\n      radius: config.projectile?.radius ?? 5,\r\n      damage: config.projectile?.damage ?? 10,\r\n      knockback: config.projectile?.knockback ?? 70,\r\n      lifetime: config.projectile?.lifetime ?? 1.1,\r\n      color: config.projectile?.color ?? \"#9ae9ff\"\r\n    },\r\n    baseColor: config.baseColor ?? \"#7a8bff\",\r\n    headColor: config.headColor ?? \"#cfd8ff\"\r\n  };\r\n}\r\n\r\nfunction deployTurret(config) {\r\n  const facing = stickman.facing || 1;\r\n  const turret = createTurret(config, facing);\r\n  const maxActive = Math.max(1, config.maxActive ?? 1);\r\n  if (turrets.length >= maxActive) {\r\n    turrets.shift();\r\n  }\r\n  turrets.push(turret);\r\n}\r\n\r\nfunction getTargets() {\r\n  const targets = [];\r\n  if (trainingDummy.health > 0) {\r\n    targets.push({\r\n      id: trainingDummy.id,\r\n      x: trainingDummy.x,\r\n      y: trainingDummy.y + trainingDummy.height * 0.5\r\n    });\r\n  }\r\n  for (const enemy of enemies) {\r\n    if (enemy.health > 0) {\r\n      targets.push({\r\n        id: enemy.id,\r\n        x: enemy.x,\r\n        y: enemy.y + enemy.height * 0.5,\r\n        ref: enemy\r\n      });\r\n    }\r\n  }\r\n  return targets;\r\n}\r\n\r\nfunction acquireTarget(turret) {\r\n  const targets = getTargets();\r\n  let closest = null;\r\n  let closestDistSq = Infinity;\r\n  for (const target of targets) {\r\n    const dx = target.x - turret.x;\r\n    const dy = target.y - (turret.y + turret.height * 0.4);\r\n    const distSq = dx * dx + dy * dy;\r\n    if (distSq <= turret.range * turret.range && distSq < closestDistSq) {\r\n      closest = target;\r\n      closestDistSq = distSq;\r\n    }\r\n  }\r\n  return closest;\r\n}\r\n\r\nfunction fireTurret(turret, target) {\r\n  const originX = turret.x;\r\n  const originY = turret.y + turret.height * 0.35;\r\n  const dx = target.x - originX;\r\n  const dy = target.y - originY;\r\n  turret.facing = Math.sign(dx) || turret.facing;\r\n  const distance = Math.hypot(dx, dy) || 1;\r\n  const speed = turret.projectile.speed;\r\n  const vx = (dx / distance) * speed;\r\n  const vy = (dy / distance) * speed;\r\n  spawnProjectile({\r\n    x: originX,\r\n    y: originY,\r\n    vx,\r\n    vy,\r\n    radius: turret.projectile.radius,\r\n    lifetime: turret.projectile.lifetime,\r\n    color: turret.projectile.color,\r\n    damage: turret.projectile.damage,\r\n    knockback: turret.projectile.knockback,\r\n    facing: Math.sign(vx) || 1,\r\n    gravityFactor: 0\r\n  });\r\n  turret.fireTimer = turret.fireInterval;\r\n}\r\n\r\nfunction updateTurrets(delta) {\r\n  for (const turret of turrets) {\r\n    turret.duration -= delta;\r\n    turret.fireTimer -= delta;\r\n    const target = acquireTarget(turret);\r\n    if (target && turret.fireTimer <= 0) {\r\n      fireTurret(turret, target);\r\n    }\r\n  }\r\n  for (let i = turrets.length - 1; i >= 0; i -= 1) {\r\n    if (turrets[i].duration <= 0) {\r\n      turrets.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawTurrets() {\r\n  if (turrets.length === 0) {\r\n    return;\r\n  }\r\n  context.save();\r\n  for (const turret of turrets) {\r\n    const baseWidth = 40;\r\n    const baseHeight = turret.height * 0.4;\r\n    const remainingRatio = clamp(turret.duration / (turret.maxDuration || 1), 0, 1);\r\n    context.fillStyle = turret.baseColor;\r\n    context.fillRect(turret.x - baseWidth * 0.5, turret.y + turret.height - baseHeight, baseWidth, baseHeight);\r\n\r\n    const headHeight = turret.height * 0.6;\r\n    context.fillStyle = turret.headColor;\r\n    context.fillRect(turret.x - baseWidth * 0.3, turret.y, baseWidth * 0.6, headHeight);\r\n\r\n    context.fillStyle = \"#ffd66d\";\r\n    context.fillRect(turret.x - baseWidth * 0.3, turret.y - 6, baseWidth * 0.6 * remainingRatio, 4);\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction clearTurrets() {\r\n  turrets.length = 0;\r\n}\r\n\r\nfunction getTurretCount() {\r\n  return turrets.length;\r\n}\r\n\r\nexport { turrets, deployTurret, updateTurrets, drawTurrets, clearTurrets, getTurretCount };\r\n\r\n","import { canvas, GROUND_Y, context } from \"../../environment/canvas.js\";\r\nimport { stickman } from \"../../state/entities.js\";\r\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst grappleState = {\r\n  active: false,\r\n  tetherLength: 0,\r\n  maxLength: 0,\r\n  targetX: 0,\r\n  targetY: 0,\r\n  duration: 0,\r\n  retracting: false,\r\n  cooldown: 0,\r\n  color: \"#8cf1ff\",\r\n  travelSpeed: 860,\r\n  pullSpeed: 740\r\n};\r\n\r\nfunction canGrapple(config) {\r\n  if (grappleState.active) {\r\n    return false;\r\n  }\r\n  if ((stickman.gadgetCooldown ?? 0) > 0) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction startGrapple(config) {\r\n  const envWidth = getEnvironmentWidth();\r\n  const clampRect = config.clamp ?? { left: 80, right: envWidth - 80 };\r\n  const apex = config.apex ?? { y: GROUND_Y - 280 };\r\n  const launchLength = config.maxLength ?? 320;\r\n  const facing = stickman.facing || 1;\r\n  const anchorX = clamp(stickman.x + facing * launchLength, clampRect.left, clampRect.right);\r\n  const anchorY = Math.min(apex.y ?? (GROUND_Y - 240), stickman.y - (config.maxRise ?? 260));\r\n\r\n  grappleState.active = true;\r\n  grappleState.retracting = false;\r\n  grappleState.tetherLength = 0;\r\n  grappleState.maxLength = Math.hypot(anchorX - stickman.x, anchorY - stickman.y);\r\n  grappleState.targetX = anchorX;\r\n  grappleState.targetY = anchorY;\r\n  grappleState.duration = config.duration ?? 0.65;\r\n  grappleState.cooldown = config.cooldownSeconds ?? 1.6;\r\n  grappleState.color = config.color ?? \"#8cf1ff\";\r\n  grappleState.travelSpeed = config.travelSpeed ?? 860;\r\n  grappleState.pullSpeed = config.pullSpeed ?? 740;\r\n  stickman.gadgetCooldown = grappleState.cooldown;\r\n}\r\n\r\nfunction updateGrapple(delta) {\r\n  if (!grappleState.active) {\r\n    return;\r\n  }\r\n\r\n  const travelSpeed = grappleState.travelSpeed ?? 860;\r\n  const pullSpeed = grappleState.pullSpeed ?? 740;\r\n  const progressSpeed = (grappleState.retracting ? pullSpeed : travelSpeed) * delta;\r\n\r\n  if (!grappleState.retracting) {\r\n    grappleState.tetherLength += progressSpeed;\r\n    if (grappleState.tetherLength >= grappleState.maxLength) {\r\n      grappleState.tetherLength = grappleState.maxLength;\r\n      grappleState.retracting = true;\r\n    }\r\n  } else {\r\n    grappleState.duration -= delta;\r\n    const dx = grappleState.targetX - stickman.x;\r\n    const dy = grappleState.targetY - stickman.y;\r\n    const distance = Math.hypot(dx, dy);\r\n\r\n    if (distance > 12) {\r\n      const step = Math.min(distance, pullSpeed * delta);\r\n      stickman.vx = (dx / distance) * step / delta;\r\n      stickman.vy = (dy / distance) * step / delta;\r\n      stickman.x += (dx / distance) * step;\r\n      stickman.y += (dy / distance) * step;\r\n    }\r\n\r\n    grappleState.tetherLength = Math.max(0, grappleState.tetherLength - progressSpeed);\r\n    if (grappleState.duration <= 0 || grappleState.tetherLength <= 0) {\r\n      endGrapple();\r\n    }\r\n  }\r\n}\r\n\r\nfunction endGrapple() {\r\n  grappleState.active = false;\r\n  grappleState.retracting = false;\r\n  grappleState.tetherLength = 0;\r\n  grappleState.maxLength = 0;\r\n}\r\n\r\nfunction clearGrapple() {\r\n  endGrapple();\r\n}\r\n\r\nfunction updateGrappleState(delta) {\r\n  if (grappleState.cooldown > 0) {\r\n    grappleState.cooldown = Math.max(0, grappleState.cooldown - delta);\r\n  }\r\n  updateGrapple(delta);\r\n}\r\n\r\nfunction drawGrapple() {\r\n  if (!grappleState.active) {\r\n    return;\r\n  }\r\n  context.save();\r\n  context.strokeStyle = grappleState.color;\r\n  context.lineWidth = 3;\r\n  context.beginPath();\r\n  context.moveTo(stickman.x, stickman.y);\r\n  const ratio = grappleState.tetherLength / (grappleState.maxLength || 1);\r\n  const currentX = stickman.x + (grappleState.targetX - stickman.x) * ratio;\r\n  const currentY = stickman.y + (grappleState.targetY - stickman.y) * ratio;\r\n  context.lineTo(currentX, currentY);\r\n  context.stroke();\r\n  context.restore();\r\n}\r\n\r\nfunction hasActiveGrapple() {\r\n  return grappleState.active;\r\n}\r\n\r\nexport { canGrapple, startGrapple, updateGrappleState, drawGrapple, hasActiveGrapple, clearGrapple };\r\n\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { stickman } from \"../../state/entities.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst shieldState = {\r\n  active: false,\r\n  strength: 0,\r\n  maxStrength: 0,\r\n  duration: 0,\r\n  maxDuration: 0,\r\n  radius: 90,\r\n  color: \"#7cd6ff\",\r\n  flashTimer: 0\r\n};\r\n\r\nfunction getShieldCenter() {\r\n  const poseHeight = (stickman.currentPose?.headRadius ?? 16) * 2 + (stickman.currentPose?.bodyLength ?? 34) + (stickman.currentPose?.legLength ?? 36);\r\n  return {\r\n    x: stickman.x,\r\n    y: stickman.y + poseHeight * 0.5\r\n  };\r\n}\r\n\r\nfunction dispatchShieldEvent(type, detail = {}) {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.dispatchEvent(new CustomEvent(type, { detail }));\r\n}\r\n\r\nfunction activateShield(config = {}) {\r\n  const strength = config.strength ?? 90;\r\n  if (shieldState.active) {\r\n    return false;\r\n  }\r\n  shieldState.active = true;\r\n  shieldState.strength = strength;\r\n  shieldState.maxStrength = strength;\r\n  shieldState.duration = config.duration ?? 6;\r\n  shieldState.maxDuration = shieldState.duration;\r\n  shieldState.radius = config.radius ?? 96;\r\n  shieldState.color = config.color ?? \"#7cd6ff\";\r\n  shieldState.flashTimer = 0;\r\n  stickman.gadgetCooldown = config.cooldownSeconds ?? 4.5;\r\n  return true;\r\n}\r\n\r\nfunction updateShield(delta) {\r\n  if (!shieldState.active) {\r\n    return;\r\n  }\r\n  shieldState.duration -= delta;\r\n  shieldState.flashTimer = Math.max(0, shieldState.flashTimer - delta);\r\n  if (shieldState.duration <= 0) {\r\n    deactivateShield(\"expired\");\r\n  } else if (shieldState.strength <= 0) {\r\n    const center = getShieldCenter();\r\n    dispatchShieldEvent(\"shield:shatter\", {\r\n      reason: \"decayed\",\r\n      center,\r\n      maxStrength: shieldState.maxStrength,\r\n      radius: shieldState.radius,\r\n    });\r\n    deactivateShield(\"shatter\");\r\n  }\r\n}\r\n\r\nfunction deactivateShield(reason = \"expired\") {\r\n  if (!shieldState.active) {\r\n    return;\r\n  }\r\n  const detail = {\r\n    reason,\r\n    remainingStrength: shieldState.strength,\r\n    maxStrength: shieldState.maxStrength,\r\n    duration: shieldState.duration,\r\n    maxDuration: shieldState.maxDuration,\r\n    center: getShieldCenter(),\r\n    radius: shieldState.radius\r\n  };\r\n  shieldState.active = false;\r\n  shieldState.strength = 0;\r\n  shieldState.duration = 0;\r\n  shieldState.flashTimer = 0;\r\n  dispatchShieldEvent(\"shield:end\", detail);\r\n}\r\n\r\nfunction absorbShieldHit(hit) {\r\n  if (!shieldState.active) {\r\n    return hit;\r\n  }\r\n  const damage = hit.damage ?? 0;\r\n  if (damage <= 0) {\r\n    return hit;\r\n  }\r\n  const absorb = Math.min(damage, shieldState.strength);\r\n  shieldState.strength -= absorb;\r\n  shieldState.flashTimer = Math.max(shieldState.flashTimer, 0.2);\r\n\r\n  const center = getShieldCenter();\r\n  dispatchShieldEvent(\"shield:hit\", {\r\n    absorb,\r\n    remainingStrength: Math.max(0, shieldState.strength),\r\n    maxStrength: shieldState.maxStrength,\r\n    duration: shieldState.duration,\r\n    maxDuration: shieldState.maxDuration,\r\n    center,\r\n    radius: shieldState.radius,\r\n  });\r\n\r\n  const residualDamage = damage - absorb;\r\n  const result = {\r\n    ...hit,\r\n    damage: residualDamage\r\n  };\r\n  if (residualDamage <= 0) {\r\n    result.damage = 0;\r\n    result.knockback = (hit.knockback ?? 0) * 0.25;\r\n    result.launch = (hit.launch ?? 0) * 0.25;\r\n  }\r\n  if (shieldState.strength <= 0) {\r\n    dispatchShieldEvent(\"shield:shatter\", {\r\n      reason: \"damage\",\r\n      absorb,\r\n      center,\r\n      maxStrength: shieldState.maxStrength,\r\n      radius: shieldState.radius\r\n    });\r\n    deactivateShield(\"shatter\");\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction drawShield() {\r\n  if (!shieldState.active) {\r\n    return;\r\n  }\r\n  context.save();\r\n  const alpha = clamp(shieldState.flashTimer > 0 ? 0.45 : 0.25 + shieldState.strength / Math.max(1, shieldState.maxStrength) * 0.35, 0.15, 0.6);\r\n  context.strokeStyle = shieldState.color;\r\n  context.lineWidth = 4;\r\n  context.globalAlpha = alpha;\r\n  context.beginPath();\r\n  const center = getShieldCenter();\r\n  context.arc(center.x, center.y, shieldState.radius, 0, Math.PI * 2);\r\n  context.stroke();\r\n  context.globalAlpha = alpha * 0.4;\r\n  context.fillStyle = shieldState.color;\r\n  context.beginPath();\r\n  context.arc(center.x, center.y, shieldState.radius * 0.9, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction clearShield() {\r\n  deactivateShield(\"cleared\");\r\n}\r\n\r\nfunction getShieldStatus() {\r\n  return {\r\n    active: shieldState.active,\r\n    strength: shieldState.strength,\r\n    maxStrength: shieldState.maxStrength,\r\n    duration: shieldState.duration,\r\n    maxDuration: shieldState.maxDuration\r\n  };\r\n}\r\n\r\nexport { activateShield, updateShield, drawShield, clearShield, absorbShieldHit, getShieldStatus };\r\n\r\n","import { stickman } from \"../../state/entities.js\";\r\nimport { deployTurret, updateTurrets, drawTurrets, clearTurrets, getTurretCount } from \"./turret.js\";\r\nimport { canGrapple, startGrapple, updateGrappleState, drawGrapple, hasActiveGrapple, clearGrapple } from \"./grapple.js\";\r\nimport { activateShield, updateShield, drawShield, clearShield, absorbShieldHit, getShieldStatus } from \"./shield.js\";\r\n\r\nfunction deployGadget(weapon) {\r\n  const gadgetConfig = weapon?.gadget;\r\n  if (!gadgetConfig) {\r\n    return false;\r\n  }\r\n  const cooldown = stickman.gadgetCooldown ?? 0;\r\n  if (cooldown > 0) {\r\n    return false;\r\n  }\r\n\r\n  const type = gadgetConfig.type ?? \"turret\";\r\n  switch (type) {\r\n    case \"turret\":\r\n      deployTurret(gadgetConfig);\r\n      stickman.gadgetCooldown = gadgetConfig.cooldownSeconds ?? 2.5;\r\n      return true;\r\n    case \"grapple\":\r\n      if (!canGrapple(gadgetConfig)) {\r\n        return false;\r\n      }\r\n      startGrapple(gadgetConfig);\r\n      return true;\r\n    case \"shield\":\r\n      activateShield(gadgetConfig);\r\n      return true;\r\n    default:\r\n      return false;\r\n  }\r\n}\r\n\r\nfunction updateGadgets(delta) {\r\n  updateTurrets(delta);\r\n  updateShield(delta);\r\n}\r\n\r\nfunction updateGadgetMovement(delta) {\r\n  updateGrappleState(delta);\r\n}\r\n\r\nfunction drawGadgets() {\r\n  drawShield();\r\n  drawTurrets();\r\n  drawGrapple();\r\n}\r\n\r\nfunction clearGadgets() {\r\n  clearTurrets();\r\n  clearShield();\r\n  clearGrapple();\r\n}\r\n\r\nfunction getGadgetStatus() {\r\n  const shield = getShieldStatus();\r\n  return {\r\n    turretCount: getTurretCount(),\r\n    grappleActive: hasActiveGrapple(),\r\n    shieldActive: shield.active,\r\n    shieldStrength: shield.strength,\r\n    shieldMaxStrength: shield.maxStrength,\r\n    gadgetCooldown: stickman.gadgetCooldown ?? 0\r\n  };\r\n}\r\n\r\nexport { deployGadget, updateGadgets, updateGadgetMovement, drawGadgets, clearGadgets, getGadgetStatus, absorbShieldHit };\r\n","import { stickman, trainingDummy } from \"../../state/entities.js\";\r\nimport { addMaterials } from \"../../state/resources.js\";\r\nimport { SURVIVAL_SETTINGS } from \"../../config/survival.js\";\r\nimport { isSurvivalActive } from \"../../state/survival.js\";\r\nimport { spawnRagdoll } from \"../effects/ragdoll.js\";\r\nimport { spawnDamagePopup } from \"../effects/damage.js\";\r\nimport { absorbShieldHit } from \"../gadgets/index.js\";\r\n\r\nfunction applyDamageToDummy(hit) {\r\n  const damage = hit.damage ?? 0;\r\n  const knockback = hit.knockback ?? 0;\r\n\r\n  trainingDummy.health = Math.max(0, trainingDummy.health - damage);\r\n  trainingDummy.flashTimer = 0.18;\r\n  trainingDummy.shakeTimer = Math.min(0.4, trainingDummy.shakeTimer + 0.22);\r\n  trainingDummy.shakeMagnitude = Math.min(14, trainingDummy.shakeMagnitude + knockback / 60);\r\n\r\n  const popupY = trainingDummy.y + trainingDummy.height * 0.55 - trainingDummy.radius - 12;\r\n  spawnDamagePopup(trainingDummy.x, popupY, damage);\r\n\r\n  if (trainingDummy.health === 0 && trainingDummy.respawnTimer <= 0) {\r\n    trainingDummy.respawnTimer = 2.5;\r\n  }\r\n}\r\n\r\nfunction applyDamageToEnemy(enemy, hit) {\r\n  if (enemy.health <= 0 || enemy.invulnerability > 0) {\r\n    return;\r\n  }\r\n\r\n  const damage = hit.damage ?? 0;\r\n  const knockback = hit.knockback ?? 0;\r\n  const launch = hit.launch ?? 0;\r\n  const facing = hit.facing ?? stickman.facing;\r\n\r\n  enemy.health = Math.max(0, enemy.health - damage);\r\n  enemy.flashTimer = 0.18;\r\n  enemy.shakeTimer = Math.min(0.5, enemy.shakeTimer + 0.24);\r\n  enemy.shakeMagnitude = Math.min(18, enemy.shakeMagnitude + knockback / 55);\r\n  enemy.vx += knockback * facing * 0.35;\r\n  if (launch > 0) {\r\n    enemy.vy -= launch * 0.3;\r\n  }\r\n\r\n  spawnDamagePopup(enemy.x + enemy.facing * 14, enemy.y - 14, damage);\r\n  enemy.invulnerability = 0.15;\r\n\r\n  if (enemy.health === 0) {\r\n    if (enemy.respawnTimer <= 0) {\r\n      spawnRagdoll(\"enemy\", enemy.x, enemy.y, facing, enemy.vx, enemy.vy);\r\n    }\r\n    enemy.state = \"defeated\";\r\n    enemy.attackCooldown = 1.2;\r\n    enemy.respawnTimer = 3;\r\n    if (isSurvivalActive()) {\r\n      const killReward = SURVIVAL_SETTINGS.killReward ?? 0;\r\n      if (killReward > 0) {\r\n        addMaterials(killReward);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction applyDamageToPlayer(enemy, hit) {\r\n  if (stickman.invulnerability > 0 || stickman.health <= 0) {\r\n    return;\r\n  }\r\n\r\n  const baseDamage = hit?.damage ?? enemy.attackDamage ?? 0;\r\n  const baseKnockback = hit?.knockback ?? enemy.attackKnockback ?? 0;\r\n  const baseLaunch = hit?.launch ?? enemy.attackLaunch ?? 0;\r\n  const facing = hit?.facing ?? enemy.facing ?? 1;\r\n\r\n  let adjustedHit = absorbShieldHit({\r\n    damage: baseDamage,\r\n    knockback: baseKnockback,\r\n    launch: baseLaunch,\r\n    facing\r\n  });\r\n\r\n  let finalDamage = adjustedHit?.damage ?? 0;\r\n  let finalKnockback = adjustedHit?.knockback ?? baseKnockback;\r\n  let finalLaunch = adjustedHit?.launch ?? baseLaunch;\r\n  const finalFacing = adjustedHit?.facing ?? facing;\r\n\r\n  const shieldReduction = Math.max(0, Math.min(0.9, stickman.structureShieldStrength ?? 0));\r\n  if (shieldReduction > 0) {\r\n    finalDamage *= 1 - shieldReduction;\r\n    finalKnockback *= 1 - shieldReduction * 0.5;\r\n    finalLaunch *= 1 - shieldReduction * 0.5;\r\n  }\r\n\r\n  if (finalDamage > 0) {\r\n    stickman.health = Math.max(0, stickman.health - finalDamage);\r\n    stickman.invulnerability = 0.6;\r\n  } else {\r\n    stickman.invulnerability = Math.max(stickman.invulnerability, 0.2);\r\n  }\r\n\r\n  stickman.vx += finalKnockback * finalFacing;\r\n  stickman.vy += finalLaunch;\r\n  spawnDamagePopup(stickman.x, stickman.y + 10, Math.max(0, Math.round(finalDamage)));\r\n\r\n  if (finalDamage > 0 && stickman.health === 0 && stickman.deadTimer <= 0) {\r\n    stickman.deadTimer = 2.6;\r\n    stickman.attacking = false;\r\n    stickman.activeHitboxes = [];\r\n    stickman.comboWindowOpen = false;\r\n    stickman.attackIndex = -1;\r\n    stickman.rolling = false;\r\n    spawnRagdoll(\"player\", stickman.x, stickman.y, -finalFacing, stickman.vx, stickman.vy);\r\n  }\r\n}\r\n\r\nexport { applyDamageToDummy, applyDamageToEnemy, applyDamageToPlayer };\r\n\r\n","const DESTRUCTIBLE_TEMPLATES = {\r\n  concreteBarrier: {\r\n    maxHealth: 600,\r\n    width: 180,\r\n    height: 110,\r\n    rubbleHeight: 34,\r\n    material: \"concrete\",\r\n    bodyColor: \"#4c5564\",\r\n    edgeColor: \"#2a313c\",\r\n    accentColor: \"#9aa4b4\",\r\n    damageHighlight: \"#d5dde8\",\r\n    debrisColor: \"#3a424f\",\r\n    smokeDuration: 2.4,\r\n    shakeFactor: 16,\n    salvage: 12\r\n  },\r\n  streetCar: {\r\n    maxHealth: 420,\r\n    width: 168,\r\n    height: 90,\r\n    rubbleHeight: 38,\r\n    material: \"vehicle\",\r\n    bodyColor: \"#ba3c38\",\r\n    edgeColor: \"#1c1d25\",\r\n    accentColor: \"#f4f7fb\",\r\n    glassColor: \"#4ac3ff\",\r\n    damageHighlight: \"#ffe5dc\",\r\n    debrisColor: \"#5a1f1a\",\r\n    smokeDuration: 3.4,\r\n    shakeFactor: 22,\n    salvage: 18,\r\n    deathBlast: {\r\n      radius: 140,\r\n      maxDamage: 160,\r\n      knockback: 320,\r\n      minDamageRatio: 0.32\r\n    }\r\n  },\r\n  fuelBarrelCluster: {\r\n    maxHealth: 220,\r\n    width: 96,\r\n    height: 96,\r\n    rubbleHeight: 28,\r\n    material: \"volatile\",\r\n    bodyColor: \"#c0671c\",\r\n    edgeColor: \"#2f1a08\",\r\n    accentColor: \"#ffe7ba\",\r\n    stripeColor: \"#ffd45f\",\r\n    damageHighlight: \"#ffd4a1\",\r\n    debrisColor: \"#6e2c05\",\r\n    smokeDuration: 4.2,\r\n    shakeFactor: 26,\n    salvage: 22,\r\n    deathBlast: {\r\n      radius: 180,\r\n      maxDamage: 240,\r\n      knockback: 400,\r\n      minDamageRatio: 0.4\r\n    }\r\n  },\r\n  timberWall: {\r\n    maxHealth: 540,\r\n    width: 172,\r\n    height: 102,\r\n    rubbleHeight: 32,\r\n    material: \"concrete\",\r\n    bodyColor: \"#5c4b2d\",\r\n    edgeColor: \"#362a18\",\r\n    accentColor: \"#8b7344\",\r\n    damageHighlight: \"#f5d6a4\",\r\n    debrisColor: \"#3a2d1a\",\r\n    smokeDuration: 2.1,\r\n    shakeFactor: 18,\n    salvage: 16\r\n  },\r\n  sandbagLine: {\r\n    maxHealth: 520,\r\n    width: 200,\r\n    height: 88,\r\n    rubbleHeight: 30,\r\n    material: \"concrete\",\r\n    bodyColor: \"#c2a274\",\r\n    edgeColor: \"#7a6142\",\r\n    accentColor: \"#e3cc9b\",\r\n    damageHighlight: \"#ffe8b8\",\r\n    debrisColor: \"#8a6d48\",\r\n    smokeDuration: 1.9,\r\n    shakeFactor: 14,\n    salvage: 14\r\n  },\r\n  roverWreck: {\r\n    maxHealth: 380,\r\n    width: 176,\r\n    height: 96,\r\n    rubbleHeight: 36,\r\n    material: \"vehicle\",\r\n    bodyColor: \"#8d9fb4\",\r\n    edgeColor: \"#1f2a35\",\r\n    accentColor: \"#f5f9ff\",\r\n    glassColor: \"#9be9ff\",\r\n    damageHighlight: \"#d6e2ff\",\r\n    debrisColor: \"#46586a\",\r\n    smokeDuration: 3.1,\r\n    shakeFactor: 20,\n    salvage: 20,\r\n    deathBlast: {\r\n      radius: 120,\r\n      maxDamage: 120,\r\n      knockback: 240,\r\n      minDamageRatio: 0.28\r\n    }\r\n  },\r\n  plasmaCell: {\r\n    maxHealth: 260,\r\n    width: 102,\r\n    height: 102,\r\n    rubbleHeight: 26,\r\n    material: \"volatile\",\r\n    bodyColor: \"#3b89ff\",\r\n    edgeColor: \"#15213a\",\r\n    accentColor: \"#8bd4ff\",\r\n    stripeColor: \"#62f5ff\",\r\n    damageHighlight: \"#b0f0ff\",\r\n    debrisColor: \"#1c3c66\",\r\n    smokeDuration: 4.6,\r\n    shakeFactor: 30,\n    salvage: 26,\r\n    deathBlast: {\r\n      radius: 220,\r\n      maxDamage: 280,\r\n      knockback: 420,\r\n      minDamageRatio: 0.45\r\n    }\r\n  }\r\n};\r\n\r\nexport { DESTRUCTIBLE_TEMPLATES };\r\n","import { DESTRUCTIBLE_TEMPLATES } from \"../config/destructibles.js\";\nimport { getEnvironmentDestructibleSpawns, onEnvironmentChange } from \"./environment.js\";\n\nfunction createDestructibleFromSpawn(spawn) {\n  const baseTemplate = DESTRUCTIBLE_TEMPLATES[spawn.type];\n  if (!baseTemplate) {\n    throw new Error(`Unknown destructible template: ${spawn.type}`);\n  }\n\n  const templateOverrides = spawn.templateOverrides ?? {};\n  const template = { ...baseTemplate, ...templateOverrides };\n  const width = spawn.width ?? template.width ?? baseTemplate.width;\n  const height = spawn.height ?? template.height ?? baseTemplate.height;\n  const halfWidth = width / 2;\n  const maxHealth = template.maxHealth ?? baseTemplate.maxHealth ?? 100;\n\n  const destructible = {\n    id: spawn.id,\n    type: spawn.type,\n    template,\n    x: spawn.x,\n    y: spawn.baseY,\n    width,\n    height,\n    halfWidth,\n    health: maxHealth,\n    maxHealth,\n    destroyed: false,\n    flashTimer: 0,\n    shakeTimer: 0,\n    shakeMagnitude: 0,\n    smokeTimer: 0,\n    rubbleLevel: 0,\n    deathTriggered: false,\n    facing: spawn.facing ?? 1,\n    spawnConfig: { ...spawn }\n  };\n\n  if (spawn.overrides && typeof spawn.overrides === \"object\") {\n    Object.assign(destructible, spawn.overrides);\n  }\n\n  return destructible;\n}\n\nfunction createInitialState() {\n  return getEnvironmentDestructibleSpawns().map((spawn) => createDestructibleFromSpawn(spawn));\n}\n\nconst destructibles = createInitialState();\n\nfunction resetDestructibles() {\n  destructibles.length = 0;\n  const fresh = createInitialState();\n  for (const item of fresh) {\n    destructibles.push(item);\n  }\n}\n\nfunction getDestructibles() {\n  return destructibles;\n}\n\nfunction getDestructibleById(id) {\n  return destructibles.find((item) => item.id === id) ?? null;\n}\n\nonEnvironmentChange(() => {\n  resetDestructibles();\n});\n\nexport { destructibles, getDestructibles, getDestructibleById, resetDestructibles };\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst particles = [];\r\nconst rings = [];\r\nlet listenersAttached = false;\r\n\r\nfunction spawnRingBurst(options = {}) {\r\n  const ttl = options.ttl ?? 0.4;\r\n  const ring = {\r\n    x: options.x ?? 0,\r\n    y: options.y ?? 0,\r\n    startRadius: options.startRadius ?? 70,\r\n    endRadius: options.endRadius ?? 140,\r\n    color: options.color ?? \"#ffffff\",\r\n    maxTtl: ttl,\r\n    ttl,\r\n    lineWidth: options.lineWidth ?? 5\r\n  };\r\n  rings.push(ring);\r\n  return ring;\r\n}\r\n\r\nfunction spawnMuzzleParticles(detail = {}) {\r\n  const count = 6;\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const facing = detail.facing ?? 1;\r\n  for (let i = 0; i < count; i += 1) {\r\n    const speed = 140 + Math.random() * 120;\r\n    const angle = (Math.random() * 0.6 - 0.3) + (facing > 0 ? 0 : Math.PI);\r\n    const vx = Math.cos(angle) * speed;\r\n    const vy = Math.sin(angle) * speed;\r\n    const ttl = 0.18 + Math.random() * 0.08;\r\n    particles.push({\r\n      type: \"spark\",\r\n      x: baseX,\r\n      y: baseY,\r\n      vx,\r\n      vy,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 4 + Math.random() * 3,\r\n      color: \"#ffdd9a\"\r\n    });\r\n  }\r\n}\r\n\r\nfunction spawnShieldRing(detail = {}, config = {}) {\r\n  const center = detail.center ?? { x: detail.x ?? 0, y: detail.y ?? 0 };\r\n  return spawnRingBurst({\r\n    x: center.x,\r\n    y: center.y,\r\n    ttl: config.ttl ?? 0.4,\r\n    startRadius: config.startRadius ?? (detail.radius ?? 70),\r\n    endRadius: config.endRadius ?? (detail.radius ?? 70) * 1.25,\r\n    color: config.color ?? \"#7cd6ff\",\r\n    lineWidth: config.lineWidth ?? 5\r\n  });\r\n}\r\n\r\nfunction spawnShieldHitParticles(detail = {}) {\r\n  const center = detail.center ?? { x: 0, y: 0 };\r\n  for (let i = 0; i < 9; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 90 + Math.random() * 150;\r\n    const vx = Math.cos(angle) * speed;\r\n    const vy = Math.sin(angle) * speed;\r\n    const ttl = 0.3 + Math.random() * 0.2;\r\n    particles.push({\r\n      type: \"shield\",\r\n      x: center.x,\r\n      y: center.y,\r\n      vx,\r\n      vy,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 6 + Math.random() * 6,\r\n      color: \"#9be9ff\"\r\n    });\r\n  }\r\n  spawnShieldRing(detail, {\r\n    ttl: 0.35,\r\n    startRadius: (detail.radius ?? 72) * 0.75,\r\n    endRadius: (detail.radius ?? 72) * 1.15,\r\n    lineWidth: 4,\r\n    color: \"#a9f0ff\"\r\n  });\r\n}\r\n\r\nfunction spawnShieldShatter(detail = {}) {\r\n  spawnShieldRing(detail, {\r\n    ttl: 0.55,\r\n    startRadius: (detail.radius ?? 96) * 0.9,\r\n    endRadius: (detail.radius ?? 96) * 1.6,\r\n    lineWidth: 7,\r\n    color: \"#7cd6ff\"\r\n  });\r\n  spawnShieldHitParticles({ center: detail.center, radius: detail.radius ?? 96 });\r\n}\r\n\r\nfunction spawnDestructibleHitParticles(detail = {}) {\r\n  const material = detail.material ?? \"generic\";\r\n  const paletteMap = {\r\n    concrete: [\"#dfe6f2\", \"#b9c3d0\", \"#6c7584\"],\r\n    vehicle: [\"#ffd6c8\", \"#ff9a82\", \"#3a1a1a\"],\r\n    volatile: [\"#ffd38a\", \"#ff9c3b\", \"#6e2c05\"],\r\n    generic: [\"#f2f5ff\", \"#c9d0de\"]\r\n  };\r\n  const palette = paletteMap[material] ?? paletteMap.generic;\r\n  const maxHealth = Math.max(1, detail.maxHealth ?? detail.health ?? 1);\r\n  const remaining = Math.max(0, Math.min(maxHealth, detail.health ?? maxHealth));\r\n  const intensity = clamp(1 - remaining / maxHealth, 0, 1);\r\n  const count = Math.max(6, Math.round(6 + intensity * 6));\r\n  const baseSpeed = 160 + intensity * 200;\r\n  for (let i = 0; i < count; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = baseSpeed * (0.45 + Math.random() * 0.65);\r\n    particles.push({\r\n      type: \"debris\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      vx: Math.cos(angle) * speed,\r\n      vy: Math.sin(angle) * speed * 0.7 - 50,\r\n      ttl: 0.45 + Math.random() * 0.3,\r\n      maxTtl: 0.45 + Math.random() * 0.3,\r\n      radius: 3 + Math.random() * 4,\r\n      color: palette[i % palette.length]\r\n    });\r\n  }\r\n}\r\n\r\nfunction ensureListeners() {\r\n  if (listenersAttached || typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.addEventListener(\"weapon:muzzle-flash\", (event) => {\r\n    spawnMuzzleParticles(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"shield:hit\", (event) => {\r\n    spawnShieldHitParticles(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"shield:shatter\", (event) => {\r\n    spawnShieldShatter(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"throwable:explosion\", (event) => {\r\n    spawnExplosionParticles(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"throwable:flash-burst\", (event) => {\r\n    spawnFlashBurst(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"throwable:smoke-spawn\", (event) => {\r\n    spawnSmokePuffs(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"throwable:smoke-dissipate\", (event) => {\r\n    spawnSmokeDissipateRing(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"destructible:hit\", (event) => {\r\n    spawnDestructibleHitParticles(event?.detail ?? {});\r\n  });\r\n  listenersAttached = true;\r\n}\r\n\r\nfunction spawnExplosionParticles(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const radius = detail.radius ?? 110;\r\n  const count = 18;\r\n  for (let i = 0; i < count; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 220 + Math.random() * 220;\r\n    const ttl = 0.3 + Math.random() * 0.25;\r\n    particles.push({\r\n      type: \"ember\",\r\n      x: baseX,\r\n      y: baseY,\r\n      vx: Math.cos(angle) * speed,\r\n      vy: Math.sin(angle) * speed,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 5 + Math.random() * 4,\r\n      color: Math.random() > 0.55 ? \"#ff9c4a\" : \"#ffd56b\"\r\n    });\r\n  }\r\n  spawnRingBurst({\r\n    x: baseX,\r\n    y: baseY,\r\n    startRadius: radius * 0.45,\r\n    endRadius: radius * 1.05,\r\n    color: \"#ffb347\",\r\n    lineWidth: 6,\r\n    ttl: 0.45\r\n  });\r\n}\r\n\r\nfunction spawnExplosionDebris(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const count = detail.count ?? 14;\r\n  const radius = detail.radius ?? 120;\r\n  const speedBase = detail.speed ?? 260;\r\n  const palette = detail.palette ?? [\"#ffdd9a\", \"#f7a24a\", \"#b55628\", \"#5b4340\"];\r\n  for (let i = 0; i < count; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = speedBase * (0.45 + Math.random() * 0.65);\r\n    const tilt = (Math.random() - 0.5) * 0.6;\r\n    particles.push({\r\n      type: \"debris\",\r\n      x: baseX + Math.cos(angle) * (detail.offsetRadius ?? 0),\r\n      y: baseY + Math.sin(angle) * (detail.offsetRadius ?? 0),\r\n      vx: Math.cos(angle + tilt) * speed,\r\n      vy: Math.sin(angle + tilt) * speed * 0.7 - 60,\r\n      ttl: 0.4 + Math.random() * 0.3,\r\n      maxTtl: 0.4 + Math.random() * 0.3,\r\n      radius: 3 + Math.random() * 4,\r\n      color: palette[i % palette.length]\r\n    });\r\n  }\r\n}\r\nfunction spawnFlashBurst(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const radius = detail.radius ?? 140;\r\n  spawnRingBurst({\r\n    x: baseX,\r\n    y: baseY,\r\n    startRadius: radius * 0.6,\r\n    endRadius: radius * 1.35,\r\n    color: \"#fff6d0\",\r\n    lineWidth: 8,\r\n    ttl: 0.32\r\n  });\r\n  for (let i = 0; i < 12; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 160 + Math.random() * 140;\r\n    const ttl = 0.18 + Math.random() * 0.08;\r\n    particles.push({\r\n      type: \"flash\",\r\n      x: baseX,\r\n      y: baseY,\r\n      vx: Math.cos(angle) * speed,\r\n      vy: Math.sin(angle) * speed,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 5 + Math.random() * 3,\r\n      color: \"#fffbe0\"\r\n    });\r\n  }\r\n}\r\n\r\nfunction spawnSmokePuffs(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const radius = detail.radius ?? detail.maxRadius ?? 120;\r\n  const count = 14;\r\n  for (let i = 0; i < count; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 30 + Math.random() * 60;\r\n    const vx = Math.cos(angle) * speed * 0.4;\r\n    const vy = -40 - Math.random() * 50;\r\n    const ttl = 0.9 + Math.random() * 0.5;\r\n    particles.push({\r\n      type: \"smoke\",\r\n      x: baseX + Math.cos(angle) * radius * 0.2,\r\n      y: baseY + Math.sin(angle) * radius * 0.1,\r\n      vx,\r\n      vy,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: radius * (0.15 + Math.random() * 0.18),\r\n      color: \"#aec4d8\"\r\n    });\r\n  }\r\n  spawnRingBurst({\r\n    x: baseX,\r\n    y: baseY,\r\n    startRadius: radius * 0.5,\r\n    endRadius: radius * 1.2,\r\n    color: \"#9db8ca\",\r\n    lineWidth: 4,\r\n    ttl: 0.5\r\n  });\r\n}\r\n\r\nfunction spawnSmokeDissipateRing(detail = {}) {\r\n  spawnRingBurst({\r\n    x: detail.x ?? 0,\r\n    y: detail.y ?? 0,\r\n    startRadius: (detail.radius ?? 110) * 0.8,\r\n    endRadius: (detail.radius ?? 110) * 1.1,\r\n    color: \"#95a8b8\",\r\n    lineWidth: 3,\r\n    ttl: 0.4\r\n  });\r\n}\r\n\r\nfunction updateParticles(delta) {\r\n  ensureListeners();\r\n  for (let i = particles.length - 1; i >= 0; i -= 1) {\r\n    const p = particles[i];\r\n    p.ttl -= delta;\r\n    if (p.ttl <= 0) {\r\n      particles.splice(i, 1);\r\n      continue;\r\n    }\r\n    const life = clamp(p.ttl / p.maxTtl, 0, 1);\r\n    p.x += p.vx * delta;\r\n    p.y += p.vy * delta;\r\n    if (p.type === \"shield\") {\r\n      p.vx *= 0.88;\r\n      p.vy *= 0.88;\r\n      p.radius *= 0.96 + life * 0.04;\r\n    } else if (p.type === \"smoke\") {\r\n      p.vx *= 0.9;\r\n      p.vy = (p.vy ?? 0) * 0.9 - 24 * delta;\r\n      p.radius *= 0.995 + life * 0.02;\r\n    } else if (p.type === \"ember\") {\r\n      p.vx *= 0.94;\r\n      p.vy *= 0.94;\r\n    } else if (p.type === \"debris\") {\r\n      p.vy += 520 * delta;\r\n      p.vx *= 0.88;\r\n      p.vy *= 0.9;\r\n      p.radius *= 0.95;\r\n    } else if (p.type === \"flash\") {\r\n      p.vx *= 0.8;\r\n      p.vy *= 0.8;\r\n      p.radius *= 0.9 + life * 0.08;\r\n    } else {\r\n      p.vx *= 0.86;\r\n      p.vy *= 0.86;\r\n    }\r\n  }\r\n\r\n  for (let i = rings.length - 1; i >= 0; i -= 1) {\r\n    const ring = rings[i];\r\n    ring.ttl -= delta;\r\n    if (ring.ttl <= 0) {\r\n      rings.splice(i, 1);\r\n      continue;\r\n    }\r\n  }\r\n}\r\nfunction drawParticles() {\r\n  ensureListeners();\r\n  if (particles.length === 0 && rings.length === 0) {\r\n    return;\r\n  }\r\n\r\n  context.save();\r\n  for (const ring of rings) {\r\n    const life = clamp(ring.ttl / ring.maxTtl, 0, 1);\r\n    const progress = 1 - life;\r\n    const radius = ring.startRadius + (ring.endRadius - ring.startRadius) * progress;\r\n    context.globalAlpha = clamp(life, 0, 1) * 0.6;\r\n    context.lineWidth = ring.lineWidth;\r\n    context.strokeStyle = ring.color;\r\n    context.beginPath();\r\n    context.arc(ring.x, ring.y, radius, 0, Math.PI * 2);\r\n    context.stroke();\r\n  }\r\n\r\n  for (const particle of particles) {\r\n    const life = clamp(particle.ttl / particle.maxTtl, 0, 1);\r\n    let alpha = clamp(life, 0, 1);\r\n    if (particle.type === \"smoke\") {\r\n      alpha *= 0.55;\r\n    } else if (particle.type === \"flash\") {\r\n      alpha = 0.35 + alpha * 0.65;\r\n    } else if (particle.type === \"debris\") {\r\n      alpha = 0.5 + alpha * 0.5;\r\n    }\r\n    context.globalAlpha = alpha;\r\n    context.fillStyle = particle.color;\r\n    let sizeFactor = life;\r\n    if (particle.type === \"smoke\") {\r\n      sizeFactor = 1;\r\n    } else if (particle.type === \"debris\") {\r\n      sizeFactor = 0.6 + life * 0.4;\r\n    }\r\n    const radius = Math.max(1.2, particle.radius * sizeFactor);\r\n    context.beginPath();\r\n    context.arc(particle.x, particle.y, radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport { spawnExplosionParticles, spawnExplosionDebris, spawnDestructibleHitParticles, spawnSmokePuffs, spawnSmokeDissipateRing, spawnRingBurst, updateParticles, drawParticles };\r\n","import { stickman, trainingDummy, enemies, getTotalHeight } from \"../../state/entities.js\";\nimport { applyDamageToDummy, applyDamageToEnemy, applyDamageToPlayer } from \"./damageHandlers.js\";\nimport { clamp } from \"../utils/math.js\";\n\nfunction computeExplosionFalloff(distance, radius, minRatio = 0.25) {\n  const clampedRadius = Math.max(1, radius);\n  const falloff = clamp(1 - distance / clampedRadius, 0, 1);\n  return clamp(minRatio + falloff * (1 - minRatio), 0, 1);\n}\n\nfunction applyExplosionImpulse({\n  x,\n  y,\n  radius,\n  maxDamage = 0,\n  maxKnockback = 0,\n  minDamageRatio = 0.25,\n  selfDamageScale = 1,\n  selfKnockbackScale = 1,\n  includeTrainingDummy = true,\n  includeEnemies = true,\n  includePlayer = true\n}) {\n  const summary = {\n    dummyHit: false,\n    enemiesHit: 0,\n    playerHit: false\n  };\n\n  const damageCap = Math.max(0, maxDamage);\n  const knockbackCap = Math.max(0, maxKnockback ?? damageCap * 1.2);\n  const radiusSafe = Math.max(1, radius);\n  const minRatio = clamp(minDamageRatio, 0, 1);\n\n  if (includeTrainingDummy && trainingDummy.health > 0) {\n    const dummyX = trainingDummy.x;\n    const dummyY = trainingDummy.y + trainingDummy.height * 0.55;\n    const distance = Math.hypot(dummyX - x, dummyY - y);\n    if (distance <= radiusSafe) {\n      const ratio = computeExplosionFalloff(distance, radiusSafe, minRatio);\n      const damage = damageCap * ratio;\n      const knockback = knockbackCap * ratio;\n      const facing = dummyX >= x ? 1 : -1;\n      applyDamageToDummy({\n        damage,\n        knockback,\n        launch: knockback * 0.18,\n        facing\n      });\n      summary.dummyHit = true;\n    }\n  }\n\n  if (includeEnemies) {\n    for (const enemy of enemies) {\n      if (enemy.health <= 0) {\n        continue;\n      }\n      const enemyX = enemy.x;\n      const enemyY = enemy.y + enemy.height * 0.5;\n      const distance = Math.hypot(enemyX - x, enemyY - y);\n      if (distance > radiusSafe) {\n        continue;\n      }\n      const ratio = computeExplosionFalloff(distance, radiusSafe, minRatio);\n      const damage = damageCap * ratio;\n      const knockback = knockbackCap * ratio;\n      const facing = enemyX >= x ? 1 : -1;\n      if (damage <= 0 && knockback <= 0) {\n        continue;\n      }\n      applyDamageToEnemy(enemy, {\n        damage,\n        knockback,\n        launch: knockback * 0.24,\n        facing\n      });\n      summary.enemiesHit += 1;\n    }\n  }\n\n  if (includePlayer && stickman.health > 0) {\n    const pose = stickman.currentPose ?? { headRadius: 16, bodyLength: 34, legLength: 36 };\n    const playerHeight = getTotalHeight(pose);\n    const playerCenterY = stickman.y + playerHeight * 0.6;\n    const distance = Math.hypot(stickman.x - x, playerCenterY - y);\n    if (distance <= radiusSafe) {\n      const ratio = computeExplosionFalloff(distance, radiusSafe, minRatio);\n      const damage = Math.max(0, damageCap * ratio * selfDamageScale);\n      const knockback = knockbackCap * ratio * selfKnockbackScale;\n      const facing = stickman.x >= x ? 1 : -1;\n      if (damage > 0 || knockback > 0) {\n        applyDamageToPlayer(null, {\n          damage,\n          knockback,\n          launch: knockback * 0.25,\n          facing\n        });\n        summary.playerHit = true;\n      }\n    }\n  }\n\n  return summary;\n}\n\nexport { computeExplosionFalloff, applyExplosionImpulse };\r\n","import { spawnSalvagePickup } from \"../../state/resources.js\";\r\nimport { destructibles, getDestructibles } from \"../../state/destructibles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { spawnExplosionParticles, spawnExplosionDebris, spawnSmokePuffs, spawnRingBurst } from \"../effects/particles.js\";\r\nimport { applyExplosionImpulse, computeExplosionFalloff } from \"../combat/explosions.js\";\r\n\r\nfunction getBounds(destructible) {\r\n  const halfWidth = destructible.halfWidth ?? destructible.width / 2;\r\n  const left = destructible.x - halfWidth;\r\n  const right = destructible.x + halfWidth;\r\n  const top = destructible.y - destructible.height;\r\n  const bottom = destructible.y;\r\n  return { left, right, top, bottom };\r\n}\r\n\r\nfunction circleIntersectsDestructible(x, y, radius, destructible) {\r\n  const { left, right, top, bottom } = getBounds(destructible);\r\n  const closestX = clamp(x, left, right);\r\n  const closestY = clamp(y, top, bottom);\r\n  const dx = x - closestX;\r\n  const dy = y - closestY;\r\n  return dx * dx + dy * dy <= radius * radius;\r\n}\r\n\r\nfunction distanceToDestructible(x, y, destructible) {\r\n  const { left, right, top, bottom } = getBounds(destructible);\r\n  const dx = Math.max(left - x, 0, x - right);\r\n  const dy = Math.max(top - y, 0, y - bottom);\r\n  return Math.hypot(dx, dy);\r\n}\r\n\r\nfunction spawnDamageEffects(destructible, hit = {}) {\r\n  if (typeof window !== \"undefined\") {\r\n    window.dispatchEvent(\r\n      new CustomEvent(\"destructible:hit\", {\r\n        detail: {\r\n          id: destructible.id,\r\n          type: destructible.type,\r\n          material: destructible.template?.material ?? \"generic\",\r\n          cause: hit.cause ?? \"impact\",\r\n          x: hit.impactX ?? destructible.x,\r\n          y: hit.impactY ?? destructible.y - destructible.height * 0.5,\r\n          health: destructible.health,\r\n          maxHealth: destructible.maxHealth\r\n        }\r\n      })\r\n    );\r\n  }\r\n}\r\n\r\nfunction triggerDestructibleDeath(destructible, hit = {}) {\r\n  const template = destructible.template;\r\n  if (!template || destructible.deathTriggered) {\r\n    return;\r\n  }\r\n  destructible.deathTriggered = true;\r\n  const centerX = hit.impactX ?? destructible.x;\r\n  const centerY = hit.impactY ?? (destructible.y - destructible.height * 0.35);\r\n\r\n  spawnExplosionParticles({\r\n    x: centerX,\r\n    y: centerY,\r\n    radius: Math.max(destructible.width, destructible.height) * 0.8\r\n  });\r\n  spawnSmokePuffs({\r\n    x: centerX,\r\n    y: centerY,\r\n    radius: Math.max(destructible.width, destructible.height),\r\n    maxRadius: (template.deathBlast?.radius ?? destructible.width * 1.2) * 0.6\r\n  });\r\n  spawnRingBurst({\r\n    x: centerX,\r\n    y: centerY,\r\n    startRadius: destructible.width * 0.35,\r\n    endRadius: destructible.width * 1.1,\r\n    color: \"#ffb347\",\r\n    ttl: 0.55,\r\n    lineWidth: 5\r\n  });\r\n\r\n  if (template.deathBlast) {\r\n    const blast = template.deathBlast;\r\n    if (typeof window !== \"undefined\") {\r\n      window.dispatchEvent(\r\n        new CustomEvent(\"destructible:explosion\", {\r\n          detail: {\r\n            id: destructible.id,\r\n            x: centerX,\r\n            y: centerY,\r\n            radius: blast.radius\r\n          }\r\n        })\r\n      );\r\n    }\r\n\r\n    applyExplosionImpulse({\r\n      x: centerX,\r\n      y: centerY,\r\n      radius: blast.radius,\r\n      maxDamage: blast.maxDamage,\r\n      maxKnockback: blast.knockback,\r\n      minDamageRatio: blast.minDamageRatio ?? 0.25\r\n    });\r\n\r\n    damageDestructiblesInRadius({\r\n      x: centerX,\r\n      y: centerY,\r\n      radius: blast.radius,\r\n      maxDamage: blast.maxDamage,\r\n      minDamageRatio: blast.minDamageRatio ?? 0.25,\r\n      sourceId: destructible.id,\r\n      cause: \"chain-explosion\"\r\n    });\r\n  }\r\n  const salvageAmount = template.salvage ?? Math.round((destructible.maxHealth ?? 200) / 25);\r\n  if (salvageAmount > 0) {\r\n    const chunks = Math.max(1, Math.round(salvageAmount / 10));\r\n    const amountPer = Math.max(1, Math.round(salvageAmount / chunks));\r\n    for (let i = 0; i < chunks; i += 1) {\r\n      const jitterX = (Math.random() - 0.5) * (destructible.width ?? 120) * 0.4;\r\n      spawnSalvagePickup({\r\n        x: centerX + jitterX,\r\n        y: centerY,\r\n        amount: amountPer,\r\n        vy: -120 - Math.random() * 60\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction damageDestructible(destructible, hit = {}) {\r\n  if (!destructible || destructible.destroyed) {\r\n    return { applied: false, destroyed: false };\r\n  }\r\n\r\n  const template = destructible.template;\r\n  const damage = Math.max(0, hit.damage ?? 0);\r\n  if (damage <= 0) {\r\n    return { applied: false, destroyed: false };\r\n  }\r\n\r\n  const appliedDamage = Math.min(damage, destructible.health);\r\n  destructible.health = Math.max(0, destructible.health - appliedDamage);\r\n  destructible.flashTimer = 0.2;\r\n  destructible.shakeTimer = Math.min(0.45, destructible.shakeTimer + 0.18 + (appliedDamage / destructible.maxHealth) * 0.3);\r\n  const baseShake = template?.shakeFactor ?? 14;\r\n  destructible.shakeMagnitude = Math.max(destructible.shakeMagnitude * 0.6, baseShake * (0.35 + (appliedDamage / destructible.maxHealth) * 1.2));\r\n  destructible.smokeTimer = Math.min(template?.smokeDuration ?? 0, (destructible.smokeTimer ?? 0) + 0.5);\r\n  spawnDamageEffects(destructible, hit);\r\n\r\n  let destroyed = false;\r\n  if (destructible.health <= 0) {\r\n    destructible.destroyed = true;\r\n    destructible.rubbleLevel = Math.max(destructible.rubbleLevel, 0.05);\r\n    destructible.smokeTimer = template?.smokeDuration ?? 0;\r\n    triggerDestructibleDeath(destructible, hit);\r\n    destroyed = true;\r\n  }\r\n\r\n  return { applied: true, destroyed };\r\n}\r\n\r\nfunction damageDestructiblesInRadius({ x, y, radius, maxDamage, minDamageRatio = 0.25, sourceId = null, cause = \"explosion\" }) {\r\n  const damageMax = Math.max(0, maxDamage ?? 0);\r\n  if (damageMax <= 0 || radius <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  const minRatio = clamp(minDamageRatio, 0, 1);\r\n  let hits = 0;\r\n  for (const destructible of destructibles) {\r\n    if (destructible.id === sourceId || (destructible.destroyed && destructible.deathTriggered)) {\r\n      continue;\r\n    }\r\n    const distance = distanceToDestructible(x, y, destructible);\r\n    if (distance > radius) {\r\n      continue;\r\n    }\r\n    const falloff = computeExplosionFalloff(distance, radius, minRatio);\r\n    const damage = damageMax * falloff;\r\n    if (damage <= 0) {\r\n      continue;\r\n    }\r\n    const impactX = clamp(x, destructible.x - destructible.halfWidth, destructible.x + destructible.halfWidth);\r\n    const impactY = clamp(y, destructible.y - destructible.height, destructible.y);\r\n    const result = damageDestructible(destructible, { damage, cause, impactX, impactY });\r\n    if (result.applied) {\r\n      hits += 1;\r\n    }\r\n  }\r\n  return hits;\r\n}\r\n\r\nfunction handleProjectileCollision(projectile) {\r\n  for (const destructible of destructibles) {\r\n    if (destructible.destroyed) {\r\n      continue;\r\n    }\r\n    if (circleIntersectsDestructible(projectile.x, projectile.y, projectile.radius, destructible)) {\r\n      damageDestructible(destructible, {\r\n        damage: projectile.damage ?? 0,\r\n        cause: \"projectile\",\r\n        impactX: projectile.x,\r\n        impactY: projectile.y\r\n      });\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction handleHitboxCollision(hitbox) {\r\n  let hit = false;\r\n  for (const destructible of destructibles) {\r\n    if (destructible.destroyed || hitbox.hitTargets.has(destructible.id)) {\r\n      continue;\r\n    }\r\n    if (circleIntersectsDestructible(hitbox.x, hitbox.y, hitbox.radius, destructible)) {\r\n      hitbox.hitTargets.add(destructible.id);\r\n      damageDestructible(destructible, {\r\n        damage: hitbox.damage ?? 0,\r\n        cause: \"melee\",\r\n        impactX: hitbox.x,\r\n        impactY: hitbox.y\r\n      });\r\n      hit = true;\r\n    }\r\n  }\r\n  return hit;\r\n}\r\n\r\nfunction updateDestructibles(delta) {\r\n  for (const destructible of destructibles) {\r\n    destructible.flashTimer = Math.max(0, (destructible.flashTimer ?? 0) - delta);\r\n    destructible.shakeTimer = Math.max(0, (destructible.shakeTimer ?? 0) - delta);\r\n    destructible.smokeTimer = Math.max(0, (destructible.smokeTimer ?? 0) - delta);\r\n    destructible.shakeMagnitude *= destructible.shakeTimer > 0 ? 0.92 : 0.6;\r\n    if (destructible.destroyed) {\r\n      destructible.rubbleLevel = Math.min(1, (destructible.rubbleLevel ?? 0) + delta * 2.2);\r\n    } else {\r\n      destructible.rubbleLevel = Math.max(0, (destructible.rubbleLevel ?? 0) - delta * 0.8);\r\n    }\r\n  }\r\n}\r\n\r\nexport {\r\n  getDestructibles,\r\n  updateDestructibles,\r\n  damageDestructible,\r\n  damageDestructiblesInRadius,\r\n  handleProjectileCollision,\r\n  handleHitboxCollision\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","const BUILDING_DEFINITIONS = {\n  barricade: {\n    id: \"barricade\",\n    name: \"Reinforced Barricade\",\n    width: 160,\n    height: 96,\n    maxHealth: 600,\n    cost: 40,\n    color: \"#4f5a6c\",\n    accentColor: \"#8ea0ba\",\n    strokeColor: \"#273041\",\n    blocking: true\n  },\n  watchtower: {\n    id: \"watchtower\",\n    name: \"Scout Tower\",\n    width: 120,\n    height: 200,\n    maxHealth: 520,\n    cost: 65,\n    color: \"#6c5b3f\",\n    accentColor: \"#a7824f\",\n    strokeColor: \"#2f2415\",\n    turret: {\n      range: 420,\n      cooldown: 1.25,\n      projectile: {\n        speed: 520,\n        damage: 18,\n        color: \"#ffd57a\"\n      }\n    }\n  },\n  shieldEmitter: {\n    id: \"shieldEmitter\",\n    name: \"Shield Emitter\",\n    width: 110,\n    height: 110,\n    maxHealth: 360,\n    cost: 55,\n    color: \"#2a3b58\",\n    accentColor: \"#6fb7ff\",\n    strokeColor: \"#152032\",\n    shield: {\n      radius: 220,\n      damageReduction: 0.4,\n      buffDuration: 0.6\n    },\n    ambient: {\n      radius: 260,\n      intensity: 0.9,\n      color: \"#7cd6ff\",\n      flicker: 0.35\n    }\n  },\n  shockTrap: {\n    id: \"shockTrap\",\n    name: \"Shock Trap\",\n    width: 100,\n    height: 28,\n    maxHealth: 280,\n    cost: 30,\n    color: \"#2b2f3c\",\n    accentColor: \"#9af0ff\",\n    strokeColor: \"#181b26\",\n    trap: {\n      radius: 140,\n      damage: 24,\n      stun: 0.8,\n      cooldown: 2.6\n    },\n    ambient: {\n      radius: 180,\n      intensity: 0.6,\n      color: \"#8cf2ff\",\n      flicker: 0.4\n    }\n  }\n};\n\nexport { BUILDING_DEFINITIONS };\r\n","import { BUILDING_DEFINITIONS } from \"../config/buildings.js\";\r\nimport { onEnvironmentChange } from \"./environment.js\";\r\n\r\nconst structures = [];\r\n\r\nconst buildState = {\r\n  active: false,\r\n  blueprintIndex: 0,\r\n  lastPreview: {\r\n    x: 0,\r\n    y: 0,\r\n    valid: false\r\n  }\r\n};\r\n\r\nfunction getBuildingDefinitions() {\r\n  return Object.values(BUILDING_DEFINITIONS);\r\n}\r\n\r\nfunction getBlueprintByIndex(index = 0) {\r\n  const defs = getBuildingDefinitions();\r\n  if (defs.length === 0) {\r\n    return null;\r\n  }\r\n  const safeIndex = ((index % defs.length) + defs.length) % defs.length;\r\n  return defs[safeIndex];\r\n}\r\n\r\nfunction addStructure(structure) {\r\n  structures.push(structure);\r\n}\r\n\r\nfunction resetStructures() {\r\n  structures.length = 0;\r\n}\r\n\r\nfunction getStructures() {\r\n  return structures;\r\n}\r\n\r\nfunction getBuildState() {\r\n  return buildState;\r\n}\r\n\r\nonEnvironmentChange(() => {\r\n  resetStructures();\r\n  buildState.active = false;\r\n  buildState.lastPreview = { ...buildState.lastPreview, valid: false };\r\n});\r\n\r\nexport {\r\n  getBuildingDefinitions,\r\n  getBlueprintByIndex,\r\n  getStructures,\r\n  addStructure,\r\n  resetStructures,\r\n  getBuildState\r\n};\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { stickman, squadmates } from \"../../state/entities.js\";\r\nimport { onEnvironmentChange, getEnvironmentAmbientLights } from \"../../state/environment.js\";\r\nimport { getStructures } from \"../../state/buildings.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst persistentLights = new Map();\r\nconst transientLights = [];\r\nlet listenersAttached = false;\r\nlet environmentAmbientLights = getEnvironmentAmbientLights();\r\n\r\nonEnvironmentChange((environment) => {\r\n  environmentAmbientLights = Array.isArray(environment?.ambientLights) ? environment.ambientLights : [];\r\n  persistentLights.clear();\r\n});\r\n\r\nfunction clampIntensity(value) {\r\n  return clamp(value, 0, 3);\r\n}\r\n\r\nfunction parseColor(color) {\r\n  if (typeof color !== \"string\") {\r\n    return { r: 255, g: 255, b: 255 };\r\n  }\r\n  const trimmed = color.trim();\r\n  if (trimmed.startsWith(\"#\")) {\r\n    let hex = trimmed.slice(1);\r\n    if (hex.length === 3) {\r\n      hex = hex\r\n        .split(\"\")\r\n        .map((char) => char + char)\r\n        .join(\"\");\r\n    }\r\n    if (hex.length === 6) {\r\n      const numeric = Number.parseInt(hex, 16);\r\n      if (!Number.isNaN(numeric)) {\r\n        return {\r\n          r: (numeric >> 16) & 0xff,\r\n          g: (numeric >> 8) & 0xff,\r\n          b: numeric & 0xff\r\n        };\r\n      }\r\n    }\r\n  }\r\n  const match = trimmed.match(/rgba?\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)/i);\r\n  if (match) {\r\n    return {\r\n      r: Number.parseInt(match[1], 10),\r\n      g: Number.parseInt(match[2], 10),\r\n      b: Number.parseInt(match[3], 10)\r\n    };\r\n  }\r\n  return { r: 255, g: 255, b: 255 };\r\n}\r\n\r\nfunction rgba(color, alpha) {\r\n  const { r, g, b } = parseColor(color);\r\n  const clampedAlpha = clamp(alpha, 0, 1.2);\r\n  return `rgba(${r}, ${g}, ${b}, ${clampedAlpha})`;\r\n}\r\n\r\nfunction setPersistentLight(id, props) {\r\n  let light = persistentLights.get(id);\r\n  if (!light) {\r\n    light = {\r\n      id,\r\n      intensity: 0,\r\n      targetIntensity: clampIntensity(props.intensity ?? 1),\r\n      type: props.type ?? \"point\",\r\n      smoothing: props.smoothing ?? 10\r\n    };\r\n    persistentLights.set(id, light);\r\n  }\r\n  light.type = props.type ?? light.type ?? \"point\";\r\n  light.x = props.x ?? light.x ?? 0;\r\n  light.y = props.y ?? light.y ?? 0;\r\n  light.radius = props.radius ?? light.radius ?? 180;\r\n  light.fov = props.fov ?? light.fov ?? Math.PI / 2;\r\n  light.direction = props.direction ?? light.direction ?? 0;\r\n  light.color = props.color ?? light.color ?? \"#ffffff\";\r\n  light.stretch = props.stretch ?? light.stretch ?? 1;\r\n  light.flicker = props.flicker ?? light.flicker ?? 0;\r\n  light.smoothing = props.smoothing ?? light.smoothing ?? 10;\r\n  light.targetIntensity = clampIntensity(props.intensity ?? light.targetIntensity ?? 1);\r\n  light.active = true;\r\n}\r\n\r\nfunction spawnDynamicLight(options = {}) {\r\n  ensureListeners();\r\n  const ttl = Math.max(0.016, options.ttl ?? 0.3);\r\n  transientLights.push({\r\n    type: options.type ?? \"point\",\r\n    x: options.x ?? 0,\r\n    y: options.y ?? 0,\r\n    radius: options.radius ?? 160,\r\n    intensity: clampIntensity(options.intensity ?? 1),\r\n    color: options.color ?? \"#ffffff\",\r\n    direction: options.direction ?? 0,\r\n    fov: options.fov ?? Math.PI / 2,\r\n    stretch: options.stretch ?? 1,\r\n    flicker: options.flicker ?? 0,\r\n    decay: clamp(options.decay ?? 1, 0.3, 4),\r\n    ttl,\r\n    maxTtl: ttl\r\n  });\r\n}\r\n\r\nfunction ensureListeners() {\r\n  if (listenersAttached || typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.addEventListener(\"weapon:muzzle-flash\", (event) => {\r\n    const detail = event?.detail ?? {};\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      radius: detail.radius ? detail.radius * 1.2 : 140,\r\n      intensity: 1.2,\r\n      color: \"#ffe4b0\",\r\n      ttl: 0.12,\r\n      flicker: 0.35,\r\n      decay: 0.7\r\n    });\r\n    if (typeof detail.facing === \"number\" && detail.facing !== 0) {\r\n      spawnDynamicLight({\r\n        type: \"cone\",\r\n        x: detail.x ?? 0,\r\n        y: detail.y ?? 0,\r\n        radius: 200,\r\n        intensity: 0.9,\r\n        color: \"#fff7d4\",\r\n        direction: detail.facing > 0 ? 0 : Math.PI,\r\n        fov: Math.PI / 5,\r\n        stretch: 0.4,\r\n        ttl: 0.12,\r\n        flicker: 0.25,\r\n        decay: 0.8\r\n      });\r\n    }\r\n  });\r\n  window.addEventListener(\"throwable:explosion\", (event) => {\r\n    const detail = event?.detail ?? {};\r\n    const radius = detail.radius ? detail.radius * 1.6 : 240;\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      radius,\r\n      intensity: 1.7,\r\n      color: \"#ffbf6b\",\r\n      ttl: 0.45,\r\n      flicker: 0.45,\r\n      decay: 0.7\r\n    });\r\n  });\r\n  window.addEventListener(\"throwable:flash-burst\", (event) => {\r\n    const detail = event?.detail ?? {};\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      radius: (detail.radius ?? 220) * 1.4,\r\n      intensity: 2,\r\n      color: \"#ffffff\",\r\n      ttl: 0.35,\r\n      flicker: 0.6,\r\n      decay: 0.6\r\n    });\r\n  });\r\n  window.addEventListener(\"throwable:smoke-spawn\", (event) => {\r\n    const detail = event?.detail ?? {};\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      radius: (detail.radius ?? 160) * 1.1,\r\n      intensity: 0.5,\r\n      color: \"#7ad4ff\",\r\n      ttl: 0.5,\r\n      flicker: 0.2,\r\n      decay: 1.4\r\n    });\r\n  });\r\n  window.addEventListener(\"throwable:smoke-dissipate\", (event) => {\r\n    const detail = event?.detail ?? {};\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      radius: (detail.radius ?? 160) * 1.3,\r\n      intensity: 0.35,\r\n      color: \"#a4f1ff\",\r\n      ttl: 0.4,\r\n      flicker: 0.18,\r\n      decay: 1.6\r\n    });\r\n  });\r\n  window.addEventListener(\"destructible:hit\", (event) => {\r\n    const detail = event?.detail ?? {};\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: detail.impactX ?? detail.x ?? 0,\r\n      y: detail.impactY ?? detail.y ?? 0,\r\n      radius: 140,\r\n      intensity: 0.55,\r\n      color: \"#ffe1a4\",\r\n      ttl: 0.18,\r\n      flicker: 0.3,\r\n      decay: 1.1\r\n    });\r\n  });\r\n  listenersAttached = true;\r\n}\r\n\r\nfunction updateEnvironmentLights() {\r\n  const anchors = Array.isArray(environmentAmbientLights) ? environmentAmbientLights : [];\r\n  for (let i = 0; i < anchors.length; i += 1) {\r\n    const anchor = anchors[i] ?? {};\r\n    const id = anchor.id ?? \"env-light-\" + i;\r\n    setPersistentLight(id, anchor);\r\n  }\r\n}\r\n\r\nfunction updateFlashlights() {\r\n  const playerFacing = stickman.facing ?? 1;\r\n  const alive = stickman.deadTimer <= 0;\r\n  const inVehicle = stickman.controlMode === \"vehicle\";\r\n  const baseIntensity = alive ? (inVehicle ? 0.65 : 0.9) : 0;\r\n\r\n  setPersistentLight(\"player-flashlight\", {\r\n    type: \"cone\",\r\n    x: stickman.x + playerFacing * 34,\r\n    y: stickman.y + 28,\r\n    radius: inVehicle ? 280 : 240,\r\n    intensity: baseIntensity,\r\n    color: \"#ffd591\",\r\n    direction: playerFacing >= 0 ? 0 : Math.PI,\r\n    fov: Math.PI * 0.5,\r\n    stretch: 0.42,\r\n    smoothing: 18,\r\n    flicker: 0.2\r\n  });\r\n\r\n  squadmates.forEach((ally, index) => {\r\n    if (!ally || ally.state === \"defeated\") {\r\n      return;\r\n    }\r\n    const facing = ally.facing ?? 1;\r\n    setPersistentLight(\"squad-flashlight-\" + (ally.id ?? index), {\r\n      type: \"cone\",\r\n      x: ally.x + facing * 30,\r\n      y: ally.y + 26,\r\n      radius: 210,\r\n      intensity: 0.6,\r\n      color: \"#fff0c4\",\r\n      direction: facing >= 0 ? 0 : Math.PI,\r\n      fov: Math.PI * 0.45,\r\n      stretch: 0.38,\r\n      smoothing: 20,\r\n      flicker: 0.24\r\n    });\r\n  });\r\n}\r\n\r\nfunction isLightVisible(light) {\r\n  const radius = light.radius ?? 0;\r\n  if (radius <= 0) {\r\n    return false;\r\n  }\r\n  const width = context.canvas.width;\r\n  const height = context.canvas.height;\r\n  return light.x + radius >= 0 && light.x - radius <= width && light.y + radius >= 0 && light.y - radius <= height;\r\n}\r\n\r\nfunction drawPointLight(light, strength) {\r\n  if (!isLightVisible(light)) {\r\n    return;\r\n  }\r\n  const radius = light.radius ?? 160;\r\n  const gradient = context.createRadialGradient(light.x, light.y, 0, light.x, light.y, radius);\r\n  gradient.addColorStop(0, rgba(light.color, clamp(strength * 1.05, 0, 1.1)));\r\n  gradient.addColorStop(0.4, rgba(light.color, clamp(strength * 0.6, 0, 0.9)));\r\n  gradient.addColorStop(1, rgba(light.color, 0));\r\n  context.fillStyle = gradient;\r\n  context.beginPath();\r\n  context.arc(light.x, light.y, radius, 0, Math.PI * 2);\r\n  context.fill();\r\n}\r\n\r\nfunction drawConeLight(light, strength) {\r\n  if (!isLightVisible(light)) {\r\n    return;\r\n  }\r\n  const radius = light.radius ?? 200;\r\n  const fov = clamp(light.fov ?? Math.PI / 3, Math.PI / 12, Math.PI);\r\n  const stretch = clamp(light.stretch ?? 0.5, 0.2, 1.2);\r\n  context.save();\r\n  context.translate(light.x, light.y);\r\n  context.rotate(light.direction ?? 0);\r\n  context.scale(1, stretch);\r\n  const gradient = context.createRadialGradient(0, 0, 0, 0, 0, radius);\r\n  gradient.addColorStop(0, rgba(light.color, clamp(strength, 0, 1)));\r\n  gradient.addColorStop(0.45, rgba(light.color, clamp(strength * 0.6, 0, 0.8)));\r\n  gradient.addColorStop(1, rgba(light.color, 0));\r\n  context.fillStyle = gradient;\r\n  context.beginPath();\r\n  const halfFov = fov / 2;\r\n  context.moveTo(0, 0);\r\n  context.arc(0, 0, radius, -halfFov, halfFov);\r\n  context.closePath();\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction updateLighting(delta) {\r\n  ensureListeners();\r\n\r\n  for (const light of persistentLights.values()) {\r\n    light.active = false;\r\n  }\r\n\r\n  updateEnvironmentLights();\r\n  updateFlashlights();\r\n  const structureLights = getStructures();\r\n  for (let i = 0; i < structureLights.length; i += 1) {\r\n    const structure = structureLights[i];\r\n    const ambient = structure?.ambient;\r\n    if (!ambient) {\r\n      continue;\r\n    }\r\n    setPersistentLight(`structure-${structure.id}`, {\r\n      type: ambient.type ?? \"point\",\r\n      x: structure.x + (ambient.offsetX ?? 0),\r\n      y: structure.y - (structure.height ?? 120) + (ambient.offsetY ?? -40),\r\n      radius: ambient.radius ?? 220,\r\n      intensity: ambient.intensity ?? 0.8,\r\n      color: ambient.color ?? \"#8cffd4\",\r\n      smoothing: ambient.smoothing ?? 10,\r\n      flicker: ambient.flicker ?? 0.25,\r\n      fov: ambient.fov,\r\n      direction: ambient.direction,\r\n      stretch: ambient.stretch ?? 0.5\r\n    });\r\n  }\r\n\r\n  for (const [id, light] of persistentLights.entries()) {\r\n    if (!light.active) {\r\n      persistentLights.delete(id);\r\n      continue;\r\n    }\r\n    const smoothing = clamp(light.smoothing ?? 12, 1, 60);\r\n    const lerp = clamp(delta * smoothing, 0, 1);\r\n    light.intensity += (light.targetIntensity - light.intensity) * lerp;\r\n    light.intensity = clampIntensity(light.intensity);\r\n    if (light.flicker > 0) {\r\n      light.intensity = clampIntensity(light.intensity + (Math.random() - 0.5) * light.flicker);\r\n    }\r\n  }\r\n\r\n  for (let i = transientLights.length - 1; i >= 0; i -= 1) {\r\n    const light = transientLights[i];\r\n    light.ttl -= delta;\r\n    if (light.ttl <= 0) {\r\n      transientLights.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawLighting() {\r\n  if (persistentLights.size === 0 && transientLights.length === 0) {\r\n    return;\r\n  }\r\n  context.save();\r\n  context.globalCompositeOperation = \"lighter\";\r\n  context.globalAlpha = 1;\r\n\r\n  for (const light of persistentLights.values()) {\r\n    const strength = clampIntensity(light.intensity);\r\n    if (strength <= 0.01) {\r\n      continue;\r\n    }\r\n    if (light.type === \"cone\") {\r\n      drawConeLight(light, strength);\r\n    } else {\r\n      drawPointLight(light, strength);\r\n    }\r\n  }\r\n\r\n  for (const light of transientLights) {\r\n    const ratio = clamp(light.ttl / light.maxTtl, 0, 1);\r\n    let strength = clampIntensity(light.intensity * Math.pow(ratio, light.decay ?? 1));\r\n    if (light.flicker > 0) {\r\n      strength = clampIntensity(strength + (Math.random() - 0.5) * light.flicker);\r\n    }\r\n    if (strength <= 0.01) {\r\n      continue;\r\n    }\r\n    if (light.type === \"cone\") {\r\n      drawConeLight(light, strength);\r\n    } else {\r\n      drawPointLight(light, strength);\r\n    }\r\n  }\r\n\r\n  context.restore();\r\n}\r\n\r\nexport { updateLighting, drawLighting, spawnDynamicLight };\r\n","import { context, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { GRAVITY } from \"../../config/constants.js\";\r\nimport { trainingDummy, enemies } from \"../../state/entities.js\";\r\nimport { applyDamageToDummy, applyDamageToEnemy } from \"./damageHandlers.js\";\r\nimport { handleProjectileCollision } from \"../world/destructibles.js\";\r\nimport { spawnDynamicLight } from \"../effects/lighting.js\";\r\n\r\nconst projectiles = [];\r\n\r\nfunction spawnProjectile({\r\n  x,\r\n  y,\r\n  vx,\r\n  vy,\r\n  radius = 6,\r\n  lifetime = 1.4,\r\n  color = \"#ffcf7a\",\r\n  damage = 0,\r\n  knockback = 0,\r\n  facing = 1,\r\n  gravityFactor = 0.2\r\n}) {\r\n  projectiles.push({\r\n    x,\r\n    y,\r\n    vx,\r\n    vy,\r\n    radius,\r\n    life: lifetime,\r\n    maxLife: lifetime,\r\n    color,\r\n    damage,\r\n    knockback,\r\n    facing,\r\n    gravityFactor,\r\n    lightCooldown: 0,\r\n    hitTargets: new Set()\r\n  });\r\n}\r\n\r\nfunction circleOverlap(ax, ay, ar, bx, by, br) {\r\n  const dx = ax - bx;\r\n  const dy = ay - by;\r\n  const radii = ar + br;\r\n  return dx * dx + dy * dy <= radii * radii;\r\n}\r\n\r\nfunction updateProjectiles(delta) {\r\n  for (const projectile of projectiles) {\r\n    projectile.life -= delta;\r\n    projectile.vy += GRAVITY * delta * projectile.gravityFactor;\r\n    projectile.x += projectile.vx * delta;\r\n    projectile.y += projectile.vy * delta;\r\n    projectile.lightCooldown = Math.max(0, (projectile.lightCooldown ?? 0) - delta);\r\n    if (projectile.lightCooldown <= 0 && projectile.life > 0) {\r\n      const tracerRadius = Math.max(90, projectile.radius * 16);\r\n      spawnDynamicLight({\r\n        type: \"point\",\r\n        x: projectile.x,\r\n        y: projectile.y,\r\n        radius: tracerRadius,\r\n        intensity: 0.4 + Math.random() * 0.2,\r\n        color: projectile.color ?? \"#ffcf7a\",\r\n        ttl: 0.08,\r\n        flicker: 0.25,\r\n        decay: 1.3\r\n      });\r\n      projectile.lightCooldown = 0.05;\r\n    }\r\n\r\n    if (projectile.y + projectile.radius >= GROUND_Y) {\r\n      projectile.life = 0;\r\n      continue;\r\n    }\r\n\r\n    if (trainingDummy.health > 0 && !projectile.hitTargets.has(trainingDummy.id)) {\r\n      if (circleOverlap(projectile.x, projectile.y, projectile.radius, trainingDummy.x, trainingDummy.y + trainingDummy.height * 0.55, trainingDummy.radius)) {\r\n        projectile.hitTargets.add(trainingDummy.id);\r\n        applyDamageToDummy({\r\n          damage: projectile.damage,\r\n          knockback: projectile.knockback,\r\n          facing: projectile.facing\r\n        });\r\n        projectile.life = 0;\r\n        continue;\r\n      }\r\n    }\r\n\r\n    for (const enemy of enemies) {\r\n      if (enemy.health <= 0 || projectile.hitTargets.has(enemy.id)) {\r\n        continue;\r\n      }\r\n      if (circleOverlap(projectile.x, projectile.y, projectile.radius, enemy.x, enemy.y + enemy.height * 0.5, enemy.radius)) {\r\n        projectile.hitTargets.add(enemy.id);\r\n        applyDamageToEnemy(enemy, {\r\n          damage: projectile.damage,\r\n          knockback: projectile.knockback,\r\n          launch: 0,\r\n          facing: projectile.facing\r\n        });\r\n        projectile.life = 0;\r\n        break;\r\n      }\r\n    }\r\n    if (projectile.life > 0) {\r\n      if (handleProjectileCollision(projectile)) {\r\n        projectile.life = 0;\r\n        continue;\r\n      }\r\n    }\r\n  }\r\n\r\n  for (let i = projectiles.length - 1; i >= 0; i -= 1) {\r\n    if (projectiles[i].life <= 0) {\r\n      projectiles.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawProjectiles() {\r\n  if (projectiles.length === 0) {\r\n    return;\r\n  }\r\n  context.save();\r\n  context.lineWidth = 2;\r\n  for (const projectile of projectiles) {\r\n    const alpha = Math.max(0, projectile.life / projectile.maxLife);\r\n    context.fillStyle = `rgba(255, 200, 120, ${alpha})`;\r\n    context.beginPath();\r\n    context.arc(projectile.x, projectile.y, projectile.radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction clearProjectiles() {\r\n  projectiles.length = 0;\r\n}\r\n\r\nexport { spawnProjectile, updateProjectiles, drawProjectiles, clearProjectiles };\r\n\r\n","\r\nimport { context, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { GRAVITY } from \"../../config/constants.js\";\r\nimport { stickman, trainingDummy, enemies, getTotalHeight } from \"../../state/entities.js\";\r\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { getCurrentWeapon } from \"./weapons.js\";\r\nimport { damageDestructiblesInRadius } from \"../world/destructibles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { getElapsedTime } from \"../utils/time.js\";\r\nimport { applyExplosionImpulse } from \"./explosions.js\";\r\nimport { spawnExplosionDebris } from \"../effects/particles.js\";\r\n\r\nconst throwables = [];\r\nconst smokeClouds = [];\r\n\r\nfunction dispatchThrowableEvent(type, detail = {}) {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.dispatchEvent(new CustomEvent(type, { detail }));\r\n}\r\n\r\nfunction throwEquippedWeapon() {\r\n  const weapon = getCurrentWeapon();\r\n  if ((stickman.stunTimer ?? 0) > 0) {\r\n    return false;\r\n  }\r\n  if (!weapon || weapon.category !== \"throwable\") {\r\n    return false;\r\n  }\r\n  if (stickman.throwCooldown > 0 || stickman.health <= 0 || stickman.rolling) {\r\n    return false;\r\n  }\r\n\r\n  const config = weapon.throwable ?? {};\r\n  const facing = stickman.facing || 1;\r\n  const arc = config.arcVelocity ?? { vx: 260, vy: -420 };\r\n  const spawnOffset = config.spawnOffset ?? { x: 22, y: 12 };\r\n  const envWidth = getEnvironmentWidth();\r\n\r\n  stickman.throwCooldown = config.cooldownSeconds ?? 0.9;\r\n\r\n  const grenade = {\r\n    id: `grenade-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`,\r\n    x: clamp(stickman.x + facing * (spawnOffset.x ?? 22), 40, envWidth - 40),\r\n    y: stickman.y + (spawnOffset.y ?? 12),\r\n    vx: facing * (arc.vx ?? 260),\r\n    vy: arc.vy ?? -420,\r\n    radius: config.radius ?? 16,\r\n    fuse: config.fuseSeconds ?? 1.5,\r\n    maxFuse: config.fuseSeconds ?? 1.5,\r\n    explosionRadius: config.explosionRadius ?? 120,\r\n    damage: config.damage ?? 45,\r\n    knockback: config.knockback ?? 260,\r\n    gravityFactor: config.gravityFactor ?? 0.5,\r\n    bounciness: clamp(config.bounciness ?? 0.45, 0, 0.95),\r\n    color: config.color ?? \"#ffb347\",\r\n    explosionDuration: config.explosionDuration ?? 0.32,\r\n    selfDamageScale: clamp(config.selfDamageScale ?? 0.65, 0, 1),\r\n    selfKnockbackScale: clamp(config.selfKnockbackScale ?? 0.6, 0, 1),\r\n    effectType: config.effectType ?? \"explosive\",\r\n    stunDuration: config.stunDuration ?? 0,\r\n    playerStunDuration: config.playerStunDuration ?? 0,\r\n    smokeDuration: config.smokeDuration ?? 0,\r\n    smokeRadius: config.smokeRadius ?? (config.explosionRadius ?? 120),\r\n    smokeExpansion: config.smokeExpansion ?? 1.1,\r\n    smokeSlowMultiplier: clamp(config.smokeSlowMultiplier ?? 0.55, 0.1, 1),\r\n    smokeTickDuration: config.smokeTickDuration ?? 0.5,\r\n    detonated: false,\r\n    explosionTimer: 0\r\n  };\r\n\r\n  throwables.push(grenade);\r\n  dispatchThrowableEvent(\"throwable:thrown\", {\r\n    id: grenade.id,\r\n    effectType: grenade.effectType,\r\n    x: grenade.x,\r\n    y: grenade.y,\r\n    radius: grenade.explosionRadius,\r\n    fuse: grenade.fuse\r\n  });\r\n\r\n  return true;\r\n}\r\n\r\nfunction applyExplosiveDamage(grenade) {\r\n  const { x, y, explosionRadius, damage, knockback } = grenade;\r\n  applyExplosionImpulse({\r\n    x,\r\n    y,\r\n    radius: explosionRadius,\r\n    maxDamage: damage,\r\n    maxKnockback: knockback,\r\n    minDamageRatio: grenade.damageFalloff ?? 0.3,\r\n    selfDamageScale: grenade.selfDamageScale ?? 1,\r\n    selfKnockbackScale: grenade.selfKnockbackScale ?? 1\r\n  });\r\n\r\n  if (damage > 0) {\r\n    damageDestructiblesInRadius({\r\n      x,\r\n      y,\r\n      radius: explosionRadius,\r\n      maxDamage: damage,\r\n      minDamageRatio: grenade.destructibleFalloff ?? 0.35,\r\n      cause: grenade.effectType ?? \"explosion\"\r\n    });\r\n  }\r\n\r\n  spawnExplosionDebris({\r\n    x,\r\n    y,\r\n    radius: explosionRadius,\r\n    count: Math.max(10, Math.round(explosionRadius / 10)),\r\n    speed: 220 + Math.max(0, knockback ?? 0) * 0.5\r\n  });\r\n}\r\n\r\nfunction applyFlashEffect(grenade) {\r\n  const { x, y, explosionRadius, stunDuration, playerStunDuration } = grenade;\r\n  const duration = Math.max(0.1, stunDuration);\r\n\r\n  if (trainingDummy.health > 0) {\r\n    const dx = trainingDummy.x - x;\r\n    const dy = (trainingDummy.y + trainingDummy.height * 0.55) - y;\r\n    if (Math.hypot(dx, dy) <= explosionRadius) {\r\n      trainingDummy.flashTimer = Math.max(trainingDummy.flashTimer, duration * 0.6);\r\n      trainingDummy.shakeTimer = Math.max(trainingDummy.shakeTimer, duration * 0.5);\r\n      trainingDummy.shakeMagnitude = Math.max(trainingDummy.shakeMagnitude, 14);\r\n    }\r\n  }\r\n\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const dx = enemy.x - x;\r\n    const dy = (enemy.y + enemy.height * 0.5) - y;\r\n    if (Math.hypot(dx, dy) <= explosionRadius) {\r\n      enemy.stunTimer = Math.max(enemy.stunTimer ?? 0, duration);\r\n      enemy.flashTimer = Math.max(enemy.flashTimer, duration * 0.7);\r\n      enemy.shakeTimer = Math.max(enemy.shakeTimer, duration * 0.4);\r\n      enemy.shakeMagnitude = Math.max(enemy.shakeMagnitude, 12);\r\n    }\r\n  }\r\n\r\n  if (playerStunDuration > 0 && stickman.health > 0) {\r\n    const pose = stickman.currentPose ?? { headRadius: 16, bodyLength: 34, legLength: 36 };\r\n    const playerHeight = getTotalHeight(pose);\r\n    const playerCenterY = stickman.y + playerHeight * 0.6;\r\n    const dx = stickman.x - x;\r\n    const dy = playerCenterY - y;\r\n    if (Math.hypot(dx, dy) <= explosionRadius) {\r\n      stickman.flashBlindTimer = Math.max(stickman.flashBlindTimer ?? 0, playerStunDuration);\r\n      stickman.stunTimer = Math.max(stickman.stunTimer ?? 0, playerStunDuration * 0.6);\r\n    }\r\n  }\r\n}\r\n\r\nfunction spawnSmokeCloud(grenade) {\r\n  const duration = Math.max(0.5, grenade.smokeDuration);\r\n  const radius = Math.max(40, grenade.smokeRadius);\r\n  const cloud = {\r\n    id: `smoke-${Date.now()}-${Math.random().toString(36).slice(2, 5)}`,\r\n    x: grenade.x,\r\n    y: grenade.y,\r\n    radius,\r\n    baseRadius: radius,\r\n    maxRadius: radius * (grenade.smokeExpansion ?? 1.1),\r\n    duration,\r\n    life: duration,\r\n    slowMultiplier: clamp(grenade.smokeSlowMultiplier ?? 0.55, 0.1, 1),\r\n    tick: grenade.smokeTickDuration ?? 0.5,\r\n    tickTimer: 0\r\n  };\r\n  smokeClouds.push(cloud);\r\n  dispatchThrowableEvent(\"throwable:smoke-spawn\", {\r\n    id: cloud.id,\r\n    x: cloud.x,\r\n    y: cloud.y,\r\n    radius: cloud.radius,\r\n    maxRadius: cloud.maxRadius,\r\n    duration: cloud.duration\r\n  });\r\n  return cloud;\r\n}\r\n\r\nfunction detonate(grenade) {\r\n  if (grenade.detonated) {\r\n    return;\r\n  }\r\n\r\n  grenade.detonated = true;\r\n  grenade.explosionTimer = Math.max(grenade.explosionDuration, 0.08);\r\n  grenade.fuse = 0;\r\n\r\n  const baseDetail = {\r\n    id: grenade.id,\r\n    effectType: grenade.effectType,\r\n    x: grenade.x,\r\n    y: grenade.y,\r\n    radius: grenade.explosionRadius\r\n  };\r\n\r\n  switch (grenade.effectType) {\r\n    case \"flash\": {\r\n      applyFlashEffect(grenade);\r\n      baseDetail.radius = grenade.explosionRadius;\r\n      baseDetail.stunDuration = grenade.stunDuration;\r\n      baseDetail.playerStunDuration = grenade.playerStunDuration;\r\n      dispatchThrowableEvent(\"throwable:flash-burst\", {\r\n        ...baseDetail,\r\n        stunDuration: grenade.stunDuration,\r\n        playerStunDuration: grenade.playerStunDuration\r\n      });\r\n      break;\r\n    }\r\n    case \"smoke\": {\r\n      const cloud = spawnSmokeCloud(grenade);\r\n      baseDetail.radius = cloud.maxRadius;\r\n      baseDetail.duration = cloud.duration;\r\n      baseDetail.cloudId = cloud.id;\r\n      dispatchThrowableEvent(\"throwable:smoke-detonate\", {\r\n        ...baseDetail,\r\n        radius: cloud.maxRadius,\r\n        duration: cloud.duration,\r\n        cloudId: cloud.id\r\n      });\r\n      break;\r\n    }\r\n    default: {\r\n      applyExplosiveDamage(grenade);\r\n      baseDetail.damage = grenade.damage;\r\n      baseDetail.knockback = grenade.knockback;\r\n      dispatchThrowableEvent(\"throwable:explosion\", {\r\n        ...baseDetail,\r\n        damage: grenade.damage,\r\n        knockback: grenade.knockback\r\n      });\r\n      break;\r\n    }\r\n  }\r\n\r\n  dispatchThrowableEvent(\"throwable:detonate\", baseDetail);\r\n}\r\n\r\nfunction updateSmokeClouds(delta) {\r\n  for (const cloud of smokeClouds) {\r\n    cloud.life = Math.max(0, cloud.life - delta);\r\n    const progress = 1 - cloud.life / cloud.duration;\r\n    cloud.radius = clamp(cloud.baseRadius + (cloud.maxRadius - cloud.baseRadius) * clamp(progress, 0, 1), cloud.baseRadius, cloud.maxRadius);\r\n    cloud.tickTimer -= delta;\r\n    if (cloud.tickTimer <= 0) {\r\n      cloud.tickTimer = cloud.tick;\r\n      const effectiveRadius = cloud.radius;\r\n      for (const enemy of enemies) {\r\n        if (enemy.health <= 0) {\r\n          continue;\r\n        }\r\n        const dx = enemy.x - cloud.x;\r\n        const dy = (enemy.y + enemy.height * 0.5) - cloud.y;\r\n        if (Math.hypot(dx, dy) <= effectiveRadius) {\r\n          enemy.smokeSlowTimer = Math.max(enemy.smokeSlowTimer ?? 0, cloud.tick + 0.4);\r\n          enemy.smokeSlowStrength = Math.min(enemy.smokeSlowStrength ?? 1, cloud.slowMultiplier);\r\n        }\r\n      }\r\n      const pose = stickman.currentPose ?? { headRadius: 16, bodyLength: 34, legLength: 36 };\r\n      const playerHeight = getTotalHeight(pose);\r\n      const playerCenterY = stickman.y + playerHeight * 0.6;\r\n      const pdx = stickman.x - cloud.x;\r\n      const pdy = playerCenterY - cloud.y;\r\n      if (Math.hypot(pdx, pdy) <= effectiveRadius) {\r\n        stickman.smokeSlowTimer = Math.max(stickman.smokeSlowTimer ?? 0, cloud.tick + 0.4);\r\n        stickman.smokeSlowStrength = Math.min(stickman.smokeSlowStrength ?? 1, cloud.slowMultiplier + 0.1);\r\n      }\r\n    }\r\n  }\r\n\r\n  for (let i = smokeClouds.length - 1; i >= 0; i -= 1) {\r\n    if (smokeClouds[i].life <= 0) {\r\n      const dissipated = smokeClouds.splice(i, 1)[0];\r\n      dispatchThrowableEvent(\"throwable:smoke-dissipate\", {\r\n        id: dissipated.id,\r\n        x: dissipated.x,\r\n        y: dissipated.y,\r\n        radius: dissipated.maxRadius ?? dissipated.radius\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateThrowables(delta) {\r\n  const envWidth = getEnvironmentWidth();\r\n\r\n  for (const grenade of throwables) {\r\n    if (!grenade.detonated) {\r\n      grenade.fuse -= delta;\r\n      grenade.vy += GRAVITY * grenade.gravityFactor * delta;\r\n      grenade.x += grenade.vx * delta;\r\n      grenade.y += grenade.vy * delta;\r\n\r\n      if (grenade.y + grenade.radius >= GROUND_Y) {\r\n        grenade.y = GROUND_Y - grenade.radius;\r\n        if (grenade.vy > 0) {\r\n          grenade.vy = -grenade.vy * grenade.bounciness;\r\n        }\r\n        grenade.vx *= 0.7;\r\n        if (Math.abs(grenade.vy) < 36) {\r\n          grenade.vy = 0;\r\n        }\r\n      }\r\n\r\n      if (grenade.x - grenade.radius <= 0 || grenade.x + grenade.radius >= envWidth) {\r\n        grenade.x = clamp(grenade.x, grenade.radius, envWidth - grenade.radius);\r\n        grenade.vx = -grenade.vx * 0.45;\r\n      }\r\n\r\n      if (grenade.fuse <= 0) {\r\n        detonate(grenade);\r\n      }\r\n    } else {\r\n      grenade.explosionTimer -= delta;\r\n    }\r\n  }\r\n\r\n  for (let i = throwables.length - 1; i >= 0; i -= 1) {\r\n    if (throwables[i].detonated && throwables[i].explosionTimer <= 0) {\r\n      throwables.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  updateSmokeClouds(delta);\r\n}\r\n\r\nfunction drawSmokeClouds() {\r\n  if (smokeClouds.length === 0) {\r\n    return;\r\n  }\r\n\r\n  context.save();\r\n  for (const cloud of smokeClouds) {\r\n    const lifeRatio = clamp(cloud.life / cloud.duration, 0, 1);\r\n    const radius = cloud.radius;\r\n    const gradient = context.createRadialGradient(cloud.x, cloud.y, radius * 0.15, cloud.x, cloud.y, radius);\r\n    gradient.addColorStop(0, \"rgba(172, 196, 216, 0.35)\");\r\n    gradient.addColorStop(1, \"rgba(40, 52, 64, 0)\");\r\n    context.globalAlpha = lifeRatio;\r\n    context.fillStyle = gradient;\r\n    context.beginPath();\r\n    context.arc(cloud.x, cloud.y, radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction drawThrowables() {\r\n  const elapsed = getElapsedTime();\r\n  context.save();\r\n\r\n  for (const grenade of throwables) {\r\n    if (!grenade.detonated) {\r\n      context.globalAlpha = 1;\r\n      context.fillStyle = grenade.color;\r\n      context.beginPath();\r\n      context.arc(grenade.x, grenade.y, grenade.radius, 0, Math.PI * 2);\r\n      context.fill();\r\n\r\n      const fuseRatio = grenade.maxFuse > 0 ? clamp(grenade.fuse / grenade.maxFuse, 0, 1) : 0;\r\n      context.strokeStyle = \"rgba(255, 232, 194, 0.85)\";\r\n      context.lineWidth = 3;\r\n      context.beginPath();\r\n      context.arc(grenade.x, grenade.y, grenade.radius * 0.65, -Math.PI / 2, -Math.PI / 2 + Math.PI * 2 * fuseRatio);\r\n      context.stroke();\r\n\r\n      const sparkOffsetX = Math.cos(elapsed * 20) * grenade.radius * 0.4;\r\n      const sparkOffsetY = Math.sin(elapsed * 24) * grenade.radius * 0.2 - grenade.radius * 0.8;\r\n      context.fillStyle = \"rgba(255, 240, 210, 0.9)\";\r\n      context.beginPath();\r\n      context.arc(grenade.x + sparkOffsetX, grenade.y + sparkOffsetY, 3.2, 0, Math.PI * 2);\r\n      context.fill();\r\n    } else {\r\n      const duration = Math.max(grenade.explosionDuration, 0.001);\r\n      const progress = clamp(1 - grenade.explosionTimer / duration, 0, 1);\r\n      const alpha = clamp(1 - progress, 0, 1);\r\n\r\n      if (grenade.effectType === \"flash\") {\r\n        const flashRadius = grenade.explosionRadius * (0.8 + progress * 0.5);\r\n        const flashAlpha = Math.max(0, Math.min(1, 0.75 * alpha + 0.15));\r\n        context.fillStyle = `rgba(255, 255, 224, ${flashAlpha.toFixed(3)})`;\r\n        context.beginPath();\r\n        context.arc(grenade.x, grenade.y, flashRadius, 0, Math.PI * 2);\r\n        context.fill();\r\n      } else if (grenade.effectType === \"smoke\") {\r\n        const puffRadius = grenade.explosionRadius * (0.6 + progress * 0.6);\r\n        const puffAlpha = Math.max(0, Math.min(0.65, 0.5 * alpha + 0.1));\r\n        context.fillStyle = `rgba(180, 200, 220, ${puffAlpha.toFixed(3)})`;\r\n        context.beginPath();\r\n        context.arc(grenade.x, grenade.y, puffRadius, 0, Math.PI * 2);\r\n        context.fill();\r\n      } else {\r\n        const outerRadius = grenade.explosionRadius * (0.65 + progress * 0.4);\r\n        const ringAlpha = Math.max(0, Math.min(1, 0.7 * alpha));\r\n        context.strokeStyle = `rgba(255, 196, 120, ${ringAlpha.toFixed(3)})`;\r\n        context.lineWidth = 6 * (1 - progress * 0.6);\r\n        context.beginPath();\r\n        context.arc(grenade.x, grenade.y, outerRadius, 0, Math.PI * 2);\r\n        context.stroke();\r\n\r\n        const coreAlpha = Math.max(0, Math.min(1, 0.75 * alpha));\r\n        context.fillStyle = `rgba(255, 118, 64, ${coreAlpha.toFixed(3)})`;\r\n        context.beginPath();\r\n        context.arc(grenade.x, grenade.y, outerRadius * 0.6, 0, Math.PI * 2);\r\n        context.fill();\r\n      }\r\n    }\r\n  }\r\n\r\n  context.restore();\r\n  drawSmokeClouds();\r\n}\r\n\r\nexport { throwEquippedWeapon, updateThrowables, drawThrowables };\r\n\r\n\r\n\r\n\r\n\r\n\r\n","const SUPPLY_DROP_TYPES = {\r\n  ammo: {\r\n    id: \"ammo\",\r\n    label: \"Ammo Cache\",\r\n    description: \"Refills magazines and reserves for all weapons.\",\r\n    weight: 0.45,\r\n    crateColor: \"#4d7cff\",\r\n    glowColor: \"#b5c8ff\",\n    materialsReward: 20\r\n  },\r\n  medkit: {\r\n    id: \"medkit\",\r\n    label: \"Field Medkit\",\r\n    description: \"Restores health and grants brief damage resistance.\",\r\n    weight: 0.35,\r\n    crateColor: \"#ff6f6f\",\r\n    glowColor: \"#ffb4b4\",\n    materialsReward: 25\r\n  },\r\n  heavy: {\r\n    id: \"heavy\",\r\n    label: \"Heavy Arsenal\",\r\n    description: \"Drops a powerful heavy weapon with fresh ammo.\",\r\n    weight: 0.2,\r\n    crateColor: \"#ffb347\",\r\n    glowColor: \"#ffe0a3\",\n    weaponId: \"thunderCannon\",\n    materialsReward: 35,\r\n    weaponId: \"thunderCannon\"\r\n  }\r\n};\r\n\r\nconst SUPPLY_DROP_SETTINGS = {\r\n  initialDelay: 18,\r\n  intervalMin: 26,\r\n  intervalMax: 38,\r\n  maxActiveDrops: 3,\r\n  spawnHeight: 280,\r\n  driftSpeed: 18,\r\n  descentAcceleration: 140,\r\n  maxDescentSpeed: 180,\r\n  pickupRadius: 68,\r\n  despawnDelay: 12,\r\n  collectedFanfare: 3.5,\r\n  warningLead: 6,\r\n  armorBoostDuration: 6,\r\n  armorBoostValue: 0.4\r\n};\r\n\r\nexport { SUPPLY_DROP_TYPES, SUPPLY_DROP_SETTINGS };\r\n","import { addMaterials, spawnSalvagePickup } from \"../../state/resources.js\";\r\n\r\nimport { canvas, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { stickman, getTotalHeight } from \"../../state/entities.js\";\r\nimport { WEAPON_DEFINITIONS } from \"../../config/weapons.js\";\r\nimport { SUPPLY_DROP_TYPES, SUPPLY_DROP_SETTINGS } from \"../../config/supplyDrops.js\";\r\nimport { ensureAmmoEntry, refillWeaponAmmo } from \"../../state/ammo.js\";\r\nimport { getWeaponInventory, addWeaponToInventory } from \"../../state/weapons.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst supplyDrops = [];\r\nconst manager = {\r\n  nextDropTimer: SUPPLY_DROP_SETTINGS.initialDelay,\r\n  nextDropTypeId: chooseWeightedType(),\r\n  incomingMessage: null,\r\n  incomingTimer: 0,\r\n  incomingDuration: 3,\r\n  rewardMessage: null,\r\n  rewardTimer: 0,\r\n  rewardDuration: SUPPLY_DROP_SETTINGS.collectedFanfare,\r\n  dropSequence: 0\r\n};\r\n\r\nfunction randomBetween(min, max) {\r\n  return min + Math.random() * (max - min);\r\n}\r\n\r\nfunction chooseWeightedType() {\r\n  const entries = Object.values(SUPPLY_DROP_TYPES);\r\n  if (entries.length === 0) {\r\n    return null;\r\n  }\r\n  const totalWeight = entries.reduce((sum, entry) => sum + (entry.weight ?? 1), 0);\r\n  let roll = Math.random() * totalWeight;\r\n  for (const entry of entries) {\r\n    const weight = entry.weight ?? 1;\r\n    if (roll <= weight) {\r\n      return entry.id;\r\n    }\r\n    roll -= weight;\r\n  }\r\n  return entries[entries.length - 1].id;\r\n}\r\n\r\nfunction scheduleNextDrop() {\r\n  manager.nextDropTimer = randomBetween(SUPPLY_DROP_SETTINGS.intervalMin, SUPPLY_DROP_SETTINGS.intervalMax);\r\n  manager.nextDropTypeId = chooseWeightedType();\r\n}\r\n\r\nfunction spawnSupplyDrop(typeId) {\r\n  const definition = SUPPLY_DROP_TYPES[typeId] ?? SUPPLY_DROP_TYPES.ammo;\r\n  const width = 52;\r\n  const height = 42;\r\n  const envWidth = getEnvironmentWidth();\n  const clampedWidth = Math.max(width * 0.6, envWidth * 0.05);\n  const dropRange = Math.max(0, envWidth - clampedWidth * 2);\n  const x = clamp(envWidth * (0.2 + Math.random() * 0.6), clampedWidth, envWidth - clampedWidth);\r\n  const spawnY = -SUPPLY_DROP_SETTINGS.spawnHeight;\r\n  const drop = {\r\n    id: `supply-${manager.dropSequence += 1}`,\r\n    typeId: definition.id,\r\n    label: definition.label,\r\n    description: definition.description,\r\n    crateColor: definition.crateColor ?? \"#4d7cff\",\r\n    glowColor: definition.glowColor ?? \"#9ab5ff\",\r\n    width,\r\n    height,\r\n    x,\r\n    y: spawnY,\r\n    vx: (Math.random() * 2 - 1) * SUPPLY_DROP_SETTINGS.driftSpeed,\r\n    vy: 0,\r\n    state: \"descending\",\r\n    timer: 0,\r\n    highlight: 0,\r\n    despawnTimer: SUPPLY_DROP_SETTINGS.despawnDelay,\r\n    parachutePhase: 0\r\n  };\r\n  supplyDrops.push(drop);\r\n  manager.incomingMessage = `${definition.label} inbound!`;\r\n  manager.incomingTimer = manager.incomingDuration;\r\n}\r\n\r\nfunction applyAmmoReward() {\r\n  const inventory = getWeaponInventory();\r\n  for (const weaponId of inventory) {\r\n    const entry = ensureAmmoEntry(weaponId);\r\n    if (!entry || entry.capacity === Number.POSITIVE_INFINITY) {\r\n      continue;\r\n    }\r\n    refillWeaponAmmo(weaponId);\r\n  }\r\n  stickman.reloading = false;\r\n}\r\n\r\nfunction applyMedkitReward() {\r\n  const healAmount = 70;\r\n  stickman.health = Math.min(stickman.maxHealth, stickman.health + healAmount);\r\n  stickman.invulnerability = Math.max(stickman.invulnerability, SUPPLY_DROP_SETTINGS.armorBoostValue ?? 0.4);\r\n}\r\n\r\nfunction applyHeavyWeaponReward() {\r\n  const heavyType = SUPPLY_DROP_TYPES.heavy;\r\n  const weaponId = heavyType?.weaponId ?? null;\r\n  if (weaponId && WEAPON_DEFINITIONS[weaponId]) {\r\n    addWeaponToInventory(weaponId, { autoEquip: true });\r\n    ensureAmmoEntry(weaponId);\r\n    refillWeaponAmmo(weaponId);\r\n  }\r\n}\r\n\r\nfunction applySupplyDropReward(typeId) {\r\n  switch (typeId) {\r\n    case \"medkit\":\r\n      applyMedkitReward();\r\n      manager.rewardMessage = \"Health restored\";\r\n      break;\r\n    case \"heavy\":\r\n      applyHeavyWeaponReward();\r\n      manager.rewardMessage = \"Heavy weapon acquired\";\r\n      break;\r\n    case \"ammo\":\r\n    default:\r\n      applyAmmoReward();\r\n      manager.rewardMessage = \"Ammo resupply\";\r\n      break;\r\n  }\r\n  manager.rewardTimer = manager.rewardDuration;\r\n  const rewardType = SUPPLY_DROP_TYPES[typeId];\r\n  if (rewardType?.materialsReward) {\r\n    const immediateGain = Math.max(0, Math.round(rewardType.materialsReward * 0.7));\r\n    if (immediateGain > 0) {\r\n      addMaterials(immediateGain);\r\n      manager.rewardMessage = `${manager.rewardMessage} (+${immediateGain} materials)`;\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateHighlight(drop, delta) {\r\n  const playerX = stickman.x;\r\n  const pose = stickman.currentPose ?? POSES.standing;\r\n  const playerFeetY = stickman.y + getTotalHeight(pose);\r\n  const crateCenterX = drop.x;\r\n  const crateCenterY = drop.y + drop.height * 0.5;\r\n  const dx = playerX - crateCenterX;\r\n  const dy = playerFeetY - crateCenterY;\r\n  const distance = Math.hypot(dx, dy);\r\n  if (distance <= SUPPLY_DROP_SETTINGS.pickupRadius) {\r\n    drop.highlight = clamp(drop.highlight + delta * 4, 0, 1);\r\n    return true;\r\n  }\r\n  drop.highlight = clamp(drop.highlight - delta * 2, 0, 1);\r\n  return false;\r\n}\r\n\r\nfunction pickupDrop(drop) {\r\n  applySupplyDropReward(drop.typeId);\r\n  drop.state = \"collected\";\r\n  drop.despawnTimer = SUPPLY_DROP_SETTINGS.collectedFanfare;\r\n  drop.highlight = 1;\r\n  const rewardMaterials = SUPPLY_DROP_TYPES[drop.typeId]?.materialsReward ?? 0;\r\n  if (rewardMaterials > 0) {\r\n    const salvagePortion = Math.max(0, Math.round(rewardMaterials * 0.3));\r\n    if (salvagePortion > 0) {\r\n      const chunks = Math.max(1, Math.round(salvagePortion / 12));\r\n      const amountPer = Math.max(1, Math.round(salvagePortion / chunks));\r\n      for (let i = 0; i < chunks; i += 1) {\r\n        const jitter = (Math.random() - 0.5) * 60;\r\n        spawnSalvagePickup({\r\n          x: drop.x + jitter,\r\n          y: drop.y,\r\n          amount: amountPer,\r\n          vy: -160 - Math.random() * 60\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\nfunction updateSupplyDrops(delta) {\r\n  if (manager.nextDropTimer <= 0 && supplyDrops.length < SUPPLY_DROP_SETTINGS.maxActiveDrops) {\r\n    spawnSupplyDrop(manager.nextDropTypeId);\r\n    scheduleNextDrop();\r\n  }\r\n\r\n  if (manager.incomingTimer > 0) {\r\n    manager.incomingTimer = Math.max(0, manager.incomingTimer - delta);\r\n  }\r\n  if (manager.rewardTimer > 0) {\r\n    manager.rewardTimer = Math.max(0, manager.rewardTimer - delta);\r\n  }\r\n\r\n  for (let i = supplyDrops.length - 1; i >= 0; i -= 1) {\r\n    const drop = supplyDrops[i];\r\n    drop.timer += delta;\r\n    if (drop.state === \"descending\") {\r\n      drop.vy = Math.min(SUPPLY_DROP_SETTINGS.maxDescentSpeed, drop.vy + SUPPLY_DROP_SETTINGS.descentAcceleration * delta);\r\n      drop.y += drop.vy * delta;\r\n      const envWidth = getEnvironmentWidth();\n      drop.x = clamp(drop.x + drop.vx * delta, drop.width * 0.5, envWidth - drop.width * 0.5);\r\n      drop.parachutePhase += delta;\r\n      if (drop.y >= GROUND_Y - drop.height) {\r\n        drop.y = GROUND_Y - drop.height;\r\n        drop.vy = 0;\r\n        drop.state = \"ready\";\r\n        drop.timer = 0;\r\n      }\r\n    } else if (drop.state === \"ready\") {\r\n      const withinPickup = updateHighlight(drop, delta);\r\n      if (withinPickup) {\r\n        pickupDrop(drop);\r\n      } else {\r\n        drop.despawnTimer -= delta;\r\n        if (drop.despawnTimer <= 0) {\r\n          supplyDrops.splice(i, 1);\r\n          continue;\r\n        }\r\n      }\r\n    } else if (drop.state === \"collected\") {\r\n      drop.highlight = clamp(drop.highlight - delta * 0.6, 0, 1);\r\n      drop.despawnTimer -= delta;\r\n      if (drop.despawnTimer <= 0) {\r\n        supplyDrops.splice(i, 1);\r\n        continue;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction getSupplyDrops() {\r\n  return supplyDrops;\r\n}\r\n\r\nfunction getSupplyDropStatus() {\r\n  return {\r\n    timeUntilNext: Math.max(0, manager.nextDropTimer),\r\n    nextDropLabel: SUPPLY_DROP_TYPES[manager.nextDropTypeId]?.label ?? null,\r\n    incomingMessage: manager.incomingTimer > 0 ? manager.incomingMessage : null,\r\n    incomingAlpha: manager.incomingTimer > 0 ? manager.incomingTimer / manager.incomingDuration : 0,\r\n    rewardMessage: manager.rewardTimer > 0 ? manager.rewardMessage : null,\r\n    rewardAlpha: manager.rewardTimer > 0 ? manager.rewardTimer / manager.rewardDuration : 0,\r\n    activeCount: supplyDrops.length\r\n  };\r\n}\r\n\r\nexport { updateSupplyDrops, getSupplyDrops, getSupplyDropStatus };\r\n\r\n","\r\nimport { context } from \"../../environment/canvas.js\";\r\nimport { SUPPLY_DROP_SETTINGS, SUPPLY_DROP_TYPES } from \"../../config/supplyDrops.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { getSupplyDrops } from \"../world/supplyDrops.js\";\r\n\r\nfunction drawCrate(drop) {\r\n  const baseAlpha = drop.state === \"collected\" ? clamp(drop.despawnTimer / SUPPLY_DROP_SETTINGS.collectedFanfare, 0, 1) : 1;\r\n  context.save();\r\n  context.globalAlpha = baseAlpha;\r\n\r\n  if (drop.state === \"descending\") {\r\n    const parachuteWidth = drop.width * 1.8;\r\n    const canopyHeight = drop.height * 0.9;\r\n    context.fillStyle = drop.glowColor;\r\n    context.beginPath();\r\n    context.moveTo(drop.x - parachuteWidth * 0.5, drop.y + canopyHeight * 0.2);\r\n    context.quadraticCurveTo(drop.x, drop.y - canopyHeight * 0.8, drop.x + parachuteWidth * 0.5, drop.y + canopyHeight * 0.2);\r\n    context.closePath();\r\n    context.fill();\r\n\r\n    context.strokeStyle = drop.glowColor;\r\n    context.lineWidth = 2;\r\n    context.beginPath();\r\n    context.moveTo(drop.x - parachuteWidth * 0.3, drop.y + canopyHeight * 0.25);\r\n    context.lineTo(drop.x - drop.width * 0.25, drop.y + drop.height * 0.1);\r\n    context.moveTo(drop.x + parachuteWidth * 0.3, drop.y + canopyHeight * 0.25);\r\n    context.lineTo(drop.x + drop.width * 0.25, drop.y + drop.height * 0.1);\r\n    context.stroke();\r\n  }\r\n\r\n  const topColor = drop.glowColor;\r\n  const bodyColor = drop.crateColor;\r\n  const highlightAlpha = drop.highlight ?? 0;\r\n\r\n  context.fillStyle = bodyColor;\r\n  context.fillRect(drop.x - drop.width * 0.5, drop.y, drop.width, drop.height);\r\n  context.fillStyle = topColor;\r\n  context.fillRect(drop.x - drop.width * 0.5, drop.y - drop.height * 0.25, drop.width, drop.height * 0.25);\r\n\r\n  context.strokeStyle = \"rgba(12, 16, 24, 0.65)\";\r\n  context.lineWidth = 3;\r\n  context.strokeRect(drop.x - drop.width * 0.5, drop.y, drop.width, drop.height);\r\n\r\n  if (highlightAlpha > 0) {\r\n    context.globalAlpha = highlightAlpha * 0.6;\r\n    context.fillStyle = drop.glowColor;\r\n    context.beginPath();\r\n    context.arc(drop.x, drop.y + drop.height * 0.5, SUPPLY_DROP_SETTINGS.pickupRadius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n\r\n  context.restore();\r\n}\r\n\r\nfunction drawSupplyDrops() {\r\n  const drops = getSupplyDrops();\r\n  if (drops.length === 0) {\r\n    return;\r\n  }\r\n\r\n  context.save();\r\n  context.textAlign = \"center\";\r\n  context.font = \"15px 'Segoe UI', Arial, sans-serif\";\r\n\r\n  for (const drop of drops) {\r\n    drawCrate(drop);\r\n    const typeDef = SUPPLY_DROP_TYPES[drop.typeId];\r\n    if (drop.state !== \"descending\") {\r\n      context.fillStyle = drop.glowColor;\r\n      context.globalAlpha = 0.9;\r\n      context.fillText(typeDef?.label ?? drop.label ?? \"Supply Drop\", drop.x, drop.y - 16);\r\n    }\r\n  }\r\n\r\n  context.restore();\r\n}\r\n\r\nexport { drawSupplyDrops };\r\n","import { context } from \"../../environment/canvas.js\";\nimport { getDestructibles } from \"../../state/destructibles.js\";\nimport { getElapsedTime } from \"../utils/time.js\";\nimport { clamp } from \"../utils/math.js\";\n\nfunction drawBarrierBody(destructible, template, elapsed) {\n  const width = destructible.width;\n  const height = destructible.height;\n  const top = -height;\n  const bodyColor = template.bodyColor ?? \"#555\";\n  const accentColor = template.accentColor ?? \"#888\";\n  const edgeColor = template.edgeColor ?? \"#333\";\n  const crackColor = template.damageHighlight ?? \"#d5dde8\";\n  const damageRatio = clamp(1 - (destructible.health / destructible.maxHealth), 0, 1);\n  context.fillStyle = bodyColor;\n  context.fillRect(-width / 2, top, width, height);\n\n  context.fillStyle = accentColor;\n  context.fillRect(-width / 2, top, width, Math.max(10, height * 0.12));\n  context.fillRect(-width / 2, top + height * 0.55, width, Math.max(8, height * 0.1));\n\n  context.strokeStyle = edgeColor;\n  context.lineWidth = 4;\n  context.strokeRect(-width / 2, top, width, height);\n\n  if (damageRatio > 0) {\n    const crackCount = 3 + Math.floor(damageRatio * 3);\n    const phase = elapsed * 3 + destructible.x * 0.02;\n    context.strokeStyle = crackColor;\n    context.lineWidth = 2;\n    for (let i = 0; i < crackCount; i += 1) {\n      const offset = (i + 1) / (crackCount + 1);\n      const startX = -width * 0.45 + width * offset;\n      const crackHeight = height * (0.2 + damageRatio * 0.5);\n      const wobble = Math.sin(phase + i * 1.7) * 12;\n      context.beginPath();\n      context.moveTo(startX, top + height * 0.18);\n      context.lineTo(startX + wobble * 0.3, top + height * 0.18 + crackHeight * 0.45);\n      context.lineTo(startX + wobble, top + height * 0.18 + crackHeight);\n      context.stroke();\n    }\n  }\n}\n\nfunction drawRubble(destructible, template, progress) {\n  const width = destructible.width;\n  const rubbleHeight = Math.max(8, (template.rubbleHeight ?? 32) * progress);\n  const debrisColor = template.debrisColor ?? template.bodyColor ?? \"#4a4a4a\";\n  context.fillStyle = debrisColor;\n  context.beginPath();\n  context.moveTo(-width / 2, 0);\n  context.lineTo(-width * 0.35, -rubbleHeight * 0.3);\n  context.lineTo(-width * 0.12, -rubbleHeight);\n  context.lineTo(width * 0.08, -rubbleHeight * 0.65);\n  context.lineTo(width * 0.32, -rubbleHeight * 0.9);\n  context.lineTo(width / 2, 0);\n  context.closePath();\n  context.fill();\n\n  context.fillStyle = \"rgba(30, 32, 40, 0.6)\";\n  context.fillRect(-width / 2, 0, width, Math.max(6, rubbleHeight * 0.2));\n}\n\nfunction drawStreetCar(destructible, template, elapsed) {\n  const width = destructible.width;\n  const height = destructible.height;\n  const top = -height;\n  const facing = destructible.facing ?? 1;\n  const damageRatio = clamp(1 - (destructible.health / destructible.maxHealth), 0, 1);\n\n  context.save();\n  context.scale(facing, 1);\n\n  const bodyColor = template.bodyColor ?? \"#b13d30\";\n  const windowColor = template.glassColor ?? \"#4ac3ff\";\n  const accentColor = template.accentColor ?? \"#f7f9ff\";\n  const edgeColor = template.edgeColor ?? \"#1c1d25\";\n\n  const bodyTop = top + height * 0.15;\n  const cabinHeight = height * 0.55;\n  const wheelRadius = Math.max(12, height * 0.18);\n\n  context.fillStyle = bodyColor;\n  context.beginPath();\n  context.moveTo(-width / 2, bodyTop + height * 0.1);\n  context.lineTo(-width * 0.42, top + cabinHeight * 0.45);\n  context.lineTo(-width * 0.25, top);\n  context.lineTo(width * 0.22, top);\n  context.lineTo(width * 0.45, top + cabinHeight * 0.5);\n  context.lineTo(width / 2, bodyTop + height * 0.1);\n  context.closePath();\n  context.fill();\n\n  context.fillStyle = windowColor;\n  const windowHeight = cabinHeight * 0.55;\n  context.fillRect(-width * 0.28, top + cabinHeight * 0.12, width * 0.42, windowHeight);\n\n  context.fillStyle = accentColor;\n  context.fillRect(-width / 2, bodyTop + cabinHeight * 0.55, width, height * 0.2);\n\n  context.fillStyle = edgeColor;\n  context.beginPath();\n  context.arc(-width * 0.28, wheelRadius * -0.15, wheelRadius, 0, Math.PI * 2);\n  context.arc(width * 0.28, wheelRadius * -0.15, wheelRadius, 0, Math.PI * 2);\n  context.fill();\n\n  if (!destructible.destroyed && damageRatio > 0.05) {\n    context.strokeStyle = \"rgba(0, 0, 0, 0.35)\";\n    context.lineWidth = 2;\n    context.beginPath();\n    context.moveTo(-width * 0.12, top + cabinHeight * 0.8);\n    context.lineTo(-width * 0.22, bodyTop + height * 0.55);\n    context.lineTo(-width * 0.05, bodyTop + height * 0.7);\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(width * 0.18, top + cabinHeight * 0.6);\n    context.lineTo(width * 0.3, bodyTop + height * 0.4);\n    context.lineTo(width * 0.12, bodyTop + height * 0.65);\n    context.stroke();\n  }\n\n  context.restore();\n}\r\nfunction drawBarrelCluster(destructible, template, elapsed) {\n  const width = destructible.width;\n  const height = destructible.height;\n  const damageRatio = clamp(1 - (destructible.health / destructible.maxHealth), 0, 1);\n  const barrelRadius = width * 0.22;\n  const barrelHeight = height * 0.48;\n  const top = -height;\n  const bodyColor = template.bodyColor ?? \"#c0671c\";\n  const stripeColor = template.stripeColor ?? template.accentColor ?? \"#ffd45f\";\n  const edgeColor = template.edgeColor ?? \"#2f1a08\";\n\n  const positions = [\n    { x: -width * 0.22, y: top + height * 0.45 },\n    { x: width * 0.22, y: top + height * 0.5 },\n    { x: 0, y: top + height * 0.1 }\n  ];\n\n  const visibleCount = destructible.destroyed ? 1 : 3;\n  for (let i = 0; i < visibleCount; i += 1) {\n    const pos = positions[i];\n    context.save();\n    context.translate(pos.x, pos.y);\n    context.fillStyle = bodyColor;\n    context.beginPath();\n    context.ellipse(0, 0, barrelRadius, barrelHeight * 0.5, 0, 0, Math.PI * 2);\n    context.fill();\n\n    context.fillRect(-barrelRadius, -barrelHeight * 0.5, barrelRadius * 2, barrelHeight);\n\n    context.fillStyle = stripeColor;\n    context.fillRect(-barrelRadius, -barrelHeight * 0.12, barrelRadius * 2, barrelHeight * 0.24);\n\n    context.strokeStyle = edgeColor;\n    context.lineWidth = 3;\n    context.strokeRect(-barrelRadius, -barrelHeight * 0.5, barrelRadius * 2, barrelHeight);\n    context.restore();\n  }\n\n  if (!destructible.destroyed && damageRatio > 0.2) {\n    const flicker = 0.2 + Math.abs(Math.sin(elapsed * 8 + destructible.x * 0.05)) * 0.3 * damageRatio;\n    context.fillStyle = `rgba(255, 174, 72, ${flicker.toFixed(3)})`;\n    context.beginPath();\n    context.ellipse(0, top + height * 0.1, width * 0.12, height * 0.18, 0, 0, Math.PI * 2);\n    context.fill();\n  }\n}\r\nfunction drawHealthTick(width, ratio, yOffset) {\n  const clamped = clamp(ratio, 0, 1);\n  const barWidth = width * 0.85;\n  context.fillStyle = \"rgba(0, 0, 0, 0.45)\";\n  context.fillRect(-barWidth / 2, yOffset, barWidth, 5);\n  context.fillStyle = clamped > 0.5 ? \"#58ec8c\" : clamped > 0.25 ? \"#ffd15c\" : \"#ff675c\";\n  context.fillRect(-barWidth / 2, yOffset, barWidth * clamped, 5);\n}\n\nfunction drawSmokeColumn(destructible, template, elapsed) {\n  if ((destructible.smokeTimer ?? 0) <= 0) {\n    return;\n  }\n  const duration = template.smokeDuration ?? 1.5;\n  const lifeRatio = clamp((destructible.smokeTimer ?? 0) / duration, 0, 1);\n  const baseAlpha = 0.25 + lifeRatio * 0.35;\n  const layers = 4;\n  for (let i = 0; i < layers; i += 1) {\n    const phase = elapsed * (0.4 + i * 0.15) + destructible.x * 0.03 + i * 1.3;\n    const radius = (destructible.width * 0.35) * (1 + lifeRatio * 0.6 + i * 0.15);\n    context.globalAlpha = clamp(baseAlpha - i * 0.06, 0, 0.45);\n    context.fillStyle = \"#9fb6c8\";\n    context.beginPath();\n    context.arc(\n      Math.sin(phase) * destructible.width * 0.12,\n      -destructible.height * (0.65 + i * 0.2) - Math.cos(phase * 0.6) * 6,\n      radius * 0.3,\n      0,\n      Math.PI * 2\n    );\n    context.fill();\n  }\n  context.globalAlpha = 1;\n}\n\nfunction drawDestructible(destructible, elapsed) {\n  const template = destructible.template;\n  if (!template) {\n    return;\n  }\n\n  const shakeMag = destructible.shakeMagnitude ?? 0;\n  const shakeTimer = destructible.shakeTimer ?? 0;\n  const wobblePhase = elapsed * 8 + destructible.x * 0.05;\n  const shakeX = shakeTimer > 0 ? Math.sin(wobblePhase) * shakeMag * 0.35 : 0;\n  const shakeY = shakeTimer > 0 ? Math.cos(wobblePhase * 0.75) * shakeMag * 0.22 : 0;\n\n  context.save();\n  context.translate(destructible.x + shakeX, destructible.y + shakeY);\n\n  if (destructible.destroyed) {\n    drawRubble(destructible, template, clamp(destructible.rubbleLevel ?? 0, 0, 1));\n  }\n\n  if (!destructible.destroyed || (destructible.rubbleLevel ?? 0) < 1) {\n    switch (template.material) {\n      case \"vehicle\":\n        drawStreetCar(destructible, template, elapsed);\n        break;\n      case \"volatile\":\n        drawBarrelCluster(destructible, template, elapsed);\n        break;\n      default:\n        drawBarrierBody(destructible, template, elapsed);\n        break;\n    }\n  }\n\n  if (!destructible.destroyed && destructible.maxHealth > 0) {\n    const healthRatio = clamp(destructible.health / destructible.maxHealth, 0, 1);\n    if (healthRatio < 0.95) {\n      drawHealthTick(destructible.width, healthRatio, -destructible.height - 10);\n    }\n  }\n\n  const flashTimer = destructible.flashTimer ?? 0;\n  if (flashTimer > 0) {\n    const alpha = clamp(flashTimer / 0.2, 0, 1) * 0.45;\n    context.fillStyle = `rgba(255, 255, 255, ${alpha.toFixed(3)})`;\n    context.fillRect(-destructible.width / 2, -destructible.height, destructible.width, destructible.height);\n  }\n\n  drawSmokeColumn(destructible, template, elapsed);\n  context.restore();\n}\n\nfunction drawDestructibles() {\n  const elapsed = getElapsedTime();\n  const items = getDestructibles();\n  if (!items || items.length === 0) {\n    return;\n  }\n\n  context.save();\n  for (const destructible of items) {\n    drawDestructible(destructible, elapsed);\n  }\n  context.restore();\n}\n\nexport { drawDestructibles };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { BUILDING_DEFINITIONS } from \"../../config/buildings.js\";\r\nimport { spendMaterials, getMaterialCount, spawnSalvagePickup } from \"../../state/resources.js\";\r\nimport { getEnvironmentPlatforms, getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { stickman, squadmates, enemies } from \"../../state/entities.js\";\r\nimport { GROUND_Y, canvas } from \"../../environment/canvas.js\";\r\nimport {\r\n  getStructures,\r\n  addStructure,\r\n  getBuildState,\r\n  getBuildingDefinitions,\r\n  getBlueprintByIndex,\r\n  resetStructures\r\n} from \"../../state/buildings.js\";\r\nimport { spawnProjectile } from \"../combat/projectiles.js\";\r\nimport { applyDamageToEnemy } from \"../combat/damageHandlers.js\";\r\nimport { spawnRingBurst } from \"../effects/particles.js\";\r\nimport { spawnDynamicLight } from \"../effects/lighting.js\";\r\nimport { input } from \"../input/index.js\";\r\n\r\nconst GRID_SIZE = 20;\r\n\r\nfunction snapToGrid(value) {\r\n  return Math.round(value / GRID_SIZE) * GRID_SIZE;\r\n}\r\n\r\nfunction getGroundYAt(x, halfWidth) {\r\n  let bestY = GROUND_Y;\r\n  const platforms = getEnvironmentPlatforms();\r\n  for (const platform of platforms) {\r\n    const left = platform.x - halfWidth;\r\n    const right = platform.x + platform.width + halfWidth;\r\n    if (x >= left && x <= right && platform.y < bestY) {\r\n      bestY = platform.y;\r\n    }\r\n  }\r\n  return bestY;\r\n}\r\n\r\nfunction clampBlueprintIndex(index) {\r\n  const defs = getBuildingDefinitions();\r\n  if (defs.length === 0) {\r\n    return 0;\r\n  }\r\n  return ((index % defs.length) + defs.length) % defs.length;\r\n}\r\n\r\nfunction cycleBlueprint(direction) {\r\n  const state = getBuildState();\r\n  state.blueprintIndex = clampBlueprintIndex(state.blueprintIndex + direction);\r\n}\r\n\r\nfunction calculatePreview() {\r\n  const state = getBuildState();\r\n  const blueprint = getBlueprintByIndex(state.blueprintIndex);\r\n  if (!blueprint) {\r\n    state.lastPreview.valid = false;\r\n    return state.lastPreview;\r\n  }\r\n  const halfWidth = (blueprint.width ?? 120) / 2;\r\n  const rawX = snapToGrid(stickman.x + stickman.facing * Math.max(140, halfWidth + 30));\r\n  const envWidth = getEnvironmentWidth();\n  const clampedX = Math.max(halfWidth + 30, Math.min(envWidth - halfWidth - 30, rawX));\r\n  const groundY = getGroundYAt(clampedX, halfWidth);\r\n  const cost = blueprint.cost ?? 0;\r\n  state.lastPreview = {\r\n    x: clampedX,\r\n    y: groundY,\r\n    width: blueprint.width,\r\n    height: blueprint.height,\r\n    blueprintId: blueprint.id,\r\n    cost,\r\n    color: blueprint.color,\r\n    accentColor: blueprint.accentColor,\r\n    strokeColor: blueprint.strokeColor,\r\n    ambient: blueprint.ambient ?? null,\r\n    valid: getMaterialCount() >= cost\r\n  };\r\n  return state.lastPreview;\r\n}\r\n\r\nfunction createStructureFromBlueprint(blueprint, preview) {\r\n  return {\r\n    id: `${blueprint.id}-${Date.now().toString(36)}-${Math.floor(Math.random() * 1000)}`,\r\n    type: blueprint.id,\r\n    x: preview.x,\r\n    y: preview.y,\r\n    width: blueprint.width,\r\n    height: blueprint.height,\r\n    health: blueprint.maxHealth,\r\n    maxHealth: blueprint.maxHealth,\r\n    color: blueprint.color,\r\n    accentColor: blueprint.accentColor,\r\n    strokeColor: blueprint.strokeColor,\r\n    ambient: blueprint.ambient ?? null,\r\n    blocking: blueprint.blocking ?? false,\r\n    turret: blueprint.turret ?? null,\r\n    shield: blueprint.shield ?? null,\r\n    trap: blueprint.trap ?? null,\r\n    fireCooldown: 0,\r\n    trapCooldown: 0,\r\n    flashTimer: 0\r\n  };\r\n}\r\n\r\nfunction placeStructure() {\r\n  const state = getBuildState();\r\n  const preview = calculatePreview();\r\n  if (!preview.valid) {\r\n    return false;\r\n  }\r\n  const blueprint = getBlueprintByIndex(state.blueprintIndex);\r\n  if (!blueprint) {\r\n    return false;\r\n  }\r\n  if (!spendMaterials(blueprint.cost ?? 0)) {\r\n    state.lastPreview.valid = false;\r\n    return false;\r\n  }\r\n  const structure = createStructureFromBlueprint(blueprint, preview);\r\n  addStructure(structure);\r\n  spawnRingBurst({\r\n    x: structure.x,\r\n    y: structure.y - (structure.height ?? 80),\r\n    startRadius: 20,\r\n    endRadius: Math.max(90, structure.width ?? 120),\r\n    color: blueprint.accentColor ?? \"#8cffd4\",\r\n    ttl: 0.35\r\n  });\r\n  return true;\r\n}\r\n\r\nfunction toggleBuildMode(forceState) {\r\n  const state = getBuildState();\r\n  if (typeof forceState === \"boolean\") {\r\n    state.active = forceState;\r\n  } else {\r\n    state.active = !state.active;\r\n  }\r\n  if (!state.active) {\r\n    state.lastPreview.valid = false;\r\n  } else {\r\n    calculatePreview();\r\n  }\r\n}\r\n\r\nfunction handleBuildInputs() {\r\n  const state = getBuildState();\r\n  if (input.buildToggleBuffered) {\r\n    toggleBuildMode();\r\n    input.buildToggleBuffered = false;\r\n  }\r\n  if (!state.active) {\r\n    input.buildCycleBuffered = 0;\r\n    input.buildConfirmBuffered = false;\r\n    input.buildCancelBuffered = false;\r\n    return;\r\n  }\r\n  if (input.buildCycleBuffered !== 0) {\r\n    cycleBlueprint(input.buildCycleBuffered);\r\n    input.buildCycleBuffered = 0;\r\n    calculatePreview();\r\n  }\r\n  if (input.buildCancelBuffered) {\r\n    toggleBuildMode(false);\r\n    input.buildCancelBuffered = false;\r\n  }\r\n  if (input.buildConfirmBuffered || input.attackBuffered) {\r\n    if (placeStructure()) {\r\n      input.buildConfirmBuffered = false;\r\n      input.attackBuffered = false;\r\n      input.attackDown = false;\r\n      calculatePreview();\r\n    } else {\r\n      input.buildConfirmBuffered = false;\r\n      input.attackBuffered = false;\r\n    }\r\n  }\r\n}\r\n\r\nfunction damageStructure(structure, amount) {\r\n  if (!structure || amount <= 0) {\r\n    return;\r\n  }\r\n  structure.health = Math.max(0, structure.health - amount);\r\n  structure.flashTimer = 0.25;\r\n}\r\n\r\nfunction destroyStructure(structures, index, structure) {\r\n  spawnRingBurst({\r\n    x: structure.x,\r\n    y: structure.y - (structure.height ?? 80),\r\n    startRadius: 30,\r\n    endRadius: Math.max(120, (structure.width ?? 120) * 1.4),\r\n    color: structure.accentColor ?? \"#ffb347\",\r\n    ttl: 0.4\r\n  });\r\n  structures.splice(index, 1);\r\n  const salvage = Math.max(5, Math.round((structure.maxHealth ?? 200) / 15));\r\n  spawnSalvagePickup({\r\n    x: structure.x,\r\n    y: structure.y - (structure.height ?? 80),\r\n    amount: salvage,\r\n    vy: -150\r\n  });\r\n}\r\n\r\nfunction updateTurret(structure, delta) {\r\n  const turret = structure.turret;\r\n  if (!turret) {\r\n    return;\r\n  }\r\n  structure.fireCooldown = Math.max(0, (structure.fireCooldown ?? 0) - delta);\r\n  if (structure.fireCooldown > 0) {\r\n    return;\r\n  }\r\n  let bestEnemy = null;\r\n  let bestDist = Number.POSITIVE_INFINITY;\r\n  const muzzleY = structure.y - (structure.height ?? 100) + 24;\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const dx = enemy.x - structure.x;\r\n    const dy = (enemy.y + enemy.height * 0.5) - muzzleY;\r\n    const distance = Math.hypot(dx, dy);\r\n    if (distance > (turret.range ?? 420)) {\r\n      continue;\r\n    }\r\n    if (distance < bestDist) {\r\n      bestDist = distance;\r\n      bestEnemy = enemy;\r\n    }\r\n  }\r\n  if (!bestEnemy) {\r\n    return;\r\n  }\r\n  const dx = bestEnemy.x - structure.x;\r\n  const dy = (bestEnemy.y + bestEnemy.height * 0.5) - muzzleY;\r\n  const distance = Math.max(1, Math.hypot(dx, dy));\r\n  const speed = turret.projectile?.speed ?? 520;\r\n  const vx = (dx / distance) * speed;\r\n  const vy = (dy / distance) * speed;\r\n  spawnProjectile({\r\n    x: structure.x,\r\n    y: muzzleY,\r\n    vx,\r\n    vy,\r\n    radius: turret.projectile?.radius ?? 6,\r\n    lifetime: 1.4,\r\n    damage: turret.projectile?.damage ?? 18,\r\n    color: turret.projectile?.color ?? \"#ffd57a\",\r\n    facing: Math.sign(dx) || 1,\r\n    gravityFactor: 0.05\r\n  });\r\n  structure.fireCooldown = turret.cooldown ?? 1.2;\r\n}\r\n\r\nfunction applyShieldField(structure, delta) {\r\n  const shield = structure.shield;\r\n  if (!shield) {\r\n    return;\r\n  }\r\n  const radius = shield.radius ?? 220;\r\n  const emitY = structure.y - (structure.height ?? 100) * 0.6;\r\n  const actors = [stickman, ...squadmates];\r\n  for (const actor of actors) {\r\n    if (!actor || actor.health <= 0) {\r\n      continue;\r\n    }\r\n    const dx = actor.x - structure.x;\r\n    const dy = (actor.y + actor.height) - emitY;\r\n    if (Math.hypot(dx, dy) <= radius) {\r\n      actor.structureShieldTimer = Math.max(actor.structureShieldTimer ?? 0, shield.buffDuration ?? 0.6);\r\n      actor.structureShieldStrength = Math.max(actor.structureShieldStrength ?? 0, shield.damageReduction ?? 0.4);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateTrap(structure, delta) {\r\n  const trap = structure.trap;\r\n  if (!trap) {\r\n    return;\r\n  }\r\n  structure.trapCooldown = Math.max(0, (structure.trapCooldown ?? 0) - delta);\r\n  if (structure.trapCooldown > 0) {\r\n    return;\r\n  }\r\n  const radius = trap.radius ?? 140;\r\n  const originY = structure.y - (structure.height ?? 24) * 0.5;\r\n  let triggered = false;\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const dx = enemy.x - structure.x;\r\n    const dy = (enemy.y + enemy.height * 0.5) - originY;\r\n    if (Math.hypot(dx, dy) <= radius) {\r\n      applyDamageToEnemy(enemy, {\r\n        damage: trap.damage ?? 24,\r\n        knockback: 160,\r\n        launch: 0,\r\n        facing: Math.sign(dx) || 1\r\n      });\r\n      enemy.stunTimer = Math.max(enemy.stunTimer ?? 0, trap.stun ?? 0.6);\r\n      triggered = true;\r\n    }\r\n  }\r\n  if (triggered) {\r\n    structure.trapCooldown = trap.cooldown ?? 2.6;\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: structure.x,\r\n      y: originY,\r\n      radius: radius * 1.2,\r\n      intensity: 1.4,\r\n      color: trap.color ?? \"#9af0ff\",\r\n      ttl: 0.25,\r\n      flicker: 0.5,\r\n      decay: 1.2\r\n    });\r\n    spawnRingBurst({\r\n      x: structure.x,\r\n      y: originY,\r\n      startRadius: radius * 0.6,\r\n      endRadius: radius * 1.3,\r\n      color: trap.color ?? \"#9af0ff\",\r\n      ttl: 0.3,\r\n      lineWidth: 5\r\n    });\r\n  }\r\n}\r\n\r\nfunction updateStructureCollisions(structure, delta) {\r\n  const halfWidth = (structure.width ?? 120) / 2;\r\n  const topY = structure.y - (structure.height ?? 80);\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const horizontalOverlap = Math.abs(enemy.x - structure.x) - (halfWidth + enemy.radius - 6);\r\n    const verticalOverlap = (enemy.y + enemy.height) - topY;\r\n    if (horizontalOverlap <= 0 && verticalOverlap > -40) {\r\n      damageStructure(structure, (enemy.attackDamage ?? 12) * delta);\r\n      enemy.vx *= 0.2;\r\n      enemy.stateTimer = Math.max(enemy.stateTimer ?? 0, 0.2);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateStructures(delta) {\r\n  const structures = getStructures();\r\n  for (let i = structures.length - 1; i >= 0; i -= 1) {\r\n    const structure = structures[i];\r\n    structure.flashTimer = Math.max(0, (structure.flashTimer ?? 0) - delta);\r\n    updateStructureCollisions(structure, delta);\r\n    updateTurret(structure, delta);\r\n    applyShieldField(structure, delta);\r\n    updateTrap(structure, delta);\r\n    if (structure.health <= 0) {\r\n      destroyStructure(structures, i, structure);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateBuildingSystem(delta) {\r\n  handleBuildInputs();\r\n  updateStructures(delta);\r\n  const state = getBuildState();\r\n  if (state.active) {\r\n    calculatePreview();\r\n  }\r\n}\r\n\r\nfunction getBuildingHudStatus() {\r\n  const state = getBuildState();\r\n  const blueprint = getBlueprintByIndex(state.blueprintIndex);\r\n  return {\r\n    active: state.active,\r\n    resources: getMaterialCount(),\r\n    blueprintName: blueprint?.name ?? \"None\",\r\n    cost: blueprint?.cost ?? 0,\r\n    valid: state.lastPreview.valid\r\n  };\r\n}\r\n\r\nresetStructures();\r\n\r\nexport {\r\n  updateBuildingSystem,\r\n  getStructures,\r\n  getBuildState,\r\n  calculatePreview,\r\n  getBuildingHudStatus,\r\n  toggleBuildMode,\r\n  cycleBlueprint,\r\n  placeStructure\r\n};\r\n\r\n","import { SURVIVAL_SETTINGS } from \"../../config/survival.js\";\r\nimport { getSurvivalState, beginSurvivalCountdown, setSurvivalStage, incrementSurvivalWave, setSurvivalTimer, setSurvivalEnemiesAlive, setSurvivalLastReward, resetSurvivalState, isSurvivalActive } from \"../../state/survival.js\";\r\nimport { spawnEnemies } from \"../world/enemySpawner.js\";\r\nimport { enemies, removeSandboxEnemies, restoreSandboxEnemies } from \"../../state/entities.js\";\r\nimport { addMaterials } from \"../../state/resources.js\";\r\nimport { input } from \"../input/index.js\";\r\n\r\nfunction startSurvival() {\r\n  removeSandboxEnemies();\r\n  beginSurvivalCountdown();\r\n}\r\n\r\nfunction getSurvivalHudStatus() {\r\n  const state = getSurvivalState();\r\n  return {\r\n    active: state.active,\r\n    stage: state.stage,\r\n    timer: state.timer,\r\n    wave: state.wave,\r\n    enemiesAlive: state.enemiesAlive,\r\n    lastReward: state.lastReward\r\n  };\r\n}\r\n\r\nfunction updateSurvival(delta) {\r\n  const state = getSurvivalState();\r\n\r\n  if (input.survivalToggleBuffered) {\r\n    input.survivalToggleBuffered = false;\r\n    if (!state.active) {\r\n      startSurvival();\r\n    }\r\n  }\r\n\r\n  if (!state.active) {\r\n    return;\r\n  }\r\n\r\n  setSurvivalTimer(Math.max(0, state.timer - delta));\r\n\r\n  for (let i = enemies.length - 1; i >= 0; i -= 1) {\r\n    const enemy = enemies[i];\r\n    if (enemy.spawnContext === \"survival\" && enemy.health <= 0 && enemy.autoRespawn === false) {\r\n      enemies.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  const alive = enemies.reduce(\r\n    (count, enemy) => count + (enemy.spawnContext === \"survival\" && enemy.health > 0 ? 1 : 0),\r\n    0\r\n  );\r\n  setSurvivalEnemiesAlive(alive);\r\n\r\n  switch (state.stage) {\r\n    case \"countdown\": {\r\n      if (state.timer <= 0) {\r\n        incrementSurvivalWave();\r\n        const spawnCount = SURVIVAL_SETTINGS.baseEnemies + (state.wave - 1) * SURVIVAL_SETTINGS.enemiesPerWave;\r\n        spawnEnemies(spawnCount, { context: \"survival\" });\r\n        setSurvivalStage(\"wave\", 0);\r\n      }\r\n      break;\r\n    }\r\n    case \"wave\": {\r\n      if (alive === 0) {\r\n        const reward = SURVIVAL_SETTINGS.waveReward + (state.wave - 1) * SURVIVAL_SETTINGS.rewardIncrement;\r\n        if (reward > 0) {\r\n          addMaterials(reward);\r\n          setSurvivalLastReward(reward);\r\n        } else {\r\n          setSurvivalLastReward(0);\r\n        }\r\n        setSurvivalStage(\"rest\", SURVIVAL_SETTINGS.restDuration);\r\n      }\r\n      break;\r\n    }\r\n    case \"rest\": {\r\n      if (state.timer <= 0) {\r\n        setSurvivalStage(\"countdown\", SURVIVAL_SETTINGS.countdownDuration);\r\n      }\r\n      break;\r\n    }\r\n    default:\r\n      break;\r\n  }\r\n}\r\n\r\nfunction resetSurvival() {\r\n  resetSurvivalState();\r\n  for (let i = enemies.length - 1; i >= 0; i -= 1) {\r\n    if (enemies[i].spawnContext === \"survival\") {\r\n      enemies.splice(i, 1);\r\n    }\r\n  }\r\n  restoreSandboxEnemies();\r\n}\r\n\r\nexport { updateSurvival, getSurvivalHudStatus, isSurvivalActive, resetSurvival };\r\n\r\n","import { enemies, createGruntEnemy } from \"../../state/entities.js\";\r\nimport { ENEMY_SPAWN_SETTINGS } from \"../../config/spawn.js\";\r\nimport { getEnvironmentWidth, getEnvironmentSpawnSettings } from \"../../state/environment.js\";\r\n\r\nfunction resolveSpawnPoints() {\r\n  const envWidth = getEnvironmentWidth();\r\n  const spawnSettings = getEnvironmentSpawnSettings();\r\n  const points = Array.isArray(spawnSettings?.enemies) ? spawnSettings.enemies.slice(0, 2) : [];\r\n  if (points.length >= 2) {\r\n    return points;\r\n  }\r\n  const left = envWidth * 0.25;\r\n  const right = envWidth * 0.75;\r\n  return [left, right];\r\n}\r\n\r\nfunction spawnEnemies(count, options = {}) {\r\n  const contextTag = options.context ?? \"sandbox\";\r\n  const autoRespawn = options.autoRespawn ?? contextTag !== \"survival\";\r\n  const spawnPoints = resolveSpawnPoints();\r\n  const maxActive = Math.min(spawnPoints.length, ENEMY_SPAWN_SETTINGS.maxCount);\r\n  let spawned = 0;\r\n\r\n  for (let sideIndex = 0; sideIndex < spawnPoints.length; sideIndex += 1) {\r\n    if (spawned >= count || enemies.length >= ENEMY_SPAWN_SETTINGS.maxCount) {\r\n      break;\r\n    }\r\n    if (contextTag === \"survival\") {\r\n      const hasAlive = enemies.some(\r\n        (enemy) => enemy.spawnContext === \"survival\" && enemy.spawnSide === sideIndex && enemy.health > 0\r\n      );\r\n      if (hasAlive) {\r\n        continue;\r\n      }\r\n    }\r\n    const spawnX = spawnPoints[sideIndex];\r\n    const enemy = createGruntEnemy(spawnX, {\r\n      context: contextTag,\r\n      autoRespawn,\r\n      spawnSide: sideIndex,\r\n      facing: sideIndex === 0 ? 1 : -1\r\n    });\r\n    enemy.spawnX = spawnX;\r\n    enemy.spawnY = enemy.y;\r\n    enemy.respawnTimer = 0;\r\n    enemies.push(enemy);\r\n    spawned += 1;\r\n    if (spawned >= maxActive) {\r\n      break;\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateEnemySpawner() {}\r\n\r\nexport { updateEnemySpawner, spawnEnemies };\r\n","const ENEMY_SPAWN_SETTINGS = {\n  minCount: 2,\n  maxCount: 2,\n  spawnBatch: 1,\n  spawnInterval: 2.2,\n  spawnPadding: 80\n};\n\nexport { ENEMY_SPAWN_SETTINGS };\r\n\r\n","const INTERACTABLE_TEMPLATES = {\n  pushCrate: {\n    category: \"movable\",\n    width: 96,\n    height: 72,\n    mass: 3.2,\n    friction: 3.6,\n    maxSpeed: 160,\n    pushImpulse: 360,\n    hitImpulse: 520,\n    bodyColor: \"#8b6f4a\",\n    edgeColor: \"#4a3b28\",\n    braceColor: \"#c59b61\",\n    highlightColor: \"#ffd89a\"\n  },\n  kickBarrel: {\n    category: \"rolling\",\n    radius: 30,\n    height: 78,\n    mass: 1.1,\n    friction: 1.8,\n    maxSpeed: 320,\n    pushImpulse: 280,\n    hitImpulse: 680,\n    bodyColor: \"#a33b32\",\n    stripeColor: \"#ffd45f\",\n    edgeColor: \"#3a1c18\",\n    topColor: \"#c95b4f\"\n  },\n  shockTrap: {\n    category: \"trap\",\n    width: 110,\n    height: 20,\n    damage: 24,\n    knockback: 90,\n    launch: -160,\n    cooldown: 2.8,\n    stunDuration: 0.75,\n    bodyColor: \"#2a374b\",\n    accentColor: \"#6ddcff\",\n    glowColor: \"#8cf7ff\"\n  }\n};\n\nexport { INTERACTABLE_TEMPLATES };\r\n","import { INTERACTABLE_TEMPLATES } from \"../config/interactables.js\";\nimport { getEnvironmentInteractableSpawns, onEnvironmentChange } from \"./environment.js\";\n\nfunction createInteractableFromSpawn(spawn) {\n  const baseTemplate = INTERACTABLE_TEMPLATES[spawn.type];\n  if (!baseTemplate) {\n    throw new Error(`Unknown interactable template: ${spawn.type}`);\n  }\n\n  const templateOverrides = spawn.templateOverrides ?? {};\n  const template = { ...baseTemplate, ...templateOverrides };\n  const width = spawn.width ?? template.width ?? (template.radius ? template.radius * 2 : 64);\n  const height = spawn.height ?? template.height ?? 48;\n  const radius = spawn.radius ?? template.radius ?? Math.max(width, height) * 0.5;\n\n  const interactable = {\n    id: spawn.id,\n    type: spawn.type,\n    template,\n    x: spawn.x,\n    y: spawn.baseY,\n    vx: 0,\n    vy: 0,\n    width,\n    height,\n    radius,\n    state: template.initialState ?? \"idle\",\n    timer: 0,\n    cooldown: 0,\n    highlight: 0,\n    triggered: false,\n    flashTimer: 0,\n    smokeTimer: 0,\n    mass: template.mass ?? 1,\n    friction: template.friction ?? 2,\n    maxSpeed: template.maxSpeed ?? 240,\n    pushImpulse: template.pushImpulse ?? 240,\n    hitImpulse: template.hitImpulse ?? template.pushImpulse ?? 320,\n    facing: spawn.facing ?? 1,\n    minX: spawn.minX ?? null,\n    maxX: spawn.maxX ?? null\n  };\n\n  if (spawn.overrides && typeof spawn.overrides === \"object\") {\n    Object.assign(interactable, spawn.overrides);\n  }\n\n  return interactable;\n}\n\nfunction createInitialState() {\n  return getEnvironmentInteractableSpawns().map((spawn) => createInteractableFromSpawn(spawn));\n}\n\nconst interactables = createInitialState();\n\nfunction resetInteractables() {\n  interactables.length = 0;\n  const fresh = createInitialState();\n  for (const item of fresh) {\n    interactables.push(item);\n  }\n}\n\nfunction getInteractables() {\n  return interactables;\n}\n\nfunction getInteractableById(id) {\n  return interactables.find((item) => item.id === id) ?? null;\n}\n\nonEnvironmentChange(() => {\n  resetInteractables();\n});\n\nexport { interactables, getInteractables, getInteractableById, resetInteractables };\r\n","import { context } from \"../../environment/canvas.js\";\nimport { getInteractables } from \"../../state/interactables.js\";\nimport { clamp } from \"../utils/math.js\";\nimport { getElapsedTime } from \"../utils/time.js\";\n\nfunction drawCrate(interactable, template, elapsed) {\n  const halfWidth = (interactable.width ?? 96) / 2;\n  const height = interactable.height ?? 72;\n  const top = interactable.y - height;\n  const sway = Math.sin(elapsed * 4 + interactable.x * 0.02) * (interactable.vx ?? 0) * 0.002;\n\n  context.save();\n  context.translate(interactable.x, interactable.y);\n  context.rotate(sway);\n\n  context.fillStyle = template.bodyColor ?? \"#8b6f4a\";\n  context.fillRect(-halfWidth, -height, halfWidth * 2, height);\n\n  context.strokeStyle = template.edgeColor ?? \"#4a3b28\";\n  context.lineWidth = 4;\n  context.strokeRect(-halfWidth, -height, halfWidth * 2, height);\n\n  context.strokeStyle = template.braceColor ?? \"#c59b61\";\n  context.lineWidth = 3;\n  const braceInset = halfWidth * 0.4;\n  context.beginPath();\n  context.moveTo(-halfWidth, -height + 8);\n  context.lineTo(-braceInset, -height + height * 0.4);\n  context.moveTo(halfWidth, -height + 8);\n  context.lineTo(braceInset, -height + height * 0.4);\n  context.moveTo(-halfWidth, -height + height * 0.55);\n  context.lineTo(-braceInset, -8);\n  context.moveTo(halfWidth, -height + height * 0.55);\n  context.lineTo(braceInset, -8);\n  context.stroke();\n\n  context.restore();\n}\n\nfunction drawBarrel(interactable, template, elapsed) {\n  const radius = interactable.radius ?? 30;\n  const height = interactable.height ?? radius * 2.2;\n  const top = interactable.y - height;\n  const wobble = Math.sin(elapsed * 6 + interactable.x * 0.05) * (interactable.vx ?? 0) * 0.003;\n\n  context.save();\n  context.translate(interactable.x, top + height / 2);\n  context.rotate(wobble);\n\n  context.fillStyle = template.bodyColor ?? \"#a33b32\";\n  context.beginPath();\n  context.ellipse(0, 0, radius, height * 0.5, 0, 0, Math.PI * 2);\n  context.fill();\n\n  context.fillStyle = template.topColor ?? \"#c95b4f\";\n  context.beginPath();\n  context.ellipse(0, -height * 0.5, radius * 0.95, radius * 0.55, 0, 0, Math.PI * 2);\n  context.fill();\n\n  context.fillStyle = template.edgeColor ?? \"#3a1c18\";\n  context.beginPath();\n  context.ellipse(0, height * 0.5, radius * 0.95, radius * 0.55, 0, 0, Math.PI * 2);\n  context.fill();\n\n  context.strokeStyle = template.stripeColor ?? \"#ffd45f\";\n  context.lineWidth = 5;\n  context.beginPath();\n  context.moveTo(-radius * 0.85, -height * 0.25);\n  context.lineTo(radius * 0.85, -height * 0.1);\n  context.moveTo(-radius * 0.85, height * 0.05);\n  context.lineTo(radius * 0.85, height * 0.2);\n  context.stroke();\n\n  context.restore();\n}\n\nfunction drawTrap(interactable, template, elapsed) {\n  const halfWidth = (interactable.width ?? 110) / 2;\n  const height = interactable.height ?? 20;\n  const top = interactable.y - height;\n  const glow = template.glowColor ?? \"#8cf7ff\";\n  const accent = template.accentColor ?? \"#6ddcff\";\n  const body = template.bodyColor ?? \"#2a374b\";\n  const pulse = Math.sin(elapsed * 5 + interactable.x * 0.04) * 0.15 + 0.35 + (interactable.cooldown > 0 ? 0.1 : 0.35);\n\n  context.save();\n  context.translate(interactable.x, 0);\n\n  context.fillStyle = body;\n  context.fillRect(-halfWidth, top, halfWidth * 2, height);\n\n  context.fillStyle = accent;\n  context.fillRect(-halfWidth * 0.9, top + height * 0.25, halfWidth * 1.8, height * 0.35);\n\n  context.globalAlpha = clamp(pulse, 0, 1);\n  context.fillStyle = glow;\n  context.fillRect(-halfWidth, top - 6, halfWidth * 2, height * 0.2);\n  context.fillRect(-halfWidth, top + height - 4, halfWidth * 2, height * 0.2);\n  context.globalAlpha = 1;\n\n  context.restore();\n}\n\nfunction drawInteractable(interactable, elapsed) {\n  const template = interactable.template ?? {};\n  switch (template.category) {\n    case \"movable\":\n      drawCrate(interactable, template, elapsed);\n      break;\n    case \"rolling\":\n      drawBarrel(interactable, template, elapsed);\n      break;\n    case \"trap\":\n      drawTrap(interactable, template, elapsed);\n      break;\n    default:\n      break;\n  }\n\n  const flash = interactable.flashTimer ?? 0;\n  if (flash > 0) {\n    const alpha = clamp(flash / 0.2, 0, 1) * 0.4;\n    const halfWidth = interactable.width ? interactable.width / 2 : interactable.radius;\n    const height = interactable.height ?? halfWidth * 1.4;\n    context.save();\n    context.fillStyle = `rgba(255, 255, 255, ${alpha.toFixed(3)})`;\n    context.translate(interactable.x, interactable.y);\n    context.fillRect(-halfWidth, -height, halfWidth * 2, height);\n    context.restore();\n  }\n\n  const highlight = clamp(interactable.highlight ?? 0, 0, 1);\n  if (highlight > 0.01) {\n    const templateHighlight = template.highlightColor ?? template.accentColor ?? \"#ffd89a\";\n    const halfWidth = interactable.width ? interactable.width / 2 : interactable.radius;\n    const height = interactable.height ?? halfWidth * 1.4;\n    context.save();\n    context.globalAlpha = highlight * 0.45;\n    context.fillStyle = templateHighlight;\n    context.translate(interactable.x, interactable.y);\n    context.fillRect(-halfWidth * 1.15, -height * 1.05, halfWidth * 2.3, height * 1.3);\n    context.restore();\n  }\n}\n\nfunction drawInteractables() {\n  const items = getInteractables();\n  if (!items || items.length === 0) {\n    return;\n  }\n  const elapsed = getElapsedTime();\n  context.save();\n  for (const interactable of items) {\n    drawInteractable(interactable, elapsed);\n  }\n  context.restore();\n}\n\nexport { drawInteractables };\r\n","import { stickman } from \"../../state/entities.js\";\r\n\r\nconst muzzleFlashes = [];\r\nconst shieldBursts = [];\r\nconst throwableBursts = [];\r\nconst notices = [];\r\nconst shotIndicators = [];\r\n\r\nconst filters = {\r\n  weapons: true,\r\n  shield: true,\r\n  throwables: true\r\n};\r\n\r\nconst FILTER_TOGGLE_MAP = {\r\n  Digit6: \"weapons\",\r\n  Digit7: \"shield\",\r\n  Digit8: \"throwables\"\r\n};\r\n\r\nfunction pushNotice(message, ttl = 1.8) {\r\n  const last = notices[notices.length - 1];\r\n  if (last && last.message === message) {\r\n    last.ttl = ttl;\r\n    last.maxTtl = ttl;\r\n    last.age = 0;\r\n    return;\r\n  }\r\n  notices.push({ message, ttl, maxTtl: ttl, age: 0 });\r\n  while (notices.length > 6) {\r\n    notices.shift();\r\n  }\r\n}\r\n\r\nfunction pushThrowableBurst(type, detail = {}, ttl = 0.4) {\r\n  const burst = {\r\n    type,\r\n    x: detail.x ?? stickman.x,\r\n    y: detail.y ?? stickman.y,\r\n    radius: detail.radius ?? 110,\r\n    ttl,\r\n    maxTtl: ttl\r\n  };\r\n  throwableBursts.push(burst);\r\n  return burst;\r\n}\r\n\r\nfunction shouldCapture(category) {\r\n  return filters[category] !== false;\r\n}\r\n\r\nfunction toggleFilter(category) {\r\n  filters[category] = !filters[category];\r\n  const pretty = category.charAt(0).toUpperCase() + category.slice(1);\r\n  const stateLabel = filters[category] ? \"ON\" : \"OFF\";\r\n  pushNotice(`Debug filter ${pretty} ${stateLabel}`, 1.4);\r\n  if (!filters[category]) {\r\n    if (category === \"weapons\") {\r\n      muzzleFlashes.length = 0;\r\n      shotIndicators.length = 0;\r\n    } else if (category === \"shield\") {\r\n      shieldBursts.length = 0;\r\n    } else if (category === \"throwables\") {\r\n      throwableBursts.length = 0;\r\n    }\r\n  }\r\n}\r\n\r\nfunction handleFilterToggle(event) {\r\n  if (!event.altKey || event.repeat) {\r\n    return;\r\n  }\r\n  const category = FILTER_TOGGLE_MAP[event.code];\r\n  if (!category) {\r\n    return;\r\n  }\r\n  if (typeof event.preventDefault === \"function\") {\r\n    event.preventDefault();\r\n  }\r\n  toggleFilter(category);\r\n}\r\n\r\nfunction handleMuzzleFlash(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const ttl = 0.12;\r\n  muzzleFlashes.push({\r\n    weaponId: detail.weaponId ?? \"unknown\",\r\n    x: detail.x ?? stickman.x,\r\n    y: detail.y ?? stickman.y,\r\n    facing: detail.facing ?? stickman.facing ?? 1,\r\n    ttl,\r\n    maxTtl: ttl\r\n  });\r\n}\r\n\r\nfunction handleShotFired(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const ttl = 0.4;\r\n  const weaponId = detail.weaponId ?? \"unknown\";\r\n  const existing = shotIndicators.find((entry) => entry.weaponId === weaponId);\r\n  if (existing) {\r\n    existing.ttl = ttl;\r\n    existing.maxTtl = ttl;\r\n    existing.age = 0;\r\n    return;\r\n  }\r\n  shotIndicators.push({ weaponId, ttl, maxTtl: ttl, age: 0 });\r\n  while (shotIndicators.length > 5) {\r\n    shotIndicators.shift();\r\n  }\r\n}\r\n\r\nfunction handleReloadStart(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const weaponId = event?.detail?.weaponId ?? \"unknown\";\r\n  pushNotice(`Reloading ${weaponId}`);\r\n}\r\n\r\nfunction handleReloadFinish(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const weaponId = event?.detail?.weaponId ?? \"unknown\";\r\n  pushNotice(`Reload complete ${weaponId}`, 1.4);\r\n}\r\n\r\nfunction handleRecoilKick(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const weaponId = detail.weaponId ?? \"unknown\";\r\n  const horizontal = detail.recoil?.horizontal ?? 0;\r\n  const vertical = detail.recoil?.vertical ?? 0;\r\n  const magnitude = Math.hypot(horizontal, vertical);\r\n  if (magnitude <= 0) {\r\n    return;\r\n  }\r\n  pushNotice(`Recoil ${weaponId}: ${magnitude.toFixed(2)}`, 1.2);\r\n}\r\n\r\n\nfunction handleEnvironmentChanged(event) {\r\n  const env = event?.detail?.environment;\r\n  const name = env?.name ?? env?.id;\r\n  if (!name) {\r\n    return;\r\n  }\r\n  pushNotice(`Environment set to ${name}`, 2.2);\r\n}\n\r\nfunction handleShieldHit(event) {\r\n  if (!shouldCapture(\"shield\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const ttl = 0.28;\r\n  const center = {\r\n    x: detail.center?.x ?? stickman.x,\r\n    y: detail.center?.y ?? stickman.y\r\n  };\r\n  shieldBursts.push({\r\n    type: \"hit\",\r\n    absorb: detail.absorb ?? 0,\r\n    center,\r\n    ttl,\r\n    maxTtl: ttl\r\n  });\r\n  if (detail.absorb !== undefined) {\r\n    pushNotice(`Shield absorb ${Math.round(detail.absorb)}`, 1.2);\r\n  }\r\n}\r\n\r\nfunction handleShieldShatter(event) {\r\n  if (!shouldCapture(\"shield\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const ttl = 0.45;\r\n  const center = {\r\n    x: detail.center?.x ?? stickman.x,\r\n    y: detail.center?.y ?? stickman.y\r\n  };\r\n  shieldBursts.push({\r\n    type: \"shatter\",\r\n    center,\r\n    ttl,\r\n    maxTtl: ttl\r\n  });\r\n  const reason = detail.reason ?? \"shatter\";\r\n  pushNotice(`Shield ${reason}`, 1.6);\r\n}\r\n\r\nfunction handleShieldEnd(event) {\r\n  if (!shouldCapture(\"shield\")) {\r\n    return;\r\n  }\r\n  const reason = event?.detail?.reason ?? \"ended\";\r\n  if (reason === \"shatter\") {\r\n    return;\r\n  }\r\n  pushNotice(`Shield ${reason}`, 1.4);\r\n}\r\n\r\nfunction handleThrowableThrown(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const effect = detail.effectType ?? \"unknown\";\r\n  pushNotice(`Throwable thrown (${effect})`, 1.4);\r\n}\r\n\r\nfunction handleThrowableExplosion(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  pushThrowableBurst(\"explosion\", detail, 0.55);\r\n  if (detail.damage !== undefined) {\r\n    pushNotice(`Explosion damage ${detail.damage}`, 1.6);\r\n  } else {\r\n    pushNotice(\"Explosion triggered\", 1.4);\r\n  }\r\n}\r\n\r\nfunction handleThrowableFlashBurst(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  pushThrowableBurst(\"flash\", detail, 0.45);\r\n  const stunDuration = detail.stunDuration ?? 0;\r\n  const stunLabel = typeof stunDuration === \"number\" ? stunDuration.toFixed(1) : String(stunDuration);\r\n  pushNotice(`Flash burst (stun ${stunLabel}s)`, 1.6);\r\n}\r\n\r\nfunction handleThrowableSmokeDetonate(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const burst = pushThrowableBurst(\"smoke\", detail, 0.6);\r\n  burst.maxRadius = detail.radius ?? burst.radius;\r\n  const durationSeconds = Math.round(((detail.duration ?? 0) + Number.EPSILON) * 10) / 10;\r\n  pushNotice(`Smoke deployed (${durationSeconds}s)`, 1.6);\r\n}\r\n\r\nfunction handleThrowableSmokeDissipate(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  pushThrowableBurst(\"smoke-fade\", detail, 0.4);\r\n  pushNotice(\"Smoke dissipated\", 1.4);\r\n}\r\n\r\nlet listenersRegistered = false;\r\n\r\nfunction ensureListeners() {\r\n  if (listenersRegistered || typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.addEventListener(\"weapon:muzzle-flash\", handleMuzzleFlash);\r\n  window.addEventListener(\"weapon:shot-fired\", handleShotFired);\r\n  window.addEventListener(\"weapon:reload-start\", handleReloadStart);\r\n  window.addEventListener(\"weapon:reload-finish\", handleReloadFinish);\r\n  window.addEventListener(\"weapon:recoil-kick\", handleRecoilKick);\r\n  window.addEventListener(\"shield:hit\", handleShieldHit);\r\n  window.addEventListener(\"shield:shatter\", handleShieldShatter);\r\n  window.addEventListener(\"shield:end\", handleShieldEnd);\r\n  window.addEventListener(\"throwable:thrown\", handleThrowableThrown);\r\n  window.addEventListener(\"throwable:explosion\", handleThrowableExplosion);\r\n  window.addEventListener(\"throwable:flash-burst\", handleThrowableFlashBurst);\r\n  window.addEventListener(\"throwable:smoke-detonate\", handleThrowableSmokeDetonate);\r\n  window.addEventListener(\"throwable:smoke-dissipate\", handleThrowableSmokeDissipate);\r\n  window.addEventListener(\"environment:changed\", handleEnvironmentChanged);\r\n  window.addEventListener(\"keydown\", handleFilterToggle);\r\n  listenersRegistered = true;\r\n}\r\n\r\nfunction updateList(list, delta) {\r\n  for (let i = list.length - 1; i >= 0; i -= 1) {\r\n    const entry = list[i];\r\n    entry.ttl -= delta;\r\n    entry.age = (entry.age ?? 0) + delta;\r\n    if (entry.ttl <= 0) {\r\n      list.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updatePolishDebug(delta) {\r\n  ensureListeners();\r\n  updateList(muzzleFlashes, delta);\r\n  updateList(shieldBursts, delta);\r\n  updateList(throwableBursts, delta);\r\n  updateList(notices, delta);\r\n  updateList(shotIndicators, delta);\r\n}\r\n\r\nfunction getPolishDebugState() {\r\n  ensureListeners();\r\n  return {\r\n    muzzleFlashes,\r\n    shieldBursts,\r\n    throwableBursts,\r\n    notices,\r\n    shotIndicators,\r\n    filters: { ...filters }\r\n  };\r\n}\r\n\r\nexport { updatePolishDebug, getPolishDebugState };\r\n","import { getElapsedTime } from \"../core/utils/time.js\";\r\n\r\n\r\nconst recoilState = {\r\n  horizontalKick: 0,\r\n  verticalKick: 0,\r\n  decay: 12,\r\n  lastShotTime: 0\r\n};\r\n\r\nfunction applyRecoil(kick) {\r\n  recoilState.horizontalKick += kick?.horizontal ?? 0;\r\n  recoilState.verticalKick += kick?.vertical ?? 0;\r\n  recoilState.decay = kick?.decay ?? recoilState.decay;\r\n  recoilState.lastShotTime = getElapsedTime();\r\n}\r\n\r\nfunction updateRecoil(delta) {\r\n  const decayRate = recoilState.decay ?? 12;\r\n  const decayFactor = Math.max(0, 1 - decayRate * delta);\r\n  recoilState.horizontalKick *= decayFactor;\r\n  recoilState.verticalKick *= decayFactor;\r\n}\r\n\r\nfunction getRecoilOffset() {\r\n  return {\r\n    horizontal: recoilState.horizontalKick,\r\n    vertical: recoilState.verticalKick\r\n  };\r\n}\r\n\r\nexport { applyRecoil, updateRecoil, getRecoilOffset };\r\n\r\n\r\n","import { context, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { getEnvironmentPlatforms, getEnvironmentWaterZones, getEnvironmentDecor } from \"../../state/environment.js\";\r\n\r\nfunction resolvePlatformLanding(entity, previousY, height) {\r\n  const prevFeet = previousY + height;\r\n  const platforms = getEnvironmentPlatforms();\r\n  for (const platform of platforms) {\r\n    if (entity.vy < 0) {\r\n      continue;\r\n    }\r\n    const nextFeet = entity.y + height;\r\n    if (prevFeet <= platform.y && nextFeet >= platform.y) {\r\n      if (entity.x >= platform.x && entity.x <= platform.x + platform.width) {\r\n        entity.y = platform.y - height;\r\n        entity.vy = 0;\r\n        if (Object.prototype.hasOwnProperty.call(entity, \"onGround\")) {\r\n          entity.onGround = true;\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nconst PLATFORM_STYLES = {\r\n  street: { fill: \"#2c2f36\", stroke: \"#1b1d22\" },\r\n  metro: { fill: \"#3d4252\", stroke: \"#272b37\" },\r\n  rooftop: { fill: \"#4c5566\", stroke: \"#2f3541\" },\r\n  skybridge: { fill: \"#596274\", stroke: \"#323846\" },\r\n  terrace: { fill: \"#46505f\", stroke: \"#2a303b\" },\r\n  balcony: { fill: \"#525a6a\", stroke: \"#2f3540\" },\r\n  median: { fill: \"#3a404a\", stroke: \"#23272f\" },\r\n  jungleFloor: { fill: \"#314629\", stroke: \"#1c2917\" },\r\n  stone: { fill: \"#4c5f4c\", stroke: \"#2a3628\" },\r\n  canopy: { fill: \"#3f5e3a\", stroke: \"#23361f\" },\r\n  branch: { fill: \"#594427\", stroke: \"#2e2010\" },\r\n  sand: { fill: \"#cfa665\", stroke: \"#8a6a3a\" },\r\n  cliff: { fill: \"#8b6b42\", stroke: \"#5b4426\" },\r\n  plateau: { fill: \"#b78b4f\", stroke: \"#7f6032\" },\r\n  deck: { fill: \"#303a4c\", stroke: \"#1d2431\" },\r\n  catwalk: { fill: \"#3c4a63\", stroke: \"#212a39\" },\r\n  maglev: { fill: \"#2a315a\", stroke: \"#181d33\" },\r\n  plain: { fill: \"#36404c\", stroke: \"#222730\" }\r\n};\r\n\r\nfunction drawWaterBodies() {\r\n  const zones = getEnvironmentWaterZones();\r\n  for (const zone of zones) {\r\n    const gradient = context.createLinearGradient(zone.x, zone.top, zone.x, zone.top + zone.depth);\r\n    gradient.addColorStop(0, zone.topColor ?? \"rgba(54, 98, 144, 0.88)\");\r\n    gradient.addColorStop(0.7, zone.midColor ?? \"rgba(36, 72, 112, 0.9)\");\r\n    gradient.addColorStop(1, zone.bottomColor ?? \"rgba(24, 50, 84, 0.95)\");\r\n    context.fillStyle = gradient;\r\n    context.fillRect(zone.x, zone.top, zone.width, zone.depth);\r\n\r\n    if (zone.highlight !== false) {\r\n      context.fillStyle = zone.highlightColor ?? \"rgba(255, 204, 112, 0.25)\";\r\n      context.fillRect(zone.x - 10, zone.top + 2, zone.width + 20, 4);\r\n    }\r\n\r\n    const rippleColor = zone.rippleColor ?? \"rgba(255, 255, 255, 0.12)\";\r\n    context.strokeStyle = rippleColor;\r\n    context.lineWidth = 1.6;\r\n    for (let i = 0; i < zone.width; i += 40) {\r\n      const waveY = zone.top + 6 + Math.sin((i + zone.top) * 0.03) * 3;\r\n      context.beginPath();\r\n      context.moveTo(zone.x + i, waveY);\r\n      context.quadraticCurveTo(zone.x + i + 10, waveY + 3, zone.x + i + 20, waveY);\r\n      context.stroke();\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawPlatform(platform) {\r\n  const style = PLATFORM_STYLES[platform.type] ?? PLATFORM_STYLES.plain;\r\n  context.fillStyle = style.fill;\r\n  context.fillRect(platform.x, platform.y, platform.width, platform.height);\r\n  context.strokeStyle = style.stroke;\r\n  context.lineWidth = 2;\r\n  context.strokeRect(platform.x, platform.y, platform.width, platform.height);\r\n}\r\n\r\nfunction drawBuilding(decor) {\r\n  context.save();\r\n  context.fillStyle = \"#2a3240\";\r\n  context.fillRect(decor.x, decor.y, decor.width, decor.height);\r\n  context.fillStyle = \"#4a6076\";\r\n  const floors = Math.max(3, Math.floor(decor.height / 60));\r\n  for (let f = 0; f < floors; f += 1) {\r\n    const y = decor.y + 20 + f * (decor.height / floors);\r\n    context.fillRect(decor.x + 10, y, decor.width - 20, 8);\r\n  }\r\n  context.restore();\r\n}\r\n\r\n\r\nfunction drawPalm(decor) {\r\n  const baseX = decor.baseX ?? decor.x ?? 0;\r\n  const baseY = decor.baseY ?? decor.y ?? GROUND_Y;\r\n  const height = decor.height ?? 220;\r\n  context.save();\r\n  context.translate(baseX, baseY);\r\n  context.strokeStyle = \"#3c2d1b\";\r\n  context.lineWidth = 8;\r\n  context.beginPath();\r\n  context.moveTo(0, 0);\r\n  context.lineTo(0, -height);\r\n  context.stroke();\r\n  context.lineWidth = 6;\r\n  context.beginPath();\r\n  context.moveTo(0, -height);\r\n  context.quadraticCurveTo(18, -height + 24, 32, -height + 58);\r\n  context.moveTo(0, -height);\r\n  context.quadraticCurveTo(-18, -height + 24, -32, -height + 58);\r\n  context.stroke();\r\n  context.fillStyle = \"#3f8f4a\";\r\n  for (let i = -2; i <= 2; i += 1) {\r\n    context.beginPath();\r\n    context.ellipse(i * 12, -height + 40, 40, 16, (Math.PI / 8) * i, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction drawRuin(decor) {\r\n  context.save();\r\n  context.fillStyle = \"#484f3d\";\r\n  context.fillRect(decor.x, decor.y, decor.width, decor.height);\r\n  context.fillStyle = \"#2f3526\";\r\n  const bricks = Math.max(2, Math.floor(decor.height / 40));\r\n  for (let i = 0; i < bricks; i += 1) {\r\n    const y = decor.y + i * (decor.height / bricks);\r\n    context.fillRect(decor.x + 4, y + 6, decor.width - 8, 6);\r\n  }\r\n  context.strokeStyle = \"#9db27e\";\r\n  context.lineWidth = 3;\r\n  context.setLineDash([6, 10]);\r\n  context.strokeRect(decor.x + 6, decor.y + 6, decor.width - 12, decor.height - 12);\r\n  context.setLineDash([]);\r\n  context.restore();\r\n}\r\n\r\nfunction drawVineArch(decor) {\r\n  context.save();\r\n  context.strokeStyle = \"#3a5c35\";\r\n  context.lineWidth = 10;\r\n  const x = decor.x;\r\n  const y = decor.y;\r\n  const width = decor.width ?? 180;\r\n  const height = decor.height ?? 120;\r\n  context.beginPath();\r\n  context.arc(x, y, width / 2, Math.PI, 0, false);\r\n  context.stroke();\r\n  context.lineWidth = 4;\r\n  context.strokeStyle = \"#5f8d4a\";\r\n  context.beginPath();\r\n  context.arc(x, y, width / 2 - 10, Math.PI, 0, false);\r\n  context.stroke();\r\n  context.fillStyle = \"#7fcf6a\";\r\n  for (let i = -3; i <= 3; i += 1) {\r\n    context.beginPath();\r\n    context.ellipse(x + i * 18, y - height * 0.4, 12, 20, Math.PI / 6, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction drawGlowPlant(decor) {\r\n  const x = decor.x;\r\n  const y = decor.y;\r\n  context.save();\r\n  const gradient = context.createRadialGradient(x, y, 0, x, y, 26);\r\n  gradient.addColorStop(0, \"rgba(120, 255, 191, 0.8)\");\r\n  gradient.addColorStop(1, \"rgba(120, 255, 191, 0)\");\r\n  context.fillStyle = gradient;\r\n  context.beginPath();\r\n  context.arc(x, y, 26, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.fillStyle = \"#63ffbd\";\r\n  context.beginPath();\r\n  context.arc(x, y, 8, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction drawWaterfall(decor) {\r\n  const width = decor.width ?? 80;\r\n  const height = decor.height ?? 200;\r\n  const x = decor.x - width / 2;\r\n  const y = decor.y - height;\r\n  const gradient = context.createLinearGradient(x, y, x, y + height);\r\n  gradient.addColorStop(0, \"rgba(110, 216, 255, 0.5)\");\r\n  gradient.addColorStop(1, \"rgba(110, 216, 255, 0.1)\");\r\n  context.fillStyle = gradient;\r\n  context.fillRect(x, y, width, height);\r\n  context.strokeStyle = \"rgba(173, 245, 255, 0.6)\";\r\n  context.lineWidth = 2;\r\n  for (let i = 0; i < width; i += 16) {\r\n    context.beginPath();\r\n    context.moveTo(x + i + 4, y);\r\n    context.lineTo(x + i + 8, y + height);\r\n    context.stroke();\r\n  }\r\n}\r\n\r\nfunction drawDune(decor) {\r\n  const baseX = decor.baseX ?? decor.x ?? 0;\r\n  const baseY = decor.baseY ?? decor.y ?? GROUND_Y;\r\n  const width = decor.width ?? 260;\r\n  const height = decor.height ?? 100;\r\n  context.save();\r\n  context.fillStyle = decor.color ?? \"#d59c5a\";\r\n  context.beginPath();\r\n  context.moveTo(baseX - width / 2, baseY);\r\n  context.quadraticCurveTo(baseX, baseY - height, baseX + width / 2, baseY);\r\n  context.closePath();\r\n  context.fill();\r\n  context.fillStyle = \"rgba(255, 226, 170, 0.35)\";\r\n  context.beginPath();\r\n  context.moveTo(baseX - width * 0.3, baseY - height * 0.25);\r\n  context.quadraticCurveTo(baseX, baseY - height * 0.65, baseX + width * 0.35, baseY - height * 0.28);\r\n  context.lineTo(baseX + width * 0.3, baseY - height * 0.18);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction drawRockSpire(decor) {\r\n  const baseX = decor.baseX ?? decor.x ?? 0;\r\n  const baseY = decor.baseY ?? decor.y ?? GROUND_Y;\r\n  const height = decor.height ?? 240;\r\n  context.save();\r\n  context.fillStyle = \"#7d6040\";\r\n  context.beginPath();\r\n  context.moveTo(baseX - 18, baseY);\r\n  context.lineTo(baseX + 18, baseY);\r\n  context.lineTo(baseX + 6, baseY - height);\r\n  context.lineTo(baseX - 12, baseY - height * 0.65);\r\n  context.closePath();\r\n  context.fill();\r\n  context.strokeStyle = \"#c6a37c\";\r\n  context.lineWidth = 3;\r\n  context.beginPath();\r\n  context.moveTo(baseX - 4, baseY - height * 0.3);\r\n  context.lineTo(baseX + 6, baseY - height * 0.6);\r\n  context.stroke();\r\n  context.restore();\r\n}\r\n\r\nfunction drawCampfire(decor) {\r\n  const baseX = decor.baseX ?? decor.x ?? 0;\r\n  const baseY = decor.baseY ?? decor.y ?? GROUND_Y - 20;\r\n  context.save();\r\n  context.strokeStyle = \"#5b3e24\";\r\n  context.lineWidth = 5;\r\n  context.beginPath();\r\n  context.moveTo(baseX - 16, baseY + 12);\r\n  context.lineTo(baseX + 12, baseY - 4);\r\n  context.moveTo(baseX + 16, baseY + 12);\r\n  context.lineTo(baseX - 12, baseY - 4);\r\n  context.stroke();\r\n  const gradient = context.createRadialGradient(baseX, baseY - 10, 0, baseX, baseY - 10, 36);\r\n  gradient.addColorStop(0, \"rgba(255, 174, 72, 0.95)\");\r\n  gradient.addColorStop(0.5, \"rgba(255, 116, 32, 0.6)\");\r\n  gradient.addColorStop(1, \"rgba(255, 116, 32, 0)\");\r\n  context.fillStyle = gradient;\r\n  context.beginPath();\r\n  context.arc(baseX, baseY - 10, 36, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction drawAntenna(decor) {\r\n  const x = decor.x;\r\n  const y = decor.y;\r\n  const height = decor.height ?? 300;\r\n  context.save();\r\n  context.strokeStyle = \"#b89c6d\";\r\n  context.lineWidth = 4;\r\n  context.beginPath();\r\n  context.moveTo(x, y + height);\r\n  context.lineTo(x, y);\r\n  context.stroke();\r\n  context.strokeStyle = \"#ffe6ac\";\r\n  context.lineWidth = 2;\r\n  for (let i = 0; i < 4; i += 1) {\r\n    const offset = (i + 1) * (height / 5);\r\n    context.beginPath();\r\n    context.moveTo(x - 18, y + offset);\r\n    context.lineTo(x + 18, y + offset - 12);\r\n    context.stroke();\r\n  }\r\n  context.fillStyle = \"#ffe89a\";\r\n  context.beginPath();\r\n  context.arc(x, y, 10, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction drawSpire(decor) {\r\n  const baseX = decor.baseX ?? decor.x ?? 0;\r\n  const baseY = decor.baseY ?? decor.y ?? GROUND_Y;\r\n  const height = decor.height ?? 320;\r\n  context.save();\r\n  context.fillStyle = \"#3f5ac9\";\r\n  context.beginPath();\r\n  context.moveTo(baseX - 28, baseY);\r\n  context.lineTo(baseX + 28, baseY);\r\n  context.lineTo(baseX + 8, baseY - height);\r\n  context.lineTo(baseX - 12, baseY - height * 0.6);\r\n  context.closePath();\r\n  context.fill();\r\n  context.fillStyle = \"rgba(120, 200, 255, 0.35)\";\r\n  context.beginPath();\r\n  context.moveTo(baseX, baseY - height * 0.92);\r\n  context.lineTo(baseX + 16, baseY - height * 0.4);\r\n  context.lineTo(baseX - 4, baseY - height * 0.32);\r\n  context.closePath();\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction drawHoloBillboard(decor) {\r\n  context.save();\r\n  const x = decor.x - decor.width / 2;\r\n  const y = decor.y - decor.height;\r\n  const gradient = context.createLinearGradient(x, y, x + decor.width, y + decor.height);\r\n  gradient.addColorStop(0, \"rgba(85, 170, 255, 0.4)\");\r\n  gradient.addColorStop(1, \"rgba(170, 120, 255, 0.7)\");\r\n  context.fillStyle = gradient;\r\n  context.fillRect(x, y, decor.width, decor.height);\r\n  context.strokeStyle = \"#8bd4ff\";\r\n  context.lineWidth = 3;\r\n  context.strokeRect(x, y, decor.width, decor.height);\r\n  context.fillStyle = \"#e5f5ff\";\r\n  context.font = \"18px 'Segoe UI', Arial, sans-serif\";\r\n  context.textAlign = \"center\";\r\n  context.fillText(decor.text ?? \"HOLO\", decor.x, decor.y - decor.height / 2);\r\n  context.restore();\r\n}\r\n\r\nfunction drawEnergyCoil(decor) {\r\n  const baseX = decor.baseX ?? decor.x ?? 0;\r\n  const baseY = decor.baseY ?? decor.y ?? GROUND_Y - 20;\r\n  const height = decor.height ?? 180;\r\n  context.save();\r\n  context.strokeStyle = \"#3d4e88\";\r\n  context.lineWidth = 6;\r\n  context.beginPath();\r\n  context.moveTo(baseX - 14, baseY);\r\n  context.lineTo(baseX - 14, baseY - height);\r\n  context.moveTo(baseX + 14, baseY);\r\n  context.lineTo(baseX + 14, baseY - height);\r\n  context.stroke();\r\n  context.strokeStyle = \"#7ce7ff\";\r\n  context.lineWidth = 3;\r\n  for (let y = 0; y <= height; y += 32) {\r\n    context.beginPath();\r\n    context.moveTo(baseX - 14, baseY - y);\r\n    context.quadraticCurveTo(baseX, baseY - y - 12, baseX + 14, baseY - y - 2);\r\n    context.stroke();\r\n  }\r\n  context.fillStyle = \"#9ef5ff\";\r\n  context.beginPath();\r\n  context.arc(baseX, baseY - height - 14, 18, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction drawHovercar(decor) {\r\n  context.save();\r\n  context.fillStyle = \"#5d8fff\";\r\n  context.beginPath();\r\n  context.ellipse(decor.x, decor.y, 46, 16, 0, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.fillStyle = \"#1f2536\";\r\n  context.fillRect(decor.x - 26, decor.y - 8, 52, 16);\r\n  context.restore();\r\n}\r\n\r\nfunction drawDecor() {\r\n  const decorItems = getEnvironmentDecor();\r\n  for (const decor of decorItems) {\r\n    switch (decor.type) {\r\n      case \"building\":\r\n        drawBuilding(decor);\r\n        break;\r\n      case \"billboard\":\r\n        context.save();\r\n        context.fillStyle = \"#1f2330\";\r\n        context.fillRect(decor.x - decor.width / 2, decor.y - decor.height, decor.width, decor.height);\r\n        context.fillStyle = \"#ffc851\";\r\n        context.font = \"18px 'Segoe UI', Arial, sans-serif\";\r\n        context.textAlign = \"center\";\r\n        context.fillText(decor.text ?? \"Ad\", decor.x, decor.y - decor.height / 2);\r\n        context.strokeStyle = \"#ffa940\";\r\n        context.lineWidth = 3;\r\n        context.strokeRect(decor.x - decor.width / 2, decor.y - decor.height, decor.width, decor.height);\r\n        context.restore();\r\n        break;\r\n      case \"streetlight\":\r\n        context.save();\r\n        context.strokeStyle = \"#707789\";\r\n        context.lineWidth = 4;\r\n        context.beginPath();\r\n        context.moveTo(decor.x, decor.y + 140);\r\n        context.lineTo(decor.x, decor.y + 30);\r\n        context.stroke();\r\n        context.fillStyle = \"#ffd97a\";\r\n        context.beginPath();\r\n        context.arc(decor.x, decor.y + 12, 10, 0, Math.PI * 2);\r\n        context.fill();\r\n        context.restore();\r\n        break;\r\n      case \"hovercar\":\r\n        drawHovercar(decor);\r\n        break;\r\n      case \"palm\":\r\n        drawPalm(decor);\r\n        break;\r\n      case \"ruin\":\r\n        drawRuin(decor);\r\n        break;\r\n      case \"vineArch\":\r\n        drawVineArch(decor);\r\n        break;\r\n      case \"glowPlant\":\r\n        drawGlowPlant(decor);\r\n        break;\r\n      case \"waterfall\":\r\n        drawWaterfall(decor);\r\n        break;\r\n      case \"dune\":\r\n        drawDune(decor);\r\n        break;\r\n      case \"rockSpire\":\r\n        drawRockSpire(decor);\r\n        break;\r\n      case \"campfire\":\r\n        drawCampfire(decor);\r\n        break;\r\n      case \"antenna\":\r\n        drawAntenna(decor);\r\n        break;\r\n      case \"spire\":\r\n        drawSpire(decor);\r\n        break;\r\n      case \"holoBillboard\":\r\n        drawHoloBillboard(decor);\r\n        break;\r\n      case \"energyCoil\":\r\n        drawEnergyCoil(decor);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawDebugArena() {\r\n  drawWaterBodies();\r\n  const platforms = getEnvironmentPlatforms();\r\n  for (const platform of platforms) {\r\n    drawPlatform(platform);\r\n  }\r\n  drawDecor();\r\n}\r\n\r\nexport { resolvePlatformLanding, drawDebugArena };\r\n","import { GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { SPEED, GRAVITY, POSES } from \"../../config/constants.js\";\r\nimport { SQUAD_COMMANDS, SQUAD_SETTINGS } from \"../../config/squad.js\";\r\nimport { stickman, squadmates, enemies, getTotalHeight } from \"../../state/entities.js\";\r\nimport { resolvePlatformLanding } from \"../world/arena.js\";\r\nimport { spawnProjectile } from \"../combat/projectiles.js\";\r\n\r\nfunction getActiveCommand() {\r\n  return SQUAD_COMMANDS[stickman.squadCommandIndex % SQUAD_COMMANDS.length] ?? SQUAD_COMMANDS[0];\r\n}\r\n\r\nfunction cycleSquadCommand() {\r\n  if (stickman.squadCommandCooldown > 0) {\r\n    return getActiveCommand();\r\n  }\r\n  stickman.squadCommandIndex = (stickman.squadCommandIndex + 1) % SQUAD_COMMANDS.length;\r\n  const command = getActiveCommand();\r\n  stickman.squadCommandId = command?.id ?? stickman.squadCommandId;\r\n  stickman.squadCommandCooldown = SQUAD_SETTINGS.commandCooldown;\r\n  return command;\r\n}\r\n\r\nfunction setSquadCommandById(commandId) {\r\n  const index = SQUAD_COMMANDS.findIndex((command) => command.id === commandId);\r\n  if (index >= 0) {\r\n    stickman.squadCommandIndex = index;\r\n    stickman.squadCommandId = commandId;\r\n    stickman.squadCommandCooldown = SQUAD_SETTINGS.commandCooldown;\r\n  }\r\n}\r\n\r\nfunction findNearestEnemy(x, y) {\r\n  let best = null;\r\n  let bestDist = Number.POSITIVE_INFINITY;\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const dx = enemy.x - x;\r\n    const dy = (enemy.y + enemy.height * 0.5) - y;\r\n    const dist = Math.hypot(dx, dy);\r\n    if (dist < bestDist) {\r\n      bestDist = dist;\r\n      best = enemy;\r\n    }\r\n  }\r\n  return best;\r\n}\r\n\r\nfunction updateMovement(entity, delta) {\r\n  entity.vy += GRAVITY * delta;\r\n  const previousY = entity.y;\r\n  entity.x += entity.vx * delta;\r\n  entity.y += entity.vy * delta;\r\n  entity.onGround = false;\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  const landed = resolvePlatformLanding(entity, previousY, standingHeight);\r\n  if (!landed) {\r\n    const feetY = entity.y + standingHeight;\r\n    if (feetY >= GROUND_Y) {\r\n      entity.y = GROUND_Y - standingHeight;\r\n      entity.vy = 0;\r\n      entity.onGround = true;\r\n    }\r\n  }\r\n  entity.vx = Math.max(-SPEED, Math.min(SPEED, entity.vx));\r\n}\r\n\r\nfunction steerTowards(entity, targetX, delta, speedFactor = 1) {\r\n  const desired = targetX - entity.x;\r\n  const threshold = 12;\r\n  entity.vx = 0;\r\n  if (Math.abs(desired) > threshold) {\r\n    const dir = Math.sign(desired);\r\n    entity.vx = dir * SPEED * speedFactor;\r\n    entity.facing = dir;\r\n  }\r\n}\r\n\r\nfunction fireAtTarget(entity, target, delta) {\r\n  entity.fireCooldown = Math.max(0, (entity.fireCooldown ?? 0) - delta);\r\n  if (entity.fireCooldown > 0) {\r\n    return;\r\n  }\r\n  entity.fireCooldown = SQUAD_SETTINGS.supportFireCooldown;\r\n  const facing = target.x >= entity.x ? 1 : -1;\r\n  const muzzleX = entity.x + facing * 24;\r\n  const muzzleY = entity.y + getTotalHeight(POSES.standing) * 0.4;\r\n  spawnProjectile({\r\n    x: muzzleX,\r\n    y: muzzleY,\r\n    vx: facing * SQUAD_SETTINGS.projectileSpeed,\r\n    vy: -20,\r\n    radius: 5,\r\n    lifetime: 0.8,\r\n    color: facing > 0 ? \"#8cffd4\" : \"#a0ffe1\",\r\n    damage: SQUAD_SETTINGS.projectileDamage,\r\n    knockback: 110,\r\n    facing\r\n  });\r\n  entity.flashTimer = 0.12;\r\n}\r\n\r\nfunction updateSquadmate(squadmate, delta) {\r\n  const command = getActiveCommand();\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  const feetY = squadmate.y + standingHeight;\r\n  if (feetY >= GROUND_Y - 2 && Math.abs(squadmate.vy) < 1) {\r\n    squadmate.onGround = true;\r\n  }\r\n\r\n  squadmate.targetEnemyId = null;\r\n\r\n  switch (command?.id) {\r\n    case \"attack\": {\r\n      const target = findNearestEnemy(squadmate.x, squadmate.y);\r\n      if (target && Math.abs(target.x - stickman.x) <= SQUAD_SETTINGS.commandRange) {\r\n        steerTowards(squadmate, target.x - 24, delta, 0.95);\r\n        fireAtTarget(squadmate, target, delta);\r\n        squadmate.targetEnemyId = target.id;\r\n      } else {\r\n        steerTowards(squadmate, stickman.x - 60, delta, 0.8);\r\n      }\r\n      break;\r\n    }\r\n    case \"defend\": {\r\n      const offset = (squadmate.roleIndex ?? 0) * 40 - 40;\r\n      steerTowards(squadmate, stickman.x + offset, delta, 0.7);\r\n      const target = findNearestEnemy(squadmate.x, squadmate.y);\r\n      if (target && Math.abs(target.x - stickman.x) <= SQUAD_SETTINGS.defendRadius) {\r\n        fireAtTarget(squadmate, target, delta);\r\n        squadmate.targetEnemyId = target.id;\r\n      }\r\n      break;\r\n    }\r\n    case \"flank\": {\r\n      const flankSide = (squadmate.roleIndex ?? 0) % 2 === 0 ? -1 : 1;\r\n      const offset = flankSide * SQUAD_SETTINGS.flankOffset;\r\n      steerTowards(squadmate, stickman.x + offset, delta, 0.9);\r\n      const target = findNearestEnemy(squadmate.x, squadmate.y);\r\n      if (target) {\r\n        fireAtTarget(squadmate, target, delta);\r\n        squadmate.targetEnemyId = target.id;\r\n      }\r\n      break;\r\n    }\r\n    case \"hold\":\r\n    default: {\r\n      const offset = (squadmate.roleIndex ?? 0) * 36 - 36;\r\n      steerTowards(squadmate, stickman.x + offset, delta, 0.6);\r\n      break;\r\n    }\r\n  }\r\n\r\n  updateMovement(squadmate, delta);\r\n  squadmate.flashTimer = Math.max(0, (squadmate.flashTimer ?? 0) - delta);\r\n}\r\n\r\nfunction updateSquadmates(delta) {\r\n  stickman.squadCommandCooldown = Math.max(0, stickman.squadCommandCooldown - delta);\r\n  let roleIndex = 0;\r\n  for (const squadmate of squadmates) {\r\n    squadmate.roleIndex = roleIndex;\r\n    roleIndex += 1;\r\n    updateSquadmate(squadmate, delta);\r\n  }\r\n}\r\n\r\nfunction getSquadStatus() {\r\n  return {\r\n    command: getActiveCommand(),\r\n    cooldown: stickman.squadCommandCooldown,\r\n    members: squadmates\r\n  };\r\n}\r\n\r\nexport { updateSquadmates, cycleSquadCommand, setSquadCommandById, getSquadStatus };\r\n","import { canvas, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { vehicles, VEHICLE_DEFINITIONS, getVehicleById } from \"../../state/vehicles.js\";\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { stickman, getTotalHeight } from \"../../state/entities.js\";\r\nimport { input } from \"../input/index.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { spawnProjectile } from \"../combat/projectiles.js\";\r\nimport { POSES, GRAVITY } from \"../../config/constants.js\";\r\n\r\nconst PLAYER_DRIVER_ID = \"player-stickman\";\r\n\r\nfunction getPlayerVehicle() {\r\n  return stickman.vehicleId ? getVehicleById(stickman.vehicleId) : null;\r\n}\r\n\r\nfunction applyIdleDrag(vehicle, dragAmount, delta) {\r\n  if (dragAmount <= 0) {\r\n    return;\r\n  }\r\n  const drag = dragAmount * delta;\r\n  if (vehicle.vx > 0) {\r\n    vehicle.vx = Math.max(0, vehicle.vx - drag);\r\n  } else if (vehicle.vx < 0) {\r\n    vehicle.vx = Math.min(0, vehicle.vx + drag);\r\n  }\r\n}\r\n\r\nfunction applyGroundDriverInput(vehicle, definition, delta) {\r\n  const accelerateRight = input.right && !input.left;\r\n  const accelerateLeft = input.left && !input.right;\r\n  const direction = accelerateRight ? 1 : accelerateLeft ? -1 : 0;\r\n  const acceleration = definition.acceleration ?? 0;\r\n  const braking = definition.braking ?? 600;\r\n  const maxSpeed = definition.maxSpeed ?? 360;\r\n  const idleDrag = definition.idleDrag ?? 0;\r\n\r\n  if (direction !== 0 && acceleration > 0) {\r\n    vehicle.vx += direction * acceleration * delta;\r\n  }\r\n\r\n  if (input.down && vehicle.onGround && braking > 0) {\r\n    const brake = braking * delta;\r\n    if (vehicle.vx > 0) {\r\n      vehicle.vx = Math.max(0, vehicle.vx - brake);\r\n    } else if (vehicle.vx < 0) {\r\n      vehicle.vx = Math.min(0, vehicle.vx + brake);\r\n    }\r\n  } else if (direction === 0) {\r\n    applyIdleDrag(vehicle, idleDrag, delta);\r\n  }\r\n\r\n  if (maxSpeed > 0) {\r\n    vehicle.vx = clamp(vehicle.vx, -maxSpeed, maxSpeed);\r\n  }\r\n\r\n  if (direction !== 0) {\r\n    vehicle.facing = direction;\r\n  } else if (Math.abs(vehicle.vx) > 8) {\r\n    vehicle.facing = vehicle.vx > 0 ? 1 : -1;\r\n  }\r\n}\r\n\r\nfunction syncStickmanWithVehicle(vehicle, definition) {\r\n  const seat = definition.driverSeat ?? { x: 0, y: definition.height };\r\n  const baseHeight = getTotalHeight(POSES.standing);\r\n  const seatWorldX = vehicle.x + seat.x;\r\n  const seatWorldY = vehicle.y + seat.y;\r\n  const envWidth = getEnvironmentWidth();\n  const clampedX = clamp(seatWorldX, 40, envWidth - 40);\r\n  stickman.x = clampedX;\r\n  stickman.y = seatWorldY - baseHeight;\r\n  stickman.vx = vehicle.vx;\r\n  stickman.vy = vehicle.vy;\r\n  const movementType = definition.movementType ?? \"ground\";\r\n  if (movementType === \"air\") {\r\n    stickman.onGround = false;\r\n  } else if (movementType === \"water\") {\r\n    stickman.onGround = true;\r\n  } else {\r\n    stickman.onGround = vehicle.onGround;\r\n  }\r\n  stickman.facing = vehicle.facing ?? stickman.facing;\r\n}\r\n\r\nfunction enterVehicle(vehicle) {\r\n  const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n  if (!definition) {\r\n    return;\r\n  }\r\n\r\n  vehicle.driverId = PLAYER_DRIVER_ID;\r\n  vehicle.enterCooldown = 0.45;\r\n  stickman.vehicleId = vehicle.id;\r\n  stickman.controlMode = \"vehicle\";\r\n  stickman.vehicleCandidateId = null;\r\n  stickman.attacking = false;\r\n  stickman.currentAttack = null;\r\n  stickman.attackIndex = -1;\r\n  stickman.attackElapsed = 0;\r\n  stickman.comboWindowOpen = false;\r\n  stickman.comboWindowTimer = 0;\r\n  stickman.nextAttackQueued = false;\r\n  stickman.hitboxSpawned = false;\r\n  stickman.activeHitboxes.length = 0;\r\n  stickman.crouching = false;\r\n  stickman.rolling = false;\r\n  syncStickmanWithVehicle(vehicle, definition);\r\n}\r\n\r\nfunction exitVehicle(vehicle, options = {}) {\r\n  const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n  if (!definition) {\r\n    stickman.vehicleId = null;\r\n    stickman.controlMode = \"onFoot\";\r\n    return;\r\n  }\r\n\r\n  vehicle.driverId = null;\r\n  if (!options.skipCooldown) {\r\n    vehicle.enterCooldown = Math.max(vehicle.enterCooldown, options.cooldown ?? 0.35);\r\n  }\r\n\r\n  const baseHeight = getTotalHeight(POSES.standing);\r\n  const preferRight = options.preferDirection ?? (vehicle.facing >= 0 ? 1 : -1);\r\n  const exitOffsets = definition.exitOffsets ?? [];\r\n  const fallbackOffset = preferRight >= 0 ? { x: definition.width * 0.6, y: 0 } : { x: -definition.width * 0.6, y: 0 };\r\n  const chosenOffset = preferRight >= 0 ? exitOffsets[0] ?? fallbackOffset : exitOffsets[1] ?? fallbackOffset;\r\n\r\n  stickman.vehicleId = null;\r\n  stickman.controlMode = \"onFoot\";\r\n  stickman.vehicleCandidateId = null;\r\n  const envWidth = getEnvironmentWidth();\n  stickman.x = clamp(vehicle.x + chosenOffset.x, 40, envWidth - 40);\r\n  stickman.y = GROUND_Y - baseHeight;\r\n  if (options.inheritVelocity === false) {\r\n    stickman.vx = 0;\r\n    stickman.vy = 0;\r\n  } else {\r\n    stickman.vx = vehicle.vx * 0.5;\r\n    stickman.vy = Math.min(vehicle.vy, 0);\r\n  }\r\n  stickman.onGround = true;\r\n  stickman.facing = preferRight >= 0 ? 1 : -1;\r\n}\r\n\r\nfunction forcePlayerExitVehicle(options = {}) {\r\n  const vehicle = getPlayerVehicle();\r\n  if (!vehicle) {\r\n    stickman.vehicleId = null;\r\n    stickman.controlMode = \"onFoot\";\r\n    return;\r\n  }\r\n  exitVehicle(vehicle, { skipCooldown: true, inheritVelocity: false, ...options });\r\n}\r\n\r\nfunction handleVehicleInteraction(interactRequested) {\r\n  if (stickman.vehicleId) {\r\n    stickman.vehicleCandidateId = null;\r\n    const vehicle = getPlayerVehicle();\r\n    if (interactRequested && vehicle && vehicle.enterCooldown <= 0.01) {\r\n      exitVehicle(vehicle, { preferDirection: vehicle.facing });\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (stickman.health <= 0) {\r\n    stickman.vehicleCandidateId = null;\r\n    return;\r\n  }\r\n\r\n  let bestVehicle = null;\r\n  let bestScore = Number.POSITIVE_INFINITY;\r\n  const playerHeight = getTotalHeight(POSES.standing);\r\n  const playerFeetY = stickman.y + playerHeight;\r\n\r\n  for (const vehicle of vehicles) {\r\n    const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n    if (!definition) {\r\n      continue;\r\n    }\r\n    if (vehicle.driverId) {\r\n      continue;\r\n    }\r\n    if (vehicle.enterCooldown > 0) {\r\n      continue;\r\n    }\r\n\r\n    const horizontal = Math.abs(stickman.x - vehicle.x);\r\n    const maxHorizontal = definition.enterRadius ?? 64;\r\n    if (horizontal > maxHorizontal) {\r\n      continue;\r\n    }\r\n\r\n    const vehicleFeet = vehicle.y + definition.height;\r\n    const vertical = Math.abs(playerFeetY - vehicleFeet);\r\n    const movementType = definition.movementType ?? \"ground\";\r\n    let verticalAllowance;\r\n    if (movementType === \"air\") {\r\n      verticalAllowance = Math.max(120, (definition.hoverMinAltitude ?? 0) + 80);\r\n    } else if (movementType === \"water\") {\r\n      verticalAllowance = Math.max(90, (definition.waterSurfaceOffset ?? 24) + 70);\r\n    } else {\r\n      verticalAllowance = 80;\r\n    }\r\n    if (vertical > verticalAllowance) {\r\n      continue;\r\n    }\r\n\r\n    const score = horizontal + vertical * 0.5;\r\n    if (score < bestScore) {\r\n      bestScore = score;\r\n      bestVehicle = vehicle;\r\n    }\r\n  }\r\n\r\n  stickman.vehicleCandidateId = bestVehicle?.id ?? null;\r\n\r\n  if (interactRequested && bestVehicle) {\r\n    enterVehicle(bestVehicle);\r\n  }\r\n}\r\n\r\nfunction updateGroundVehicle(vehicle, definition, delta, isControlled) {\r\n  if (isControlled) {\r\n    applyGroundDriverInput(vehicle, definition, delta);\r\n  } else {\r\n    applyIdleDrag(vehicle, definition.idleDrag ?? 0, delta);\r\n  }\r\n\r\n  const airDrag = definition.airDrag ?? 1;\r\n  if (!vehicle.onGround && airDrag > 0 && airDrag < 1) {\r\n    vehicle.vx *= Math.pow(airDrag, Math.max(0, delta * 60));\r\n  }\r\n\r\n  vehicle.vy += GRAVITY * delta;\r\n  vehicle.x += vehicle.vx * delta;\r\n  vehicle.y += vehicle.vy * delta;\r\n\r\n  const groundTop = GROUND_Y - definition.height;\r\n  if (vehicle.y >= groundTop) {\r\n    vehicle.y = groundTop;\r\n    vehicle.vy = 0;\r\n    vehicle.onGround = true;\r\n  } else {\r\n    vehicle.onGround = false;\r\n  }\r\n\r\n  const halfWidth = definition.width * 0.5;\r\n  const minX = halfWidth + 32;\r\n  const envWidth = getEnvironmentWidth();\n  const maxX = envWidth - halfWidth - 32;\r\n  vehicle.x = clamp(vehicle.x, minX, maxX);\r\n  if (vehicle.x === minX || vehicle.x === maxX) {\r\n    vehicle.vx = 0;\r\n  }\r\n\r\n  const targetTilt = clamp(vehicle.vx / Math.max(1, definition.maxSpeed ?? 360) * 0.12, -0.25, 0.25);\r\n  vehicle.tilt += (targetTilt - vehicle.tilt) * Math.min(1, delta * 10);\r\n}\r\n\r\nfunction updateWaterVehicle(vehicle, definition, delta, isControlled) {\r\n  const acceleration = definition.waterAcceleration ?? definition.acceleration ?? 220;\r\n  const maxSpeed = definition.waterMaxSpeed ?? definition.maxSpeed ?? 220;\r\n  const reverseSpeed = definition.waterReverseSpeed ?? Math.max(80, maxSpeed * 0.6);\r\n  const idleDrag = definition.waterIdleDrag ?? definition.idleDrag ?? 200;\r\n  const brakeStrength = (definition.turnDrag ?? 220);\r\n  const bobAmplitude = definition.bobAmplitude ?? 4;\r\n  const bobSpeed = definition.bobSpeed ?? 1.4;\r\n  const splashIntensity = definition.splashIntensity ?? 0.3;\r\n  const waterSurface = vehicle.waterLineY ?? (GROUND_Y - (definition.waterSurfaceOffset ?? 24));\r\n  const buoyancyPoint = definition.buoyancyPoint ?? 0.55;\r\n  const submergedOffset = definition.submergedOffset ?? 0;\r\n\r\n  const steerRight = isControlled && input.right && !input.left;\r\n  const steerLeft = isControlled && input.left && !input.right;\r\n  const direction = steerRight ? 1 : steerLeft ? -1 : 0;\r\n\r\n  if (direction !== 0 && acceleration > 0) {\r\n    vehicle.vx += direction * acceleration * delta;\r\n  } else {\r\n    applyIdleDrag(vehicle, idleDrag, delta);\r\n  }\r\n\r\n  if (isControlled && input.down) {\r\n    const brake = brakeStrength * delta;\r\n    if (vehicle.vx > 0) {\r\n      vehicle.vx = Math.max(vehicle.vx - brake, -reverseSpeed);\r\n    } else if (vehicle.vx < 0) {\r\n      vehicle.vx = Math.min(vehicle.vx + brake, reverseSpeed);\r\n    } else if (brake > 0) {\r\n      vehicle.vx = clamp(vehicle.vx - vehicle.facing * brake * 0.15, -reverseSpeed, reverseSpeed);\r\n    }\r\n  }\r\n\r\n  vehicle.vx = clamp(vehicle.vx, -reverseSpeed, maxSpeed);\r\n\r\n  if (direction !== 0) {\r\n    vehicle.facing = direction;\r\n  } else if (Math.abs(vehicle.vx) > 4) {\r\n    vehicle.facing = vehicle.vx > 0 ? 1 : -1;\r\n  }\r\n\r\n  vehicle.x += vehicle.vx * delta;\r\n  const halfWidth = definition.width * 0.5;\r\n  const minX = halfWidth + 32;\r\n  const envWidth = getEnvironmentWidth();\n  const maxX = envWidth - halfWidth - 32;\r\n  vehicle.x = clamp(vehicle.x, minX, maxX);\r\n  if (vehicle.x === minX || vehicle.x === maxX) {\r\n    vehicle.vx = 0;\r\n  }\r\n\r\n  vehicle.vy = 0;\r\n\r\n  vehicle.bobPhase = (vehicle.bobPhase ?? 0) + delta * (bobSpeed * (isControlled ? 1.2 : 0.85));\r\n  const bobOffset = Math.sin(vehicle.bobPhase) * bobAmplitude;\r\n  const sprayOffset = Math.sin(vehicle.bobPhase * 0.5 + vehicle.x * 0.02) * splashIntensity * 6;\r\n  const targetY = waterSurface - definition.height * buoyancyPoint + submergedOffset + bobOffset + sprayOffset;\r\n  vehicle.y += (targetY - vehicle.y) * Math.min(1, delta * 6.5);\r\n\r\n  vehicle.onGround = false;\r\n\r\n  const tiltTarget = clamp(vehicle.vx / Math.max(1, maxSpeed) * 0.22 + Math.sin(vehicle.bobPhase + vehicle.facing * 0.4) * 0.05, -0.45, 0.45);\r\n  vehicle.tilt += (tiltTarget - vehicle.tilt) * Math.min(1, delta * 5);\r\n}\r\n\r\nfunction updateAirVehicle(vehicle, definition, delta, isControlled) {\r\n  const horizontalAcceleration = definition.horizontalAcceleration ?? definition.acceleration ?? 0;\r\n  const horizontalMaxSpeed = definition.horizontalMaxSpeed ?? definition.maxSpeed ?? 320;\r\n  const horizontalDrag = definition.horizontalDrag ?? definition.idleDrag ?? 200;\r\n  const airDrag = definition.airDrag ?? 0.97;\r\n  const minAltitude = definition.hoverMinAltitude ?? 0;\r\n  const maxAltitude = Math.max(minAltitude, definition.hoverMaxAltitude ?? minAltitude);\r\n  const altitudeRate = definition.altitudeRate ?? 160;\r\n  const autopilotStrength = definition.autopilotStrength ?? 4;\r\n  const verticalDamping = definition.verticalDamping ?? 0.9;\r\n  const maxVerticalSpeed = definition.maxVerticalSpeed ?? 220;\r\n  const liftPower = definition.liftPower ?? 0;\r\n  const descendPower = definition.descendPower ?? liftPower;\r\n\r\n  const accelerateRight = isControlled && input.right && !input.left;\r\n  const accelerateLeft = isControlled && input.left && !input.right;\r\n  const direction = accelerateRight ? 1 : accelerateLeft ? -1 : 0;\r\n\r\n  if (direction !== 0 && horizontalAcceleration > 0) {\r\n    vehicle.vx += direction * horizontalAcceleration * delta;\r\n  } else {\r\n    applyIdleDrag(vehicle, horizontalDrag, delta);\r\n  }\r\n\r\n  if (horizontalMaxSpeed > 0) {\r\n    vehicle.vx = clamp(vehicle.vx, -horizontalMaxSpeed, horizontalMaxSpeed);\r\n  }\r\n\r\n  if (direction !== 0) {\r\n    vehicle.facing = direction;\r\n  } else if (Math.abs(vehicle.vx) > 6) {\r\n    vehicle.facing = vehicle.vx > 0 ? 1 : -1;\r\n  }\r\n\r\n  vehicle.vx *= Math.pow(airDrag, delta * 60);\r\n\r\n  const gravity = GRAVITY * (definition.gravityScale ?? 0.25);\r\n  vehicle.vy += gravity * delta;\r\n\r\n  if (!Number.isFinite(vehicle.preferredAltitude)) {\r\n    vehicle.preferredAltitude = definition.spawnHover ?? minAltitude;\r\n  }\r\n\r\n  if (isControlled) {\r\n    if (input.jump) {\r\n      vehicle.preferredAltitude += altitudeRate * delta;\r\n    }\r\n    if (input.down) {\r\n      vehicle.preferredAltitude -= altitudeRate * delta;\r\n    }\r\n  } else {\r\n    const altitude = GROUND_Y - (vehicle.y + definition.height);\r\n    vehicle.preferredAltitude += (altitude - vehicle.preferredAltitude) * Math.min(1, delta * 0.5);\r\n  }\r\n\r\n  vehicle.preferredAltitude = clamp(vehicle.preferredAltitude, minAltitude, maxAltitude);\r\n\r\n  const altitude = clamp(GROUND_Y - (vehicle.y + definition.height), minAltitude, maxAltitude);\r\n  const altitudeError = vehicle.preferredAltitude - altitude;\r\n  vehicle.vy -= altitudeError * autopilotStrength * delta;\r\n\r\n  if (isControlled && liftPower > 0) {\r\n    if (input.jump) {\r\n      vehicle.vy -= liftPower * 0.25 * delta;\r\n    }\r\n    if (input.down) {\r\n      vehicle.vy += descendPower * 0.25 * delta;\r\n    }\r\n  }\r\n\r\n  vehicle.vy *= Math.pow(verticalDamping, delta * 60);\r\n  if (maxVerticalSpeed > 0) {\r\n    vehicle.vy = clamp(vehicle.vy, -maxVerticalSpeed, maxVerticalSpeed);\r\n  }\r\n\r\n  vehicle.x += vehicle.vx * delta;\r\n  vehicle.y += vehicle.vy * delta;\r\n\r\n  const halfWidth = definition.width * 0.5;\r\n  const minX = halfWidth + 32;\r\n  const envWidth = getEnvironmentWidth();\n  const maxX = envWidth - halfWidth - 32;\r\n  vehicle.x = clamp(vehicle.x, minX, maxX);\r\n  if (vehicle.x === minX || vehicle.x === maxX) {\r\n    vehicle.vx = 0;\r\n  }\r\n\r\n  const newAltitude = clamp(GROUND_Y - (vehicle.y + definition.height), minAltitude, maxAltitude);\r\n  vehicle.y = GROUND_Y - definition.height - newAltitude;\r\n  if ((newAltitude === minAltitude && vehicle.vy > 0) || (newAltitude === maxAltitude && vehicle.vy < 0)) {\r\n    vehicle.vy = 0;\r\n  }\r\n\r\n  vehicle.onGround = false;\r\n\r\n  const targetTilt = clamp(vehicle.vx / Math.max(1, horizontalMaxSpeed) * 0.35 - altitudeError * 0.02, -0.6, 0.6);\r\n  vehicle.tilt += (targetTilt - vehicle.tilt) * Math.min(1, delta * 6);\r\n}\r\n\r\nfunction fireMountedWeaponProjectile(vehicle, mountDef, mountState, facingSign) {\r\n  const followFacing = mountDef.followVehicleFacing !== false;\r\n  const vehicleFacing = vehicle.facing ?? 1;\r\n  const appliedFacing = facingSign !== undefined ? facingSign : (mountDef.facing ?? 1) * (followFacing ? vehicleFacing : 1);\r\n  const offsetX = mountDef.offset?.x ?? 0;\r\n  const offsetY = mountDef.offset?.y ?? 0;\r\n  const facingMultiplier = followFacing ? vehicleFacing : 1;\r\n  const baseX = vehicle.x + offsetX * facingMultiplier;\r\n  const baseY = vehicle.y + offsetY;\r\n  const muzzles = mountDef.muzzles && mountDef.muzzles.length > 0 ? mountDef.muzzles : [{ x: mountDef.muzzle?.x ?? 0, y: mountDef.muzzle?.y ?? 0 }];\r\n  const muzzleIndex = mountState.muzzleIndex ?? 0;\r\n  const muzzle = muzzles[muzzleIndex % muzzles.length];\r\n  mountState.muzzleIndex = (muzzleIndex + 1) % muzzles.length;\r\n  const muzzleX = baseX + (muzzle?.x ?? 0) * facingMultiplier;\r\n  const muzzleY = baseY + (muzzle?.y ?? 0);\r\n\r\n  const projectileDef = mountDef.projectile ?? {};\r\n  const speed = projectileDef.speed ?? 600;\r\n  const scatterRadians = (mountDef.scatter ?? 0) * (Math.PI / 180);\r\n  const spreadAngle = scatterRadians > 0 ? (Math.random() - 0.5) * scatterRadians : 0;\r\n  const facingSignValue = appliedFacing >= 0 ? 1 : -1;\r\n  const vx = Math.cos(spreadAngle) * speed * facingSignValue;\r\n  const vy = Math.sin(spreadAngle) * speed + (projectileDef.verticalSpeed ?? 0);\r\n\r\n  spawnProjectile({\r\n    x: muzzleX,\r\n    y: muzzleY,\r\n    vx,\r\n    vy,\r\n    radius: projectileDef.radius ?? 5,\r\n    lifetime: projectileDef.lifetime ?? 1.3,\r\n    color: projectileDef.color ?? \"#ffd27a\",\r\n    damage: projectileDef.damage ?? 12,\r\n    knockback: projectileDef.knockback ?? 80,\r\n    facing: facingSignValue,\r\n    gravityFactor: projectileDef.gravityFactor ?? 0.12\r\n  });\r\n\r\n  mountState.flashTimer = mountDef.flashDuration ?? 0.1;\r\n  mountState.lastMuzzleX = muzzleX;\r\n  mountState.lastMuzzleY = muzzleY;\r\n}\r\n\r\nfunction updateMountedWeaponsForVehicle(vehicle, definition, delta, isControlled) {\r\n  const mountDefs = definition.mountedWeapons ?? [];\r\n  const mounts = vehicle.mounts ?? [];\r\n  if (mountDefs.length === 0 || mounts.length === 0) {\r\n    return;\r\n  }\r\n\r\n  const vehicleFacing = vehicle.facing ?? 1;\r\n  const wantsPrimary = isControlled && input.attackDown;\r\n  const wantsSecondary = isControlled && input.throwDown;\r\n\r\n  for (let index = 0; index < mountDefs.length; index += 1) {\r\n    const mountDef = mountDefs[index];\r\n    const mountState = mounts[index];\r\n    if (!mountDef || !mountState) {\r\n      continue;\r\n    }\r\n\r\n    mountState.cooldown = Math.max(0, (mountState.cooldown ?? 0) - delta);\r\n    mountState.flashTimer = Math.max(0, (mountState.flashTimer ?? 0) - delta);\r\n\r\n    let shouldFire = false;\r\n    const binding = mountDef.binding ?? \"primary\";\r\n    if (isControlled) {\r\n      if (binding === \"primary\") {\r\n        shouldFire = wantsPrimary;\r\n      } else if (binding === \"secondary\") {\r\n        shouldFire = wantsSecondary;\r\n      }\r\n    } else if (mountDef.autoFire) {\r\n      shouldFire = true;\r\n    }\r\n\r\n    if (!shouldFire || mountState.cooldown > 0) {\r\n      continue;\r\n    }\r\n\r\n    const followFacing = mountDef.followVehicleFacing !== false;\r\n    const facingSign = (mountDef.facing ?? 1) * (followFacing ? vehicleFacing : 1);\r\n    fireMountedWeaponProjectile(vehicle, mountDef, mountState, facingSign);\r\n    mountState.cooldown = mountDef.fireInterval ?? 0.2;\r\n  }\r\n}\r\n\r\nfunction updateVehicles(delta) {\r\n  for (const vehicle of vehicles) {\r\n    const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n    if (!definition) {\r\n      continue;\r\n    }\r\n\r\n    vehicle.enterCooldown = Math.max(0, vehicle.enterCooldown - delta);\r\n    vehicle.damageFlash = Math.max(0, vehicle.damageFlash - delta);\r\n\r\n    const isControlled = vehicle.driverId === PLAYER_DRIVER_ID;\r\n    const movementType = definition.movementType ?? \"ground\";\r\n\r\n    if (movementType === \"air\") {\r\n      updateAirVehicle(vehicle, definition, delta, isControlled);\r\n    } else if (movementType === \"water\") {\r\n      updateWaterVehicle(vehicle, definition, delta, isControlled);\r\n    } else {\r\n      updateGroundVehicle(vehicle, definition, delta, isControlled);\r\n    }\r\n\r\n    updateMountedWeaponsForVehicle(vehicle, definition, delta, isControlled);\r\n\r\n    if (isControlled) {\r\n      syncStickmanWithVehicle(vehicle, definition);\r\n    } else if (movementType === \"ground\") {\r\n      vehicle.tilt += (0 - vehicle.tilt) * Math.min(1, delta * 10);\r\n    }\r\n  }\r\n}\r\n\r\nexport { updateVehicles, handleVehicleInteraction, getPlayerVehicle, forcePlayerExitVehicle };\r\n\r\n\r\n","import { context, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { POSES, SPEED } from \"../../config/constants.js\";\r\nimport { getEnvironmentDefinition } from \"../../state/environment.js\";\r\nimport { stickman, trainingDummy, enemies, squadmates, getRemotePlayers } from \"../../state/entities.js\";\r\nimport { getServerBrowserState } from \"../../state/serverBrowser.js\";\r\nimport { vehicles, VEHICLE_DEFINITIONS, getVehicleById } from \"../../state/vehicles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { getElapsedTime } from \"../utils/time.js\";\r\nimport { getCurrentWeapon, getWeaponSlots } from \"../combat/weapons.js\";\r\nimport { getAmmoStatus } from \"../../state/ammo.js\";\r\nimport { drawProjectiles } from \"../combat/projectiles.js\";\r\nimport { drawThrowables } from \"../combat/throwables.js\";\r\nimport { drawGadgets, getGadgetStatus } from \"../gadgets/index.js\";\r\nimport { drawSupplyDrops } from \"./supplyDrops.js\";\r\nimport { drawDestructibles } from \"./destructibles.js\";\r\nimport { drawBuildings, drawBuildPreview } from \"./buildings.js\";\r\nimport { drawSalvagePickups } from \"./resources.js\";\r\nimport { getSurvivalHudStatus } from \"../survival/index.js\";\r\nimport { drawInteractables } from \"./interactables.js\";\r\nimport { getBuildingHudStatus } from \"../building/index.js\";\r\nimport { drawParticles } from \"../effects/particles.js\";\r\nimport { getPolishDebugState } from \"../events/polishDebug.js\";\r\nimport { getRecoilOffset } from \"../../state/recoil.js\";\r\nimport { getSupplyDropStatus } from \"../world/supplyDrops.js\";\r\nimport { getP2PStatus } from \"../network/p2p.js\";\r\nimport { getSquadStatus } from \"../squad/index.js\";\r\nimport { getPlayerVehicle } from \"../vehicles/index.js\";\r\n\r\nfunction drawBackground(camera) {\r\n  const environment = getEnvironmentDefinition();\r\n  const background = environment?.background ?? {};\r\n  const offsetX = camera?.offsetX ?? 0;\r\n  const gradientStops = Array.isArray(background.gradientStops) && background.gradientStops.length > 0\r\n    ? background.gradientStops\r\n    : [\r\n        { offset: 0, color: \"#111a2c\" },\r\n        { offset: 0.4, color: \"#182439\" },\r\n        { offset: 0.75, color: \"#1f2d44\" },\r\n        { offset: 1, color: \"#232f49\" }\r\n      ];\r\n  const skyGradient = context.createLinearGradient(0, 0, 0, context.canvas.height);\r\n  for (const stop of gradientStops) {\r\n    const offset = typeof stop.offset === \"number\" ? Math.min(Math.max(stop.offset, 0), 1) : 0;\r\n    const color = stop.color ?? \"#111a2c\";\r\n    skyGradient.addColorStop(offset, color);\r\n  }\r\n  context.fillStyle = skyGradient;\r\n  context.fillRect(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n  const silhouettes = Array.isArray(background.silhouettes) ? background.silhouettes : [];\r\n  for (const silhouette of silhouettes) {\r\n    const points = Array.isArray(silhouette.points) ? silhouette.points : [];\r\n    if (points.length < 3) {\r\n      continue;\r\n    }\r\n    context.fillStyle = silhouette.color ?? \"rgba(0, 0, 0, 0.45)\";\r\n    context.beginPath();\r\n    context.moveTo(points[0].x - offsetX, points[0].y);\r\n    for (let i = 1; i < points.length; i += 1) {\r\n      context.lineTo(points[i].x - offsetX, points[i].y);\r\n    }\r\n    context.closePath();\r\n    context.fill();\r\n  }\r\n\r\n  const horizon = background.horizonBand;\r\n  if (horizon) {\r\n    const height = horizon.height ?? 120;\r\n    const start = horizon.start ?? GROUND_Y - height - 30;\r\n    const band = context.createLinearGradient(0, start, 0, start + height);\r\n    band.addColorStop(0, horizon.topColor ?? \"rgba(46, 86, 126, 0.25)\");\r\n    band.addColorStop(1, horizon.bottomColor ?? \"rgba(28, 52, 84, 0)\");\r\n    context.fillStyle = band;\r\n    context.fillRect(0, start, context.canvas.width, height);\r\n  }\r\n\r\n  if (environment?.theme === \"desert\") {\r\n    const sunX = background.sun?.x ?? context.canvas.width * 0.72;\r\n    const sunY = background.sun?.y ?? context.canvas.height * 0.18;\r\n    const sunRadius = background.sun?.radius ?? 70;\r\n    const sunGradient = context.createRadialGradient(sunX, sunY, 0, sunX, sunY, sunRadius);\r\n    sunGradient.addColorStop(0, \"rgba(255, 214, 128, 0.9)\");\r\n    sunGradient.addColorStop(1, \"rgba(255, 214, 128, 0)\");\r\n    context.fillStyle = sunGradient;\r\n    context.beginPath();\r\n    context.arc(sunX, sunY, sunRadius, 0, Math.PI * 2);\r\n    context.fill();\r\n  } else if (environment?.theme === \"sci-fi\") {\r\n    const step = 110;\r\n    context.fillStyle = \"#a8c2ff\";\r\n    context.globalAlpha = 0.35;\r\n    for (let x = 0; x < context.canvas.width; x += step) {\r\n      for (let y = 0; y < GROUND_Y - 40; y += step) {\r\n        const jitterX = (Math.sin(x * 13.37 + y) * 8) % 18;\r\n        const jitterY = (Math.cos(y * 7.91 + x) * 6) % 14;\r\n        context.fillRect(x + jitterX, y + jitterY, 2, 2);\r\n      }\r\n    }\r\n    context.globalAlpha = 1;\r\n  }\r\n\r\n  if (environment?.theme === \"jungle\") {\r\n    const mistStart = GROUND_Y - 140;\r\n    const mistGradient = context.createLinearGradient(0, mistStart, 0, GROUND_Y);\r\n    mistGradient.addColorStop(0, \"rgba(60, 120, 80, 0.18)\");\r\n    mistGradient.addColorStop(1, \"rgba(40, 70, 50, 0)\");\r\n    context.fillStyle = mistGradient;\r\n    context.fillRect(0, mistStart, context.canvas.width, GROUND_Y - mistStart);\r\n  }\r\n\r\n  context.fillStyle = background.groundColor ?? \"#1b2231\";\r\n  context.fillRect(0, GROUND_Y, context.canvas.width, context.canvas.height - GROUND_Y);\r\n}\r\n\r\nfunction drawVehicles() {\r\n  const playerVehicle = getPlayerVehicle();\r\n  const candidateId = stickman.vehicleCandidateId;\r\n\r\n  for (const vehicle of vehicles) {\r\n    const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n    if (!definition) {\r\n      continue;\r\n    }\r\n\r\n    const isPlayerVehicle = playerVehicle?.id === vehicle.id;\r\n    const isCandidate = !isPlayerVehicle && candidateId === vehicle.id;\r\n    const bodyWidth = definition.width ?? 120;\r\n    const bodyHeight = definition.height ?? 48;\r\n    const bodyColor = definition.colorBody ?? \"#2c3245\";\r\n    const accentColor = definition.colorAccent ?? \"#f0b239\";\r\n\r\n    context.save();\r\n    context.translate(vehicle.x, vehicle.y);\r\n    context.rotate(((vehicle.tilt ?? 0) * Math.PI) / 180);\r\n\r\n    context.fillStyle = bodyColor;\r\n    context.fillRect(-bodyWidth / 2, -bodyHeight / 2, bodyWidth, bodyHeight);\r\n\r\n    context.fillStyle = accentColor;\r\n    context.fillRect(-bodyWidth / 2, -bodyHeight / 2 - 6, bodyWidth * 0.6, 8);\r\n\r\n    context.restore();\r\n\r\n    if (isPlayerVehicle || isCandidate) {\r\n      context.save();\r\n      context.lineWidth = isPlayerVehicle ? 4 : 3;\r\n      context.strokeStyle = isPlayerVehicle ? \"#8cffd4\" : \"#ffc66d\";\r\n      context.setLineDash(isPlayerVehicle ? [] : [8, 8]);\r\n      context.strokeRect(\r\n        vehicle.x - bodyWidth / 2 - 10,\r\n        vehicle.y - bodyHeight / 2 - 12,\r\n        bodyWidth + 20,\r\n        bodyHeight + 24\r\n      );\r\n      context.restore();\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawRemotePlayers() {\r\n  const players = getRemotePlayers();\r\n  for (const remote of players) {\r\n    const pose = POSES.standing;\r\n    const headRadius = pose.headRadius;\r\n    const bodyLength = pose.bodyLength;\r\n    const legLength = pose.legLength;\r\n    const armLength = pose.armLength;\r\n    context.save();\r\n    context.strokeStyle = \"#ff9cf7\";\r\n    context.lineWidth = 4;\r\n    const headCenterY = remote.y + headRadius;\r\n    context.beginPath();\r\n    context.arc(remote.x, headCenterY, headRadius, 0, Math.PI * 2);\r\n    context.stroke();\r\n    const neckY = remote.y + headRadius * 2;\r\n    const torsoBottomY = neckY + bodyLength;\r\n    context.beginPath();\r\n    context.moveTo(remote.x, neckY);\r\n    context.lineTo(remote.x, torsoBottomY);\r\n    context.stroke();\r\n    context.beginPath();\r\n    context.moveTo(remote.x, neckY + 4);\r\n    context.lineTo(remote.x - armLength, neckY + armLength * 0.8);\r\n    context.moveTo(remote.x, neckY + 4);\r\n    context.lineTo(remote.x + armLength, neckY + armLength * 0.6);\r\n    context.stroke();\r\n    const legReach = Math.max(armLength * 0.7, 14);\r\n    const leftFootY = Math.min(GROUND_Y, torsoBottomY + legLength);\r\n    const rightFootY = Math.min(GROUND_Y, torsoBottomY + legLength * 0.95);\r\n    context.beginPath();\r\n    context.moveTo(remote.x, torsoBottomY);\r\n    context.lineTo(remote.x - legReach, leftFootY);\r\n    context.moveTo(remote.x, torsoBottomY);\r\n    context.lineTo(remote.x + legReach, rightFootY);\r\n    context.stroke();\r\n    context.fillStyle = \"#ffd6ff\";\r\n    context.font = \"13px 'Segoe UI', Arial, sans-serif\";\r\n    context.textAlign = \"center\";\r\n    context.fillText(remote.name ?? remote.id ?? \"Peer\", remote.x, remote.y - 16);\r\n    context.restore();\r\n  }\r\n}\r\n\r\nfunction drawSquadmates() {\r\n  const squadStatus = getSquadStatus();\r\n  const commandId = squadStatus?.command?.id ?? \"hold\";\r\n  const commandColors = {\r\n    hold: \"#8cffd4\",\r\n    defend: \"#66b3ff\",\r\n    attack: \"#ff9f7a\",\r\n    flank: \"#ffdd6f\"\r\n  };\r\n  for (const ally of squadmates) {\r\n    const pose = POSES.standing;\r\n    const headRadius = pose.headRadius;\r\n    const bodyLength = pose.bodyLength;\r\n    const legLength = pose.legLength;\r\n    const armLength = pose.armLength;\r\n\r\n    context.save();\r\n    const outline = commandColors[commandId] ?? \"#8cffd4\";\r\n    context.strokeStyle = outline;\r\n    context.lineWidth = 4;\r\n    context.lineCap = \"round\";\r\n\r\n    const headCenterY = ally.y + headRadius;\r\n    context.beginPath();\r\n    context.arc(ally.x, headCenterY, headRadius, 0, Math.PI * 2);\r\n    context.stroke();\r\n\r\n    const neckY = ally.y + headRadius * 2;\r\n    const torsoBottomY = neckY + bodyLength;\r\n    context.beginPath();\r\n    context.moveTo(ally.x, neckY);\r\n    context.lineTo(ally.x, torsoBottomY);\r\n    context.stroke();\r\n\r\n    context.beginPath();\r\n    context.moveTo(ally.x, neckY + 4);\r\n    context.lineTo(ally.x - armLength, neckY + armLength * 0.8);\r\n    context.moveTo(ally.x, neckY + 4);\r\n    context.lineTo(ally.x + armLength, neckY + armLength * 0.6);\r\n    context.stroke();\r\n\r\n    const legReach = Math.max(armLength * 0.7, 14);\r\n    const leftFootY = Math.min(GROUND_Y, torsoBottomY + legLength);\r\n    const rightFootY = Math.min(GROUND_Y, torsoBottomY + legLength * 0.95);\r\n\r\n    context.beginPath();\r\n    context.moveTo(ally.x, torsoBottomY);\r\n    context.lineTo(ally.x - legReach, leftFootY);\r\n    context.moveTo(ally.x, torsoBottomY);\r\n    context.lineTo(ally.x + legReach, rightFootY);\r\n    context.stroke();\r\n\r\n    if ((ally.flashTimer ?? 0) > 0) {\r\n      const alpha = Math.min(1, ally.flashTimer / 0.12);\r\n      context.fillStyle = `rgba(140, 255, 212, ${alpha})`;\r\n      context.beginPath();\r\n      context.arc(ally.x + ally.facing * 30, neckY + armLength * 0.2, 12, 0, Math.PI * 2);\r\n      context.fill();\r\n    }\r\n\r\n    context.fillStyle = outline;\r\n    context.font = \"14px 'Segoe UI', Arial, sans-serif\";\r\n    context.textAlign = \"center\";\r\n    context.fillText(ally.name ?? \"Ally\", ally.x, ally.y - 12);\r\n    context.restore();\r\n  }\r\n}\r\n\r\nfunction drawStickman() {\r\n  if (stickman.health <= 0 || stickman.vehicleId) {\r\n    return;\r\n  }\r\n\r\n  const pose = stickman.currentPose || POSES.standing;\r\n  const attack = stickman.currentAttack;\r\n  const { headRadius, bodyLength, legLength, armLength, strideMultiplier, armSwingAmplitude, legSwingAmplitude } = pose;\r\n  const elapsed = getElapsedTime();\r\n\r\n  const baseStride = Math.min(1, Math.abs(stickman.vx) / SPEED);\r\n  const strideStrength = baseStride * strideMultiplier;\r\n\r\n  let swing = Math.sin(elapsed * 8) * armSwingAmplitude * strideStrength;\r\n  if (stickman.attacking && attack) {\r\n    const totalDuration = attack.windup + attack.active + attack.recovery;\r\n    const progress = clamp(stickman.attackElapsed / totalDuration, 0, 1);\r\n    swing += Math.sin(progress * Math.PI) * 28 * stickman.facing;\r\n  }\r\n\r\n  context.lineWidth = 4;\r\n  context.strokeStyle = \"#f4f7ff\";\r\n  context.lineCap = \"round\";\r\n\r\n  const headCenterY = stickman.y + headRadius;\r\n  context.beginPath();\r\n  context.arc(stickman.x, headCenterY, headRadius, 0, Math.PI * 2);\r\n  context.stroke();\r\n\r\n  const neckY = stickman.y + headRadius * 2;\r\n  const torsoBottomY = neckY + bodyLength;\r\n  context.beginPath();\r\n  context.moveTo(stickman.x, neckY);\r\n  context.lineTo(stickman.x, torsoBottomY);\r\n  context.stroke();\r\n\r\n  context.beginPath();\r\n  context.moveTo(stickman.x, neckY + 6);\r\n  context.lineTo(stickman.x - armLength, neckY + armLength + swing);\r\n  context.moveTo(stickman.x, neckY + 6);\r\n  context.lineTo(stickman.x + armLength, neckY + armLength - swing);\r\n  context.stroke();\r\n\r\n  const phaseOffset = Math.PI / 2;\r\n  const legSwingBase = Math.sin(elapsed * 8 + phaseOffset) * legSwingAmplitude * strideStrength;\r\n  const legReach = Math.max(armLength * 0.7, 14);\r\n  const leftFootY = Math.min(GROUND_Y, torsoBottomY + legLength + legSwingBase);\r\n  const rightFootY = Math.min(GROUND_Y, torsoBottomY + legLength - legSwingBase);\r\n\r\n  context.beginPath();\r\n  context.moveTo(stickman.x, torsoBottomY);\r\n  context.lineTo(stickman.x - legReach, leftFootY);\r\n  context.moveTo(stickman.x, torsoBottomY);\r\n  context.lineTo(stickman.x + legReach, rightFootY);\r\n  context.stroke();\r\n\r\n  if (stickman.rolling) {\r\n    context.strokeStyle = \"#9aa2b1\";\r\n    context.beginPath();\r\n    context.arc(stickman.x, torsoBottomY - legLength * 0.5, headRadius + 4, 0, Math.PI * 2);\r\n    context.stroke();\r\n    context.strokeStyle = \"#f4f7ff\";\r\n  }\r\n}\r\n\r\nfunction drawHitboxes() {\r\n  for (const hitbox of stickman.activeHitboxes) {\r\n    const alpha = clamp(hitbox.remaining / hitbox.duration, 0, 1);\r\n    context.fillStyle = `rgba(255, 153, 102, ${0.2 * alpha})`;\r\n    context.beginPath();\r\n    context.arc(hitbox.x, hitbox.y, hitbox.radius, 0, Math.PI * 2);\r\n    context.fill();\r\n\r\n    context.strokeStyle = `rgba(255, 198, 141, ${alpha})`;\r\n    context.lineWidth = 2;\r\n    context.beginPath();\r\n    context.arc(hitbox.x, hitbox.y, hitbox.radius, 0, Math.PI * 2);\r\n    context.stroke();\r\n  }\r\n}\r\n\r\nfunction drawTrainingDummy() {\r\n  const dummy = trainingDummy;\r\n  const elapsed = getElapsedTime();\r\n  const headRadius = 20;\r\n  const topY = dummy.y;\r\n  const shake = dummy.shakeTimer > 0 ? Math.sin(elapsed * 40) * dummy.shakeMagnitude * clamp(dummy.shakeTimer / 0.4, 0, 1) : 0;\r\n  const offsetX = dummy.health > 0 ? shake : 0;\r\n  const bodyColor = dummy.health > 0 ? (dummy.flashTimer > 0 ? \"#ffe3af\" : \"#9ca4b8\") : \"#3b3f49\";\r\n\r\n  context.lineWidth = 5;\r\n  context.strokeStyle = bodyColor;\r\n  context.lineCap = \"round\";\r\n\r\n  const centerX = dummy.x + offsetX;\r\n  context.beginPath();\r\n  context.arc(centerX, topY + headRadius, headRadius, 0, Math.PI * 2);\r\n  context.stroke();\r\n\r\n  context.beginPath();\r\n  context.moveTo(centerX, topY + headRadius * 2);\r\n  context.lineTo(centerX, GROUND_Y - headRadius);\r\n  context.stroke();\r\n\r\n  context.beginPath();\r\n  context.moveTo(centerX, GROUND_Y - headRadius);\r\n  context.lineTo(centerX - 28, GROUND_Y);\r\n  context.moveTo(centerX, GROUND_Y - headRadius);\r\n  context.lineTo(centerX + 28, GROUND_Y);\r\n  context.stroke();\r\n\r\n  const armY = topY + headRadius * 2.4;\r\n  context.beginPath();\r\n  context.moveTo(centerX, armY);\r\n  context.lineTo(centerX - 36, armY + 18);\r\n  context.moveTo(centerX, armY);\r\n  context.lineTo(centerX + 36, armY + 18);\r\n  context.stroke();\r\n\r\n  const barWidth = 140;\r\n  const barHeight = 10;\r\n  const barX = centerX - barWidth / 2;\r\n  const barY = topY - 24;\r\n  context.fillStyle = \"#23262d\";\r\n  context.fillRect(barX, barY, barWidth, barHeight);\r\n  const healthRatio = dummy.health / dummy.maxHealth;\r\n  context.fillStyle = dummy.health > 0 ? \"#5fffb5\" : \"#44474f\";\r\n  context.fillRect(barX, barY, barWidth * clamp(healthRatio, 0, 1), barHeight);\r\n  context.strokeStyle = \"#50535b\";\r\n  context.strokeRect(barX, barY, barWidth, barHeight);\r\n\r\n  context.fillStyle = \"#cfd3df\";\r\n  context.font = \"14px 'Segoe UI', Arial, sans-serif\";\r\n  context.textAlign = \"center\";\r\n  const label = dummy.health > 0 ? `Training Dummy ${Math.round(dummy.health)}/${dummy.maxHealth}` : \"Respawning...\";\r\n  context.fillText(label, centerX, barY - 6);\r\n  context.textAlign = \"left\";\r\n}\r\n\r\nfunction drawEnemies() {\r\n  const elapsed = getElapsedTime();\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n\r\n    const shake = enemy.shakeTimer > 0 ? Math.sin(elapsed * 32) * enemy.shakeMagnitude * clamp(enemy.shakeTimer / 0.4, 0, 1) : 0;\r\n    const centerX = enemy.x + shake;\r\n    const headRadius = 18;\r\n    const bodyColor = enemy.stunTimer > 0 ? \"#ffd166\" : (enemy.flashTimer > 0 ? \"#ff9488\" : \"#fa5b4a\");\r\n\r\n    context.lineWidth = 5;\r\n    context.strokeStyle = bodyColor;\r\n    context.lineCap = \"round\";\r\n\r\n    const topY = enemy.y;\r\n    context.beginPath();\r\n    context.arc(centerX, topY + headRadius, headRadius, 0, Math.PI * 2);\r\n    context.stroke();\r\n\r\n    context.beginPath();\r\n    context.moveTo(centerX, topY + headRadius * 2);\r\n    context.lineTo(centerX, topY + enemy.height - 24);\r\n    context.stroke();\r\n\r\n    context.beginPath();\r\n    context.moveTo(centerX, topY + headRadius * 2.4);\r\n    context.lineTo(centerX - 30, topY + headRadius * 3);\r\n    context.moveTo(centerX, topY + headRadius * 2.4);\r\n    context.lineTo(centerX + 30, topY + headRadius * 3);\r\n    context.stroke();\r\n\r\n    context.beginPath();\r\n    context.moveTo(centerX, enemy.y + enemy.height - 26);\r\n    context.lineTo(centerX - 24, enemy.y + enemy.height);\r\n    context.moveTo(centerX, enemy.y + enemy.height - 26);\r\n    context.lineTo(centerX + 24, enemy.y + enemy.height);\r\n    context.stroke();\r\n\r\n    const barWidth = 110;\r\n    const barHeight = 8;\r\n    const barX = centerX - barWidth / 2;\r\n    const barY = topY - 20;\r\n    context.fillStyle = \"#230c0a\";\r\n    context.fillRect(barX, barY, barWidth, barHeight);\r\n    const ratio = enemy.health / enemy.maxHealth;\r\n    context.fillStyle = \"#ff6f61\";\r\n    context.fillRect(barX, barY, barWidth * clamp(ratio, 0, 1), barHeight);\r\n    context.strokeStyle = \"#5c3029\";\r\n    context.strokeRect(barX, barY, barWidth, barHeight);\r\n  }\r\n}\r\n\r\nfunction drawHud() {\r\n  const currentWeapon = getCurrentWeapon();\r\n  const weaponName = currentWeapon?.name ?? \"Unarmed\";\r\n  const weaponSlots = getWeaponSlots();\r\n  const ammoStatus = currentWeapon ? getAmmoStatus(currentWeapon.id) : null;\r\n  const recoilOffset = getRecoilOffset();\r\n\r\n  if ((stickman.flashBlindTimer ?? 0) > 0) {\r\n    const overlayAlpha = Math.min(0.55, (stickman.flashBlindTimer ?? 0) / 1.2);\r\n    context.fillStyle = `rgba(255, 255, 224, ${overlayAlpha})`;\r\n    context.fillRect(0, 0, context.canvas.width, context.canvas.height);\r\n  }\r\n\r\n  context.fillStyle = \"#d0d4de\";\r\n  context.font = \"16px 'Segoe UI', Arial, sans-serif\";\r\n  context.textAlign = \"left\";\r\n  context.fillText(\"Move: WASD/Arrows   Jump: Space   Crouch: S   Roll: Shift   Attack: J or Left Click   Throw: G or Right Click   Build: B toggle, ,/. cycle, Left Click place\", 24, 32);\r\n  context.fillText(\"Cancel Build: Esc\", 24, 48);\r\n  context.fillText(\"Server Browser: L (toggle)  |  Join: Enter  |  Host: H  |  Offer: O  |  Paste: P  |  Apply: I  |  ICE Copy: M  |  ICE Apply: N\", 24, 64);\r\n  const weaponHudX = context.canvas.width - 24;\r\n  let weaponHudY = 32;\r\n  context.save();\r\n  context.textAlign = \"right\";\r\n  context.fillStyle = \"#d0d4de\";\r\n  context.fillText(`Weapon: ${weaponName}`, weaponHudX, weaponHudY);\r\n  weaponHudY += 18;\r\n  if (ammoStatus) {\r\n    const isInfinite = ammoStatus.capacity === Number.POSITIVE_INFINITY;\r\n    const magazineDisplay = isInfinite ? \"INF\" : `${Math.max(0, ammoStatus.magazine)}`;\r\n    const reserveDisplay = isInfinite ? \"INF\" : `${Math.max(0, ammoStatus.reserve)}`;\r\n    let ammoLabel = `Ammo: ${magazineDisplay}/${reserveDisplay}`;\r\n    if (ammoStatus.reloading) {\r\n      ammoLabel += ` (Reloading ${Math.max(0, ammoStatus.reloadTimer).toFixed(1)}s)`;\r\n    }\r\n    context.fillText(ammoLabel, weaponHudX, weaponHudY);\r\n    weaponHudY += 18;\r\n  }\r\n  const gadgetStatus = getGadgetStatus();\r\n  if (gadgetStatus) {\r\n    context.fillStyle = gadgetStatus.ready ? \"#8cffd4\" : \"#d0d4de\";\r\n    const gadgetLabel = gadgetStatus.label ?? gadgetStatus.id ?? \"Gadget\";\r\n    const cooldownLabel = gadgetStatus.cooldown > 0 ? ` (${gadgetStatus.cooldown.toFixed(1)}s)` : \"\";\r\n    context.fillText(`${gadgetLabel}${cooldownLabel}`, weaponHudX, weaponHudY);\r\n    weaponHudY += 18;\r\n  }\r\n  context.restore();\r\n\r\n  const comboText = stickman.attacking && stickman.currentAttack ? `Combo: ${stickman.currentAttack.name}` : \"Combo: Ready\";\r\n\r\n  let hudY = 84;\r\n  const survivalHud = getSurvivalHudStatus();\r\n  if (survivalHud && survivalHud.active) {\r\n    const stage = survivalHud.stage ?? \"wave\";\r\n    const waveNumber = Math.max(1, stage === \"countdown\" ? survivalHud.wave + 1 : survivalHud.wave || 1);\r\n    context.fillStyle = \"#ffd66c\";\r\n    context.fillText(`Survival Wave ${waveNumber}`, 24, hudY);\r\n    hudY += 18;\r\n    context.fillStyle = \"#d0d4de\";\r\n    if (stage === \"countdown\") {\r\n      context.fillText(`Next wave in ${survivalHud.timer.toFixed(1)}s`, 24, hudY);\r\n      hudY += 18;\r\n    } else if (stage === \"wave\") {\r\n      context.fillText(`Enemies remaining: ${survivalHud.enemiesAlive}`, 24, hudY);\r\n      hudY += 18;\r\n    } else if (stage === \"rest\") {\r\n      context.fillText(`Resupply time: ${survivalHud.timer.toFixed(1)}s`, 24, hudY);\r\n      hudY += 18;\r\n    }\r\n    if ((survivalHud.lastReward ?? 0) > 0) {\r\n      context.fillStyle = \"#8cffd4\";\r\n      context.fillText(`Last reward: +${survivalHud.lastReward} materials`, 24, hudY);\r\n      hudY += 18;\r\n      context.fillStyle = \"#d0d4de\";\r\n    }\r\n  } else {\r\n    context.fillStyle = \"#9aa2b1\";\r\n    context.fillText(\"Survival Mode: Press Y to begin waves\", 24, hudY);\r\n    hudY += 18;\r\n    context.fillStyle = \"#d0d4de\";\r\n  }\r\n  context.fillText(comboText, 24, hudY);\r\n  hudY += 20;\r\n  let infoY = hudY;\r\n  const buildingHud = getBuildingHudStatus();\r\n  if (buildingHud) {\r\n    if (buildingHud.active) {\r\n      context.fillStyle = buildingHud.valid ? \"#8cffd4\" : \"#ff9c9c\";\r\n      context.fillText(`Building: ${buildingHud.blueprintName} (Cost ${buildingHud.cost || 0})`, 24, infoY);\r\n      infoY += 18;\r\n      context.fillStyle = \"#d0d4de\";\r\n      context.fillText(`Materials: ${buildingHud.resources}`, 24, infoY);\r\n      infoY += 20;\r\n    } else {\r\n      context.fillStyle = \"#9aa2b1\";\r\n      context.fillText(`Materials: ${buildingHud.resources}   (Press B to build)`, 24, infoY);\r\n      infoY += 20;\r\n    }\r\n    context.fillStyle = \"#d0d4de\";\r\n  }\r\n  const playerVehicle = getPlayerVehicle();\r\n  if (playerVehicle) {\r\n    const vehicleDefinition = VEHICLE_DEFINITIONS[playerVehicle.type];\r\n    const vehicleLabel = vehicleDefinition?.label ?? playerVehicle.type;\r\n    const movementType = vehicleDefinition?.movementType ?? \"ground\";\r\n    context.fillStyle = \"#8cffd4\";\r\n    context.fillText(`Vehicle: ${vehicleLabel} (E to exit)`, 24, infoY);\r\n    infoY += 20;\r\n    context.fillStyle = \"#9aa2b1\";\r\n    if (movementType === \"air\") {\r\n      context.fillText(\"Controls: A/D strafe   Space rise   S descend\", 24, infoY);\r\n    } else if (movementType === \"water\") {\r\n      context.fillText(\"Controls: A/D throttle   S brake/reverse\", 24, infoY);\r\n    } else {\r\n      context.fillText(\"Controls: A/D drive   S brake\", 24, infoY);\r\n    }\r\n    infoY += 20;\r\n    const mountedWeapons = vehicleDefinition?.mountedWeapons ?? [];\r\n    if (mountedWeapons.length > 0) {\r\n      for (const mount of mountedWeapons) {\r\n        const bindingLabel = (mount.binding ?? \"primary\").toLowerCase() === \"secondary\" ? \"Secondary\" : \"Primary\";\r\n        const mountLabel = mount.label ?? mount.id ?? \"Mounted Weapon\";\r\n        context.fillStyle = bindingLabel === \"Primary\" ? \"#cfe3ff\" : \"#ffd3a3\";\r\n        context.fillText(`${bindingLabel}: ${mountLabel}`, 24, infoY);\r\n        infoY += 18;\r\n      }\r\n    }\r\n  } else if (stickman.vehicleCandidateId) {\r\n    const candidate = getVehicleById(stickman.vehicleCandidateId);\r\n    if (candidate) {\r\n      const candidateDefinition = VEHICLE_DEFINITIONS[candidate.type];\r\n      const candidateLabel = candidateDefinition?.label ?? candidate.type;\r\n      const movementType = candidateDefinition?.movementType ?? \"ground\";\r\n      context.fillStyle = \"#ffc66d\";\r\n      context.fillText(`Nearby: ${candidateLabel} [E to enter]`, 24, infoY);\r\n      infoY += 20;\r\n      context.fillStyle = \"#9aa2b1\";\r\n      if (movementType === \"air\") {\r\n        context.fillText(\"Tip: Space rises, S descends when piloting\", 24, infoY);\r\n        infoY += 20;\r\n      } else if (movementType === \"water\") {\r\n        context.fillText(\"Tip: Boats use A/D throttle, S to brake/reverse\", 24, infoY);\r\n        infoY += 20;\r\n      } else {\r\n        context.fillText(\"Tip: Hold S to brake while driving\", 24, infoY);\r\n        infoY += 20;\r\n      }\r\n      const candidateWeapons = candidateDefinition?.mountedWeapons ?? [];\r\n      if (candidateWeapons.length > 0) {\r\n        context.fillStyle = \"#d6e2ff\";\r\n        for (const mount of candidateWeapons) {\r\n          const bindingLabel = (mount.binding ?? \"primary\").toLowerCase() === \"secondary\" ? \"Secondary\" : \"Primary\";\r\n          const mountLabel = mount.label ?? mount.id ?? \"Mounted Weapon\";\r\n          context.fillText(`${bindingLabel}: ${mountLabel}`, 24, infoY);\r\n          infoY += 18;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  context.fillStyle = \"#d0d4de\";\r\n\r\n  const supplyStatus = getSupplyDropStatus();\r\n  if (supplyStatus) {\r\n    if (supplyStatus.incomingMessage) {\r\n      const alpha = clamp(0.35 + 0.65 * (supplyStatus.incomingAlpha ?? 0), 0, 1);\r\n      context.fillStyle = `rgba(176, 210, 255, ${alpha})`;\r\n      context.fillText(supplyStatus.incomingMessage, 24, infoY);\r\n      infoY += 20;\r\n      context.fillStyle = \"#d0d4de\";\r\n    }\r\n    if ((supplyStatus.timeUntilNext ?? 0) > 0.2 && supplyStatus.nextDropLabel) {\r\n      const eta = supplyStatus.timeUntilNext;\r\n      context.fillText(`Next Drop (${supplyStatus.nextDropLabel}): ${eta.toFixed(1)}s`, 24, infoY);\r\n      infoY += 20;\r\n    }\r\n    if ((supplyStatus.activeCount ?? 0) > 0) {\r\n      context.fillStyle = \"#8cffd4\";\r\n      context.fillText(`Drops on field: ${supplyStatus.activeCount}`, 24, infoY);\r\n      infoY += 20;\r\n      context.fillStyle = \"#d0d4de\";\r\n    }\r\n    if (supplyStatus.rewardMessage) {\r\n      const rewardAlpha = clamp(0.3 + 0.7 * (supplyStatus.rewardAlpha ?? 0), 0, 1);\r\n      context.fillStyle = `rgba(140, 255, 212, ${rewardAlpha})`;\r\n      context.fillText(`Reward: ${supplyStatus.rewardMessage}`, 24, infoY);\r\n      infoY += 20;\r\n      context.fillStyle = \"#d0d4de\";\r\n    }\r\n  }\r\n\r\n  const squadStatus = getSquadStatus();\r\n  if (squadStatus?.command) {\r\n    context.fillStyle = \"#cfe3ff\";\r\n    context.fillText(`Squad: ${squadStatus.command.label}`, 24, infoY);\r\n    infoY += 18;\r\n    context.fillStyle = \"#9aa2b1\";\r\n    context.fillText(\"Commands: Z Hold   X Defend   C Attack   V Flank   T Cycle\", 24, infoY);\r\n    infoY += 18;\r\n    if ((squadStatus.cooldown ?? 0) > 0.05) {\r\n      context.fillText(`Command cooldown: ${squadStatus.cooldown.toFixed(1)}s`, 24, infoY);\r\n      infoY += 18;\r\n    }\r\n    if (Array.isArray(squadStatus.members) && squadStatus.members.length > 0) {\r\n      context.fillStyle = \"#8cffd4\";\r\n      const maxShown = Math.min(3, squadStatus.members.length);\r\n      for (let i = 0; i < maxShown; i += 1) {\r\n        const member = squadStatus.members[i];\r\n        const distance = Math.abs(member.x - stickman.x);\r\n        const status = member.targetEnemyId ? \"engaging\" : \"ready\";\r\n        context.fillText(`${member.name ?? \"Ally\"}: ${distance.toFixed(0)}u (${status})`, 24, infoY);\r\n        infoY += 18;\r\n      }\r\n      context.fillStyle = \"#d0d4de\";\r\n    }\r\n  }\r\n\r\n  const p2pStatus = getP2PStatus?.();\r\n  if (p2pStatus) {\r\n    context.fillStyle = \"#b6c9ff\";\r\n    context.fillText(`P2P: ${p2pStatus.status ?? \"unknown\"}`, 24, infoY);\r\n    infoY += 18;\r\n    if (p2pStatus.status !== \"connected\") {\r\n      context.fillStyle = \"#8495c9\";\r\n      context.fillText(\"Use window.P2P.createOffer() / createAnswer() in console\", 24, infoY);\r\n      infoY += 18;\r\n      context.fillText(\"window.P2P.getLocalDescription() to copy SDP\", 24, infoY);\r\n      infoY += 18;\r\n    } else {\r\n      context.fillStyle = \"#8cffd4\";\r\n      context.fillText(\"Remote peers: \" + getRemotePlayers().length, 24, infoY);\r\n      infoY += 18;\r\n    }\r\n    context.fillStyle = \"#d0d4de\";\r\n  }\r\n\r\n  if (ammoStatus) {\r\n\r\n\r\n    const isInfinite = ammoStatus.capacity === Number.POSITIVE_INFINITY;\r\n    const magazineDisplay = isInfinite ? \"INF\" : `${Math.max(0, ammoStatus.magazine)}`;\r\n    const reserveDisplay = isInfinite ? \"INF\" : `${Math.max(0, ammoStatus.reserve)}`;\r\n    let ammoLabel = `Ammo: ${magazineDisplay}/${reserveDisplay}`;\r\n    if (ammoStatus.reloading) {\r\n      ammoLabel += ` (Reloading ${Math.max(0, ammoStatus.reloadTimer).toFixed(1)}s)`;\r\n    }\r\n    context.fillText(ammoLabel, 24, infoY);\r\n    infoY += 20;\r\n  }\r\n\r\n  const recoilMagnitude = Math.hypot(recoilOffset?.horizontal ?? 0, recoilOffset?.vertical ?? 0);\r\n  if (recoilMagnitude > 0.05) {\r\n    const recoilLabel = `Recoil Kick: H ${(recoilOffset.horizontal ?? 0).toFixed(2)}  V ${(recoilOffset.vertical ?? 0).toFixed(2)}`;\r\n    context.fillText(recoilLabel, 24, infoY);\r\n    infoY += 20;\r\n  }\r\n\r\n  context.fillText(`Player HP: ${stickman.health}/${stickman.maxHealth}`, 24, infoY);\r\n  infoY += 20;\r\n  context.fillText(`Dummy HP: ${Math.round(trainingDummy.health)}/${trainingDummy.maxHealth}`, 24, infoY);\r\n  infoY += 20;\r\n  const aliveEnemies = enemies.filter((enemy) => enemy.health > 0).length;\r\n  context.fillText(`Enemies Alive: ${aliveEnemies}`, 24, infoY);\r\n  infoY += 20;\r\n\r\n  if (weaponSlots.length > 0) {\r\n    const slotLabel = weaponSlots\r\n      .map((weapon, index) => {\r\n        const label = `${index + 1}: ${weapon.name}`;\r\n        return weapon.id === currentWeapon?.id ? `[${label}]` : label;\r\n      })\r\n      .join(\"   \");\r\n    context.fillStyle = \"#9aa2b1\";\r\n    context.fillText(`Loadout ${slotLabel}`, 24, 152);\r\n  }\r\n\r\n  let nextHudY = 172;\r\n  if (stickman.comboWindowOpen) {\r\n    context.fillStyle = \"#ffcf7a\";\r\n    context.fillText(\"Press attack now to chain!\", 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if (currentWeapon?.category === \"throwable\") {\r\n    const ready = stickman.throwCooldown <= 0;\r\n    const cooldownLabel = ready ? \"Ready\" : `${stickman.throwCooldown.toFixed(1)}s`;\r\n    context.fillStyle = ready ? \"#8cffd4\" : \"#ffcf7a\";\r\n    context.fillText(`Grenade: ${cooldownLabel}`, 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if (currentWeapon?.category === \"gadget\") {\r\n    const ready = (gadgetStatus.gadgetCooldown ?? 0) <= 0.01;\r\n    const label = ready ? \"Ready\" : `${gadgetStatus.gadgetCooldown.toFixed(1)}s`;\r\n    context.fillStyle = ready ? \"#8cffd4\" : \"#ffcf7a\";\r\n    context.fillText(`Gadget: ${label}`, 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if ((gadgetStatus.turretCount ?? 0) > 0) {\r\n    context.fillStyle = \"#9ae9ff\";\r\n    context.fillText(`Turrets Active: ${gadgetStatus.turretCount}`, 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if (gadgetStatus.shieldActive) {\r\n    const maxShield = gadgetStatus.shieldMaxStrength ?? 0;\r\n    const shieldValue = Math.max(0, gadgetStatus.shieldStrength ?? 0);\r\n    const ratio = maxShield > 0 ? Math.max(0, Math.min(1, shieldValue / maxShield)) : 0;\r\n    context.fillStyle = \"#7cd6ff\";\r\n    const label = maxShield > 0 ? `${Math.ceil(shieldValue)}/${Math.ceil(maxShield)}` : \"Active\";\r\n    context.fillText(`Shield: ${label}`, 24, nextHudY);\r\n    nextHudY += 14;\r\n    const barWidth = 120;\r\n    context.fillStyle = \"#2d3c4d\";\r\n    context.fillRect(24, nextHudY, barWidth, 6);\r\n    context.fillStyle = \"#7cd6ff\";\r\n    context.fillRect(24, nextHudY, barWidth * ratio, 6);\r\n    nextHudY += 14;\r\n  }\r\n\r\n  if ((stickman.stunTimer ?? 0) > 0) {\r\n    context.fillStyle = \"#ffb48a\";\r\n    context.fillText(`Stunned: ${stickman.stunTimer.toFixed(1)}s`, 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if ((stickman.flashBlindTimer ?? 0) > 0) {\r\n    context.fillStyle = \"#ffe27a\";\r\n    context.fillText(`Blinded: ${stickman.flashBlindTimer.toFixed(1)}s`, 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if ((stickman.smokeSlowTimer ?? 0) > 0) {\r\n    context.fillStyle = \"#b8c7dd\";\r\n    context.fillText(`In Smoke: ${stickman.smokeSlowTimer.toFixed(1)}s`, 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if (stickman.health <= 0) {\r\n    context.fillStyle = \"#ff8c7a\";\r\n    context.fillText(\"Respawning soon...\", 24, nextHudY);\r\n  }\r\n\r\n  const debugState = getPolishDebugState();\r\n  const activeNotices = debugState.notices.slice(-4).reverse();\r\n  if (activeNotices.length > 0 || debugState.shotIndicators.length > 0 || debugState.filters) {\r\n    context.save();\r\n    const rightMargin = context.canvas.width - 24;\r\n    context.textAlign = \"right\";\r\n    let debugY = 32;\r\n    for (const notice of activeNotices) {\r\n      const life = notice.maxTtl > 0 ? clamp(notice.ttl / notice.maxTtl, 0, 1) : 0;\r\n      context.globalAlpha = clamp(life, 0.25, 1);\r\n      context.fillStyle = \"#c3cdea\";\r\n      context.fillText(notice.message, rightMargin, debugY);\r\n      debugY += 18;\r\n    }\r\n    if (debugState.shotIndicators.length > 0) {\r\n      if (activeNotices.length > 0) {\r\n        debugY += 6;\r\n      }\r\n      for (const entry of debugState.shotIndicators) {\r\n        const life = entry.maxTtl > 0 ? clamp(entry.ttl / entry.maxTtl, 0, 1) : 0;\r\n        context.globalAlpha = clamp(life, 0.3, 0.85);\r\n        context.fillStyle = \"#9aa2b1\";\r\n        context.fillText(\"Shot: \" + entry.weaponId, rightMargin, debugY);\r\n        debugY += 16;\r\n      }\r\n    }\r\n    const filters = debugState.filters;\r\n    if (filters) {\r\n      if (debugY > 32) {\r\n        debugY += 6;\r\n      }\r\n      context.globalAlpha = 0.6;\r\n      context.fillStyle = \"#7f8aad\";\r\n      context.fillText(\"Filters (Alt+6/7/8)\", rightMargin, debugY);\r\n      debugY += 16;\r\n      const filterLines = [\r\n        { label: \"Weapons\", value: filters.weapons },\r\n        { label: \"Shield\", value: filters.shield },\r\n        { label: \"Throwables\", value: filters.throwables }\r\n      ];\r\n      for (const line of filterLines) {\r\n        context.globalAlpha = line.value ? 0.85 : 0.35;\r\n        context.fillStyle = line.value ? \"#c3cdea\" : \"#6c7389\";\r\n        context.fillText(line.label + \": \" + (line.value ? \"ON\" : \"OFF\"), rightMargin, debugY);\r\n        debugY += 16;\r\n      }\r\n    }\r\n    context.globalAlpha = 1;\r\n    context.restore();\r\n  }\r\n}\r\nfunction drawGadgetsLayer() {\r\n  drawGadgets();\r\n}\r\n\r\nfunction drawPolishDebugEffects() {\r\n  const { muzzleFlashes, shieldBursts, throwableBursts } = getPolishDebugState();\r\n  if (muzzleFlashes.length === 0 && shieldBursts.length === 0 && throwableBursts.length === 0) {\r\n    return;\r\n  }\r\n\r\n  context.save();\r\n\r\n  for (const flash of muzzleFlashes) {\r\n    const life = clamp(flash.ttl / flash.maxTtl, 0, 1);\r\n    const alpha = 0.25 + life * 0.6;\r\n    const radius = 12 + (1 - life) * 14;\r\n    const offset = (flash.facing ?? 1) * (10 + (1 - life) * 6);\r\n    context.globalAlpha = alpha;\r\n    context.fillStyle = \"#ffd27a\";\r\n    context.beginPath();\r\n    context.arc(flash.x + offset, flash.y, radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n\r\n  for (const burst of shieldBursts) {\r\n    const life = clamp(burst.ttl / burst.maxTtl, 0, 1);\r\n    const alpha = (burst.type === \"shatter\" ? 0.55 : 0.35) * life;\r\n    if (alpha <= 0) {\r\n      continue;\r\n    }\r\n    const radiusBase = burst.type === \"shatter\" ? 120 : 80;\r\n    const radius = radiusBase * (1 - life * 0.35);\r\n    context.globalAlpha = alpha;\r\n    context.lineWidth = burst.type === \"shatter\" ? 6 : 3;\r\n    context.strokeStyle = burst.type === \"shatter\" ? \"#7cd6ff\" : \"#9be9ff\";\r\n    context.beginPath();\r\n    context.arc(burst.center.x, burst.center.y, radius, 0, Math.PI * 2);\r\n    context.stroke();\r\n  }\r\n\r\n  for (const burst of throwableBursts) {\r\n    const life = clamp(burst.ttl / burst.maxTtl, 0, 1);\r\n    if (life <= 0) {\r\n      continue;\r\n    }\r\n    let stroke = \"#ffb347\";\r\n    if (burst.type === \"flash\") {\r\n      stroke = \"#fff6d0\";\r\n    } else if (burst.type === \"smoke\" || burst.type === \"smoke-fade\") {\r\n      stroke = \"#9db8ca\";\r\n    }\r\n    const radius = burst.radius * (1 + (1 - life) * 0.35);\r\n    context.globalAlpha = (burst.type === \"smoke-fade\" ? 0.3 : 0.45) * life;\r\n    context.lineWidth = burst.type === \"flash\" ? 5 : 4;\r\n    context.strokeStyle = stroke;\r\n    context.beginPath();\r\n    context.arc(burst.x, burst.y, radius, 0, Math.PI * 2);\r\n    context.stroke();\r\n  }\r\n\r\n  context.restore();\r\n}\r\n\r\nfunction drawProjectilesLayer() {\r\n  drawProjectiles();\r\n  drawThrowables();\r\n  drawParticles();\r\n  drawPolishDebugEffects();\r\n}\r\n\r\nfunction drawServerBrowser() {\r\n  const state = getServerBrowserState();\r\n  if (!state.visible) {\r\n    return;\r\n  }\r\n\r\n  const panelWidth = 480;\r\n  const panelHeight = 420;\r\n  const x = context.canvas.width * 0.5 - panelWidth * 0.5;\r\n  const y = context.canvas.height * 0.5 - panelHeight * 0.5;\r\n\r\n  context.save();\r\n  context.fillStyle = \"rgba(12, 16, 24, 0.82)\";\r\n  context.fillRect(x, y, panelWidth, panelHeight);\r\n  context.strokeStyle = \"#6f7fa0\";\r\n  context.lineWidth = 3;\r\n  context.strokeRect(x, y, panelWidth, panelHeight);\r\n\r\n  context.fillStyle = \"#cfe3ff\";\r\n  context.font = \"18px 'Segoe UI', Arial, sans-serif\";\r\n  context.textAlign = \"left\";\r\n  context.fillText(\"Server Browser\", x + 20, y + 32);\r\n\r\n  context.font = \"13px 'Segoe UI', Arial, sans-serif\";\r\n  context.fillStyle = \"#9aa9c7\";\r\n  context.fillText(\"Join: Enter  |  Navigate: [ / ]  |  Close: L\", x + 20, y + 52);\r\n  context.fillText(\"Toggle: L  |  Join: Enter  |  Host: H  |  Stop: U  |  Next: ] or /  |  Prev: [\", x + 20, y + 68);\r\n\r\n  let statusY = y + 88;\r\n  if (state.error) {\r\n    context.fillStyle = \"#ff8080\";\r\n    context.fillText(state.error, x + 20, statusY);\r\n    statusY += 18;\r\n  }\r\n  if (state.statusMessage) {\r\n    context.fillStyle = \"#8cffd4\";\r\n    context.fillText(state.statusMessage, x + 20, statusY);\r\n    statusY += 18;\r\n  }\r\n  if (state.joinError) {\r\n    context.fillStyle = \"#ff9a9a\";\r\n    context.fillText(state.joinError, x + 20, statusY);\r\n    statusY += 18;\r\n  }\r\n  if (state.joinStatus) {\r\n    context.fillStyle = \"#cfe3ff\";\r\n    context.fillText(state.joinStatus, x + 20, statusY);\r\n    statusY += 18;\r\n  }\r\n\r\n  const listTop = statusY + 12;\r\n  const rowHeight = 34;\r\n  const listBottom = y + panelHeight - 140;\r\n  const servers = state.servers ?? [];\r\n  const maxRows = Math.max(0, Math.floor((listBottom - listTop) / rowHeight));\r\n  const rowsToDraw = Math.min(servers.length, Math.min(maxRows, 8));\r\n\r\n  context.font = \"14px 'Segoe UI', Arial, sans-serif\";\r\n  for (let i = 0; i < rowsToDraw; i += 1) {\r\n    const server = servers[i];\r\n    const rowY = listTop + i * rowHeight;\r\n    const isSelected = i === state.selectedIndex;\r\n    if (isSelected) {\r\n      context.fillStyle = \"rgba(108, 132, 220, 0.4)\";\r\n      context.fillRect(x + 12, rowY - 6, panelWidth - 24, rowHeight - 4);\r\n    }\r\n    context.fillStyle = \"#e4ecff\";\r\n    context.fillText(server.name ?? server.id ?? \"Server\", x + 24, rowY + 8);\r\n    context.fillStyle = \"#9aa9c7\";\r\n    const details = `${server.map ?? \"Unknown\"} | ${server.players ?? \"?\"}/${server.maxPlayers ?? \"?\"} | ${server.region ?? \"--\"}`;\r\n    context.fillText(details, x + 24, rowY + 22);\r\n  }\r\n\r\n  if (servers.length === 0) {\r\n    context.fillStyle = \"#a6b2cf\";\r\n    context.fillText(\"No servers available.\", x + 24, listTop + 16);\r\n  }\r\n\r\n  const snippet = (value, limit = 64) => {\r\n    if (typeof value !== \"string\") {\r\n      return \"\";\r\n    }\r\n    return value.length > limit ? `${value.slice(0, limit)}...` : value;\r\n  };\r\n\r\n  const p2p = state.p2p ?? {};\r\n  let p2pY = y + panelHeight - 120;\r\n  context.font = \"12px 'Segoe UI', Arial, sans-serif\";\r\n  context.fillStyle = \"#9aa9c7\";\r\n  context.fillText(\"P2P Handshake\", x + 20, p2pY);\r\n  p2pY += 16;\r\n\r\n  if (p2p.error) {\r\n    context.fillStyle = \"#ff8080\";\r\n    context.fillText(p2p.error, x + 20, p2pY);\r\n    p2pY += 16;\r\n  }\r\n\r\n  if (state.hosting) {\r\n    if (p2p.pendingOffer) {\r\n      context.fillStyle = \"#ffd27f\";\r\n      context.fillText(\"Generating offer...\", x + 20, p2pY);\r\n      p2pY += 16;\r\n    } else if (p2p.offer) {\r\n      context.fillStyle = \"#8cffd4\";\r\n      context.fillText(\"Offer ready and shared with joiners.\", x + 20, p2pY);\r\n      p2pY += 16;\r\n      context.fillStyle = \"#9aa9c7\";\r\n      context.fillText(snippet(p2p.offer), x + 20, p2pY);\r\n      p2pY += 16;\r\n    } else {\r\n      context.fillStyle = \"#9aa9c7\";\r\n      context.fillText(\"Preparing host offer...\", x + 20, p2pY);\r\n      p2pY += 16;\r\n    }\r\n\r\n    if (p2p.pendingAnswer) {\r\n      context.fillStyle = \"#ffd27f\";\r\n      context.fillText(\"Waiting for a joiner answer...\", x + 20, p2pY);\r\n      p2pY += 16;\r\n    }\r\n  } else {\r\n    if (p2p.pendingAnswer) {\r\n      context.fillStyle = \"#ffd27f\";\r\n      context.fillText(\"Generating answer...\", x + 20, p2pY);\r\n      p2pY += 16;\r\n    } else if (p2p.answer) {\r\n      context.fillStyle = \"#8cffd4\";\r\n      context.fillText(\"Answer applied. Waiting for host handshake.\", x + 20, p2pY);\r\n      p2pY += 16;\r\n      context.fillStyle = \"#9aa9c7\";\r\n      context.fillText(snippet(p2p.answer), x + 20, p2pY);\r\n      p2pY += 16;\r\n    } else {\r\n      context.fillStyle = \"#9aa9c7\";\r\n      context.fillText(\"Waiting for host offer...\", x + 20, p2pY);\r\n      p2pY += 16;\r\n    }\r\n  }\r\n\r\n  const localCandidates = Array.isArray(p2p.localCandidates) ? p2p.localCandidates : [];\r\n  const remoteCandidates = Array.isArray(p2p.remoteCandidates) ? p2p.remoteCandidates : [];\r\n\r\n  if (p2p.pendingCandidates) {\r\n    context.fillStyle = \"#ffd27f\";\r\n    context.fillText(\"Processing ICE candidates...\", x + 20, p2pY);\r\n    p2pY += 16;\r\n  }\r\n\r\n  const candidateSummary =\r\n    \"Local ICE ready: \" + localCandidates.length + \"  |  Remote applied: \" + remoteCandidates.length;\r\n  context.fillStyle = \"#9aa9c7\";\r\n  context.fillText(candidateSummary, x + 20, p2pY);\r\n  p2pY += 16;\r\n\r\n  if (localCandidates.length > 0) {\r\n    const lastLocalLabel = \"Last local: \" + snippet(localCandidates[localCandidates.length - 1], 54);\r\n    context.fillStyle = \"#6f86d0\";\r\n    context.fillText(lastLocalLabel, x + 20, p2pY);\r\n    p2pY += 16;\r\n  } else if (!p2p.pendingCandidates) {\r\n    context.fillStyle = \"#9aa9c7\";\r\n    context.fillText(\"Local ICE will appear shortly after offer/answer.\", x + 20, p2pY);\r\n    p2pY += 16;\r\n  }\r\n\r\n  if (remoteCandidates.length > 0) {\r\n    const lastRemoteLabel = \"Last remote: \" + snippet(remoteCandidates[remoteCandidates.length - 1], 54);\r\n    context.fillStyle = \"#6fd0c5\";\r\n    context.fillText(lastRemoteLabel, x + 20, p2pY);\r\n    p2pY += 16;\r\n  } else if (!p2p.pendingCandidates) {\r\n    context.fillStyle = \"#9aa9c7\";\r\n    if (state.hosting) {\r\n      context.fillText(\"Press N after players send their ICE (M).\", x + 20, p2pY);\r\n    } else {\r\n      context.fillText(\"Press M to copy your ICE and send it to the host.\", x + 20, p2pY);\r\n    }\r\n    p2pY += 16;\r\n  }\r\n\r\n  context.restore();\r\n}\r\nexport { drawBackground, drawDestructibles, drawBuildings, drawInteractables, drawVehicles, drawSupplyDrops, drawRemotePlayers, drawServerBrowser, drawSquadmates, drawStickman, drawHitboxes, drawBuildPreview, drawTrainingDummy, drawEnemies, drawHud, drawProjectilesLayer, drawGadgetsLayer };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { stickman } from \"../../state/entities.js\";\r\nimport { POSES, ROLL_DURATION } from \"../../config/constants.js\";\r\nimport { getCurrentWeapon } from \"./weapons.js\";\r\n\r\nfunction determinePose() {\r\n  if (stickman.rolling) {\r\n    return POSES.rolling;\r\n  }\r\n  if (stickman.crouching) {\r\n    return POSES.crouching;\r\n  }\r\n  return POSES.standing;\r\n}\r\n\r\nfunction startRoll(direction) {\r\n  if (stickman.vehicleId) {\r\n    return;\r\n  }\r\n  if (!stickman.onGround || stickman.rolling || stickman.attacking || stickman.health <= 0 || (stickman.stunTimer ?? 0) > 0) {\r\n    return;\r\n  }\r\n\r\n  const { left, right } = direction;\r\n  if (left && !right) {\r\n    stickman.facing = -1;\r\n  } else if (right && !left) {\r\n    stickman.facing = 1;\r\n  }\r\n\r\n  stickman.rolling = true;\r\n  stickman.rollTimer = ROLL_DURATION;\r\n  stickman.crouching = false;\r\n  stickman.vy = 0;\r\n}\r\n\r\nfunction startAttack(index) {\r\n  const weapon = getCurrentWeapon();\r\n  const attackChain = weapon?.attackChain ?? [];\r\n  const attack = attackChain[index];\r\n  if (!attack) {\r\n    return;\r\n  }\r\n\r\n  stickman.attacking = true;\r\n  stickman.attackIndex = index;\r\n  stickman.currentAttack = attack;\r\n  stickman.attackElapsed = 0;\r\n  stickman.comboWindowOpen = false;\r\n  stickman.comboWindowTimer = 0;\r\n  stickman.nextAttackQueued = false;\r\n  stickman.hitboxSpawned = false;\r\n  stickman.attackInstanceId += 1;\r\n}\r\n\r\nfunction attemptAttack() {\r\n  if (stickman.vehicleId) {\r\n    return;\r\n  }\r\n  if (stickman.rolling || stickman.health <= 0 || (stickman.stunTimer ?? 0) > 0 || stickman.reloading) {\r\n    return;\r\n  }\r\n\r\n  const weapon = getCurrentWeapon();\r\n  const attackChain = weapon?.attackChain ?? [];\r\n  if (attackChain.length === 0) {\r\n    return;\r\n  }\r\n\r\n  if (!stickman.attacking) {\r\n    startAttack(0);\r\n    return;\r\n  }\r\n\r\n  if (stickman.comboWindowOpen && stickman.attackIndex + 1 < attackChain.length) {\r\n    stickman.nextAttackQueued = true;\r\n  }\r\n}\r\n\r\nfunction advanceAttack(delta, spawnHitboxFn) {\r\n  if (stickman.vehicleId) {\r\n    stickman.attacking = false;\r\n    stickman.currentAttack = null;\r\n    stickman.attackElapsed = 0;\r\n    stickman.comboWindowOpen = false;\r\n    stickman.comboWindowTimer = 0;\r\n    stickman.hitboxSpawned = false;\r\n    stickman.attackIndex = -1;\r\n    return;\r\n  }\r\n  const attack = stickman.currentAttack;\r\n  if (!attack) {\r\n    return;\r\n  }\r\n  if ((stickman.stunTimer ?? 0) > 0 || stickman.reloading) {\r\n    stickman.attacking = false;\r\n    stickman.currentAttack = null;\r\n    stickman.attackElapsed = 0;\r\n    stickman.comboWindowOpen = false;\r\n    stickman.comboWindowTimer = 0;\r\n    stickman.hitboxSpawned = false;\r\n    return;\r\n  }\r\n\r\n  stickman.attackElapsed += delta;\r\n\r\n  if (!stickman.hitboxSpawned && stickman.attackElapsed >= attack.windup) {\r\n    spawnHitboxFn(attack);\r\n    stickman.hitboxSpawned = true;\r\n  }\r\n\r\n  if (!stickman.comboWindowOpen && stickman.attackElapsed >= attack.comboStart) {\r\n    stickman.comboWindowOpen = true;\r\n    stickman.comboWindowTimer = attack.comboWindow;\r\n  }\r\n\r\n  if (stickman.comboWindowOpen) {\r\n    stickman.comboWindowTimer -= delta;\r\n    if (stickman.comboWindowTimer <= 0) {\r\n      stickman.comboWindowOpen = false;\r\n    }\r\n  }\r\n\r\n  const weapon = getCurrentWeapon();\r\n  const attackChain = weapon?.attackChain ?? [];\r\n\r\n  if (stickman.attackElapsed >= attack.windup + attack.active + attack.recovery) {\r\n    const nextIndex = stickman.attackIndex + 1;\r\n    const shouldChain = stickman.nextAttackQueued && nextIndex < attackChain.length;\r\n\r\n    stickman.attacking = false;\r\n    stickman.currentAttack = null;\r\n    stickman.attackElapsed = 0;\r\n    stickman.comboWindowOpen = false;\r\n    stickman.comboWindowTimer = 0;\r\n    stickman.hitboxSpawned = false;\r\n    stickman.nextAttackQueued = false;\r\n\r\n    if (shouldChain) {\r\n      startAttack(nextIndex);\r\n    } else {\r\n      stickman.attackIndex = -1;\r\n    }\r\n  }\r\n}\r\n\r\nexport { determinePose, startRoll, attemptAttack, advanceAttack };\r\n","import { canvas } from \"../../environment/canvas.js\";\r\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { interactables, getInteractables } from \"../../state/interactables.js\";\r\nimport { stickman, enemies, squadmates, getTotalHeight } from \"../../state/entities.js\";\r\nimport { POSES } from \"../../config/constants.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { spawnRingBurst, spawnSmokePuffs } from \"../effects/particles.js\";\r\nimport { spawnDynamicLight } from \"../effects/lighting.js\";\r\nimport { applyDamageToEnemy, applyDamageToPlayer } from \"../combat/damageHandlers.js\";\r\n\r\nconst PLAYER_HALF_WIDTH = 22;\r\nconst ALLY_HALF_WIDTH = 20;\r\nconst ENEMY_HALF_WIDTH = 24;\r\n\r\nfunction approachZero(value, deltaValue) {\r\n  if (value > 0) {\r\n    return Math.max(0, value - deltaValue);\r\n  }\r\n  if (value < 0) {\r\n    return Math.min(0, value + deltaValue);\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction getActorProfile(actor, options = {}) {\r\n  if (!actor) {\r\n    return null;\r\n  }\r\n  const pose = options.pose ?? (actor === stickman ? stickman.currentPose ?? POSES.standing : POSES.standing);\r\n  const height = options.height ?? (actor.height ?? getTotalHeight(pose));\r\n  const halfWidth = options.halfWidth ?? (actor.radius ?? PLAYER_HALF_WIDTH);\r\n  const vx = options.vx ?? actor.vx ?? 0;\r\n  const onGround = options.onGround ?? actor.onGround ?? true;\r\n  return {\r\n    ref: actor,\r\n    x: actor.x,\r\n    y: actor.y,\r\n    vx,\r\n    onGround,\r\n    facing: actor.facing ?? 1,\r\n    height,\r\n    halfWidth\r\n  };\r\n}\r\n\r\nfunction applyPushFromActor(interactable, template, actorProfile, delta) {\r\n  if (!actorProfile || (template.category !== \"movable\" && template.category !== \"rolling\")) {\r\n    return;\r\n  }\r\n\r\n  const actorFeet = actorProfile.y + actorProfile.height;\r\n  const verticalGap = Math.abs(actorFeet - interactable.y);\r\n  const verticalThreshold = interactable.height * 0.6 + actorProfile.height * 0.25 + 24;\r\n  if (verticalGap > verticalThreshold) {\r\n    return;\r\n  }\r\n\r\n  const interactHalf = interactable.width ? interactable.width / 2 : interactable.radius;\r\n  const dx = actorProfile.x - interactable.x;\r\n  const overlap = actorProfile.halfWidth + interactHalf - Math.abs(dx);\r\n  if (overlap <= 0) {\r\n    return;\r\n  }\r\n\r\n  const direction = dx >= 0 ? 1 : -1;\r\n  const impulseBase = template.pushImpulse ?? 260;\r\n  const isPlayer = actorProfile.ref === stickman;\r\n  const velocityInfluence = Math.abs(actorProfile.vx) * (isPlayer ? 0.7 : 0.45);\r\n  const appliedImpulse = (impulseBase + velocityInfluence) * delta;\r\n\r\n  interactable.vx += direction * appliedImpulse;\r\n  const maxSpeed = template.maxSpeed ?? interactable.maxSpeed ?? 240;\r\n  interactable.vx = clamp(interactable.vx, -maxSpeed, maxSpeed);\r\n\r\n  const targetActorX = interactable.x + direction * (interactHalf + actorProfile.halfWidth + 0.5);\r\n  if (direction > 0) {\r\n    actorProfile.ref.x = Math.min(actorProfile.ref.x, targetActorX);\r\n  } else {\r\n    actorProfile.ref.x = Math.max(actorProfile.ref.x, targetActorX);\r\n  }\r\n\r\n  if (actorProfile.ref === stickman) {\r\n    const envWidth = getEnvironmentWidth();\r\n    stickman.x = clamp(stickman.x, 40, envWidth - 40);\r\n  }\r\n\r\n  interactable.flashTimer = Math.max(interactable.flashTimer, 0.12);\r\n  interactable.state = template.category === \"rolling\" ? \"rolling\" : \"pushed\";\r\n}\r\n\r\nfunction updateTrap(interactable, template, delta) {\r\n  interactable.cooldown = Math.max(0, (interactable.cooldown ?? 0) - delta);\r\n  if (interactable.cooldown > 0) {\r\n    return;\r\n  }\r\n\r\n  const effectiveHalf = interactable.width ? interactable.width / 2 : interactable.radius;\r\n  const detectionRadius = effectiveHalf + 26;\r\n  const damage = template.damage ?? 0;\r\n  const knockback = template.knockback ?? 80;\r\n  const launch = template.launch ?? -140;\r\n  const stun = template.stunDuration ?? 0.6;\r\n\r\n  let triggered = false;\r\n\r\n  const actors = [];\r\n  actors.push(getActorProfile(stickman, { halfWidth: PLAYER_HALF_WIDTH, vx: stickman.vx }));\r\n  for (const enemy of enemies) {\r\n    if (enemy.health > 0) {\r\n      actors.push(getActorProfile(enemy, { halfWidth: ENEMY_HALF_WIDTH }));\r\n    }\r\n  }\r\n\r\n  for (const profile of actors) {\r\n    if (!profile) {\r\n      continue;\r\n    }\r\n    const feet = profile.y + profile.height;\r\n    const verticalGap = Math.abs(feet - interactable.y);\r\n    if (verticalGap > interactable.height * 0.8 + profile.height * 0.35) {\r\n      continue;\r\n    }\r\n    const dx = profile.x - interactable.x;\r\n    const distance = Math.abs(dx);\r\n    if (distance > detectionRadius + profile.halfWidth) {\r\n      continue;\r\n    }\r\n\r\n    const facing = dx >= 0 ? 1 : -1;\r\n    triggered = true;\r\n    if (profile.ref === stickman) {\r\n      applyDamageToPlayer(\r\n        { attackDamage: damage, attackKnockback: knockback, attackLaunch: launch, facing },\r\n        { damage, knockback, launch, facing }\r\n      );\r\n      stickman.stunTimer = Math.max(stickman.stunTimer ?? 0, stun);\r\n    } else {\r\n      applyDamageToEnemy(profile.ref, {\r\n        damage,\r\n        knockback,\r\n        launch: Math.abs(launch),\r\n        facing\r\n      });\r\n      profile.ref.stunTimer = Math.max(profile.ref.stunTimer ?? 0, stun * 0.8);\r\n    }\r\n  }\r\n\r\n  if (triggered) {\r\n    interactable.cooldown = template.cooldown ?? 2.4;\r\n    interactable.flashTimer = 0.25;\r\n    interactable.state = \"triggered\";\r\n    interactable.timer = template.cooldown ?? 2.4;\r\n\r\n    spawnRingBurst({\r\n      x: interactable.x,\r\n      y: interactable.y - interactable.height * 0.5,\r\n      startRadius: effectiveHalf * 0.6,\r\n      endRadius: effectiveHalf * 1.6,\r\n      color: template.glowColor ?? \"#96f7ff\",\r\n      ttl: 0.35,\r\n      lineWidth: 6\r\n    });\r\n    spawnSmokePuffs({\r\n      x: interactable.x,\r\n      y: interactable.y - interactable.height * 0.5,\r\n      radius: effectiveHalf * 1.2,\r\n      maxRadius: effectiveHalf * 1.8,\r\n      ttl: 0.4\r\n    });\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: interactable.x,\r\n      y: interactable.y,\r\n      radius: effectiveHalf * 3,\r\n      intensity: 1.4,\r\n      color: template.glowColor ?? \"#8cf7ff\",\r\n      ttl: 0.22,\r\n      flicker: 0.5,\r\n      decay: 0.8\r\n    });\r\n  }\r\n}\r\n\r\nfunction updateInteractable(interactable, delta) {\r\n  const template = interactable.template ?? {};\r\n\r\n  interactable.flashTimer = Math.max(0, (interactable.flashTimer ?? 0) - delta);\r\n  interactable.timer = Math.max(0, (interactable.timer ?? 0) - delta);\r\n\r\n  const playerHeight = getTotalHeight(stickman.currentPose ?? POSES.standing);\r\n  const playerFeet = stickman.y + playerHeight;\r\n  const verticalGap = Math.abs(playerFeet - interactable.y);\r\n  const horizGap = Math.abs(stickman.x - interactable.x);\r\n  const near = verticalGap < interactable.height + playerHeight * 0.25 + 32 && horizGap < (interactable.width ? interactable.width : interactable.radius * 2) + 120;\r\n  const highlightTarget = near ? 1 : 0;\r\n  interactable.highlight += (highlightTarget - interactable.highlight) * clamp(delta * 6, 0, 1);\r\n  interactable.highlight = clamp(interactable.highlight, 0, 1);\r\n\r\n  if (template.category === \"trap\") {\r\n    updateTrap(interactable, template, delta);\r\n    return;\r\n  }\r\n\r\n  const frictionStrength = (interactable.friction ?? 2) * (template.category === \"rolling\" ? 24 : 32);\r\n  interactable.vx = approachZero(interactable.vx, frictionStrength * delta);\r\n  if (Math.abs(interactable.vx) < 2) {\r\n    interactable.vx = 0;\r\n  }\r\n\r\n  interactable.x += interactable.vx * delta;\r\n\r\n  const interactHalf = interactable.width ? interactable.width / 2 : interactable.radius;\r\n  const padding = 24;\r\n  const envWidthLimits = getEnvironmentWidth();\r\n  let minX = interactable.minX ?? interactHalf + padding;\r\n  let maxX = interactable.maxX ?? envWidthLimits - interactHalf - padding;\r\n  if (minX > maxX) {\r\n    const mid = (minX + maxX) / 2;\r\n    minX = mid;\r\n    maxX = mid;\r\n  }\r\n  if (interactable.x <= minX) {\r\n    interactable.x = minX;\r\n    interactable.vx = Math.max(0, interactable.vx);\r\n  }\r\n  if (interactable.x >= maxX) {\r\n    interactable.x = maxX;\r\n    interactable.vx = Math.min(0, interactable.vx);\r\n  }\r\n\r\n  const playerProfile = getActorProfile(stickman, { halfWidth: PLAYER_HALF_WIDTH, vx: stickman.vx });\r\n  applyPushFromActor(interactable, template, playerProfile, delta);\r\n\r\n  for (const ally of squadmates) {\r\n    if (!ally || ally.state === \"defeated\") {\r\n      continue;\r\n    }\r\n    applyPushFromActor(interactable, template, getActorProfile(ally, { halfWidth: ALLY_HALF_WIDTH }), delta);\r\n  }\r\n}\r\n\r\nfunction updateInteractables(delta) {\r\n  if (delta <= 0) {\r\n    return;\r\n  }\r\n  for (const interactable of interactables) {\r\n    updateInteractable(interactable, delta);\r\n  }\r\n}\r\n\r\nfunction handleInteractableHitboxCollision(hitbox) {\r\n  let hit = false;\r\n  for (const interactable of interactables) {\r\n    const template = interactable.template ?? {};\r\n    if (template.category !== \"movable\" && template.category !== \"rolling\") {\r\n      continue;\r\n    }\r\n    if (hitbox.hitTargets.has(interactable.id)) {\r\n      continue;\r\n    }\r\n    const interactHalf = interactable.radius ?? (interactable.width ? interactable.width / 2 : 32);\r\n    const centerY = interactable.y - (interactable.height ?? interactHalf);\r\n    const dx = hitbox.x - interactable.x;\r\n    const dy = hitbox.y - centerY;\r\n    const distance = Math.hypot(dx, dy);\r\n    if (distance > hitbox.radius + interactHalf) {\r\n      continue;\r\n    }\r\n\r\n    hitbox.hitTargets.add(interactable.id);\r\n    const direction = dx >= 0 ? 1 : -1;\r\n    const impulse = template.hitImpulse ?? interactable.hitImpulse ?? 420;\r\n    interactable.vx += direction * impulse;\r\n    const maxSpeed = template.maxSpeed ?? interactable.maxSpeed ?? 260;\r\n    interactable.vx = clamp(interactable.vx, -maxSpeed, maxSpeed);\r\n    interactable.flashTimer = Math.max(interactable.flashTimer, 0.16);\r\n    interactable.state = template.category === \"rolling\" ? \"rolling\" : \"nudged\";\r\n    hit = true;\r\n  }\r\n  return hit;\r\n}\r\n\r\nexport { getInteractables, updateInteractables, handleInteractableHitboxCollision };\r\n\r\n\r\n","import { stickman, trainingDummy, enemies } from \"../../state/entities.js\";\r\nimport { getCurrentWeapon } from \"./weapons.js\";\r\nimport { spawnProjectile } from \"./projectiles.js\";\r\nimport { applyDamageToDummy, applyDamageToEnemy, applyDamageToPlayer } from \"./damageHandlers.js\";\r\nimport { handleHitboxCollision } from \"../world/destructibles.js\";\r\nimport { handleInteractableHitboxCollision } from \"../world/interactables.js\";\r\nimport { consumeAmmo, startReload, registerShot } from \"../../state/ammo.js\";\r\nimport { applyRecoil } from \"../../state/recoil.js\";\r\n\r\nfunction spawnHitbox(attack) {\r\n  stickman.activeHitboxes.push({\r\n    id: stickman.attackInstanceId,\r\n    attackIndex: stickman.attackIndex,\r\n    remaining: attack.active,\r\n    duration: attack.active,\r\n    offsetX: attack.range,\r\n    heightOffset: attack.heightOffset,\r\n    radius: attack.radius,\r\n    damage: attack.damage,\r\n    knockback: attack.knockback,\r\n    launch: attack.launch,\r\n    ownerFacing: stickman.facing,\r\n    hitTargets: new Set(),\r\n    x: 0,\r\n    y: 0\r\n  });\r\n}\r\n\r\nfunction updateHitboxes(delta, baseHeight) {\r\n  stickman.activeHitboxes = stickman.activeHitboxes.filter((hitbox) => {\r\n    hitbox.remaining -= delta;\r\n    hitbox.ownerFacing = stickman.facing;\r\n    hitbox.x = stickman.x + stickman.facing * hitbox.offsetX;\r\n    hitbox.y = stickman.y + baseHeight + hitbox.heightOffset;\r\n    return hitbox.remaining > 0;\r\n  });\r\n}\r\n\r\nfunction resolveHitDetection() {\r\n  for (const hitbox of stickman.activeHitboxes) {\r\n    if (trainingDummy.health > 0 && !hitbox.hitTargets.has(trainingDummy.id)) {\r\n      const dx = hitbox.x - trainingDummy.x;\r\n      const dy = hitbox.y - (trainingDummy.y + trainingDummy.height * 0.55);\r\n      const distance = Math.hypot(dx, dy);\r\n      if (distance <= hitbox.radius + trainingDummy.radius) {\r\n        hitbox.hitTargets.add(trainingDummy.id);\r\n        applyDamageToDummy({\r\n          damage: hitbox.damage,\r\n          knockback: hitbox.knockback,\r\n          launch: hitbox.launch,\r\n          facing: hitbox.ownerFacing\r\n        });\r\n      }\r\n    }\r\n\r\n    for (const enemy of enemies) {\r\n      if (enemy.health <= 0 || hitbox.hitTargets.has(enemy.id)) {\r\n        continue;\r\n      }\r\n      const dx = hitbox.x - enemy.x;\r\n      const dy = hitbox.y - (enemy.y + enemy.height * 0.5);\r\n      const distance = Math.hypot(dx, dy);\r\n      if (distance <= hitbox.radius + enemy.radius) {\r\n        hitbox.hitTargets.add(enemy.id);\r\n        applyDamageToEnemy(enemy, {\r\n          damage: hitbox.damage,\r\n          knockback: hitbox.knockback,\r\n          launch: hitbox.launch,\r\n          facing: hitbox.ownerFacing\r\n        });\r\n      }\r\n    }\r\n\r\n    handleHitboxCollision(hitbox);\r\n    handleInteractableHitboxCollision(hitbox);\r\n  }\r\n}\r\n\r\nfunction fireEquippedWeaponProjectile() {\r\n  const weapon = getCurrentWeapon();\r\n  if (!weapon || !weapon.category?.startsWith(\"ranged\")) {\r\n    return;\r\n  }\r\n\r\n  if (!consumeAmmo(weapon.id)) {\r\n    if (startReload(weapon.id)) {\r\n      stickman.attacking = false;\r\n      stickman.currentAttack = null;\r\n      stickman.attackIndex = -1;\r\n      if (typeof window !== \"undefined\") {\r\n        window.dispatchEvent(new CustomEvent(\"weapon:reload-start\", { detail: { weaponId: weapon.id } }));\r\n      }\r\n    }    return;\r\n  }\r\n\r\n  const projectileConfig = weapon.projectile ?? {};\r\n  const speed = projectileConfig.speed ?? 460;\r\n  const facing = stickman.facing;\r\n  const baseVx = facing * speed;\r\n  const baseVy = projectileConfig.initialVy ?? -12;\r\n  const magnitude = Math.hypot(baseVx, baseVy);\r\n  const baseAngle = Math.atan2(baseVy, baseVx);\r\n  const spreadAngle = registerShot(weapon.id);\r\n  const finalAngle = baseAngle + spreadAngle;\r\n  const vx = Math.cos(finalAngle) * magnitude;\r\n  const vy = Math.sin(finalAngle) * magnitude;\r\n\r\n  if (weapon.recoil) {\r\n    applyRecoil(weapon.recoil);\r\n    if (typeof window !== \"undefined\") {\r\n      window.dispatchEvent(new CustomEvent(\"weapon:recoil-kick\", { detail: { weaponId: weapon.id, recoil: weapon.recoil } }));\r\n    }\r\n  }\r\n\r\n  if (typeof window !== \"undefined\") {\r\n    window.dispatchEvent(new CustomEvent(\"weapon:muzzle-flash\", { detail: { weaponId: weapon.id, x: stickman.x + facing * 34, y: stickman.y + 20, facing } }));\r\n  }\r\n\r\n  spawnProjectile({\r\n    x: stickman.x + facing * 34,\r\n    y: stickman.y + 20,\r\n    vx,\r\n    vy,\r\n    radius: projectileConfig.radius ?? 5,\r\n    lifetime: projectileConfig.lifetime ?? 0.9,\r\n    color: projectileConfig.color ?? \"#ffca7a\",\r\n    damage: projectileConfig.damage ?? 10,\r\n    knockback: projectileConfig.knockback ?? 60,\r\n    facing,\r\n    gravityFactor: projectileConfig.gravityFactor ?? 0.2\r\n  });\r\n\r\n  if (typeof window !== \"undefined\") {\r\n    window.dispatchEvent(new CustomEvent(\"weapon:shot-fired\", { detail: { weaponId: weapon.id } }));\r\n  }\r\n}\r\n\r\nexport { spawnHitbox, updateHitboxes, resolveHitDetection, applyDamageToEnemy, applyDamageToPlayer, fireEquippedWeaponProjectile };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { GRAVITY } from \"../../config/constants.js\";\r\nimport { canvas, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { stickman, enemies } from \"../../state/entities.js\";\r\nimport { resolvePlatformLanding } from \"./arena.js\";\r\nimport { applyDamageToPlayer } from \"../combat/damageHandlers.js\";\r\n\r\nfunction updateEnemyAI(enemy, delta) {\r\n  enemy.invulnerability = Math.max(0, enemy.invulnerability - delta);\r\n  enemy.attackCooldown = Math.max(0, enemy.attackCooldown - delta);\r\n  enemy.stunTimer = Math.max(0, (enemy.stunTimer ?? 0) - delta);\r\n  enemy.smokeSlowTimer = Math.max(0, (enemy.smokeSlowTimer ?? 0) - delta);\r\n  if (enemy.smokeSlowTimer <= 0) {\r\n    enemy.smokeSlowStrength = 1;\r\n  }\r\n\r\n  if (enemy.flashTimer > 0) {\r\n    enemy.flashTimer = Math.max(0, enemy.flashTimer - delta);\r\n  }\r\n\r\n  if (enemy.shakeTimer > 0) {\r\n    enemy.shakeTimer = Math.max(0, enemy.shakeTimer - delta);\r\n  }\r\n\r\n  enemy.shakeMagnitude = Math.max(0, enemy.shakeMagnitude - delta * 20);\r\n\r\n  if (enemy.health <= 0) {\r\n    enemy.respawnTimer = Math.max(0, enemy.respawnTimer - delta);\r\n    if (enemy.respawnTimer === 0) {\r\n      enemy.health = enemy.maxHealth;\r\n      enemy.x = enemy.spawnX;\r\n      enemy.y = enemy.spawnY;\r\n      enemy.vx = 0;\r\n      enemy.vy = 0;\r\n      enemy.state = \"patrol\";\r\n      enemy.stateTimer = 1 + Math.random();\r\n      enemy.attackCooldown = 0.6;\r\n      enemy.onGround = true;\r\n      enemy.stunTimer = 0;\r\n      enemy.smokeSlowTimer = 0;\r\n      enemy.smokeSlowStrength = 1;\r\n    }\r\n    return;\r\n  }\r\n\r\n  const targetX = stickman.x;\r\n  const distanceX = targetX - enemy.x;\r\n  const absDistance = Math.abs(distanceX);\r\n  enemy.facing = distanceX >= 0 ? 1 : -1;\r\n\r\n  const stunned = enemy.stunTimer > 0;\r\n  const slowMultiplier = enemy.smokeSlowTimer > 0 ? Math.max(0.2, Math.min(1, enemy.smokeSlowStrength ?? 1)) : 1;\r\n  const moveSpeed = enemy.moveSpeed * slowMultiplier;\r\n  const effectiveAggression = enemy.aggressionRange * (enemy.smokeSlowTimer > 0 ? 0.85 : 1);\r\n  const disengageDistance = effectiveAggression * 1.8;\r\n  const shouldChase = !stunned && absDistance < effectiveAggression;\r\n\r\n  if (absDistance > disengageDistance) {\r\n    enemy.vx = 0;\r\n    enemy.state = \"idle\";\r\n    return;\r\n  }\r\n\r\n  if (stunned) {\r\n    enemy.state = \"stunned\";\r\n    enemy.vx = 0;\r\n    enemy.attackWindup = 0;\r\n    enemy.attackActive = 0;\r\n    enemy.stateTimer = Math.max(enemy.stateTimer, enemy.stunTimer);\r\n    enemy.attackCooldown = Math.max(enemy.attackCooldown, enemy.stunTimer + 0.2);\r\n  } else if (enemy.state === \"stunned\") {\r\n    enemy.state = \"idle\";\r\n    enemy.stateTimer = 0.6;\r\n  }\r\n\r\n  if (!stunned) {\r\n  switch (enemy.state) {\r\n    case \"idle\":\r\n      enemy.vx = 0;\r\n      enemy.stateTimer -= delta;\r\n      if (enemy.stateTimer <= 0) {\r\n        enemy.state = \"patrol\";\r\n        enemy.stateTimer = 1.2 + Math.random();\r\n        enemy.facing = Math.random() < 0.5 ? -1 : 1;\r\n      }\r\n      if (shouldChase) {\r\n        enemy.state = \"chase\";\r\n      }\r\n      break;\r\n    case \"patrol\":\r\n      enemy.vx = moveSpeed * enemy.facing;\r\n      if (enemy.x <= enemy.patrolRange.min) {\r\n        enemy.facing = 1;\r\n      } else if (enemy.x >= enemy.patrolRange.max) {\r\n        enemy.facing = -1;\r\n      }\r\n      enemy.stateTimer -= delta;\r\n      if (enemy.stateTimer <= 0) {\r\n        enemy.state = \"idle\";\r\n        enemy.stateTimer = 1 + Math.random();\r\n        enemy.vx = 0;\r\n      }\r\n      if (shouldChase) {\r\n        enemy.state = \"chase\";\r\n      }\r\n      break;\r\n    case \"chase\":\r\n      if (!shouldChase) {\r\n        enemy.state = \"patrol\";\r\n        break;\r\n      }\r\n      const chaseDir = distanceX >= 0 ? 1 : -1;\r\n      enemy.vx = moveSpeed * chaseDir;\r\n      if (absDistance <= enemy.attackRange && enemy.attackCooldown <= 0) {\r\n        enemy.state = \"attack-windup\";\r\n        enemy.attackWindup = 0.35;\r\n        enemy.attackActive = 0.16;\r\n        enemy.vx = 0;\r\n      }\r\n      break;\r\n    case \"attack-windup\":\r\n      enemy.vx = 0;\r\n      enemy.attackWindup -= delta;\r\n      if (enemy.attackWindup <= 0) {\r\n        enemy.state = \"attack-active\";\r\n        enemy.attackActive = 0.16;\r\n      }\r\n      break;\r\n    case \"attack-active\":\r\n      enemy.vx = moveSpeed * 0.35 * enemy.facing;\r\n      enemy.attackActive -= delta;\r\n      if (enemy.attackActive <= 0) {\r\n        enemy.state = \"recover\";\r\n        enemy.stateTimer = 0.4;\r\n        enemy.attackCooldown = 1.2;\r\n      }\r\n      break;\r\n    case \"recover\":\r\n      enemy.vx = 0;\r\n      enemy.stateTimer -= delta;\r\n      if (enemy.stateTimer <= 0) {\r\n        enemy.state = shouldChase ? \"chase\" : \"idle\";\r\n        enemy.stateTimer = 0.9 + Math.random() * 0.4;\r\n      }\r\n      break;\r\n    default:\r\n      enemy.vx = 0;\r\n      break;\r\n  }\r\n  }\r\n\r\n  const previousY = enemy.y;\r\n  enemy.vy += GRAVITY * delta;\r\n  enemy.x += enemy.vx * delta;\r\n  enemy.y += enemy.vy * delta;\r\n  enemy.onGround = false;\r\n\r\n  const landed = resolvePlatformLanding(enemy, previousY, enemy.height);\r\n  if (!landed && enemy.y + enemy.height >= GROUND_Y) {\r\n    enemy.y = GROUND_Y - enemy.height;\r\n    enemy.vy = 0;\r\n    enemy.onGround = true;\r\n  }\r\n\r\n  const envWidth = getEnvironmentWidth();\r\n  enemy.x = Math.max(60, Math.min(envWidth - 60, enemy.x));\r\n}\r\n\r\nfunction updateEnemyAttacks(enemy) {\r\n  if (enemy.health <= 0) {\r\n    return;\r\n  }\r\n  if (enemy.state !== \"attack-active\") {\r\n    return;\r\n  }\r\n\r\n  const attackReach = enemy.attackRange + enemy.radius;\r\n  const dx = stickman.x - enemy.x;\r\n  const dy = stickman.y - enemy.y;\r\n  const distanceSq = dx * dx + dy * dy;\r\n  if (distanceSq <= attackReach * attackReach) {\r\n    applyDamageToPlayer(enemy);\r\n  }\r\n}\r\n\r\nfunction updateEnemies(delta) {\r\n  for (const enemy of enemies) {\r\n    updateEnemyAI(enemy, delta);\r\n  }\r\n  for (const enemy of enemies) {\r\n    updateEnemyAttacks(enemy);\r\n  }\r\n}\r\n\r\nexport { updateEnemyAI, updateEnemyAttacks, updateEnemies };\r\n\r\n\r\n\r\n\r\n","import { NETWORK_CONFIG } from \"../../config/network.js\";\r\nimport { getP2P } from \"./p2p.js\";\r\nimport {\r\n  getServerBrowserState,\r\n  setVisible,\r\n  toggleVisible,\r\n  setServers,\r\n  setError,\r\n  setStatusMessage,\r\n  setJoinStatus,\r\n  setJoinError,\r\n  setJoinedSessionId,\r\n  selectNext,\r\n  recordFetchTimestamp,\r\n  setFetching,\r\n  setHostingSession,\r\n  setHostingMetrics,\r\n  updateHostingHeartbeatTimestamp,\r\n  clearHosting,\r\n  clearP2PState,\r\n  setP2POffer,\r\n  setP2PAnswer,\r\n  setP2PLocalCandidates,\r\n  setP2PRemoteCandidates,\r\n  setP2PPending,\r\n  setP2PError\r\n} from \"../../state/serverBrowser.js\";\r\nconst CANDIDATE_PUSH_MIN_INTERVAL_MS = 1000;\r\n\r\nlet lastHostCandidatePushAt = 0;\r\nlet lastJoinCandidatePushAt = 0;\r\nlet lastSentHostCandidates = [];\r\nlet lastSentJoinCandidates = [];\r\nlet pendingHostCandidateTimeout = null;\r\nlet pendingJoinCandidateTimeout = null;\r\nlet pendingJoinCandidatePayload = null;\r\n\r\n\r\nfunction getApiBase() {\r\n  return (NETWORK_CONFIG.serverApiBase ?? \"\").replace(/\\/$/, \"\");\r\n}\r\n\r\nfunction getHostSecret() {\r\n  return NETWORK_CONFIG.hostSecret ?? \"\";\r\n}\r\n\r\nfunction getSessionId() {\r\n  if (typeof crypto !== \"undefined\" && crypto.randomUUID) {\r\n    return crypto.randomUUID();\r\n  }\r\n  return `session-${Math.random().toString(36).slice(2, 10)}`;\r\n}\r\n\r\nfunction sanitizeSignal(raw) {\r\n  if (typeof raw !== \"string\") {\r\n    return \"\";\r\n  }\r\n  return raw.trim();\r\n}\r\n\r\nasync function copyToClipboard(text) {\r\n  if (!text || typeof navigator === \"undefined\" || !navigator.clipboard?.writeText) {\r\n    return false;\r\n  }\r\n  try {\r\n    await navigator.clipboard.writeText(text);\r\n    return true;\r\n  } catch (error) {\r\n    console.warn(\"Clipboard write failed\", error);\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction normalizeCandidate(candidate) {\r\n  if (typeof candidate === \"string\") {\r\n    return sanitizeSignal(candidate);\r\n  }\r\n  if (candidate && typeof candidate === \"object\") {\r\n    try {\r\n      return sanitizeSignal(JSON.stringify(candidate));\r\n    } catch {\r\n      return \"\";\r\n    }\r\n  }\r\n  return \"\";\r\n}\r\n\r\nfunction normalizeCandidateList(list) {\r\n  if (!Array.isArray(list)) {\r\n    return [];\r\n  }\r\n  return list\r\n    .map((candidate) => normalizeCandidate(candidate))\r\n    .filter((candidate) => candidate.length > 0);\r\n}\r\n\r\nfunction arraysEqual(a = [], b = []) {\r\n  if (a.length !== b.length) {\r\n    return false;\r\n  }\r\n  for (let index = 0; index < a.length; index += 1) {\r\n    if (a[index] !== b[index]) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction mapServerEntry(server) {\r\n  if (!server || typeof server !== \"object\") {\r\n    return null;\r\n  }\r\n  const metadata = server.metadata ?? {};\r\n  return {\r\n    id: server.id,\r\n    name: server.name ?? server.id,\r\n    map: server.map ?? metadata.map ?? \"Unknown\",\r\n    players: metadata.playerCount ?? server.playerCount ?? server.players ?? 0,\r\n    maxPlayers: server.maxPlayers ?? metadata.maxPlayers ?? 0,\r\n    region: server.region ?? metadata.region ?? \"--\",\r\n    mode: server.mode ?? metadata.mode ?? \"\",\r\n    enemyCount: metadata.enemyCount ?? null,\r\n    alliesCount: metadata.alliesCount ?? null,\r\n    updatedAt: server.updatedAt ?? null,\r\n    signal: {\r\n      hostOffer: server.signal?.hostOffer ?? null,\r\n      hostCandidates: Array.isArray(server.signal?.hostCandidates) ? server.signal.hostCandidates.slice() : [],\r\n      joinAnswer: server.signal?.joinAnswer ?? null,\r\n      joinCandidates: Array.isArray(server.signal?.joinCandidates) ? server.signal.joinCandidates.slice() : []\r\n    }\r\n  };\r\n}\r\n\r\nfunction cacheUpdatedSession(server) {\r\n  const mapped = mapServerEntry(server);\r\n  if (!mapped) {\r\n    return;\r\n  }\r\n  const state = getServerBrowserState();\r\n  const index = state.servers.findIndex((entry) => entry.id === mapped.id);\r\n  if (index >= 0) {\r\n    state.servers[index] = mapped;\r\n  } else {\r\n    state.servers.push(mapped);\r\n  }\r\n}\r\n\r\nfunction resetCandidateTracking() {\r\n  lastSentHostCandidates = [];\r\n  lastSentJoinCandidates = [];\r\n  lastHostCandidatePushAt = 0;\r\n  lastJoinCandidatePushAt = 0;\r\n  if (pendingHostCandidateTimeout) {\r\n    clearTimeout(pendingHostCandidateTimeout);\r\n    pendingHostCandidateTimeout = null;\r\n  }\r\n  if (pendingJoinCandidateTimeout) {\r\n    clearTimeout(pendingJoinCandidateTimeout);\r\n    pendingJoinCandidateTimeout = null;\r\n  }\r\n  pendingJoinCandidatePayload = null;\r\n}\r\n\r\nfunction scheduleHostCandidatePush() {\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting || !state.hostingSessionId) {\r\n    return;\r\n  }\r\n  const now = Date.now();\r\n  const delay = Math.max(0, CANDIDATE_PUSH_MIN_INTERVAL_MS - (now - lastHostCandidatePushAt));\r\n  if (delay > 0) {\r\n    if (!pendingHostCandidateTimeout) {\r\n      pendingHostCandidateTimeout = setTimeout(() => {\r\n        pendingHostCandidateTimeout = null;\r\n        pushHostCandidatesNow();\r\n      }, delay);\r\n    }\r\n    return;\r\n  }\r\n  pushHostCandidatesNow();\r\n}\r\n\r\nfunction pushHostCandidatesNow() {\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting || !state.hostingSessionId) {\r\n    return;\r\n  }\r\n  lastHostCandidatePushAt = Date.now();\r\n  heartbeatSession().catch((error) => console.warn(\"[serverBrowser] heartbeat update failed\", error));\r\n}\r\n\r\nfunction scheduleJoinerCandidatePush(candidates) {\r\n  const state = getServerBrowserState();\r\n  if (!state.joinedSessionId || !Array.isArray(candidates) || candidates.length === 0) {\r\n    return;\r\n  }\r\n  const now = Date.now();\r\n  const delay = Math.max(0, CANDIDATE_PUSH_MIN_INTERVAL_MS - (now - lastJoinCandidatePushAt));\r\n  if (delay > 0) {\r\n    pendingJoinCandidatePayload = candidates.slice();\r\n    if (!pendingJoinCandidateTimeout) {\r\n      pendingJoinCandidateTimeout = setTimeout(() => {\r\n        const payload = pendingJoinCandidatePayload;\r\n        pendingJoinCandidateTimeout = null;\r\n        pendingJoinCandidatePayload = null;\r\n        pushJoinerCandidatesNow(payload);\r\n      }, delay);\r\n    }\r\n    return;\r\n  }\r\n  pushJoinerCandidatesNow(candidates);\r\n}\r\n\r\nfunction pushJoinerCandidatesNow(candidates) {\r\n  const state = getServerBrowserState();\r\n  if (!state.joinedSessionId || !Array.isArray(candidates) || candidates.length === 0) {\r\n    return;\r\n  }\r\n  lastJoinCandidatePushAt = Date.now();\r\n  postJoinerUpdate(state.joinedSessionId, { signalCandidates: candidates }).catch((error) => {\r\n    console.warn(\"[serverBrowser] failed to publish joiner candidates\", error);\r\n  });\r\n}\r\n\r\nfunction handleLocalCandidateUpdate(candidates) {\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting) {\r\n    lastSentHostCandidates = [];\r\n  }\r\n  if (!state.joinedSessionId) {\r\n    lastSentJoinCandidates = [];\r\n  }\r\n  if (!Array.isArray(candidates) || candidates.length === 0) {\r\n    if (!state.hosting && !state.joinedSessionId) {\r\n      resetCandidateTracking();\r\n      setJoinedSessionId(null);\r\n    }\r\n    return;\r\n  }\r\n  if (state.hosting && state.hostingSessionId && !arraysEqual(lastSentHostCandidates, candidates)) {\r\n    lastSentHostCandidates = candidates.slice();\r\n    scheduleHostCandidatePush();\r\n  }\r\n  if (state.joinedSessionId && !arraysEqual(lastSentJoinCandidates, candidates)) {\r\n    lastSentJoinCandidates = candidates.slice();\r\n    scheduleJoinerCandidatePush(candidates.slice());\r\n  }\r\n}\r\n\r\nasync function fetchSessionDetail(serverId) {\r\n  const apiBase = getApiBase();\r\n  if (!apiBase) {\r\n    throw new Error(\"Server API base not configured\");\r\n  }\r\n  console.debug(`[serverBrowser] fetching session detail for ${serverId}`);\r\n  const response = await fetch(`${apiBase}/sessions/${serverId}`);\r\n  if (response.status === 404) {\r\n    console.warn(`[serverBrowser] session ${serverId} no longer exists (404)`);\r\n    return { notFound: true };\r\n  }\r\n  if (!response.ok) {\r\n    console.warn(`[serverBrowser] session detail request failed ${response.status} for ${serverId}`);\r\n    throw new Error(`Session lookup failed (HTTP ${response.status})`);\r\n  }\r\n  const payload = await response.json();\r\n  console.debug(`[serverBrowser] received session detail for ${serverId}`);\r\n  return payload;\r\n}\r\n\r\nfunction syncLocalCandidates() {\r\n  const state = getServerBrowserState();\r\n  let p2p;\r\n  try {\r\n    p2p = getP2P();\r\n  } catch {\r\n    if ((state.p2p?.localCandidates ?? []).length > 0) {\r\n      setP2PLocalCandidates([]);\r\n      handleLocalCandidateUpdate([]);\r\n    }\r\n    return [];\r\n  }\r\n  if (!p2p?.getLocalCandidates) {\r\n    if ((state.p2p?.localCandidates ?? []).length > 0) {\r\n      setP2PLocalCandidates([]);\r\n      handleLocalCandidateUpdate([]);\r\n    }\r\n    return [];\r\n  }\r\n  const previous = Array.isArray(state.p2p?.localCandidates) ? state.p2p.localCandidates.slice() : [];\r\n  const normalized = normalizeCandidateList(p2p.getLocalCandidates() ?? []);\r\n  if (!arraysEqual(previous, normalized)) {\r\n    setP2PLocalCandidates(normalized);\r\n    handleLocalCandidateUpdate(normalized);\r\n  }\r\n  return normalized;\r\n}\r\n\r\n\r\nfunction parseCandidateInput(rawInput) {\r\n  const sanitized = sanitizeSignal(rawInput);\r\n  if (!sanitized) {\r\n    return [];\r\n  }\r\n  try {\r\n    const parsed = JSON.parse(sanitized);\r\n    if (Array.isArray(parsed)) {\r\n      return normalizeCandidateList(parsed);\r\n    }\r\n    if (parsed && typeof parsed === \"object\") {\r\n      return normalizeCandidateList([parsed]);\r\n    }\r\n    if (typeof parsed === \"string\") {\r\n      return normalizeCandidateList([parsed]);\r\n    }\r\n  } catch {\r\n    // fall through to newline parsing\r\n  }\r\n  const segments = sanitized\r\n    .split(/\\r?\\n+/)\r\n    .map((segment) => segment.trim())\r\n    .filter((segment) => segment.length > 0);\r\n  return normalizeCandidateList(segments);\r\n}\r\n\r\nasync function copyLocalCandidates({ silent = false } = {}) {\r\n  try {\r\n    setP2PPending({ candidates: true });\r\n    const candidates = syncLocalCandidates();\r\n    if (candidates.length === 0) {\r\n      if (!silent) {\r\n        setStatusMessage(\"No ICE candidates yet. Wait a moment after generating offer/answer.\");\r\n      }\r\n      return { copied: false, count: 0 };\r\n    }\r\n    const payload = candidates.join(\"\\n\");\r\n    const copied = await copyToClipboard(payload);\r\n    if (!silent) {\r\n      if (copied) {\r\n        setStatusMessage(`Copied ${candidates.length} ICE candidate${candidates.length === 1 ? \"\" : \"s\"}.`);\r\n      } else {\r\n        setStatusMessage(\"Candidates ready. Copy manually if clipboard access is blocked.\");\r\n      }\r\n    }\r\n    return { copied, count: candidates.length, payload };\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to copy ICE candidates\";\r\n    setP2PError(message);\r\n    throw error;\r\n  } finally {\r\n    setP2PPending({ candidates: false });\r\n  }\r\n}\r\n\r\nfunction mergeCandidates(existing, incoming) {\r\n  const merged = [...existing, ...incoming];\r\n  const seen = new Set();\r\n  const unique = [];\r\n  for (const candidate of merged) {\r\n    if (!seen.has(candidate)) {\r\n      seen.add(candidate);\r\n      unique.push(candidate);\r\n    }\r\n  }\r\n  return unique;\r\n}\r\n\r\nasync function promptForRemoteCandidates() {\r\n  if (typeof window === \"undefined\" || typeof window.prompt !== \"function\") {\r\n    throw new Error(\"Prompts unavailable in this environment\");\r\n  }\r\n  const state = getServerBrowserState();\r\n  const existing = (state.p2p.remoteCandidates ?? []).join(\"\\n\");\r\n  const input = window.prompt(\"Paste remote ICE candidates (JSON array or newline separated)\", existing);\r\n  if (input == null) {\r\n    setStatusMessage(\"Candidate entry cancelled.\");\r\n    return null;\r\n  }\r\n  const candidates = parseCandidateInput(input);\r\n  if (candidates.length === 0) {\r\n    setStatusMessage(\"No valid ICE candidates detected.\");\r\n    throw new Error(\"No ICE candidates provided\");\r\n  }\r\n  const p2p = getP2POrThrow();\r\n  setP2PError(null);\r\n  setP2PPending({ candidates: true });\r\n  try {\r\n    for (const candidate of candidates) {\r\n      await p2p.addRemoteCandidate(candidate);\r\n    }\r\n    const merged = mergeCandidates(state.p2p.remoteCandidates ?? [], candidates);\r\n    setP2PRemoteCandidates(merged);\r\n    setStatusMessage(`Applied ${candidates.length} ICE candidate${candidates.length === 1 ? \"\" : \"s\"}.`);\r\n    return candidates;\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to apply ICE candidates\";\r\n    setP2PError(message);\r\n    throw error;\r\n  } finally {\r\n    setP2PPending({ candidates: false });\r\n  }\r\n}function getP2POrThrow() {\r\n  try {\r\n    return getP2P();\r\n  } catch (error) {\r\n    const message = error?.message ?? \"P2P subsystem unavailable\";\r\n    setP2PError(message);\r\n    throw error;\r\n  }\r\n}\r\n\r\nfunction buildHostingMetadata(metrics, fallbackPlayerCount) {\r\n  const playerCount = metrics?.playerCount ?? fallbackPlayerCount;\r\n  return {\r\n    playerCount,\r\n    enemyCount: metrics?.enemyCount ?? 0,\r\n    alliesCount: metrics?.alliesCount ?? Math.max(0, playerCount - 1)\r\n  };\r\n}\r\n\r\nasync function fetchServerList({ silent = false } = {}) {\r\n  const apiBase = getApiBase();\r\n  if (!apiBase) {\r\n    setError(\"Server list URL not configured\");\r\n    setServers([]);\r\n    return;\r\n  }\r\n  setFetching(true);\r\n  if (!silent) {\r\n    setStatusMessage(\"Fetching server list...\");\r\n  }\r\n  try {\r\n    const response = await fetch(`${apiBase}/sessions`, {\r\n      headers: { Accept: \"application/json\" }\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}`);\r\n    }\r\n    const data = await response.json();\r\n    const servers = Array.isArray(data) ? data : Array.isArray(data?.servers) ? data.servers : [];\r\n    const mappedServers = servers\r\n      .map((server) => mapServerEntry(server))\r\n      .filter(Boolean);\r\n    const staleThresholdMs = Math.max(30_000, Math.round((NETWORK_CONFIG.hostTtlSeconds ?? 150) * 1000 * 1.1));\r\n    const now = Date.now();\r\n    const filteredServers = mappedServers.filter((server) => {\r\n      if (!server.updatedAt) {\r\n        return true;\r\n      }\r\n      const updatedAtMs = Date.parse(server.updatedAt);\r\n      if (Number.isNaN(updatedAtMs)) {\r\n        return true;\r\n      }\r\n      return now - updatedAtMs <= staleThresholdMs;\r\n    });\r\n    setServers(filteredServers);\r\n    setError(null);\r\n    if (!silent) {\r\n      setStatusMessage(filteredServers.length === 0 ? \"No active sessions.\" : \"Fetched session list.\");\r\n    }\r\n  } catch (error) {\r\n    setServers([]);\r\n    setError(`Failed to fetch servers: ${error.message}`);\r\n    if (!silent) {\r\n      setStatusMessage(\"Unable to reach session service.\");\r\n    }\r\n  } finally {\r\n    setFetching(false);\r\n  }\r\n}\r\n\r\nasync function hostSession({\r\n  id = getSessionId(),\r\n  name = NETWORK_CONFIG.hostName ?? \"Stickman Lobby\",\r\n  region = NETWORK_CONFIG.defaultRegion ?? \"na\",\r\n  map = \"Neo District\",\r\n  playerCount = 1,\r\n  maxPlayers = 4,\r\n  mode = \"freeplay\",\r\n  signal = null\r\n} = {}) {\r\n  const apiBase = getApiBase();\r\n  const secret = getHostSecret();\r\n  if (!apiBase) {\r\n    throw new Error(\"Server API base not configured\");\r\n  }\r\n  if (!secret) {\r\n    throw new Error(\"Host secret not provided\");\r\n  }\r\n  const state = getServerBrowserState();\r\n  const metrics = state.hostingMetrics ?? {};\r\n  const ttlSeconds = NETWORK_CONFIG.hostTtlSeconds ?? 150;\r\n  const computedPlayerCount = metrics.playerCount ?? playerCount;\r\n  const effectiveSignal = signal ?? {\r\n    hostOffer: state.p2p.offer ?? null,\r\n    hostCandidates: state.p2p.localCandidates ?? []\r\n  };\r\n  const response = await fetch(`${apiBase}/sessions`, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      \"x-session-secret\": secret\r\n    },\r\n    body: JSON.stringify({\r\n      id,\r\n      name,\r\n      region,\r\n      map,\r\n      mode,\r\n      playerCount: computedPlayerCount,\r\n      maxPlayers,\r\n      ttlSeconds,\r\n      metadata: buildHostingMetadata(metrics, computedPlayerCount),\r\n      signal: {\r\n        hostOffer: effectiveSignal.hostOffer ?? null,\r\n        hostCandidates: Array.isArray(effectiveSignal.hostCandidates) ? effectiveSignal.hostCandidates : []\r\n      }\r\n    })\r\n  });\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to host session (HTTP ${response.status})`);\r\n  }\r\n  const payload = await response.json();\r\n  setP2PLocalCandidates(Array.isArray(effectiveSignal.hostCandidates) ? effectiveSignal.hostCandidates : []);\r\n  setHostingSession({ id, expiresAt: Date.now() + (payload?.ttlSeconds ?? ttlSeconds) * 1000 });\r\n  setStatusMessage(`Hosting ${name}`);\r\n  return { id, ttlSeconds: payload?.ttlSeconds ?? ttlSeconds };\r\n}\r\n\r\nasync function heartbeatSession() {\r\n  const apiBase = getApiBase();\r\n  const secret = getHostSecret();\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting || !state.hostingSessionId || !apiBase || !secret) {\r\n    return;\r\n  }\r\n  const metrics = state.hostingMetrics ?? {};\r\n  const computedPlayerCount = metrics.playerCount ?? 1;\r\n  try {\r\n    const response = await fetch(`${apiBase}/sessions/${state.hostingSessionId}/heartbeat`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"x-session-secret\": secret\r\n      },\r\n      body: JSON.stringify({\r\n        playerCount: computedPlayerCount,\r\n        ttlSeconds: NETWORK_CONFIG.hostTtlSeconds ?? 150,\r\n        metadata: buildHostingMetadata(metrics, computedPlayerCount),\r\n        signal: {\r\n          hostOffer: state.p2p.offer ?? null,\r\n          hostCandidates: Array.isArray(state.p2p.localCandidates) ? state.p2p.localCandidates : []\r\n        }\r\n      })\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}`);\r\n    }\r\n    const payload = await response.json();\r\n    updateHostingHeartbeatTimestamp(performance.now());\r\n    if (payload?.ttlSeconds) {\r\n      setHostingSession({ id: state.hostingSessionId, expiresAt: Date.now() + payload.ttlSeconds * 1000 });\r\n    }\r\n  } catch (error) {\r\n    console.warn(\"Heartbeat failed\", error);\r\n    setStatusMessage(\"Heartbeat failed; hosting paused.\");\r\n    clearHosting();\r\n    resetCandidateTracking();\r\n  }\r\n}\r\n\r\nasync function stopHosting() {\r\n  const apiBase = getApiBase();\r\n  const secret = getHostSecret();\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting || !state.hostingSessionId || !apiBase || !secret) {\r\n    clearHosting();\r\n    resetCandidateTracking();\r\n    return;\r\n  }\r\n  try {\r\n    await fetch(`${apiBase}/sessions/${state.hostingSessionId}`, {\r\n      method: \"DELETE\",\r\n      headers: {\r\n        \"x-session-secret\": secret\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.warn(\"Failed to stop hosting\", error);\r\n  } finally {\r\n    clearHosting();\r\n    resetCandidateTracking();\r\n  }\r\n}\r\n\r\nasync function joinServer(serverId, payload = {}) {\r\n  const apiBase = getApiBase();\r\n  if (!apiBase) {\r\n    throw new Error(\"Server API base not configured\");\r\n  }\r\n  setJoinStatus(\"Contacting host...\");\r\n  setJoinError(null);\r\n  const url = `${apiBase}/sessions/${serverId}/join`;\r\n  const response = await fetch(url, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\"\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n  if (!response.ok) {\r\n    const message = `Join failed (HTTP ${response.status})`;\r\n    setJoinStatus(null);\r\n    setJoinError(message);\r\n    throw new Error(message);\r\n  }\r\n  const result = await response.json();\r\n  const joinedName = result?.session?.name ?? serverId;\r\n  clearP2PState();\r\n  resetCandidateTracking();\r\n  cacheUpdatedSession(result?.session);\r\n  setJoinStatus(`Joined ${joinedName}`);\r\n  setStatusMessage(\"Joined lobby. Establishing connection...\");\r\n  return result;\r\n}\r\n\r\n\r\nasync function postJoinerUpdate(sessionId, payload = {}) {\r\n  const apiBase = getApiBase();\r\n  if (!apiBase || !sessionId) {\r\n    return;\r\n  }\r\n  if (!payload || Object.keys(payload).length === 0) {\r\n    return;\r\n  }\r\n  try {\r\n    const response = await fetch(`${apiBase}/sessions/${sessionId}/join`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify(payload)\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}`);\r\n    }\r\n    const result = await response.json();\r\n    if (result?.session) {\r\n      cacheUpdatedSession(result.session);\r\n      if (Array.isArray(result.session.signal?.hostCandidates) && result.session.signal.hostCandidates.length > 0) {\r\n        applyRemoteCandidates(result.session.signal.hostCandidates);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.warn(`[serverBrowser] joiner update failed for ${sessionId}`, error);\r\n  }\r\n}\r\n\r\n\r\nfunction showServerBrowser() {\r\n  setVisible(true);\r\n  recordFetchTimestamp(0);\r\n  fetchServerList();\r\n}\r\n\r\nfunction hideServerBrowser() {\r\n  setVisible(false);\r\n}\r\n\r\nfunction updateServerBrowser(delta, timestamp) {\r\n  const state = getServerBrowserState();\r\n  pumpSignalUpdates();\r\n  syncLocalCandidates();\r\n\r\n  const baseInterval = NETWORK_CONFIG.refreshIntervalMs ?? 10000;\r\n  const backgroundInterval = Math.min(baseInterval, 3000);\r\n  const refreshInterval = state.visible ? baseInterval : backgroundInterval;\r\n  const shouldPoll = state.visible || state.hosting || Boolean(state.joinedSessionId);\r\n  if (shouldPoll && timestamp - state.lastFetch >= refreshInterval && !state.fetching) {\r\n    recordFetchTimestamp(timestamp);\r\n    fetchServerList({ silent: !state.visible });\r\n  }\r\n\r\n  if (!state.visible) {\r\n    if (state.hosting) {\r\n      const interval = NETWORK_CONFIG.heartbeatIntervalMs ?? 45000;\r\n      if (timestamp - state.hostingLastHeartbeat >= interval) {\r\n        heartbeatSession();\r\n      }\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (state.hosting) {\r\n    const interval = NETWORK_CONFIG.heartbeatIntervalMs ?? 45000;\r\n    if (timestamp - state.hostingLastHeartbeat >= interval) {\r\n      heartbeatSession();\r\n    }\r\n  }\r\n  pumpSignalUpdates();\r\n}\r\n\r\n\r\nasync function ensureHostOffer({ forceRegenerate = false } = {}) {\r\n  const state = getServerBrowserState();\r\n  const shouldRebuild = forceRegenerate || !state.p2p.offer;\r\n  if (!shouldRebuild) {\r\n    syncLocalCandidates();\r\n    return state.p2p.offer;\r\n  }\r\n  const p2p = getP2POrThrow();\r\n  setP2PError(null);\r\n  setP2PPending({ offer: true });\r\n  try {\r\n    const offer = await p2p.createOffer();\r\n    setP2POffer(offer);\r\n    syncLocalCandidates();\r\n    return offer;\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to create offer\";\r\n    setP2PError(message);\r\n    throw error;\r\n  } finally {\r\n    setP2PPending({ offer: false });\r\n  }\r\n}\r\n\r\nasync function copyHostOffer({ forceRegenerate = false, silent = false } = {}) {\r\n  const offer = await ensureHostOffer({ forceRegenerate });\r\n  const copied = await copyToClipboard(offer);\r\n  if (!silent) {\r\n    if (copied) {\r\n      setStatusMessage(\"Offer copied. Share it with your party.\");\r\n    } else {\r\n      setStatusMessage(\"Offer ready. Copy it manually if clipboard access is blocked.\");\r\n    }\r\n  }\r\n  return { offer, copied };\r\n}\r\n\r\nasync function acceptHostOffer(rawOffer, { autoCopyAnswer = true } = {}) {\r\n  const offerString = sanitizeSignal(rawOffer);\r\n  if (!offerString) {\r\n    throw new Error(\"Offer empty\");\r\n  }\r\n  let normalizedOffer;\r\n  try {\r\n    normalizedOffer = JSON.stringify(JSON.parse(offerString));\r\n  } catch (error) {\r\n    setP2PError(\"Offer must be valid JSON\");\r\n    throw error;\r\n  }\r\n  const p2p = getP2POrThrow();\r\n  setP2PError(null);\r\n  setP2PPending({ answer: true });\r\n  try {\r\n    const answer = await p2p.createAnswer(normalizedOffer);\r\n    setP2PAnswer(answer);\r\n    syncLocalCandidates();\r\n    if (autoCopyAnswer) {\r\n      const copied = await copyToClipboard(answer);\r\n      if (copied) {\r\n        setStatusMessage(\"Answer copied. Send it back to the host.\");\r\n      } else {\r\n        setStatusMessage(\"Answer ready. Copy it manually for the host.\");\r\n      }\r\n    } else {\r\n      setStatusMessage(\"Answer ready. Share it with the host.\");\r\n    }\r\n    return answer;\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to build answer\";\r\n    setP2PError(message);\r\n    throw error;\r\n  } finally {\r\n    setP2PPending({ answer: false });\r\n  }\r\n}\r\n\r\nasync function applyJoinerAnswer(rawAnswer) {\r\n  const answerString = sanitizeSignal(rawAnswer);\r\n  if (!answerString) {\r\n    throw new Error(\"Answer empty\");\r\n  }\r\n  let normalizedAnswer;\r\n  try {\r\n    normalizedAnswer = JSON.stringify(JSON.parse(answerString));\r\n  } catch (error) {\r\n    setP2PError(\"Answer must be valid JSON\");\r\n    throw error;\r\n  }\r\n  const p2p = getP2POrThrow();\r\n  setP2PError(null);\r\n  try {\r\n    await p2p.acceptRemoteDescription(normalizedAnswer);\r\n    setP2PAnswer(normalizedAnswer);\r\n    setStatusMessage(\"Answer applied. Waiting for connection...\");\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to accept answer\";\r\n    setP2PError(message);\r\n    throw error;\r\n  }\r\n}\r\n\r\n\r\nfunction applyRemoteCandidates(candidates) {\r\n  if (!Array.isArray(candidates) || candidates.length === 0) {\r\n    return;\r\n  }\r\n  const normalized = normalizeCandidateList(candidates);\r\n  if (normalized.length === 0) {\r\n    return;\r\n  }\r\n  let p2p;\r\n  try {\r\n    p2p = getP2POrThrow();\r\n  } catch (error) {\r\n    console.warn(\"P2P unavailable while applying candidates\", error);\r\n    return;\r\n  }\r\n  const state = getServerBrowserState();\r\n  const current = Array.isArray(state.p2p.remoteCandidates) ? state.p2p.remoteCandidates : [];\r\n  const seen = new Set(current);\r\n  const updated = current.slice();\r\n  for (const candidate of normalized) {\r\n    if (seen.has(candidate)) {\r\n      continue;\r\n    }\r\n    try {\r\n      p2p.addRemoteCandidate(candidate);\r\n      updated.push(candidate);\r\n      seen.add(candidate);\r\n    } catch (error) {\r\n      console.warn(\"Failed to add ICE candidate\", error);\r\n    }\r\n  }\r\n  setP2PRemoteCandidates(updated);\r\n}\r\n\r\nfunction pumpSignalUpdates() {\r\n  const state = getServerBrowserState();\r\n  if (state.hosting && state.hostingSessionId) {\r\n    const hostSession = state.servers.find((entry) => entry.id === state.hostingSessionId);\r\n    const signal = hostSession?.signal ?? null;\r\n    if (signal) {\r\n      if (signal.joinAnswer && state.p2p.answer !== signal.joinAnswer) {\r\n        applyJoinerAnswer(signal.joinAnswer).catch((error) => {\r\n          console.warn(\"Failed to apply joiner answer\", error);\r\n        });\r\n      }\r\n      if (Array.isArray(signal.joinCandidates) && signal.joinCandidates.length > 0) {\r\n        applyRemoteCandidates(signal.joinCandidates);\r\n      }\r\n      if (signal.joinAnswer && (state.hostingMetrics?.playerCount ?? 1) < 2) {\r\n        setHostingMetrics({ playerCount: Math.max(2, state.hostingMetrics?.playerCount ?? 1) });\r\n        heartbeatSession().catch((error) => console.warn(\"Heartbeat update failed\", error));\r\n      }\r\n    }\r\n  }\r\n  if (state.joinedSessionId) {\r\n    const joinedSession = state.servers.find((entry) => entry.id === state.joinedSessionId);\r\n    const signal = joinedSession?.signal ?? null;\r\n    if (signal && Array.isArray(signal.hostCandidates) && signal.hostCandidates.length > 0) {\r\n      applyRemoteCandidates(signal.hostCandidates);\r\n    } else if (!joinedSession) {\r\n      setJoinedSessionId(null);\r\n    }\r\n  }\r\n}\r\n\r\nasync function promptForHostOffer() {\r\n  if (typeof window === \"undefined\" || typeof window.prompt !== \"function\") {\r\n    throw new Error(\"Prompts unavailable in this environment\");\r\n  }\r\n  const input = window.prompt(\"Paste the host offer JSON\", \"\");\r\n  if (input == null) {\r\n    setStatusMessage(\"Offer entry cancelled.\");\r\n    return null;\r\n  }\r\n  try {\r\n    return await acceptHostOffer(input, { autoCopyAnswer: true });\r\n  } catch (error) {\r\n    setStatusMessage(\"Invalid offer. Please try again.\");\r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function promptForJoinerAnswer() {\r\n  if (typeof window === \"undefined\" || typeof window.prompt !== \"function\") {\r\n    throw new Error(\"Prompts unavailable in this environment\");\r\n  }\r\n  const input = window.prompt(\"Paste the player's answer JSON\", \"\");\r\n  if (input == null) {\r\n    setStatusMessage(\"Answer entry cancelled.\");\r\n    return null;\r\n  }\r\n  try {\r\n    await applyJoinerAnswer(input);\r\n    return input;\r\n  } catch (error) {\r\n    setStatusMessage(\"Invalid answer. Ask the player to resend it.\");\r\n    throw error;\r\n  }\r\n}\r\n\r\nfunction attemptHostSession() {\r\n  const state = getServerBrowserState();\r\n  if (state.hosting) {\r\n    setStatusMessage(\"Already hosting.\");\r\n    return Promise.resolve({ alreadyHosting: true });\r\n  }\r\n  clearP2PState();\r\n  resetCandidateTracking();\r\n  setJoinedSessionId(null);\r\n  setStatusMessage(\"Preparing host offer...\");\r\n  setError(null);\r\n  return ensureHostOffer({ forceRegenerate: true })\r\n    .then((offer) => {\r\n      const candidates = syncLocalCandidates();\r\n      return hostSession({\r\n        signal: {\r\n          hostOffer: offer,\r\n          hostCandidates: candidates\r\n        }\r\n      }).then((result) => {\r\n        setStatusMessage(`Hosting ${state.hostingSessionId ?? result.id}`);\r\n        return result;\r\n      });\r\n    })\r\n    .catch((error) => {\r\n      const message = typeof error?.message === \"string\" ? error.message : \"Host failed\";\r\n      setError(message);\r\n      setStatusMessage(null);\r\n      throw error;\r\n    });\r\n}\r\n\r\nfunction attemptStopHosting() {\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting) {\r\n    setStatusMessage(\"Not hosting any session.\");\r\n    return Promise.resolve({ alreadyStopped: true });\r\n  }\r\n  setStatusMessage(\"Stopping session...\");\r\n  setError(null);\r\n  return stopHosting()\r\n    .then(() => {\r\n      setStatusMessage(\"Hosting stopped.\");\r\n      setJoinedSessionId(null);\r\n    })\r\n    .catch((error) => {\r\n      const message = typeof error?.message === \"string\" ? error.message : \"Stop failed\";\r\n      setError(message);\r\n      throw error;\r\n    });\r\n}\r\n\r\nfunction attemptJoinSession(server) {\r\n  if (!server) {\r\n    setJoinError(\"No server selected.\");\r\n    return Promise.reject(new Error(\"No server selected\"));\r\n  }\r\n  const resolveSignal = () => {\r\n    const directSignal = server.signal ?? {};\r\n    if (directSignal.hostOffer) {\r\n      console.debug(`[serverBrowser] using cached signal for ${server.id}`);\r\n      return Promise.resolve({ server, signal: directSignal });\r\n    }\r\n    console.debug(`[serverBrowser] cached signal missing for ${server.id}, fetching detail`);\r\n    setStatusMessage(\"Syncing host signal...\");\r\n    return fetchSessionDetail(server.id).then((result) => {\r\n      if (result?.notFound) {\r\n        console.warn(`[serverBrowser] session ${server.id} vanished before join`);\r\n        const state = getServerBrowserState();\r\n        const index = state.servers.findIndex((entry) => entry.id === server.id);\r\n        if (index >= 0) {\r\n          state.servers.splice(index, 1);\r\n        }\r\n        setJoinedSessionId(null);\r\n        throw new Error(\"Session no longer available\");\r\n      }\r\n      const refreshed = result?.session;\r\n      const refreshedSignal = refreshed?.signal ?? {};\r\n      if (!refreshedSignal.hostOffer) {\r\n        throw new Error(\"Host offer unavailable. Ask the host to refresh.\");\r\n      }\r\n      const state = getServerBrowserState();\r\n      const updatedEntry = {\r\n        ...server,\r\n        signal: {\r\n          hostOffer: refreshedSignal.hostOffer ?? null,\r\n          hostCandidates: Array.isArray(refreshedSignal.hostCandidates) ? refreshedSignal.hostCandidates.slice() : [],\r\n          joinAnswer: refreshedSignal.joinAnswer ?? null,\r\n          joinCandidates: Array.isArray(refreshedSignal.joinCandidates) ? refreshedSignal.joinCandidates.slice() : []\r\n        },\r\n        updatedAt: refreshed?.updatedAt ?? server.updatedAt\r\n      };\r\n      const index = state.servers.findIndex((entry) => entry.id === server.id);\r\n      if (index >= 0) {\r\n        state.servers[index] = updatedEntry;\r\n      }\r\n      console.debug(`[serverBrowser] refreshed signal for ${server.id}`);\r\n      return { server: updatedEntry, signal: updatedEntry.signal };\r\n    });\r\n  };\r\n\r\n  return resolveSignal()\r\n    .then(({ server: resolvedServer, signal }) => {\r\n      clearP2PState();\r\n      resetCandidateTracking();\r\n      setJoinError(null);\r\n      console.debug(`[serverBrowser] applying host offer for ${resolvedServer.id}`);\r\n      setStatusMessage(`Connecting to ${resolvedServer.name ?? resolvedServer.id}...`);\r\n      setError(null);\r\n      return acceptHostOffer(signal.hostOffer, { autoCopyAnswer: false })\r\n        .then((answer) => {\r\n          const candidates = syncLocalCandidates();\r\n          console.debug(`[serverBrowser] posting join payload for ${resolvedServer.id}`);\r\n          return joinServer(resolvedServer.id, {\r\n            signalAnswer: answer,\r\n            signalCandidates: candidates\r\n          }).then((result) => {\r\n            setJoinedSessionId(resolvedServer.id);\r\n            if (Array.isArray(result?.session?.signal?.hostCandidates)) {\r\n              applyRemoteCandidates(result.session.signal.hostCandidates);\r\n            }\r\n            setStatusMessage(`Joined ${result?.session?.name ?? resolvedServer.name ?? resolvedServer.id}`);\r\n            return result;\r\n          });\r\n        });\r\n    })\r\n    .catch((error) => {\r\n      const message = typeof error?.message === \"string\" ? error.message : \"Join failed\";\r\n      console.warn(`[serverBrowser] join failed for ${server.id}: ${message}`);\r\n      setJoinError(message);\r\n      setStatusMessage(null);\r\n      throw error;\r\n    });\r\n}\r\n\r\nexport {\r\n  getServerBrowserState,\r\n  setVisible,\r\n  toggleVisible,\r\n  showServerBrowser,\r\n  hideServerBrowser,\r\n  fetchServerList,\r\n  hostSession,\r\n  joinServer,\r\n  stopHosting,\r\n  updateServerBrowser,\r\n  selectNext,\r\n  heartbeatSession as hostHeartbeat,\r\n  attemptHostSession,\r\n  attemptStopHosting,\r\n  attemptJoinSession,\r\n  copyHostOffer,\r\n  promptForHostOffer,\r\n  promptForJoinerAnswer,\r\n  ensureHostOffer,\r\n  acceptHostOffer,\r\n  applyJoinerAnswer,\r\n  copyLocalCandidates,\r\n  promptForRemoteCandidates,\r\n  syncLocalCandidates\r\n};\r\n\r\nexport const hostServer = hostSession;\r\n\r\nif (typeof window !== \"undefined\") {\r\n  window.ServerBrowser = {\r\n    fetch: fetchServerList,\r\n    host: hostSession,\r\n    join: joinServer,\r\n    stop: stopHosting,\r\n    attemptHost: attemptHostSession,\r\n    attemptStop: attemptStopHosting,\r\n    attemptJoin: attemptJoinSession,\r\n    copyOffer: copyHostOffer,\r\n    regenerateOffer: () => copyHostOffer({ forceRegenerate: true, silent: true }),\r\n    promptOffer: promptForHostOffer,\r\n    promptAnswer: promptForJoinerAnswer,\r\n    copyCandidates: copyLocalCandidates,\r\n    promptCandidates: promptForRemoteCandidates,\r\n    syncCandidates: syncLocalCandidates,\r\n    state: getServerBrowserState\r\n  };\r\n}\r\n\r\nexport { setHostingMetrics } from \"../../state/serverBrowser.js\";\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { SPEED, JUMP_SPEED, ROLL_SPEED, GRAVITY, POSES } from \"../../config/constants.js\";\r\nimport { canvas, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { setCameraTargetX, updateCamera } from \"../../state/camera.js\";\r\nimport { input } from \"../input/index.js\";\r\nimport { stickman, trainingDummy, enemies, getTotalHeight, getRemotePlayers, squadmates } from \"../../state/entities.js\";\r\nimport { determinePose, startRoll, attemptAttack, advanceAttack } from \"../combat/playerActions.js\";\r\nimport { spawnHitbox, updateHitboxes, resolveHitDetection, fireEquippedWeaponProjectile } from \"../combat/melee.js\";\r\nimport { throwEquippedWeapon, updateThrowables } from \"../combat/throwables.js\";\r\nimport { deployGadget, updateGadgets, updateGadgetMovement, clearGadgets } from \"../gadgets/index.js\";\r\nimport { updateTrainingDummy } from \"./trainingDummy.js\";\r\nimport { updateSalvagePickups } from \"../resources/index.js\";\r\nimport { updateSurvival } from \"../survival/index.js\";\r\nimport { updateBuildingSystem } from \"../building/index.js\";\r\nimport { updateDamagePopups } from \"../effects/damage.js\";\r\nimport { updateParticles } from \"../effects/particles.js\";\r\nimport { updateLighting } from \"../effects/lighting.js\";\r\nimport { updateEnemies } from \"./enemyAI.js\";\r\nimport { updateProjectiles } from \"../combat/projectiles.js\";\r\nimport { updateVehicles, handleVehicleInteraction, getPlayerVehicle, forcePlayerExitVehicle } from \"../vehicles/index.js\";\r\nimport { updateSupplyDrops } from \"./supplyDrops.js\";\r\nimport { updateDestructibles } from \"./destructibles.js\";\r\nimport { updateInteractables } from \"./interactables.js\";\r\nimport { updateEnemySpawner } from \"./enemySpawner.js\";\r\nimport { updateServerBrowser, showServerBrowser, hideServerBrowser, selectNext as selectServerBrowser, attemptJoinSession, getServerBrowserState, setHostingMetrics, attemptHostSession, attemptStopHosting, copyHostOffer, promptForHostOffer, promptForJoinerAnswer, copyLocalCandidates, promptForRemoteCandidates } from \"../network/serverBrowser.js\";\r\nimport { updateP2P } from \"../network/p2p.js\";\r\nimport { updateSquadmates, cycleSquadCommand, setSquadCommandById } from \"../squad/index.js\";\r\nimport { updateRagdolls } from \"../effects/ragdoll.js\";\r\nimport { updatePolishDebug } from \"../events/polishDebug.js\";\r\nimport { resolvePlatformLanding } from \"./arena.js\";\r\nimport { advanceTime } from \"../utils/time.js\";\r\nimport { getCurrentWeapon } from \"../combat/weapons.js\";\r\nimport { updateRecoil } from \"../../state/recoil.js\";\r\nimport { updateAmmoTimers, getAmmoStatus, startReload as requestReload } from \"../../state/ammo.js\";\r\n\r\n\r\nfunction clampPlayerX() {\r\n  const envWidth = getEnvironmentWidth();\r\n  const margin = 40;\r\n  const maxX = Math.max(margin, envWidth - margin);\r\n  stickman.x = Math.max(margin, Math.min(maxX, stickman.x));\r\n}\r\n\r\nfunction updatePlayerAlive(delta) {\r\n  if (stickman.vehicleId) {\r\n    return;\r\n  }\r\n\r\n  stickman.crouching = input.down && stickman.onGround && !stickman.rolling && !stickman.attacking;\r\n\r\n  if (stickman.rolling) {\r\n    stickman.vx = stickman.facing * ROLL_SPEED;\r\n    stickman.vy = 0;\r\n    stickman.rollTimer -= delta;\r\n    if (stickman.rollTimer <= 0) {\r\n      stickman.rolling = false;\r\n    }\r\n  } else {\r\n    let moveSpeed = SPEED;\r\n    if (stickman.crouching) {\r\n      moveSpeed *= 0.55;\r\n    }\r\n    if (stickman.attacking) {\r\n      moveSpeed *= 0.7;\r\n    }\r\n    if (stickman.reloading) {\r\n      moveSpeed *= 0.8;\r\n    }\r\n    if (stickman.smokeSlowTimer > 0) {\r\n      const slowFactor = stickman.smokeSlowStrength ?? 0.6;\r\n      moveSpeed *= Math.max(0.1, Math.min(1, slowFactor));\r\n    }\r\n    if (stickman.stunTimer > 0) {\r\n      moveSpeed *= 0.25;\r\n    }\r\n\r\n    stickman.vx = 0;\r\n    if (input.left) {\r\n      stickman.vx -= moveSpeed;\r\n      stickman.facing = -1;\r\n    }\r\n    if (input.right) {\r\n      stickman.vx += moveSpeed;\r\n      stickman.facing = 1;\r\n    }\r\n\r\n    const canJump = stickman.stunTimer <= 0;\r\n    if (stickman.onGround && canJump && input.jump && !stickman.crouching && !stickman.attacking) {\r\n      stickman.vy = -JUMP_SPEED;\r\n      stickman.onGround = false;\r\n    }\r\n\r\n    stickman.vy += GRAVITY * delta;\r\n  }\r\n\r\n  const previousY = stickman.y;\r\n  stickman.x += stickman.vx * delta;\r\n  stickman.y += stickman.vy * delta;\r\n  stickman.onGround = false;\r\n\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  const landedPlatform = resolvePlatformLanding(stickman, previousY, standingHeight);\r\n\r\n  if (!landedPlatform) {\r\n    const feetY = stickman.y + standingHeight;\r\n    if (feetY >= GROUND_Y) {\r\n      stickman.y = GROUND_Y - standingHeight;\r\n      stickman.vy = 0;\r\n      stickman.onGround = true;\r\n    }\r\n  }\r\n\r\n  clampPlayerX();\r\n}\r\n\r\nfunction updatePlayerInVehicle() {\r\n  const vehicle = getPlayerVehicle();\r\n  if (!vehicle) {\r\n    stickman.vehicleId = null;\r\n    stickman.controlMode = \"onFoot\";\r\n    return;\r\n  }\r\n  stickman.controlMode = \"vehicle\";\r\n  stickman.crouching = false;\r\n  stickman.rolling = false;\r\n  stickman.onGround = vehicle.onGround || vehicle.waterLineY != null;\r\n}\r\n\r\n\r\nfunction updatePlayerDead(delta) {\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  stickman.vehicleId = null;\r\n  stickman.controlMode = \"onFoot\";\r\n  stickman.vehicleCandidateId = null;\r\n  stickman.deadTimer = Math.max(0, stickman.deadTimer - delta);\r\n  stickman.vx *= 0.9;\r\n  stickman.vy += GRAVITY * delta;\r\n  stickman.x += stickman.vx * delta;\r\n  stickman.y += stickman.vy * delta;\r\n\r\n  const feetY = stickman.y + standingHeight;\r\n  if (feetY >= GROUND_Y) {\r\n    stickman.y = GROUND_Y - standingHeight;\r\n    stickman.vy = 0;\r\n    stickman.onGround = true;\r\n  }\r\n\r\n  clampPlayerX();\r\n\r\n  if (stickman.deadTimer === 0) {\r\n    stickman.health = stickman.maxHealth;\r\n    stickman.invulnerability = 1.2;\r\n    stickman.throwCooldown = 0;\r\n    stickman.gadgetCooldown = 0;\r\n    stickman.reloading = false;\r\n    stickman.stunTimer = 0;\r\n    stickman.flashBlindTimer = 0;\r\n    stickman.smokeSlowTimer = 0;\r\n    stickman.smokeSlowStrength = 1;\r\n    clearGadgets();\r\n    const envWidth = getEnvironmentWidth();\r\n    stickman.x = envWidth * 0.5;\r\n    stickman.y = GROUND_Y - standingHeight;\r\n    stickman.vx = 0;\r\n    stickman.vy = 0;\r\n    stickman.onGround = true;\r\n  }\r\n}\r\n\r\nfunction updateGame(delta) {\r\n  advanceTime(delta);\r\n  updateBuildingSystem(delta);\r\n  updateSalvagePickups(delta);\r\n  updateSurvival(delta);\r\n  stickman.invulnerability = Math.max(0, stickman.invulnerability - delta);\r\n  stickman.structureShieldTimer = Math.max(0, (stickman.structureShieldTimer ?? 0) - delta);\r\n  if (stickman.structureShieldTimer <= 0) {\r\n    stickman.structureShieldStrength = 0;\r\n  }\r\n  stickman.throwCooldown = Math.max(0, stickman.throwCooldown - delta);\r\n  stickman.gadgetCooldown = Math.max(0, (stickman.gadgetCooldown ?? 0) - delta);\r\n  stickman.stunTimer = Math.max(0, (stickman.stunTimer ?? 0) - delta);\r\n  stickman.flashBlindTimer = Math.max(0, (stickman.flashBlindTimer ?? 0) - delta);\r\n  stickman.smokeSlowTimer = Math.max(0, (stickman.smokeSlowTimer ?? 0) - delta);\r\n  if (stickman.smokeSlowTimer <= 0) {\r\n    stickman.smokeSlowStrength = 1;\r\n  }\r\n\r\n  const interactRequested = input.interactBuffered;\r\n  input.interactBuffered = false;\r\n  const squadCycleRequested = input.squadCommandCycleBuffered;\r\n  const squadSelectRequested = input.squadCommandSelect;\r\n  const serverBrowserToggleRequested = input.serverBrowserToggleBuffered;\r\n  const serverBrowserNavigate = input.serverBrowserNavigate;\r\n  const serverBrowserJoinRequested = input.serverBrowserJoinBuffered;\r\n  const serverBrowserHostRequested = input.serverBrowserHostBuffered;\r\n  const serverBrowserStopRequested = input.serverBrowserStopHostBuffered;\r\n  const serverBrowserCopyOfferRequested = input.serverBrowserCopyOfferBuffered;\r\n  const serverBrowserPasteOfferRequested = input.serverBrowserPasteOfferBuffered;\r\n  const serverBrowserAcceptAnswerRequested = input.serverBrowserAcceptAnswerBuffered;\r\n  const serverBrowserCopyCandidatesRequested = input.serverBrowserCopyCandidatesBuffered;\r\n  const serverBrowserPasteCandidatesRequested = input.serverBrowserPasteCandidatesBuffered;\r\n  input.squadCommandCycleBuffered = false;\r\n  input.squadCommandSelect = null;\r\n  input.serverBrowserToggleBuffered = false;\r\n  input.serverBrowserNavigate = 0;\r\n  input.serverBrowserJoinBuffered = false;\r\n  input.serverBrowserHostBuffered = false;\r\n  input.serverBrowserStopHostBuffered = false;\r\n  input.serverBrowserCopyOfferBuffered = false;\r\n  input.serverBrowserPasteOfferBuffered = false;\r\n  input.serverBrowserAcceptAnswerBuffered = false;\r\n\r\n  const rawAttackRequested = stickman.health > 0 ? input.attackBuffered : false;\r\n  const rawThrowRequested = stickman.health > 0 ? input.throwBuffered : false;\r\n  const rawReloadRequested = stickman.health > 0 ? input.reloadBuffered : false;\r\n\r\n  input.attackBuffered = false;\r\n  input.throwBuffered = false;\r\n  input.reloadBuffered = false;\r\n\r\n  const rollAttempted = input.roll;\r\n  input.roll = false;\r\n\r\n  handleVehicleInteraction(interactRequested);\r\n  if (squadCycleRequested) {\r\n    cycleSquadCommand();\r\n  }\r\n  if (squadSelectRequested) {\r\n    setSquadCommandById(squadSelectRequested);\r\n  }\r\n  if (serverBrowserToggleRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      hideServerBrowser();\r\n    } else {\r\n      showServerBrowser();\r\n    }\r\n  }\r\n  if (serverBrowserNavigate !== 0) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      selectServerBrowser(serverBrowserNavigate);\r\n    }\r\n  }\r\n  if (serverBrowserJoinRequested) {\r\n    const state = getServerBrowserState();\r\n    const selectedServer = state.visible ? state.servers[state.selectedIndex] : null;\r\n    if (selectedServer) {\r\n      attemptJoinSession(selectedServer).catch((error) => console.warn(\"Join failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserHostRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      attemptHostSession().catch((error) => console.warn(\"Host failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserStopRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      attemptStopHosting().catch((error) => console.warn(\"Stop hosting failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserCopyOfferRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible && state.hosting) {\r\n      copyHostOffer({ forceRegenerate: false, silent: false }).catch((error) => console.warn(\"Offer copy failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserPasteOfferRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      promptForHostOffer().catch((error) => console.warn(\"Offer accept failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserAcceptAnswerRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible && state.hosting) {\r\n      promptForJoinerAnswer().catch((error) => console.warn(\"Answer apply failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserCopyCandidatesRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible && state.hosting) {\r\n      copyLocalCandidates({ silent: false }).catch((error) => console.warn(\"Candidate copy failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserPasteCandidatesRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      promptForRemoteCandidates().catch((error) => console.warn(\"Candidate apply failed\", error));\r\n    }\r\n  }\r\n  let playerVehicle = getPlayerVehicle();\r\n  let inVehicle = Boolean(playerVehicle);\r\n\r\n  if (stickman.health <= 0 && inVehicle) {\r\n    forcePlayerExitVehicle({ preferDirection: playerVehicle?.facing });\r\n    playerVehicle = null;\r\n    inVehicle = false;\r\n  }\r\n\r\n  if (rollAttempted && stickman.health > 0 && !inVehicle) {\r\n    startRoll({ left: input.left, right: input.right });\r\n  }\r\n\r\n  if (!inVehicle && stickman.controlMode === \"vehicle\") {\r\n    stickman.controlMode = \"onFoot\";\r\n  }\r\n\r\n  const canAct = !inVehicle && stickman.stunTimer <= 0 && !stickman.reloading;\r\n\r\n  const attackRequested = canAct ? rawAttackRequested : false;\r\n  const throwRequested = canAct ? rawThrowRequested : false;\r\n  const reloadRequested = canAct ? rawReloadRequested : false;\r\n\r\n  if (stickman.health > 0) {\r\n    if (inVehicle) {\r\n      updatePlayerInVehicle();\r\n    } else {\r\n      updatePlayerAlive(delta);\r\n    }\r\n  } else {\r\n    updatePlayerDead(delta);\r\n  }\r\n\r\n  stickman.currentPose = determinePose();\r\n  const baseHeight = getTotalHeight(stickman.currentPose);\r\n\r\n  const remotePlayerCount = getRemotePlayers().length;\r\n  const aliveEnemies = enemies.reduce((count, enemy) => count + (enemy.health > 0 ? 1 : 0), 0);\r\n  const activeAllies = squadmates.reduce((count, ally) => count + (ally && ally.state !== \"defeated\" ? 1 : 0), 0);\r\n  setHostingMetrics({\r\n    playerCount: 1 + remotePlayerCount,\r\n    enemyCount: aliveEnemies,\r\n    alliesCount: activeAllies\r\n  });\r\n\r\n  const timestampNow = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n  updateVehicles(delta);\r\n  updateSupplyDrops(delta);\r\n  updateDestructibles(delta);\r\n  updateInteractables(delta);\r\n  updateEnemySpawner(delta);\r\n  updateServerBrowser(delta, timestampNow);\r\n  updateP2P(delta);\r\n  updateSquadmates(delta);\r\n  for (const ally of squadmates) {\r\n    if (!ally) {\r\n      continue;\r\n    }\r\n    ally.structureShieldTimer = Math.max(0, (ally.structureShieldTimer ?? 0) - delta);\r\n    if (ally.structureShieldTimer <= 0) {\r\n      ally.structureShieldStrength = 0;\r\n    }\r\n  }\r\n  playerVehicle = getPlayerVehicle();\r\n  inVehicle = Boolean(playerVehicle);\r\n  if (inVehicle) {\r\n    stickman.controlMode = \"vehicle\";\r\n  }\r\n\r\n  if (!canAct) {\r\n    stickman.attacking = false;\r\n    stickman.currentAttack = null;\r\n    stickman.attackElapsed = 0;\r\n    stickman.comboWindowOpen = false;\r\n    stickman.comboWindowTimer = 0;\r\n    stickman.nextAttackQueued = false;\r\n    stickman.hitboxSpawned = false;\r\n    stickman.attackIndex = -1;\r\n    stickman.activeHitboxes.length = 0;\r\n  }\r\n\r\n  const weapon = getCurrentWeapon();\r\n  const weaponCategory = weapon?.category ?? \"\";\r\n  const attackChain = weapon?.attackChain ?? [];\r\n  const hasMeleeChain = attackChain.length > 0;\r\n  const isRangedWeapon = weaponCategory.startsWith(\"ranged\");\r\n  const isThrowableWeapon = weaponCategory === \"throwable\";\r\n  const isGadgetWeapon = weaponCategory === \"gadget\";\r\n\r\n  if (isGadgetWeapon) {\r\n    if (attackRequested || throwRequested) {\r\n      deployGadget(weapon);\r\n    }\r\n    stickman.activeHitboxes.length = 0;\r\n  } else if (isThrowableWeapon) {\r\n    if (attackRequested || throwRequested) {\r\n      throwEquippedWeapon();\r\n    }\r\n    stickman.activeHitboxes.length = 0;\r\n  } else if (isRangedWeapon && !hasMeleeChain) {\r\n    stickman.activeHitboxes.length = 0;\r\n    if (weapon) {\r\n      const ammoStatus = getAmmoStatus(weapon.id);\r\n      if (reloadRequested) {\r\n        if (requestReload(weapon.id)) {\r\n          stickman.attacking = false;\r\n          stickman.currentAttack = null;\r\n          stickman.attackIndex = -1;\r\n        }\r\n      }\r\n      if (attackRequested) {\r\n        fireEquippedWeaponProjectile();\r\n      }\r\n      if (ammoStatus && ammoStatus.magazine <= 0 && ammoStatus.reserve > 0 && !ammoStatus.reloading) {\r\n        requestReload(weapon.id);\r\n      }\r\n    }\r\n  } else if (hasMeleeChain) {\r\n    if (attackRequested) {\r\n      attemptAttack();\r\n    }\r\n\r\n    if (stickman.attacking) {\r\n      advanceAttack(delta, spawnHitbox);\r\n    }\r\n\r\n    updateHitboxes(delta, baseHeight);\r\n    resolveHitDetection();\r\n  } else {\r\n    stickman.activeHitboxes.length = 0;\r\n    if (isRangedWeapon && attackRequested) {\r\n      fireEquippedWeaponProjectile();\r\n    }\r\n  }\r\n\r\n  setCameraTargetX(stickman.x);\r\n  updateCamera(delta);\r\n\r\n  updateTrainingDummy(delta);\r\n  updateThrowables(delta);\r\n  updateGadgets(delta);\r\n  updateGadgetMovement(delta);\r\n  updateAmmoTimers(delta, weapon?.id ?? null);\r\n  updateRecoil(delta);\r\n  updateDamagePopups(delta);\r\n  updateParticles(delta);\r\n  updateLighting(delta);\r\n  updatePolishDebug(delta);\r\n  updateProjectiles(delta);\r\n  updateRagdolls(delta, GROUND_Y);\r\n  updateEnemies(delta);\r\n}\r\n\r\nexport { updateGame };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { spawnRingBurst } from \"../effects/particles.js\";\r\nimport { GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { stickman } from \"../../state/entities.js\";\r\nimport { getResourceState, addMaterials } from \"../../state/resources.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst SALVAGE_GRAVITY = 520;\r\n\r\nfunction updateSalvagePickups(delta) {\r\n  const state = getResourceState();\r\n  for (let i = state.pickups.length - 1; i >= 0; i -= 1) {\r\n    const pickup = state.pickups[i];\r\n    if (!pickup) {\r\n      state.pickups.splice(i, 1);\r\n      continue;\r\n    }\r\n    pickup.ttl -= delta;\r\n    if (pickup.ttl <= 0) {\r\n      state.pickups.splice(i, 1);\r\n      continue;\r\n    }\r\n    pickup.vy = (pickup.vy ?? -80) + SALVAGE_GRAVITY * delta;\r\n    pickup.x += (pickup.vx ?? 0) * delta;\r\n    pickup.y += pickup.vy * delta;\r\n    if (pickup.y >= GROUND_Y - 12) {\r\n      pickup.y = GROUND_Y - 12;\r\n      pickup.vx = (pickup.vx ?? 0) * 0.65;\r\n      pickup.vy *= -0.35;\r\n    }\r\n    const dx = pickup.x - stickman.x;\r\n    const dy = pickup.y - (stickman.y + stickman.currentPose?.headRadius ?? 16);\r\n    const distance = Math.hypot(dx, dy);\r\n    if (distance < 38) {\r\n      addMaterials(pickup.amount ?? 5);\r\n      spawnRingBurst({\r\n        x: pickup.x,\r\n        y: pickup.y,\r\n        startRadius: 12,\r\n        endRadius: 46,\r\n        color: \"#a9ffd1\",\r\n        ttl: 0.28\r\n      });\r\n      state.pickups.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nexport { updateSalvagePickups };\r\n","import { trainingDummy } from \"../../state/entities.js\";\r\n\r\nfunction updateTrainingDummy(delta) {\r\n  if (trainingDummy.flashTimer > 0) {\r\n    trainingDummy.flashTimer = Math.max(0, trainingDummy.flashTimer - delta);\r\n  }\r\n\r\n  if (trainingDummy.shakeTimer > 0) {\r\n    trainingDummy.shakeTimer = Math.max(0, trainingDummy.shakeTimer - delta);\r\n  }\r\n\r\n  trainingDummy.shakeMagnitude = Math.max(0, trainingDummy.shakeMagnitude - delta * 20);\r\n\r\n  if (trainingDummy.health <= 0) {\r\n    trainingDummy.respawnTimer = Math.max(0, trainingDummy.respawnTimer - delta);\r\n    if (trainingDummy.respawnTimer === 0) {\r\n      trainingDummy.health = trainingDummy.maxHealth;\r\n      trainingDummy.flashTimer = 0;\r\n      trainingDummy.shakeTimer = 0;\r\n      trainingDummy.shakeMagnitude = 0;\r\n    }\r\n  }\r\n}\r\n\r\nexport { updateTrainingDummy };\r\n","import \"./styles.css\";\r\nimport { context } from \"./environment/canvas.js\";\r\nimport { getCamera } from \"./state/camera.js\";\r\nimport { initializeEnvironmentControls } from \"./state/environment.js\";\r\n\r\nimport { initializeInput } from \"./core/input/index.js\";\r\nimport { initializeWeaponControls } from \"./core/combat/weapons.js\";\r\nimport { initializePlaceholderAudio } from \"./core/audio/placeholder.js\";\r\nimport { initializeP2PNetworking } from \"./core/network/p2p.js\";\r\nimport { drawBackground, drawDestructibles, drawInteractables, drawVehicles, drawSupplyDrops, drawRemotePlayers, drawServerBrowser, drawSquadmates, drawStickman, drawHitboxes, drawTrainingDummy, drawEnemies, drawHud, drawProjectilesLayer, drawGadgetsLayer } from \"./core/render/index.js\";\r\nimport { drawDebugArena } from \"./core/world/arena.js\";\r\nimport { drawDamagePopups } from \"./core/effects/damage.js\";\r\nimport { drawLighting } from \"./core/effects/lighting.js\";\r\nimport { drawRagdolls } from \"./core/effects/ragdoll.js\";\r\nimport { updateGame } from \"./core/world/update.js\";\r\n\r\ninitializeInput();\r\ninitializeWeaponControls();\r\ninitializePlaceholderAudio();\r\ninitializeP2PNetworking();\r\ninitializeEnvironmentControls();\r\n\r\nlet lastTime = performance.now();\r\n\r\nfunction loop(timestamp) {\r\n  const delta = Math.min((timestamp - lastTime) / 1000, 0.1);\r\n  lastTime = timestamp;\r\n\r\n  updateGame(delta);\r\n\r\n  const camera = getCamera();\r\n  drawBackground(camera);\r\n\r\n  context.save();\r\n  context.translate(-camera.offsetX, 0);\r\n\r\n  drawDebugArena();\r\n  drawDestructibles();\r\n  drawInteractables();\r\n  drawVehicles();\r\n  drawSupplyDrops();\r\n  drawRemotePlayers();\r\n  drawSquadmates();\r\n  drawTrainingDummy();\r\n  drawEnemies();\r\n  drawGadgetsLayer();\r\n  drawRagdolls();\r\n  drawStickman();\r\n  drawHitboxes();\r\n  drawProjectilesLayer();\r\n  drawLighting();\r\n  drawDamagePopups();\r\n  context.restore();\r\n\r\n  drawHud();\r\n  drawServerBrowser();\r\n\r\n  window.requestAnimationFrame(loop);\r\n}\r\n\r\nwindow.requestAnimationFrame(loop);\r\n"],"names":["module","exports","styleElement","nonce","setAttribute","stylesInDOM","getIndexByIdentifier","identifier","result","i","length","modulesToDom","list","options","idCountMap","identifiers","item","id","base","count","concat","indexByIdentifier","obj","css","media","sourceMap","supports","layer","references","updater","addElementStyle","byIndex","splice","push","api","domAPI","update","newObj","remove","lastIdentifiers","newList","index","newLastIdentifiers","_i","_index","styleSheet","cssText","firstChild","removeChild","appendChild","document","createTextNode","cssWithMappingToString","toString","this","map","content","needLayer","join","modules","dedupe","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","___CSS_LOADER_EXPORT___","element","createElement","setAttributes","attributes","insert","memo","style","target","styleTarget","querySelector","window","HTMLIFrameElement","contentDocument","head","e","getTarget","Error","insertStyleElement","styleTagTransform","apply","parentNode","removeStyleElement","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","prop","prototype","hasOwnProperty","call","nc","locals","canvas","getElementById","getContext","GROUND_Y","height","levelWidth","width","baseGround","scaleX","value","scalePlatforms","platform","x","scaleWaterZones","zone","scaleDecor","decor","scaled","baseX","Array","isArray","points","point","scaleDestructibles","scaleInteractables","minX","maxX","scaleAmbientLights","light","radius","addCentralWater","zones","overrides","widthRatio","topOffset","depth","top","highlight","highlightColor","topColor","midColor","bottomColor","rippleColor","neoPlatforms","y","type","neoWaterZones","neoDecor","text","neoDestructibles","baseY","facing","neoInteractables","neoAmbientLights","intensity","color","smoothing","flicker","verdantPlatforms","verdantWater","verdantDecor","verdantDestructibles","templateOverrides","bodyColor","accentColor","stripeColor","damageHighlight","debrisColor","verdantInteractables","edgeColor","braceColor","glowColor","verdantAmbientLights","dunePlatforms","duneWater","duneDecor","duneDestructibles","glassColor","duneInteractables","duneAmbientLights","orbitalPlatforms","orbitalDecor","orbitalDestructibles","orbitalInteractables","orbitalAmbientLights","direction","fov","Math","PI","stretch","ENVIRONMENT_DEFINITIONS","neoDistrict","name","theme","background","gradientStops","offset","horizonBand","start","groundColor","silhouettes","platforms","waterZones","destructibles","interactables","ambientLights","spawn","player","trainingDummy","squadOffsets","enemies","verdantWilds","sunsetDunes","orbitalSpire","ENVIRONMENT_SEQUENCE","resourceState","materials","pickups","nextPickupId","getMaterialCount","addMaterials","amount","source","Number","isFinite","max","round","spawnSalvagePickup","vx","random","vy","ttl","pickup","maxTtl","collected","currentEnvironmentId","keys","listeners","Set","controlsInitialized","getEnvironmentDefinition","fallbackId","environment","getEnvironmentPlatforms","onEnvironmentChange","listener","add","immediate","delete","cameraState","targetX","getHalfViewWidth","clampCameraX","half","envWidth","min","resetCamera","input","seal","left","right","jump","down","roll","attackBuffered","throwBuffered","reloadBuffered","interactBuffered","attackDown","throwDown","squadCommandCycleBuffered","squadCommandSelect","serverBrowserToggleBuffered","serverBrowserNavigate","serverBrowserJoinBuffered","serverBrowserHostBuffered","serverBrowserStopHostBuffered","serverBrowserCopyOfferBuffered","serverBrowserPasteOfferBuffered","serverBrowserAcceptAnswerBuffered","serverBrowserCopyCandidatesBuffered","serverBrowserPasteCandidatesBuffered","buildToggleBuffered","buildCycleBuffered","buildConfirmBuffered","buildCancelBuffered","survivalToggleBuffered","initialized","handleKey","isDown","event","code","preventDefault","combatFists","description","category","attackChain","windup","active","recovery","comboStart","comboWindow","range","heightOffset","damage","knockback","launch","shockBaton","strikerPistol","projectile","speed","lifetime","gravityFactor","ammo","magazine","reserve","reloadSeconds","vectorSmg","recoil","horizontal","vertical","decay","spread","perShot","fragGrenade","throwable","fuseSeconds","explosionRadius","arcVelocity","bounciness","cooldownSeconds","explosionDuration","selfDamageScale","selfKnockbackScale","effectType","flashBang","stunDuration","playerStunDuration","smokeCanister","smokeDuration","smokeRadius","smokeExpansion","smokeSlowMultiplier","smokeTickDuration","turretDrone","gadget","duration","fireInterval","maxActive","spawnOffset","baseColor","headColor","grappleRig","maxLength","maxRise","travelSpeed","pullSpeed","thunderCannon","increase","shieldBubble","strength","DEFAULT_LOADOUT","SPEED","GRAVITY","standing","headRadius","bodyLength","legLength","armLength","strideMultiplier","armSwingAmplitude","legSwingAmplitude","crouching","rolling","SQUAD_COMMANDS","label","order","getTotalHeight","pose","createGruntEnemy","spawnX","spawnSettings","predefined","resolvedX","spawnY","enemyY","contextTag","context","autoRespawn","spawnSide","initialFacing","slice","onGround","state","stateTimer","patrolRange","aggressionRange","attackRange","moveSpeed","health","maxHealth","attackCooldown","attackWindup","attackActive","attackDamage","attackKnockback","attackLaunch","flashTimer","shakeTimer","shakeMagnitude","invulnerability","respawnTimer","stunTimer","smokeSlowTimer","smokeSlowStrength","spawnContext","createSquadmate","offsetX","fireCooldown","commandTimer","targetEnemyId","structureShieldTimer","structureShieldStrength","roleIndex","standingHeight","playerSpawnX","stickman","controlMode","vehicleId","vehicleCandidateId","squadCommandIndex","squadCommandId","squadCommandCooldown","rollTimer","currentPose","attacking","attackIndex","currentAttack","attackElapsed","attackInstanceId","comboWindowOpen","comboWindowTimer","nextAttackQueued","hitboxSpawned","activeHitboxes","deadTimer","throwCooldown","gadgetCooldown","reloading","flashBlindTimer","equippedWeaponId","squadmates","Map","getRemotePlayers","from","values","enemySpawnXs","forEach","enemy","initializeSandboxEnemy","playerX","poseHeight","playerY","offsets","ally","allyX","allyY","enemyXs","requiredSandbox","sandboxEnemies","filter","existingSides","indexOf","side","has","fallback","newEnemy","ensureSandboxEnemies","applyEnvironmentSpawn","weaponState","inventory","activeIndex","setActiveWeaponByIndex","isValidIndex","getWeaponInventory","ensureEquippedWeaponValid","existingIndex","ammoState","ensureAmmoEntry","weaponId","def","ammoDef","spreadDef","hasAmmo","capacity","POSITIVE_INFINITY","entry","current","reloadTimer","set","getAmmoStatus","startReload","refillWeaponAmmo","previousWeaponState","getCurrentWeapon","equipWeaponIndex","previousId","cancelReload","ammoStatus","audioContext","lastTriggers","EVENT_SOUND_MAP","frequency","gain","shape","cooldown","detail","ensureAudioContext","AudioCtor","AudioContext","webkitAudioContext","resumeAudio","resume","catch","primeAudioContext","removeEventListener","getP2P","P2P","error","peerId","peerConnection","outboundChannel","inboundChannel","lastSendTime","connectionStatus","localDescriptionString","localCandidates","ensurePeerConnection","RTCPeerConnection","iceServers","createDataChannel","ordered","setupDataChannel","addEventListener","candidate","connectionState","channel","payload","parse","now","performance","Date","existing","commandId","lastUpdate","upsertRemotePlayer","console","warn","getP2PStatus","status","localDescription","serverBrowserState","servers","visible","selectedIndex","lastFetch","fetching","statusMessage","hosting","hostingSessionId","hostingLastHeartbeat","hostingExpiresAt","joinStatus","joinError","hostingMetrics","playerCount","enemyCount","alliesCount","p2p","offer","answer","pendingOffer","pendingAnswer","pendingCandidates","remoteCandidates","getServerBrowserState","setVisible","setServers","previousSelection","matchedIndex","findIndex","server","setError","message","setStatusMessage","setJoinStatus","setJoinError","setJoinedSessionId","joinedSessionId","recordFetchTimestamp","timestamp","setFetching","setHostingSession","expiresAt","Boolean","clearHosting","clearP2PState","setHostingMetrics","metrics","setP2PAnswer","setP2PLocalCandidates","candidates","next","every","setP2PRemoteCandidates","setP2PError","setP2PPending","VEHICLE_DEFINITIONS","buggy","movementType","wheelRadius","wheelBase","driverSeat","exitOffsets","enterRadius","acceleration","braking","maxSpeed","idleDrag","airDrag","baseHealth","colorBody","colorAccent","colorDetail","raptorHeli","mountedWeapons","binding","muzzles","scatter","flashDuration","flashRadius","barrelLength","barrelWidth","barrelColor","horizontalAcceleration","horizontalMaxSpeed","horizontalDrag","liftPower","descendPower","gravityScale","maxVerticalSpeed","verticalDamping","hoverMinAltitude","hoverMaxAltitude","spawnHover","autopilotStrength","rotorSpan","rotorThickness","tailLength","arrowJet","wingSpan","tideSkiff","waterSurfaceOffset","waterAcceleration","waterMaxSpeed","waterReverseSpeed","waterIdleDrag","turnDrag","bobAmplitude","bobSpeed","buoyancyPoint","splashIntensity","stormBarge","abyssSub","submergedOffset","scoutDrone","vehicleCounter","createVehicle","centerX","waterLineY","preferredAltitude","hover","minAltitude","altitude","surfaceOffset","vehicle","tilt","driverId","enterCooldown","damageFlash","bobPhase","mounts","mountDef","muzzleIndex","lastMuzzleX","lastMuzzleY","vehicles","getVehicleById","find","elapsed","getElapsedTime","survivalState","stage","timer","wave","enemiesAlive","lastReward","setSurvivalStage","setSurvivalLastReward","getSurvivalState","RAGDOLL_BLUEPRINTS","offsetY","ragdolls","spawnRagdoll","kind","originX","originY","baseVx","baseVy","blueprint","part","life","maxLife","damagePopups","spawnDamagePopup","turrets","acquireTarget","turret","targets","ref","getTargets","closest","closestDistSq","Infinity","dx","dy","distSq","fireTurret","sign","distance","hypot","spawnProjectile","fireTimer","grappleState","tetherLength","targetY","retracting","endGrapple","shieldState","maxStrength","maxDuration","getShieldCenter","dispatchShieldEvent","dispatchEvent","CustomEvent","deactivateShield","reason","remainingStrength","center","deployGadget","weapon","gadgetConfig","config","baseHeight","spawnYBase","createTurret","shift","deployTurret","clampRect","clamp","apex","launchLength","anchorX","anchorY","startGrapple","activateShield","applyDamageToDummy","hit","popupY","applyDamageToEnemy","killReward","applyDamageToPlayer","baseDamage","baseKnockback","baseLaunch","adjustedHit","absorb","residualDamage","absorbShieldHit","finalDamage","finalKnockback","finalLaunch","finalFacing","shieldReduction","DESTRUCTIBLE_TEMPLATES","concreteBarrier","rubbleHeight","material","shakeFactor","salvage","streetCar","deathBlast","maxDamage","minDamageRatio","fuelBarrelCluster","timberWall","sandbagLine","roverWreck","plasmaCell","createInitialState","getEnvironmentDestructibleSpawns","baseTemplate","template","halfWidth","destructible","destroyed","smokeTimer","rubbleLevel","deathTriggered","spawnConfig","assign","createDestructibleFromSpawn","fresh","resetDestructibles","particles","rings","listenersAttached","spawnRingBurst","ring","startRadius","endRadius","lineWidth","spawnShieldRing","spawnShieldHitParticles","angle","cos","sin","ensureListeners","spawnMuzzleParticles","spawnShieldShatter","spawnExplosionParticles","spawnFlashBurst","spawnSmokePuffs","spawnSmokeDissipateRing","paletteMap","concrete","volatile","generic","palette","baseSpeed","spawnDestructibleHitParticles","maxRadius","computeExplosionFalloff","minRatio","falloff","applyExplosionImpulse","maxKnockback","includeTrainingDummy","includeEnemies","includePlayer","summary","dummyHit","enemiesHit","playerHit","damageCap","knockbackCap","radiusSafe","dummyX","dummyY","ratio","enemyX","playerHeight","playerCenterY","getBounds","bottom","circleIntersectsDestructible","distanceToDestructible","damageDestructible","applied","appliedDamage","baseShake","cause","impactX","impactY","spawnDamageEffects","centerY","blast","damageDestructiblesInRadius","sourceId","salvageAmount","chunks","amountPer","triggerDestructibleDeath","damageMax","hits","handleProjectileCollision","handleHitboxCollision","hitbox","hitTargets","BUILDING_DEFINITIONS","barricade","cost","strokeColor","blocking","watchtower","shieldEmitter","shield","damageReduction","buffDuration","ambient","shockTrap","trap","stun","structures","buildState","blueprintIndex","lastPreview","valid","getBuildingDefinitions","defs","resetStructures","persistentLights","transientLights","environmentAmbientLights","getEnvironmentAmbientLights","clampIntensity","rgba","alpha","r","g","b","trimmed","trim","startsWith","hex","split","char","numeric","parseInt","isNaN","match","parseColor","setPersistentLight","props","targetIntensity","spawnDynamicLight","isLightVisible","drawPointLight","gradient","createRadialGradient","addColorStop","fillStyle","beginPath","arc","fill","drawConeLight","save","translate","rotate","scale","halfFov","moveTo","closePath","restore","clear","projectiles","lightCooldown","circleOverlap","ax","ay","ar","bx","by","br","radii","throwables","smokeClouds","dispatchThrowableEvent","detonate","grenade","detonated","explosionTimer","fuse","baseDetail","applyFlashEffect","cloud","baseRadius","slowMultiplier","tick","tickTimer","spawnSmokeCloud","cloudId","damageFalloff","destructibleFalloff","speedBase","offsetRadius","spawnExplosionDebris","applyExplosiveDamage","SUPPLY_DROP_TYPES","weight","crateColor","materialsReward","medkit","heavy","supplyDrops","manager","nextDropTimer","nextDropTypeId","chooseWeightedType","incomingMessage","incomingTimer","incomingDuration","rewardMessage","rewardTimer","rewardDuration","dropSequence","entries","totalWeight","reduce","sum","applySupplyDropReward","typeId","heavyType","autoEquip","addWeaponToInventory","applyHeavyWeaponReward","applyAmmoReward","rewardType","immediateGain","updateHighlight","drop","delta","POSES","playerFeetY","pickupDrop","despawnTimer","rewardMaterials","salvagePortion","jitter","updateSupplyDrops","getEnvironmentWidth","clampedWidth","parachutePhase","spawnSupplyDrop","drawCrate","baseAlpha","globalAlpha","parachuteWidth","canopyHeight","quadraticCurveTo","strokeStyle","lineTo","stroke","highlightAlpha","fillRect","strokeRect","drawDestructible","shakeMag","wobblePhase","shakeX","shakeY","progress","drawRubble","damageRatio","windowColor","bodyTop","cabinHeight","windowHeight","drawStreetCar","barrelRadius","barrelHeight","positions","visibleCount","pos","ellipse","abs","toFixed","drawBarrelCluster","crackColor","crackCount","floor","phase","startX","crackHeight","wobble","drawBarrierBody","healthRatio","yOffset","clamped","barWidth","drawHealthTick","lifeRatio","drawSmokeColumn","rawX","clampedX","groundY","bestY","getGroundYAt","blueprintId","placeStructure","preview","canAfford","spendMaterials","structure","trapCooldown","createStructureFromBlueprint","addStructure","toggleBuildMode","forceState","damageStructure","destroyStructure","updateTurret","bestEnemy","bestDist","muzzleY","applyShieldField","emitY","actors","actor","updateTrap","triggered","updateStructureCollisions","topY","horizontalOverlap","verticalOverlap","updateBuildingSystem","clampBlueprintIndex","cycleBlueprint","handleBuildInputs","updateStructures","updateSurvival","removeSandboxEnemies","alive","spawnPoints","resolveSpawnPoints","spawned","sideIndex","hasAlive","some","spawnEnemies","reward","INTERACTABLE_TEMPLATES","pushCrate","mass","friction","pushImpulse","hitImpulse","kickBarrel","getEnvironmentInteractableSpawns","interactable","initialState","createInteractableFromSpawn","drawInteractable","sway","braceInset","drawBarrel","glow","accent","body","pulse","drawTrap","flash","templateHighlight","resetInteractables","muzzleFlashes","shieldBursts","throwableBursts","notices","shotIndicators","filters","weapons","FILTER_TOGGLE_MAP","Digit6","Digit7","Digit8","pushNotice","last","age","pushThrowableBurst","burst","shouldCapture","handleFilterToggle","altKey","repeat","charAt","toUpperCase","toggleFilter","handleMuzzleFlash","handleShotFired","handleReloadStart","handleReloadFinish","handleRecoilKick","magnitude","handleEnvironmentChanged","env","handleShieldHit","handleShieldShatter","handleShieldEnd","handleThrowableThrown","handleThrowableExplosion","handleThrowableFlashBurst","String","handleThrowableSmokeDetonate","EPSILON","handleThrowableSmokeDissipate","listenersRegistered","updateList","getPolishDebugState","recoilState","horizontalKick","verticalKick","lastShotTime","resolvePlatformLanding","entity","previousY","prevFeet","nextFeet","PLATFORM_STYLES","street","metro","rooftop","skybridge","terrace","balcony","median","jungleFloor","stone","canopy","branch","sand","cliff","plateau","deck","catwalk","maglev","plain","drawPlatform","drawBuilding","floors","f","drawPalm","drawRuin","bricks","setLineDash","drawVineArch","drawGlowPlant","drawWaterfall","createLinearGradient","drawDune","drawRockSpire","drawCampfire","drawAntenna","drawSpire","drawHoloBillboard","font","textAlign","fillText","drawEnergyCoil","drawHovercar","getActiveCommand","findNearestEnemy","best","dist","steerTowards","speedFactor","desired","dir","fireAtTarget","updateSquadmate","squadmate","command","updateMovement","getSquadStatus","members","PLAYER_DRIVER_ID","getPlayerVehicle","applyIdleDrag","dragAmount","drag","syncStickmanWithVehicle","seat","seatWorldX","seatWorldY","exitVehicle","skipCooldown","preferRight","preferDirection","fallbackOffset","chosenOffset","inheritVelocity","updateGroundVehicle","isControlled","accelerateRight","accelerateLeft","brake","applyGroundDriverInput","pow","groundTop","targetTilt","updateWaterVehicle","reverseSpeed","brakeStrength","waterSurface","steerRight","steerLeft","bobOffset","sprayOffset","tiltTarget","updateAirVehicle","maxAltitude","altitudeRate","gravity","altitudeError","newAltitude","fireMountedWeaponProjectile","mountState","facingSign","followFacing","followVehicleFacing","vehicleFacing","appliedFacing","facingMultiplier","muzzle","muzzleX","projectileDef","scatterRadians","spreadAngle","facingSignValue","verticalSpeed","updateMountedWeaponsForVehicle","mountDefs","wantsPrimary","wantsSecondary","shouldFire","autoFire","drawHud","currentWeapon","weaponName","weaponSlots","recoilOffset","overlayAlpha","weaponHudX","weaponHudY","isInfinite","ammoLabel","gadgetStatus","turretCount","grappleActive","shieldActive","shieldStrength","shieldMaxStrength","getGadgetStatus","ready","gadgetLabel","cooldownLabel","comboText","hudY","survivalHud","getSurvivalHudStatus","waveNumber","infoY","buildingHud","resources","blueprintName","getBuildingHudStatus","playerVehicle","vehicleDefinition","vehicleLabel","mount","bindingLabel","toLowerCase","mountLabel","candidateDefinition","candidateLabel","candidateWeapons","supplyStatus","timeUntilNext","nextDropLabel","incomingAlpha","rewardAlpha","activeCount","eta","squadStatus","maxShown","member","p2pStatus","recoilLabel","aliveEnemies","slotLabel","nextHudY","maxShield","shieldValue","ceil","debugState","activeNotices","reverse","rightMargin","debugY","notice","filterLines","line","drawProjectilesLayer","drawProjectiles","flashAlpha","puffRadius","puffAlpha","outerRadius","ringAlpha","coreAlpha","fuseRatio","maxFuse","sparkOffsetX","sparkOffsetY","drawSmokeClouds","drawThrowables","particle","sizeFactor","drawParticles","drawPolishDebugEffects","startAttack","attack","getActorProfile","applyPushFromActor","actorProfile","actorFeet","interactHalf","impulseBase","isPlayer","appliedImpulse","targetActorX","updateInteractable","playerFeet","verticalGap","horizGap","highlightTarget","effectiveHalf","detectionRadius","profile","feet","frictionStrength","deltaValue","envWidthLimits","mid","handleInteractableHitboxCollision","impulse","spawnHitbox","remaining","ownerFacing","fireEquippedWeaponProjectile","consumeAmmo","projectileConfig","initialVy","finalAngle","atan2","spreadState","effectiveDegrees","radians","registerShot","kick","updateEnemyAI","distanceX","absDistance","stunned","effectiveAggression","shouldChase","chaseDir","updateEnemyAttacks","attackReach","lastHostCandidatePushAt","lastJoinCandidatePushAt","lastSentHostCandidates","lastSentJoinCandidates","pendingHostCandidateTimeout","pendingJoinCandidateTimeout","pendingJoinCandidatePayload","getApiBase","replace","getSessionId","crypto","randomUUID","sanitizeSignal","raw","async","copyToClipboard","navigator","clipboard","writeText","normalizeCandidateList","normalizeCandidate","arraysEqual","mapServerEntry","metadata","players","maxPlayers","region","mode","updatedAt","signal","hostOffer","hostCandidates","joinAnswer","joinCandidates","cacheUpdatedSession","mapped","resetCandidateTracking","clearTimeout","pushHostCandidatesNow","heartbeatSession","pushJoinerCandidatesNow","sessionId","apiBase","response","fetch","method","headers","ok","json","session","applyRemoteCandidates","postJoinerUpdate","signalCandidates","handleLocalCandidateUpdate","delay","setTimeout","scheduleHostCandidatePush","scheduleJoinerCandidatePush","syncLocalCandidates","getLocalCandidates","previous","normalized","copyLocalCandidates","silent","copied","promptForRemoteCandidates","prompt","rawInput","sanitized","parsed","segment","parseCandidateInput","getP2POrThrow","addRemoteCandidate","merged","incoming","seen","unique","mergeCandidates","buildHostingMetadata","fallbackPlayerCount","fetchServerList","Accept","mappedServers","staleThresholdMs","filteredServers","updatedAtMs","hostSession","secret","computedPlayerCount","effectiveSignal","ttlSeconds","stopHosting","joinServer","serverId","url","joinedName","ensureHostOffer","forceRegenerate","createOffer","setP2POffer","copyHostOffer","acceptHostOffer","rawOffer","autoCopyAnswer","offerString","normalizedOffer","createAnswer","applyJoinerAnswer","rawAnswer","answerString","normalizedAnswer","acceptRemoteDescription","updated","pumpSignalUpdates","joinedSession","promptForHostOffer","promptForJoinerAnswer","attemptHostSession","Promise","resolve","alreadyHosting","then","attemptStopHosting","alreadyStopped","attemptJoinSession","directSignal","debug","notFound","fetchSessionDetail","refreshed","refreshedSignal","updatedEntry","resolveSignal","resolvedServer","signalAnswer","reject","clampPlayerX","updateGame","advanceTime","updateSalvagePickups","interactRequested","squadCycleRequested","squadSelectRequested","serverBrowserToggleRequested","serverBrowserJoinRequested","serverBrowserHostRequested","serverBrowserStopRequested","serverBrowserCopyOfferRequested","serverBrowserPasteOfferRequested","serverBrowserAcceptAnswerRequested","serverBrowserCopyCandidatesRequested","serverBrowserPasteCandidatesRequested","rawAttackRequested","rawThrowRequested","rawReloadRequested","rollAttempted","bestVehicle","bestScore","vehicleFeet","verticalAllowance","score","enterVehicle","handleVehicleInteraction","cycleSquadCommand","setSquadCommandById","selectedServer","inVehicle","forcePlayerExitVehicle","startRoll","canAct","attackRequested","throwRequested","reloadRequested","updatePlayerInVehicle","slowFactor","canJump","updatePlayerAlive","updatePlayerDead","timestampNow","updateVehicles","updateDestructibles","updateInteractables","backgroundInterval","refreshInterval","interval","updateServerBrowser","maxAgeMs","pruneRemotePlayers","readyState","send","updateP2P","updateSquadmates","weaponCategory","hasMeleeChain","isRangedWeapon","isThrowableWeapon","throwEquippedWeapon","attemptAttack","spawnHitboxFn","nextIndex","shouldChain","advanceAttack","updateHitboxes","resolveHitDetection","t","updateCamera","updateTrainingDummy","effectiveRadius","pdx","pdy","dissipated","updateSmokeClouds","updateThrowables","updateTurrets","updateShield","updateGadgets","progressSpeed","step","updateGrapple","updateGrappleState","updateGadgetMovement","activeWeaponId","completedReloads","needed","loaded","updateAmmoTimers","decayRate","decayFactor","updateRecoil","popup","updateDamagePopups","p","updateParticles","anchors","anchor","updateEnvironmentLights","playerFacing","baseIntensity","updateFlashlights","structureLights","lerp","updateLighting","updatePolishDebug","tracerRadius","updateProjectiles","piece","updateRagdolls","updateEnemies","ServerBrowser","host","stop","attemptHost","attemptStop","attemptJoin","copyOffer","regenerateOffer","promptOffer","promptAnswer","copyCandidates","promptCandidates","syncCandidates","button","slot","NaN","eventName","ctx","osc","createOscillator","baseFrequency","setValueAtTime","currentTime","gainNode","createGain","baseGain","rampDuration","exponentialRampToValueAtTime","connect","destination","scheduleTone","setLocalDescription","remoteDescriptionString","setRemoteDescription","RTCSessionDescription","candidateString","RTCIceCandidate","addIceCandidate","getLocalDescription","getStatus","close","environmentId","notifyListeners","cycleEnvironment","lastTime","requestAnimationFrame","loop","camera","getCamera","skyGradient","silhouette","horizon","band","sunX","sun","sunY","sunRadius","sunGradient","jitterX","jitterY","mistStart","mistGradient","drawBackground","getEnvironmentWaterZones","waveY","drawWaterBodies","decorItems","getEnvironmentDecor","drawDecor","drawDebugArena","items","drawDestructibles","drawInteractables","candidateId","isPlayerVehicle","isCandidate","bodyWidth","bodyHeight","drawVehicles","drops","typeDef","drawSupplyDrops","remote","headCenterY","neckY","torsoBottomY","legReach","leftFootY","rightFootY","drawRemotePlayers","commandColors","hold","defend","flank","outline","lineCap","drawSquadmates","dummy","shake","armY","barX","barY","drawTrainingDummy","barHeight","drawEnemies","drawShield","baseWidth","remainingRatio","headHeight","drawTurrets","currentX","currentY","drawGrapple","drawRagdolls","strideStrength","swing","totalDuration","phaseOffset","legSwingBase","drawStickman","drawHitboxes","size","globalCompositeOperation","drawLighting","opacity","drawDamagePopups","panelHeight","panelWidth","statusY","listTop","listBottom","maxRows","rowsToDraw","rowY","rowHeight","details","snippet","limit","p2pY","candidateSummary","lastLocalLabel","lastRemoteLabel","drawServerBrowser"],"sourceRoot":""}