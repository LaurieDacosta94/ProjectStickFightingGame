{"version":3,"file":"bundle.411e286a61d9d8c04202.js","mappings":"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AElB,SAASC,EAAUC,EAAQC,GACzB,OAAQA,EAAMC,MACZ,IAAK,YACL,IAAK,OACH7B,EAAME,KAAOyB,EACbC,EAAME,iBACN,MACF,IAAK,aACL,IAAK,OACH9B,EAAMG,MAAQwB,EACdC,EAAME,iBACN,MACF,IAAK,UACL,IAAK,OACL,IAAK,QACH9B,EAAMI,KAAOuB,EACbC,EAAME,iBACN,MACF,IAAK,YACL,IAAK,OACH9B,EAAMK,KAAOsB,EACbC,EAAME,iBACN,MACF,IAAK,YACL,IAAK,aACCH,IACF3B,EAAMM,MAAO,EACbsB,EAAME,kBAER,MACF,IAAK,OACL,IAAK,OACCH,GACF3B,EAAMO,gBAAiB,EACvBP,EAAMW,YAAa,EACnBiB,EAAME,mBAEN9B,EAAMW,YAAa,EACnBiB,EAAME,kBAER,MACF,IAAK,OACCH,GACF3B,EAAMQ,eAAgB,EACtBR,EAAMY,WAAY,EAClBgB,EAAME,mBAEN9B,EAAMY,WAAY,EAClBgB,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMS,gBAAiB,EACvBmB,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMU,kBAAmB,EACzBkB,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMa,2BAA4B,EAClCe,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMc,mBAAqB,OAC3Bc,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMc,mBAAqB,SAC3Bc,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMc,mBAAqB,SAC3Bc,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMc,mBAAqB,QAC3Bc,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMe,6BAA8B,EACpCa,EAAME,kBAER,MACF,IAAK,cACCH,IACF3B,EAAMgB,uBAAyB,EAC/BY,EAAME,kBAER,MACF,IAAK,eAML,IAAK,QACCH,IACF3B,EAAMgB,sBAAwB,EAC9BY,EAAME,kBAER,MACF,IAAK,QACCH,IACF3B,EAAMiB,2BAA4B,EAClCW,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMkB,2BAA4B,EAClCU,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMmB,+BAAgC,EACtCS,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMoB,gCAAiC,EACvCQ,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMqB,iCAAkC,EACxCO,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMsB,mCAAoC,EAC1CM,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMuB,qCAAsC,EAC5CK,EAAME,kBAER,MACF,IAAK,OACCH,IACF3B,EAAMwB,sCAAuC,EAC7CI,EAAME,kBAMd,CCpMA,MAAM,EAAqB,CACzBC,YAAa,CACXtI,GAAI,cACJuI,KAAM,eACNC,YAAa,+DACbC,SAAU,cACVC,YAAa,CACX,CACEH,KAAM,YACNI,OAAQ,IACRC,OAAQ,IACRC,SAAU,IACVC,WAAY,IACZC,YAAa,IACbC,MAAO,GACPC,cAAe,GACfC,OAAQ,GACRC,OAAQ,EACRC,UAAW,IACXC,OAAQ,GAEV,CACEd,KAAM,eACNI,OAAQ,IACRC,OAAQ,IACRC,SAAU,IACVC,WAAY,IACZC,YAAa,GACbC,MAAO,GACPC,cAAe,GACfC,OAAQ,GACRC,OAAQ,GACRC,UAAW,IACXC,OAAQ,GAEV,CACEd,KAAM,cACNI,OAAQ,GACRC,OAAQ,IACRC,SAAU,IACVC,WAAY,IACZC,YAAa,GACbC,MAAO,GACPC,cAAe,GACfC,OAAQ,GACRC,OAAQ,GACRC,UAAW,IACXC,OAAQ,OAIdC,WAAY,CACVtJ,GAAI,aACJuI,KAAM,cACNC,YAAa,8DACbC,SAAU,YACVC,YAAa,CACX,CACEH,KAAM,YACNI,OAAQ,IACRC,OAAQ,IACRC,SAAU,IACVC,WAAY,IACZC,YAAa,IACbC,MAAO,GACPC,cAAe,GACfC,OAAQ,GACRC,OAAQ,EACRC,UAAW,GACXC,OAAQ,GAEV,CACEd,KAAM,cACNI,OAAQ,GACRC,OAAQ,IACRC,SAAU,GACVC,WAAY,GACZC,YAAa,IACbC,MAAO,GACPC,cAAe,GACfC,OAAQ,GACRC,OAAQ,GACRC,UAAW,IACXC,OAAQ,IAEV,CACEd,KAAM,YACNI,OAAQ,IACRC,OAAQ,GACRC,SAAU,IACVC,WAAY,IACZC,YAAa,GACbC,MAAO,GACPC,cAAe,GACfC,OAAQ,GACRC,OAAQ,GACRC,UAAW,IACXC,OAAQ,OAIdE,cAAe,CACbvJ,GAAI,gBACJuI,KAAM,iBACNC,YAAa,8DACbC,SAAU,eACVC,YAAa,GACbc,WAAY,CACVN,OAAQ,EACRO,MAAO,IACPN,OAAQ,GACRC,UAAW,GACXM,SAAU,GACVC,cAAe,IACfC,MAAO,WAETC,KAAM,CACJC,SAAU,GACVC,QAAS,GACTC,cAAe,MAGnBC,UAAW,CACTjK,GAAI,YACJuI,KAAM,aACNC,YAAa,oDACbC,SAAU,aACVC,YAAa,GACbc,WAAY,CACVN,OAAQ,EACRO,MAAO,IACPN,OAAQ,GACRC,UAAW,GACXM,SAAU,IACVC,cAAe,IACfC,MAAO,WAETC,KAAM,CACJC,SAAU,GACVC,QAAS,IACTC,cAAe,KAEjBE,OAAQ,CACNC,WAAY,GACZC,SAAU,IACVC,MAAO,IAETC,OAAQ,CACNrK,KAAM,IACNsK,QAAS,GACTC,IAAK,IACL3B,SAAU,MAGd4B,YAAa,CACXzK,GAAI,cACJuI,KAAM,eACNC,YAAa,8DACbC,SAAU,YACVC,YAAa,GACbgC,UAAW,CACTC,YAAa,IACbC,gBAAiB,IACjBzB,OAAQ,GACRC,UAAW,IACXyB,YAAa,CAAEC,GAAI,IAAKC,IAAK,KAC7BpB,cAAe,GACfqB,WAAY,IACZpB,MAAO,UACPV,OAAQ,GACR+B,gBAAiB,KACjBC,kBAAmB,IACnBC,gBAAiB,IACjBC,mBAAoB,GACpBC,WAAY,cAGhBC,UAAW,CACTtL,GAAI,YACJuI,KAAM,YACNC,YAAa,6DACbC,SAAU,YACVC,YAAa,GACbgC,UAAW,CACTC,YAAa,IACbC,gBAAiB,IACjBzB,OAAQ,EACRC,UAAW,EACXyB,YAAa,CAAEC,GAAI,IAAKC,IAAK,KAC7BpB,cAAe,IACfqB,WAAY,GACZpB,MAAO,UACPV,OAAQ,GACR+B,gBAAiB,IACjBC,kBAAmB,IACnBG,WAAY,QACZE,aAAc,IACdC,mBAAoB,KAGxBC,cAAe,CACbzL,GAAI,gBACJuI,KAAM,iBACNC,YAAa,iEACbC,SAAU,YACVC,YAAa,GACbgC,UAAW,CACTC,YAAa,GACbC,gBAAiB,GACjBzB,OAAQ,EACRC,UAAW,EACXyB,YAAa,CAAEC,GAAI,IAAKC,IAAK,KAC7BpB,cAAe,IACfqB,WAAY,IACZpB,MAAO,UACPV,OAAQ,GACR+B,gBAAiB,IACjBC,kBAAmB,GACnBG,WAAY,QACZK,cAAe,IACfC,YAAa,IACbC,eAAgB,KAChBC,oBAAqB,IACrBC,kBAAmB,MAGvBC,YAAa,CACX/L,GAAI,cACJuI,KAAM,oBACNC,YAAa,2EACbC,SAAU,SACVC,YAAa,GACbsD,OAAQ,CACNC,KAAM,SACNhB,gBAAiB,IACjBiB,SAAU,IACVlD,MAAO,IACPmD,aAAc,IACdC,UAAW,EACXC,OAAQ,GACRC,YAAa,CAAEC,EAAG,GAAIC,EAAG,GACzBC,UAAW,UACXC,UAAW,UACXlD,WAAY,CACVC,MAAO,IACPP,OAAQ,EACRC,OAAQ,EACRC,UAAW,GACXM,SAAU,IACVE,MAAO,aAIb+C,WAAY,CACV3M,GAAI,aACJuI,KAAM,cACNC,YAAa,wEACbC,SAAU,SACVC,YAAa,GACbsD,OAAQ,CACNC,KAAM,UACNhB,gBAAiB,IACjBiB,SAAU,GACVU,UAAW,IACXC,QAAS,IACTC,YAAa,IACbC,UAAW,IACXnD,MAAO,YAGXoD,cAAe,CACbhN,GAAI,gBACJuI,KAAM,iBACNC,YAAa,+DACbC,SAAU,eACVC,YAAa,GACbc,WAAY,CACVN,OAAQ,GACRO,MAAO,IACPN,OAAQ,GACRC,UAAW,IACXM,SAAU,IACVC,cAAe,IACfC,MAAO,WAETC,KAAM,CACJC,SAAU,EACVC,QAAS,GACTC,cAAe,KAEjBE,OAAQ,CACNC,WAAY,IACZC,SAAU,IACVvB,SAAU,KAEZyB,OAAQ,CACNrK,KAAM,IACNuK,IAAK,EACLyC,SAAU,IACVpE,SAAU,MAGdqE,aAAc,CACZlN,GAAI,eACJuI,KAAM,gBACNC,YAAa,yEACbC,SAAU,SACVC,YAAa,GACbsD,OAAQ,CACNC,KAAM,SACNhB,gBAAiB,IACjBiB,SAAU,EACViB,SAAU,GACVjE,OAAQ,GACRU,MAAO,aAKPwD,EAAkB,CAAC,cAAe,aAAc,gBAAiB,cAAe,YAAa,gBAAiB,cAAe,aAAc,gBC/T3IC,EAASpL,SAASqL,eAAe,eACjCC,EAAUF,EAAOG,WAAW,MAElC,IAAKD,EACH,MAAM,IAAI7I,MAAM,oCAGlB,MAAM+I,EAAWJ,EAAOhB,OAAS,GCJ3BqB,EAAQ,IAIRC,EAAU,KAEV,EAAQ,CACZC,SAAU,CACRC,WAAY,GACZC,WAAY,GACZC,UAAW,GACXC,UAAW,GACXC,iBAAkB,EAClBC,kBAAmB,GACnBC,kBAAmB,IAErBC,UAAW,CACTP,WAAY,GACZC,WAAY,GACZC,UAAW,GACXC,UAAW,GACXC,iBAAkB,GAClBC,kBAAmB,EACnBC,kBAAmB,GAErBE,QAAS,CACPR,WAAY,GACZC,WAAY,GACZC,UAAW,GACXC,UAAW,GACXC,iBAAkB,EAClBC,kBAAmB,EACnBC,kBAAmB,IAIjBG,EAAkB,CACtB,CAAE/B,GAAI,IAAKC,EAAGiB,EAAW,GAAIc,MAAO,IAAKlC,OAAQ,GAAIJ,KAAM,UAC3D,CAAEM,EAAG,IAAKC,EAAGiB,EAAW,GAAIc,MAAO,IAAKlC,OAAQ,GAAIJ,KAAM,UAC1D,CAAEM,EAAG,IAAKC,EAAGiB,EAAW,GAAIc,MAAO,IAAKlC,OAAQ,GAAIJ,KAAM,UAC1D,CAAEM,EAAG,KAAMC,EAAGiB,EAAW,GAAIc,MAAO,IAAKlC,OAAQ,GAAIJ,KAAM,UAC3D,CAAEM,EAAG,GAAIC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,GAAIJ,KAAM,SAC1D,CAAEM,EAAG,IAAKC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,GAAIJ,KAAM,WAC3D,CAAEM,EAAG,IAAKC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,GAAIJ,KAAM,aAC3D,CAAEM,EAAG,IAAKC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,GAAIJ,KAAM,WAC3D,CAAEM,EAAG,KAAMC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,GAAIJ,KAAM,WAC5D,CAAEM,EAAG,KAAMC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,GAAIJ,KAAM,WAC5D,CAAEM,EAAG,IAAKC,EAAGiB,EAAW,GAAIc,MAAO,IAAKlC,OAAQ,GAAIJ,KAAM,UAC1D,CAAEM,EAAG,IAAKC,EAAGiB,EAAW,GAAIc,MAAO,IAAKlC,OAAQ,GAAIJ,KAAM,WAGtDuC,EAAoB,CACxB,CAAEjC,EAAG,IAAKgC,MAAO,IAAKE,IAAKhB,EAAW,GAAIiB,MAAO,KAG7CC,EAAc,CAClB,CAAE1C,KAAM,WAAYM,GAAI,IAAKC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,KACpE,CAAEJ,KAAM,WAAYM,EAAG,IAAKC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,KACnE,CAAEJ,KAAM,WAAYM,EAAG,IAAKC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,KACnE,CAAEJ,KAAM,WAAYM,EAAG,IAAKC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,KACnE,CAAEJ,KAAM,WAAYM,EAAG,KAAMC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,KACpE,CAAEJ,KAAM,WAAYM,EAAG,KAAMC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,KACpE,CAAEJ,KAAM,YAAaM,EAAG,IAAKC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,GAAIuC,KAAM,gBAC9E,CAAE3C,KAAM,YAAaM,EAAG,KAAMC,EAAGiB,EAAW,IAAKc,MAAO,IAAKlC,OAAQ,GAAIuC,KAAM,UAC/E,CAAE3C,KAAM,cAAeM,EAAG,IAAKC,EAAGiB,EAAW,KAC7C,CAAExB,KAAM,cAAeM,EAAG,IAAKC,EAAGiB,EAAW,KAC7C,CAAExB,KAAM,cAAeM,EAAG,KAAMC,EAAGiB,EAAW,KAC9C,CAAExB,KAAM,WAAYM,EAAG,IAAKC,EAAGiB,EAAW,KAC1C,CAAExB,KAAM,WAAYM,EAAG,KAAMC,EAAGiB,EAAW,MCvEvCoB,EAAiB,CACrB,CACE7O,GAAI,OACJ8O,MAAO,OACPtG,YAAa,iCACbuG,MAAO,GAET,CACE/O,GAAI,SACJ8O,MAAO,SACPtG,YAAa,iDACbuG,MAAO,GAET,CACE/O,GAAI,SACJ8O,MAAO,SACPtG,YAAa,4CACbuG,MAAO,GAET,CACE/O,GAAI,QACJ8O,MAAO,QACPtG,YAAa,mDACbuG,MAAO,ICnBX,SAASC,EAAeC,GACtB,OAAyB,EAAlBA,EAAKpB,WAAiBoB,EAAKnB,WAAamB,EAAKlB,SACtD,CAEA,SAASmB,EAAiBC,EAAwB,IAAf9B,EAAOkB,OACxC,MAAMa,EAAS3B,EAAW,IAC1B,MAAO,CACLzN,GAAI,SAASqP,KAAKC,SAASlN,SAAS,IAAImN,MAAM,EAAG,KACjDJ,SACAC,SACA7C,EAAG4C,EACH3C,EAAG4C,EACHtE,GAAI,EACJC,GAAI,EACJ7B,OAAQ,GACRmD,OAAQ,IACRmD,OAAQ,EACRC,UAAU,EACVC,MAAO,SACPC,WAAY,EAAIN,KAAKC,SACrBM,YAAa,CAAEC,IAAKV,EAAS,IAAK3E,IAAK2E,EAAS,KAChDW,gBAAiB,IACjBC,YAAa,GACbC,UAAW,IACXC,OAAQ,IACRC,UAAW,IACXC,eAAgB,EAChBC,aAAc,EACdC,aAAc,EACdC,aAAc,GACdC,gBAAiB,IACjBC,cAAe,GACfC,WAAY,EACZC,WAAY,EACZC,eAAgB,EAChBC,gBAAiB,EACjBC,aAAc,EACdC,UAAW,EACXC,eAAgB,EAChBC,kBAAmB,EAEvB,CAGA,SAASC,EAAgBC,EAAU,EAAG3I,EAAO,QAC3C,MAAM4G,EAAwB,GAAf9B,EAAOkB,MAAc2C,EAC9B9B,EAAS3B,EAAWuB,EAAe,EAAMpB,UAC/C,MAAO,CACL5N,GAAI,SAASqP,KAAKC,SAASlN,SAAS,IAAImN,MAAM,EAAG,KACjDhH,OACAgE,EAAG4C,EACH3C,EAAG4C,EACHtE,GAAI,EACJC,GAAI,EACJyE,OAAQ,EACRC,UAAU,EACVC,MAAO,SACPyB,aAAc,EACdC,aAAc,EACdC,cAAe,KACfZ,WAAY,EACZa,UAAW,EACXC,UAAW,EAEf,CAEA,MAAMC,EAAW,CACfjF,EAAkB,GAAfc,EAAOkB,MACV/B,EAAGiB,EAAWuB,EAAe,EAAMpB,UACnC9C,GAAI,EACJC,GAAI,EACJyE,OAAQ,EACRC,UAAU,EACVgC,YAAa,SACbC,UAAW,KACXC,mBAAoB,KACpBC,kBAAmB,EACnBC,eAAgBhD,EAAe,IAAI7O,IAAM,OACzC8R,qBAAsB,EACtBzD,SAAS,EACT0D,UAAW,EACX3D,WAAW,EACX4D,YAAa,EAAMpE,SACnBqE,WAAW,EACXC,aAAc,EACdC,cAAe,KACfC,cAAe,EACfC,iBAAkB,EAClBC,iBAAiB,EACjBC,iBAAkB,EAClBC,kBAAkB,EAClBC,eAAe,EACfC,eAAgB,GAChBzC,OAAQ,IACRC,UAAW,IACXU,gBAAiB,EACjB+B,UAAW,EACXC,cAAe,EACfC,eAAgB,EAChBC,WAAW,EACXhC,UAAW,EACXiC,gBAAiB,EACjBhC,eAAgB,EAChBC,kBAAmB,EACnBgC,iBAAkB,eAGdC,EAAa,CACjBhC,GAAiB,IAAK,WACtBA,EAAgB,GAAI,QACpBA,EAAgB,IAAK,UAGjB,EAAgB,IAAIiC,IAmB1B,SAASC,IACP,OAAOC,MAAMC,KAAK,EAAcC,SAClC,CAWA,MAAMC,EAAgB,CACpBvT,GAAI,iBACJuM,EAAkB,IAAfc,EAAOkB,MACV/B,EAAGiB,EAAW,IACdpB,OAAQ,IACRnD,OAAQ,GACRgH,UAAW,IACXD,OAAQ,IACRQ,WAAY,EACZC,WAAY,EACZC,eAAgB,EAChBE,aAAc,GAGV2C,EAAU,CACdtE,EAAgC,IAAf7B,EAAOkB,OACxBW,EAAgC,IAAf7B,EAAOkB,QClKpBkF,EAAc,CAClBC,UAAW,IAAItG,GACfuG,YAAa,GAWf,SAASC,EAAuBpS,GAC9B,QATF,SAAsBA,GACpB,OAAOA,GAAS,GAAKA,EAAQiS,EAAYC,UAAUjU,MACrD,CAOOoU,CAAarS,KAGlBiS,EAAYE,YAAcnS,EAC1BgQ,EAASwB,iBAAmBS,EAAYC,UAAUlS,IAC3C,EACT,CAEA,SAASsS,IACP,OAAOL,EAAYC,UAAUnE,OAC/B,CA0BA,SAASwE,IACP,MAAMC,EAAgBP,EAAYC,UAAUO,QAAQzC,EAASwB,kBACzDgB,GAAiB,EACnBP,EAAYE,YAAcK,GAI5BP,EAAYC,UAAU,GAAKD,EAAYC,UAAU,IAAMtG,EAAgB,GACvEqG,EAAYE,YAAc,EAC1BnC,EAASwB,iBAAmBS,EAAYC,UAAU,GACpD,CAEAK,IC9DA,MAAMG,EAAY,IAAIhB,IAEtB,SAASiB,EAAgBC,GACvB,IAAKA,EACH,OAAO,KAET,MAAMC,EAAM,EAAmBD,GAC/B,IAAKC,EAEH,OADAH,EAAUI,OAAOF,GACV,KAGT,MAAMG,EAAUF,EAAIxK,KACd2K,EAAYH,EAAI/J,OAEhBmK,OAAsB7R,IAAZ2R,EACVG,EAAWD,EAAUpF,KAAK7E,IAAI,EAAG+J,EAAQzK,UAAY,GAAK6K,OAAOC,kBACjE7K,EAAU0K,EAAUpF,KAAK7E,IAAI,EAAG+J,EAAQxK,SAAW,GAAK4K,OAAOC,kBAC/D5K,EAAgByK,EAAUpF,KAAK7E,IAAI,GAAK+J,EAAQvK,eAAiB,KAAO,EAE9E,IAAI6K,EAAQX,EAAUlO,IAAIoO,GAgC1B,OA/BKS,GAaHA,EAAMH,SAAWA,EACbA,IAAaC,OAAOC,kBACtBC,EAAM/K,SAAW6K,OAAOC,kBAIxBC,EAAM/K,SAHI2K,EAGOpF,KAAKQ,IAAIgF,EAAM/K,SAAU4K,GAFzBA,EAInBG,EAAM9K,QAAUA,EAChB8K,EAAM7K,cAAgBA,EACtB6K,EAAML,UAAYA,GAAa,MAC1BK,EAAMvK,QAAUkK,IACnBK,EAAMvK,OAAS,CAAEwK,QAASN,EAAUvU,MAAQ,IAEzCuU,IACHK,EAAMvK,OAAS,QA3BjBuK,EAAQ,CACNH,WACA5K,SAAU4K,IAAaC,OAAOC,kBAAoBD,OAAOC,kBAAoBF,EAC7E3K,UACAC,gBACA+K,YAAa,EACbjC,WAAW,EACX0B,UAAWA,GAAa,KACxBlK,OAAQkK,EAAY,CAAEM,QAASN,EAAUvU,MAAQ,GAAM,MAEzDiU,EAAUc,IAAIZ,EAAUS,IAoBnBA,CACT,CAEA,SAASI,EAAcb,GACrB,MAAMS,EAAQV,EAAgBC,GAC9B,OAAKS,EAGE,CACL/K,SAAU+K,EAAM/K,SAChBC,QAAS8K,EAAM9K,QACf2K,SAAUG,EAAMH,SAChB5B,UAAW+B,EAAM/B,UACjBiC,YAAaF,EAAME,YACnB/K,cAAe6K,EAAM7K,eARd,IAUX,CAoBA,SAASkL,EAAYd,GACnB,MAAMS,EAAQV,EAAgBC,GAC9B,SAAKS,GAGDA,EAAMH,WAAaC,OAAOC,mBAG1BC,EAAM/B,WAGN+B,EAAM/K,UAAY+K,EAAMH,UAGxBG,EAAM9K,SAAW,IAGrB8K,EAAM/B,WAAY,EAClB+B,EAAME,YAAcF,EAAM7K,cACtBwH,EAASwB,mBAAqBoB,IAChC5C,EAASsB,WAAY,GAEhB,GACT,CAyFA,SAASqC,EAAiBf,GACxB,MAAMS,EAAQV,EAAgBC,GACzBS,GAASA,EAAMH,WAAaC,OAAOC,oBAGxCC,EAAM/K,SAAW+K,EAAMH,SACvBG,EAAM9K,QAAU,EAAmBqK,IAAWvK,MAAME,SAAW8K,EAAM9K,QACrE8K,EAAM/B,WAAY,EAClB+B,EAAME,YAAc,EACtB,CC/MA,IAAIK,GAAsB,EAE1B,MAAMC,EAAsB,CAC1BrV,GAAIwR,EAASwB,kBASf,SAASsC,IACP,MAAMlB,EFLCX,EAAYC,UAAUD,EAAYE,aEMzC,OALO,EAKwBS,IAAa,IAC9C,CAEA,SAASmB,EAAiB/T,GACxB,MAAMgU,EAAahE,EAASwB,iBAC5B,IAAKY,EAAuBpS,GAC1B,OAAO,EAELgU,GAAcA,IAAehE,EAASwB,kBDyF5C,SAAsBoB,GACpB,MAAMS,EAAQX,EAAUlO,IAAIoO,GACvBS,IAGLA,EAAM/B,WAAY,EAClB+B,EAAME,YAAc,EAChBvD,EAASwB,mBAAqBoB,IAChC5C,EAASsB,WAAY,GAEzB,CClGI2C,CAAaD,GAGfrB,EAAgB3C,EAASwB,kBAEzBxB,EAASS,WAAY,EACrBT,EAASW,cAAgB,KACzBX,EAASY,cAAgB,EACzBZ,EAASc,iBAAkB,EAC3Bd,EAASe,iBAAmB,EAC5Bf,EAASU,aAAe,EACxBV,EAASiB,eAAgB,EAEzB,MAAMiD,EAAaT,EAAczD,EAASwB,kBAI1C,OAHAxB,EAASsB,UAAY4C,GAAY5C,YAAa,EAE9CuC,EAAoBrV,GAAKwR,EAASwB,kBAC3B,CACT,CAnCAuC,EAAiB9B,EAAYE,aCX7B,IAAIgC,GAAe,KACf,IAAc,EAClB,MAAMC,GAAe,IAAI1C,IAEnB2C,GAAkB,CACtB,oBAAqB,CAAEC,UAAW,IAAM,IAAsB,IAAhBzG,KAAKC,SAAgBpD,SAAU,IAAM6J,KAAM,IAAMC,MAAO,SAAUC,SAAU,IAC1H,sBAAuB,CAAEH,UAAW,IAAM,IAAsB,IAAhBzG,KAAKC,SAAgBpD,SAAU,IAAM6J,KAAM,KAAOC,MAAO,WAAYC,SAAU,IAC/H,sBAAuB,CAAEH,UAAW,IAAK5J,SAAU,IAAM6J,KAAM,IAAMC,MAAO,WAAYC,SAAU,KAClG,uBAAwB,CAAEH,UAAW,IAAK5J,SAAU,IAAM6J,KAAM,IAAMC,MAAO,WAAYC,SAAU,KACnG,qBAAsB,CAAEH,UAAYI,GAAW,IAA0C,IAAnCA,GAAQhM,QAAQC,YAAc,GAAS+B,SAAU,IAAM6J,KAAM,KAAOC,MAAO,OAAQC,SAAU,IACnJ,aAAc,CAAEH,UAAW,IAAK5J,SAAU,IAAM6J,KAAM,GAAKC,MAAO,OAAQC,SAAU,KACpF,iBAAkB,CAAEH,UAAW,GAAI5J,SAAU,GAAK6J,KAAM,IAAMC,MAAO,WAAYC,SAAU,KAC3F,aAAc,CAAEH,UAAW,IAAK5J,SAAU,IAAM6J,KAAM,IAAMC,MAAO,WAAYC,SAAU,KACzF,sBAAuB,CAAEH,UAAW,IAAK5J,SAAU,IAAM6J,KAAM,IAAMC,MAAO,WAAYC,SAAU,KAClG,wBAAyB,CAAEH,UAAW,IAAM,IAAsB,IAAhBzG,KAAKC,SAAgBpD,SAAU,IAAM6J,KAAM,IAAMC,MAAO,WAAYC,SAAU,KAChI,2BAA4B,CAAEH,UAAW,IAAK5J,SAAU,IAAM6J,KAAM,KAAOC,MAAO,OAAQC,SAAU,KACpG,4BAA6B,CAAEH,UAAW,IAAK5J,SAAU,IAAM6J,KAAM,KAAOC,MAAO,OAAQC,SAAU,MAGvG,SAASE,KACP,GAAIR,IAAkC,oBAAXvR,OACzB,OAAOuR,GAET,MAAMS,EAAYhS,OAAOiS,cAAgBjS,OAAOkS,mBAChD,OAAKF,GAGLT,GAAe,IAAIS,EACZT,IAHE,IAIX,CAEA,SAASY,KACFZ,IAGsB,cAAvBA,GAAajG,OAAwD,mBAAxBiG,GAAaa,QAC5Db,GAAaa,SAASC,MAAM,OAIhC,CA8CA,SAASC,KACPH,KACAnS,OAAOuS,oBAAoB,cAAeD,IAC1CtS,OAAOuS,oBAAoB,UAAWD,GACxC,CCzFA,SAASE,KACP,GAAsB,oBAAXxS,SAA2BA,OAAOyS,IAAK,CAChD,MAAMC,EAAQ,IAAIpS,MAAM,yBAExB,MADAoS,EAAM1O,KAAO,oBACP0O,CACR,CACA,OAAO1S,OAAOyS,GAChB,CAIA,MAAME,GAAS,QAAQ1H,KAAKC,SAASlN,SAAS,IAAImN,MAAM,EAAG,KAC3D,IAAIyH,GAAiB,KACjBC,GAAkB,KAClBC,GAAiB,KACjBC,GAAe,EACfC,GAAmB,eACnBC,GAAyB,KAC7B,MAAMC,GAAkB,GAExB,SAASC,KACP,OAAIP,IAAoC,oBAAX5S,SAA2BA,OAAOoT,oBAG/DR,GAAiB,IAAIQ,kBAAkB,CAAEC,WAAY,KACrDL,GAAmB,aAEnBH,GAAkBD,GAAeU,kBAAkB,WAAY,CAAEC,SAAS,IAC1EC,GAAiBX,IAEjBD,GAAea,iBAAiB,eAAiB1P,IAC3CA,EAAM2P,WACRR,GAAgBtW,KAAKqC,KAAKC,UAAU6E,EAAM2P,cAI9Cd,GAAea,iBAAiB,wBAAyB,KACvDT,GAAmBJ,GAAee,iBAAmB,YAGvDf,GAAea,iBAAiB,cAAgB1P,IAC9C+O,GAAiB/O,EAAM6P,QACvBJ,GAAiBV,OApBVF,EAwBX,CAEA,SAASY,GAAiBI,GACnBA,IAGLA,EAAQH,iBAAiB,OAAQ,KAC/BT,GAAmB,cAErBY,EAAQH,iBAAiB,QAAS,KAChCT,GAAmB,iBAErBY,EAAQH,iBAAiB,UAAY1P,IACnC,KAS2B8P,EART5U,KAAK6U,MAAM/P,EAAM5E,QASF,iBAAZ0U,GAIhB,gBADCA,EAAQhM,ML8ClB,SAA4ByD,GAC1B,IAAKA,IAAUA,EAAM1P,GACnB,OAEF,MAAMmY,EAA6B,oBAAhBC,YAA8BA,YAAYD,MAAQE,KAAKF,MACpEG,EAAW,EAActS,IAAI0J,EAAM1P,KAAO,CAAC,EACjD,EAAcgV,IAAItF,EAAM1P,GAAI,CAC1BA,GAAI0P,EAAM1P,GACVuI,KAAMmH,EAAMnH,MAAQ+P,EAAS/P,MAAQ,SACrCgE,EAAGmD,EAAMnD,GAAK+L,EAAS/L,GAAK,EAC5BC,EAAGkD,EAAMlD,GAAK8L,EAAS9L,GAAKiB,EAAWuB,EAAe,EAAMpB,UAC5D4B,OAAQE,EAAMF,QAAU8I,EAAS9I,QAAU,EAC3C+I,UAAW7I,EAAM6I,WAAaD,EAASC,WAAa,OACpDC,WAAYL,GAEhB,CK3DMM,CAAmB,CACjBzY,GAAIiY,EAAQjY,GACZuI,KAAM0P,EAAQ1P,KACdgE,EAAG0L,EAAQ1L,EACXC,EAAGyL,EAAQzL,EACXgD,OAAQyI,EAAQzI,OAChB+I,UAAWN,EAAQM,WAlBvB,CAAE,MAAOzB,GACP4B,QAAQC,KAAK,8BAA+B7B,EAC9C,CAIJ,IAA+BmB,IAF/B,CA8HA,SAASW,KACP,MAAO,CACL5Y,GAAI+W,GACJ8B,OAAQzB,GACR0B,iBAAkBzB,GAClBC,gBAAiB,IAAIA,IAEzB,CCxMA,MCEMyB,GAAqB,CACzBC,QAAS,GACTC,SAAS,EACTC,cAAe,EACfC,UAAW,EACXC,UAAU,EACVtC,MAAO,KACPuC,cAAe,KACfC,SAAS,EACTC,iBAAkB,KAClBC,qBAAsB,EACtBC,iBAAkB,EAClBC,WAAY,KACZC,UAAW,KACXC,eAAgB,CACdC,YAAa,EACbC,WAAY,EACZC,YAAa,GAEfC,IAAK,CACHC,MAAO,KACPC,OAAQ,KACRC,cAAc,EACdC,eAAe,EACfC,mBAAmB,EACnB/C,gBAAiB,GACjBgD,iBAAkB,GAClBxD,MAAO,OAIX,SAASyD,KACP,OAAOxB,EACT,CAEA,SAASyB,GAAWvB,GAClBF,GAAmBE,QAAUA,EACxBA,IACHF,GAAmBM,cAAgB,KACnCN,GAAmBjC,MAAQ,KAE/B,CAMA,SAAS2D,GAAW9a,GAClB,MAAM+a,EAAoB3B,GAAmBC,QAAQD,GAAmBG,gBAAgBlZ,GAExF,GADA+Y,GAAmBC,QAAU5F,MAAMuH,QAAQhb,GAAQA,EAAO,GACtD+a,EAAmB,CACrB,MAAME,EAAe7B,GAAmBC,QAAQ6B,UAAWC,GAAWA,EAAO9a,KAAO0a,GAChFE,GAAgB,IAClB7B,GAAmBG,cAAgB0B,EAEvC,CACI7B,GAAmBG,eAAiBH,GAAmBC,QAAQvZ,SACjEsZ,GAAmBG,cAAgB7J,KAAK7E,IAAI,EAAGuO,GAAmBC,QAAQvZ,OAAS,GAEvF,CAEA,SAASsb,GAASC,GAChBjC,GAAmBjC,MAAQkE,CAC7B,CAEA,SAASC,GAAiBD,GACxBjC,GAAmBM,cAAgB2B,CACrC,CAEA,SAASE,GAAcF,GACrBjC,GAAmBW,WAAasB,CAClC,CAEA,SAASG,GAAaH,GACpBjC,GAAmBY,UAAYqB,CACjC,CAEA,SAASI,GAAmBpb,GAC1B+Y,GAAmBsC,gBAAkBrb,GAAM,IAC7C,CASA,SAASsb,GAAqBC,GAC5BxC,GAAmBI,UAAYoC,CACjC,CAEA,SAASC,GAAYpC,GACnBL,GAAmBK,SAAWA,CAChC,CAEA,SAASqC,IAAkB,GAAEzb,EAAE,UAAE0b,IAC/B3C,GAAmBO,QAAUqC,QAAQ3b,GACrC+Y,GAAmBQ,iBAAmBvZ,GAAM,KAC5C+Y,GAAmBS,qBAAuBpB,YAAYD,MACtDY,GAAmBU,iBAAmBiC,GAAa,CACrD,CAMA,SAASE,KACP7C,GAAmBO,SAAU,EAC7BP,GAAmBQ,iBAAmB,KACtCR,GAAmBU,iBAAmB,EACtCV,GAAmBS,qBAAuB,EAC1CqC,IACF,CAiBA,SAASC,GAAa5B,GACpBnB,GAAmBiB,IAAIE,OAASA,GAAU,IAC5C,CAEA,SAAS6B,GAAsBC,GACxB5I,MAAMuH,QAAQqB,KACjBA,EAAa,IAEf,MAAMC,EAAOD,EAAWzM,QAClBuF,EAAUiE,GAAmBiB,IAAI1C,iBAAmB,GACtDxC,EAAQrV,SAAWwc,EAAKxc,QAAUqV,EAAQoH,MAAM,CAACC,EAAO3a,IAAU2a,IAAUF,EAAKza,MAGrFuX,GAAmBiB,IAAI1C,gBAAkB2E,EAC3C,CAEA,SAASG,GAAuBJ,GACzB5I,MAAMuH,QAAQqB,KACjBA,EAAa,IAEf,MAAMC,EAAOD,EAAWzM,QAClBuF,EAAUiE,GAAmBiB,IAAIM,kBAAoB,GACvDxF,EAAQrV,SAAWwc,EAAKxc,QAAUqV,EAAQoH,MAAM,CAACC,EAAO3a,IAAU2a,IAAUF,EAAKza,MAGrFuX,GAAmBiB,IAAIM,iBAAmB2B,EAC5C,CAEA,SAASI,GAAYrB,GACnBjC,GAAmBiB,IAAIlD,MAAQkE,GAAW,IAC5C,CACA,SAASsB,IAAc,MAAErC,EAAK,OAAEC,EAAM,WAAE8B,IACjB,kBAAV/B,IACTlB,GAAmBiB,IAAIG,aAAeF,GAElB,kBAAXC,IACTnB,GAAmBiB,IAAII,cAAgBF,GAEf,kBAAf8B,IACTjD,GAAmBiB,IAAIK,kBAAoB2B,EAE/C,CAEA,SAASH,KACP9C,GAAmBiB,IAAIC,MAAQ,KAC/BlB,GAAmBiB,IAAIE,OAAS,KAChCnB,GAAmBiB,IAAIG,cAAe,EACtCpB,GAAmBiB,IAAII,eAAgB,EACvCrB,GAAmBiB,IAAIK,mBAAoB,EAC3CtB,GAAmBiB,IAAI1C,gBAAkB,GACzCyB,GAAmBiB,IAAIM,iBAAmB,GAC1CvB,GAAmBiB,IAAIlD,MAAQ,IACjC,CCtLA,SAASyF,GAAMJ,EAAOtM,EAAKrF,GACzB,OAAO6E,KAAK7E,IAAIqF,EAAKR,KAAKQ,IAAIrF,EAAK2R,GACrC,CAEA,MAAMK,GAAsB,CAC1BC,MAAO,CACL3N,MAAO,cACP4N,aAAc,SACdnO,MAAO,IACPlC,OAAQ,GACRsQ,YAAa,GACbC,UAAW,GACXC,WAAY,CAAEtQ,GAAI,EAAGC,EAAG,IACxBsQ,YAAa,CACX,CAAEvQ,EAAG,GAAIC,EAAG,GACZ,CAAED,GAAI,GAAIC,EAAG,IAEfuQ,YAAa,GACbC,aAAc,IACdC,QAAS,IACTC,SAAU,IACVC,SAAU,IACVC,QAAS,IACTC,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,WAEfC,WAAY,CACV3O,MAAO,oBACP4N,aAAc,MACdgB,eAAgB,CACd,CACE1d,GAAI,wBACJ8O,MAAO,cACP6O,QAAS,UACTC,OAAQ,CAAErR,EAAG,GAAIC,EAAG,GACpBqR,QAAS,CACP,CAAEtR,EAAG,GAAIC,GAAI,GACb,CAAED,EAAG,GAAIC,EAAG,IAEdhD,WAAY,CACVC,MAAO,IACPN,OAAQ,GACRD,OAAQ,EACRU,MAAO,UACPD,cAAe,IACfP,UAAW,IAEb0U,QAAS,IACT3R,aAAc,GACd4R,cAAe,IACfC,YAAa,GACbC,aAAc,GACdC,YAAa,EACbC,YAAa,YAGjB5P,MAAO,IACPlC,OAAQ,GACRwQ,WAAY,CAAEtQ,EAAG,EAAGC,EAAG,IACvBsQ,YAAa,CACX,CAAEvQ,EAAG,GAAIC,EAAG,GACZ,CAAED,GAAI,GAAIC,EAAG,IAEfuQ,YAAa,IACbqB,uBAAwB,IACxBC,mBAAoB,IACpBC,eAAgB,IAChBnB,SAAU,IACVC,QAAS,IACTmB,UAAW,IACXC,aAAc,IACdC,aAAc,GACdC,iBAAkB,IAClBC,gBAAiB,GACjBC,iBAAkB,GAClBC,iBAAkB,IAClBC,WAAY,GACZC,kBAAmB,IACnB1B,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,UACbwB,UAAW,IACXC,eAAgB,EAChBC,WAAY,IAEdC,SAAU,CACRrQ,MAAO,gBACP4N,aAAc,MACdgB,eAAgB,CACd,CACE1d,GAAI,uBACJ8O,MAAO,eACP6O,QAAS,YACTC,OAAQ,CAAErR,EAAG,GAAIC,GAAI,GACrBqR,QAAS,CACP,CAAEtR,EAAG,GAAIC,GAAI,IACb,CAAED,EAAG,GAAIC,EAAG,KAEdhD,WAAY,CACVC,MAAO,IACPN,OAAQ,GACRD,OAAQ,EACRU,MAAO,UACPD,cAAe,IACfP,UAAW,KAEb0U,QAAS,EACT3R,aAAc,IACd4R,cAAe,IACfC,YAAa,GACbC,aAAc,GACdC,YAAa,EACbC,YAAa,YAGjB5P,MAAO,IACPlC,OAAQ,GACRwQ,WAAY,CAAEtQ,EAAG,EAAGC,EAAG,IACvBsQ,YAAa,CACX,CAAEvQ,EAAG,GAAIC,GAAI,GACb,CAAED,GAAI,GAAIC,GAAI,IAEhBuQ,YAAa,IACbqB,uBAAwB,IACxBC,mBAAoB,IACpBC,eAAgB,IAChBnB,SAAU,GACVC,QAAS,IACTmB,UAAW,IACXC,aAAc,IACdC,aAAc,IACdC,iBAAkB,IAClBC,gBAAiB,IACjBC,iBAAkB,GAClBC,iBAAkB,IAClBC,WAAY,IACZC,kBAAmB,IACnB1B,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,UACb4B,SAAU,KAEZC,UAAW,CACTvQ,MAAO,aACP4N,aAAc,QACdgB,eAAgB,CACd,CACE1d,GAAI,uBACJ8O,MAAO,cACP6O,QAAS,UACTC,OAAQ,CAAErR,EAAG,GAAIC,GAAI,IACrBqR,QAAS,CACP,CAAEtR,EAAG,GAAIC,GAAI,IAEfhD,WAAY,CACVC,MAAO,IACPN,OAAQ,GACRD,OAAQ,EACRU,MAAO,UACPD,cAAe,IACfP,UAAW,KAEb0U,QAAS,IACT3R,aAAc,IACd4R,cAAe,GACfC,YAAa,GACbC,aAAc,GACdC,YAAa,EACbC,YAAa,YAGjB5P,MAAO,IACPlC,OAAQ,GACRwQ,WAAY,CAAEtQ,GAAI,GAAIC,EAAG,IACzBsQ,YAAa,CACX,CAAEvQ,EAAG,GAAIC,GAAI,GACb,CAAED,GAAI,GAAIC,GAAI,IAEhBuQ,YAAa,IACbuC,mBAAoB,GACpBC,kBAAmB,IACnBC,cAAe,IACfC,kBAAmB,IACnBC,cAAe,IACfC,SAAU,IACVC,aAAc,EACdC,SAAU,IACVC,cAAe,IACfC,gBAAiB,GACjB1C,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,WAEfwC,WAAY,CACVlR,MAAO,cACP4N,aAAc,QACdgB,eAAgB,CACd,CACE1d,GAAI,0BACJ8O,MAAO,gBACP6O,QAAS,UACTC,OAAQ,CAAErR,EAAG,GAAIC,GAAI,IACrBqR,QAAS,CACP,CAAEtR,EAAG,GAAIC,GAAI,GACb,CAAED,EAAG,GAAIC,EAAG,IAEdhD,WAAY,CACVC,MAAO,IACPN,OAAQ,GACRD,OAAQ,EACRU,MAAO,UACPD,cAAe,IACfP,UAAW,IAEb0U,QAAS,EACT3R,aAAc,IACd4R,cAAe,IACfC,YAAa,GACbC,aAAc,GACdC,YAAa,EACbC,YAAa,YAGjB5P,MAAO,IACPlC,OAAQ,GACRwQ,WAAY,CAAEtQ,EAAG,GAAIC,EAAG,IACxBsQ,YAAa,CACX,CAAEvQ,EAAG,IAAKC,GAAI,GACd,CAAED,GAAI,IAAKC,GAAI,IAEjBuQ,YAAa,IACbuC,mBAAoB,GACpBC,kBAAmB,IACnBC,cAAe,IACfC,kBAAmB,IACnBC,cAAe,IACfC,SAAU,IACVC,aAAc,EACdC,SAAU,IACVC,cAAe,IACfC,gBAAiB,GACjB1C,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,WAEfyC,SAAU,CACRnR,MAAO,YACP4N,aAAc,QACdgB,eAAgB,CACd,CACE1d,GAAI,2BACJ8O,MAAO,iBACP6O,QAAS,YACTC,OAAQ,CAAErR,EAAG,GAAIC,GAAI,IACrBqR,QAAS,CACP,CAAEtR,EAAG,GAAIC,GAAI,GACb,CAAED,EAAG,GAAIC,EAAG,IAEdhD,WAAY,CACVC,MAAO,IACPN,OAAQ,GACRD,OAAQ,EACRU,MAAO,UACPD,cAAe,IACfP,UAAW,KAEb0U,QAAS,IACT3R,aAAc,GACd4R,cAAe,IACfC,YAAa,GACbC,aAAc,GACdC,YAAa,EACbC,YAAa,YAGjB5P,MAAO,IACPlC,OAAQ,GACRwQ,WAAY,CAAEtQ,EAAG,EAAGC,EAAG,IACvBsQ,YAAa,CACX,CAAEvQ,EAAG,GAAIC,GAAI,IACb,CAAED,GAAI,GAAIC,GAAI,KAEhBuQ,YAAa,IACbuC,mBAAoB,GACpBC,kBAAmB,IACnBC,cAAe,IACfC,kBAAmB,IACnBC,cAAe,IACfC,SAAU,IACVC,aAAc,EACdC,SAAU,IACVC,cAAe,GACfI,gBAAiB,GACjBH,gBAAiB,GACjB1C,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,WAEf2C,WAAY,CACVrR,MAAO,cACP4N,aAAc,MACdnO,MAAO,GACPlC,OAAQ,GACRwQ,WAAY,CAAEtQ,EAAG,EAAGC,EAAG,IACvBsQ,YAAa,CACX,CAAEvQ,EAAG,GAAIC,EAAG,GACZ,CAAED,GAAI,GAAIC,EAAG,IAEfuQ,YAAa,GACbqB,uBAAwB,IACxBC,mBAAoB,IACpBC,eAAgB,IAChBnB,SAAU,IACVC,QAAS,IACTmB,UAAW,IACXC,aAAc,IACdC,aAAc,IACdC,iBAAkB,IAClBC,gBAAiB,IACjBC,iBAAkB,GAClBC,iBAAkB,IAClBC,WAAY,GACZC,kBAAmB,IACnB1B,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,YAIjB,IAAI4C,GAAiB,EAErB,SAASC,GAAcpU,EAAMM,EAAG3M,EAAU,CAAC,GACzC,MAAM8F,EAAa8W,GAAoBvQ,GACvC,IAAKvG,EACH,MAAM,IAAIhB,MAAM,yBAAyBuH,KAG3C,MAAMyQ,EAAehX,EAAWgX,cAAgB,SAC1C4D,EAA0B,GAAnB5a,EAAW6I,MAClBgS,EAAOlT,EAAOkB,MAA2B,GAAnB7I,EAAW6I,MACjCiS,EAAUjE,GAAMhQ,GAAoB,GAAfc,EAAOkB,MAAa+R,EAAMC,GAErD,IAAI9R,EACAgB,GAAW,EACXgR,EAAa,KACbC,EAAoB9gB,EAAQ+gB,OAASjb,EAAWoZ,YAAc,EAElE,GAAqB,QAAjBpC,EAAwB,CAC1B,MAAMkE,EAAclb,EAAWkZ,kBAAoB,EAE7CiC,EAAWtE,GAAMmE,EAAmBE,EADtBlb,EAAWmZ,kBAAoB+B,GAEnDnS,EAAMhB,EAAW/H,EAAW2G,OAASwU,EACrCpR,GAAW,EACXiR,EAAoBG,CACtB,MAAO,GAAqB,UAAjBnE,EAA0B,CACnC,MAAMoE,EAAgBpb,EAAW4Z,oBAAsB,GACvDmB,EAAahT,EAAWqT,EACxB,MAAMhB,EAAgBvD,GAAM7W,EAAWoa,eAAiB,IAAM,GAAK,IAC7DI,EAAkBxa,EAAWwa,iBAAmB,EACtDzR,EAAMgS,EAAa/a,EAAW2G,OAASyT,EAAgBI,EACvDzQ,GAAW,EACXiR,EAAoB,CACtB,MACEjS,EAAMhB,EAAW/H,EAAW2G,OAG9B,MAAM0U,EAAU,CACd/gB,GAAI,WAAWiM,KAAQmU,IAAkB,IACzCnU,OACAM,EAAGiU,EACHhU,EAAGiC,EACH3D,GAAI,EACJC,GAAI,EACJiW,KAAM,EACNxR,OAAQ,EACRyR,SAAU,KACVhR,OAAQvK,EAAW2X,WACnBnN,UAAWxK,EAAW2X,WACtB6D,cAAe,EACfC,YAAa,EACb1R,WACAiR,kBAAoC,QAAjBhE,EAAyBgE,EAAoB,EAChED,aACAW,SAAU/R,KAAKC,SAAWD,KAAKgS,GAAK,GAYtC,OATAN,EAAQO,QAAU5b,EAAWgY,gBAAkB,IAAIpb,IAAI,CAACif,EAAU/f,KAAU,CAC1ExB,GAAIuhB,EAASvhB,IAAM,GAAGiM,WAAczK,IACpCyU,SAAU,EACVxF,WAAY,EACZ+Q,YAAa,EACbC,YAAa,KACbC,YAAa,QAGRX,CACT,CAEA,MAAMY,GAAW,CACftB,GAAc,QAAwB,IAAfhT,EAAOkB,OAC9B8R,GAAc,QAAwB,IAAfhT,EAAOkB,OAC9B8R,GAAc,YAA4B,IAAfhT,EAAOkB,OAClC8R,GAAc,aAA6B,IAAfhT,EAAOkB,MAAc,CAAEoS,MAAO,MAC1DN,GAAc,WAA2B,IAAfhT,EAAOkB,MAAc,CAAEoS,MAAO,MACxDN,GAAc,aAA6B,IAAfhT,EAAOkB,OACnC8R,GAAc,WAA2B,IAAfhT,EAAOkB,OACjC8R,GAAc,aAA6B,GAAfhT,EAAOkB,MAAa,CAAEoS,MAAO,OAG3D,SAASiB,GAAe5hB,GACtB,OAAO2hB,GAASE,KAAMd,GAAYA,EAAQ/gB,KAAOA,IAAO,IAC1D,CCraA,SAAS,GAAMmc,EAAOtM,EAAKrF,GACzB,OAAO6E,KAAK7E,IAAIqF,EAAKR,KAAKQ,IAAIrF,EAAK2R,GACrC,CCFA,IAAI2F,GAAU,EAMd,SAASC,KACP,OAAOD,EACT,CCJA,MAAME,GAAqB,CACzBC,OAAQ,CACN,CAAE/Y,OAAQ,GAAIgI,QAAS,EAAGgR,SAAU,GAAItY,MAAO,WAC/C,CAAEV,OAAQ,GAAIgI,QAAS,EAAGgR,SAAU,GAAItY,MAAO,WAC/C,CAAEV,OAAQ,GAAIgI,SAAU,GAAIgR,QAAS,EAAGtY,MAAO,WAC/C,CAAEV,OAAQ,GAAIgI,QAAS,GAAIgR,QAAS,EAAGtY,MAAO,WAC9C,CAAEV,OAAQ,GAAIgI,SAAU,GAAIgR,QAAS,GAAItY,MAAO,WAChD,CAAEV,OAAQ,GAAIgI,QAAS,GAAIgR,QAAS,GAAItY,MAAO,YAEjDuY,MAAO,CACL,CAAEjZ,OAAQ,GAAIgI,QAAS,EAAGgR,SAAU,GAAItY,MAAO,WAC/C,CAAEV,OAAQ,GAAIgI,QAAS,EAAGgR,SAAU,GAAItY,MAAO,WAC/C,CAAEV,OAAQ,GAAIgI,SAAU,GAAIgR,QAAS,EAAGtY,MAAO,WAC/C,CAAEV,OAAQ,GAAIgI,QAAS,GAAIgR,QAAS,EAAGtY,MAAO,WAC9C,CAAEV,OAAQ,GAAIgI,SAAU,GAAIgR,QAAS,GAAItY,MAAO,WAChD,CAAEV,OAAQ,GAAIgI,QAAS,GAAIgR,QAAS,GAAItY,MAAO,aAI7CwY,GAAW,GAEjB,SAASC,GAAaC,EAAMC,EAASC,EAAShT,EAAS,EAAGiT,EAAS,EAAGC,EAAS,GAC7E,MAAMC,EAAYX,GAAmBM,GACrC,GAAKK,EAIL,IAAK,MAAMC,KAAQD,EACjBP,GAASphB,KAAK,CACZuL,EAAGgW,EAAUK,EAAK1R,QAAU1B,EAC5BhD,EAAGgW,EAAUI,EAAKV,QAClBpX,GAAI2X,EAASjT,GAAU,GAAqB,GAAhBH,KAAKC,UAAyC,IAAvBD,KAAKC,SAAW,IACnEvE,GAAI2X,GAAU,GAAqB,IAAhBrT,KAAKC,UACxBpG,OAAQ0Z,EAAK1Z,OACbU,MAAOgZ,EAAKhZ,MACZiZ,KAAM,IAAsB,GAAhBxT,KAAKC,SACjBwT,QAAS,IAAsB,GAAhBzT,KAAKC,UAG1B,CCxCA,MAAMyT,GAAe,GAErB,SAASC,GAAiBzW,EAAGC,EAAG2P,GAC9B4G,GAAa/hB,KAAK,CAChBuL,IACAC,IACA2P,QACA0G,KAAM,IACNC,QAAS,IACThY,GAA4B,IAAvBuE,KAAKC,SAAW,IACrBvE,IAAK,GAAqB,GAAhBsE,KAAKC,UAEnB,CCVA,MAAM2T,GAAU,GAmEhB,SAASC,GAAcC,GACrB,MAAMC,EAvBR,WACE,MAAMA,EAAU,GACZ7P,EAActD,OAAS,GACzBmT,EAAQpiB,KAAK,CACXhB,GAAIuT,EAAcvT,GAClBuM,EAAGgH,EAAchH,EACjBC,EAAG+G,EAAc/G,EAA2B,GAAvB+G,EAAclH,SAGvC,IAAK,MAAM8V,KAAS3O,EACd2O,EAAMlS,OAAS,GACjBmT,EAAQpiB,KAAK,CACXhB,GAAImiB,EAAMniB,GACVuM,EAAG4V,EAAM5V,EACTC,EAAG2V,EAAM3V,EAAmB,GAAf2V,EAAM9V,OACnBgX,IAAKlB,IAIX,OAAOiB,CACT,CAGkBE,GAChB,IAAIC,EAAU,KACVC,EAAgBC,IACpB,IAAK,MAAMxf,KAAUmf,EAAS,CAC5B,MAAMM,EAAKzf,EAAOsI,EAAI4W,EAAO5W,EACvBoX,EAAK1f,EAAOuI,GAAK2W,EAAO3W,EAAoB,GAAhB2W,EAAO9W,QACnCuX,EAASF,EAAKA,EAAKC,EAAKA,EAC1BC,GAAUT,EAAOna,MAAQma,EAAOna,OAAS4a,EAASJ,IACpDD,EAAUtf,EACVuf,EAAgBI,EAEpB,CACA,OAAOL,CACT,CAEA,SAASM,GAAWV,EAAQlf,GAC1B,MAAMse,EAAUY,EAAO5W,EACjBiW,EAAUW,EAAO3W,EAAoB,IAAhB2W,EAAO9W,OAC5BqX,EAAKzf,EAAOsI,EAAIgW,EAChBoB,EAAK1f,EAAOuI,EAAIgW,EACtBW,EAAO3T,OAASH,KAAKyU,KAAKJ,IAAOP,EAAO3T,OACxC,MAAMuU,EAAW1U,KAAK2U,MAAMN,EAAIC,IAAO,EACjCla,EAAQ0Z,EAAO3Z,WAAWC,MAC1BqB,EAAM4Y,EAAKK,EAAYta,EAE7Bwa,GAAgB,CACd1X,EAAGgW,EACH/V,EAAGgW,EACH1X,KACAC,GALU4Y,EAAKI,EAAYta,EAM3BP,OAAQia,EAAO3Z,WAAWN,OAC1BQ,SAAUyZ,EAAO3Z,WAAWE,SAC5BE,MAAOuZ,EAAO3Z,WAAWI,MACzBT,OAAQga,EAAO3Z,WAAWL,OAC1BC,UAAW+Z,EAAO3Z,WAAWJ,UAC7BoG,OAAQH,KAAKyU,KAAKhZ,IAAO,EACzBnB,cAAe,IAEjBwZ,EAAOe,UAAYf,EAAOhX,YAC5B,CC5GA,MAAMgY,GAAe,CACnBvb,QAAQ,EACRwb,aAAc,EACdxX,UAAW,EACXyX,QAAS,EACTC,QAAS,EACTpY,SAAU,EACVqY,YAAY,EACZtO,SAAU,EACVrM,MAAO,UACPkD,YAAa,IACbC,UAAW,KAuEb,SAASyX,KACPL,GAAavb,QAAS,EACtBub,GAAaI,YAAa,EAC1BJ,GAAaC,aAAe,EAC5BD,GAAavX,UAAY,CAC3B,CCvFA,MAAM6X,GAAc,CAClB7b,QAAQ,EACRuE,SAAU,EACVuX,YAAa,EACbxY,SAAU,EACVyY,YAAa,EACbzb,OAAQ,GACRU,MAAO,UACP6G,WAAY,GAGd,SAASmU,KACP,MAAMC,EAAwD,GAA1CrT,EAASQ,aAAanE,YAAc,KAAW2D,EAASQ,aAAalE,YAAc,KAAO0D,EAASQ,aAAajE,WAAa,IACjJ,MAAO,CACLxB,EAAGiF,EAASjF,EACZC,EAAGgF,EAAShF,EAAiB,GAAbqY,EAEpB,CAEA,SAASC,GAAoB7Y,EAAMiK,EAAS,CAAC,GACrB,oBAAX9R,QAGXA,OAAO2gB,cAAc,IAAIC,YAAY/Y,EAAM,CAAEiK,WAC/C,CAuCA,SAAS+O,GAAiBC,EAAS,WACjC,IAAKT,GAAY7b,OACf,OAEF,MAAMsN,EAAS,CACbgP,SACAC,kBAAmBV,GAAYtX,SAC/BuX,YAAaD,GAAYC,YACzBxY,SAAUuY,GAAYvY,SACtByY,YAAaF,GAAYE,YACzBS,OAAQR,KACR1b,OAAQub,GAAYvb,QAEtBub,GAAY7b,QAAS,EACrB6b,GAAYtX,SAAW,EACvBsX,GAAYvY,SAAW,EACvBuY,GAAYhU,WAAa,EACzBqU,GAAoB,aAAc5O,EACpC,CChFA,SAASmP,GAAaC,GACpB,MAAMC,EAAeD,GAAQtZ,OAC7B,IAAKuZ,EACH,OAAO,EAGT,IADiB/T,EAASqB,gBAAkB,GAC7B,EACb,OAAO,EAIT,OADa0S,EAAatZ,MAAQ,UAEhC,IAAK,SAGH,OHoBN,SAAsBuZ,GACpB,MACMrC,EAnCR,SAAsBqC,EAAQhW,GAC5B,MAAMnD,EAASmZ,EAAOnZ,QAAU,GAC1BC,EAAckZ,EAAOlZ,aAAe,CAAEC,EAAG,GAAIC,EAAG,GAChDiZ,EAAazW,EAAewC,EAASQ,aAAe,OAAS,EAC7D7C,EAAS,GAAMqC,EAASjF,EAAIiD,GAAUlD,EAAYC,GAAK,IAAK,GAAIc,EAAOkB,MAAQ,IAC/EmX,EAAalU,EAAShF,EAAIiZ,EAC1BrW,EAASC,KAAKQ,IAAI6V,GAAcpZ,EAAYE,GAAK,GAAIiB,GACrDjB,EAAI6C,KAAKQ,IAAIpC,EAAWpB,EAAQ+C,EAAS/C,GAE/C,MAAO,CACLrM,GAAI,UAAUqY,KAAKF,SAAS9I,KAAKC,SAASlN,SAAS,IAAImN,MAAM,EAAG,KAChEhD,EAAG4C,EACH3C,IACAH,SACAmD,SACAxG,MAAOwc,EAAOxc,OAAS,IACvBmD,aAAckD,KAAK7E,IAAI,GAAKgb,EAAOrZ,cAAgB,IACnD+X,UAAW,GACXhY,SAAUsZ,EAAOtZ,UAAY,EAC7ByY,YAAaa,EAAOtZ,UAAY,EAChC1C,WAAY,CACVC,MAAO+b,EAAOhc,YAAYC,OAAS,IACnCP,OAAQsc,EAAOhc,YAAYN,QAAU,EACrCC,OAAQqc,EAAOhc,YAAYL,QAAU,GACrCC,UAAWoc,EAAOhc,YAAYJ,WAAa,GAC3CM,SAAU8b,EAAOhc,YAAYE,UAAY,IACzCE,MAAO4b,EAAOhc,YAAYI,OAAS,WAErC6C,UAAW+Y,EAAO/Y,WAAa,UAC/BC,UAAW8Y,EAAO9Y,WAAa,UAEnC,CAIiBiZ,CAAaH,EADbhU,EAAShC,QAAU,GAE5BpD,EAAYiD,KAAK7E,IAAI,EAAGgb,EAAOpZ,WAAa,GAC9C6W,GAAQxjB,QAAU2M,GACpB6W,GAAQ2C,QAEV3C,GAAQjiB,KAAKmiB,EACf,CG9BM0C,CAAaN,GACb/T,EAASqB,eAAiB0S,EAAata,iBAAmB,KACnD,EACT,IAAK,UACH,QFHAkZ,GAAavb,SAGZ4I,EAASqB,gBAAkB,GAAK,IAMvC,SAAsB2S,GACpB,MAAMM,EAAYN,EAAOjJ,OAAS,CAAE9V,KAAM,GAAIC,MAAO2G,EAAOkB,MAAQ,IAC9DwX,EAAOP,EAAOO,MAAQ,CAAEvZ,EAAGiB,EAAW,KACtCuY,EAAeR,EAAO5Y,WAAa,IACnC4C,EAASgC,EAAShC,QAAU,EAC5ByW,EAAU,GAAMzU,EAASjF,EAAIiD,EAASwW,EAAcF,EAAUrf,KAAMqf,EAAUpf,OAC9Ewf,EAAU7W,KAAKQ,IAAIkW,EAAKvZ,GAAMiB,EAAW,IAAM+D,EAAShF,GAAKgZ,EAAO3Y,SAAW,MAErFsX,GAAavb,QAAS,EACtBub,GAAaI,YAAa,EAC1BJ,GAAaC,aAAe,EAC5BD,GAAavX,UAAYyC,KAAK2U,MAAMiC,EAAUzU,EAASjF,EAAG2Z,EAAU1U,EAAShF,GAC7E2X,GAAaE,QAAU4B,EACvB9B,GAAaG,QAAU4B,EACvB/B,GAAajY,SAAWsZ,EAAOtZ,UAAY,IAC3CiY,GAAalO,SAAWuP,EAAOva,iBAAmB,IAClDkZ,GAAava,MAAQ4b,EAAO5b,OAAS,UACrCua,GAAarX,YAAc0Y,EAAO1Y,aAAe,IACjDqX,GAAapX,UAAYyY,EAAOzY,WAAa,IAC7CyE,EAASqB,eAAiBsR,GAAalO,QACzC,CEvBMkQ,CAAaZ,GACN,IACT,IAAK,SAEH,ODCN,SAAwBC,EAAS,CAAC,GAChC,MAAMrY,EAAWqY,EAAOrY,UAAY,IAChCsX,GAAY7b,SAGhB6b,GAAY7b,QAAS,EACrB6b,GAAYtX,SAAWA,EACvBsX,GAAYC,YAAcvX,EAC1BsX,GAAYvY,SAAWsZ,EAAOtZ,UAAY,EAC1CuY,GAAYE,YAAcF,GAAYvY,SACtCuY,GAAYvb,OAASsc,EAAOtc,QAAU,GACtCub,GAAY7a,MAAQ4b,EAAO5b,OAAS,UACpC6a,GAAYhU,WAAa,EACzBe,EAASqB,eAAiB2S,EAAOva,iBAAmB,IAEtD,CCjBMmb,CAAeb,IACR,EACT,QACE,OAAO,EAEb,CC5BA,SAASc,GAAmBC,GAC1B,MAAMnd,EAASmd,EAAInd,QAAU,EACvBC,EAAYkd,EAAIld,WAAa,EAEnCmK,EAActD,OAASZ,KAAK7E,IAAI,EAAG+I,EAActD,OAAS9G,GAC1DoK,EAAc9C,WAAa,IAC3B8C,EAAc7C,WAAarB,KAAKQ,IAAI,GAAK0D,EAAc7C,WAAa,KACpE6C,EAAc5C,eAAiBtB,KAAKQ,IAAI,GAAI0D,EAAc5C,eAAiBvH,EAAY,IAEvF,MAAMmd,EAAShT,EAAc/G,EAA2B,IAAvB+G,EAAclH,OAAgBkH,EAAcrK,OAAS,GACtF8Z,GAAiBzP,EAAchH,EAAGga,EAAQpd,GAEb,IAAzBoK,EAActD,QAAgBsD,EAAc1C,cAAgB,IAC9D0C,EAAc1C,aAAe,IAEjC,CAEA,SAAS2V,GAAmBrE,EAAOmE,GACjC,GAAInE,EAAMlS,QAAU,GAAKkS,EAAMvR,gBAAkB,EAC/C,OAGF,MAAMzH,EAASmd,EAAInd,QAAU,EACvBC,EAAYkd,EAAIld,WAAa,EAC7BC,EAASid,EAAIjd,QAAU,EACvBmG,EAAS8W,EAAI9W,QAAUgC,EAAShC,OAEtC2S,EAAMlS,OAASZ,KAAK7E,IAAI,EAAG2X,EAAMlS,OAAS9G,GAC1CgZ,EAAM1R,WAAa,IACnB0R,EAAMzR,WAAarB,KAAKQ,IAAI,GAAKsS,EAAMzR,WAAa,KACpDyR,EAAMxR,eAAiBtB,KAAKQ,IAAI,GAAIsS,EAAMxR,eAAiBvH,EAAY,IACvE+Y,EAAMrX,IAAM1B,EAAYoG,EAAS,IAC7BnG,EAAS,IACX8Y,EAAMpX,IAAe,GAAT1B,GAGd2Z,GAAiBb,EAAM5V,EAAmB,GAAf4V,EAAM3S,OAAa2S,EAAM3V,EAAI,GAAIrD,GAC5DgZ,EAAMvR,gBAAkB,IAEH,IAAjBuR,EAAMlS,SACJkS,EAAMtR,cAAgB,GACxBwR,GAAa,QAASF,EAAM5V,EAAG4V,EAAM3V,EAAGgD,EAAQ2S,EAAMrX,GAAIqX,EAAMpX,IAElEoX,EAAMzS,MAAQ,WACdyS,EAAMhS,eAAiB,IACvBgS,EAAMtR,aAAe,EAEzB,CAEA,SAAS4V,GAAoBtE,EAAOmE,GAClC,GAAI9U,EAASZ,gBAAkB,GAAKY,EAASvB,QAAU,EACrD,OAGF,MAAMyW,EAAaJ,GAAKnd,QAAUgZ,EAAM7R,cAAgB,EAClDqW,EAAgBL,GAAKld,WAAa+Y,EAAM5R,iBAAmB,EAC3DqW,EAAaN,GAAKjd,QAAU8Y,EAAM3R,cAAgB,EAClDhB,EAAS8W,GAAK9W,QAAU2S,EAAM3S,QAAU,EAE9C,IAAIqX,EFuBN,SAAyBP,GACvB,IAAK7B,GAAY7b,OACf,OAAO0d,EAET,MAAMnd,EAASmd,EAAInd,QAAU,EAC7B,GAAIA,GAAU,EACZ,OAAOmd,EAET,MAAMQ,EAASzX,KAAKQ,IAAI1G,EAAQsb,GAAYtX,UAC5CsX,GAAYtX,UAAY2Z,EACxBrC,GAAYhU,WAAapB,KAAK7E,IAAIia,GAAYhU,WAAY,IAE1D,MAAM2U,EAASR,KACfE,GAAoB,aAAc,CAChCgC,SACA3B,kBAAmB9V,KAAK7E,IAAI,EAAGia,GAAYtX,UAC3CuX,YAAaD,GAAYC,YACzBxY,SAAUuY,GAAYvY,SACtByY,YAAaF,GAAYE,YACzBS,SACAlc,OAAQub,GAAYvb,SAGtB,MAAM6d,EAAiB5d,EAAS2d,EAC1BvnB,EAAS,IACV+mB,EACHnd,OAAQ4d,GAiBV,OAfIA,GAAkB,IACpBxnB,EAAO4J,OAAS,EAChB5J,EAAO6J,UAAmC,KAAtBkd,EAAIld,WAAa,GACrC7J,EAAO8J,OAA6B,KAAnBid,EAAIjd,QAAU,IAE7Bob,GAAYtX,UAAY,IAC1B2X,GAAoB,iBAAkB,CACpCI,OAAQ,SACR4B,SACA1B,SACAV,YAAaD,GAAYC,YACzBxb,OAAQub,GAAYvb,SAEtB+b,GAAiB,YAEZ1lB,CACT,CEnEoBynB,CAAgB,CAChC7d,OAAQud,EACRtd,UAAWud,EACXtd,OAAQud,EACRpX,WAGF,MAAMyX,EAAcJ,GAAa1d,QAAU,EACrC+d,EAAiBL,GAAazd,WAAaud,EAC3CQ,EAAcN,GAAaxd,QAAUud,EACrCQ,EAAcP,GAAarX,QAAUA,EAEvCyX,EAAc,GAChBzV,EAASvB,OAASZ,KAAK7E,IAAI,EAAGgH,EAASvB,OAASgX,GAChDzV,EAASZ,gBAAkB,IAE3BY,EAASZ,gBAAkBvB,KAAK7E,IAAIgH,EAASZ,gBAAiB,IAGhEY,EAAS1G,IAAMoc,EAAiBE,EAChC5V,EAASzG,IAAMoc,EACfnE,GAAiBxR,EAASjF,EAAGiF,EAAShF,EAAI,GAAI6C,KAAK7E,IAAI,EAAG6E,KAAKgY,MAAMJ,KAEjEA,EAAc,GAAyB,IAApBzV,EAASvB,QAAgBuB,EAASmB,WAAa,IACpEnB,EAASmB,UAAY,IACrBnB,EAASS,WAAY,EACrBT,EAASkB,eAAiB,GAC1BlB,EAASc,iBAAkB,EAC3Bd,EAASU,aAAe,EACxBV,EAASnD,SAAU,EACnBgU,GAAa,SAAU7Q,EAASjF,EAAGiF,EAAShF,GAAI4a,EAAa5V,EAAS1G,GAAI0G,EAASzG,IAEvF,CC9FA,MAAMuc,GAAyB,CAC7BC,gBAAiB,CACfrX,UAAW,IACX3B,MAAO,IACPlC,OAAQ,IACRmb,aAAc,GACdC,SAAU,WACVC,UAAW,UACXC,UAAW,UACXC,YAAa,UACbC,gBAAiB,UACjBC,YAAa,UACbpc,cAAe,IACfqc,YAAa,IAEfC,UAAW,CACT9X,UAAW,IACX3B,MAAO,IACPlC,OAAQ,GACRmb,aAAc,GACdC,SAAU,UACVC,UAAW,UACXC,UAAW,UACXC,YAAa,UACbK,WAAY,UACZJ,gBAAiB,UACjBC,YAAa,UACbpc,cAAe,IACfqc,YAAa,GACbG,WAAY,CACVhf,OAAQ,IACRif,UAAW,IACX/e,UAAW,IACXgf,eAAgB,MAGpBC,kBAAmB,CACjBnY,UAAW,IACX3B,MAAO,GACPlC,OAAQ,GACRmb,aAAc,GACdC,SAAU,WACVC,UAAW,UACXC,UAAW,UACXC,YAAa,UACbU,YAAa,UACbT,gBAAiB,UACjBC,YAAa,UACbpc,cAAe,IACfqc,YAAa,GACbG,WAAY,CACVhf,OAAQ,IACRif,UAAW,IACX/e,UAAW,IACXgf,eAAgB,MAMhBG,GAAY9a,EAAW,GCxB7B,MAAM+a,GD0BsB,CAC1B,CAAExoB,GAAI,mBAAoBiM,KAAM,kBAAmBM,EAAG,IAAKkc,MAJzChb,GAKlB,CAAEzN,GAAI,mBAAoBiM,KAAM,kBAAmBM,EAAG,KAAMkc,MAL1Chb,GAMlB,CAAEzN,GAAI,iBAAkBiM,KAAM,YAAaM,EAAG,IAAKkc,MANjChb,EAMqD+B,QAAS,GAChF,CAAExP,GAAI,gBAAiBiM,KAAM,YAAaM,EAAG,KAAMkc,MAPjChb,EAOqD+B,OAAQ,GAC/E,CAAExP,GAAI,qBAAsBiM,KAAM,oBAAqBM,EAAG,IAAKkc,MAAOF,IACtE,CAAEvoB,GAAI,mBAAoBiM,KAAM,oBAAqBM,EAAG,IAAKkc,MAAOF,KCnCzCjmB,IAAKomB,GAjClC,SAAqCA,GACnC,MAAMC,EAAWrB,GAAuBoB,EAAMzc,MAC9C,IAAK0c,EACH,MAAM,IAAIjkB,MAAM,kCAAkCgkB,EAAMzc,QAG1D,MAAMsC,EAAQma,EAAMna,OAASoa,EAASpa,MAChClC,EAASqc,EAAMrc,QAAUsc,EAAStc,OAExC,MAAO,CACLrM,GAAI0oB,EAAM1oB,GACViM,KAAMyc,EAAMzc,KACZ0c,WACApc,EAAGmc,EAAMnc,EACTC,EAAGkc,EAAMD,MACTla,QACAlC,SACAuc,UAAWra,EAAQ,EACnB0B,OAAQ0Y,EAASzY,UACjBA,UAAWyY,EAASzY,UACpB2Y,WAAW,EACXpY,WAAY,EACZC,WAAY,EACZC,eAAgB,EAChBmY,WAAY,EACZC,YAAa,EACbC,gBAAgB,EAChBxZ,OAAQkZ,EAAMlZ,QAAU,EACxByZ,YAAa,IAAKP,GAEtB,CAG4CQ,CAA4BR,IChClES,GAAY,GACZC,GAAQ,GACd,IAAIC,IAAoB,EAExB,SAASC,GAAe1pB,EAAU,CAAC,GACjC,MAAM2pB,EAAM3pB,EAAQ2pB,KAAO,GACrBC,EAAO,CACXjd,EAAG3M,EAAQ2M,GAAK,EAChBC,EAAG5M,EAAQ4M,GAAK,EAChBid,YAAa7pB,EAAQ6pB,aAAe,GACpCC,UAAW9pB,EAAQ8pB,WAAa,IAChC9f,MAAOhK,EAAQgK,OAAS,UACxB+f,OAAQJ,EACRA,MACAK,UAAWhqB,EAAQgqB,WAAa,GAGlC,OADAR,GAAMpoB,KAAKwoB,GACJA,CACT,CA2BA,SAASK,GAAgB3T,EAAS,CAAC,EAAGsP,EAAS,CAAC,GAC9C,MAAMJ,EAASlP,EAAOkP,QAAU,CAAE7Y,EAAG2J,EAAO3J,GAAK,EAAGC,EAAG0J,EAAO1J,GAAK,GACnE,OAAO8c,GAAe,CACpB/c,EAAG6Y,EAAO7Y,EACVC,EAAG4Y,EAAO5Y,EACV+c,IAAK/D,EAAO+D,KAAO,GACnBE,YAAajE,EAAOiE,aAAgBvT,EAAOhN,QAAU,GACrDwgB,UAAWlE,EAAOkE,WAAqC,MAAvBxT,EAAOhN,QAAU,IACjDU,MAAO4b,EAAO5b,OAAS,UACvBggB,UAAWpE,EAAOoE,WAAa,GAEnC,CAEA,SAASE,GAAwB5T,EAAS,CAAC,GACzC,MAAMkP,EAASlP,EAAOkP,QAAU,CAAE7Y,EAAG,EAAGC,EAAG,GAC3C,IAAK,IAAIhN,EAAI,EAAGA,EAAI,EAAGA,GAAK,EAAG,CAC7B,MAAMuqB,EAAQ1a,KAAKC,SAAWD,KAAKgS,GAAK,EAClC5X,EAAQ,GAAqB,IAAhB4F,KAAKC,SAClBxE,EAAKuE,KAAK2a,IAAID,GAAStgB,EACvBsB,EAAKsE,KAAK4a,IAAIF,GAAStgB,EACvB8f,EAAM,GAAsB,GAAhBla,KAAKC,SACvB6Z,GAAUnoB,KAAK,CACbiL,KAAM,SACNM,EAAG6Y,EAAO7Y,EACVC,EAAG4Y,EAAO5Y,EACV1B,KACAC,KACAwe,MACAI,OAAQJ,EACRrgB,OAAQ,EAAoB,EAAhBmG,KAAKC,SACjB1F,MAAO,WAEX,CACAigB,GAAgB3T,EAAQ,CACtBqT,IAAK,IACLE,YAAqC,KAAvBvT,EAAOhN,QAAU,IAC/BwgB,UAAmC,MAAvBxT,EAAOhN,QAAU,IAC7B0gB,UAAW,EACXhgB,MAAO,WAEX,CA4CA,SAASsgB,KACHb,IAAuC,oBAAXjlB,SAGhCA,OAAOyT,iBAAiB,sBAAwB1P,KAjHlD,SAA8B+N,EAAS,CAAC,GACtC,MACMiU,EAAQjU,EAAO3J,GAAK,EACpBkc,EAAQvS,EAAO1J,GAAK,EACpBgD,EAAS0G,EAAO1G,QAAU,EAChC,IAAK,IAAIhQ,EAAI,EAAGA,EAJF,EAIaA,GAAK,EAAG,CACjC,MAAMiK,EAAQ,IAAsB,IAAhB4F,KAAKC,SACnBya,EAAyB,GAAhB1a,KAAKC,SAAiB,IAAQE,EAAS,EAAI,EAAIH,KAAKgS,IAC7DvW,EAAKuE,KAAK2a,IAAID,GAAStgB,EACvBsB,EAAKsE,KAAK4a,IAAIF,GAAStgB,EACvB8f,EAAM,IAAuB,IAAhBla,KAAKC,SACxB6Z,GAAUnoB,KAAK,CACbiL,KAAM,QACNM,EAAG4d,EACH3d,EAAGic,EACH3d,KACAC,KACAwe,MACAI,OAAQJ,EACRrgB,OAAQ,EAAoB,EAAhBmG,KAAKC,SACjB1F,MAAO,WAEX,CACF,CA2FIwgB,CAAqBjiB,GAAO+N,QAAU,CAAC,KAEzC9R,OAAOyT,iBAAiB,aAAe1P,IACrC2hB,GAAwB3hB,GAAO+N,QAAU,CAAC,KAE5C9R,OAAOyT,iBAAiB,iBAAmB1P,KApD7C,SAA4B+N,EAAS,CAAC,GACpC2T,GAAgB3T,EAAQ,CACtBqT,IAAK,IACLE,YAAqC,IAAvBvT,EAAOhN,QAAU,IAC/BwgB,UAAmC,KAAvBxT,EAAOhN,QAAU,IAC7B0gB,UAAW,EACXhgB,MAAO,YAETkgB,GAAwB,CAAE1E,OAAQlP,EAAOkP,OAAQlc,OAAQgN,EAAOhN,QAAU,IAC5E,CA4CImhB,CAAmBliB,GAAO+N,QAAU,CAAC,KAEvC9R,OAAOyT,iBAAiB,sBAAwB1P,IAC9CmiB,GAAwBniB,GAAO+N,QAAU,CAAC,KAE5C9R,OAAOyT,iBAAiB,wBAA0B1P,KAuEpD,SAAyB+N,EAAS,CAAC,GACjC,MAAMiU,EAAQjU,EAAO3J,GAAK,EACpBkc,EAAQvS,EAAO1J,GAAK,EACpBtD,EAASgN,EAAOhN,QAAU,IAChCogB,GAAe,CACb/c,EAAG4d,EACH3d,EAAGic,EACHgB,YAAsB,GAATvgB,EACbwgB,UAAoB,KAATxgB,EACXU,MAAO,UACPggB,UAAW,EACXL,IAAK,MAEP,IAAK,IAAI/pB,EAAI,EAAGA,EAAI,GAAIA,GAAK,EAAG,CAC9B,MAAMuqB,EAAQ1a,KAAKC,SAAWD,KAAKgS,GAAK,EAClC5X,EAAQ,IAAsB,IAAhB4F,KAAKC,SACnBia,EAAM,IAAuB,IAAhBla,KAAKC,SACxB6Z,GAAUnoB,KAAK,CACbiL,KAAM,QACNM,EAAG4d,EACH3d,EAAGic,EACH3d,GAAIuE,KAAK2a,IAAID,GAAStgB,EACtBsB,GAAIsE,KAAK4a,IAAIF,GAAStgB,EACtB8f,MACAI,OAAQJ,EACRrgB,OAAQ,EAAoB,EAAhBmG,KAAKC,SACjB1F,MAAO,WAEX,CACF,CAnGI2gB,CAAgBpiB,GAAO+N,QAAU,CAAC,KAEpC9R,OAAOyT,iBAAiB,wBAA0B1P,IAChDqiB,GAAgBriB,GAAO+N,QAAU,CAAC,KAEpC9R,OAAOyT,iBAAiB,4BAA8B1P,KAkIxD,SAAiC+N,EAAS,CAAC,GACzCoT,GAAe,CACb/c,EAAG2J,EAAO3J,GAAK,EACfC,EAAG0J,EAAO1J,GAAK,EACfid,YAAsC,IAAxBvT,EAAOhN,QAAU,KAC/BwgB,UAAoC,KAAxBxT,EAAOhN,QAAU,KAC7BU,MAAO,UACPggB,UAAW,EACXL,IAAK,IAET,CA3IIkB,CAAwBtiB,GAAO+N,QAAU,CAAC,KAE5C9R,OAAOyT,iBAAiB,mBAAqB1P,KAxD/C,SAAuC+N,EAAS,CAAC,GAC/C,MACMwU,EAAa,CACjBC,SAAU,CAAC,UAAW,UAAW,WACjC5J,QAAS,CAAC,UAAW,UAAW,WAChC6J,SAAU,CAAC,UAAW,UAAW,WACjCC,QAAS,CAAC,UAAW,YAEjBC,EAAUJ,EAPCxU,EAAOuR,UAAY,YAOIiD,EAAWG,QAC7C3a,EAAYb,KAAK7E,IAAI,EAAG0L,EAAOhG,WAAagG,EAAOjG,QAAU,GAE7D8a,EAAY,GAAM,EADN1b,KAAK7E,IAAI,EAAG6E,KAAKQ,IAAIK,EAAWgG,EAAOjG,QAAUC,IAC3BA,EAAW,EAAG,GAChDhQ,EAAQmP,KAAK7E,IAAI,EAAG6E,KAAKgY,MAAM,EAAgB,EAAZ0D,IACnCC,EAAY,IAAkB,IAAZD,EACxB,IAAK,IAAIvrB,EAAI,EAAGA,EAAIU,EAAOV,GAAK,EAAG,CACjC,MAAMuqB,EAAQ1a,KAAKC,SAAWD,KAAKgS,GAAK,EAClC5X,EAAQuhB,GAAa,IAAuB,IAAhB3b,KAAKC,UACvC6Z,GAAUnoB,KAAK,CACbiL,KAAM,SACNM,EAAG2J,EAAO3J,GAAK,EACfC,EAAG0J,EAAO1J,GAAK,EACf1B,GAAIuE,KAAK2a,IAAID,GAAStgB,EACtBsB,GAAIsE,KAAK4a,IAAIF,GAAStgB,EAAQ,GAAM,GACpC8f,IAAK,IAAuB,GAAhBla,KAAKC,SACjBqa,OAAQ,IAAuB,GAAhBta,KAAKC,SACpBpG,OAAQ,EAAoB,EAAhBmG,KAAKC,SACjB1F,MAAOkhB,EAAQtrB,EAAIsrB,EAAQrrB,SAE/B,CACF,CA4BIwrB,CAA8B9iB,GAAO+N,QAAU,CAAC,KAElDmT,IAAoB,EACtB,CAEA,SAASiB,GAAwBpU,EAAS,CAAC,GACzC,MAAMiU,EAAQjU,EAAO3J,GAAK,EACpBkc,EAAQvS,EAAO1J,GAAK,EACpBtD,EAASgN,EAAOhN,QAAU,IAEhC,IAAK,IAAI1J,EAAI,EAAGA,EADF,GACaA,GAAK,EAAG,CACjC,MAAMuqB,EAAQ1a,KAAKC,SAAWD,KAAKgS,GAAK,EAClC5X,EAAQ,IAAsB,IAAhB4F,KAAKC,SACnBia,EAAM,GAAsB,IAAhBla,KAAKC,SACvB6Z,GAAUnoB,KAAK,CACbiL,KAAM,QACNM,EAAG4d,EACH3d,EAAGic,EACH3d,GAAIuE,KAAK2a,IAAID,GAAStgB,EACtBsB,GAAIsE,KAAK4a,IAAIF,GAAStgB,EACtB8f,MACAI,OAAQJ,EACRrgB,OAAQ,EAAoB,EAAhBmG,KAAKC,SACjB1F,MAAOyF,KAAKC,SAAW,IAAO,UAAY,WAE9C,CACAga,GAAe,CACb/c,EAAG4d,EACH3d,EAAGic,EACHgB,YAAsB,IAATvgB,EACbwgB,UAAoB,KAATxgB,EACXU,MAAO,UACPggB,UAAW,EACXL,IAAK,KAET,CAyDA,SAASiB,GAAgBtU,EAAS,CAAC,GACjC,MAAMiU,EAAQjU,EAAO3J,GAAK,EACpBkc,EAAQvS,EAAO1J,GAAK,EACpBtD,EAASgN,EAAOhN,QAAUgN,EAAOgV,WAAa,IAEpD,IAAK,IAAI1rB,EAAI,EAAGA,EADF,GACaA,GAAK,EAAG,CACjC,MAAMuqB,EAAQ1a,KAAKC,SAAWD,KAAKgS,GAAK,EAClC5X,EAAQ,GAAqB,GAAhB4F,KAAKC,SAClBxE,EAAKuE,KAAK2a,IAAID,GAAStgB,EAAQ,GAC/BsB,GAAM,GAAqB,GAAhBsE,KAAKC,SAChBia,EAAM,GAAsB,GAAhBla,KAAKC,SACvB6Z,GAAUnoB,KAAK,CACbiL,KAAM,QACNM,EAAG4d,EAAQ9a,KAAK2a,IAAID,GAAS7gB,EAAS,GACtCsD,EAAGic,EAAQpZ,KAAK4a,IAAIF,GAAS7gB,EAAS,GACtC4B,KACAC,KACAwe,MACAI,OAAQJ,EACRrgB,OAAQA,GAAU,IAAuB,IAAhBmG,KAAKC,UAC9B1F,MAAO,WAEX,CACA0f,GAAe,CACb/c,EAAG4d,EACH3d,EAAGic,EACHgB,YAAsB,GAATvgB,EACbwgB,UAAoB,IAATxgB,EACXU,MAAO,UACPggB,UAAW,EACXL,IAAK,IAET,CCtRA,SAAS4B,GAAwBpH,EAAU7a,EAAQkiB,EAAW,KAC5D,MACMC,EAAU,GAAM,EAAItH,EADJ1U,KAAK7E,IAAI,EAAGtB,GACkB,EAAG,GACvD,OAAO,GAAMkiB,EAAWC,GAAW,EAAID,GAAW,EAAG,EACvD,CAEA,SAASE,IAAsB,EAC7B/e,EAAC,EACDC,EAAC,OACDtD,EAAM,UACNif,EAAY,EAAC,aACboD,EAAe,EAAC,eAChBnD,EAAiB,IAAI,gBACrBjd,EAAkB,EAAC,mBACnBC,EAAqB,EAAC,qBACtBogB,GAAuB,EAAI,eAC3BC,GAAiB,EAAI,cACrBC,GAAgB,IAEhB,MAAMC,EAAU,CACdC,UAAU,EACVC,WAAY,EACZC,WAAW,GAGPC,EAAY1c,KAAK7E,IAAI,EAAG2d,GACxB6D,EAAe3c,KAAK7E,IAAI,EAAG+gB,GAA4B,IAAZQ,GAC3CE,EAAa5c,KAAK7E,IAAI,EAAGtB,GACzBkiB,EAAW,GAAMhD,EAAgB,EAAG,GAE1C,GAAIoD,GAAwBjY,EAActD,OAAS,EAAG,CACpD,MAAMic,EAAS3Y,EAAchH,EACvB4f,EAAS5Y,EAAc/G,EAA2B,IAAvB+G,EAAclH,OACzC0X,EAAW1U,KAAK2U,MAAMkI,EAAS3f,EAAG4f,EAAS3f,GACjD,GAAIuX,GAAYkI,EAAY,CAC1B,MAAMG,EAAQjB,GAAwBpH,EAAUkI,EAAYb,GAEtDhiB,EAAY4iB,EAAeI,EAEjC/F,GAAmB,CACjBld,OAJa4iB,EAAYK,EAKzBhjB,YACAC,OAAoB,IAAZD,EACRoG,OALa0c,GAAU3f,EAAI,GAAK,IAOlCof,EAAQC,UAAW,CACrB,CACF,CAEA,GAAIH,EACF,IAAK,MAAMtJ,KAAS3O,EAAS,CAC3B,GAAI2O,EAAMlS,QAAU,EAClB,SAEF,MAAMoc,EAASlK,EAAM5V,EACf+f,EAASnK,EAAM3V,EAAmB,GAAf2V,EAAM9V,OACzB0X,EAAW1U,KAAK2U,MAAMqI,EAAS9f,EAAG+f,EAAS9f,GACjD,GAAIuX,EAAWkI,EACb,SAEF,MAAMG,EAAQjB,GAAwBpH,EAAUkI,EAAYb,GACtDjiB,EAAS4iB,EAAYK,EACrBhjB,EAAY4iB,EAAeI,EAE7BjjB,GAAU,GAAKC,GAAa,IAGhCod,GAAmBrE,EAAO,CACxBhZ,SACAC,YACAC,OAAoB,IAAZD,EACRoG,OARa6c,GAAU9f,EAAI,GAAK,IAUlCof,EAAQE,YAAc,EACxB,CAGF,GAAIH,GAAiBla,EAASvB,OAAS,EAAG,CACxC,MACMsc,EAAevd,EADRwC,EAASQ,aAAe,CAAEnE,WAAY,GAAIC,WAAY,GAAIC,UAAW,KAE5Eye,EAAgBhb,EAAShF,EAAmB,GAAf+f,EAC7BxI,EAAW1U,KAAK2U,MAAMxS,EAASjF,EAAIA,EAAGigB,EAAgBhgB,GAC5D,GAAIuX,GAAYkI,EAAY,CAC1B,MAAMG,EAAQjB,GAAwBpH,EAAUkI,EAAYb,GACtDjiB,EAASkG,KAAK7E,IAAI,EAAGuhB,EAAYK,EAAQjhB,GACzC/B,EAAY4iB,EAAeI,EAAQhhB,EACnCoE,EAASgC,EAASjF,GAAKA,EAAI,GAAK,GAClCpD,EAAS,GAAKC,EAAY,KAC5Bqd,GAAoB,KAAM,CACxBtd,SACAC,YACAC,OAAoB,IAAZD,EACRoG,WAEFmc,EAAQG,WAAY,EAExB,CACF,CAEA,OAAOH,CACT,CCnGA,SAASc,GAAUC,GACjB,MAAM9D,EAAY8D,EAAa9D,WAAa8D,EAAane,MAAQ,EAKjE,MAAO,CAAE9H,KAJIimB,EAAangB,EAAIqc,EAIfliB,MAHDgmB,EAAangB,EAAIqc,EAGTna,IAFVie,EAAalgB,EAAIkgB,EAAargB,OAEfsgB,OADZD,EAAalgB,EAE9B,CAEA,SAASogB,GAA6BrgB,EAAGC,EAAGtD,EAAQwjB,GAClD,MAAM,KAAEjmB,EAAI,MAAEC,EAAK,IAAE+H,EAAG,OAAEke,GAAWF,GAAUC,GAGzChJ,EAAKnX,EAFM,GAAMA,EAAG9F,EAAMC,GAG1Bid,EAAKnX,EAFM,GAAMA,EAAGiC,EAAKke,GAG/B,OAAOjJ,EAAKA,EAAKC,EAAKA,GAAMza,EAASA,CACvC,CAEA,SAAS2jB,GAAuBtgB,EAAGC,EAAGkgB,GACpC,MAAM,KAAEjmB,EAAI,MAAEC,EAAK,IAAE+H,EAAG,OAAEke,GAAWF,GAAUC,GACzChJ,EAAKrU,KAAK7E,IAAI/D,EAAO8F,EAAG,EAAGA,EAAI7F,GAC/Bid,EAAKtU,KAAK7E,IAAIiE,EAAMjC,EAAG,EAAGA,EAAImgB,GACpC,OAAOtd,KAAK2U,MAAMN,EAAIC,EACxB,CAuFA,SAASmJ,GAAmBJ,EAAcpG,EAAM,CAAC,GAC/C,IAAKoG,GAAgBA,EAAa7D,UAChC,MAAO,CAAEkE,SAAS,EAAOlE,WAAW,GAGtC,MAAMF,EAAW+D,EAAa/D,SACxBxf,EAASkG,KAAK7E,IAAI,EAAG8b,EAAInd,QAAU,GACzC,GAAIA,GAAU,EACZ,MAAO,CAAE4jB,SAAS,EAAOlE,WAAW,GAGtC,MAAMmE,EAAgB3d,KAAKQ,IAAI1G,EAAQujB,EAAazc,QACpDyc,EAAazc,OAASZ,KAAK7E,IAAI,EAAGkiB,EAAazc,OAAS+c,GACxDN,EAAajc,WAAa,GAC1Bic,EAAahc,WAAarB,KAAKQ,IAAI,IAAM6c,EAAahc,WAAa,IAAQsc,EAAgBN,EAAaxc,UAAa,IACrH,MAAM+c,EAAYtE,GAAUZ,aAAe,GAC3C2E,EAAa/b,eAAiBtB,KAAK7E,IAAkC,GAA9BkiB,EAAa/b,eAAsBsc,GAAa,IAAQD,EAAgBN,EAAaxc,UAAa,MACzIwc,EAAa5D,WAAazZ,KAAKQ,IAAI8Y,GAAUjd,eAAiB,GAAIghB,EAAa5D,YAAc,GAAK,IAtGpG,SAA4B4D,EAAcpG,EAAM,CAAC,GACzB,oBAAXliB,QACTA,OAAO2gB,cACL,IAAIC,YAAY,mBAAoB,CAClC9O,OAAQ,CACNlW,GAAI0sB,EAAa1sB,GACjBiM,KAAMygB,EAAazgB,KACnBwb,SAAUiF,EAAa/D,UAAUlB,UAAY,UAC7CyF,MAAO5G,EAAI4G,OAAS,SACpB3gB,EAAG+Z,EAAI6G,SAAWT,EAAangB,EAC/BC,EAAG8Z,EAAI8G,SAAWV,EAAalgB,EAA0B,GAAtBkgB,EAAargB,OAChD4D,OAAQyc,EAAazc,OACrBC,UAAWwc,EAAaxc,aAKlC,CAsFEmd,CAAmBX,EAAcpG,GAEjC,IAAIuC,GAAY,EAShB,OARI6D,EAAazc,QAAU,IACzByc,EAAa7D,WAAY,EACzB6D,EAAa3D,YAAc1Z,KAAK7E,IAAIkiB,EAAa3D,YAAa,KAC9D2D,EAAa5D,WAAaH,GAAUjd,eAAiB,EA1FzD,SAAkCghB,EAAcpG,EAAM,CAAC,GACrD,MAAMqC,EAAW+D,EAAa/D,SAC9B,IAAKA,GAAY+D,EAAa1D,eAC5B,OAEF0D,EAAa1D,gBAAiB,EAC9B,MAAMxI,EAAU8F,EAAI6G,SAAWT,EAAangB,EACtC+gB,EAAUhH,EAAI8G,SAAYV,EAAalgB,EAA0B,IAAtBkgB,EAAargB,OAuB9D,GArBAie,GAAwB,CACtB/d,EAAGiU,EACHhU,EAAG8gB,EACHpkB,OAA4D,GAApDmG,KAAK7E,IAAIkiB,EAAane,MAAOme,EAAargB,UAEpDme,GAAgB,CACdje,EAAGiU,EACHhU,EAAG8gB,EACHpkB,OAAQmG,KAAK7E,IAAIkiB,EAAane,MAAOme,EAAargB,QAClD6e,UAAuE,IAA3DvC,EAAST,YAAYhf,QAA+B,IAArBwjB,EAAane,SAE1D+a,GAAe,CACb/c,EAAGiU,EACHhU,EAAG8gB,EACH7D,YAAkC,IAArBiD,EAAane,MAC1Bmb,UAAgC,IAArBgD,EAAane,MACxB3E,MAAO,UACP2f,IAAK,IACLK,UAAW,IAGTjB,EAAST,WAAY,CACvB,MAAMqF,EAAQ5E,EAAST,WACD,oBAAX9jB,QACTA,OAAO2gB,cACL,IAAIC,YAAY,yBAA0B,CACxC9O,OAAQ,CACNlW,GAAI0sB,EAAa1sB,GACjBuM,EAAGiU,EACHhU,EAAG8gB,EACHpkB,OAAQqkB,EAAMrkB,WAMtBoiB,GAAsB,CACpB/e,EAAGiU,EACHhU,EAAG8gB,EACHpkB,OAAQqkB,EAAMrkB,OACdif,UAAWoF,EAAMpF,UACjBoD,aAAcgC,EAAMnkB,UACpBgf,eAAgBmF,EAAMnF,gBAAkB,MAG1CoF,GAA4B,CAC1BjhB,EAAGiU,EACHhU,EAAG8gB,EACHpkB,OAAQqkB,EAAMrkB,OACdif,UAAWoF,EAAMpF,UACjBC,eAAgBmF,EAAMnF,gBAAkB,IACxCqF,SAAUf,EAAa1sB,GACvBktB,MAAO,mBAEX,CACF,CA2BIQ,CAAyBhB,EAAcpG,GACvCuC,GAAY,GAGP,CAAEkE,SAAS,EAAMlE,YAC1B,CAEA,SAAS2E,IAA4B,EAAEjhB,EAAC,EAAEC,EAAC,OAAEtD,EAAM,UAAEif,EAAS,eAAEC,EAAiB,IAAI,SAAEqF,EAAW,KAAI,MAAEP,EAAQ,cAC9G,MAAMS,EAAYte,KAAK7E,IAAI,EAAG2d,GAAa,GAC3C,GAAIwF,GAAa,GAAKzkB,GAAU,EAC9B,OAAO,EAGT,MAAMkiB,EAAW,GAAMhD,EAAgB,EAAG,GAC1C,IAAIwF,EAAO,EACX,IAAK,MAAMlB,KAAgBlE,GAAe,CACxC,GAAIkE,EAAa1sB,KAAOytB,GAAaf,EAAa7D,WAAa6D,EAAa1D,eAC1E,SAEF,MAAMjF,EAAW8I,GAAuBtgB,EAAGC,EAAGkgB,GAC9C,GAAI3I,EAAW7a,EACb,SAEF,MACMC,EAASwkB,EADCxC,GAAwBpH,EAAU7a,EAAQkiB,GAEtDjiB,GAAU,GAKC2jB,GAAmBJ,EAAc,CAAEvjB,SAAQ+jB,QAAOC,QAFjD,GAAM5gB,EAAGmgB,EAAangB,EAAImgB,EAAa9D,UAAW8D,EAAangB,EAAImgB,EAAa9D,WAEtBwE,QAD1D,GAAM5gB,EAAGkgB,EAAalgB,EAAIkgB,EAAargB,OAAQqgB,EAAalgB,KAEjEugB,UACTa,GAAQ,EAEZ,CACA,OAAOA,CACT,CAEA,SAASC,GAA0BrkB,GACjC,IAAK,MAAMkjB,KAAgBlE,GACzB,IAAIkE,EAAa7D,WAGb+D,GAA6BpjB,EAAW+C,EAAG/C,EAAWgD,EAAGhD,EAAWN,OAAQwjB,GAO9E,OANAI,GAAmBJ,EAAc,CAC/BvjB,OAAQK,EAAWL,QAAU,EAC7B+jB,MAAO,aACPC,QAAS3jB,EAAW+C,EACpB6gB,QAAS5jB,EAAWgD,KAEf,EAGX,OAAO,CACT,CAEA,SAASshB,GAAsBC,GAC7B,IAAIzH,GAAM,EACV,IAAK,MAAMoG,KAAgBlE,GACrBkE,EAAa7D,WAAakF,EAAOC,WAAWC,IAAIvB,EAAa1sB,KAG7D4sB,GAA6BmB,EAAOxhB,EAAGwhB,EAAOvhB,EAAGuhB,EAAO7kB,OAAQwjB,KAClEqB,EAAOC,WAAWE,IAAIxB,EAAa1sB,IACnC8sB,GAAmBJ,EAAc,CAC/BvjB,OAAQ4kB,EAAO5kB,QAAU,EACzB+jB,MAAO,QACPC,QAASY,EAAOxhB,EAChB6gB,QAASW,EAAOvhB,IAElB8Z,GAAM,GAGV,OAAOA,CACT,CChNA,MAAM6H,GAAc,GAEpB,SAASlK,IAAgB,EACvB1X,EAAC,EACDC,EAAC,GACD1B,EAAE,GACFC,EAAE,OACF7B,EAAS,EAAC,SACVQ,EAAW,IAAG,MACdE,EAAQ,UAAS,OACjBT,EAAS,EAAC,UACVC,EAAY,EAAC,OACboG,EAAS,EAAC,cACV7F,EAAgB,KAEhBwkB,GAAYntB,KAAK,CACfuL,IACAC,IACA1B,KACAC,KACA7B,SACA2Z,KAAMnZ,EACNoZ,QAASpZ,EACTE,QACAT,SACAC,YACAoG,SACA7F,gBACAqkB,WAAY,IAAII,KAEpB,CAEA,SAASC,GAAcC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GACzC,MAAMjL,EAAK4K,EAAKG,EACV9K,EAAK4K,EAAKG,EACVE,EAAQJ,EAAKG,EACnB,OAAOjL,EAAKA,EAAKC,EAAKA,GAAMiL,EAAQA,CACtC,CChCA,MAAMC,GAAa,GACbC,GAAc,GAEpB,SAASC,GAAuB9iB,EAAMiK,EAAS,CAAC,GACxB,oBAAX9R,QAGXA,OAAO2gB,cAAc,IAAIC,YAAY/Y,EAAM,CAAEiK,WAC/C,CAsKA,SAAS8Y,GAASC,GAChB,GAAIA,EAAQC,UACV,OAGFD,EAAQC,WAAY,EACpBD,EAAQE,eAAiB9f,KAAK7E,IAAIykB,EAAQ/jB,kBAAmB,KAC7D+jB,EAAQG,KAAO,EAEf,MAAMC,EAAa,CACjBrvB,GAAIivB,EAAQjvB,GACZqL,WAAY4jB,EAAQ5jB,WACpBkB,EAAG0iB,EAAQ1iB,EACXC,EAAGyiB,EAAQziB,EACXtD,OAAQ+lB,EAAQrkB,iBAGlB,OAAQqkB,EAAQ5jB,YACd,IAAK,SAvFT,SAA0B4jB,GACxB,MAAM,EAAE1iB,EAAC,EAAEC,EAAC,gBAAE5B,EAAe,aAAEW,EAAY,mBAAEC,GAAuByjB,EAC9D/iB,EAAWmD,KAAK7E,IAAI,GAAKe,GAE/B,GAAIgI,EAActD,OAAS,EAAG,CAC5B,MAAMyT,EAAKnQ,EAAchH,EAAIA,EACvBoX,EAAMpQ,EAAc/G,EAA2B,IAAvB+G,EAAclH,OAAiBG,EACzD6C,KAAK2U,MAAMN,EAAIC,IAAO/Y,IACxB2I,EAAc9C,WAAapB,KAAK7E,IAAI+I,EAAc9C,WAAuB,GAAXvE,GAC9DqH,EAAc7C,WAAarB,KAAK7E,IAAI+I,EAAc7C,WAAuB,GAAXxE,GAC9DqH,EAAc5C,eAAiBtB,KAAK7E,IAAI+I,EAAc5C,eAAgB,IAE1E,CAEA,IAAK,MAAMwR,KAAS3O,EAAS,CAC3B,GAAI2O,EAAMlS,QAAU,EAClB,SAEF,MAAMyT,EAAKvB,EAAM5V,EAAIA,EACfoX,EAAMxB,EAAM3V,EAAmB,GAAf2V,EAAM9V,OAAgBG,EACxC6C,KAAK2U,MAAMN,EAAIC,IAAO/Y,IACxBuX,EAAMrR,UAAYzB,KAAK7E,IAAI2X,EAAMrR,WAAa,EAAG5E,GACjDiW,EAAM1R,WAAapB,KAAK7E,IAAI2X,EAAM1R,WAAuB,GAAXvE,GAC9CiW,EAAMzR,WAAarB,KAAK7E,IAAI2X,EAAMzR,WAAuB,GAAXxE,GAC9CiW,EAAMxR,eAAiBtB,KAAK7E,IAAI2X,EAAMxR,eAAgB,IAE1D,CAEA,GAAInF,EAAqB,GAAKgG,EAASvB,OAAS,EAAG,CACjD,MACMsc,EAAevd,EADRwC,EAASQ,aAAe,CAAEnE,WAAY,GAAIC,WAAY,GAAIC,UAAW,KAE5Eye,EAAgBhb,EAAShF,EAAmB,GAAf+f,EAC7B7I,EAAKlS,EAASjF,EAAIA,EAClBoX,EAAK6I,EAAgBhgB,EACvB6C,KAAK2U,MAAMN,EAAIC,IAAO/Y,IACxB4G,EAASuB,gBAAkB1D,KAAK7E,IAAIgH,EAASuB,iBAAmB,EAAGvH,GACnEgG,EAASV,UAAYzB,KAAK7E,IAAIgH,EAASV,WAAa,EAAwB,GAArBtF,GAE3D,CACF,CAiDM8jB,CAAiBL,GACjBI,EAAWnmB,OAAS+lB,EAAQrkB,gBAC5BykB,EAAW9jB,aAAe0jB,EAAQ1jB,aAClC8jB,EAAW7jB,mBAAqByjB,EAAQzjB,mBACxCujB,GAAuB,wBAAyB,IAC3CM,EACH9jB,aAAc0jB,EAAQ1jB,aACtBC,mBAAoByjB,EAAQzjB,qBAE9B,MAEF,IAAK,QAAS,CACZ,MAAM+jB,EA3DZ,SAAyBN,GACvB,MAAM/iB,EAAWmD,KAAK7E,IAAI,GAAKykB,EAAQvjB,eACjCxC,EAASmG,KAAK7E,IAAI,GAAIykB,EAAQtjB,aAC9B4jB,EAAQ,CACZvvB,GAAI,SAASqY,KAAKF,SAAS9I,KAAKC,SAASlN,SAAS,IAAImN,MAAM,EAAG,KAC/DhD,EAAG0iB,EAAQ1iB,EACXC,EAAGyiB,EAAQziB,EACXtD,SACAsmB,WAAYtmB,EACZgiB,UAAWhiB,GAAU+lB,EAAQrjB,gBAAkB,KAC/CM,WACA2W,KAAM3W,EACNujB,eAAgB,GAAMR,EAAQpjB,qBAAuB,IAAM,GAAK,GAChE6jB,KAAMT,EAAQnjB,mBAAqB,GACnC6jB,UAAW,GAWb,OATAb,GAAY9tB,KAAKuuB,GACjBR,GAAuB,wBAAyB,CAC9C/uB,GAAIuvB,EAAMvvB,GACVuM,EAAGgjB,EAAMhjB,EACTC,EAAG+iB,EAAM/iB,EACTtD,OAAQqmB,EAAMrmB,OACdgiB,UAAWqE,EAAMrE,UACjBhf,SAAUqjB,EAAMrjB,WAEXqjB,CACT,CAiCoBK,CAAgBX,GAC9BI,EAAWnmB,OAASqmB,EAAMrE,UAC1BmE,EAAWnjB,SAAWqjB,EAAMrjB,SAC5BmjB,EAAWQ,QAAUN,EAAMvvB,GAC3B+uB,GAAuB,2BAA4B,IAC9CM,EACHnmB,OAAQqmB,EAAMrE,UACdhf,SAAUqjB,EAAMrjB,SAChB2jB,QAASN,EAAMvvB,KAEjB,KACF,CACA,SAjJJ,SAA8BivB,GAC5B,MAAM,EAAE1iB,EAAC,EAAEC,EAAC,gBAAE5B,EAAe,OAAEzB,EAAM,UAAEC,GAAc6lB,EACrD3D,GAAsB,CACpB/e,IACAC,IACAtD,OAAQ0B,EACRud,UAAWhf,EACXoiB,aAAcniB,EACdgf,eAAgB6G,EAAQa,eAAiB,GACzC3kB,gBAAiB8jB,EAAQ9jB,iBAAmB,EAC5CC,mBAAoB6jB,EAAQ7jB,oBAAsB,IAGhDjC,EAAS,GACXqkB,GAA4B,CAC1BjhB,IACAC,IACAtD,OAAQ0B,EACRud,UAAWhf,EACXif,eAAgB6G,EAAQc,qBAAuB,IAC/C7C,MAAO+B,EAAQ5jB,YAAc,cJ4FnC,SAA8B6K,EAAS,CAAC,GACtC,MAAMiU,EAAQjU,EAAO3J,GAAK,EACpBkc,EAAQvS,EAAO1J,GAAK,EACpBtM,EAAQgW,EAAOhW,OAAS,GAExB8vB,GADS9Z,EAAOhN,OACJgN,EAAOzM,OAAS,KAC5BqhB,EAAU5U,EAAO4U,SAAW,CAAC,UAAW,UAAW,UAAW,WACpE,IAAK,IAAItrB,EAAI,EAAGA,EAAIU,EAAOV,GAAK,EAAG,CACjC,MAAMuqB,EAAQ1a,KAAKC,SAAWD,KAAKgS,GAAK,EAClC5X,EAAQumB,GAAa,IAAuB,IAAhB3gB,KAAKC,UACjC0R,EAA+B,IAAvB3R,KAAKC,SAAW,IAC9B6Z,GAAUnoB,KAAK,CACbiL,KAAM,SACNM,EAAG4d,EAAQ9a,KAAK2a,IAAID,IAAU7T,EAAO+Z,cAAgB,GACrDzjB,EAAGic,EAAQpZ,KAAK4a,IAAIF,IAAU7T,EAAO+Z,cAAgB,GACrDnlB,GAAIuE,KAAK2a,IAAID,EAAQ/I,GAAQvX,EAC7BsB,GAAIsE,KAAK4a,IAAIF,EAAQ/I,GAAQvX,EAAQ,GAAM,GAC3C8f,IAAK,GAAsB,GAAhBla,KAAKC,SAChBqa,OAAQ,GAAsB,GAAhBta,KAAKC,SACnBpG,OAAQ,EAAoB,EAAhBmG,KAAKC,SACjB1F,MAAOkhB,EAAQtrB,EAAIsrB,EAAQrrB,SAE/B,CACF,CI/GEywB,CAAqB,CACnB3jB,IACAC,IACAtD,OAAQ0B,EACR1K,MAAOmP,KAAK7E,IAAI,GAAI6E,KAAKgY,MAAMzc,EAAkB,KACjDnB,MAAO,IAAoC,GAA9B4F,KAAK7E,IAAI,EAAGpB,GAAa,IAE1C,EAmHM+mB,CAAqBlB,GACrBI,EAAWlmB,OAAS8lB,EAAQ9lB,OAC5BkmB,EAAWjmB,UAAY6lB,EAAQ7lB,UAC/B2lB,GAAuB,sBAAuB,IACzCM,EACHlmB,OAAQ8lB,EAAQ9lB,OAChBC,UAAW6lB,EAAQ7lB,YAMzB2lB,GAAuB,qBAAsBM,EAC/C,CClPA,MAAMe,GAAoB,CACxBvmB,KAAM,CACJ7J,GAAI,OACJ8O,MAAO,aACPtG,YAAa,kDACb6nB,OAAQ,IACRC,WAAY,UACZC,UAAW,WAEbC,OAAQ,CACNxwB,GAAI,SACJ8O,MAAO,eACPtG,YAAa,sDACb6nB,OAAQ,IACRC,WAAY,UACZC,UAAW,WAEbE,MAAO,CACLzwB,GAAI,QACJ8O,MAAO,gBACPtG,YAAa,iDACb6nB,OAAQ,GACRC,WAAY,UACZC,UAAW,UACXnc,SAAU,kBCfRsc,GAAc,GACdC,GAAU,CACdC,cDkBc,GCjBdC,eAAgBC,KAChBC,gBAAiB,KACjBC,cAAe,EACfC,iBAAkB,EAClBC,cAAe,KACfC,YAAa,EACbC,eDqBkB,ICpBlBC,aAAc,GAOhB,SAASP,KACP,MAAMQ,EAAUzrB,OAAOyN,OAAO8c,IAC9B,GAAuB,IAAnBkB,EAAQ7xB,OACV,OAAO,KAET,MAAM8xB,EAAcD,EAAQE,OAAO,CAACC,EAAK5c,IAAU4c,GAAO5c,EAAMwb,QAAU,GAAI,GAC9E,IAAIxpB,EAAOwI,KAAKC,SAAWiiB,EAC3B,IAAK,MAAM1c,KAASyc,EAAS,CAC3B,MAAMjB,EAASxb,EAAMwb,QAAU,EAC/B,GAAIxpB,GAAQwpB,EACV,OAAOxb,EAAM7U,GAEf6G,GAAQwpB,CACV,CACA,OAAOiB,EAAQA,EAAQ7xB,OAAS,GAAGO,EACrC,CAiEA,SAAS0xB,GAAsBC,GAC7B,OAAQA,GACN,IAAK,SAhBPngB,EAASvB,OAASZ,KAAKQ,IAAI2B,EAAStB,UAAWsB,EAASvB,OADrC,IAEnBuB,EAASZ,gBAAkBvB,KAAK7E,IAAIgH,EAASZ,gBDnD5B,ICoEb+f,GAAQO,cAAgB,kBACxB,MACF,IAAK,SAhBT,WACE,MAAMU,EAAYxB,GAAkBK,MAC9Brc,EAAWwd,GAAWxd,UAAY,KACpCA,GAAY,EAAmBA,KzBtErC,SAA8BA,GAAU,UAAEyd,GAAY,GAAU,CAAC,GAC/D,IAAKzd,IAAa,EAAmBA,GACnC,OAAO,EAET,IAAI5S,EAAQiS,EAAYC,UAAUO,QAAQG,IAC3B,IAAX5S,IACFiS,EAAYC,UAAU1S,KAAKoT,GAC3B5S,EAAQiS,EAAYC,UAAUjU,OAAS,GAErCoyB,EACFje,EAAuBpS,GAEvBuS,GAGJ,CyBwDI+d,CAAqB1d,EAAU,CAAEyd,WAAW,IAC5C1d,EAAgBC,GAChBe,EAAiBf,GAErB,EASM2d,GACApB,GAAQO,cAAgB,wBACxB,MAEF,SAvCJ,WACE,MAAMxd,EAAYI,IAClB,IAAK,MAAMM,KAAYV,EAAW,CAChC,MAAMmB,EAAQV,EAAgBC,GACzBS,GAASA,EAAMH,WAAaC,OAAOC,mBAGxCO,EAAiBf,EACnB,CACA5C,EAASsB,WAAY,CACvB,CA8BMkf,GACArB,GAAQO,cAAgB,gBAG5BP,GAAQQ,YAAcR,GAAQS,cAChC,CAEA,SAASa,GAAgBC,EAAMC,GAC7B,MAAMC,EAAU5gB,EAASjF,EACnB0C,EAAOuC,EAASQ,aAAeqgB,MAAMzkB,SACrC0kB,EAAc9gB,EAAShF,EAAIwC,EAAeC,GAG1CyU,EAAK0O,EAFUF,EAAK3lB,EAGpBoX,EAAK2O,GAFUJ,EAAK1lB,EAAkB,GAAd0lB,EAAK7lB,QAInC,OADiBgD,KAAK2U,MAAMN,EAAIC,IDhGlB,ICkGZuO,EAAK5gB,UAAY,GAAM4gB,EAAK5gB,UAAoB,EAAR6gB,EAAW,EAAG,IAC/C,IAETD,EAAK5gB,UAAY,GAAM4gB,EAAK5gB,UAAoB,EAAR6gB,EAAW,EAAG,IAC/C,EACT,CAEA,SAASI,GAAWL,GAClBR,GAAsBQ,EAAKP,QAC3BO,EAAKxiB,MAAQ,YACbwiB,EAAKM,aD1Ga,IC2GlBN,EAAK5gB,UAAY,CACnB,CAEA,SAASmhB,GAAkBN,GACzBxB,GAAQC,eAAiBuB,EACrBxB,GAAQC,eAAiB,GAAKF,GAAYjxB,ODvH9B,ICgBlB,SAAyBkyB,GACvB,MAAMjsB,EAAa0qB,GAAkBuB,IAAWvB,GAAkBvmB,KAG5D0C,EAAI,GAAMc,EAAOkB,OAAS,GAAsB,GAAhBc,KAAKC,UAAiBf,KAAalB,EAAOkB,MAAQA,MAElF2jB,EAAO,CACXlyB,GAAI,UAAU2wB,GAAQU,cAAgB,IACtCM,OAAQjsB,EAAW1F,GACnB8O,MAAOpJ,EAAWoJ,MAClBtG,YAAa9C,EAAW8C,YACxB8nB,WAAY5qB,EAAW4qB,YAAc,UACrCC,UAAW7qB,EAAW6qB,WAAa,UACnChiB,MAXY,GAYZlC,OAXa,GAYbE,IACAC,GAXa,IAYb1B,GD/BU,IC+BW,EAAhBuE,KAAKC,SAAe,GACzBvE,GAAI,EACJ2E,MAAO,aACPgjB,MAAO,EACPphB,UAAW,EACXkhB,aDhCY,GCiCZG,eAAgB,GAElBjC,GAAY1vB,KAAKkxB,GACjBvB,GAAQI,gBAAkB,GAAGrrB,EAAWoJ,iBACxC6hB,GAAQK,cAAgBL,GAAQM,gBAClC,CA4EI2B,CAAgBjC,GAAQE,gBA5G1BF,GAAQC,cDdK,GCPgB,GAAhBvhB,KAAKC,SAsBlBqhB,GAAQE,eAAiBC,MA+GrBH,GAAQK,cAAgB,IAC1BL,GAAQK,cAAgB3hB,KAAK7E,IAAI,EAAGmmB,GAAQK,cAAgBmB,IAE1DxB,GAAQQ,YAAc,IACxBR,GAAQQ,YAAc9hB,KAAK7E,IAAI,EAAGmmB,GAAQQ,YAAcgB,IAG1D,IAAK,IAAI3yB,EAAIkxB,GAAYjxB,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CACnD,MAAM0yB,EAAOxB,GAAYlxB,GAEzB,GADA0yB,EAAKQ,OAASP,EACK,eAAfD,EAAKxiB,MACPwiB,EAAKnnB,GAAKsE,KAAKQ,IDnIF,ICmI4CqiB,EAAKnnB,GDpI7C,ICoI6FonB,GAC9GD,EAAK1lB,GAAK0lB,EAAKnnB,GAAKonB,EACpBD,EAAK3lB,EAAI,GAAM2lB,EAAK3lB,EAAI2lB,EAAKpnB,GAAKqnB,EAAoB,GAAbD,EAAK3jB,MAAalB,EAAOkB,MAAqB,GAAb2jB,EAAK3jB,OAC/E2jB,EAAKS,gBAAkBR,EACnBD,EAAK1lB,GAAKiB,EAAWykB,EAAK7lB,SAC5B6lB,EAAK1lB,EAAIiB,EAAWykB,EAAK7lB,OACzB6lB,EAAKnnB,GAAK,EACVmnB,EAAKxiB,MAAQ,QACbwiB,EAAKQ,MAAQ,QAEV,GAAmB,UAAfR,EAAKxiB,OAEd,GADqBuiB,GAAgBC,EAAMC,GAEzCI,GAAWL,QAGX,GADAA,EAAKM,cAAgBL,EACjBD,EAAKM,cAAgB,EAAG,CAC1B9B,GAAY3vB,OAAOvB,EAAG,GACtB,QACF,OAEG,GAAmB,cAAf0yB,EAAKxiB,QACdwiB,EAAK5gB,UAAY,GAAM4gB,EAAK5gB,UAAoB,GAAR6gB,EAAa,EAAG,GACxDD,EAAKM,cAAgBL,EACjBD,EAAKM,cAAgB,GAAG,CAC1B9B,GAAY3vB,OAAOvB,EAAG,GACtB,QACF,CAEJ,CACF,CC/LA,SAASqzB,GAAUX,GACjB,MAAMY,EAA2B,cAAfZ,EAAKxiB,MAAwB,GAAMwiB,EAAKM,aFgCxC,IEhC8F,EAAG,GAAK,EAIxH,GAHAjlB,EAAQwlB,OACRxlB,EAAQylB,YAAcF,EAEH,eAAfZ,EAAKxiB,MAAwB,CAC/B,MAAMujB,EAA8B,IAAbf,EAAK3jB,MACtB2kB,EAA6B,GAAdhB,EAAK7lB,OAC1BkB,EAAQ4lB,UAAYjB,EAAK3B,UACzBhjB,EAAQ6lB,YACR7lB,EAAQ8lB,OAAOnB,EAAK3lB,EAAqB,GAAjB0mB,EAAsBf,EAAK1lB,EAAmB,GAAf0mB,GACvD3lB,EAAQ+lB,iBAAiBpB,EAAK3lB,EAAG2lB,EAAK1lB,EAAmB,GAAf0mB,EAAoBhB,EAAK3lB,EAAqB,GAAjB0mB,EAAsBf,EAAK1lB,EAAmB,GAAf0mB,GACtG3lB,EAAQgmB,YACRhmB,EAAQimB,OAERjmB,EAAQkmB,YAAcvB,EAAK3B,UAC3BhjB,EAAQqc,UAAY,EACpBrc,EAAQ6lB,YACR7lB,EAAQ8lB,OAAOnB,EAAK3lB,EAAqB,GAAjB0mB,EAAsBf,EAAK1lB,EAAmB,IAAf0mB,GACvD3lB,EAAQmmB,OAAOxB,EAAK3lB,EAAiB,IAAb2lB,EAAK3jB,MAAc2jB,EAAK1lB,EAAkB,GAAd0lB,EAAK7lB,QACzDkB,EAAQ8lB,OAAOnB,EAAK3lB,EAAqB,GAAjB0mB,EAAsBf,EAAK1lB,EAAmB,IAAf0mB,GACvD3lB,EAAQmmB,OAAOxB,EAAK3lB,EAAiB,IAAb2lB,EAAK3jB,MAAc2jB,EAAK1lB,EAAkB,GAAd0lB,EAAK7lB,QACzDkB,EAAQomB,QACV,CAEA,MAAMC,EAAW1B,EAAK3B,UAChB7I,EAAYwK,EAAK5B,WACjBuD,EAAiB3B,EAAK5gB,WAAa,EAEzC/D,EAAQ4lB,UAAYzL,EACpBna,EAAQumB,SAAS5B,EAAK3lB,EAAiB,GAAb2lB,EAAK3jB,MAAa2jB,EAAK1lB,EAAG0lB,EAAK3jB,MAAO2jB,EAAK7lB,QACrEkB,EAAQ4lB,UAAYS,EACpBrmB,EAAQumB,SAAS5B,EAAK3lB,EAAiB,GAAb2lB,EAAK3jB,MAAa2jB,EAAK1lB,EAAkB,IAAd0lB,EAAK7lB,OAAe6lB,EAAK3jB,MAAqB,IAAd2jB,EAAK7lB,QAE1FkB,EAAQkmB,YAAc,yBACtBlmB,EAAQqc,UAAY,EACpBrc,EAAQwmB,WAAW7B,EAAK3lB,EAAiB,GAAb2lB,EAAK3jB,MAAa2jB,EAAK1lB,EAAG0lB,EAAK3jB,MAAO2jB,EAAK7lB,QAEnEwnB,EAAiB,IACnBtmB,EAAQylB,YAA+B,GAAjBa,EACtBtmB,EAAQ4lB,UAAYjB,EAAK3B,UACzBhjB,EAAQ6lB,YACR7lB,EAAQymB,IAAI9B,EAAK3lB,EAAG2lB,EAAK1lB,EAAkB,GAAd0lB,EAAK7lB,OFXtB,GEWuE,EAAa,EAAVgD,KAAKgS,IAC3F9T,EAAQimB,QAGVjmB,EAAQ0mB,SACV,CCwJA,SAASC,GAAiBxH,EAAc5K,GACtC,MAAM6G,EAAW+D,EAAa/D,SAC9B,IAAKA,EACH,OAGF,MAAMwL,EAAWzH,EAAa/b,gBAAkB,EAC1CD,EAAagc,EAAahc,YAAc,EACxC0jB,EAAwB,EAAVtS,EAA+B,IAAjB4K,EAAangB,EACzC8nB,EAAS3jB,EAAa,EAAIrB,KAAK4a,IAAImK,GAAeD,EAAW,IAAO,EACpEG,EAAS5jB,EAAa,EAAIrB,KAAK2a,IAAkB,IAAdoK,GAAsBD,EAAW,IAAO,EASjF,GAPA5mB,EAAQwlB,OACRxlB,EAAQgnB,UAAU7H,EAAangB,EAAI8nB,EAAQ3H,EAAalgB,EAAI8nB,GAExD5H,EAAa7D,WAhLnB,SAAoB6D,EAAc/D,EAAU6L,GAC1C,MAAMjmB,EAAQme,EAAane,MACrBiZ,EAAenY,KAAK7E,IAAI,GAAIme,EAASnB,cAAgB,IAAMgN,GAC3D1M,EAAca,EAASb,aAAea,EAASjB,WAAa,UAClEna,EAAQ4lB,UAAYrL,EACpBva,EAAQ6lB,YACR7lB,EAAQ8lB,QAAQ9kB,EAAQ,EAAG,GAC3BhB,EAAQmmB,OAAgB,KAARnlB,EAA8B,IAAfiZ,GAC/Bja,EAAQmmB,OAAgB,KAARnlB,GAAeiZ,GAC/Bja,EAAQmmB,OAAe,IAARnlB,EAA8B,KAAfiZ,GAC9Bja,EAAQmmB,OAAe,IAARnlB,EAA8B,IAAfiZ,GAC9Bja,EAAQmmB,OAAOnlB,EAAQ,EAAG,GAC1BhB,EAAQgmB,YACRhmB,EAAQimB,OAERjmB,EAAQ4lB,UAAY,wBACpB5lB,EAAQumB,UAAUvlB,EAAQ,EAAG,EAAGA,EAAOc,KAAK7E,IAAI,EAAkB,GAAfgd,GACrD,CAgKIiN,CAAW/H,EAAc/D,EAAU,GAAM+D,EAAa3D,aAAe,EAAG,EAAG,KAGxE2D,EAAa7D,YAAc6D,EAAa3D,aAAe,GAAK,EAC/D,OAAQJ,EAASlB,UACf,IAAK,WAnKX,SAAuBiF,EAAc/D,GACnC,MAAMpa,EAAQme,EAAane,MACrBlC,EAASqgB,EAAargB,OACtBoC,GAAOpC,EACPmD,EAASkd,EAAald,QAAU,EAChCklB,EAAc,GAAM,EAAKhI,EAAazc,OAASyc,EAAaxc,UAAY,EAAG,GAEjF3C,EAAQwlB,OACRxlB,EAAQonB,MAAMnlB,EAAQ,GAEtB,MAAMkY,EAAYiB,EAASjB,WAAa,UAClCkN,EAAcjM,EAASV,YAAc,UACrCL,EAAce,EAASf,aAAe,UACtCD,EAAYgB,EAAShB,WAAa,UAElCkN,EAAUpmB,EAAe,IAATpC,EAChByoB,EAAuB,IAATzoB,EACdsQ,EAActN,KAAK7E,IAAI,GAAa,IAAT6B,GAEjCkB,EAAQ4lB,UAAYzL,EACpBna,EAAQ6lB,YACR7lB,EAAQ8lB,QAAQ9kB,EAAQ,EAAGsmB,EAAmB,GAATxoB,GACrCkB,EAAQmmB,OAAgB,KAARnlB,EAAcE,EAAoB,IAAdqmB,GACpCvnB,EAAQmmB,OAAgB,KAARnlB,EAAcE,GAC9BlB,EAAQmmB,OAAe,IAARnlB,EAAcE,GAC7BlB,EAAQmmB,OAAe,IAARnlB,EAAcE,EAAoB,GAAdqmB,GACnCvnB,EAAQmmB,OAAOnlB,EAAQ,EAAGsmB,EAAmB,GAATxoB,GACpCkB,EAAQgmB,YACRhmB,EAAQimB,OAERjmB,EAAQ4lB,UAAYyB,EACpB,MAAMG,EAA6B,IAAdD,EACrBvnB,EAAQumB,SAAkB,KAARvlB,EAAcE,EAAoB,IAAdqmB,EAA4B,IAARvmB,EAAcwmB,GAExExnB,EAAQ4lB,UAAYvL,EACpBra,EAAQumB,UAAUvlB,EAAQ,EAAGsmB,EAAwB,IAAdC,EAAoBvmB,EAAgB,GAATlC,GAElEkB,EAAQ4lB,UAAYxL,EACpBpa,EAAQ6lB,YACR7lB,EAAQymB,IAAa,KAARzlB,GAA6B,IAAfoO,EAAqBA,EAAa,EAAa,EAAVtN,KAAKgS,IACrE9T,EAAQymB,IAAY,IAARzlB,GAA6B,IAAfoO,EAAqBA,EAAa,EAAa,EAAVtN,KAAKgS,IACpE9T,EAAQimB,QAEH9G,EAAa7D,WAAa6L,EAAc,MAC3CnnB,EAAQkmB,YAAc,sBACtBlmB,EAAQqc,UAAY,EACpBrc,EAAQ6lB,YACR7lB,EAAQ8lB,OAAgB,KAAR9kB,EAAcE,EAAoB,GAAdqmB,GACpCvnB,EAAQmmB,OAAgB,KAARnlB,EAAcsmB,EAAmB,IAATxoB,GACxCkB,EAAQmmB,OAAgB,KAARnlB,EAAcsmB,EAAmB,GAATxoB,GACxCkB,EAAQomB,SAERpmB,EAAQ6lB,YACR7lB,EAAQ8lB,OAAe,IAAR9kB,EAAcE,EAAoB,GAAdqmB,GACnCvnB,EAAQmmB,OAAe,GAARnlB,EAAasmB,EAAmB,GAATxoB,GACtCkB,EAAQmmB,OAAe,IAARnlB,EAAcsmB,EAAmB,IAATxoB,GACvCkB,EAAQomB,UAGVpmB,EAAQ0mB,SACV,CAwGQe,CAActI,EAAc/D,GAC5B,MACF,IAAK,YAzGX,SAA2B+D,EAAc/D,EAAU7G,GACjD,MAAMvT,EAAQme,EAAane,MACrBlC,EAASqgB,EAAargB,OACtBqoB,EAAc,GAAM,EAAKhI,EAAazc,OAASyc,EAAaxc,UAAY,EAAG,GAC3E+kB,EAAuB,IAAR1mB,EACf2mB,EAAwB,IAAT7oB,EACfoC,GAAOpC,EACPqb,EAAYiB,EAASjB,WAAa,UAClCY,EAAcK,EAASL,aAAeK,EAASf,aAAe,UAC9DD,EAAYgB,EAAShB,WAAa,UAElCwN,EAAY,CAChB,CAAE5oB,EAAY,KAARgC,EAAc/B,EAAGiC,EAAe,IAATpC,GAC7B,CAAEE,EAAW,IAARgC,EAAc/B,EAAGiC,EAAe,GAATpC,GAC5B,CAAEE,EAAG,EAAGC,EAAGiC,EAAe,GAATpC,IAGb+oB,EAAe1I,EAAa7D,UAAY,EAAI,EAClD,IAAK,IAAIrpB,EAAI,EAAGA,EAAI41B,EAAc51B,GAAK,EAAG,CACxC,MAAM61B,EAAMF,EAAU31B,GACtB+N,EAAQwlB,OACRxlB,EAAQgnB,UAAUc,EAAI9oB,EAAG8oB,EAAI7oB,GAC7Be,EAAQ4lB,UAAYzL,EACpBna,EAAQ6lB,YACR7lB,EAAQ+nB,QAAQ,EAAG,EAAGL,EAA6B,GAAfC,EAAoB,EAAG,EAAa,EAAV7lB,KAAKgS,IACnE9T,EAAQimB,OAERjmB,EAAQumB,UAAUmB,EAA8B,IAAfC,EAAmC,EAAfD,EAAkBC,GAEvE3nB,EAAQ4lB,UAAY7K,EACpB/a,EAAQumB,UAAUmB,EAA8B,KAAfC,EAAoC,EAAfD,EAAiC,IAAfC,GAExE3nB,EAAQkmB,YAAc9L,EACtBpa,EAAQqc,UAAY,EACpBrc,EAAQwmB,YAAYkB,EAA8B,IAAfC,EAAmC,EAAfD,EAAkBC,GACzE3nB,EAAQ0mB,SACV,CAEA,IAAKvH,EAAa7D,WAAa6L,EAAc,GAAK,CAChD,MAAMa,EAAU,GAAgE,GAA1DlmB,KAAKmmB,IAAInmB,KAAK4a,IAAc,EAAVnI,EAA+B,IAAjB4K,EAAangB,IAAmBmoB,EACtFnnB,EAAQ4lB,UAAY,sBAAsBoC,EAAQE,QAAQ,MAC1DloB,EAAQ6lB,YACR7lB,EAAQ+nB,QAAQ,EAAG7mB,EAAe,GAATpC,EAAsB,IAARkC,EAAuB,IAATlC,EAAe,EAAG,EAAa,EAAVgD,KAAKgS,IAC/E9T,EAAQimB,MACV,CACF,CA6DQkC,CAAkBhJ,EAAc/D,EAAU7G,GAC1C,MACF,SAnON,SAAyB4K,EAAc/D,EAAU7G,GAC/C,MAAMvT,EAAQme,EAAane,MACrBlC,EAASqgB,EAAargB,OACtBoC,GAAOpC,EACPqb,EAAYiB,EAASjB,WAAa,OAClCE,EAAce,EAASf,aAAe,OACtCD,EAAYgB,EAAShB,WAAa,OAClCgO,EAAahN,EAASd,iBAAmB,UACzC6M,EAAc,GAAM,EAAKhI,EAAazc,OAASyc,EAAaxc,UAAY,EAAG,GAYjF,GAXA3C,EAAQ4lB,UAAYzL,EACpBna,EAAQumB,UAAUvlB,EAAQ,EAAGE,EAAKF,EAAOlC,GAEzCkB,EAAQ4lB,UAAYvL,EACpBra,EAAQumB,UAAUvlB,EAAQ,EAAGE,EAAKF,EAAOc,KAAK7E,IAAI,GAAa,IAAT6B,IACtDkB,EAAQumB,UAAUvlB,EAAQ,EAAGE,EAAe,IAATpC,EAAekC,EAAOc,KAAK7E,IAAI,EAAY,GAAT6B,IAErEkB,EAAQkmB,YAAc9L,EACtBpa,EAAQqc,UAAY,EACpBrc,EAAQwmB,YAAYxlB,EAAQ,EAAGE,EAAKF,EAAOlC,GAEvCqoB,EAAc,EAAG,CACnB,MAAMkB,EAAa,EAAIvmB,KAAKwmB,MAAoB,EAAdnB,GAC5BoB,EAAkB,EAAVhU,EAA+B,IAAjB4K,EAAangB,EACzCgB,EAAQkmB,YAAckC,EACtBpoB,EAAQqc,UAAY,EACpB,IAAK,IAAIpqB,EAAI,EAAGA,EAAIo2B,EAAYp2B,GAAK,EAAG,CACtC,MACMu2B,EAAkB,KAARxnB,EAAeA,IADf/O,EAAI,IAAMo2B,EAAa,IAEjCI,EAAc3pB,GAAU,GAAoB,GAAdqoB,GAC9BuB,EAAqC,GAA5B5mB,KAAK4a,IAAI6L,EAAY,IAAJt2B,GAChC+N,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO0C,EAAQtnB,EAAe,IAATpC,GAC7BkB,EAAQmmB,OAAOqC,EAAkB,GAATE,EAAcxnB,EAAe,IAATpC,EAA8B,IAAd2pB,GAC5DzoB,EAAQmmB,OAAOqC,EAASE,EAAQxnB,EAAe,IAATpC,EAAgB2pB,GACtDzoB,EAAQomB,QACV,CACF,CACF,CA+LQuC,CAAgBxJ,EAAc/D,EAAU7G,GAK9C,IAAK4K,EAAa7D,WAAa6D,EAAaxc,UAAY,EAAG,CACzD,MAAMimB,EAAc,GAAMzJ,EAAazc,OAASyc,EAAaxc,UAAW,EAAG,GACvEimB,EAAc,KAtEtB,SAAwB5nB,EAAO6d,EAAOgK,GACpC,MAAMC,EAAU,GAAMjK,EAAO,EAAG,GAC1BkK,EAAmB,IAAR/nB,EACjBhB,EAAQ4lB,UAAY,sBACpB5lB,EAAQumB,UAAUwC,EAAW,EAAGF,EAASE,EAAU,GACnD/oB,EAAQ4lB,UAAYkD,EAAU,GAAM,UAAYA,EAAU,IAAO,UAAY,UAC7E9oB,EAAQumB,UAAUwC,EAAW,EAAGF,EAASE,EAAWD,EAAS,EAC/D,CAgEME,CAAe7J,EAAane,MAAO4nB,GAAczJ,EAAargB,OAAS,GAE3E,CAEA,MAAMoE,EAAaic,EAAajc,YAAc,EAC9C,GAAIA,EAAa,EAAG,CAClB,MAAM+lB,EAAwC,IAAhC,GAAM/lB,EAAa,GAAK,EAAG,GACzClD,EAAQ4lB,UAAY,uBAAuBqD,EAAMf,QAAQ,MACzDloB,EAAQumB,UAAUpH,EAAane,MAAQ,GAAIme,EAAargB,OAAQqgB,EAAane,MAAOme,EAAargB,OACnG,EAvEF,SAAyBqgB,EAAc/D,EAAU7G,GAC/C,IAAK4K,EAAa5D,YAAc,IAAM,EACpC,OAEF,MAAM5c,EAAWyc,EAASjd,eAAiB,IACrC+qB,EAAY,IAAO/J,EAAa5D,YAAc,GAAK5c,EAAU,EAAG,GAChE4mB,EAAY,IAAmB,IAAZ2D,EAEzB,IAAK,IAAIj3B,EAAI,EAAGA,EADD,EACaA,GAAK,EAAG,CAClC,MAAMs2B,EAAQhU,GAAW,GAAU,IAAJtiB,GAA6B,IAAjBktB,EAAangB,EAAe,IAAJ/M,EAC7D0J,EAA+B,IAArBwjB,EAAane,OAAiB,EAAgB,GAAZkoB,EAAsB,IAAJj3B,GACpE+N,EAAQylB,YAAc,GAAMF,EAAgB,IAAJtzB,EAAU,EAAG,KACrD+N,EAAQ4lB,UAAY,UACpB5lB,EAAQ6lB,YACR7lB,EAAQymB,IACN3kB,KAAK4a,IAAI6L,GAASpJ,EAAane,MAAQ,KACtCme,EAAargB,QAAU,IAAW,GAAJ7M,GAAmC,EAAxB6P,KAAK2a,IAAY,GAAR8L,GAC1C,GAAT5sB,EACA,EACU,EAAVmG,KAAKgS,IAEP9T,EAAQimB,MACV,CACAjmB,EAAQylB,YAAc,CACxB,CAiDE0D,CAAgBhK,EAAc/D,EAAU7G,GACxCvU,EAAQ0mB,SACV,CC5PA,MAAM0C,GAAgB,GAChBC,GAAe,GACfC,GAAkB,GAClBC,GAAU,GACVC,GAAiB,GAEjBC,GAAU,CACdC,SAAS,EACTC,QAAQ,EACRrI,YAAY,GAGRsI,GAAoB,CACxBC,OAAQ,UACRC,OAAQ,SACRC,OAAQ,cAGV,SAASC,GAAWvc,EAASuO,EAAM,KACjC,MAAMiO,EAAOV,GAAQA,GAAQr3B,OAAS,GACtC,GAAI+3B,GAAQA,EAAKxc,UAAYA,EAI3B,OAHAwc,EAAKjO,IAAMA,EACXiO,EAAK7N,OAASJ,OACdiO,EAAKC,IAAM,GAIb,IADAX,GAAQ91B,KAAK,CAAEga,UAASuO,MAAKI,OAAQJ,EAAKkO,IAAK,IACxCX,GAAQr3B,OAAS,GACtBq3B,GAAQlR,OAEZ,CAEA,SAAS8R,GAAmBzrB,EAAMiK,EAAS,CAAC,EAAGqT,EAAM,IACnD,MAAMoO,EAAQ,CACZ1rB,OACAM,EAAG2J,EAAO3J,GAAKiF,EAASjF,EACxBC,EAAG0J,EAAO1J,GAAKgF,EAAShF,EACxBtD,OAAQgN,EAAOhN,QAAU,IACzBqgB,MACAI,OAAQJ,GAGV,OADAsN,GAAgB71B,KAAK22B,GACdA,CACT,CAEA,SAASC,GAAcnvB,GACrB,OAA6B,IAAtBuuB,GAAQvuB,EACjB,CAmBA,SAASovB,GAAmB1vB,GAC1B,IAAKA,EAAM2vB,QAAU3vB,EAAM4vB,OACzB,OAEF,MAAMtvB,EAAW0uB,GAAkBhvB,EAAMC,MACpCK,IAG+B,mBAAzBN,EAAME,gBACfF,EAAME,iBA1BV,SAAsBI,GACpBuuB,GAAQvuB,IAAauuB,GAAQvuB,GAG7B8uB,GAAW,gBAFI9uB,EAASuvB,OAAO,GAAGC,cAAgBxvB,EAAS8G,MAAM,MAC9CynB,GAAQvuB,GAAY,KAAO,QACK,KAC9CuuB,GAAQvuB,KACM,YAAbA,GACFkuB,GAAcl3B,OAAS,EACvBs3B,GAAet3B,OAAS,GACF,WAAbgJ,EACTmuB,GAAan3B,OAAS,EACA,eAAbgJ,IACTouB,GAAgBp3B,OAAS,GAG/B,CAaEy4B,CAAazvB,GACf,CAEA,SAAS0vB,GAAkBhwB,GACzB,IAAKyvB,GAAc,WACjB,OAEF,MAAM1hB,EAAS/N,GAAO+N,QAAU,CAAC,EAEjCygB,GAAc31B,KAAK,CACjBoT,SAAU8B,EAAO9B,UAAY,UAC7B7H,EAAG2J,EAAO3J,GAAKiF,EAASjF,EACxBC,EAAG0J,EAAO1J,GAAKgF,EAAShF,EACxBgD,OAAQ0G,EAAO1G,QAAUgC,EAAShC,QAAU,EAC5C+Z,IANU,IAOVI,OAPU,KASd,CAEA,SAASyO,GAAgBjwB,GACvB,IAAKyvB,GAAc,WACjB,OAEF,MACMrO,EAAM,GACNnV,GAFSjM,GAAO+N,QAAU,CAAC,GAET9B,UAAY,UAC9BkE,EAAWye,GAAelV,KAAMhN,GAAUA,EAAMT,WAAaA,GACnE,GAAIkE,EAIF,OAHAA,EAASiR,IAAMA,EACfjR,EAASqR,OAASJ,OAClBjR,EAASmf,IAAM,GAIjB,IADAV,GAAe/1B,KAAK,CAAEoT,WAAUmV,MAAKI,OAAQJ,EAAKkO,IAAK,IAChDV,GAAet3B,OAAS,GAC7Bs3B,GAAenR,OAEnB,CAEA,SAASyS,GAAkBlwB,GACpByvB,GAAc,YAInBL,GAAW,aADMpvB,GAAO+N,QAAQ9B,UAAY,YAE9C,CAEA,SAASkkB,GAAmBnwB,GACrByvB,GAAc,YAInBL,GAAW,mBADMpvB,GAAO+N,QAAQ9B,UAAY,YACF,IAC5C,CAEA,SAASmkB,GAAiBpwB,GACxB,IAAKyvB,GAAc,WACjB,OAEF,MAAM1hB,EAAS/N,GAAO+N,QAAU,CAAC,EAC3B9B,EAAW8B,EAAO9B,UAAY,UAC9BjK,EAAa+L,EAAOhM,QAAQC,YAAc,EAC1CC,EAAW8L,EAAOhM,QAAQE,UAAY,EACtCouB,EAAYnpB,KAAK2U,MAAM7Z,EAAYC,GACrCouB,GAAa,GAGjBjB,GAAW,UAAUnjB,MAAaokB,EAAU/C,QAAQ,KAAM,IAC5D,CAEA,SAASgD,GAAgBtwB,GACvB,IAAKyvB,GAAc,UACjB,OAEF,MAAM1hB,EAAS/N,GAAO+N,QAAU,CAAC,EAE3BkP,EAAS,CACb7Y,EAAG2J,EAAOkP,QAAQ7Y,GAAKiF,EAASjF,EAChCC,EAAG0J,EAAOkP,QAAQ5Y,GAAKgF,EAAShF,GAElCoqB,GAAa51B,KAAK,CAChBiL,KAAM,MACN6a,OAAQ5Q,EAAO4Q,QAAU,EACzB1B,SACAmE,IATU,IAUVI,OAVU,WAYU/mB,IAAlBsT,EAAO4Q,QACTyQ,GAAW,iBAAiBloB,KAAKgY,MAAMnR,EAAO4Q,UAAW,IAE7D,CAEA,SAAS4R,GAAoBvwB,GAC3B,IAAKyvB,GAAc,UACjB,OAEF,MAAM1hB,EAAS/N,GAAO+N,QAAU,CAAC,EAE3BkP,EAAS,CACb7Y,EAAG2J,EAAOkP,QAAQ7Y,GAAKiF,EAASjF,EAChCC,EAAG0J,EAAOkP,QAAQ5Y,GAAKgF,EAAShF,GAElCoqB,GAAa51B,KAAK,CAChBiL,KAAM,UACNmZ,SACAmE,IARU,IASVI,OATU,MAYZ4N,GAAW,UADIrhB,EAAOgP,QAAU,YACD,IACjC,CAEA,SAASyT,GAAgBxwB,GACvB,IAAKyvB,GAAc,UACjB,OAEF,MAAM1S,EAAS/c,GAAO+N,QAAQgP,QAAU,QACzB,YAAXA,GAGJqS,GAAW,UAAUrS,IAAU,IACjC,CAEA,SAAS0T,GAAsBzwB,GACxByvB,GAAc,eAKnBL,GAAW,sBAFIpvB,GAAO+N,QAAU,CAAC,GACX7K,YAAc,aACO,IAC7C,CAEA,SAASwtB,GAAyB1wB,GAChC,IAAKyvB,GAAc,cACjB,OAEF,MAAM1hB,EAAS/N,GAAO+N,QAAU,CAAC,EACjCwhB,GAAmB,YAAaxhB,EAAQ,UAClBtT,IAAlBsT,EAAO/M,OACTouB,GAAW,oBAAoBrhB,EAAO/M,SAAU,KAEhDouB,GAAW,sBAAuB,IAEtC,CAEA,SAASuB,GAA0B3wB,GACjC,IAAKyvB,GAAc,cACjB,OAEF,MAAM1hB,EAAS/N,GAAO+N,QAAU,CAAC,EACjCwhB,GAAmB,QAASxhB,EAAQ,KACpC,MAAM3K,EAAe2K,EAAO3K,cAAgB,EAE5CgsB,GAAW,qBAD+B,iBAAjBhsB,EAA4BA,EAAakqB,QAAQ,GAAKsD,OAAOxtB,OACvC,IACjD,CAEA,SAASytB,GAA6B7wB,GACpC,IAAKyvB,GAAc,cACjB,OAEF,MAAM1hB,EAAS/N,GAAO+N,QAAU,CAAC,EAC3ByhB,EAAQD,GAAmB,QAASxhB,EAAQ,IAClDyhB,EAAMzM,UAAYhV,EAAOhN,QAAUyuB,EAAMzuB,OAEzCquB,GAAW,mBADaloB,KAAKgY,MAAkD,KAA1CnR,EAAOhK,UAAY,GAAKyI,OAAOskB,UAAiB,OAClC,IACrD,CAEA,SAASC,GAA8B/wB,GAChCyvB,GAAc,gBAInBF,GAAmB,aADJvvB,GAAO+N,QAAU,CAAC,EACQ,IACzCqhB,GAAW,mBAAoB,KACjC,CAEA,IAAI4B,IAAsB,EAE1B,SAAS,KACHA,IAAyC,oBAAX/0B,SAGlCA,OAAOyT,iBAAiB,sBAAuBsgB,IAC/C/zB,OAAOyT,iBAAiB,oBAAqBugB,IAC7Ch0B,OAAOyT,iBAAiB,sBAAuBwgB,IAC/Cj0B,OAAOyT,iBAAiB,uBAAwBygB,IAChDl0B,OAAOyT,iBAAiB,qBAAsB0gB,IAC9Cn0B,OAAOyT,iBAAiB,aAAc4gB,IACtCr0B,OAAOyT,iBAAiB,iBAAkB6gB,IAC1Ct0B,OAAOyT,iBAAiB,aAAc8gB,IACtCv0B,OAAOyT,iBAAiB,mBAAoB+gB,IAC5Cx0B,OAAOyT,iBAAiB,sBAAuBghB,IAC/Cz0B,OAAOyT,iBAAiB,wBAAyBihB,IACjD10B,OAAOyT,iBAAiB,2BAA4BmhB,IACpD50B,OAAOyT,iBAAiB,4BAA6BqhB,IACrD90B,OAAOyT,iBAAiB,UAAWggB,IACnCsB,IAAsB,EACxB,CAEA,SAASC,GAAWz5B,EAAMwyB,GACxB,IAAK,IAAI3yB,EAAIG,EAAKF,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CAC5C,MAAMqV,EAAQlV,EAAKH,GACnBqV,EAAM0U,KAAO4I,EACbtd,EAAM4iB,KAAO5iB,EAAM4iB,KAAO,GAAKtF,EAC3Btd,EAAM0U,KAAO,GACf5pB,EAAKoB,OAAOvB,EAAG,EAEnB,CACF,CAWA,SAAS65B,KAEP,OADA,KACO,CACL1C,iBACAC,gBACAC,mBACAC,WACAC,kBACAC,QAAS,IAAKA,IAElB,CCjTA,MAAMsC,GAAc,CAClBC,eAAgB,EAChBC,aAAc,EACdnvB,MAAO,GACPovB,aAAc,GCJhB,SAASC,GAAuBC,EAAQC,EAAWvtB,GACjD,MAAMwtB,EAAWD,EAAYvtB,EAC7B,IAAK,MAAMytB,KAAYxrB,EAAiB,CACtC,GAAIqrB,EAAO5uB,GAAK,EACd,SAEF,MAAMgvB,EAAWJ,EAAOntB,EAAIH,EAC5B,GAAIwtB,GAAYC,EAASttB,GAAKutB,GAAYD,EAASttB,GAC7CmtB,EAAOptB,GAAKutB,EAASvtB,GAAKotB,EAAOptB,GAAKutB,EAASvtB,EAAIutB,EAASvrB,MAM9D,OALAorB,EAAOntB,EAAIstB,EAASttB,EAAIH,EACxBstB,EAAO5uB,GAAK,EACRlF,OAAOK,UAAUC,eAAeC,KAAKuzB,EAAQ,cAC/CA,EAAOlqB,UAAW,IAEb,CAGb,CACA,OAAO,CACT,CAEA,MAAMuqB,GAAkB,CACtBC,OAAQ,CAAEzG,KAAM,UAAWG,OAAQ,WACnCuG,MAAO,CAAE1G,KAAM,UAAWG,OAAQ,WAClCwG,QAAS,CAAE3G,KAAM,UAAWG,OAAQ,WACpCyG,UAAW,CAAE5G,KAAM,UAAWG,OAAQ,WACtC0G,QAAS,CAAE7G,KAAM,UAAWG,OAAQ,WACpC2G,QAAS,CAAE9G,KAAM,UAAWG,OAAQ,WACpC4G,OAAQ,CAAE/G,KAAM,UAAWG,OAAQ,WACnC6G,MAAO,CAAEhH,KAAM,UAAWG,OAAQ,YA2BpC,SAAS8G,GAAaX,GACpB,MAAM91B,EAAQg2B,GAAgBF,EAAS7tB,OAAS+tB,GAAgBQ,MAChEjtB,EAAQ4lB,UAAYnvB,EAAMwvB,KAC1BjmB,EAAQumB,SAASgG,EAASvtB,EAAGutB,EAASttB,EAAGstB,EAASvrB,MAAOurB,EAASztB,QAClEkB,EAAQkmB,YAAczvB,EAAM2vB,OAC5BpmB,EAAQqc,UAAY,EACpBrc,EAAQwmB,WAAW+F,EAASvtB,EAAGutB,EAASttB,EAAGstB,EAASvrB,MAAOurB,EAASztB,OACtE,CC3DA,SAASquB,KACP,OAAO7rB,EAAe2C,EAASI,kBAAoB/C,EAAepP,SAAWoP,EAAe,EAC9F,CAsBA,SAAS8rB,GAAiBpuB,EAAGC,GAC3B,IAAIouB,EAAO,KACPC,EAAWlmB,OAAOC,kBACtB,IAAK,MAAMuN,KAAS3O,EAAS,CAC3B,GAAI2O,EAAMlS,QAAU,EAClB,SAEF,MAAMyT,EAAKvB,EAAM5V,EAAIA,EACfoX,EAAMxB,EAAM3V,EAAmB,GAAf2V,EAAM9V,OAAgBG,EACtCsuB,EAAOzrB,KAAK2U,MAAMN,EAAIC,GACxBmX,EAAOD,IACTA,EAAWC,EACXF,EAAOzY,EAEX,CACA,OAAOyY,CACT,CAqBA,SAASG,GAAapB,EAAQtV,EAAS8N,EAAO6I,EAAc,GAC1D,MAAMC,EAAU5W,EAAUsV,EAAOptB,EAGjC,GADAotB,EAAO7uB,GAAK,EACRuE,KAAKmmB,IAAIyF,GAFK,GAEiB,CACjC,MAAMC,EAAM7rB,KAAKyU,KAAKmX,GACtBtB,EAAO7uB,GAAKowB,EAAMxtB,EAAQstB,EAC1BrB,EAAOnqB,OAAS0rB,CAClB,CACF,CAEA,SAASC,GAAaxB,EAAQ11B,EAAQkuB,GAEpC,GADAwH,EAAOxoB,aAAe9B,KAAK7E,IAAI,GAAImvB,EAAOxoB,cAAgB,GAAKghB,GAC3DwH,EAAOxoB,aAAe,EACxB,OAEFwoB,EAAOxoB,ajClDc,IiCmDrB,MAAM3B,EAASvL,EAAOsI,GAAKotB,EAAOptB,EAAI,GAAK,EAG3C0X,GAAgB,CACd1X,EAHcotB,EAAOptB,EAAa,GAATiD,EAIzBhD,EAHcmtB,EAAOntB,EAAqC,GAAjCwC,EAAe,EAAMpB,UAI9C9C,GjCxDe,IiCwDX0E,EACJzE,IAAK,GACL7B,OAAQ,EACRQ,SAAU,GACVE,MAAO4F,EAAS,EAAI,UAAY,UAChCrG,OjC5DgB,GiC6DhBC,UAAW,IACXoG,WAEFmqB,EAAOlpB,WAAa,GACtB,CAEA,SAAS2qB,GAAgBC,EAAWlJ,GAClC,MAAMmJ,EAAUZ,KACVa,EAAiBvsB,EAAe,EAAMpB,UAQ5C,OAPcytB,EAAU7uB,EAAI+uB,GACf9tB,EAAW,GAAK4B,KAAKmmB,IAAI6F,EAAUtwB,IAAM,IACpDswB,EAAU5rB,UAAW,GAGvB4rB,EAAUhqB,cAAgB,KAElBiqB,GAASt7B,IACf,IAAK,SAAU,CACb,MAAMiE,EAAS02B,GAAiBU,EAAU9uB,EAAG8uB,EAAU7uB,GACnDvI,GAAUoL,KAAKmmB,IAAIvxB,EAAOsI,EAAIiF,EAASjF,IjCvFjC,KiCwFRwuB,GAAaM,EAAWp3B,EAAOsI,EAAI,GAAI4lB,EAAO,KAC9CgJ,GAAaE,EAAWp3B,EAAQkuB,GAChCkJ,EAAUhqB,cAAgBpN,EAAOjE,IAEjC+6B,GAAaM,EAAW7pB,EAASjF,EAAI,GAAI4lB,EAAO,IAElD,KACF,CACA,IAAK,SAAU,CACb,MAAMvU,EAAsC,IAA5Byd,EAAU9pB,WAAa,GAAU,GACjDwpB,GAAaM,EAAW7pB,EAASjF,EAAIqR,EAAQuU,EAAO,IACpD,MAAMluB,EAAS02B,GAAiBU,EAAU9uB,EAAG8uB,EAAU7uB,GACnDvI,GAAUoL,KAAKmmB,IAAIvxB,EAAOsI,EAAIiF,EAASjF,IjClGjC,MiCmGR4uB,GAAaE,EAAWp3B,EAAQkuB,GAChCkJ,EAAUhqB,cAAgBpN,EAAOjE,IAEnC,KACF,CACA,IAAK,QAAS,CACZ,MACM4d,EjCzGG,MiCwGUyd,EAAU9pB,WAAa,GAAK,GAAM,GAAK,EAAI,GAE9DwpB,GAAaM,EAAW7pB,EAASjF,EAAIqR,EAAQuU,EAAO,IACpD,MAAMluB,EAAS02B,GAAiBU,EAAU9uB,EAAG8uB,EAAU7uB,GACnDvI,IACFk3B,GAAaE,EAAWp3B,EAAQkuB,GAChCkJ,EAAUhqB,cAAgBpN,EAAOjE,IAEnC,KACF,CAEA,QAAS,CACP,MAAM4d,EAAsC,IAA5Byd,EAAU9pB,WAAa,GAAU,GACjDwpB,GAAaM,EAAW7pB,EAASjF,EAAIqR,EAAQuU,EAAO,IACpD,KACF,GAtGJ,SAAwBwH,EAAQxH,GAC9BwH,EAAO5uB,IAAM4C,EAAUwkB,EACvB,MAAMyH,EAAYD,EAAOntB,EACzBmtB,EAAOptB,GAAKotB,EAAO7uB,GAAKqnB,EACxBwH,EAAOntB,GAAKmtB,EAAO5uB,GAAKonB,EACxBwH,EAAOlqB,UAAW,EAClB,MAAM8rB,EAAiBvsB,EAAe,EAAMpB,UAC7B8rB,GAAuBC,EAAQC,EAAW2B,IAEzC5B,EAAOntB,EAAI+uB,GACZ9tB,IACXksB,EAAOntB,EAAIiB,EAAW8tB,EACtB5B,EAAO5uB,GAAK,EACZ4uB,EAAOlqB,UAAW,GAGtBkqB,EAAO7uB,GAAKuE,KAAK7E,KAAI,IAAQ6E,KAAKQ,IAAInC,EAAOisB,EAAO7uB,IACtD,CAwFE0wB,CAAeH,EAAWlJ,GAC1BkJ,EAAU5qB,WAAapB,KAAK7E,IAAI,GAAI6wB,EAAU5qB,YAAc,GAAK0hB,EACnE,CAYA,SAASsJ,KACP,MAAO,CACLH,QAASZ,KACTzkB,SAAUzE,EAASM,qBACnB4pB,QAASzoB,EAEb,CCtKA,MAAM0oB,GAAmB,kBAEzB,SAASC,KACP,OAAOpqB,EAASE,UAAYkQ,GAAepQ,EAASE,WAAa,IACnE,CAEA,SAASmqB,GAAc9a,EAAS+a,EAAY3J,GAC1C,GAAI2J,GAAc,EAChB,OAEF,MAAMC,EAAOD,EAAa3J,EACtBpR,EAAQjW,GAAK,EACfiW,EAAQjW,GAAKuE,KAAK7E,IAAI,EAAGuW,EAAQjW,GAAKixB,GAC7Bhb,EAAQjW,GAAK,IACtBiW,EAAQjW,GAAKuE,KAAKQ,IAAI,EAAGkR,EAAQjW,GAAKixB,GAE1C,CAqCA,SAASC,GAAwBjb,EAASrb,GACxC,MAAMu2B,EAAOv2B,EAAWmX,YAAc,CAAEtQ,EAAG,EAAGC,EAAG9G,EAAW2G,QACtDoZ,EAAazW,EAAe,EAAMpB,UAClCsuB,EAAanb,EAAQxU,EAAI0vB,EAAK1vB,EAC9B4vB,EAAapb,EAAQvU,EAAIyvB,EAAKzvB,EAC9B4vB,EAAW,GAAMF,EAAY,GAAI7uB,EAAOkB,MAAQ,IACtDiD,EAASjF,EAAI6vB,EACb5qB,EAAShF,EAAI2vB,EAAa1W,EAC1BjU,EAAS1G,GAAKiW,EAAQjW,GACtB0G,EAASzG,GAAKgW,EAAQhW,GACtB,MAAM2R,EAAehX,EAAWgX,cAAgB,SAE9ClL,EAAS/B,SADU,QAAjBiN,IAEwB,UAAjBA,GAGWqE,EAAQtR,UAE9B+B,EAAShC,OAASuR,EAAQvR,QAAUgC,EAAShC,MAC/C,CA2BA,SAAS6sB,GAAYtb,EAASnhB,EAAU,CAAC,GACvC,MAAM8F,EAAa8W,GAAoBuE,EAAQ9U,MAC/C,IAAKvG,EAGH,OAFA8L,EAASE,UAAY,UACrBF,EAASC,YAAc,UAIzBsP,EAAQE,SAAW,KACdrhB,EAAQ08B,eACXvb,EAAQG,cAAgB7R,KAAK7E,IAAIuW,EAAQG,cAAethB,EAAQqW,UAAY,MAG9E,MAAMwP,EAAazW,EAAe,EAAMpB,UAClC2uB,EAAc38B,EAAQ48B,kBAAoBzb,EAAQvR,QAAU,EAAI,GAAK,GACrEsN,EAAcpX,EAAWoX,aAAe,GACxC2f,EAAiBF,GAAe,EAAI,CAAEhwB,EAAsB,GAAnB7G,EAAW6I,MAAa/B,EAAG,GAAM,CAAED,EAAuB,IAAnB7G,EAAW6I,MAAa/B,EAAG,GAC3GkwB,EAAeH,GAAe,EAAIzf,EAAY,IAAM2f,EAAiB3f,EAAY,IAAM2f,EAE7FjrB,EAASE,UAAY,KACrBF,EAASC,YAAc,SACvBD,EAASG,mBAAqB,KAC9BH,EAASjF,EAAI,GAAMwU,EAAQxU,EAAImwB,EAAanwB,EAAG,GAAIc,EAAOkB,MAAQ,IAClEiD,EAAShF,EAAIiB,EAAWgY,GACQ,IAA5B7lB,EAAQ+8B,iBACVnrB,EAAS1G,GAAK,EACd0G,EAASzG,GAAK,IAEdyG,EAAS1G,GAAkB,GAAbiW,EAAQjW,GACtB0G,EAASzG,GAAKsE,KAAKQ,IAAIkR,EAAQhW,GAAI,IAErCyG,EAAS/B,UAAW,EACpB+B,EAAShC,OAAS+sB,GAAe,EAAI,GAAK,CAC5C,CA+EA,SAASK,GAAoB7b,EAASrb,EAAYysB,EAAO0K,GACnDA,EAlMN,SAAgC9b,EAASrb,EAAYysB,GACnD,MAAM2K,EAAkBv2B,EAAMG,QAAUH,EAAME,KACxCs2B,EAAiBx2B,EAAME,OAASF,EAAMG,MACtCs2B,EAAYF,EAAkB,EAAIC,GAAkB,EAAI,EACxD/f,EAAetX,EAAWsX,cAAgB,EAC1CC,EAAUvX,EAAWuX,SAAW,IAChCC,EAAWxX,EAAWwX,UAAY,IAClCC,EAAWzX,EAAWyX,UAAY,EAMxC,GAJkB,IAAd6f,GAAmBhgB,EAAe,IACpC+D,EAAQjW,IAAMkyB,EAAYhgB,EAAemV,GAGvC5rB,EAAMK,MAAQma,EAAQtR,UAAYwN,EAAU,EAAG,CACjD,MAAMggB,EAAQhgB,EAAUkV,EACpBpR,EAAQjW,GAAK,EACfiW,EAAQjW,GAAKuE,KAAK7E,IAAI,EAAGuW,EAAQjW,GAAKmyB,GAC7Blc,EAAQjW,GAAK,IACtBiW,EAAQjW,GAAKuE,KAAKQ,IAAI,EAAGkR,EAAQjW,GAAKmyB,GAE1C,MAAyB,IAAdD,GACTnB,GAAc9a,EAAS5D,EAAUgV,GAG/BjV,EAAW,IACb6D,EAAQjW,GAAK,GAAMiW,EAAQjW,IAAKoS,EAAUA,IAG1B,IAAd8f,EACFjc,EAAQvR,OAASwtB,EACR3tB,KAAKmmB,IAAIzU,EAAQjW,IAAM,IAChCiW,EAAQvR,OAASuR,EAAQjW,GAAK,EAAI,GAAK,EAE3C,CAkKIoyB,CAAuBnc,EAASrb,EAAYysB,GAE5C0J,GAAc9a,EAASrb,EAAWyX,UAAY,EAAGgV,GAGnD,MAAM/U,EAAU1X,EAAW0X,SAAW,GACjC2D,EAAQtR,UAAY2N,EAAU,GAAKA,EAAU,IAChD2D,EAAQjW,IAAMuE,KAAK8tB,IAAI/f,EAAS/N,KAAK7E,IAAI,EAAW,GAAR2nB,KAG9CpR,EAAQhW,IAAM4C,EAAUwkB,EACxBpR,EAAQxU,GAAKwU,EAAQjW,GAAKqnB,EAC1BpR,EAAQvU,GAAKuU,EAAQhW,GAAKonB,EAE1B,MAAMiL,EAAY3vB,EAAW/H,EAAW2G,OACpC0U,EAAQvU,GAAK4wB,GACfrc,EAAQvU,EAAI4wB,EACZrc,EAAQhW,GAAK,EACbgW,EAAQtR,UAAW,GAEnBsR,EAAQtR,UAAW,EAGrB,MAAMmZ,EAA+B,GAAnBljB,EAAW6I,MACvB+R,EAAOsI,EAAY,GACnBrI,EAAOlT,EAAOkB,MAAQqa,EAAY,GACxC7H,EAAQxU,EAAI,GAAMwU,EAAQxU,EAAG+T,EAAMC,GAC/BQ,EAAQxU,IAAM+T,GAAQS,EAAQxU,IAAMgU,IACtCQ,EAAQjW,GAAK,GAGf,MAAMuyB,EAAa,GAAMtc,EAAQjW,GAAKuE,KAAK7E,IAAI,EAAG9E,EAAWwX,UAAY,KAAO,KAAO,IAAM,KAC7F6D,EAAQC,OAASqc,EAAatc,EAAQC,MAAQ3R,KAAKQ,IAAI,EAAW,GAARsiB,EAC5D,CAEA,SAASmL,GAAmBvc,EAASrb,EAAYysB,EAAO0K,GACtD,MAAM7f,EAAetX,EAAW6Z,mBAAqB7Z,EAAWsX,cAAgB,IAC1EE,EAAWxX,EAAW8Z,eAAiB9Z,EAAWwX,UAAY,IAC9DqgB,EAAe73B,EAAW+Z,mBAAqBpQ,KAAK7E,IAAI,GAAe,GAAX0S,GAC5DC,EAAWzX,EAAWga,eAAiBha,EAAWyX,UAAY,IAC9DqgB,EAAiB93B,EAAWia,UAAY,IACxCC,EAAela,EAAWka,cAAgB,EAC1CC,EAAWna,EAAWma,UAAY,IAClCE,EAAkBra,EAAWqa,iBAAmB,GAChD0d,EAAe1c,EAAQN,YAAehT,GAAY/H,EAAW4Z,oBAAsB,IACnFQ,EAAgBpa,EAAWoa,eAAiB,IAC5CI,EAAkBxa,EAAWwa,iBAAmB,EAEhDwd,EAAab,GAAgBt2B,EAAMG,QAAUH,EAAME,KACnDk3B,EAAYd,GAAgBt2B,EAAME,OAASF,EAAMG,MACjDs2B,EAAYU,EAAa,EAAIC,GAAa,EAAI,EAQpD,GANkB,IAAdX,GAAmBhgB,EAAe,EACpC+D,EAAQjW,IAAMkyB,EAAYhgB,EAAemV,EAEzC0J,GAAc9a,EAAS5D,EAAUgV,GAG/B0K,GAAgBt2B,EAAMK,KAAM,CAC9B,MAAMq2B,EAAQO,EAAgBrL,EAC1BpR,EAAQjW,GAAK,EACfiW,EAAQjW,GAAKuE,KAAK7E,IAAIuW,EAAQjW,GAAKmyB,GAAQM,GAClCxc,EAAQjW,GAAK,EACtBiW,EAAQjW,GAAKuE,KAAKQ,IAAIkR,EAAQjW,GAAKmyB,EAAOM,GACjCN,EAAQ,IACjBlc,EAAQjW,GAAK,GAAMiW,EAAQjW,GAAKiW,EAAQvR,OAASytB,EAAQ,KAAOM,EAAcA,GAElF,CAEAxc,EAAQjW,GAAK,GAAMiW,EAAQjW,IAAKyyB,EAAcrgB,GAE5B,IAAd8f,EACFjc,EAAQvR,OAASwtB,EACR3tB,KAAKmmB,IAAIzU,EAAQjW,IAAM,IAChCiW,EAAQvR,OAASuR,EAAQjW,GAAK,EAAI,GAAK,GAGzCiW,EAAQxU,GAAKwU,EAAQjW,GAAKqnB,EAC1B,MAAMvJ,EAA+B,GAAnBljB,EAAW6I,MACvB+R,EAAOsI,EAAY,GACnBrI,EAAOlT,EAAOkB,MAAQqa,EAAY,GACxC7H,EAAQxU,EAAI,GAAMwU,EAAQxU,EAAG+T,EAAMC,GAC/BQ,EAAQxU,IAAM+T,GAAQS,EAAQxU,IAAMgU,IACtCQ,EAAQjW,GAAK,GAGfiW,EAAQhW,GAAK,EAEbgW,EAAQK,UAAYL,EAAQK,UAAY,GAAK+Q,GAAStS,GAAYgd,EAAe,IAAM,MACvF,MAAMe,EAAYvuB,KAAK4a,IAAIlJ,EAAQK,UAAYxB,EACzCie,EAAcxuB,KAAK4a,IAAuB,GAAnBlJ,EAAQK,SAA6B,IAAZL,EAAQxU,GAAYwT,EAAkB,EACtFuE,EAAUmZ,EAAe/3B,EAAW2G,OAASyT,EAAgBI,EAAkB0d,EAAYC,EACjG9c,EAAQvU,IAAM8X,EAAUvD,EAAQvU,GAAK6C,KAAKQ,IAAI,EAAW,IAARsiB,GAEjDpR,EAAQtR,UAAW,EAEnB,MAAMquB,EAAa,GAAM/c,EAAQjW,GAAKuE,KAAK7E,IAAI,EAAG0S,GAAY,IAA2D,IAApD7N,KAAK4a,IAAIlJ,EAAQK,SAA4B,GAAjBL,EAAQvR,SAAuB,IAAM,KACtIuR,EAAQC,OAAS8c,EAAa/c,EAAQC,MAAQ3R,KAAKQ,IAAI,EAAW,EAARsiB,EAC5D,CAEA,SAAS4L,GAAiBhd,EAASrb,EAAYysB,EAAO0K,GACpD,MAAMze,EAAyB1Y,EAAW0Y,wBAA0B1Y,EAAWsX,cAAgB,EACzFqB,EAAqB3Y,EAAW2Y,oBAAsB3Y,EAAWwX,UAAY,IAC7EoB,EAAiB5Y,EAAW4Y,gBAAkB5Y,EAAWyX,UAAY,IACrEC,EAAU1X,EAAW0X,SAAW,IAChCwD,EAAclb,EAAWkZ,kBAAoB,EAC7Cof,EAAc3uB,KAAK7E,IAAIoW,EAAalb,EAAWmZ,kBAAoB+B,GACnEqd,EAAev4B,EAAWu4B,cAAgB,IAC1Clf,EAAoBrZ,EAAWqZ,mBAAqB,EACpDJ,EAAkBjZ,EAAWiZ,iBAAmB,GAChDD,EAAmBhZ,EAAWgZ,kBAAoB,IAClDH,EAAY7Y,EAAW6Y,WAAa,EACpCC,EAAe9Y,EAAW8Y,cAAgBD,EAE1Cue,EAAkBD,GAAgBt2B,EAAMG,QAAUH,EAAME,KACxDs2B,EAAiBF,GAAgBt2B,EAAME,OAASF,EAAMG,MACtDs2B,EAAYF,EAAkB,EAAIC,GAAkB,EAAI,EAE5C,IAAdC,GAAmB5e,EAAyB,EAC9C2C,EAAQjW,IAAMkyB,EAAY5e,EAAyB+T,EAEnD0J,GAAc9a,EAASzC,EAAgB6T,GAGrC9T,EAAqB,IACvB0C,EAAQjW,GAAK,GAAMiW,EAAQjW,IAAKuT,EAAoBA,IAGpC,IAAd2e,EACFjc,EAAQvR,OAASwtB,EACR3tB,KAAKmmB,IAAIzU,EAAQjW,IAAM,IAChCiW,EAAQvR,OAASuR,EAAQjW,GAAK,EAAI,GAAK,GAGzCiW,EAAQjW,IAAMuE,KAAK8tB,IAAI/f,EAAiB,GAAR+U,GAEhC,MAAM+L,EAAUvwB,GAAWjI,EAAW+Y,cAAgB,KAOtD,GANAsC,EAAQhW,IAAMmzB,EAAU/L,EAEnBxd,OAAOwpB,SAASpd,EAAQL,qBAC3BK,EAAQL,kBAAoBhb,EAAWoZ,YAAc8B,GAGnDic,EACEt2B,EAAMI,OACRoa,EAAQL,mBAAqBud,EAAe9L,GAE1C5rB,EAAMK,OACRma,EAAQL,mBAAqBud,EAAe9L,OAEzC,CACL,MAAMtR,EAAWpT,GAAYsT,EAAQvU,EAAI9G,EAAW2G,QACpD0U,EAAQL,oBAAsBG,EAAWE,EAAQL,mBAAqBrR,KAAKQ,IAAI,EAAW,GAARsiB,EACpF,CAEApR,EAAQL,kBAAoB,GAAMK,EAAQL,kBAAmBE,EAAaod,GAE1E,MAAMnd,EAAW,GAAMpT,GAAYsT,EAAQvU,EAAI9G,EAAW2G,QAASuU,EAAaod,GAC1EI,EAAgBrd,EAAQL,kBAAoBG,EAClDE,EAAQhW,IAAMqzB,EAAgBrf,EAAoBoT,EAE9C0K,GAAgBte,EAAY,IAC1BhY,EAAMI,OACRoa,EAAQhW,IAAkB,IAAZwT,EAAmB4T,GAE/B5rB,EAAMK,OACRma,EAAQhW,IAAqB,IAAfyT,EAAsB2T,IAIxCpR,EAAQhW,IAAMsE,KAAK8tB,IAAIxe,EAAyB,GAARwT,GACpCzT,EAAmB,IACrBqC,EAAQhW,GAAK,GAAMgW,EAAQhW,IAAK2T,EAAkBA,IAGpDqC,EAAQxU,GAAKwU,EAAQjW,GAAKqnB,EAC1BpR,EAAQvU,GAAKuU,EAAQhW,GAAKonB,EAE1B,MAAMvJ,EAA+B,GAAnBljB,EAAW6I,MACvB+R,EAAOsI,EAAY,GACnBrI,EAAOlT,EAAOkB,MAAQqa,EAAY,GACxC7H,EAAQxU,EAAI,GAAMwU,EAAQxU,EAAG+T,EAAMC,GAC/BQ,EAAQxU,IAAM+T,GAAQS,EAAQxU,IAAMgU,IACtCQ,EAAQjW,GAAK,GAGf,MAAMuzB,EAAc,GAAM5wB,GAAYsT,EAAQvU,EAAI9G,EAAW2G,QAASuU,EAAaod,GACnFjd,EAAQvU,EAAIiB,EAAW/H,EAAW2G,OAASgyB,GACtCA,IAAgBzd,GAAeG,EAAQhW,GAAK,GAAOszB,IAAgBL,GAAejd,EAAQhW,GAAK,KAClGgW,EAAQhW,GAAK,GAGfgW,EAAQtR,UAAW,EAEnB,MAAM4tB,EAAa,GAAMtc,EAAQjW,GAAKuE,KAAK7E,IAAI,EAAG6T,GAAsB,IAAuB,IAAhB+f,GAAuB,GAAK,IAC3Grd,EAAQC,OAASqc,EAAatc,EAAQC,MAAQ3R,KAAKQ,IAAI,EAAW,EAARsiB,EAC5D,CAEA,SAASmM,GAA4Bvd,EAASQ,EAAUgd,EAAYC,GAClE,MAAMC,GAAgD,IAAjCld,EAASmd,oBACxBC,EAAgB5d,EAAQvR,QAAU,EAClCovB,OAA+Bh8B,IAAf47B,EAA2BA,GAAcjd,EAAS/R,QAAU,IAAMivB,EAAeE,EAAgB,GACjHztB,EAAUqQ,EAAS3D,QAAQrR,GAAK,EAChC2V,EAAUX,EAAS3D,QAAQpR,GAAK,EAChCqyB,EAAmBJ,EAAeE,EAAgB,EAClDxU,EAAQpJ,EAAQxU,EAAI2E,EAAU2tB,EAC9BpW,EAAQ1H,EAAQvU,EAAI0V,EACpBrE,EAAU0D,EAAS1D,SAAW0D,EAAS1D,QAAQpe,OAAS,EAAI8hB,EAAS1D,QAAU,CAAC,CAAEtR,EAAGgV,EAASud,QAAQvyB,GAAK,EAAGC,EAAG+U,EAASud,QAAQtyB,GAAK,IACvIgV,EAAc+c,EAAW/c,aAAe,EACxCsd,EAASjhB,EAAQ2D,EAAc3D,EAAQpe,QAC7C8+B,EAAW/c,aAAeA,EAAc,GAAK3D,EAAQpe,OACrD,MAAMs/B,EAAU5U,GAAS2U,GAAQvyB,GAAK,GAAKsyB,EACrCG,EAAUvW,GAASqW,GAAQtyB,GAAK,GAEhCyyB,EAAgB1d,EAAS/X,YAAc,CAAC,EACxCC,EAAQw1B,EAAcx1B,OAAS,IAC/By1B,GAAkB3d,EAASzD,SAAW,IAAMzO,KAAKgS,GAAK,KACtD8d,EAAcD,EAAiB,GAAK7vB,KAAKC,SAAW,IAAO4vB,EAAiB,EAC5EE,EAAkBR,GAAiB,EAAI,GAAK,EAIlD3a,GAAgB,CACd1X,EAAGwyB,EACHvyB,EACA1B,GANSuE,KAAK2a,IAAImV,GAAe11B,EAAQ21B,EAOzCr0B,GANSsE,KAAK4a,IAAIkV,GAAe11B,GAASw1B,EAAcI,eAAiB,GAOzEn2B,OAAQ+1B,EAAc/1B,QAAU,EAChCQ,SAAUu1B,EAAcv1B,UAAY,IACpCE,MAAOq1B,EAAcr1B,OAAS,UAC9BT,OAAQ81B,EAAc91B,QAAU,GAChCC,UAAW61B,EAAc71B,WAAa,GACtCoG,OAAQ4vB,EACRz1B,cAAes1B,EAAct1B,eAAiB,MAGhD40B,EAAW9tB,WAAa8Q,EAASxD,eAAiB,GAClDwgB,EAAW9c,YAAcsd,EACzBR,EAAW7c,YAAcsd,CAC3B,CAEA,SAASM,GAA+Bve,EAASrb,EAAYysB,EAAO0K,GAClE,MAAM0C,EAAY75B,EAAWgY,gBAAkB,GACzC4D,EAASP,EAAQO,QAAU,GACjC,GAAyB,IAArBie,EAAU9/B,QAAkC,IAAlB6hB,EAAO7hB,OACnC,OAGF,MAAMk/B,EAAgB5d,EAAQvR,QAAU,EAClCgwB,EAAe3C,GAAgBt2B,EAAMW,WACrCu4B,EAAiB5C,GAAgBt2B,EAAMY,UAE7C,IAAK,IAAI3F,EAAQ,EAAGA,EAAQ+9B,EAAU9/B,OAAQ+B,GAAS,EAAG,CACxD,MAAM+f,EAAWge,EAAU/9B,GACrB+8B,EAAajd,EAAO9f,GAC1B,IAAK+f,IAAagd,EAChB,SAGFA,EAAWtoB,SAAW5G,KAAK7E,IAAI,GAAI+zB,EAAWtoB,UAAY,GAAKkc,GAC/DoM,EAAW9tB,WAAapB,KAAK7E,IAAI,GAAI+zB,EAAW9tB,YAAc,GAAK0hB,GAEnE,IAAIuN,GAAa,EACjB,MAAM/hB,EAAU4D,EAAS5D,SAAW,UAWpC,GAVIkf,EACc,YAAZlf,EACF+hB,EAAaF,EACQ,cAAZ7hB,IACT+hB,EAAaD,GAENle,EAASoe,WAClBD,GAAa,IAGVA,GAAcnB,EAAWtoB,SAAW,EACvC,SAGF,MAAMwoB,GAAgD,IAAjCld,EAASmd,oBAE9BJ,GAA4Bvd,EAASQ,EAAUgd,GAD3Bhd,EAAS/R,QAAU,IAAMivB,EAAeE,EAAgB,IAE5EJ,EAAWtoB,SAAWsL,EAASpV,cAAgB,EACjD,CACF,CC/FA,SAASyzB,KACP,MAAMC,EAAgBvqB,IAChBwqB,EAAaD,GAAet3B,MAAQ,UACpCw3B,E/B5UCjsB,IAAqBxR,IAAKtC,GAAO,EAAmBA,IAAO,CAAEA,KAAIuI,KAAM,Y+B6UxEmN,EAAamqB,EAAgB5qB,EAAc4qB,EAAc7/B,IAAM,KAC/DggC,EJpYQ1G,GAAYC,eIoYpByG,EJnYM1G,GAAYE,aIqYxB,IAAKhoB,EAASuB,iBAAmB,GAAK,EAAG,CACvC,MAAMktB,EAAe5wB,KAAKQ,IAAI,KAAO2B,EAASuB,iBAAmB,GAAK,KACtExF,EAAQ4lB,UAAY,uBAAuB8M,KAC3C1yB,EAAQumB,SAAS,EAAG,EAAGvmB,EAAQF,OAAOkB,MAAOhB,EAAQF,OAAOhB,OAC9D,CAEAkB,EAAQ4lB,UAAY,UACpB5lB,EAAQ2yB,KAAO,qCACf3yB,EAAQ4yB,UAAY,OACpB5yB,EAAQ6yB,SAAS,gHAAiH,GAAI,IACtI7yB,EAAQ6yB,SAAS,iIAAkI,GAAI,IAEvJ,MAAMC,EAAY7uB,EAASS,WAAaT,EAASW,cAAgB,UAAUX,EAASW,cAAc5J,OAAS,eAC3GgF,EAAQ6yB,SAASC,EAAW,GAAI,IAEhC9yB,EAAQ6yB,SAAS,WAAWN,IAAc,GAAI,IAE9C,IAAIQ,EAAQ,GACZ,MAAMC,EAAgB3E,KACtB,GAAI2E,EAAe,CACjB,MAAMC,EAAoBhkB,GAAoB+jB,EAAct0B,MACtDw0B,EAAeD,GAAmB1xB,OAASyxB,EAAct0B,KACzDyQ,EAAe8jB,GAAmB9jB,cAAgB,SACxDnP,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,YAAYK,gBAA4B,GAAIH,GAC7DA,GAAS,GACT/yB,EAAQ4lB,UAAY,UACC,QAAjBzW,EACFnP,EAAQ6yB,SAAS,gDAAiD,GAAIE,GAC5C,UAAjB5jB,EACTnP,EAAQ6yB,SAAS,2CAA4C,GAAIE,GAEjE/yB,EAAQ6yB,SAAS,gCAAiC,GAAIE,GAExDA,GAAS,GACT,MAAM5iB,EAAiB8iB,GAAmB9iB,gBAAkB,GAC5D,GAAIA,EAAeje,OAAS,EAC1B,IAAK,MAAMihC,KAAShjB,EAAgB,CAClC,MAAMijB,EAA8D,eAA9CD,EAAM/iB,SAAW,WAAWijB,cAAgC,YAAc,UAC1FC,EAAaH,EAAM5xB,OAAS4xB,EAAM1gC,IAAM,iBAC9CuN,EAAQ4lB,UAA6B,YAAjBwN,EAA6B,UAAY,UAC7DpzB,EAAQ6yB,SAAS,GAAGO,MAAiBE,IAAc,GAAIP,GACvDA,GAAS,EACX,CAEJ,MAAO,GAAI9uB,EAASG,mBAAoB,CACtC,MAAMmG,EAAY8J,GAAepQ,EAASG,oBAC1C,GAAImG,EAAW,CACb,MAAMgpB,EAAsBtkB,GAAoB1E,EAAU7L,MACpD80B,EAAiBD,GAAqBhyB,OAASgJ,EAAU7L,KACzDyQ,EAAeokB,GAAqBpkB,cAAgB,SAC1DnP,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,WAAWW,iBAA+B,GAAIT,GAC/DA,GAAS,GACT/yB,EAAQ4lB,UAAY,UACC,QAAjBzW,GACFnP,EAAQ6yB,SAAS,6CAA8C,GAAIE,GACnEA,GAAS,IACiB,UAAjB5jB,GACTnP,EAAQ6yB,SAAS,kDAAmD,GAAIE,GACxEA,GAAS,KAET/yB,EAAQ6yB,SAAS,qCAAsC,GAAIE,GAC3DA,GAAS,IAEX,MAAMU,EAAmBF,GAAqBpjB,gBAAkB,GAChE,GAAIsjB,EAAiBvhC,OAAS,EAAG,CAC/B8N,EAAQ4lB,UAAY,UACpB,IAAK,MAAMuN,KAASM,EAAkB,CACpC,MAAML,EAA8D,eAA9CD,EAAM/iB,SAAW,WAAWijB,cAAgC,YAAc,UAC1FC,EAAaH,EAAM5xB,OAAS4xB,EAAM1gC,IAAM,iBAC9CuN,EAAQ6yB,SAAS,GAAGO,MAAiBE,IAAc,GAAIP,GACvDA,GAAS,EACX,CACF,CACF,CACF,CACA/yB,EAAQ4lB,UAAY,UAEpB,MAAM8N,ERnSC,CACLC,cAAe7xB,KAAK7E,IAAI,EAAGmmB,GAAQC,eACnCuQ,cAAe/Q,GAAkBO,GAAQE,iBAAiB/hB,OAAS,KACnEiiB,gBAAiBJ,GAAQK,cAAgB,EAAIL,GAAQI,gBAAkB,KACvEqQ,cAAezQ,GAAQK,cAAgB,EAAIL,GAAQK,cAAgBL,GAAQM,iBAAmB,EAC9FC,cAAeP,GAAQQ,YAAc,EAAIR,GAAQO,cAAgB,KACjEmQ,YAAa1Q,GAAQQ,YAAc,EAAIR,GAAQQ,YAAcR,GAAQS,eAAiB,EACtFkQ,YAAa5Q,GAAYjxB,QQ6R3B,GAAIwhC,EAAc,CAChB,GAAIA,EAAalQ,gBAAiB,CAChC,MAAMyF,EAAQ,GAAM,IAAO,KAAQyK,EAAaG,eAAiB,GAAI,EAAG,GACxE7zB,EAAQ4lB,UAAY,uBAAuBqD,KAC3CjpB,EAAQ6yB,SAASa,EAAalQ,gBAAiB,GAAIuP,GACnDA,GAAS,GACT/yB,EAAQ4lB,UAAY,SACtB,CACA,IAAK8N,EAAaC,eAAiB,GAAK,IAAOD,EAAaE,cAAe,CACzE,MAAMI,EAAMN,EAAaC,cACzB3zB,EAAQ6yB,SAAS,cAAca,EAAaE,mBAAmBI,EAAI9L,QAAQ,MAAO,GAAI6K,GACtFA,GAAS,EACX,CAOA,IANKW,EAAaK,aAAe,GAAK,IACpC/zB,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,mBAAmBa,EAAaK,cAAe,GAAIhB,GACpEA,GAAS,GACT/yB,EAAQ4lB,UAAY,WAElB8N,EAAa/P,cAAe,CAC9B,MAAMmQ,EAAc,GAAM,GAAM,IAAOJ,EAAaI,aAAe,GAAI,EAAG,GAC1E9zB,EAAQ4lB,UAAY,uBAAuBkO,KAC3C9zB,EAAQ6yB,SAAS,WAAWa,EAAa/P,gBAAiB,GAAIoP,GAC9DA,GAAS,GACT/yB,EAAQ4lB,UAAY,SACtB,CACF,CAEA,MAAMqO,EAAc/F,KACpB,GAAI+F,GAAalG,UACf/tB,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,UAAUoB,EAAYlG,QAAQxsB,QAAS,GAAIwxB,GAC5DA,GAAS,GACT/yB,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,6DAA8D,GAAIE,GACnFA,GAAS,IACJkB,EAAYvrB,UAAY,GAAK,MAChC1I,EAAQ6yB,SAAS,qBAAqBoB,EAAYvrB,SAASwf,QAAQ,MAAO,GAAI6K,GAC9EA,GAAS,IAEPltB,MAAMuH,QAAQ6mB,EAAY9F,UAAY8F,EAAY9F,QAAQj8B,OAAS,GAAG,CACxE8N,EAAQ4lB,UAAY,UACpB,MAAMsO,EAAWpyB,KAAKQ,IAAI,EAAG2xB,EAAY9F,QAAQj8B,QACjD,IAAK,IAAID,EAAI,EAAGA,EAAIiiC,EAAUjiC,GAAK,EAAG,CACpC,MAAMkiC,EAASF,EAAY9F,QAAQl8B,GAC7BukB,EAAW1U,KAAKmmB,IAAIkM,EAAOn1B,EAAIiF,EAASjF,GACxCsM,EAAS6oB,EAAOrwB,cAAgB,WAAa,QACnD9D,EAAQ6yB,SAAS,GAAGsB,EAAOn5B,MAAQ,WAAWwb,EAAS0R,QAAQ,QAAQ5c,KAAW,GAAIynB,GACtFA,GAAS,EACX,CACA/yB,EAAQ4lB,UAAY,SACtB,CAGF,MAAMwO,EAAY/oB,OAmBlB,GAlBI+oB,IACFp0B,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,QAAQuB,EAAU9oB,QAAU,YAAa,GAAIynB,GAC9DA,GAAS,GACgB,cAArBqB,EAAU9oB,QACZtL,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,2DAA4D,GAAIE,GACjFA,GAAS,GACT/yB,EAAQ6yB,SAAS,+CAAgD,GAAIE,GACrEA,GAAS,KAET/yB,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,iBAAmBjtB,IAAmB1T,OAAQ,GAAI6gC,GACnEA,GAAS,IAEX/yB,EAAQ4lB,UAAY,WAGlBzd,EAAY,CAGd,MAAMksB,EAAalsB,EAAWhB,WAAaC,OAAOC,kBAGlD,IAAIitB,EAAY,SAFQD,EAAa,MAAQ,GAAGvyB,KAAK7E,IAAI,EAAGkL,EAAW5L,eAChD83B,EAAa,MAAQ,GAAGvyB,KAAK7E,IAAI,EAAGkL,EAAW3L,aAElE2L,EAAW5C,YACb+uB,GAAa,eAAexyB,KAAK7E,IAAI,EAAGkL,EAAWX,aAAa0gB,QAAQ,QAE1EloB,EAAQ6yB,SAASyB,EAAW,GAAIvB,GAChCA,GAAS,EACX,CAGA,GADwBjxB,KAAK2U,MAAMgc,GAA4B,EAAGA,GAA0B,GACtE,IAAM,CAC1B,MAAM8B,EAAc,mBAAmB9B,GAA2B,GAAGvK,QAAQ,UAAUuK,GAAyB,GAAGvK,QAAQ,KAC3HloB,EAAQ6yB,SAAS0B,EAAa,GAAIxB,GAClCA,GAAS,EACX,CAEA/yB,EAAQ6yB,SAAS,cAAc5uB,EAASvB,UAAUuB,EAAStB,YAAa,GAAIowB,GAC5EA,GAAS,GACT/yB,EAAQ6yB,SAAS,aAAa/wB,KAAKgY,MAAM9T,EAActD,WAAWsD,EAAcrD,YAAa,GAAIowB,GACjGA,GAAS,GACT,MAAMyB,EAAevuB,EAAQwuB,OAAQ7f,GAAUA,EAAMlS,OAAS,GAAGxQ,OAIjE,GAHA8N,EAAQ6yB,SAAS,kBAAkB2B,IAAgB,GAAIzB,GACvDA,GAAS,GAELP,EAAYtgC,OAAS,EAAG,CAC1B,MAAMwiC,EAAYlC,EACfz9B,IAAI,CAACgjB,EAAQ9jB,KACZ,MAAMsN,EAAQ,GAAGtN,EAAQ,MAAM8jB,EAAO/c,OACtC,OAAO+c,EAAOtlB,KAAO6/B,GAAe7/B,GAAK,IAAI8O,KAAWA,IAEzDrM,KAAK,OACR8K,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,WAAW6B,IAAa,GAAI,IAC/C,CAEA,IAAIC,EAAW,IACf,MAAMC,ElB1iBR,WACE,MAAMjL,EDsGC,CACLtuB,OAAQ6b,GAAY7b,OACpBuE,SAAUsX,GAAYtX,SACtBuX,YAAaD,GAAYC,YACzBxY,SAAUuY,GAAYvY,SACtByY,YAAaF,GAAYE,aC1G3B,MAAO,CACLyd,YHkGKnf,GAAQxjB,OGjGb4iC,cF8DKle,GAAavb,OE7DlB05B,aAAcpL,EAAOtuB,OACrB25B,eAAgBrL,EAAO/pB,SACvBq1B,kBAAmBtL,EAAOxS,YAC1B7R,eAAgBrB,EAASqB,gBAAkB,EAE/C,CkBgiBuB4vB,GAQrB,GANIjxB,EAASc,kBACX/E,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,6BAA8B,GAAI8B,GACnDA,GAAY,IAGkB,cAA5BrC,GAAep3B,SAA0B,CAC3C,MAAMi6B,EAAQlxB,EAASoB,eAAiB,EAClC+vB,EAAgBD,EAAQ,QAAU,GAAGlxB,EAASoB,cAAc6iB,QAAQ,MAC1EloB,EAAQ4lB,UAAYuP,EAAQ,UAAY,UACxCn1B,EAAQ6yB,SAAS,YAAYuC,IAAiB,GAAIT,GAClDA,GAAY,EACd,CAEA,GAAgC,WAA5BrC,GAAep3B,SAAuB,CACxC,MAAMi6B,GAASP,EAAatvB,gBAAkB,IAAM,IAC9C/D,EAAQ4zB,EAAQ,QAAU,GAAGP,EAAatvB,eAAe4iB,QAAQ,MACvEloB,EAAQ4lB,UAAYuP,EAAQ,UAAY,UACxCn1B,EAAQ6yB,SAAS,WAAWtxB,IAAS,GAAIozB,GACzCA,GAAY,EACd,CAQA,IANKC,EAAaC,aAAe,GAAK,IACpC70B,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,mBAAmB+B,EAAaC,cAAe,GAAIF,GACpEA,GAAY,IAGVC,EAAaG,aAAc,CAC7B,MAAMM,EAAYT,EAAaK,mBAAqB,EAC9CK,EAAcxzB,KAAK7E,IAAI,EAAG23B,EAAaI,gBAAkB,GACzDnW,EAAQwW,EAAY,EAAIvzB,KAAK7E,IAAI,EAAG6E,KAAKQ,IAAI,EAAGgzB,EAAcD,IAAc,EAClFr1B,EAAQ4lB,UAAY,UACpB,MAAMrkB,EAAQ8zB,EAAY,EAAI,GAAGvzB,KAAKyzB,KAAKD,MAAgBxzB,KAAKyzB,KAAKF,KAAe,SACpFr1B,EAAQ6yB,SAAS,WAAWtxB,IAAS,GAAIozB,GACzCA,GAAY,GACZ,MAAM5L,EAAW,IACjB/oB,EAAQ4lB,UAAY,UACpB5lB,EAAQumB,SAAS,GAAIoO,EAAU5L,EAAU,GACzC/oB,EAAQ4lB,UAAY,UACpB5lB,EAAQumB,SAAS,GAAIoO,EAAU5L,EAAWlK,EAAO,GACjD8V,GAAY,EACd,EAEK1wB,EAASV,WAAa,GAAK,IAC9BvD,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,YAAY5uB,EAASV,UAAU2kB,QAAQ,MAAO,GAAIyM,GACnEA,GAAY,KAGT1wB,EAASuB,iBAAmB,GAAK,IACpCxF,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,YAAY5uB,EAASuB,gBAAgB0iB,QAAQ,MAAO,GAAIyM,GACzEA,GAAY,KAGT1wB,EAAST,gBAAkB,GAAK,IACnCxD,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,aAAa5uB,EAAST,eAAe0kB,QAAQ,MAAO,GAAIyM,GACzEA,GAAY,IAGV1wB,EAASvB,QAAU,IACrB1C,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,qBAAsB,GAAI8B,IAG7C,MAAMa,EAAa1J,KACb2J,EAAgBD,EAAWjM,QAAQvnB,OAAO,GAAG0zB,UACnD,GAAID,EAAcvjC,OAAS,GAAKsjC,EAAWhM,eAAet3B,OAAS,GAAKsjC,EAAW/L,QAAS,CAC1FzpB,EAAQwlB,OACR,MAAMmQ,EAAc31B,EAAQF,OAAOkB,MAAQ,GAC3ChB,EAAQ4yB,UAAY,QACpB,IAAIgD,EAAS,GACb,IAAK,MAAMC,KAAUJ,EAAe,CAClC,MAAMngB,EAAOugB,EAAOzZ,OAAS,EAAI,GAAMyZ,EAAO7Z,IAAM6Z,EAAOzZ,OAAQ,EAAG,GAAK,EAC3Epc,EAAQylB,YAAc,GAAMnQ,EAAM,IAAM,GACxCtV,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAASgD,EAAOpoB,QAASkoB,EAAaC,GAC9CA,GAAU,EACZ,CACA,GAAIJ,EAAWhM,eAAet3B,OAAS,EAAG,CACpCujC,EAAcvjC,OAAS,IACzB0jC,GAAU,GAEZ,IAAK,MAAMtuB,KAASkuB,EAAWhM,eAAgB,CAC7C,MAAMlU,EAAOhO,EAAM8U,OAAS,EAAI,GAAM9U,EAAM0U,IAAM1U,EAAM8U,OAAQ,EAAG,GAAK,EACxEpc,EAAQylB,YAAc,GAAMnQ,EAAM,GAAK,KACvCtV,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,SAAWvrB,EAAMT,SAAU8uB,EAAaC,GACzDA,GAAU,EACZ,CACF,CACA,MAAMnM,EAAU+L,EAAW/L,QAC3B,GAAIA,EAAS,CACPmM,EAAS,KACXA,GAAU,GAEZ51B,EAAQylB,YAAc,GACtBzlB,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,sBAAuB8C,EAAaC,GACrDA,GAAU,GACV,MAAME,EAAc,CAClB,CAAEv0B,MAAO,UAAWqN,MAAO6a,EAAQC,SACnC,CAAEnoB,MAAO,SAAUqN,MAAO6a,EAAQE,QAClC,CAAEpoB,MAAO,aAAcqN,MAAO6a,EAAQnI,aAExC,IAAK,MAAMyU,KAAQD,EACjB91B,EAAQylB,YAAcsQ,EAAKnnB,MAAQ,IAAO,IAC1C5O,EAAQ4lB,UAAYmQ,EAAKnnB,MAAQ,UAAY,UAC7C5O,EAAQ6yB,SAASkD,EAAKx0B,MAAQ,MAAQw0B,EAAKnnB,MAAQ,KAAO,OAAQ+mB,EAAaC,GAC/EA,GAAU,EAEd,CACA51B,EAAQylB,YAAc,EACtBzlB,EAAQ0mB,SACV,CACF,CAgEA,SAASsP,MXprBT,WACE,GAA2B,IAAvBpV,GAAY1uB,OAAhB,CAGA8N,EAAQwlB,OACRxlB,EAAQqc,UAAY,EACpB,IAAK,MAAMpgB,KAAc2kB,GAAa,CACpC,MAAMqI,EAAQnnB,KAAK7E,IAAI,EAAGhB,EAAWqZ,KAAOrZ,EAAWsZ,SACvDvV,EAAQ4lB,UAAY,uBAAuBqD,KAC3CjpB,EAAQ6lB,YACR7lB,EAAQymB,IAAIxqB,EAAW+C,EAAG/C,EAAWgD,EAAGhD,EAAWN,OAAQ,EAAa,EAAVmG,KAAKgS,IACnE9T,EAAQimB,MACV,CACAjmB,EAAQ0mB,SAVR,CAWF,CWuqBEuP,GVzbF,WACE,MAAM1hB,EAAUC,KAChBxU,EAAQwlB,OAER,IAAK,MAAM9D,KAAWJ,GACpB,GAAKI,EAAQC,UAoBN,CACL,MAAMhjB,EAAWmD,KAAK7E,IAAIykB,EAAQ/jB,kBAAmB,MAC/CspB,EAAW,GAAM,EAAIvF,EAAQE,eAAiBjjB,EAAU,EAAG,GAC3DsqB,EAAQ,GAAM,EAAIhC,EAAU,EAAG,GAErC,GAA2B,UAAvBvF,EAAQ5jB,WAAwB,CAClC,MAAM2S,EAAciR,EAAQrkB,iBAAmB,GAAiB,GAAX4pB,GAC/CiP,EAAap0B,KAAK7E,IAAI,EAAG6E,KAAKQ,IAAI,EAAG,IAAO2mB,EAAQ,MAC1DjpB,EAAQ4lB,UAAY,uBAAuBsQ,EAAWhO,QAAQ,MAC9DloB,EAAQ6lB,YACR7lB,EAAQymB,IAAI/E,EAAQ1iB,EAAG0iB,EAAQziB,EAAGwR,EAAa,EAAa,EAAV3O,KAAKgS,IACvD9T,EAAQimB,MACV,MAAO,GAA2B,UAAvBvE,EAAQ5jB,WAAwB,CACzC,MAAMq4B,EAAazU,EAAQrkB,iBAAmB,GAAiB,GAAX4pB,GAC9CmP,EAAYt0B,KAAK7E,IAAI,EAAG6E,KAAKQ,IAAI,IAAM,GAAM2mB,EAAQ,KAC3DjpB,EAAQ4lB,UAAY,uBAAuBwQ,EAAUlO,QAAQ,MAC7DloB,EAAQ6lB,YACR7lB,EAAQymB,IAAI/E,EAAQ1iB,EAAG0iB,EAAQziB,EAAGk3B,EAAY,EAAa,EAAVr0B,KAAKgS,IACtD9T,EAAQimB,MACV,KAAO,CACL,MAAMoQ,EAAc3U,EAAQrkB,iBAAmB,IAAkB,GAAX4pB,GAChDqP,EAAYx0B,KAAK7E,IAAI,EAAG6E,KAAKQ,IAAI,EAAG,GAAM2mB,IAChDjpB,EAAQkmB,YAAc,uBAAuBoQ,EAAUpO,QAAQ,MAC/DloB,EAAQqc,UAAY,GAAK,EAAe,GAAX4K,GAC7BjnB,EAAQ6lB,YACR7lB,EAAQymB,IAAI/E,EAAQ1iB,EAAG0iB,EAAQziB,EAAGo3B,EAAa,EAAa,EAAVv0B,KAAKgS,IACvD9T,EAAQomB,SAER,MAAMmQ,EAAYz0B,KAAK7E,IAAI,EAAG6E,KAAKQ,IAAI,EAAG,IAAO2mB,IACjDjpB,EAAQ4lB,UAAY,sBAAsB2Q,EAAUrO,QAAQ,MAC5DloB,EAAQ6lB,YACR7lB,EAAQymB,IAAI/E,EAAQ1iB,EAAG0iB,EAAQziB,EAAiB,GAAdo3B,EAAmB,EAAa,EAAVv0B,KAAKgS,IAC7D9T,EAAQimB,MACV,CACF,KAtDwB,CACtBjmB,EAAQylB,YAAc,EACtBzlB,EAAQ4lB,UAAYlE,EAAQrlB,MAC5B2D,EAAQ6lB,YACR7lB,EAAQymB,IAAI/E,EAAQ1iB,EAAG0iB,EAAQziB,EAAGyiB,EAAQ/lB,OAAQ,EAAa,EAAVmG,KAAKgS,IAC1D9T,EAAQimB,OAER,MAAMuQ,EAAY9U,EAAQ+U,QAAU,EAAI,GAAM/U,EAAQG,KAAOH,EAAQ+U,QAAS,EAAG,GAAK,EACtFz2B,EAAQkmB,YAAc,4BACtBlmB,EAAQqc,UAAY,EACpBrc,EAAQ6lB,YACR7lB,EAAQymB,IAAI/E,EAAQ1iB,EAAG0iB,EAAQziB,EAAoB,IAAjByiB,EAAQ/lB,QAAgBmG,KAAKgS,GAAK,GAAIhS,KAAKgS,GAAK,EAAc,EAAVhS,KAAKgS,GAAS0iB,GACpGx2B,EAAQomB,SAER,MAAMsQ,EAAe50B,KAAK2a,IAAc,GAAVlI,GAAgBmN,EAAQ/lB,OAAS,GACzDg7B,EAAe70B,KAAK4a,IAAc,GAAVnI,GAAgBmN,EAAQ/lB,OAAS,GAAuB,GAAjB+lB,EAAQ/lB,OAC7EqE,EAAQ4lB,UAAY,2BACpB5lB,EAAQ6lB,YACR7lB,EAAQymB,IAAI/E,EAAQ1iB,EAAI03B,EAAchV,EAAQziB,EAAI03B,EAAc,IAAK,EAAa,EAAV70B,KAAKgS,IAC7E9T,EAAQimB,MACV,CAqCFjmB,EAAQ0mB,UAnFV,WACE,GAA2B,IAAvBnF,GAAYrvB,OAAhB,CAIA8N,EAAQwlB,OACR,IAAK,MAAMxD,KAAST,GAAa,CAC/B,MAAM2H,EAAY,GAAMlH,EAAM1M,KAAO0M,EAAMrjB,SAAU,EAAG,GAClDhD,EAASqmB,EAAMrmB,OACfi7B,EAAW52B,EAAQ62B,qBAAqB7U,EAAMhjB,EAAGgjB,EAAM/iB,EAAY,IAATtD,EAAeqmB,EAAMhjB,EAAGgjB,EAAM/iB,EAAGtD,GACjGi7B,EAASE,aAAa,EAAG,6BACzBF,EAASE,aAAa,EAAG,uBACzB92B,EAAQylB,YAAcyD,EACtBlpB,EAAQ4lB,UAAYgR,EACpB52B,EAAQ6lB,YACR7lB,EAAQymB,IAAIzE,EAAMhjB,EAAGgjB,EAAM/iB,EAAGtD,EAAQ,EAAa,EAAVmG,KAAKgS,IAC9C9T,EAAQimB,MACV,CACAjmB,EAAQ0mB,SAfR,CAgBF,CAiEEqQ,EACF,CU0XEC,GdpcF,WAEE,GADAra,KACyB,IAArBf,GAAU1pB,QAAiC,IAAjB2pB,GAAM3pB,OAApC,CAIA8N,EAAQwlB,OACR,IAAK,MAAMvJ,KAAQJ,GAAO,CACxB,MAAMvG,EAAO,GAAM2G,EAAKD,IAAMC,EAAKG,OAAQ,EAAG,GACxC6K,EAAW,EAAI3R,EACf3Z,EAASsgB,EAAKC,aAAeD,EAAKE,UAAYF,EAAKC,aAAe+K,EACxEjnB,EAAQylB,YAAkC,GAApB,GAAMnQ,EAAM,EAAG,GACrCtV,EAAQqc,UAAYJ,EAAKI,UACzBrc,EAAQkmB,YAAcjK,EAAK5f,MAC3B2D,EAAQ6lB,YACR7lB,EAAQymB,IAAIxK,EAAKjd,EAAGid,EAAKhd,EAAGtD,EAAQ,EAAa,EAAVmG,KAAKgS,IAC5C9T,EAAQomB,QACV,CAEA,IAAK,MAAM6Q,KAAYrb,GAAW,CAChC,MAAMtG,EAAO,GAAM2hB,EAASjb,IAAMib,EAAS7a,OAAQ,EAAG,GACtD,IAAI6M,EAAQ,GAAM3T,EAAM,EAAG,GACL,UAAlB2hB,EAASv4B,KACXuqB,GAAS,IACkB,UAAlBgO,EAASv4B,KAClBuqB,EAAQ,IAAe,IAARA,EACY,WAAlBgO,EAASv4B,OAClBuqB,EAAQ,GAAc,GAARA,GAEhBjpB,EAAQylB,YAAcwD,EACtBjpB,EAAQ4lB,UAAYqR,EAAS56B,MAC7B,IAAI66B,EAAa5hB,EACK,UAAlB2hB,EAASv4B,KACXw4B,EAAa,EACc,WAAlBD,EAASv4B,OAClBw4B,EAAa,GAAa,GAAP5hB,GAErB,MAAM3Z,EAASmG,KAAK7E,IAAI,IAAKg6B,EAASt7B,OAASu7B,GAC/Cl3B,EAAQ6lB,YACR7lB,EAAQymB,IAAIwQ,EAASj4B,EAAGi4B,EAASh4B,EAAGtD,EAAQ,EAAa,EAAVmG,KAAKgS,IACpD9T,EAAQimB,MACV,CACAjmB,EAAQ0mB,SAtCR,CAuCF,Cc0ZEyQ,GA9DF,WACE,MAAM,cAAE/N,EAAa,aAAEC,EAAY,gBAAEC,GAAoBwC,KACzD,GAA6B,IAAzB1C,EAAcl3B,QAAwC,IAAxBm3B,EAAan3B,QAA2C,IAA3Bo3B,EAAgBp3B,OAA/E,CAIA8N,EAAQwlB,OAER,IAAK,MAAM4R,KAAShO,EAAe,CACjC,MAAM9T,EAAO,GAAM8hB,EAAMpb,IAAMob,EAAMhb,OAAQ,EAAG,GAC1C6M,EAAQ,IAAc,GAAP3T,EACf3Z,EAAS,GAAkB,IAAZ,EAAI2Z,GACnBjF,GAAU+mB,EAAMn1B,QAAU,IAAM,GAAkB,GAAZ,EAAIqT,IAChDtV,EAAQylB,YAAcwD,EACtBjpB,EAAQ4lB,UAAY,UACpB5lB,EAAQ6lB,YACR7lB,EAAQymB,IAAI2Q,EAAMp4B,EAAIqR,EAAQ+mB,EAAMn4B,EAAGtD,EAAQ,EAAa,EAAVmG,KAAKgS,IACvD9T,EAAQimB,MACV,CAEA,IAAK,MAAMmE,KAASf,EAAc,CAChC,MAAM/T,EAAO,GAAM8U,EAAMpO,IAAMoO,EAAMhO,OAAQ,EAAG,GAC1C6M,GAAwB,YAAfmB,EAAM1rB,KAAqB,IAAO,KAAQ4W,EACzD,GAAI2T,GAAS,EACX,SAEF,MACMttB,GAD4B,YAAfyuB,EAAM1rB,KAAqB,IAAM,KACvB,EAAW,IAAP4W,GACjCtV,EAAQylB,YAAcwD,EACtBjpB,EAAQqc,UAA2B,YAAf+N,EAAM1rB,KAAqB,EAAI,EACnDsB,EAAQkmB,YAA6B,YAAfkE,EAAM1rB,KAAqB,UAAY,UAC7DsB,EAAQ6lB,YACR7lB,EAAQymB,IAAI2D,EAAMvS,OAAO7Y,EAAGorB,EAAMvS,OAAO5Y,EAAGtD,EAAQ,EAAa,EAAVmG,KAAKgS,IAC5D9T,EAAQomB,QACV,CAEA,IAAK,MAAMgE,KAASd,EAAiB,CACnC,MAAMhU,EAAO,GAAM8U,EAAMpO,IAAMoO,EAAMhO,OAAQ,EAAG,GAChD,GAAI9G,GAAQ,EACV,SAEF,IAAI8Q,EAAS,UACM,UAAfgE,EAAM1rB,KACR0nB,EAAS,UACe,UAAfgE,EAAM1rB,MAAmC,eAAf0rB,EAAM1rB,OACzC0nB,EAAS,WAEX,MAAMzqB,EAASyuB,EAAMzuB,QAAU,EAAiB,KAAZ,EAAI2Z,IACxCtV,EAAQylB,aAA8B,eAAf2E,EAAM1rB,KAAwB,GAAM,KAAQ4W,EACnEtV,EAAQqc,UAA2B,UAAf+N,EAAM1rB,KAAmB,EAAI,EACjDsB,EAAQkmB,YAAcE,EACtBpmB,EAAQ6lB,YACR7lB,EAAQymB,IAAI2D,EAAMprB,EAAGorB,EAAMnrB,EAAGtD,EAAQ,EAAa,EAAVmG,KAAKgS,IAC9C9T,EAAQomB,QACV,CAEApmB,EAAQ0mB,SApDR,CAqDF,CAME2Q,EACF,CC3vBA,SAASC,GAAYrjC,GACnB,MAAM8jB,EAAShQ,IAETwvB,GADcxf,GAAQ5c,aAAe,IAChBlH,GACtBsjC,IAILtzB,EAASS,WAAY,EACrBT,EAASU,YAAc1Q,EACvBgQ,EAASW,cAAgB2yB,EACzBtzB,EAASY,cAAgB,EACzBZ,EAASc,iBAAkB,EAC3Bd,EAASe,iBAAmB,EAC5Bf,EAASgB,kBAAmB,EAC5BhB,EAASiB,eAAgB,EACzBjB,EAASa,kBAAoB,EAC/B,CC5CA,SAAS0yB,GAAYD,GACnBtzB,EAASkB,eAAe1R,KAAK,CAC3BhB,GAAIwR,EAASa,iBACbH,YAAaV,EAASU,YACtB8yB,UAAWF,EAAOl8B,OAClBsD,SAAU44B,EAAOl8B,OACjBsI,QAAS4zB,EAAO97B,MAChBC,aAAc67B,EAAO77B,aACrBC,OAAQ47B,EAAO57B,OACfC,OAAQ27B,EAAO37B,OACfC,UAAW07B,EAAO17B,UAClBC,OAAQy7B,EAAOz7B,OACf47B,YAAazzB,EAAShC,OACtBwe,WAAY,IAAII,IAChB7hB,EAAG,EACHC,EAAG,GAEP,CAmDA,SAAS04B,KACP,MAAM5f,EAAShQ,IACf,IAAKgQ,IAAWA,EAAO7c,UAAU08B,WAAW,UAC1C,OAGF,IlCTF,SAAqB/wB,GACnB,MAAMS,EAAQV,EAAgBC,GAC9B,QAAKS,GAGDA,EAAMH,WAAaC,OAAOC,oBAG1BC,EAAM/B,WAGN+B,EAAM/K,UAAY,IAGtB+K,EAAM/K,UAAY,EACX,IACT,CkCPOs7B,CAAY9f,EAAOtlB,IAQjB,YAPDkV,EAAYoQ,EAAOtlB,MACrBwR,EAASS,WAAY,EACrBT,EAASW,cAAgB,KACzBX,EAASU,aAAe,EACF,oBAAX9N,QACTA,OAAO2gB,cAAc,IAAIC,YAAY,sBAAuB,CAAE9O,OAAQ,CAAE9B,SAAUkR,EAAOtlB,SAK/F,MAAMqlC,EAAmB/f,EAAO9b,YAAc,CAAC,EACzCC,EAAQ47B,EAAiB57B,OAAS,IAClC+F,EAASgC,EAAShC,OAClBiT,EAASjT,EAAS/F,EAClBiZ,EAAS2iB,EAAiBC,YAAc,GACxC9M,EAAYnpB,KAAK2U,MAAMvB,EAAQC,GAG/B6iB,EAFYl2B,KAAKm2B,MAAM9iB,EAAQD,GlC6BvC,SAAsBrO,GACpB,MAAMS,EAAQV,EAAgBC,GACxBC,EAAMQ,GAAOL,UACnB,IAAKK,IAAUR,EACb,OAAO,EAGJQ,EAAMvK,SACTuK,EAAMvK,OAAS,CAAEwK,QAAST,EAAIpU,MAAQ,IAExC,MAAMwlC,EAAc5wB,EAAMvK,OACpBrK,EAAOoU,EAAIpU,MAAQ,EACnB6U,EAAUzF,KAAK7E,IAAIvK,EAAMwlC,EAAY3wB,SAAW7U,GAChDuK,EAAM6J,EAAI7J,KAAOsK,EACjB4wB,EAAmBr2B,KAAKQ,IAAIrF,EAAKsK,GACjC6wB,EAAUD,GAAoBr2B,KAAKgS,GAAK,KACxC0I,EAAQ4b,EAAU,GAAqB,EAAhBt2B,KAAKC,SAAe,GAAKq2B,EAAU,EAE1Dp7B,EAAU8J,EAAI9J,SAAW,EAG/B,OAFAk7B,EAAY3wB,QAAUzF,KAAKQ,IAAIrF,EAAKk7B,EAAmBn7B,GAEhDwf,CACT,CkClDsB6b,CAAatgB,EAAOtlB,IAElC8K,EAAKuE,KAAK2a,IAAIub,GAAc/M,EAC5BztB,EAAKsE,KAAK4a,IAAIsb,GAAc/M,EN7FpC,IAAqBqN,EM+FfvgB,EAAOpb,SN/FQ27B,EMgGLvgB,EAAOpb,ON/FrBovB,GAAYC,gBAAkBsM,GAAM17B,YAAc,EAClDmvB,GAAYE,cAAgBqM,GAAMz7B,UAAY,EAC9CkvB,GAAYjvB,MAAQw7B,GAAMx7B,OAASivB,GAAYjvB,MAC/CivB,GAAYG,aAAe1X,KM6FH,oBAAX3d,QACTA,OAAO2gB,cAAc,IAAIC,YAAY,qBAAsB,CAAE9O,OAAQ,CAAE9B,SAAUkR,EAAOtlB,GAAIkK,OAAQob,EAAOpb,YAIzF,oBAAX9F,QACTA,OAAO2gB,cAAc,IAAIC,YAAY,sBAAuB,CAAE9O,OAAQ,CAAE9B,SAAUkR,EAAOtlB,GAAIuM,EAAGiF,EAASjF,EAAa,GAATiD,EAAahD,EAAGgF,EAAShF,EAAI,GAAIgD,aAGhJyU,GAAgB,CACd1X,EAAGiF,EAASjF,EAAa,GAATiD,EAChBhD,EAAGgF,EAAShF,EAAI,GAChB1B,KACAC,KACA7B,OAAQm8B,EAAiBn8B,QAAU,EACnCQ,SAAU27B,EAAiB37B,UAAY,GACvCE,MAAOy7B,EAAiBz7B,OAAS,UACjCT,OAAQk8B,EAAiBl8B,QAAU,GACnCC,UAAWi8B,EAAiBj8B,WAAa,GACzCoG,SACA7F,cAAe07B,EAAiB17B,eAAiB,KAG7B,oBAAXvF,QACTA,OAAO2gB,cAAc,IAAIC,YAAY,oBAAqB,CAAE9O,OAAQ,CAAE9B,SAAUkR,EAAOtlB,MAE3F,CC/HA,SAAS8lC,GAAc3jB,EAAOgQ,GAmB5B,GAlBAhQ,EAAMvR,gBAAkBvB,KAAK7E,IAAI,EAAG2X,EAAMvR,gBAAkBuhB,GAC5DhQ,EAAMhS,eAAiBd,KAAK7E,IAAI,EAAG2X,EAAMhS,eAAiBgiB,GAC1DhQ,EAAMrR,UAAYzB,KAAK7E,IAAI,GAAI2X,EAAMrR,WAAa,GAAKqhB,GACvDhQ,EAAMpR,eAAiB1B,KAAK7E,IAAI,GAAI2X,EAAMpR,gBAAkB,GAAKohB,GAC7DhQ,EAAMpR,gBAAkB,IAC1BoR,EAAMnR,kBAAoB,GAGxBmR,EAAM1R,WAAa,IACrB0R,EAAM1R,WAAapB,KAAK7E,IAAI,EAAG2X,EAAM1R,WAAa0hB,IAGhDhQ,EAAMzR,WAAa,IACrByR,EAAMzR,WAAarB,KAAK7E,IAAI,EAAG2X,EAAMzR,WAAayhB,IAGpDhQ,EAAMxR,eAAiBtB,KAAK7E,IAAI,EAAG2X,EAAMxR,eAAyB,GAARwhB,GAEtDhQ,EAAMlS,QAAU,EAgBlB,OAfAkS,EAAMtR,aAAexB,KAAK7E,IAAI,EAAG2X,EAAMtR,aAAeshB,QAC3B,IAAvBhQ,EAAMtR,eACRsR,EAAMlS,OAASkS,EAAMjS,UACrBiS,EAAM5V,EAAI4V,EAAMhT,OAChBgT,EAAM3V,EAAI2V,EAAM/S,OAChB+S,EAAMrX,GAAK,EACXqX,EAAMpX,GAAK,EACXoX,EAAMzS,MAAQ,SACdyS,EAAMxS,WAAa,EAAIN,KAAKC,SAC5B6S,EAAMhS,eAAiB,GACvBgS,EAAM1S,UAAW,EACjB0S,EAAMrR,UAAY,EAClBqR,EAAMpR,eAAiB,EACvBoR,EAAMnR,kBAAoB,IAK9B,MACM+0B,EADUv0B,EAASjF,EACG4V,EAAM5V,EAC5By5B,EAAc32B,KAAKmmB,IAAIuQ,GAC7B5jB,EAAM3S,OAASu2B,GAAa,EAAI,GAAK,EAErC,MAAME,EAAU9jB,EAAMrR,UAAY,EAC5B2e,EAAiBtN,EAAMpR,eAAiB,EAAI1B,KAAK7E,IAAI,GAAK6E,KAAKQ,IAAI,EAAGsS,EAAMnR,mBAAqB,IAAM,EACvGhB,EAAYmS,EAAMnS,UAAYyf,EAC9ByW,EAAsB/jB,EAAMrS,iBAAmBqS,EAAMpR,eAAiB,EAAI,IAAO,GAEjFo1B,GAAeF,GAAWD,EAAcE,EAE9C,GAAIF,EAH4C,IAAtBE,EAMxB,OAFA/jB,EAAMrX,GAAK,OACXqX,EAAMzS,MAAQ,QAgBhB,GAZIu2B,GACF9jB,EAAMzS,MAAQ,UACdyS,EAAMrX,GAAK,EACXqX,EAAM/R,aAAe,EACrB+R,EAAM9R,aAAe,EACrB8R,EAAMxS,WAAaN,KAAK7E,IAAI2X,EAAMxS,WAAYwS,EAAMrR,WACpDqR,EAAMhS,eAAiBd,KAAK7E,IAAI2X,EAAMhS,eAAgBgS,EAAMrR,UAAY,KAC/C,YAAhBqR,EAAMzS,QACfyS,EAAMzS,MAAQ,OACdyS,EAAMxS,WAAa,KAGhBs2B,EACL,OAAQ9jB,EAAMzS,OACZ,IAAK,OACHyS,EAAMrX,GAAK,EACXqX,EAAMxS,YAAcwiB,EAChBhQ,EAAMxS,YAAc,IACtBwS,EAAMzS,MAAQ,SACdyS,EAAMxS,WAAa,IAAMN,KAAKC,SAC9B6S,EAAM3S,OAASH,KAAKC,SAAW,IAAO,EAAI,GAExC62B,IACFhkB,EAAMzS,MAAQ,SAEhB,MACF,IAAK,SACHyS,EAAMrX,GAAKkF,EAAYmS,EAAM3S,OACzB2S,EAAM5V,GAAK4V,EAAMvS,YAAYC,IAC/BsS,EAAM3S,OAAS,EACN2S,EAAM5V,GAAK4V,EAAMvS,YAAYpF,MACtC2X,EAAM3S,QAAU,GAElB2S,EAAMxS,YAAcwiB,EAChBhQ,EAAMxS,YAAc,IACtBwS,EAAMzS,MAAQ,OACdyS,EAAMxS,WAAa,EAAIN,KAAKC,SAC5B6S,EAAMrX,GAAK,GAETq7B,IACFhkB,EAAMzS,MAAQ,SAEhB,MACF,IAAK,QACH,IAAKy2B,EAAa,CAChBhkB,EAAMzS,MAAQ,SACd,KACF,CACA,MAAM02B,EAAWL,GAAa,EAAI,GAAK,EACvC5jB,EAAMrX,GAAKkF,EAAYo2B,EACnBJ,GAAe7jB,EAAMpS,aAAeoS,EAAMhS,gBAAkB,IAC9DgS,EAAMzS,MAAQ,gBACdyS,EAAM/R,aAAe,IACrB+R,EAAM9R,aAAe,IACrB8R,EAAMrX,GAAK,GAEb,MACF,IAAK,gBACHqX,EAAMrX,GAAK,EACXqX,EAAM/R,cAAgB+hB,EAClBhQ,EAAM/R,cAAgB,IACxB+R,EAAMzS,MAAQ,gBACdyS,EAAM9R,aAAe,KAEvB,MACF,IAAK,gBACH8R,EAAMrX,GAAiB,IAAZkF,EAAmBmS,EAAM3S,OACpC2S,EAAM9R,cAAgB8hB,EAClBhQ,EAAM9R,cAAgB,IACxB8R,EAAMzS,MAAQ,UACdyS,EAAMxS,WAAa,GACnBwS,EAAMhS,eAAiB,KAEzB,MACF,IAAK,UACHgS,EAAMrX,GAAK,EACXqX,EAAMxS,YAAcwiB,EAChBhQ,EAAMxS,YAAc,IACtBwS,EAAMzS,MAAQy2B,EAAc,QAAU,OACtChkB,EAAMxS,WAAa,GAAsB,GAAhBN,KAAKC,UAEhC,MACF,QACE6S,EAAMrX,GAAK,EAKf,MAAM8uB,EAAYzX,EAAM3V,EACxB2V,EAAMpX,IAAM4C,EAAUwkB,EACtBhQ,EAAM5V,GAAK4V,EAAMrX,GAAKqnB,EACtBhQ,EAAM3V,GAAK2V,EAAMpX,GAAKonB,EACtBhQ,EAAM1S,UAAW,GAEFiqB,GAAuBvX,EAAOyX,EAAWzX,EAAM9V,SAC/C8V,EAAM3V,EAAI2V,EAAM9V,QAAUoB,IACvC0U,EAAM3V,EAAIiB,EAAW0U,EAAM9V,OAC3B8V,EAAMpX,GAAK,EACXoX,EAAM1S,UAAW,GAGnB0S,EAAM5V,EAAI8C,KAAK7E,IAAI,GAAI6E,KAAKQ,IAAIxC,EAAOkB,MAAQ,GAAI4T,EAAM5V,GAC3D,CAEA,SAAS85B,GAAmBlkB,GAC1B,GAAIA,EAAMlS,QAAU,EAClB,OAEF,GAAoB,kBAAhBkS,EAAMzS,MACR,OAGF,MAAM42B,EAAcnkB,EAAMpS,YAAcoS,EAAMjZ,OACxCwa,EAAKlS,EAASjF,EAAI4V,EAAM5V,EACxBoX,EAAKnS,EAAShF,EAAI2V,EAAM3V,EACXkX,EAAKA,EAAKC,EAAKA,GAChB2iB,EAAcA,GAC9B7f,GAAoBtE,EAExB,CCrLA,MCIMokB,GAAa,CACjB7T,MDDe,ICEf8T,QAAQ,GAeV,SAASC,GAAavmC,GACpB,IAAK,IAAIV,EAAI,EAAGA,EAAIU,KACdsT,EAAQ/T,QDrBJ,KCoBiBD,GAAK,EAAG,CAIjC,MAAMknC,EDrBM,GCsBNv3B,EAASu3B,EAAUr3B,KAAKC,UAAYjC,EAAOkB,MAAkB,EAAVm4B,GACnDvkB,EAAQjT,EAAiBC,GAC/BgT,EAAMhT,OAASA,EACfgT,EAAM/S,OAAS+S,EAAM3V,EACrB2V,EAAMtR,aAAe,EACrB2C,EAAQxS,KAAKmhB,EACf,CACF,CCPA,SAASwkB,KACP,MlC3Be,gDkC2B6BC,QAAQ,MAAO,GAC7D,CAMA,SAASC,KACP,MAAsB,oBAAXC,QAA0BA,OAAOC,WACnCD,OAAOC,aAET,WAAW13B,KAAKC,SAASlN,SAAS,IAAImN,MAAM,EAAG,KACxD,CAEA,SAASy3B,GAAeC,GACtB,MAAmB,iBAARA,EACF,GAEFA,EAAIC,MACb,CAEAC,eAAeC,GAAgBx4B,GAC7B,IAAKA,GAA6B,oBAAdy4B,YAA8BA,UAAUC,WAAWC,UACrE,OAAO,EAET,IAEE,aADMF,UAAUC,UAAUC,UAAU34B,IAC7B,CACT,CAAE,MAAOkI,GAEP,OADA4B,QAAQC,KAAK,yBAA0B7B,IAChC,CACT,CACF,CAgBA,SAAS0wB,GAAuB7nC,GAC9B,OAAKyT,MAAMuH,QAAQhb,GAGZA,EACJ2C,IAAKwV,GAnBV,SAA4BA,GAC1B,GAAyB,iBAAdA,EACT,OAAOkvB,GAAelvB,GAExB,GAAIA,GAAkC,iBAAdA,EACtB,IACE,OAAOkvB,GAAe3jC,KAAKC,UAAUwU,GACvC,CAAE,MACA,MAAO,EACT,CAEF,MAAO,EACT,CAOwB2vB,CAAmB3vB,IACtCkqB,OAAQlqB,GAAcA,EAAUrY,OAAS,GAJnC,EAKX,CAsBA,SAASioC,KACP,IAAI1tB,EACJ,IACEA,EAAMpD,IACR,CAAE,MAEA,OADAmF,GAAsB,IACf,EACT,CACA,IAAK/B,GAAK2tB,mBAER,OADA5rB,GAAsB,IACf,GAET,MAAM6rB,EAAaJ,GAAuBxtB,EAAI2tB,sBAAwB,IAEtE,OADA5rB,GAAsB6rB,GACfA,CACT,CA4BAT,eAAeU,IAAoB,OAAEC,GAAS,GAAU,CAAC,GACvD,IACExrB,GAAc,CAAEN,YAAY,IAC5B,MAAMA,EAAa0rB,KACnB,GAA0B,IAAtB1rB,EAAWvc,OAIb,OAHKqoC,GACH7sB,GAAiB,uEAEZ,CAAE8sB,QAAQ,EAAO7nC,MAAO,GAEjC,MAAM+X,EAAU+D,EAAWvZ,KAAK,MAC1BslC,QAAeX,GAAgBnvB,GAQrC,OAPK6vB,GAED7sB,GADE8sB,EACe,UAAU/rB,EAAWvc,uBAA6C,IAAtBuc,EAAWvc,OAAe,GAAK,OAE3E,mEAGd,CAAEsoC,SAAQ7nC,MAAO8b,EAAWvc,OAAQwY,UAC7C,CAAE,MAAOnB,GAGP,MADAuF,GADgBvF,GAAOkE,SAAW,iCAE5BlE,CACR,CAAE,QACAwF,GAAc,CAAEN,YAAY,GAC9B,CACF,CAeAmrB,eAAea,KACb,GAAsB,oBAAX5jC,QAAmD,mBAAlBA,OAAO6jC,OACjD,MAAM,IAAIvjC,MAAM,2CAElB,MAAMgL,EAAQ6K,KACRjC,GAAY5I,EAAMsK,IAAIM,kBAAoB,IAAI7X,KAAK,MACnD8D,EAAQnC,OAAO6jC,OAAO,gEAAiE3vB,GAC7F,GAAa,MAAT/R,EAEF,OADA0U,GAAiB,8BACV,KAET,MAAMe,EA/ER,SAA6BksB,GAC3B,MAAMC,EAAYnB,GAAekB,GACjC,IAAKC,EACH,MAAO,GAET,IACE,MAAMC,EAAS/kC,KAAK6U,MAAMiwB,GAC1B,GAAI/0B,MAAMuH,QAAQytB,GAChB,OAAOZ,GAAuBY,GAEhC,GAAIA,GAA4B,iBAAXA,EACnB,OAAOZ,GAAuB,CAACY,IAEjC,GAAsB,iBAAXA,EACT,OAAOZ,GAAuB,CAACY,GAEnC,CAAE,MAEF,CAKA,OAAOZ,GAJUW,EACdE,MAAM,UACN/lC,IAAKgmC,GAAYA,EAAQpB,QACzBlF,OAAQsG,GAAYA,EAAQ7oC,OAAS,GAE1C,CAuDqB8oC,CAAoBhiC,GACvC,GAA0B,IAAtByV,EAAWvc,OAEb,MADAwb,GAAiB,qCACX,IAAIvW,MAAM,8BAElB,MAAMsV,EAAMwuB,KACZnsB,GAAY,MACZC,GAAc,CAAEN,YAAY,IAC5B,IACE,IAAK,MAAMlE,KAAakE,QAChBhC,EAAIyuB,mBAAmB3wB,GAE/B,MAAM4wB,EApCV,SAAyBpwB,EAAUqwB,GACjC,MAAMD,EAAS,IAAIpwB,KAAaqwB,GAC1BC,EAAO,IAAIxa,IACXya,EAAS,GACf,IAAK,MAAM/wB,KAAa4wB,EACjBE,EAAK3a,IAAInW,KACZ8wB,EAAK1a,IAAIpW,GACT+wB,EAAO7nC,KAAK8W,IAGhB,OAAO+wB,CACT,CAyBmBC,CAAgBp5B,EAAMsK,IAAIM,kBAAoB,GAAI0B,GAGjE,OAFAI,GAAuBssB,GACvBztB,GAAiB,WAAWe,EAAWvc,uBAA6C,IAAtBuc,EAAWvc,OAAe,GAAK,QACtFuc,CACT,CAAE,MAAOlF,GAGP,MADAuF,GADgBvF,GAAOkE,SAAW,kCAE5BlE,CACR,CAAE,QACAwF,GAAc,CAAEN,YAAY,GAC9B,CACF,CAAC,SAASwsB,KACR,IACE,OAAO5xB,IACT,CAAE,MAAOE,GAGP,MADAuF,GADgBvF,GAAOkE,SAAW,6BAE5BlE,CACR,CACF,CAEA,SAASiyB,GAAqBC,EAASC,GACrC,MAAMpvB,EAAcmvB,GAASnvB,aAAeovB,EAC5C,MAAO,CACLpvB,cACAC,WAAYkvB,GAASlvB,YAAc,EACnCC,YAAaivB,GAASjvB,aAAe1K,KAAK7E,IAAI,EAAGqP,EAAc,GAEnE,CAEAstB,eAAe+B,KACb,MAAMC,EAAUxC,KAChB,IAAKwC,EAGH,OAFApuB,GAAS,uCACTN,GAAW,IAGbe,IAAY,GACZP,GAAiB,2BACjB,IACE,MAAMmuB,QAAiBC,MAAM,GAAGF,aAAoB,CAClDG,QAAS,CAAEC,OAAQ,sBAErB,IAAKH,EAASI,GACZ,MAAM,IAAI9kC,MAAM,QAAQ0kC,EAASvwB,UAEnC,MAAMtV,QAAa6lC,EAASK,OAEtBC,GADUt2B,MAAMuH,QAAQpX,GAAQA,EAAO6P,MAAMuH,QAAQpX,GAAMyV,SAAWzV,EAAKyV,QAAU,IAC7D1W,IAAKwY,IACjC,MAAM6uB,EAAW7uB,EAAO6uB,UAAY,CAAC,EACrC,MAAO,CACL3pC,GAAI8a,EAAO9a,GACXuI,KAAMuS,EAAOvS,MAAQuS,EAAO9a,GAC5BsC,IAAKwY,EAAOxY,KAAOqnC,EAASrnC,KAAO,UACnCsnC,QAASD,EAAS9vB,aAAeiB,EAAOjB,aAAeiB,EAAO8uB,SAAW,EACzEC,WAAY/uB,EAAO+uB,YAAcF,EAASE,YAAc,EACxDC,OAAQhvB,EAAOgvB,QAAUH,EAASG,QAAU,KAC5CC,KAAMjvB,EAAOivB,MAAQJ,EAASI,MAAQ,GACtCjwB,WAAY6vB,EAAS7vB,YAAc,KACnCC,YAAa4vB,EAAS5vB,aAAe,KACrCiwB,UAAWlvB,EAAOkvB,WAAa,KAC/BC,OAAQ,CACNC,UAAWpvB,EAAOmvB,QAAQC,WAAa,KACvCC,eAAgB/2B,MAAMuH,QAAQG,EAAOmvB,QAAQE,gBAAkBrvB,EAAOmvB,OAAOE,eAAe56B,QAAU,GACtG66B,WAAYtvB,EAAOmvB,QAAQG,YAAc,KACzCC,eAAgBj3B,MAAMuH,QAAQG,EAAOmvB,QAAQI,gBAAkBvvB,EAAOmvB,OAAOI,eAAe96B,QAAU,OAItG+6B,EAAmBj7B,KAAK7E,IAAI,IAAQ6E,KAAKgY,MAAM,QAC/ClP,EAAME,KAAKF,MACXoyB,EAAkBb,EAAc1H,OAAQlnB,IAC5C,IAAKA,EAAOkvB,UACV,OAAO,EAET,MAAMQ,EAAcnyB,KAAKH,MAAM4C,EAAOkvB,WACtC,QAAIr1B,OAAO81B,MAAMD,IAGVryB,EAAMqyB,GAAeF,IAE9B7vB,GAAW8vB,GACXxvB,GAAS,MACTE,GAA4C,IAA3BsvB,EAAgB9qC,OAAe,sBAAwB,wBAC1E,CAAE,MAAOqX,GACP2D,GAAW,IACXM,GAAS,4BAA4BjE,EAAMkE,WAC3CC,GAAiB,mCACnB,CAAE,QACAO,IAAY,EACd,CACF,CACA2rB,eAAeuD,IAAY,GACzB1qC,EAAK6mC,KAAc,KACnBt+B,ElC7SU,iCkC6SwC,OAClDuhC,ElC7Se,UkC6S8B,IAC7CxnC,EAAM,eAAc,YACpBuX,EAAc,EAAC,WACfgwB,EAAa,EAAC,KACdE,EAAO,WAAU,OACjBE,EAAS,MACP,CAAC,GACH,MAAMd,EAAUxC,KACVgE,ElCvTM,sCkCwTZ,IAAKxB,EACH,MAAM,IAAIzkC,MAAM,kCAKlB,MAAMgL,EAAQ6K,KACRyuB,EAAUt5B,EAAMkK,gBAAkB,CAAC,EAEnCgxB,EAAsB5B,EAAQnvB,aAAeA,EAC7CgxB,EAAkBZ,GAAU,CAChCC,UAAWx6B,EAAMsK,IAAIC,OAAS,KAC9BkwB,eAAgBz6B,EAAMsK,IAAI1C,iBAAmB,IAEzC8xB,QAAiBC,MAAM,GAAGF,aAAoB,CAClD2B,OAAQ,OACRxB,QAAS,CACP,eAAgB,mBAChB,mBAAoBqB,GAEtBI,KAAM1nC,KAAKC,UAAU,CACnBtD,KACAuI,OACAuhC,SACAxnC,MACAynC,OACAlwB,YAAa+wB,EACbf,aACAmB,WlCrVY,IkCsVZrB,SAAUZ,GAAqBC,EAAS4B,GACxCX,OAAQ,CACNC,UAAWW,EAAgBX,WAAa,KACxCC,eAAgB/2B,MAAMuH,QAAQkwB,EAAgBV,gBAAkBU,EAAgBV,eAAiB,QAIvG,IAAKf,EAASI,GACZ,MAAM,IAAI9kC,MAAM,gCAAgC0kC,EAASvwB,WAE3D,MAAMZ,QAAgBmxB,EAASK,OAI/B,OAHA1tB,GAAsB3I,MAAMuH,QAAQkwB,EAAgBV,gBAAkBU,EAAgBV,eAAiB,IACvG1uB,GAAkB,CAAEzb,KAAI0b,UAAWrD,KAAKF,MAA8C,KAArCF,GAAS+yB,YlClW1C,OkCmWhB/vB,GAAiB,WAAW1S,KACrB,CAAEvI,KAAIgrC,WAAY/yB,GAAS+yB,YlCpWlB,IkCqWlB,CAEA7D,eAAe8D,KACb,MAAM9B,EAAUxC,KACVgE,ElCxWM,sCkCyWNj7B,EAAQ6K,KACd,KAAK7K,EAAM4J,SAAY5J,EAAM6J,kBAAqB4vB,GAAYwB,GAC5D,OAEF,MAAM3B,EAAUt5B,EAAMkK,gBAAkB,CAAC,EACnCgxB,EAAsB5B,EAAQnvB,aAAe,EACnD,IACE,MAAMuvB,QAAiBC,MAAM,GAAGF,cAAoBz5B,EAAM6J,6BAA8B,CACtFuxB,OAAQ,OACRxB,QAAS,CACP,eAAgB,mBAChB,mBAAoBqB,GAEtBI,KAAM1nC,KAAKC,UAAU,CACnBuW,YAAa+wB,EACbI,WlCzXU,IkC0XVrB,SAAUZ,GAAqBC,EAAS4B,GACxCX,OAAQ,CACNC,UAAWx6B,EAAMsK,IAAIC,OAAS,KAC9BkwB,eAAgB/2B,MAAMuH,QAAQjL,EAAMsK,IAAI1C,iBAAmB5H,EAAMsK,IAAI1C,gBAAkB,QAI7F,IAAK8xB,EAASI,GACZ,MAAM,IAAI9kC,MAAM,QAAQ0kC,EAASvwB,UAEnC,MAAMZ,QAAgBmxB,EAASK,OjC/RMluB,EiCgSLnD,YAAYD,MjC/R9CY,GAAmBS,qBAAuB+B,EiCgSpCtD,GAAS+yB,YACXvvB,GAAkB,CAAEzb,GAAI0P,EAAM6J,iBAAkBmC,UAAWrD,KAAKF,MAA6B,IAArBF,EAAQ+yB,YAEpF,CAAE,MAAOl0B,GACP4B,QAAQC,KAAK,mBAAoB7B,GACjCmE,GAAiB,qCACjBW,IACF,CjCxSF,IAAyCL,CiCySzC,CAEA4rB,eAAe+D,KACb,MAAM/B,EAAUxC,KACVgE,ElCjZM,sCkCkZNj7B,EAAQ6K,KACd,GAAK7K,EAAM4J,SAAY5J,EAAM6J,kBAAqB4vB,GAAYwB,EAI9D,UACQtB,MAAM,GAAGF,cAAoBz5B,EAAM6J,mBAAoB,CAC3DuxB,OAAQ,SACRxB,QAAS,CACP,mBAAoBqB,IAG1B,CAAE,MAAO7zB,GACP4B,QAAQC,KAAK,yBAA0B7B,EACzC,CAAE,QACA8E,IACF,MAdEA,IAeJ,CAEAurB,eAAegE,GAAWC,EAAUnzB,EAAU,CAAC,GAC7C,MAAMkxB,EAAUxC,KAChB,IAAKwC,EACH,MAAM,IAAIzkC,MAAM,kCAElBwW,GAAc,sBACdC,GAAa,MACb,MAAMkwB,EAAM,GAAGlC,cAAoBiC,SAC7BhC,QAAiBC,MAAMgC,EAAK,CAChCP,OAAQ,OACRxB,QAAS,CACP,eAAgB,oBAElByB,KAAM1nC,KAAKC,UAAU2U,KAEvB,IAAKmxB,EAASI,GAAI,CAChB,MAAMxuB,EAAU,qBAAqBouB,EAASvwB,UAG9C,MAFAqC,GAAc,MACdC,GAAaH,GACP,IAAItW,MAAMsW,EAClB,CACA,MAAMzb,QAAe6pC,EAASK,OACxB6B,EAAa/rC,GAAQgsC,SAAShjC,MAAQ6iC,EAI5C,OAHAvvB,KACAX,GAAc,UAAUowB,KACxBrwB,GAAiB,kDACV1b,CACT,CAyCA4nC,eAAeqE,IAAgB,gBAAEC,GAAkB,GAAU,CAAC,GAC5D,MAAM/7B,EAAQ6K,KAEd,IADsBkxB,GAAoB/7B,EAAMsK,IAAIC,MAGlD,OADAytB,KACOh4B,EAAMsK,IAAIC,MAEnB,MAAMD,EAAMwuB,KACZnsB,GAAY,MACZC,GAAc,CAAErC,OAAO,IACvB,IACE,MAAMA,QAAcD,EAAI0xB,cAGxB,OjC5XJ,SAAqBzxB,GACnBlB,GAAmBiB,IAAIC,MAAQA,GAAS,IAC1C,CiCwXI0xB,CAAY1xB,GACZytB,KACOztB,CACT,CAAE,MAAOnD,GAGP,MADAuF,GADgBvF,GAAOkE,SAAW,0BAE5BlE,CACR,CAAE,QACAwF,GAAc,CAAErC,OAAO,GACzB,CACF,CAEAktB,eAAeyE,IAAc,gBAAEH,GAAkB,EAAK,OAAE3D,GAAS,GAAU,CAAC,GAC1E,MAAM7tB,QAAcuxB,GAAgB,CAAEC,oBAChC1D,QAAeX,GAAgBntB,GAQrC,OAPK6tB,GAED7sB,GADE8sB,EACe,0CAEA,iEAGd,CAAE9tB,QAAO8tB,SAClB,CAEAZ,eAAe0E,GAAgBC,GAAU,eAAEC,GAAiB,GAAS,CAAC,GACpE,MAAMC,EAAchF,GAAe8E,GACnC,IAAKE,EACH,MAAM,IAAItnC,MAAM,eAElB,IAAIunC,EACJ,IACEA,EAAkB5oC,KAAKC,UAAUD,KAAK6U,MAAM8zB,GAC9C,CAAE,MAAOl1B,GAEP,MADAuF,GAAY,4BACNvF,CACR,CACA,MAAMkD,EAAMwuB,KACZnsB,GAAY,MACZC,GAAc,CAAEpC,QAAQ,IACxB,IACE,MAAMA,QAAeF,EAAIkyB,aAAaD,GAatC,OAZAnwB,GAAa5B,GACbwtB,KAIIzsB,GAHA8wB,QACmB3E,GAAgBltB,GAElB,2CAEA,+CAGF,yCAEZA,CACT,CAAE,MAAOpD,GAGP,MADAuF,GADgBvF,GAAOkE,SAAW,0BAE5BlE,CACR,CAAE,QACAwF,GAAc,CAAEpC,QAAQ,GAC1B,CACF,CAEAitB,eAAegF,GAAkBC,GAC/B,MAAMC,EAAerF,GAAeoF,GACpC,IAAKC,EACH,MAAM,IAAI3nC,MAAM,gBAElB,IAAI4nC,EACJ,IACEA,EAAmBjpC,KAAKC,UAAUD,KAAK6U,MAAMm0B,GAC/C,CAAE,MAAOv1B,GAEP,MADAuF,GAAY,6BACNvF,CACR,CACA,MAAMkD,EAAMwuB,KACZnsB,GAAY,MACZ,UACQrC,EAAIuyB,wBAAwBD,GAClCxwB,GAAawwB,GACbrxB,GAAiB,4CACnB,CAAE,MAAOnE,GAGP,MADAuF,GADgBvF,GAAOkE,SAAW,2BAE5BlE,CACR,CACF,CAGA,SAAS01B,GAAsBxwB,GAC7B,IAAK5I,MAAMuH,QAAQqB,IAAqC,IAAtBA,EAAWvc,OAC3C,OAEF,MAAMmoC,EAAaJ,GAAuBxrB,GAC1C,GAA0B,IAAtB4rB,EAAWnoC,OACb,OAEF,IAAIua,EACJ,IACEA,EAAMwuB,IACR,CAAE,MAAO1xB,GAEP,YADA4B,QAAQC,KAAK,4CAA6C7B,EAE5D,CACA,MAAMpH,EAAQ6K,KACRzF,EAAU1B,MAAMuH,QAAQjL,EAAMsK,IAAIM,kBAAoB5K,EAAMsK,IAAIM,iBAAmB,GACnFsuB,EAAO,IAAIxa,IAAItZ,GACf23B,EAAU33B,EAAQvF,QACxB,IAAK,MAAMuI,KAAa8vB,EACtB,IAAIgB,EAAK3a,IAAInW,GAGb,IACEkC,EAAIyuB,mBAAmB3wB,GACvB20B,EAAQzrC,KAAK8W,GACb8wB,EAAK1a,IAAIpW,EACX,CAAE,MAAOhB,GACP4B,QAAQC,KAAK,8BAA+B7B,EAC9C,CAEFsF,GAAuBqwB,EACzB,CAEA,SAASC,KACP,MAAMh9B,EAAQ6K,KACd,GAAI7K,EAAM4J,SAAW5J,EAAM6J,iBAAkB,CAC3C,MAAMmxB,EAAch7B,EAAMsJ,QAAQ6I,KAAMhN,GAAUA,EAAM7U,KAAO0P,EAAM6J,kBAC/D0wB,EAASS,GAAaT,QAAU,KAClCA,IACEA,EAAOG,YAAc16B,EAAMsK,IAAIE,SAAW+vB,EAAOG,YACnD+B,GAAkBlC,EAAOG,YAAY3zB,MAAOK,IAC1C4B,QAAQC,KAAK,gCAAiC7B,KAG9C1D,MAAMuH,QAAQsvB,EAAOI,iBAAmBJ,EAAOI,eAAe5qC,OAAS,GACzE+sC,GAAsBvC,EAAOI,gBAE3BJ,EAAOG,aAAe16B,EAAMkK,gBAAgBC,aAAe,GAAK,IAClE8yB,kBAAkB,CAAE9yB,YAAaxK,KAAK7E,IAAI,EAAGkF,EAAMkK,gBAAgBC,aAAe,KAClFoxB,KAAmBx0B,MAAOK,GAAU4B,QAAQC,KAAK,0BAA2B7B,KAGlF,CACA,GAAIpH,EAAM2L,gBAAiB,CACzB,MAAMuxB,EAAgBl9B,EAAMsJ,QAAQ6I,KAAMhN,GAAUA,EAAM7U,KAAO0P,EAAM2L,iBACjE4uB,EAAS2C,GAAe3C,QAAU,KACpCA,GAAU72B,MAAMuH,QAAQsvB,EAAOE,iBAAmBF,EAAOE,eAAe1qC,OAAS,EACnF+sC,GAAsBvC,EAAOE,gBACnByC,GACVxxB,GAAmB,KAEvB,CACF,CAEA+rB,eAAe0F,KACb,GAAsB,oBAAXzoC,QAAmD,mBAAlBA,OAAO6jC,OACjD,MAAM,IAAIvjC,MAAM,2CAElB,MAAM6B,EAAQnC,OAAO6jC,OAAO,4BAA6B,IACzD,GAAa,MAAT1hC,EAEF,OADA0U,GAAiB,0BACV,KAET,IACE,aAAa4wB,GAAgBtlC,EAAO,CAAEwlC,gBAAgB,GACxD,CAAE,MAAOj1B,GAEP,MADAmE,GAAiB,oCACXnE,CACR,CACF,CAEAqwB,eAAe2F,KACb,GAAsB,oBAAX1oC,QAAmD,mBAAlBA,OAAO6jC,OACjD,MAAM,IAAIvjC,MAAM,2CAElB,MAAM6B,EAAQnC,OAAO6jC,OAAO,iCAAkC,IAC9D,GAAa,MAAT1hC,EAEF,OADA0U,GAAiB,2BACV,KAET,IAEE,aADMkxB,GAAkB5lC,GACjBA,CACT,CAAE,MAAOuQ,GAEP,MADAmE,GAAiB,gDACXnE,CACR,CACF,CAEA,SAASi2B,KACP,MAAMr9B,EAAQ6K,KACd,OAAI7K,EAAM4J,SACR2B,GAAiB,oBACV+xB,QAAQC,QAAQ,CAAEC,gBAAgB,MAE3CrxB,KACAT,GAAmB,MACnBH,GAAiB,2BACjBF,GAAS,MACFywB,GAAgB,CAAEC,iBAAiB,IACvC0B,KAAMlzB,GAEEywB,GAAY,CACjBT,OAAQ,CACNC,UAAWjwB,EACXkwB,eAJezC,QAMhByF,KAAM5tC,IACP0b,GAAiB,WAAWvL,EAAM6J,kBAAoBha,EAAOS,MACtDT,KAGVkX,MAAOK,IAIN,MAFAiE,GAD0C,iBAAnBjE,GAAOkE,QAAuBlE,EAAMkE,QAAU,eAErEC,GAAiB,MACXnE,IAEZ,CAEA,SAASs2B,KAEP,OADc7yB,KACHjB,SAIX2B,GAAiB,uBACjBF,GAAS,MACFmwB,KACJiC,KAAK,KACJlyB,GAAiB,oBACjBG,GAAmB,QAEpB3E,MAAOK,IAGN,MADAiE,GAD0C,iBAAnBjE,GAAOkE,QAAuBlE,EAAMkE,QAAU,eAE/DlE,MAbRmE,GAAiB,4BACV+xB,QAAQC,QAAQ,CAAEI,gBAAgB,IAc7C,CAEA,SAASC,GAAmBxyB,GAC1B,OAAKA,EAIiB,MACpB,MAAMyyB,EAAezyB,EAAOmvB,QAAU,CAAC,EACvC,OAAIsD,EAAarD,WACfxxB,QAAQ80B,MAAM,2CAA2C1yB,EAAO9a,MACzDgtC,QAAQC,QAAQ,CAAEnyB,SAAQmvB,OAAQsD,MAE3C70B,QAAQ80B,MAAM,6CAA6C1yB,EAAO9a,uBAClEib,GAAiB,0BAlqBrBksB,eAAkCiE,GAChC,MAAMjC,EAAUxC,KAChB,IAAKwC,EACH,MAAM,IAAIzkC,MAAM,kCAElBgU,QAAQ80B,MAAM,+CAA+CpC,KAC7D,MAAMhC,QAAiBC,MAAM,GAAGF,cAAoBiC,KACpD,GAAwB,MAApBhC,EAASvwB,OAEX,OADAH,QAAQC,KAAK,2BAA2ByyB,4BACjC,CAAEqC,UAAU,GAErB,IAAKrE,EAASI,GAEZ,MADA9wB,QAAQC,KAAK,iDAAiDywB,EAASvwB,cAAcuyB,KAC/E,IAAI1mC,MAAM,+BAA+B0kC,EAASvwB,WAE1D,MAAMZ,QAAgBmxB,EAASK,OAE/B,OADA/wB,QAAQ80B,MAAM,+CAA+CpC,KACtDnzB,CACT,CAipBWy1B,CAAmB5yB,EAAO9a,IAAImtC,KAAM5tC,IACzC,GAAIA,GAAQkuC,SAAU,CACpB/0B,QAAQC,KAAK,2BAA2BmC,EAAO9a,2BAC/C,MAAM0P,EAAQ6K,KACR/Y,EAAQkO,EAAMsJ,QAAQ6B,UAAWhG,GAAUA,EAAM7U,KAAO8a,EAAO9a,IAKrE,MAJIwB,GAAS,GACXkO,EAAMsJ,QAAQjY,OAAOS,EAAO,GAE9B4Z,GAAmB,MACb,IAAI1W,MAAM,8BAClB,CACA,MAAMipC,EAAYpuC,GAAQgsC,QACpBqC,EAAkBD,GAAW1D,QAAU,CAAC,EAC9C,IAAK2D,EAAgB1D,UACnB,MAAM,IAAIxlC,MAAM,oDAElB,MAAMgL,EAAQ6K,KACRszB,EAAe,IAChB/yB,EACHmvB,OAAQ,CACNC,UAAW0D,EAAgB1D,WAAa,KACxCC,eAAgB/2B,MAAMuH,QAAQizB,EAAgBzD,gBAAkByD,EAAgBzD,eAAe56B,QAAU,GACzG66B,WAAYwD,EAAgBxD,YAAc,KAC1CC,eAAgBj3B,MAAMuH,QAAQizB,EAAgBvD,gBAAkBuD,EAAgBvD,eAAe96B,QAAU,IAE3Gy6B,UAAW2D,GAAW3D,WAAalvB,EAAOkvB,WAEtCxoC,EAAQkO,EAAMsJ,QAAQ6B,UAAWhG,GAAUA,EAAM7U,KAAO8a,EAAO9a,IAKrE,OAJIwB,GAAS,IACXkO,EAAMsJ,QAAQxX,GAASqsC,GAEzBn1B,QAAQ80B,MAAM,wCAAwC1yB,EAAO9a,MACtD,CAAE8a,OAAQ+yB,EAAc5D,OAAQ4D,EAAa5D,YAIjD6D,GACJX,KAAK,EAAGryB,OAAQizB,EAAgB9D,aAC/BpuB,KACAT,GAAmB,MACnBD,GAAa,MACbzC,QAAQ80B,MAAM,2CAA2CO,EAAe/tC,MACxEib,GAAiB,iBAAiB8yB,EAAexlC,MAAQwlC,EAAe/tC,SACxE+a,GAAS,MACF8wB,GAAgB5B,EAAOC,UAAW,CAAE6B,gBAAgB,IACxDoB,KAAMjzB,IACL,MAAM8B,EAAa0rB,KAEnB,OADAhvB,QAAQ80B,MAAM,4CAA4CO,EAAe/tC,MAClEmrC,GAAW4C,EAAe/tC,GAAI,CACnCguC,aAAc9zB,EACd+zB,iBAAkBjyB,IACjBmxB,KAAM5tC,IACP6b,GAAmB2yB,EAAe/tC,IAC9BoT,MAAMuH,QAAQpb,GAAQgsC,SAAStB,QAAQE,iBACzCqC,GAAsBjtC,EAAOgsC,QAAQtB,OAAOE,gBAE9ClvB,GAAiB,UAAU1b,GAAQgsC,SAAShjC,MAAQwlC,EAAexlC,MAAQwlC,EAAe/tC,MACnFT,QAIdkX,MAAOK,IACN,MAAMkE,EAAoC,iBAAnBlE,GAAOkE,QAAuBlE,EAAMkE,QAAU,cAIrE,MAHAtC,QAAQC,KAAK,mCAAmCmC,EAAO9a,OAAOgb,KAC9DG,GAAaH,GACbC,GAAiB,MACXnE,KA7ERqE,GAAa,uBACN6xB,QAAQkB,OAAO,IAAIxpC,MAAM,uBA8EpC,CChyBA,SAASypC,KACP38B,EAASjF,EAAI8C,KAAK7E,IAAI,GAAI6E,KAAKQ,IAAIxC,EAAOkB,MAAQ,GAAIiD,EAASjF,GACjE,CA+HA,SAAS6hC,GAAWjc,I/B3JpB,SAAqBA,GACnBrQ,IAAWqQ,CACb,C+B0JEkc,CAAYlc,GACZ3gB,EAASZ,gBAAkBvB,KAAK7E,IAAI,EAAGgH,EAASZ,gBAAkBuhB,GAClE3gB,EAASoB,cAAgBvD,KAAK7E,IAAI,EAAGgH,EAASoB,cAAgBuf,GAC9D3gB,EAASqB,eAAiBxD,KAAK7E,IAAI,GAAIgH,EAASqB,gBAAkB,GAAKsf,GACvE3gB,EAASV,UAAYzB,KAAK7E,IAAI,GAAIgH,EAASV,WAAa,GAAKqhB,GAC7D3gB,EAASuB,gBAAkB1D,KAAK7E,IAAI,GAAIgH,EAASuB,iBAAmB,GAAKof,GACzE3gB,EAAST,eAAiB1B,KAAK7E,IAAI,GAAIgH,EAAST,gBAAkB,GAAKohB,GACnE3gB,EAAST,gBAAkB,IAC7BS,EAASR,kBAAoB,GAG/B,MAAMs9B,EAAoB/nC,EAAMU,iBAChCV,EAAMU,kBAAmB,EACzB,MAAMsnC,EAAsBhoC,EAAMa,0BAC5BonC,EAAuBjoC,EAAMc,mBAC7BonC,EAA+BloC,EAAMe,4BACrCC,EAAwBhB,EAAMgB,sBAC9BmnC,EAA6BnoC,EAAMiB,0BACnCmnC,EAA6BpoC,EAAMkB,0BACnCmnC,EAA6BroC,EAAMmB,8BACnCmnC,EAAkCtoC,EAAMoB,+BACxCmnC,EAAmCvoC,EAAMqB,gCACzCmnC,EAAqCxoC,EAAMsB,kCAC3CmnC,EAAuCzoC,EAAMuB,oCAC7CmnC,EAAwC1oC,EAAMwB,qCACpDxB,EAAMa,2BAA4B,EAClCb,EAAMc,mBAAqB,KAC3Bd,EAAMe,6BAA8B,EACpCf,EAAMgB,sBAAwB,EAC9BhB,EAAMiB,2BAA4B,EAClCjB,EAAMkB,2BAA4B,EAClClB,EAAMmB,+BAAgC,EACtCnB,EAAMoB,gCAAiC,EACvCpB,EAAMqB,iCAAkC,EACxCrB,EAAMsB,mCAAoC,EAE1C,MAAMqnC,EAAqB19B,EAASvB,OAAS,GAAI1J,EAAMO,eACjDqoC,EAAoB39B,EAASvB,OAAS,GAAI1J,EAAMQ,cAChDqoC,EAAqB59B,EAASvB,OAAS,GAAI1J,EAAMS,eAEvDT,EAAMO,gBAAiB,EACvBP,EAAMQ,eAAgB,EACtBR,EAAMS,gBAAiB,EAEvB,MAAMqoC,EAAgB9oC,EAAMM,KAwB5B,GAvBAN,EAAMM,MAAO,ERnDf,SAAkCynC,GAChC,GAAI98B,EAASE,UAAW,CACtBF,EAASG,mBAAqB,KAC9B,MAAMoP,EAAU6a,KAIhB,YAHI0S,GAAqBvtB,GAAWA,EAAQG,eAAiB,KAC3Dmb,GAAYtb,EAAS,CAAEyb,gBAAiBzb,EAAQvR,SAGpD,CAEA,GAAIgC,EAASvB,QAAU,EAErB,YADAuB,EAASG,mBAAqB,MAIhC,IAAI29B,EAAc,KACdC,EAAY56B,OAAOC,kBACvB,MAAM2X,EAAevd,EAAe,EAAMpB,UACpC0kB,EAAc9gB,EAAShF,EAAI+f,EAEjC,IAAK,MAAMxL,KAAWY,GAAU,CAC9B,MAAMjc,EAAa8W,GAAoBuE,EAAQ9U,MAC/C,IAAKvG,EACH,SAEF,GAAIqb,EAAQE,SACV,SAEF,GAAIF,EAAQG,cAAgB,EAC1B,SAGF,MAAM/W,EAAakF,KAAKmmB,IAAIhkB,EAASjF,EAAIwU,EAAQxU,GAEjD,GAAIpC,GADkBzE,EAAWqX,aAAe,IAE9C,SAGF,MAAMyyB,EAAczuB,EAAQvU,EAAI9G,EAAW2G,OACrCjC,EAAWiF,KAAKmmB,IAAIlD,EAAckd,GAClC9yB,EAAehX,EAAWgX,cAAgB,SAChD,IAAI+yB,EAQJ,GANEA,EADmB,QAAjB/yB,EACkBrN,KAAK7E,IAAI,KAAM9E,EAAWkZ,kBAAoB,GAAK,IAC7C,UAAjBlC,EACWrN,KAAK7E,IAAI,IAAK9E,EAAW4Z,oBAAsB,IAAM,IAErD,GAElBlV,EAAWqlC,EACb,SAGF,MAAMC,EAAQvlC,EAAwB,GAAXC,EACvBslC,EAAQH,IACVA,EAAYG,EACZJ,EAAcvuB,EAElB,CAEAvP,EAASG,mBAAqB29B,GAAatvC,IAAM,KAE7CsuC,GAAqBgB,GApI3B,SAAsBvuB,GACpB,MAAMrb,EAAa8W,GAAoBuE,EAAQ9U,MAC1CvG,IAILqb,EAAQE,SAAW0a,GACnB5a,EAAQG,cAAgB,IACxB1P,EAASE,UAAYqP,EAAQ/gB,GAC7BwR,EAASC,YAAc,UACvBD,EAASG,mBAAqB,KAC9BH,EAASS,WAAY,EACrBT,EAASW,cAAgB,KACzBX,EAASU,aAAe,EACxBV,EAASY,cAAgB,EACzBZ,EAASc,iBAAkB,EAC3Bd,EAASe,iBAAmB,EAC5Bf,EAASgB,kBAAmB,EAC5BhB,EAASiB,eAAgB,EACzBjB,EAASkB,eAAejT,OAAS,EACjC+R,EAASpD,WAAY,EACrBoD,EAASnD,SAAU,EACnB2tB,GAAwBjb,EAASrb,GACnC,CA8GIiqC,CAAaL,EAEjB,CQZEM,CAAyBtB,GACrBC,GTnMN,WACE,GAAI/8B,EAASM,qBAAuB,EAClC,OAAO4oB,KAETlpB,EAASI,mBAAqBJ,EAASI,kBAAoB,GAAK/C,EAAepP,OAC/E,MAAM67B,EAAUZ,KAChBlpB,EAASK,eAAiBypB,GAASt7B,IAAMwR,EAASK,eAClDL,EAASM,qBjCeQ,GiCbnB,CS2LI+9B,GAEErB,GT3LN,SAA6Bj2B,GAC3B,MAAM/W,EAAQqN,EAAegM,UAAWygB,GAAYA,EAAQt7B,KAAOuY,GAC/D/W,GAAS,IACXgQ,EAASI,kBAAoBpQ,EAC7BgQ,EAASK,eAAiB0G,EAC1B/G,EAASM,qBjCMM,IiCJnB,CSqLIg+B,CAAoBtB,GAElBC,IACYl0B,KACJtB,QDwPZuB,IAAW,IANXA,IAAW,GACXc,GAAqB,GACrB4tB,OC9O8B,IAA1B3hC,GACYgT,KACJtB,SlC3Id,SAAoBkZ,GACwB,IAAtCpZ,GAAmBC,QAAQvZ,SAG/BsZ,GAAmBG,eAAiBH,GAAmBG,cAAgBiZ,EAAQpZ,GAAmBC,QAAQvZ,QAAUsZ,GAAmBC,QAAQvZ,OACjJ,CkCuIM,CAAoB8H,GAGpBmnC,EAA4B,CAC9B,MAAMh/B,EAAQ6K,KACRw1B,EAAiBrgC,EAAMuJ,QAAUvJ,EAAMsJ,QAAQtJ,EAAMwJ,eAAiB,KACxE62B,GACFzC,GAAmByC,GAAgBt5B,MAAOK,GAAU4B,QAAQC,KAAK,cAAe7B,GAEpF,CAaA,GAZI63B,GACYp0B,KACJtB,SACR8zB,KAAqBt2B,MAAOK,GAAU4B,QAAQC,KAAK,cAAe7B,IAGlE83B,GACYr0B,KACJtB,SACRm0B,KAAqB32B,MAAOK,GAAU4B,QAAQC,KAAK,sBAAuB7B,IAG1E+3B,EAAiC,CACnC,MAAMn/B,EAAQ6K,KACV7K,EAAMuJ,SAAWvJ,EAAM4J,SACzBsyB,GAAc,CAAEH,iBAAiB,EAAO3D,QAAQ,IAASrxB,MAAOK,GAAU4B,QAAQC,KAAK,oBAAqB7B,GAEhH,CAOA,GANIg4B,GACYv0B,KACJtB,SACR4zB,KAAqBp2B,MAAOK,GAAU4B,QAAQC,KAAK,sBAAuB7B,IAG1Ei4B,EAAoC,CACtC,MAAMr/B,EAAQ6K,KACV7K,EAAMuJ,SAAWvJ,EAAM4J,SACzBwzB,KAAwBr2B,MAAOK,GAAU4B,QAAQC,KAAK,sBAAuB7B,GAEjF,CACA,GAAIk4B,EAAsC,CACxC,MAAMt/B,EAAQ6K,KACV7K,EAAMuJ,SAAWvJ,EAAM4J,SACzBuuB,GAAoB,CAAEC,QAAQ,IAASrxB,MAAOK,GAAU4B,QAAQC,KAAK,wBAAyB7B,GAElG,CACIm4B,GACY10B,KACJtB,SACR+uB,KAA4BvxB,MAAOK,GAAU4B,QAAQC,KAAK,yBAA0B7B,IAGxF,IAAIypB,EAAgB3E,KAChBoU,EAAYr0B,QAAQ4kB,GAEpB/uB,EAASvB,QAAU,GAAK+/B,IRxI9B,SAAgCpwC,EAAU,CAAC,GACzC,MAAMmhB,EAAU6a,KAChB,IAAK7a,EAGH,OAFAvP,EAASE,UAAY,UACrBF,EAASC,YAAc,UAGzB4qB,GAAYtb,EAAS,CAAEub,cAAc,EAAMK,iBAAiB,KAAU/8B,GACxE,CQiIIqwC,CAAuB,CAAEzT,gBAAiB+D,GAAe/wB,SACzD+wB,EAAgB,KAChByP,GAAY,GAGVX,GAAiB79B,EAASvB,OAAS,IAAM+/B,GN9Q/C,SAAmBhT,GACjB,GAAIxrB,EAASE,UACX,OAEF,IAAKF,EAAS/B,UAAY+B,EAASnD,SAAWmD,EAASS,WAAaT,EAASvB,QAAU,IAAMuB,EAASV,WAAa,GAAK,EACtH,OAGF,MAAM,KAAErK,EAAI,MAAEC,GAAUs2B,EACpBv2B,IAASC,EACX8K,EAAShC,QAAU,EACV9I,IAAUD,IACnB+K,EAAShC,OAAS,GAGpBgC,EAASnD,SAAU,EACnBmD,EAASO,UrCxBW,IqCyBpBP,EAASpD,WAAY,EACrBoD,EAASzG,GAAK,CAChB,CM4PImlC,CAAU,CAAEzpC,KAAMF,EAAME,KAAMC,MAAOH,EAAMG,QAGxCspC,GAAsC,YAAzBx+B,EAASC,cACzBD,EAASC,YAAc,UAGzB,MAAM0+B,GAAUH,GAAax+B,EAASV,WAAa,IAAMU,EAASsB,UAE5Ds9B,IAAkBD,GAASjB,EAC3BmB,IAAiBF,GAAShB,EAC1BmB,IAAkBH,GAASf,EAE7B59B,EAASvB,OAAS,EAChB+/B,EAnMR,WACE,MAAMjvB,EAAU6a,KAChB,IAAK7a,EAGH,OAFAvP,EAASE,UAAY,UACrBF,EAASC,YAAc,UAGzBD,EAASC,YAAc,UACvBD,EAASpD,WAAY,EACrBoD,EAASnD,SAAU,EACnBmD,EAAS/B,SAAWsR,EAAQtR,UAAkC,MAAtBsR,EAAQN,UAClD,CAyLM8vB,GA5QN,SAA2Bpe,GACzB,GAAI3gB,EAASE,UACX,OAKF,GAFAF,EAASpD,UAAY7H,EAAMK,MAAQ4K,EAAS/B,WAAa+B,EAASnD,UAAYmD,EAASS,UAEnFT,EAASnD,QACXmD,EAAS1G,G3CnCM,I2CmCD0G,EAAShC,OACvBgC,EAASzG,GAAK,EACdyG,EAASO,WAAaogB,EAClB3gB,EAASO,WAAa,IACxBP,EAASnD,SAAU,OAEhB,CACL,IAAI2B,EAAYtC,EAUhB,GATI8D,EAASpD,YACX4B,GAAa,KAEXwB,EAASS,YACXjC,GAAa,IAEXwB,EAASsB,YACX9C,GAAa,IAEXwB,EAAST,eAAiB,EAAG,CAC/B,MAAMy/B,EAAah/B,EAASR,mBAAqB,GACjDhB,GAAaX,KAAK7E,IAAI,GAAK6E,KAAKQ,IAAI,EAAG2gC,GACzC,CACIh/B,EAASV,UAAY,IACvBd,GAAa,KAGfwB,EAAS1G,GAAK,EACVvE,EAAME,OACR+K,EAAS1G,IAAMkF,EACfwB,EAAShC,QAAU,GAEjBjJ,EAAMG,QACR8K,EAAS1G,IAAMkF,EACfwB,EAAShC,OAAS,GAGpB,MAAMihC,EAAUj/B,EAASV,WAAa,EAClCU,EAAS/B,UAAYghC,GAAWlqC,EAAMI,OAAS6K,EAASpD,YAAcoD,EAASS,YACjFT,EAASzG,I3CzEI,I2C0EbyG,EAAS/B,UAAW,GAGtB+B,EAASzG,IAAM4C,EAAUwkB,CAC3B,CAEA,MAAMyH,EAAYpoB,EAAShF,EAC3BgF,EAASjF,GAAKiF,EAAS1G,GAAKqnB,EAC5B3gB,EAAShF,GAAKgF,EAASzG,GAAKonB,EAC5B3gB,EAAS/B,UAAW,EAEpB,MAAM8rB,EAAiBvsB,EAAe,EAAMpB,UACrB8rB,GAAuBloB,EAAUooB,EAAW2B,IAGnD/pB,EAAShF,EAAI+uB,GACd9tB,IACX+D,EAAShF,EAAIiB,EAAW8tB,EACxB/pB,EAASzG,GAAK,EACdyG,EAAS/B,UAAW,GAIxB0+B,IACF,CAwMMuC,CAAkBve,GAxLxB,SAA0BA,GACxB,MAAMoJ,EAAiBvsB,EAAe,EAAMpB,UAC5C4D,EAASE,UAAY,KACrBF,EAASC,YAAc,SACvBD,EAASG,mBAAqB,KAC9BH,EAASmB,UAAYtD,KAAK7E,IAAI,EAAGgH,EAASmB,UAAYwf,GACtD3gB,EAAS1G,IAAM,GACf0G,EAASzG,IAAM4C,EAAUwkB,EACzB3gB,EAASjF,GAAKiF,EAAS1G,GAAKqnB,EAC5B3gB,EAAShF,GAAKgF,EAASzG,GAAKonB,EAEd3gB,EAAShF,EAAI+uB,GACd9tB,IACX+D,EAAShF,EAAIiB,EAAW8tB,EACxB/pB,EAASzG,GAAK,EACdyG,EAAS/B,UAAW,GAGtB0+B,KAE2B,IAAvB38B,EAASmB,YACXnB,EAASvB,OAASuB,EAAStB,UAC3BsB,EAASZ,gBAAkB,IAC3BY,EAASoB,cAAgB,EACzBpB,EAASqB,eAAiB,EAC1BrB,EAASsB,WAAY,EACrBtB,EAASV,UAAY,EACrBU,EAASuB,gBAAkB,EAC3BvB,EAAST,eAAiB,EAC1BS,EAASR,kBAAoB,E5BM/BiS,GAAQxjB,OAAS,EEEjBwlB,GAAiB,WD7DjBT,K2BuDEhT,EAASjF,EAAmB,GAAfc,EAAOkB,MACpBiD,EAAShF,EAAIiB,EAAW8tB,EACxB/pB,EAAS1G,GAAK,EACd0G,EAASzG,GAAK,EACdyG,EAAS/B,UAAW,EAExB,CAsJIkhC,CAAiBxe,GAGnB3gB,EAASQ,YN/SLR,EAASnD,QACJ,EAAMA,QAEXmD,EAASpD,UACJ,EAAMA,UAER,EAAMR,SM0Sb,MAAM6X,EAAazW,EAAewC,EAASQ,clCjM7C,SAA2Bg3B,EAAU,CAAC,GAChCr0B,OAAOwpB,SAAS6K,EAAQnvB,eAC1Bd,GAAmBa,eAAeC,YAAcxK,KAAK7E,IAAI,EAAG6E,KAAKgY,MAAM2hB,EAAQnvB,eAE7ElF,OAAOwpB,SAAS6K,EAAQlvB,cAC1Bf,GAAmBa,eAAeE,WAAazK,KAAK7E,IAAI,EAAG6E,KAAKgY,MAAM2hB,EAAQlvB,cAE5EnF,OAAOwpB,SAAS6K,EAAQjvB,eAC1BhB,GAAmBa,eAAeG,YAAc1K,KAAK7E,IAAI,EAAG6E,KAAKgY,MAAM2hB,EAAQjvB,cAEnF,CkC4LE,CAAkB,CAChBF,YAAa,EAJW1G,IAAmB1T,OAK3Cqa,WAJmBtG,EAAQge,OAAO,CAACtxB,EAAOiiB,IAAUjiB,GAASiiB,EAAMlS,OAAS,EAAI,EAAI,GAAI,GAKxF8J,YAJmB9G,EAAWue,OAAO,CAACtxB,EAAO0wC,IAAS1wC,GAAS0wC,GAAuB,aAAfA,EAAKlhC,MAAuB,EAAI,GAAI,KAO7G,MAAMmhC,EAAsC,oBAAhBz4B,YAA8BA,YAAYD,MAAQE,KAAKF,OR0LrF,SAAwBga,GACtB,IAAK,MAAMpR,KAAWY,GAAU,CAC9B,MAAMjc,EAAa8W,GAAoBuE,EAAQ9U,MAC/C,IAAKvG,EACH,SAGFqb,EAAQG,cAAgB7R,KAAK7E,IAAI,EAAGuW,EAAQG,cAAgBiR,GAC5DpR,EAAQI,YAAc9R,KAAK7E,IAAI,EAAGuW,EAAQI,YAAcgR,GAExD,MAAM0K,EAAe9b,EAAQE,WAAa0a,GACpCjf,EAAehX,EAAWgX,cAAgB,SAE3B,QAAjBA,EACFqhB,GAAiBhd,EAASrb,EAAYysB,EAAO0K,GACnB,UAAjBngB,EACT4gB,GAAmBvc,EAASrb,EAAYysB,EAAO0K,GAE/CD,GAAoB7b,EAASrb,EAAYysB,EAAO0K,GAGlDyC,GAA+Bve,EAASrb,EAAYysB,EAAO0K,GAEvDA,EACFb,GAAwBjb,EAASrb,GACP,WAAjBgX,IACTqE,EAAQC,OAAS,EAAID,EAAQC,MAAQ3R,KAAKQ,IAAI,EAAW,GAARsiB,GAErD,CACF,CQtNE2e,CAAe3e,GACfM,GAAkBN,GnB1GpB,SAA6BA,GAC3B,IAAK,MAAMzF,KAAgBlE,GACzBkE,EAAajc,WAAapB,KAAK7E,IAAI,GAAIkiB,EAAajc,YAAc,GAAK0hB,GACvEzF,EAAahc,WAAarB,KAAK7E,IAAI,GAAIkiB,EAAahc,YAAc,GAAKyhB,GACvEzF,EAAa5D,WAAazZ,KAAK7E,IAAI,GAAIkiB,EAAa5D,YAAc,GAAKqJ,GACvEzF,EAAa/b,gBAAkB+b,EAAahc,WAAa,EAAI,IAAO,GAChEgc,EAAa7D,UACf6D,EAAa3D,YAAc1Z,KAAKQ,IAAI,GAAI6c,EAAa3D,aAAe,GAAa,IAARoJ,GAEzEzF,EAAa3D,YAAc1Z,KAAK7E,IAAI,GAAIkiB,EAAa3D,aAAe,GAAa,GAARoJ,EAG/E,CmB+FE4e,CAAoB5e,GF/RtB,SAA4BA,GAE1B,GA7BF,WACE,GAAIoU,GAAWC,OACb,OAEFD,GAAWC,QAAS,EACpB,MAAMwK,EAAU3hC,KAAK7E,IDbX,GCa+CgJ,EAAQ/T,OAAQ,GACrEuxC,GAAW,GAGfvK,GAAauK,EACf,CAkBEC,GACIz9B,EAAQ/T,QDpCF,ICqCR8mC,GAAW7T,MDnCE,SCwCf,GADA6T,GAAW7T,OAASP,EAChBoU,GAAW7T,OAAS,EAAG,CACzB,MAAMwe,EAAU7hC,KAAK7E,ID5Cb,GC4CiDgJ,EAAQ/T,OAAQ,GACnE0xC,EAAQ9hC,KAAKQ,ID3CT,EADF,IC4CgF2D,EAAQ/T,QAEhGgnC,GADmBp3B,KAAK7E,IAAI2mC,EAAOD,IAEnC3K,GAAW7T,MD7CE,GC8Cf,CACF,CEiRE0e,CAAmBjf,GD6IrB,SAA6BA,EAAO5W,GAClC,MAAM7L,EAAQ6K,KAEd,GADAmyB,KACKh9B,EAAMuJ,QAAX,CAiBA,GAPAyuB,KAEInsB,EAAY7L,EAAMyJ,WlC9dH,OkC8dgEzJ,EAAM0J,WACvFkC,GAAqBC,GACrB2tB,MAGEx5B,EAAM4J,QAAS,CACjB,MAAM+3B,ElCnea,KkCoef91B,EAAY7L,EAAM8J,sBAAwB63B,GAC5CpG,IAEJ,CACAyB,IAfA,MAPE,GAAIh9B,EAAM4J,QAAS,CACjB,MAAM+3B,ElCndW,KkCodb91B,EAAY7L,EAAM8J,sBAAwB63B,GAC5CpG,IAEJ,CAkBJ,CCvKEqG,CAAoBnf,EAAO0e,GpC/L7B,WAGE,GLGF,SAA4BU,EAAW,KACrC,MAAMp5B,EAA6B,oBAAhBC,YAA8BA,YAAYD,MAAQE,KAAKF,MAC1E,IAAK,MAAOnY,EAAIiiB,KAAW,EAAcqP,UACnCnZ,GAAO8J,EAAOzJ,YAAcL,GAAOo5B,GACrC,EAAcj9B,OAAOtU,EAG3B,CKZEwxC,GACAj6B,MACKN,IAAkD,SAA/BA,GAAgBw6B,WACtC,OAEF,MAAMt5B,EAA8B,oBAAhBC,YAA8BA,YAAYD,MAAQE,KAAKF,MAC3E,GAAIA,EAAMhB,GAAe,GACvB,OAEFA,GAAegB,EACf,MAAMF,EAAU,CACdhM,KAAM,cACNjM,GAAI+W,GACJxO,KAAM,SACNgE,EAAGiF,EAASjF,EACZC,EAAGgF,EAAShF,EACZgD,OAAQgC,EAAShC,OACjB+I,UAAW/G,EAASK,gBAEtB,IACEoF,GAAgBy6B,KAAKruC,KAAKC,UAAU2U,GACtC,CAAE,MAEF,CACF,CoCuKE05B,GTxKF,SAA0Bxf,GACxB3gB,EAASM,qBAAuBzC,KAAK7E,IAAI,EAAGgH,EAASM,qBAAuBqgB,GAC5E,IAAI5gB,EAAY,EAChB,IAAK,MAAM8pB,KAAapoB,EACtBooB,EAAU9pB,UAAYA,EACtBA,GAAa,EACb6pB,GAAgBC,EAAWlJ,EAE/B,CSiKEyf,CAAiBzf,GACjBoO,EAAgB3E,KAChBoU,EAAYr0B,QAAQ4kB,GAChByP,IACFx+B,EAASC,YAAc,WAGpB0+B,IACH3+B,EAASS,WAAY,EACrBT,EAASW,cAAgB,KACzBX,EAASY,cAAgB,EACzBZ,EAASc,iBAAkB,EAC3Bd,EAASe,iBAAmB,EAC5Bf,EAASgB,kBAAmB,EAC5BhB,EAASiB,eAAgB,EACzBjB,EAASU,aAAe,EACxBV,EAASkB,eAAejT,OAAS,GAGnC,MAAM6lB,EAAShQ,IACTu8B,EAAiBvsB,GAAQ7c,UAAY,GAErCqpC,GADcxsB,GAAQ5c,aAAe,IACTjJ,OAAS,EACrCsyC,EAAiBF,EAAe1M,WAAW,UAC3C6M,EAAuC,cAAnBH,EAG1B,GAF0C,WAAnBA,GAGjBzB,GAAmBC,IACrBhrB,GAAaC,GAEf9T,EAASkB,eAAejT,OAAS,OAC5B,GAAIuyC,GACL5B,GAAmBC,IjBnV3B,WACE,MAAM/qB,EAAShQ,IACf,IAAK9D,EAASV,WAAa,GAAK,EAC9B,OAAO,EAET,IAAKwU,GAA8B,cAApBA,EAAO7c,SACpB,OAAO,EAET,GAAI+I,EAASoB,cAAgB,GAAKpB,EAASvB,QAAU,GAAKuB,EAASnD,QACjE,OAAO,EAGT,MAAMmX,EAASF,EAAO5a,WAAa,CAAC,EAC9B8E,EAASgC,EAAShC,QAAU,EAC5BwkB,EAAMxO,EAAO3a,aAAe,CAAEC,GAAI,IAAKC,IAAK,KAC5CuB,EAAckZ,EAAOlZ,aAAe,CAAEC,EAAG,GAAIC,EAAG,IAEtDgF,EAASoB,cAAgB4S,EAAOva,iBAAmB,GAEnD,MAAMgkB,EAAU,CACdjvB,GAAI,WAAWqY,KAAKF,SAAS9I,KAAKC,SAASlN,SAAS,IAAImN,MAAM,EAAG,KACjEhD,EAAGiF,EAASjF,EAAIiD,GAAUlD,EAAYC,GAAK,IAC3CC,EAAGgF,EAAShF,GAAKF,EAAYE,GAAK,IAClC1B,GAAI0E,GAAUwkB,EAAIlpB,IAAM,KACxBC,GAAIipB,EAAIjpB,KAAO,IACf7B,OAAQsc,EAAOtc,QAAU,GACzBkmB,KAAM5J,EAAO7a,aAAe,IAC5Bq5B,QAASxe,EAAO7a,aAAe,IAC/BC,gBAAiB4a,EAAO5a,iBAAmB,IAC3CzB,OAAQqc,EAAOrc,QAAU,GACzBC,UAAWoc,EAAOpc,WAAa,IAC/BO,cAAe6b,EAAO7b,eAAiB,GACvCqB,WAAY,GAAMwa,EAAOxa,YAAc,IAAM,EAAG,KAChDpB,MAAO4b,EAAO5b,OAAS,UACvBsB,kBAAmBsa,EAAOta,mBAAqB,IAC/CC,gBAAiB,GAAMqa,EAAOra,iBAAmB,IAAM,EAAG,GAC1DC,mBAAoB,GAAMoa,EAAOpa,oBAAsB,GAAK,EAAG,GAC/DC,WAAYma,EAAOna,YAAc,YACjCE,aAAcia,EAAOja,cAAgB,EACrCC,mBAAoBga,EAAOha,oBAAsB,EACjDE,cAAe8Z,EAAO9Z,eAAiB,EACvCC,YAAa6Z,EAAO7Z,aAAgB6Z,EAAO5a,iBAAmB,IAC9DgB,eAAgB4Z,EAAO5Z,gBAAkB,IACzCC,oBAAqB,GAAM2Z,EAAO3Z,qBAAuB,IAAM,GAAK,GACpEC,kBAAmB0Z,EAAO1Z,mBAAqB,GAC/CojB,WAAW,EACXC,eAAgB,GAGlBN,GAAW7tB,KAAKiuB,GAChBF,GAAuB,mBAAoB,CACzC/uB,GAAIivB,EAAQjvB,GACZqL,WAAY4jB,EAAQ5jB,WACpBkB,EAAG0iB,EAAQ1iB,EACXC,EAAGyiB,EAAQziB,EACXtD,OAAQ+lB,EAAQrkB,gBAChBwkB,KAAMH,EAAQG,MAIlB,CiBwRM6iB,GAEFzgC,EAASkB,eAAejT,OAAS,OAC5B,GAAIsyC,IAAmBD,GAE5B,GADAtgC,EAASkB,eAAejT,OAAS,EAC7B6lB,EAAQ,CACV,MAAM5P,EAAaT,EAAcqQ,EAAOtlB,IACpCswC,GACE,EAAchrB,EAAOtlB,MACvBwR,EAASS,WAAY,EACrBT,EAASW,cAAgB,KACzBX,EAASU,aAAe,GAGxBk+B,GACFlL,KAEExvB,GAAcA,EAAW5L,UAAY,GAAK4L,EAAW3L,QAAU,IAAM2L,EAAW5C,WAClF,EAAcwS,EAAOtlB,GAEzB,OACS8xC,GACL1B,GNzUR,WACE,GAAI5+B,EAASE,UACX,OAEF,GAAIF,EAASnD,SAAWmD,EAASvB,QAAU,IAAMuB,EAASV,WAAa,GAAK,GAAKU,EAASsB,UACxF,OAGF,MAAMwS,EAAShQ,IACT5M,EAAc4c,GAAQ5c,aAAe,GAChB,IAAvBA,EAAYjJ,SAIX+R,EAASS,UAKVT,EAASc,iBAAmBd,EAASU,YAAc,EAAIxJ,EAAYjJ,SACrE+R,EAASgB,kBAAmB,GAL5BqyB,GAAY,GAOhB,CMoTMqN,GAGE1gC,EAASS,WNrTjB,SAAuBkgB,EAAOggB,GAC5B,GAAI3gC,EAASE,UAQX,OAPAF,EAASS,WAAY,EACrBT,EAASW,cAAgB,KACzBX,EAASY,cAAgB,EACzBZ,EAASc,iBAAkB,EAC3Bd,EAASe,iBAAmB,EAC5Bf,EAASiB,eAAgB,OACzBjB,EAASU,aAAe,GAG1B,MAAM4yB,EAAStzB,EAASW,cACxB,IAAK2yB,EACH,OAEF,IAAKtzB,EAASV,WAAa,GAAK,GAAKU,EAASsB,UAO5C,OANAtB,EAASS,WAAY,EACrBT,EAASW,cAAgB,KACzBX,EAASY,cAAgB,EACzBZ,EAASc,iBAAkB,EAC3Bd,EAASe,iBAAmB,OAC5Bf,EAASiB,eAAgB,GAI3BjB,EAASY,eAAiB+f,GAErB3gB,EAASiB,eAAiBjB,EAASY,eAAiB0yB,EAAOn8B,SAC9DwpC,EAAcrN,GACdtzB,EAASiB,eAAgB,IAGtBjB,EAASc,iBAAmBd,EAASY,eAAiB0yB,EAAOh8B,aAChE0I,EAASc,iBAAkB,EAC3Bd,EAASe,iBAAmBuyB,EAAO/7B,aAGjCyI,EAASc,kBACXd,EAASe,kBAAoB4f,EACzB3gB,EAASe,kBAAoB,IAC/Bf,EAASc,iBAAkB,IAI/B,MAAMgT,EAAShQ,IACT5M,EAAc4c,GAAQ5c,aAAe,GAE3C,GAAI8I,EAASY,eAAiB0yB,EAAOn8B,OAASm8B,EAAOl8B,OAASk8B,EAAOj8B,SAAU,CAC7E,MAAMupC,EAAY5gC,EAASU,YAAc,EACnCmgC,EAAc7gC,EAASgB,kBAAoB4/B,EAAY1pC,EAAYjJ,OAEzE+R,EAASS,WAAY,EACrBT,EAASW,cAAgB,KACzBX,EAASY,cAAgB,EACzBZ,EAASc,iBAAkB,EAC3Bd,EAASe,iBAAmB,EAC5Bf,EAASiB,eAAgB,EACzBjB,EAASgB,kBAAmB,EAExB6/B,EACFxN,GAAYuN,GAEZ5gC,EAASU,aAAe,CAE5B,CACF,CMqPMogC,CAAcngB,EAAO4S,ILzW3B,SAAwB5S,EAAO1M,GAC7BjU,EAASkB,eAAiBlB,EAASkB,eAAesvB,OAAQjU,IACxDA,EAAOiX,WAAa7S,EACpBpE,EAAOkX,YAAczzB,EAAShC,OAC9Bue,EAAOxhB,EAAIiF,EAASjF,EAAIiF,EAAShC,OAASue,EAAO7c,QACjD6c,EAAOvhB,EAAIgF,EAAShF,EAAIiZ,EAAasI,EAAO9kB,aACrC8kB,EAAOiX,UAAY,GAE9B,CKoWIuN,CAAepgB,EAAO1M,GLlW1B,WACE,IAAK,MAAMsI,KAAUvc,EAASkB,eAAgB,CAC5C,GAAIa,EAActD,OAAS,IAAM8d,EAAOC,WAAWC,IAAI1a,EAAcvT,IAAK,CACxE,MAAM0jB,EAAKqK,EAAOxhB,EAAIgH,EAAchH,EAC9BoX,EAAKoK,EAAOvhB,GAAK+G,EAAc/G,EAA2B,IAAvB+G,EAAclH,QACtCgD,KAAK2U,MAAMN,EAAIC,IAChBoK,EAAO7kB,OAASqK,EAAcrK,SAC5C6kB,EAAOC,WAAWE,IAAI3a,EAAcvT,IACpCqmB,GAAmB,CACjBld,OAAQ4kB,EAAO5kB,OACfC,UAAW2kB,EAAO3kB,UAClBC,OAAQ0kB,EAAO1kB,OACfmG,OAAQue,EAAOkX,cAGrB,CAEA,IAAK,MAAM9iB,KAAS3O,EAAS,CAC3B,GAAI2O,EAAMlS,QAAU,GAAK8d,EAAOC,WAAWC,IAAI9L,EAAMniB,IACnD,SAEF,MAAM0jB,EAAKqK,EAAOxhB,EAAI4V,EAAM5V,EACtBoX,EAAKoK,EAAOvhB,GAAK2V,EAAM3V,EAAmB,GAAf2V,EAAM9V,QACtBgD,KAAK2U,MAAMN,EAAIC,IAChBoK,EAAO7kB,OAASiZ,EAAMjZ,SACpC6kB,EAAOC,WAAWE,IAAI/L,EAAMniB,IAC5BwmB,GAAmBrE,EAAO,CACxBhZ,OAAQ4kB,EAAO5kB,OACfC,UAAW2kB,EAAO3kB,UAClBC,OAAQ0kB,EAAO1kB,OACfmG,OAAQue,EAAOkX,cAGrB,CAEAnX,GAAsBC,EACxB,CACF,CK8TIykB,KAEAhhC,EAASkB,eAAejT,OAAS,EAC7BsyC,GAAkB3B,GACpBlL,OC1YN,SAA6B/S,GACvB5e,EAAc9C,WAAa,IAC7B8C,EAAc9C,WAAapB,KAAK7E,IAAI,EAAG+I,EAAc9C,WAAa0hB,IAGhE5e,EAAc7C,WAAa,IAC7B6C,EAAc7C,WAAarB,KAAK7E,IAAI,EAAG+I,EAAc7C,WAAayhB,IAGpE5e,EAAc5C,eAAiBtB,KAAK7E,IAAI,EAAG+I,EAAc5C,eAAyB,GAARwhB,GAEtE5e,EAActD,QAAU,IAC1BsD,EAAc1C,aAAexB,KAAK7E,IAAI,EAAG+I,EAAc1C,aAAeshB,GACnC,IAA/B5e,EAAc1C,eAChB0C,EAActD,OAASsD,EAAcrD,UACrCqD,EAAc9C,WAAa,EAC3B8C,EAAc7C,WAAa,EAC3B6C,EAAc5C,eAAiB,GAGrC,CD0XE8hC,CAAoBtgB,GjB/GtB,SAA0BA,GACxB,MAAM5jB,EAAQhB,EAAQF,OAAOkB,MAE7B,IAAK,MAAM0gB,KAAWJ,GACfI,EAAQC,UA0BXD,EAAQE,gBAAkBgD,GAzB1BlD,EAAQG,MAAQ+C,EAChBlD,EAAQlkB,IAAM4C,EAAUshB,EAAQtlB,cAAgBwoB,EAChDlD,EAAQ1iB,GAAK0iB,EAAQnkB,GAAKqnB,EAC1BlD,EAAQziB,GAAKyiB,EAAQlkB,GAAKonB,EAEtBlD,EAAQziB,EAAIyiB,EAAQ/lB,QAAUuE,IAChCwhB,EAAQziB,EAAIiB,EAAWwhB,EAAQ/lB,OAC3B+lB,EAAQlkB,GAAK,IACfkkB,EAAQlkB,IAAMkkB,EAAQlkB,GAAKkkB,EAAQjkB,YAErCikB,EAAQnkB,IAAM,GACVuE,KAAKmmB,IAAIvG,EAAQlkB,IAAM,KACzBkkB,EAAQlkB,GAAK,KAIbkkB,EAAQ1iB,EAAI0iB,EAAQ/lB,QAAU,GAAK+lB,EAAQ1iB,EAAI0iB,EAAQ/lB,QAAUqF,KACnE0gB,EAAQ1iB,EAAI,GAAM0iB,EAAQ1iB,EAAG0iB,EAAQ/lB,OAAQqF,EAAQ0gB,EAAQ/lB,QAC7D+lB,EAAQnkB,GAAmB,KAAbmkB,EAAQnkB,IAGpBmkB,EAAQG,MAAQ,GAClBJ,GAASC,IAOf,IAAK,IAAIzvB,EAAIqvB,GAAWpvB,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAC3CqvB,GAAWrvB,GAAG0vB,WAAaL,GAAWrvB,GAAG2vB,gBAAkB,GAC7DN,GAAW9tB,OAAOvB,EAAG,IAjF3B,SAA2B2yB,GACzB,IAAK,MAAM5C,KAAST,GAAa,CAC/BS,EAAM1M,KAAOxT,KAAK7E,IAAI,EAAG+kB,EAAM1M,KAAOsP,GACtC,MAAMqC,EAAW,EAAIjF,EAAM1M,KAAO0M,EAAMrjB,SAGxC,GAFAqjB,EAAMrmB,OAAS,GAAMqmB,EAAMC,YAAcD,EAAMrE,UAAYqE,EAAMC,YAAc,GAAMgF,EAAU,EAAG,GAAIjF,EAAMC,WAAYD,EAAMrE,WAC9HqE,EAAMI,WAAawC,EACf5C,EAAMI,WAAa,EAAG,CACxBJ,EAAMI,UAAYJ,EAAMG,KACxB,MAAMgjB,EAAkBnjB,EAAMrmB,OAC9B,IAAK,MAAMiZ,KAAS3O,EAAS,CAC3B,GAAI2O,EAAMlS,QAAU,EAClB,SAEF,MAAMyT,EAAKvB,EAAM5V,EAAIgjB,EAAMhjB,EACrBoX,EAAMxB,EAAM3V,EAAmB,GAAf2V,EAAM9V,OAAgBkjB,EAAM/iB,EAC9C6C,KAAK2U,MAAMN,EAAIC,IAAO+uB,IACxBvwB,EAAMpR,eAAiB1B,KAAK7E,IAAI2X,EAAMpR,gBAAkB,EAAGwe,EAAMG,KAAO,IACxEvN,EAAMnR,kBAAoB3B,KAAKQ,IAAIsS,EAAMnR,mBAAqB,EAAGue,EAAME,gBAE3E,CACA,MACMlD,EAAevd,EADRwC,EAASQ,aAAe,CAAEnE,WAAY,GAAIC,WAAY,GAAIC,UAAW,KAE5Eye,EAAgBhb,EAAShF,EAAmB,GAAf+f,EAC7BomB,EAAMnhC,EAASjF,EAAIgjB,EAAMhjB,EACzBqmC,EAAMpmB,EAAgB+C,EAAM/iB,EAC9B6C,KAAK2U,MAAM2uB,EAAKC,IAAQF,IAC1BlhC,EAAST,eAAiB1B,KAAK7E,IAAIgH,EAAST,gBAAkB,EAAGwe,EAAMG,KAAO,IAC9Ele,EAASR,kBAAoB3B,KAAKQ,IAAI2B,EAASR,mBAAqB,EAAGue,EAAME,eAAiB,IAElG,CACF,CAEA,IAAK,IAAIjwB,EAAIsvB,GAAYrvB,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAChD,GAAIsvB,GAAYtvB,GAAGqjB,MAAQ,EAAG,CAC5B,MAAMgwB,EAAa/jB,GAAY/tB,OAAOvB,EAAG,GAAG,GAC5CuvB,GAAuB,4BAA6B,CAClD/uB,GAAI6yC,EAAW7yC,GACfuM,EAAGsmC,EAAWtmC,EACdC,EAAGqmC,EAAWrmC,EACdtD,OAAQ2pC,EAAW3nB,WAAa2nB,EAAW3pC,QAE/C,CAEJ,CA0CE4pC,CAAkB3gB,EACpB,CiBuEE4gB,CAAiB5gB,GzB9WnB,SAAuBA,IH+EvB,SAAuBA,GACrB,IAAK,MAAMhP,KAAUF,GAAS,CAC5BE,EAAOjX,UAAYimB,EACnBhP,EAAOe,WAAaiO,EACpB,MAAMluB,EAASif,GAAcC,GACzBlf,GAAUkf,EAAOe,WAAa,GAChCL,GAAWV,EAAQlf,EAEvB,CACA,IAAK,IAAIzE,EAAIyjB,GAAQxjB,OAAS,EAAGD,GAAK,EAAGA,GAAK,EACxCyjB,GAAQzjB,GAAG0M,UAAY,GACzB+W,GAAQliB,OAAOvB,EAAG,EAGxB,CG5FEwzC,CAAc7gB,GDWhB,SAAsBA,GACf1N,GAAY7b,SAGjB6b,GAAYvY,UAAYimB,EACxB1N,GAAYhU,WAAapB,KAAK7E,IAAI,EAAGia,GAAYhU,WAAa0hB,GAC1D1N,GAAYvY,UAAY,EAC1B+Y,GAAiB,WACRR,GAAYtX,UAAY,IAEjC2X,GAAoB,iBAAkB,CACpCI,OAAQ,UACRE,OAHaR,KAIbF,YAAaD,GAAYC,YACzBxb,OAAQub,GAAYvb,SAEtB+b,GAAiB,YAErB,CC5BEguB,CAAa9gB,EACf,CyB4WE+gB,CAAc/gB,GzB1WhB,SAA8BA,IFyD9B,SAA4BA,GACtBhO,GAAalO,SAAW,IAC1BkO,GAAalO,SAAW5G,KAAK7E,IAAI,EAAG2Z,GAAalO,SAAWkc,IAjDhE,SAAuBA,GACrB,IAAKhO,GAAavb,OAChB,OAGF,MAAMkE,EAAcqX,GAAarX,aAAe,IAC1CC,EAAYoX,GAAapX,WAAa,IACtComC,GAAiBhvB,GAAaI,WAAaxX,EAAYD,GAAeqlB,EAE5E,GAAKhO,GAAaI,WAMX,CACLJ,GAAajY,UAAYimB,EACzB,MAAMzO,EAAKS,GAAaE,QAAU7S,EAASjF,EACrCoX,EAAKQ,GAAaG,QAAU9S,EAAShF,EACrCuX,EAAW1U,KAAK2U,MAAMN,EAAIC,GAEhC,GAAII,EAAW,GAAI,CACjB,MAAMqvB,EAAO/jC,KAAKQ,IAAIkU,EAAUhX,EAAYolB,GAC5C3gB,EAAS1G,GAAM4Y,EAAKK,EAAYqvB,EAAOjhB,EACvC3gB,EAASzG,GAAM4Y,EAAKI,EAAYqvB,EAAOjhB,EACvC3gB,EAASjF,GAAMmX,EAAKK,EAAYqvB,EAChC5hC,EAAShF,GAAMmX,EAAKI,EAAYqvB,CAClC,CAEAjvB,GAAaC,aAAe/U,KAAK7E,IAAI,EAAG2Z,GAAaC,aAAe+uB,IAChEhvB,GAAajY,UAAY,GAAKiY,GAAaC,cAAgB,IAC7DI,IAEJ,MAvBEL,GAAaC,cAAgB+uB,EACzBhvB,GAAaC,cAAgBD,GAAavX,YAC5CuX,GAAaC,aAAeD,GAAavX,UACzCuX,GAAaI,YAAa,EAqBhC,CAiBE8uB,CAAclhB,EAChB,CE7DEmhB,CAAmBnhB,EACrB,CyByWEohB,CAAqBphB,GvC3PvB,SAA0BA,EAAOqhB,GAC/B,MAAMC,EAAmB,GACzB,IAAK,MAAOr/B,EAAUS,KAAUX,EAAUod,UAExC,GADY,EAAmBld,GAC/B,CAKA,GAAIS,EAAM/B,YACR+B,EAAME,YAAc1F,KAAK7E,IAAI,EAAGqK,EAAME,YAAcod,GAChDtd,EAAME,aAAe,GAAG,CAC1B,GAAIF,EAAMH,WAAaC,OAAOC,kBAAmB,CAC/C,MAAM8+B,EAAS7+B,EAAMH,SAAWG,EAAM/K,SACtC,GAAI4pC,EAAS,EAAG,CACd,MAAMC,EAAStkC,KAAKQ,IAAI6jC,EAAQ7+B,EAAM9K,SACtC8K,EAAM/K,UAAY6pC,EAClB9+B,EAAM9K,SAAW4pC,CACnB,CACF,CACA9+B,EAAM/B,WAAY,EAClB+B,EAAME,YAAc,EACpB0+B,EAAiBzyC,KAAKoT,EACxB,CAGF,GAAIS,EAAMvK,QAAUuK,EAAML,UAAW,CACnC,MAAMvU,EAAO4U,EAAML,UAAUvU,MAAQ,EAC/B4I,EAAWgM,EAAML,UAAU3L,UAAY,EAE3CgM,EAAMvK,OAAOwK,QADXjM,EAAW,EACUwG,KAAK7E,IAAIvK,EAAM4U,EAAMvK,OAAOwK,QAAUjM,EAAWspB,GAEjD9iB,KAAK7E,IAAIvK,EAAM4U,EAAMvK,OAAOwK,SAAW7U,EAElE,CA3BA,MAFEiU,EAAUI,OAAOF,GAgCrB,GAAIo/B,EAAgB,CAClB,MAAM3+B,EAAQX,EAAUlO,IAAIwtC,GAC5BhiC,EAASsB,UAAY+B,GAAO/B,YAAa,CAC3C,MACEtB,EAASsB,WAAY,EAGvB,GAAsB,oBAAX1O,OACT,IAAK,MAAMgQ,KAAYq/B,EACrBrvC,OAAO2gB,cAAc,IAAIC,YAAY,uBAAwB,CAAE9O,OAAQ,CAAE9B,cAG/E,CuC2MEw/B,CAAiBzhB,EAAO7M,GAAQtlB,IAAM,MXnYxC,SAAsBmyB,GACpB,MAAM0hB,EAAYva,GAAYjvB,OAAS,GACjCypC,EAAczkC,KAAK7E,IAAI,EAAG,EAAIqpC,EAAY1hB,GAChDmH,GAAYC,gBAAkBua,EAC9Bxa,GAAYE,cAAgBsa,CAC9B,CW+XEC,CAAa5hB,G7BpYf,SAA4BA,GAC1B,IAAK,MAAM6hB,KAASjxB,GAClBixB,EAAMnxB,MAAQsP,EACd6hB,EAAMznC,GAAKynC,EAAMlpC,GAAKqnB,EACtB6hB,EAAMxnC,GAAKwnC,EAAMjpC,GAAKonB,EACtB6hB,EAAMjpC,IAAM,GAAKonB,EAGnB,IAAK,IAAI3yB,EAAIujB,GAAatjB,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAC7CujB,GAAavjB,GAAGqjB,MAAQ,GAC1BE,GAAahiB,OAAOvB,EAAG,EAG7B,C6BwXEy0C,CAAmB9hB,GrB9GrB,SAAyBA,GACvBjI,KACA,IAAK,IAAI1qB,EAAI2pB,GAAU1pB,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CACjD,MAAM00C,EAAI/qB,GAAU3pB,GAEpB,GADA00C,EAAE3qB,KAAO4I,EACL+hB,EAAE3qB,KAAO,EAAG,CACdJ,GAAUpoB,OAAOvB,EAAG,GACpB,QACF,CACA,MAAMqjB,EAAO,GAAMqxB,EAAE3qB,IAAM2qB,EAAEvqB,OAAQ,EAAG,GACxCuqB,EAAE3nC,GAAK2nC,EAAEppC,GAAKqnB,EACd+hB,EAAE1nC,GAAK0nC,EAAEnpC,GAAKonB,EACC,WAAX+hB,EAAEjoC,MACJioC,EAAEppC,IAAM,IACRopC,EAAEnpC,IAAM,IACRmpC,EAAEhrC,QAAU,IAAc,IAAP2Z,GACC,UAAXqxB,EAAEjoC,MACXioC,EAAEppC,IAAM,GACRopC,EAAEnpC,GAAmB,IAAbmpC,EAAEnpC,IAAM,GAAW,GAAKonB,EAChC+hB,EAAEhrC,QAAU,KAAe,IAAP2Z,GACA,UAAXqxB,EAAEjoC,MACXioC,EAAEppC,IAAM,IACRopC,EAAEnpC,IAAM,KACY,WAAXmpC,EAAEjoC,MACXioC,EAAEnpC,IAAM,IAAMonB,EACd+hB,EAAEppC,IAAM,IACRopC,EAAEnpC,IAAM,GACRmpC,EAAEhrC,QAAU,KACQ,UAAXgrC,EAAEjoC,MACXioC,EAAEppC,IAAM,GACRopC,EAAEnpC,IAAM,GACRmpC,EAAEhrC,QAAU,GAAa,IAAP2Z,IAElBqxB,EAAEppC,IAAM,IACRopC,EAAEnpC,IAAM,IAEZ,CAEA,IAAK,IAAIvL,EAAI4pB,GAAM3pB,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CAC7C,MAAMgqB,EAAOJ,GAAM5pB,GACnBgqB,EAAKD,KAAO4I,EACR3I,EAAKD,KAAO,GACdH,GAAMroB,OAAOvB,EAAG,EAGpB,CACF,CqBiEE20C,CAAgBhiB,GZtHlB,SAA2BA,GACzB,KACAiH,GAAWzC,GAAexE,GAC1BiH,GAAWxC,GAAczE,GACzBiH,GAAWvC,GAAiB1E,GAC5BiH,GAAWtC,GAAS3E,GACpBiH,GAAWrC,GAAgB5E,EAC7B,CYgHEiiB,CAAkBjiB,GlB3WpB,SAA2BA,GACzB,IAAK,MAAM3oB,KAAc2kB,GAMvB,GALA3kB,EAAWqZ,MAAQsP,EACnB3oB,EAAWuB,IAAM4C,EAAUwkB,EAAQ3oB,EAAWG,cAC9CH,EAAW+C,GAAK/C,EAAWsB,GAAKqnB,EAChC3oB,EAAWgD,GAAKhD,EAAWuB,GAAKonB,EAE5B3oB,EAAWgD,EAAIhD,EAAWN,QAAUuE,EACtCjE,EAAWqZ,KAAO,OAIpB,GAAItP,EAActD,OAAS,IAAMzG,EAAWwkB,WAAWC,IAAI1a,EAAcvT,KACnEquB,GAAc7kB,EAAW+C,EAAG/C,EAAWgD,EAAGhD,EAAWN,OAAQqK,EAAchH,EAAGgH,EAAc/G,EAA2B,IAAvB+G,EAAclH,OAAekH,EAAcrK,QAC7IM,EAAWwkB,WAAWE,IAAI3a,EAAcvT,IACxCqmB,GAAmB,CACjBld,OAAQK,EAAWL,OACnBC,UAAWI,EAAWJ,UACtBoG,OAAQhG,EAAWgG,SAErBhG,EAAWqZ,KAAO,MARtB,CAaA,IAAK,MAAMV,KAAS3O,EAClB,KAAI2O,EAAMlS,QAAU,GAAKzG,EAAWwkB,WAAWC,IAAI9L,EAAMniB,MAGrDquB,GAAc7kB,EAAW+C,EAAG/C,EAAWgD,EAAGhD,EAAWN,OAAQiZ,EAAM5V,EAAG4V,EAAM3V,EAAmB,GAAf2V,EAAM9V,OAAc8V,EAAMjZ,QAAS,CACrHM,EAAWwkB,WAAWE,IAAI/L,EAAMniB,IAChCwmB,GAAmBrE,EAAO,CACxBhZ,OAAQK,EAAWL,OACnBC,UAAWI,EAAWJ,UACtBC,OAAQ,EACRmG,OAAQhG,EAAWgG,SAErBhG,EAAWqZ,KAAO,EAClB,KACF,CAEErZ,EAAWqZ,KAAO,GAChBgL,GAA0BrkB,KAC5BA,EAAWqZ,KAAO,EApBtB,CA0BF,IAAK,IAAIrjB,EAAI2uB,GAAY1uB,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAC5C2uB,GAAY3uB,GAAGqjB,MAAQ,GACzBsL,GAAYptB,OAAOvB,EAAG,EAG5B,CkBsTE60C,CAAkBliB,G9B5WpB,SAAwBA,EAAOmiB,GAC7B,IAAK,MAAMC,KAASnyB,GAClBmyB,EAAM1xB,MAAQsP,EACdoiB,EAAMxpC,IAAM4C,EAAUwkB,EAAQ,GAC9BoiB,EAAMhoC,GAAKgoC,EAAMzpC,GAAKqnB,EACtBoiB,EAAM/nC,GAAK+nC,EAAMxpC,GAAKonB,EACtBoiB,EAAMzpC,IAAM,IAERypC,EAAM/nC,EAAI+nC,EAAMrrC,QAAUorC,IAC5BC,EAAM/nC,EAAI8nC,EAAUC,EAAMrrC,OAC1BqrC,EAAMxpC,GAAiB,KAAXwpC,EAAMxpC,GAClBwpC,EAAMzpC,IAAM,GACRuE,KAAKmmB,IAAI+e,EAAMxpC,IAAM,KACvBwpC,EAAMxpC,GAAK,IAKjB,IAAK,IAAIvL,EAAI4iB,GAAS3iB,OAAS,EAAGD,GAAK,EAAGA,GAAK,EACzC4iB,GAAS5iB,GAAGqjB,MAAQ,KACtBT,GAASrhB,OAAOvB,EAAG,EAGzB,C8BsVEg1C,CAAeriB,EAAO1kB,GJnOxB,SAAuB0kB,GACrB,IAAK,MAAMhQ,KAAS3O,EAClBsyB,GAAc3jB,EAAOgQ,GAEvB,IAAK,MAAMhQ,KAAS3O,EAClB6yB,GAAmBlkB,EAEvB,CI6NEsyB,CAActiB,EAChB,CD+bsB,oBAAX/tB,SACTA,OAAOswC,cAAgB,CACrBrL,MAAOH,GACPyL,KAAMjK,GACNjoC,KAAM0oC,GACNyJ,KAAM1J,GACN2J,YAAa9H,GACb+H,YAAa1H,GACb2H,YAAazH,GACb0H,UAAWpJ,GACXqJ,gBAAiB,IAAMrJ,GAAc,CAAEH,iBAAiB,EAAM3D,QAAQ,IACtEoN,YAAarI,GACbsI,aAAcrI,GACdsI,eAAgBvN,GAChBwN,iBAAkBrN,GAClBsN,eAAgB5N,GAChBh4B,MAAO6K,K7CpnBLvS,IAGJ5D,OAAOyT,iBAAiB,UAAY1P,GAAUF,GAAU,EAAME,IAC9D/D,OAAOyT,iBAAiB,QAAU1P,GAAUF,GAAU,EAAOE,IAC7D/D,OAAOyT,iBAAiB,YAtD1B,SAAyB1P,GACF,IAAjBA,EAAMotC,QACRhvC,EAAMO,gBAAiB,EACvBP,EAAMW,YAAa,EACnBiB,EAAME,kBACoB,IAAjBF,EAAMotC,SACfhvC,EAAMQ,eAAgB,EACtBR,EAAMY,WAAY,EAClBgB,EAAME,iBAEV,GA6CEjE,OAAOyT,iBAAiB,UA3C1B,SAAuB1P,GACA,IAAjBA,EAAMotC,QACRhvC,EAAMW,YAAa,EACnBiB,EAAME,kBACoB,IAAjBF,EAAMotC,SACfhvC,EAAMY,WAAY,EAClBgB,EAAME,iBAEV,GAoCEjE,OAAOyT,iBAAiB,cAAgB1P,GAAUA,EAAME,kBACxDjE,OAAOyT,iBAAiB,OAnC1B,WACEtR,EAAME,MAAO,EACbF,EAAMG,OAAQ,EACdH,EAAMI,MAAO,EACbJ,EAAMK,MAAO,EACbL,EAAMM,MAAO,EACbN,EAAMO,gBAAiB,EACvBP,EAAMQ,eAAgB,EACtBR,EAAMS,gBAAiB,EACvBT,EAAMU,kBAAmB,EACzBV,EAAMW,YAAa,EACnBX,EAAMY,WAAY,EAClBZ,EAAMa,2BAA4B,EAClCb,EAAMc,mBAAqB,KAC3Bd,EAAMe,6BAA8B,EACpCf,EAAMgB,sBAAwB,EAC9BhB,EAAMiB,2BAA4B,EAClCjB,EAAMkB,2BAA4B,EAClClB,EAAMmB,+BAAgC,EACtCnB,EAAMoB,gCAAiC,EACvCpB,EAAMqB,iCAAkC,EACxCrB,EAAMsB,mCAAoC,EAC1CtB,EAAMuB,qCAAsC,EAC5CvB,EAAMwB,sCAAuC,CAC/C,GAYEC,GAAc,GQxLVoN,IAGJhR,OAAOyT,iBAAiB,UAZ1B,SAAyB1P,GACvB,MAAMqtC,GAXiBptC,EAWMD,EAAMC,MAV1B+8B,WAAW,SACXxwB,OAAO8gC,SAASrtC,EAAKmH,MAAM,GAAI,IAEpCnH,EAAK+8B,WAAW,UACXxwB,OAAO8gC,SAASrtC,EAAKmH,MAAM,GAAI,IAEjCoF,OAAO+gC,IAPhB,IAAyBttC,GAYlBuM,OAAO81B,MAAM+K,IAASA,GAAQ,IAfnCjgC,EAgBoBigC,EAjBO,GAkBzBrtC,EAAME,iBAEV,GAOE+M,GAAsB,GCiBlB,IAAiC,oBAAXhR,SAG1B,IAAc,EACd+R,KACAtQ,OAAO8vC,KAAK9/B,IAAiB+/B,QAtB/B,SAAmBC,GACjB,MAAMrwB,EAAS3P,GAAgBggC,GAC1BrwB,GAGLphB,OAAOyT,iBAAiBg+B,EAAY1tC,KAvCtC,SAAsBqd,EAAQtP,GAC5B,MAAM4/B,EAAM3/B,KACZ,IAAK2/B,EACH,OAEFv/B,KAEA,MAAM4B,EAAMC,YAAYD,MAClBlC,EAAWuP,EAAOvP,UAAY,GAC9BtQ,EAAM6f,EAEZ,GAAIrN,GADSvC,GAAa5P,IAAIL,IAAQ,GACrBsQ,EACf,OAEFL,GAAaZ,IAAIrP,EAAKwS,GAEtB,MAAM49B,EAAMD,EAAIE,mBAChBD,EAAI9pC,KAAOuZ,EAAOxP,OAAS,OAC3B,MAAMigC,EAA4C,mBAArBzwB,EAAO1P,UAA2B0P,EAAO1P,UAAUI,GAAUsP,EAAO1P,UACjGigC,EAAIjgC,UAAUogC,eAAe7mC,KAAK7E,IAAI,GAAIyrC,GAAiB,KAAMH,EAAIK,aAErE,MAAMC,EAAWN,EAAIO,aACfC,EAAWjnC,KAAK7E,IAAI,KAAOgb,EAAOzP,MAAQ,KAC1CwgC,EAAelnC,KAAK7E,IAAI,IAAMgb,EAAOtZ,UAAY,KACvDkqC,EAASrgC,KAAKmgC,eAAeI,EAAUR,EAAIK,aAC3CC,EAASrgC,KAAKygC,6BAA6B,KAAQV,EAAIK,YAAcI,GAErER,EAAIU,QAAQL,GACZA,EAASK,QAAQX,EAAIY,aAErBX,EAAIY,QACJZ,EAAInB,KAAKkB,EAAIK,YAAcI,EAC7B,CAQIK,CAAapxB,EAAQrd,GAAO+N,QAAU,CAAC,IAE3C,GAeE9R,OAAOyT,iBAAiB,cAAenB,IACvCtS,OAAOyT,iBAAiB,UAAWnB,KC8DnCa,KACsB,oBAAXnT,SACTA,OAAOyS,IAAM,CACX60B,YA5ENvE,iBACE5vB,KACA,MAAM0C,QAAcjD,GAAe00B,cAGnC,aAFM10B,GAAe6/B,oBAAoB58B,GACzC5C,GAAyBhU,KAAKC,UAAU2W,GACjC5C,EACT,EAuEM60B,aArEN/E,eAA4B2P,GAC1Bv/B,KACA,MAAM/O,EAAcnF,KAAK6U,MAAM4+B,SACzB9/B,GAAe+/B,qBAAqB,IAAIC,sBAAsBxuC,IACpE,MAAM0R,QAAelD,GAAek1B,eAGpC,aAFMl1B,GAAe6/B,oBAAoB38B,GACzC7C,GAAyBhU,KAAKC,UAAU4W,GACjC7C,EACT,EA8DMk1B,wBA5DNpF,eAAuC2P,GACrCv/B,KACA,MAAM/O,EAAcnF,KAAK6U,MAAM4+B,SACzB9/B,GAAe+/B,qBAAqB,IAAIC,sBAAsBxuC,GACtE,EAyDMigC,mBAvDNtB,eAAkC8P,GAChC,IAAKA,EACH,OAEF1/B,KACA,MAAMO,EAAY,IAAIo/B,gBAAgB7zC,KAAK6U,MAAM++B,UAC3CjgC,GAAemgC,gBAAgBr/B,EACvC,EAiDMs/B,oBA/CN,WACE,OAAO//B,EACT,EA8CMswB,mBA5CN,WACE,MAAO,IAAIrwB,GACb,EA2CM+/B,UAAWz+B,GACX0+B,MAKN,WACMrgC,KACFA,GAAgBqgC,QAChBrgC,GAAkB,MAEhBC,KACFA,GAAeogC,QACfpgC,GAAiB,MAEfF,KACFA,GAAesgC,QACftgC,GAAiB,MAEnBI,GAAmB,cACrB,IsC9KA,IAAImgC,GAAWn/B,YAAYD,MA6B3B/T,OAAOozC,sBA3BP,SAASC,EAAKl8B,GACZ,MAAM4W,EAAQ9iB,KAAKQ,KAAK0L,EAAYg8B,IAAY,IAAM,IACtDA,GAAWh8B,EAEX6yB,GAAWjc,GTDb,WACE,MAAMulB,EAAcnqC,EAAQoqC,qBAAqB,EAAG,EAAG,EAAGpqC,EAAQF,OAAOhB,QACzEqrC,EAAYrT,aAAa,EAAG,WAC5BqT,EAAYrT,aAAa,GAAK,WAC9BqT,EAAYrT,aAAa,IAAM,WAC/BqT,EAAYrT,aAAa,EAAG,WAC5B92B,EAAQ4lB,UAAYukB,EACpBnqC,EAAQumB,SAAS,EAAG,EAAGvmB,EAAQF,OAAOkB,MAAOhB,EAAQF,OAAOhB,QAG5DkB,EAAQ4lB,UAAY,UACpB5lB,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO,EAAG5lB,EAAW,KAC7BF,EAAQmmB,OAAO,IAAKjmB,EAAW,KAC/BF,EAAQmmB,OAAO,IAAKjmB,EAAW,KAC/BF,EAAQmmB,OAAO,IAAKjmB,EAAW,KAC/BF,EAAQmmB,OAAO,IAAKjmB,EAAW,KAC/BF,EAAQmmB,OAAO,KAAMjmB,EAAW,KAChCF,EAAQmmB,OAAO,KAAMjmB,EAAW,KAChCF,EAAQmmB,OAAO,KAAMjmB,EAAW,KAChCF,EAAQmmB,OAAOnmB,EAAQF,OAAOkB,MAAOd,EAAW,KAChDF,EAAQmmB,OAAOnmB,EAAQF,OAAOkB,MAAOd,GACrCF,EAAQmmB,OAAO,EAAGjmB,GAClBF,EAAQgmB,YACRhmB,EAAQimB,OAGR,MAAMokB,EAAUrqC,EAAQoqC,qBAAqB,EAAGlqC,EAAW,IAAK,EAAGA,EAAW,IAC9EmqC,EAAQvT,aAAa,EAAG,2BACxBuT,EAAQvT,aAAa,EAAG,uBACxB92B,EAAQ4lB,UAAYykB,EACpBrqC,EAAQumB,SAAS,EAAGrmB,EAAW,IAAKF,EAAQF,OAAOkB,MAAO,KAE1DhB,EAAQ4lB,UAAY,UACpB5lB,EAAQumB,SAAS,EAAGrmB,EAAUF,EAAQF,OAAOkB,MAAOhB,EAAQF,OAAOhB,OAASoB,EAC9E,CShCEoqC,GZyGF,YA/FA,WACE,IAAK,MAAMC,KAAQtpC,EAAmB,CACpC,MAAM21B,EAAW52B,EAAQoqC,qBAAqBG,EAAKvrC,EAAGurC,EAAKrpC,IAAKqpC,EAAKvrC,EAAGurC,EAAKrpC,IAAMqpC,EAAKppC,OACxFy1B,EAASE,aAAa,EAAG,2BACzBF,EAASE,aAAa,GAAK,0BAC3BF,EAASE,aAAa,EAAG,0BACzB92B,EAAQ4lB,UAAYgR,EACpB52B,EAAQumB,SAASgkB,EAAKvrC,EAAGurC,EAAKrpC,IAAKqpC,EAAKvpC,MAAOupC,EAAKppC,OAEpDnB,EAAQ4lB,UAAY,4BACpB5lB,EAAQumB,SAASgkB,EAAKvrC,EAAI,GAAIurC,EAAKrpC,IAAM,EAAGqpC,EAAKvpC,MAAQ,GAAI,GAE7DhB,EAAQkmB,YAAc,4BACtBlmB,EAAQqc,UAAY,IACpB,IAAK,IAAIpqB,EAAI,EAAGA,EAAIs4C,EAAKvpC,MAAO/O,GAAK,GAAI,CACvC,MAAMu4C,EAAQD,EAAKrpC,IAAM,EAAsC,EAAlCY,KAAK4a,IAAqB,KAAhBzqB,EAAIs4C,EAAKrpC,MAChDlB,EAAQ6lB,YACR7lB,EAAQ8lB,OAAOykB,EAAKvrC,EAAI/M,EAAGu4C,GAC3BxqC,EAAQ+lB,iBAAiBwkB,EAAKvrC,EAAI/M,EAAI,GAAIu4C,EAAQ,EAAGD,EAAKvrC,EAAI/M,EAAI,GAAIu4C,GACtExqC,EAAQomB,QACV,CACF,CACF,CA0EEqkB,GACA,IAAK,MAAMle,KAAYxrB,EACrBmsB,GAAaX,IAjEjB,WACE,IAAK,MAAMme,KAAStpC,EAClB,OAAQspC,EAAMhsC,MACZ,IAAK,WAAY,CACfsB,EAAQwlB,OACRxlB,EAAQ4lB,UAAY,UACpB5lB,EAAQumB,SAASmkB,EAAM1rC,EAAG0rC,EAAMzrC,EAAGyrC,EAAM1pC,MAAO0pC,EAAM5rC,QACtDkB,EAAQ4lB,UAAY,UACpB,MAAM+kB,EAAS7oC,KAAK7E,IAAI,EAAG6E,KAAKwmB,MAAMoiB,EAAM5rC,OAAS,KACrD,IAAK,IAAI8rC,EAAI,EAAGA,EAAID,EAAQC,GAAK,EAAG,CAClC,MAAM3rC,EAAIyrC,EAAMzrC,EAAI,GAAK2rC,GAAKF,EAAM5rC,OAAS6rC,GAC7C3qC,EAAQumB,SAASmkB,EAAM1rC,EAAI,GAAIC,EAAGyrC,EAAM1pC,MAAQ,GAAI,EACtD,CACAhB,EAAQ0mB,UACR,KACF,CACA,IAAK,YACH1mB,EAAQwlB,OACRxlB,EAAQ4lB,UAAY,UACpB5lB,EAAQumB,SAASmkB,EAAM1rC,EAAI0rC,EAAM1pC,MAAQ,EAAG0pC,EAAMzrC,EAAIyrC,EAAM5rC,OAAQ4rC,EAAM1pC,MAAO0pC,EAAM5rC,QACvFkB,EAAQ4lB,UAAY,UACpB5lB,EAAQ2yB,KAAO,qCACf3yB,EAAQ4yB,UAAY,SACpB5yB,EAAQ6yB,SAAS6X,EAAMrpC,MAAQ,KAAMqpC,EAAM1rC,EAAG0rC,EAAMzrC,EAAIyrC,EAAM5rC,OAAS,GACvEkB,EAAQkmB,YAAc,UACtBlmB,EAAQqc,UAAY,EACpBrc,EAAQwmB,WAAWkkB,EAAM1rC,EAAI0rC,EAAM1pC,MAAQ,EAAG0pC,EAAMzrC,EAAIyrC,EAAM5rC,OAAQ4rC,EAAM1pC,MAAO0pC,EAAM5rC,QACzFkB,EAAQ0mB,UACR,MAEF,IAAK,cACH1mB,EAAQwlB,OACRxlB,EAAQkmB,YAAc,UACtBlmB,EAAQqc,UAAY,EACpBrc,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO4kB,EAAM1rC,EAAG0rC,EAAMzrC,EAAI,KAClCe,EAAQmmB,OAAOukB,EAAM1rC,EAAG0rC,EAAMzrC,EAAI,IAClCe,EAAQomB,SACRpmB,EAAQ4lB,UAAY,UACpB5lB,EAAQ6lB,YACR7lB,EAAQymB,IAAIikB,EAAM1rC,EAAG0rC,EAAMzrC,EAAI,GAAI,GAAI,EAAa,EAAV6C,KAAKgS,IAC/C9T,EAAQimB,OACRjmB,EAAQ0mB,UACR,MAEF,IAAK,WACH1mB,EAAQwlB,OACRxlB,EAAQ4lB,UAAY,UACpB5lB,EAAQ6lB,YACR7lB,EAAQ+nB,QAAQ2iB,EAAM1rC,EAAG0rC,EAAMzrC,EAAG,GAAI,GAAI,EAAG,EAAa,EAAV6C,KAAKgS,IACrD9T,EAAQimB,OACRjmB,EAAQ4lB,UAAY,UACpB5lB,EAAQumB,SAASmkB,EAAM1rC,EAAI,GAAI0rC,EAAMzrC,EAAI,EAAG,GAAI,IAChDe,EAAQ0mB,UAOhB,CAOEmkB,EACF,CY9GEC,GfsOF,WACE,MAAMv2B,EAAUC,KACVu2B,ETjNC9vB,GSkNP,GAAK8vB,GAA0B,IAAjBA,EAAM74C,OAApB,CAIA8N,EAAQwlB,OACR,IAAK,MAAMrG,KAAgB4rB,EACzBpkB,GAAiBxH,EAAc5K,GAEjCvU,EAAQ0mB,SANR,CAOF,CejPEskB,GTgCF,WACE,MAAMhY,EAAgB3E,KAChB4c,EAAchnC,EAASG,mBAE7B,IAAK,MAAMoP,KAAWY,GAAU,CAC9B,MAAMjc,EAAa8W,GAAoBuE,EAAQ9U,MAC/C,IAAKvG,EACH,SAGF,MAAM+yC,EAAkBlY,GAAevgC,KAAO+gB,EAAQ/gB,GAChD04C,GAAeD,GAAmBD,IAAgBz3B,EAAQ/gB,GAC1D24C,EAAYjzC,EAAW6I,OAAS,IAChCqqC,EAAalzC,EAAW2G,QAAU,GAClCqb,EAAYhiB,EAAW4X,WAAa,UACpCsK,EAAcliB,EAAW6X,aAAe,UAE9ChQ,EAAQwlB,OACRxlB,EAAQgnB,UAAUxT,EAAQxU,EAAGwU,EAAQvU,GACrCe,EAAQsrC,QAAS93B,EAAQC,MAAQ,GAAK3R,KAAKgS,GAAM,KAEjD9T,EAAQ4lB,UAAYzL,EACpBna,EAAQumB,UAAU6kB,EAAY,GAAIC,EAAa,EAAGD,EAAWC,GAE7DrrC,EAAQ4lB,UAAYvL,EACpBra,EAAQumB,UAAU6kB,EAAY,GAAIC,EAAa,EAAI,EAAe,GAAZD,EAAiB,GAEvEprC,EAAQ0mB,WAEJwkB,GAAmBC,KACrBnrC,EAAQwlB,OACRxlB,EAAQqc,UAAY6uB,EAAkB,EAAI,EAC1ClrC,EAAQkmB,YAAcglB,EAAkB,UAAY,UACpDlrC,EAAQurC,YAAYL,EAAkB,GAAK,CAAC,EAAG,IAC/ClrC,EAAQwmB,WACNhT,EAAQxU,EAAIosC,EAAY,EAAI,GAC5B53B,EAAQvU,EAAIosC,EAAa,EAAI,GAC7BD,EAAY,GACZC,EAAa,IAEfrrC,EAAQ0mB,UAEZ,CACF,CS1EE8kB,GhB2BF,WACE,MAAMC,EDgJCtoB,GC/IP,GAAqB,IAAjBsoB,EAAMv5C,OAAV,CAIA8N,EAAQwlB,OACRxlB,EAAQ4yB,UAAY,SACpB5yB,EAAQ2yB,KAAO,qCAEf,IAAK,MAAMhO,KAAQ8mB,EAAO,CACxBnmB,GAAUX,GACV,MAAM+mB,EAAU7oB,GAAkB8B,EAAKP,QACpB,eAAfO,EAAKxiB,QACPnC,EAAQ4lB,UAAYjB,EAAK3B,UACzBhjB,EAAQylB,YAAc,GACtBzlB,EAAQ6yB,SAAS6Y,GAASnqC,OAASojB,EAAKpjB,OAAS,cAAeojB,EAAK3lB,EAAG2lB,EAAK1lB,EAAI,IAErF,CAEAe,EAAQ0mB,SAhBR,CAiBF,CgB/CEilB,GT2EF,WACE,MAAMtP,EAAUz2B,IAChB,IAAK,MAAMgmC,KAAUvP,EAAS,CAC5B,MAAM36B,EAAO,EAAMrB,SACbC,EAAaoB,EAAKpB,WAClBC,EAAamB,EAAKnB,WAClBC,EAAYkB,EAAKlB,UACjBC,EAAYiB,EAAKjB,UACvBT,EAAQwlB,OACRxlB,EAAQkmB,YAAc,UACtBlmB,EAAQqc,UAAY,EACpB,MAAMwvB,EAAcD,EAAO3sC,EAAIqB,EAC/BN,EAAQ6lB,YACR7lB,EAAQymB,IAAImlB,EAAO5sC,EAAG6sC,EAAavrC,EAAY,EAAa,EAAVwB,KAAKgS,IACvD9T,EAAQomB,SACR,MAAM0lB,EAAQF,EAAO3sC,EAAiB,EAAbqB,EACnByrC,EAAeD,EAAQvrC,EAC7BP,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO8lB,EAAO5sC,EAAG8sC,GACzB9rC,EAAQmmB,OAAOylB,EAAO5sC,EAAG+sC,GACzB/rC,EAAQomB,SACRpmB,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO8lB,EAAO5sC,EAAG8sC,EAAQ,GACjC9rC,EAAQmmB,OAAOylB,EAAO5sC,EAAIyB,EAAWqrC,EAAoB,GAAZrrC,GAC7CT,EAAQ8lB,OAAO8lB,EAAO5sC,EAAG8sC,EAAQ,GACjC9rC,EAAQmmB,OAAOylB,EAAO5sC,EAAIyB,EAAWqrC,EAAoB,GAAZrrC,GAC7CT,EAAQomB,SACR,MAAM4lB,EAAWlqC,KAAK7E,IAAgB,GAAZwD,EAAiB,IACrCwrC,EAAYnqC,KAAKQ,IAAIpC,EAAU6rC,EAAevrC,GAC9C0rC,EAAapqC,KAAKQ,IAAIpC,EAAU6rC,EAA2B,IAAZvrC,GACrDR,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO8lB,EAAO5sC,EAAG+sC,GACzB/rC,EAAQmmB,OAAOylB,EAAO5sC,EAAIgtC,EAAUC,GACpCjsC,EAAQ8lB,OAAO8lB,EAAO5sC,EAAG+sC,GACzB/rC,EAAQmmB,OAAOylB,EAAO5sC,EAAIgtC,EAAUE,GACpClsC,EAAQomB,SACRpmB,EAAQ4lB,UAAY,UACpB5lB,EAAQ2yB,KAAO,qCACf3yB,EAAQ4yB,UAAY,SACpB5yB,EAAQ6yB,SAAS+Y,EAAO5wC,MAAQ4wC,EAAOn5C,IAAM,OAAQm5C,EAAO5sC,EAAG4sC,EAAO3sC,EAAI,IAC1Ee,EAAQ0mB,SACV,CACF,CSpHEylB,GTkwBF,WACE,MAAMhqC,EAAQ6K,KACd,IAAK7K,EAAMuJ,QACT,OAGF,MACM0gC,EAAc,IACdptC,EAA2B,GAAvBgB,EAAQF,OAAOkB,MAAcqrC,IACjCptC,EAA4B,GAAxBe,EAAQF,OAAOhB,OAAestC,IAExCpsC,EAAQwlB,OACRxlB,EAAQ4lB,UAAY,yBACpB5lB,EAAQumB,SAASvnB,EAAGC,EAPD,IAOgBmtC,GACnCpsC,EAAQkmB,YAAc,UACtBlmB,EAAQqc,UAAY,EACpBrc,EAAQwmB,WAAWxnB,EAAGC,EAVH,IAUkBmtC,GAErCpsC,EAAQ4lB,UAAY,UACpB5lB,EAAQ2yB,KAAO,qCACf3yB,EAAQ4yB,UAAY,OACpB5yB,EAAQ6yB,SAAS,iBAAkB7zB,EAAI,GAAIC,EAAI,IAE/Ce,EAAQ2yB,KAAO,qCACf3yB,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,+CAAgD7zB,EAAI,GAAIC,EAAI,IAC7Ee,EAAQ6yB,SAAS,qGAAsG7zB,EAAI,GAAIC,EAAI,IAEnI,IAAIqtC,EAAUrtC,EAAI,GACdkD,EAAMoH,QACRvJ,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS1wB,EAAMoH,MAAOvK,EAAI,GAAIstC,GACtCA,GAAW,IAETnqC,EAAM2J,gBACR9L,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS1wB,EAAM2J,cAAe9M,EAAI,GAAIstC,GAC9CA,GAAW,IAETnqC,EAAMiK,YACRpM,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS1wB,EAAMiK,UAAWpN,EAAI,GAAIstC,GAC1CA,GAAW,IAETnqC,EAAMgK,aACRnM,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS1wB,EAAMgK,WAAYnN,EAAI,GAAIstC,GAC3CA,GAAW,IAGb,MAAMC,EAAUD,EAAU,GAEpBE,EAAavtC,EAAImtC,EAAc,IAC/B3gC,EAAUtJ,EAAMsJ,SAAW,GAC3BghC,EAAU3qC,KAAK7E,IAAI,EAAG6E,KAAKwmB,OAAOkkB,EAAaD,GAHnC,KAIZG,EAAa5qC,KAAKQ,IAAImJ,EAAQvZ,OAAQ4P,KAAKQ,IAAImqC,EAAS,IAE9DzsC,EAAQ2yB,KAAO,qCACf,IAAK,IAAI1gC,EAAI,EAAGA,EAAIy6C,EAAYz6C,GAAK,EAAG,CACtC,MAAMsb,EAAS9B,EAAQxZ,GACjB06C,EAAOJ,EATG,GASOt6C,EACJA,IAAMkQ,EAAMwJ,gBAE7B3L,EAAQ4lB,UAAY,2BACpB5lB,EAAQumB,SAASvnB,EAAI,GAAI2tC,EAAO,EAAGN,IAAiBO,KAEtD5sC,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAStlB,EAAOvS,MAAQuS,EAAO9a,IAAM,SAAUuM,EAAI,GAAI2tC,EAAO,GACtE3sC,EAAQ4lB,UAAY,UACpB,MAAMinB,EAAU,GAAGt/B,EAAOxY,KAAO,eAAewY,EAAO8uB,SAAW,OAAO9uB,EAAO+uB,YAAc,SAAS/uB,EAAOgvB,QAAU,OACxHv8B,EAAQ6yB,SAASga,EAAS7tC,EAAI,GAAI2tC,EAAO,GAC3C,CAEuB,IAAnBlhC,EAAQvZ,SACV8N,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,wBAAyB7zB,EAAI,GAAIutC,EAAU,KAG9D,MAAMO,EAAU,CAACl+B,EAAOm+B,EAAQ,KACT,iBAAVn+B,EACF,GAEFA,EAAM1c,OAAS66C,EAAQ,GAAGn+B,EAAM5M,MAAM,EAAG+qC,QAAcn+B,EAG1DnC,EAAMtK,EAAMsK,KAAO,CAAC,EAC1B,IAAIugC,EAAO/tC,EAAImtC,EAAc,IAC7BpsC,EAAQ2yB,KAAO,qCACf3yB,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,gBAAiB7zB,EAAI,GAAIguC,GAC1CA,GAAQ,GAEJvgC,EAAIlD,QACNvJ,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAASpmB,EAAIlD,MAAOvK,EAAI,GAAIguC,GACpCA,GAAQ,IAGN7qC,EAAM4J,SACJU,EAAIG,cACN5M,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,sBAAuB7zB,EAAI,GAAIguC,GAChDA,GAAQ,IACCvgC,EAAIC,OACb1M,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,iCAAkC7zB,EAAI,GAAIguC,GAC3DA,GAAQ,GACRhtC,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAASia,EAAQrgC,EAAIC,OAAQ1N,EAAI,GAAIguC,GAC7CA,GAAQ,KAERhtC,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,0CAA2C7zB,EAAI,GAAIguC,GACpEA,GAAQ,IAGNvgC,EAAII,gBACN7M,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,iCAAkC7zB,EAAI,GAAIguC,GAC3DA,GAAQ,KAGNvgC,EAAII,eACN7M,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,uBAAwB7zB,EAAI,GAAIguC,GACjDA,GAAQ,IACCvgC,EAAIE,QACb3M,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,wCAAyC7zB,EAAI,GAAIguC,GAClEA,GAAQ,GACRhtC,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAASia,EAAQrgC,EAAIE,QAAS3N,EAAI,GAAIguC,GAC9CA,GAAQ,KAERhtC,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,6CAA8C7zB,EAAI,GAAIguC,GACvEA,GAAQ,IAIZ,MAAMjjC,EAAkBlE,MAAMuH,QAAQX,EAAI1C,iBAAmB0C,EAAI1C,gBAAkB,GAC7EgD,EAAmBlH,MAAMuH,QAAQX,EAAIM,kBAAoBN,EAAIM,iBAAmB,GAElFN,EAAIK,oBACN9M,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,+BAAgC7zB,EAAI,GAAIguC,GACzDA,GAAQ,IAGV,MAAMC,EACJ,oBAAsBljC,EAAgB7X,OAAS,wBAA0B6a,EAAiB7a,OAK5F,GAJA8N,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAASoa,EAAkBjuC,EAAI,GAAIguC,GAC3CA,GAAQ,GAEJjjC,EAAgB7X,OAAS,EAAG,CAC9B,MAAMg7C,EAAiB,eAAiBJ,EAAQ/iC,EAAgBA,EAAgB7X,OAAS,GAAI,IAC7F8N,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAASqa,EAAgBluC,EAAI,GAAIguC,GACzCA,GAAQ,EACV,MAAYvgC,EAAIK,oBACd9M,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAAS,oDAAqD7zB,EAAI,GAAIguC,GAC9EA,GAAQ,IAGV,GAAIjgC,EAAiB7a,OAAS,EAAG,CAC/B,MAAMi7C,EAAkB,gBAAkBL,EAAQ//B,EAAiBA,EAAiB7a,OAAS,GAAI,IACjG8N,EAAQ4lB,UAAY,UACpB5lB,EAAQ6yB,SAASsa,EAAiBnuC,EAAI,GAAIguC,GAC1CA,GAAQ,EACV,MAAYvgC,EAAIK,oBACd9M,EAAQ4lB,UAAY,UAChBzjB,EAAM4J,QACR/L,EAAQ6yB,SAAS,4CAA6C7zB,EAAI,GAAIguC,GAEtEhtC,EAAQ6yB,SAAS,oDAAqD7zB,EAAI,GAAIguC,GAEhFA,GAAQ,IAGVhtC,EAAQ0mB,SACV,CSv7BE0mB,GTqHF,WACE,MAAMnZ,EAAc/F,KACdljB,EAAYipB,GAAalG,SAASt7B,IAAM,OACxC46C,EAAgB,CACpBC,KAAM,UACNC,OAAQ,UACRhW,OAAQ,UACRiW,MAAO,WAET,IAAK,MAAMnK,KAAQ39B,EAAY,CAC7B,MAAMhE,EAAO,EAAMrB,SACbC,EAAaoB,EAAKpB,WAClBC,EAAamB,EAAKnB,WAClBC,EAAYkB,EAAKlB,UACjBC,EAAYiB,EAAKjB,UAEvBT,EAAQwlB,OACR,MAAMioB,EAAUJ,EAAcriC,IAAc,UAC5ChL,EAAQkmB,YAAcunB,EACtBztC,EAAQqc,UAAY,EACpBrc,EAAQ0tC,QAAU,QAElB,MAAM7B,EAAcxI,EAAKpkC,EAAIqB,EAC7BN,EAAQ6lB,YACR7lB,EAAQymB,IAAI4c,EAAKrkC,EAAG6sC,EAAavrC,EAAY,EAAa,EAAVwB,KAAKgS,IACrD9T,EAAQomB,SAER,MAAM0lB,EAAQzI,EAAKpkC,EAAiB,EAAbqB,EACjByrC,EAAeD,EAAQvrC,EAC7BP,EAAQ6lB,YACR7lB,EAAQ8lB,OAAOud,EAAKrkC,EAAG8sC,GACvB9rC,EAAQmmB,OAAOkd,EAAKrkC,EAAG+sC,GACvB/rC,EAAQomB,SAERpmB,EAAQ6lB,YACR7lB,EAAQ8lB,OAAOud,EAAKrkC,EAAG8sC,EAAQ,GAC/B9rC,EAAQmmB,OAAOkd,EAAKrkC,EAAIyB,EAAWqrC,EAAoB,GAAZrrC,GAC3CT,EAAQ8lB,OAAOud,EAAKrkC,EAAG8sC,EAAQ,GAC/B9rC,EAAQmmB,OAAOkd,EAAKrkC,EAAIyB,EAAWqrC,EAAoB,GAAZrrC,GAC3CT,EAAQomB,SAER,MAAM4lB,EAAWlqC,KAAK7E,IAAgB,GAAZwD,EAAiB,IACrCwrC,EAAYnqC,KAAKQ,IAAIpC,EAAU6rC,EAAevrC,GAC9C0rC,EAAapqC,KAAKQ,IAAIpC,EAAU6rC,EAA2B,IAAZvrC,GASrD,GAPAR,EAAQ6lB,YACR7lB,EAAQ8lB,OAAOud,EAAKrkC,EAAG+sC,GACvB/rC,EAAQmmB,OAAOkd,EAAKrkC,EAAIgtC,EAAUC,GAClCjsC,EAAQ8lB,OAAOud,EAAKrkC,EAAG+sC,GACvB/rC,EAAQmmB,OAAOkd,EAAKrkC,EAAIgtC,EAAUE,GAClClsC,EAAQomB,UAEHid,EAAKngC,YAAc,GAAK,EAAG,CAC9B,MAAM+lB,EAAQnnB,KAAKQ,IAAI,EAAG+gC,EAAKngC,WAAa,KAC5ClD,EAAQ4lB,UAAY,uBAAuBqD,KAC3CjpB,EAAQ6lB,YACR7lB,EAAQymB,IAAI4c,EAAKrkC,EAAkB,GAAdqkC,EAAKphC,OAAa6pC,EAAoB,GAAZrrC,EAAiB,GAAI,EAAa,EAAVqB,KAAKgS,IAC5E9T,EAAQimB,MACV,CAEAjmB,EAAQ4lB,UAAY6nB,EACpBztC,EAAQ2yB,KAAO,qCACf3yB,EAAQ4yB,UAAY,SACpB5yB,EAAQ6yB,SAASwQ,EAAKroC,MAAQ,OAAQqoC,EAAKrkC,EAAGqkC,EAAKpkC,EAAI,IACvDe,EAAQ0mB,SACV,CACF,CStLEinB,GTyQF,WACE,MAAMC,EAAQ5nC,EACRuO,EAAUC,KAEVq5B,EAAOD,EAAM3uC,EACb6uC,EAAQF,EAAMzqC,WAAa,EAAIrB,KAAK4a,IAAc,GAAVnI,GAAgBq5B,EAAMxqC,eAAiB,GAAMwqC,EAAMzqC,WAAa,GAAK,EAAG,GAAK,EACrHQ,EAAUiqC,EAAMlrC,OAAS,EAAIorC,EAAQ,EACrC3zB,EAAYyzB,EAAMlrC,OAAS,EAAKkrC,EAAM1qC,WAAa,EAAI,UAAY,UAAa,UAEtFlD,EAAQqc,UAAY,EACpBrc,EAAQkmB,YAAc/L,EACtBna,EAAQ0tC,QAAU,QAElB,MAAMz6B,EAAU26B,EAAM5uC,EAAI2E,EAC1B3D,EAAQ6lB,YACR7lB,EAAQymB,IAAIxT,EAAS46B,EAZF,MAYiC,EAAa,EAAV/rC,KAAKgS,IAC5D9T,EAAQomB,SAERpmB,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO7S,EAAS46B,EAAOvtC,IAC/BN,EAAQmmB,OAAOlT,EAAS/S,EAjBL,IAkBnBF,EAAQomB,SAERpmB,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO7S,EAAS/S,EArBL,IAsBnBF,EAAQmmB,OAAOlT,EAAU,GAAI/S,GAC7BF,EAAQ8lB,OAAO7S,EAAS/S,EAvBL,IAwBnBF,EAAQmmB,OAAOlT,EAAU,GAAI/S,GAC7BF,EAAQomB,SAER,MAAM2nB,EAAOF,EAAOvtC,GACpBN,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO7S,EAAS86B,GACxB/tC,EAAQmmB,OAAOlT,EAAU,GAAI86B,EAAO,IACpC/tC,EAAQ8lB,OAAO7S,EAAS86B,GACxB/tC,EAAQmmB,OAAOlT,EAAU,GAAI86B,EAAO,IACpC/tC,EAAQomB,SAER,MAEM4nB,EAAO/6B,EAAU8V,GACjBklB,EAAOJ,EAAO,GACpB7tC,EAAQ4lB,UAAY,UACpB5lB,EAAQumB,SAASynB,EAAMC,EALN,IACC,IAKlB,MAAMrlB,EAAcglB,EAAMlrC,OAASkrC,EAAMjrC,UACzC3C,EAAQ4lB,UAAYgoB,EAAMlrC,OAAS,EAAI,UAAY,UACnD1C,EAAQumB,SAASynB,EAAMC,EARN,IAQuB,GAAMrlB,EAAa,EAAG,GAP5C,IAQlB5oB,EAAQkmB,YAAc,UACtBlmB,EAAQwmB,WAAWwnB,EAAMC,EAVR,IACC,IAWlBjuC,EAAQ4lB,UAAY,UACpB5lB,EAAQ2yB,KAAO,qCACf3yB,EAAQ4yB,UAAY,SACpB,MAAMrxB,EAAQqsC,EAAMlrC,OAAS,EAAI,kBAAkBZ,KAAKgY,MAAM8zB,EAAMlrC,WAAWkrC,EAAMjrC,YAAc,gBACnG3C,EAAQ6yB,SAAStxB,EAAO0R,EAASg7B,EAAO,GACxCjuC,EAAQ4yB,UAAY,MACtB,CShUEsb,GTkUF,WACE,MAAM35B,EAAUC,KAChB,IAAK,MAAMI,KAAS3O,EAAS,CAC3B,GAAI2O,EAAMlS,QAAU,EAClB,SAGF,MAAMorC,EAAQl5B,EAAMzR,WAAa,EAAIrB,KAAK4a,IAAc,GAAVnI,GAAgBK,EAAMxR,eAAiB,GAAMwR,EAAMzR,WAAa,GAAK,EAAG,GAAK,EACrH8P,EAAU2B,EAAM5V,EAAI8uC,EACpBxtC,EAAa,GACb6Z,EAAYvF,EAAMrR,UAAY,EAAI,UAAaqR,EAAM1R,WAAa,EAAI,UAAY,UAExFlD,EAAQqc,UAAY,EACpBrc,EAAQkmB,YAAc/L,EACtBna,EAAQ0tC,QAAU,QAElB,MAAMG,EAAOj5B,EAAM3V,EACnBe,EAAQ6lB,YACR7lB,EAAQymB,IAAIxT,EAAS46B,EAAOvtC,EAAYA,EAAY,EAAa,EAAVwB,KAAKgS,IAC5D9T,EAAQomB,SAERpmB,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO7S,EAAS46B,EAAoB,EAAbvtC,GAC/BN,EAAQmmB,OAAOlT,EAAS46B,EAAOj5B,EAAM9V,OAAS,IAC9CkB,EAAQomB,SAERpmB,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO7S,EAAS46B,EAAoB,IAAbvtC,GAC/BN,EAAQmmB,OAAOlT,EAAU,GAAI46B,EAAoB,EAAbvtC,GACpCN,EAAQ8lB,OAAO7S,EAAS46B,EAAoB,IAAbvtC,GAC/BN,EAAQmmB,OAAOlT,EAAU,GAAI46B,EAAoB,EAAbvtC,GACpCN,EAAQomB,SAERpmB,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO7S,EAAS2B,EAAM3V,EAAI2V,EAAM9V,OAAS,IACjDkB,EAAQmmB,OAAOlT,EAAU,GAAI2B,EAAM3V,EAAI2V,EAAM9V,QAC7CkB,EAAQ8lB,OAAO7S,EAAS2B,EAAM3V,EAAI2V,EAAM9V,OAAS,IACjDkB,EAAQmmB,OAAOlT,EAAU,GAAI2B,EAAM3V,EAAI2V,EAAM9V,QAC7CkB,EAAQomB,SAER,MAAM2C,EAAW,IACXolB,EAAY,EACZH,EAAO/6B,EAAU8V,EAAW,EAC5BklB,EAAOJ,EAAO,GACpB7tC,EAAQ4lB,UAAY,UACpB5lB,EAAQumB,SAASynB,EAAMC,EAAMllB,EAAUolB,GACvC,MAAMtvB,EAAQjK,EAAMlS,OAASkS,EAAMjS,UACnC3C,EAAQ4lB,UAAY,UACpB5lB,EAAQumB,SAASynB,EAAMC,EAAMllB,EAAW,GAAMlK,EAAO,EAAG,GAAIsvB,GAC5DnuC,EAAQkmB,YAAc,UACtBlmB,EAAQwmB,WAAWwnB,EAAMC,EAAMllB,EAAUolB,EAC3C,CACF,CSrXEC,G5BmGF,WACE,IAAKl3B,GAAY7b,OACf,OAEF2E,EAAQwlB,OACR,MAAMyD,EAAQ,GAAM/R,GAAYhU,WAAa,EAAI,IAAO,IAAOgU,GAAYtX,SAAWkC,KAAK7E,IAAI,EAAGia,GAAYC,aAAe,IAAM,IAAM,IACzInX,EAAQkmB,YAAchP,GAAY7a,MAClC2D,EAAQqc,UAAY,EACpBrc,EAAQylB,YAAcwD,EACtBjpB,EAAQ6lB,YACR,MAAMhO,EAASR,KACfrX,EAAQymB,IAAI5O,EAAO7Y,EAAG6Y,EAAO5Y,EAAGiY,GAAYvb,OAAQ,EAAa,EAAVmG,KAAKgS,IAC5D9T,EAAQomB,SACRpmB,EAAQylB,YAAsB,GAARwD,EACtBjpB,EAAQ4lB,UAAY1O,GAAY7a,MAChC2D,EAAQ6lB,YACR7lB,EAAQymB,IAAI5O,EAAO7Y,EAAG6Y,EAAO5Y,EAAwB,GAArBiY,GAAYvb,OAAc,EAAa,EAAVmG,KAAKgS,IAClE9T,EAAQimB,OACRjmB,EAAQ0mB,SACV,CC3GE2nB,GHqFF,WACE,GAAuB,IAAnB34B,GAAQxjB,OAAZ,CAGA8N,EAAQwlB,OACR,IAAK,MAAM5P,KAAUF,GAAS,CAC5B,MAAM44B,EAAY,GACZp2B,EAA6B,GAAhBtC,EAAO9W,OACpByvC,EAAiB,GAAM34B,EAAOjX,UAAYiX,EAAOwB,aAAe,GAAI,EAAG,GAC7EpX,EAAQ4lB,UAAYhQ,EAAO1W,UAC3Bc,EAAQumB,SAAS3Q,EAAO5W,EAAgB,GAAZsvC,EAAiB14B,EAAO3W,EAAI2W,EAAO9W,OAASoZ,EAAYo2B,EAAWp2B,GAE/F,MAAMs2B,EAA6B,GAAhB54B,EAAO9W,OAC1BkB,EAAQ4lB,UAAYhQ,EAAOzW,UAC3Ba,EAAQumB,SAAS3Q,EAAO5W,EAAgB,GAAZsvC,EAAiB14B,EAAO3W,EAAe,GAAZqvC,EAAiBE,GAExExuC,EAAQ4lB,UAAY,UACpB5lB,EAAQumB,SAAS3Q,EAAO5W,EAAgB,GAAZsvC,EAAiB14B,EAAO3W,EAAI,EAAe,GAAZqvC,EAAkBC,EAAgB,EAC/F,CACAvuC,EAAQ0mB,SAhBR,CAiBF,CGxGE+nB,GF0DF,WACE,IAAK73B,GAAavb,OAChB,OAEF2E,EAAQwlB,OACRxlB,EAAQkmB,YAActP,GAAava,MACnC2D,EAAQqc,UAAY,EACpBrc,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO7hB,EAASjF,EAAGiF,EAAShF,GACpC,MAAM4f,EAAQjI,GAAaC,cAAgBD,GAAavX,WAAa,GAC/DqvC,EAAWzqC,EAASjF,GAAK4X,GAAaE,QAAU7S,EAASjF,GAAK6f,EAC9D8vB,EAAW1qC,EAAShF,GAAK2X,GAAaG,QAAU9S,EAAShF,GAAK4f,EACpE7e,EAAQmmB,OAAOuoB,EAAUC,GACzB3uC,EAAQomB,SACRpmB,EAAQ0mB,SACV,CExEEkoB,GLuBF,WACE5uC,EAAQwlB,OACR,IAAK,MAAMwhB,KAASnyB,GAAU,CAC5B,MAAMoU,EAAQ,GAAM+d,EAAM1xB,KAAO0xB,EAAMzxB,QAAS,EAAG,GACnDvV,EAAQylB,YAAsB,IAARwD,EACtBjpB,EAAQ4lB,UAAYohB,EAAM3qC,MAC1B2D,EAAQ6lB,YACR7lB,EAAQymB,IAAIugB,EAAMhoC,EAAGgoC,EAAM/nC,EAAG+nC,EAAMrrC,OAAQ,EAAa,EAAVmG,KAAKgS,IACpD9T,EAAQimB,MACV,CACAjmB,EAAQ0mB,SACV,CgC7CEmoB,GToLF,WACE,GAAI5qC,EAASvB,QAAU,GAAKuB,EAASE,UACnC,OAGF,MAAMzC,EAAOuC,EAASQ,aAAe,EAAMpE,SACrCk3B,EAAStzB,EAASW,eAClB,WAAEtE,EAAU,WAAEC,EAAU,UAAEC,EAAS,UAAEC,EAAS,iBAAEC,EAAgB,kBAAEC,EAAiB,kBAAEC,GAAsBc,EAC3G6S,EAAUC,KAGVs6B,EADahtC,KAAKQ,IAAI,EAAGR,KAAKmmB,IAAIhkB,EAAS1G,IAAM4C,GACnBO,EAEpC,IAAIquC,EAAQjtC,KAAK4a,IAAc,EAAVnI,GAAe5T,EAAoBmuC,EACxD,GAAI7qC,EAASS,WAAa6yB,EAAQ,CAChC,MAAMyX,EAAgBzX,EAAOn8B,OAASm8B,EAAOl8B,OAASk8B,EAAOj8B,SACvD2rB,EAAW,GAAMhjB,EAASY,cAAgBmqC,EAAe,EAAG,GAClED,GAAwC,GAA/BjtC,KAAK4a,IAAIuK,EAAWnlB,KAAKgS,IAAW7P,EAAShC,MACxD,CAEAjC,EAAQqc,UAAY,EACpBrc,EAAQkmB,YAAc,UACtBlmB,EAAQ0tC,QAAU,QAElB,MAAM7B,EAAc5nC,EAAShF,EAAIqB,EACjCN,EAAQ6lB,YACR7lB,EAAQymB,IAAIxiB,EAASjF,EAAG6sC,EAAavrC,EAAY,EAAa,EAAVwB,KAAKgS,IACzD9T,EAAQomB,SAER,MAAM0lB,EAAQ7nC,EAAShF,EAAiB,EAAbqB,EACrByrC,EAAeD,EAAQvrC,EAC7BP,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO7hB,EAASjF,EAAG8sC,GAC3B9rC,EAAQmmB,OAAOliB,EAASjF,EAAG+sC,GAC3B/rC,EAAQomB,SAERpmB,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO7hB,EAASjF,EAAG8sC,EAAQ,GACnC9rC,EAAQmmB,OAAOliB,EAASjF,EAAIyB,EAAWqrC,EAAQrrC,EAAYsuC,GAC3D/uC,EAAQ8lB,OAAO7hB,EAASjF,EAAG8sC,EAAQ,GACnC9rC,EAAQmmB,OAAOliB,EAASjF,EAAIyB,EAAWqrC,EAAQrrC,EAAYsuC,GAC3D/uC,EAAQomB,SAER,MAAM6oB,EAAcntC,KAAKgS,GAAK,EACxBo7B,EAAeptC,KAAK4a,IAAc,EAAVnI,EAAc06B,GAAeruC,EAAoBkuC,EACzE9C,EAAWlqC,KAAK7E,IAAgB,GAAZwD,EAAiB,IACrCwrC,EAAYnqC,KAAKQ,IAAIpC,EAAU6rC,EAAevrC,EAAY0uC,GAC1DhD,EAAapqC,KAAKQ,IAAIpC,EAAU6rC,EAAevrC,EAAY0uC,GAEjElvC,EAAQ6lB,YACR7lB,EAAQ8lB,OAAO7hB,EAASjF,EAAG+sC,GAC3B/rC,EAAQmmB,OAAOliB,EAASjF,EAAIgtC,EAAUC,GACtCjsC,EAAQ8lB,OAAO7hB,EAASjF,EAAG+sC,GAC3B/rC,EAAQmmB,OAAOliB,EAASjF,EAAIgtC,EAAUE,GACtClsC,EAAQomB,SAEJniB,EAASnD,UACXd,EAAQkmB,YAAc,UACtBlmB,EAAQ6lB,YACR7lB,EAAQymB,IAAIxiB,EAASjF,EAAG+sC,EAA2B,GAAZvrC,EAAiBF,EAAa,EAAG,EAAa,EAAVwB,KAAKgS,IAChF9T,EAAQomB,SACRpmB,EAAQkmB,YAAc,UAE1B,CSlPEipB,GToPF,WACE,IAAK,MAAM3uB,KAAUvc,EAASkB,eAAgB,CAC5C,MAAM8jB,EAAQ,GAAMzI,EAAOiX,UAAYjX,EAAO7hB,SAAU,EAAG,GAC3DqB,EAAQ4lB,UAAY,uBAAuB,GAAMqD,KACjDjpB,EAAQ6lB,YACR7lB,EAAQymB,IAAIjG,EAAOxhB,EAAGwhB,EAAOvhB,EAAGuhB,EAAO7kB,OAAQ,EAAa,EAAVmG,KAAKgS,IACvD9T,EAAQimB,OAERjmB,EAAQkmB,YAAc,uBAAuB+C,KAC7CjpB,EAAQqc,UAAY,EACpBrc,EAAQ6lB,YACR7lB,EAAQymB,IAAIjG,EAAOxhB,EAAGwhB,EAAOvhB,EAAGuhB,EAAO7kB,OAAQ,EAAa,EAAVmG,KAAKgS,IACvD9T,EAAQomB,QACV,CACF,CSjQEgpB,GACApZ,K/BPF,WACEh2B,EAAQwlB,OACRxlB,EAAQ2yB,KAAO,qCACf3yB,EAAQ4yB,UAAY,SACpB,IAAK,MAAM6T,KAASjxB,GAAc,CAChC,MAAM65B,EAAU,GAAM5I,EAAMnxB,KAAOmxB,EAAMlxB,QAAS,EAAG,GACrDvV,EAAQ4lB,UAAY,uBAAuBypB,KAC3CrvC,EAAQ6yB,SAAS,IAAI/wB,KAAKgY,MAAM2sB,EAAM73B,SAAU63B,EAAMznC,EAAGynC,EAAMxnC,EACjE,CACAe,EAAQ0mB,SACV,C+BFE4oB,GACAjd,KAEAx7B,OAAOozC,sBAAsBC,EAC/B,E","sources":["webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/styleTagTransform.js","webpack://project-stickfigure/./node_modules/css-loader/dist/runtime/api.js","webpack://project-stickfigure/./node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://project-stickfigure/./src/styles.css","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/insertStyleElement.js","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/insertBySelector.js","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/styleDomAPI.js","webpack://project-stickfigure/webpack/bootstrap","webpack://project-stickfigure/webpack/runtime/compat get default export","webpack://project-stickfigure/webpack/runtime/define property getters","webpack://project-stickfigure/webpack/runtime/hasOwnProperty shorthand","webpack://project-stickfigure/webpack/runtime/nonce","webpack://project-stickfigure/./src/styles.css?44b2","webpack://project-stickfigure/./src/core/input/index.js","webpack://project-stickfigure/./src/config/weapons.js","webpack://project-stickfigure/./src/environment/canvas.js","webpack://project-stickfigure/./src/config/constants.js","webpack://project-stickfigure/./src/config/squad.js","webpack://project-stickfigure/./src/state/entities.js","webpack://project-stickfigure/./src/state/weapons.js","webpack://project-stickfigure/./src/state/ammo.js","webpack://project-stickfigure/./src/core/combat/weapons.js","webpack://project-stickfigure/./src/core/audio/placeholder.js","webpack://project-stickfigure/./src/core/network/p2p.js","webpack://project-stickfigure/./src/config/network.js","webpack://project-stickfigure/./src/state/serverBrowser.js","webpack://project-stickfigure/./src/state/vehicles.js","webpack://project-stickfigure/./src/core/utils/math.js","webpack://project-stickfigure/./src/core/utils/time.js","webpack://project-stickfigure/./src/core/effects/ragdoll.js","webpack://project-stickfigure/./src/core/effects/damage.js","webpack://project-stickfigure/./src/core/gadgets/turret.js","webpack://project-stickfigure/./src/core/gadgets/grapple.js","webpack://project-stickfigure/./src/core/gadgets/shield.js","webpack://project-stickfigure/./src/core/gadgets/index.js","webpack://project-stickfigure/./src/core/combat/damageHandlers.js","webpack://project-stickfigure/./src/config/destructibles.js","webpack://project-stickfigure/./src/state/destructibles.js","webpack://project-stickfigure/./src/core/effects/particles.js","webpack://project-stickfigure/./src/core/combat/explosions.js","webpack://project-stickfigure/./src/core/world/destructibles.js","webpack://project-stickfigure/./src/core/combat/projectiles.js","webpack://project-stickfigure/./src/core/combat/throwables.js","webpack://project-stickfigure/./src/config/supplyDrops.js","webpack://project-stickfigure/./src/core/world/supplyDrops.js","webpack://project-stickfigure/./src/core/render/supplyDrops.js","webpack://project-stickfigure/./src/core/render/destructibles.js","webpack://project-stickfigure/./src/core/events/polishDebug.js","webpack://project-stickfigure/./src/state/recoil.js","webpack://project-stickfigure/./src/core/world/arena.js","webpack://project-stickfigure/./src/core/squad/index.js","webpack://project-stickfigure/./src/core/vehicles/index.js","webpack://project-stickfigure/./src/core/render/index.js","webpack://project-stickfigure/./src/core/combat/playerActions.js","webpack://project-stickfigure/./src/core/combat/melee.js","webpack://project-stickfigure/./src/core/world/enemyAI.js","webpack://project-stickfigure/./src/config/spawn.js","webpack://project-stickfigure/./src/core/world/enemySpawner.js","webpack://project-stickfigure/./src/core/network/serverBrowser.js","webpack://project-stickfigure/./src/core/world/update.js","webpack://project-stickfigure/./src/core/world/trainingDummy.js","webpack://project-stickfigure/./src/main.js"],"sourcesContent":["\"use strict\";\n\n/* istanbul ignore next  */\nfunction setAttributesWithoutAttributes(styleElement) {\n  var nonce = typeof __webpack_nonce__ !== \"undefined\" ? __webpack_nonce__ : null;\n  if (nonce) {\n    styleElement.setAttribute(\"nonce\", nonce);\n  }\n}\nmodule.exports = setAttributesWithoutAttributes;","\"use strict\";\n\nvar stylesInDOM = [];\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n  for (var i = 0; i < stylesInDOM.length; i++) {\n    if (stylesInDOM[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n}\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var indexByIdentifier = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3],\n      supports: item[4],\n      layer: item[5]\n    };\n    if (indexByIdentifier !== -1) {\n      stylesInDOM[indexByIdentifier].references++;\n      stylesInDOM[indexByIdentifier].updater(obj);\n    } else {\n      var updater = addElementStyle(obj, options);\n      options.byIndex = i;\n      stylesInDOM.splice(i, 0, {\n        identifier: identifier,\n        updater: updater,\n        references: 1\n      });\n    }\n    identifiers.push(identifier);\n  }\n  return identifiers;\n}\nfunction addElementStyle(obj, options) {\n  var api = options.domAPI(options);\n  api.update(obj);\n  var updater = function updater(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap && newObj.supports === obj.supports && newObj.layer === obj.layer) {\n        return;\n      }\n      api.update(obj = newObj);\n    } else {\n      api.remove();\n    }\n  };\n  return updater;\n}\nmodule.exports = function (list, options) {\n  options = options || {};\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDOM[index].references--;\n    }\n    var newLastIdentifiers = modulesToDom(newList, options);\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n      var _index = getIndexByIdentifier(_identifier);\n      if (stylesInDOM[_index].references === 0) {\n        stylesInDOM[_index].updater();\n        stylesInDOM.splice(_index, 1);\n      }\n    }\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","\"use strict\";\n\n/* istanbul ignore next  */\nfunction styleTagTransform(css, styleElement) {\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css;\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild);\n    }\n    styleElement.appendChild(document.createTextNode(css));\n  }\n}\nmodule.exports = styleTagTransform;","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `* {\r\n  box-sizing: border-box;\r\n}\r\n\r\nbody {\r\n  margin: 0;\r\n  background-color: #0f1115;\r\n  color: #f0f3f7;\r\n  font-family: \"Segoe UI\", Arial, sans-serif;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  min-height: 100vh;\r\n}\r\n\r\ncanvas {\r\n  border: 2px solid #2a2d34;\r\n  background: linear-gradient(180deg, #1d2129 0%, #14161c 100%);\r\n  width: min(90vw, 960px);\r\n  max-width: 100%;\r\n  height: auto;\r\n}\r\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/styles.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,sBAAsB;AACxB;;AAEA;EACE,SAAS;EACT,yBAAyB;EACzB,cAAc;EACd,0CAA0C;EAC1C,aAAa;EACb,mBAAmB;EACnB,uBAAuB;EACvB,iBAAiB;AACnB;;AAEA;EACE,yBAAyB;EACzB,6DAA6D;EAC7D,uBAAuB;EACvB,eAAe;EACf,YAAY;AACd\",\"sourcesContent\":[\"* {\\r\\n  box-sizing: border-box;\\r\\n}\\r\\n\\r\\nbody {\\r\\n  margin: 0;\\r\\n  background-color: #0f1115;\\r\\n  color: #f0f3f7;\\r\\n  font-family: \\\"Segoe UI\\\", Arial, sans-serif;\\r\\n  display: flex;\\r\\n  align-items: center;\\r\\n  justify-content: center;\\r\\n  min-height: 100vh;\\r\\n}\\r\\n\\r\\ncanvas {\\r\\n  border: 2px solid #2a2d34;\\r\\n  background: linear-gradient(180deg, #1d2129 0%, #14161c 100%);\\r\\n  width: min(90vw, 960px);\\r\\n  max-width: 100%;\\r\\n  height: auto;\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/* istanbul ignore next  */\nfunction insertStyleElement(options) {\n  var element = document.createElement(\"style\");\n  options.setAttributes(element, options.attributes);\n  options.insert(element, options.options);\n  return element;\n}\nmodule.exports = insertStyleElement;","\"use strict\";\n\nvar memo = {};\n\n/* istanbul ignore next  */\nfunction getTarget(target) {\n  if (typeof memo[target] === \"undefined\") {\n    var styleTarget = document.querySelector(target);\n\n    // Special case to return head of iframe instead of iframe itself\n    if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n      try {\n        // This will throw an exception if access to iframe is blocked\n        // due to cross-origin restrictions\n        styleTarget = styleTarget.contentDocument.head;\n      } catch (e) {\n        // istanbul ignore next\n        styleTarget = null;\n      }\n    }\n    memo[target] = styleTarget;\n  }\n  return memo[target];\n}\n\n/* istanbul ignore next  */\nfunction insertBySelector(insert, style) {\n  var target = getTarget(insert);\n  if (!target) {\n    throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n  }\n  target.appendChild(style);\n}\nmodule.exports = insertBySelector;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction apply(styleElement, options, obj) {\n  var css = \"\";\n  if (obj.supports) {\n    css += \"@supports (\".concat(obj.supports, \") {\");\n  }\n  if (obj.media) {\n    css += \"@media \".concat(obj.media, \" {\");\n  }\n  var needLayer = typeof obj.layer !== \"undefined\";\n  if (needLayer) {\n    css += \"@layer\".concat(obj.layer.length > 0 ? \" \".concat(obj.layer) : \"\", \" {\");\n  }\n  css += obj.css;\n  if (needLayer) {\n    css += \"}\";\n  }\n  if (obj.media) {\n    css += \"}\";\n  }\n  if (obj.supports) {\n    css += \"}\";\n  }\n  var sourceMap = obj.sourceMap;\n  if (sourceMap && typeof btoa !== \"undefined\") {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  }\n\n  // For old IE\n  /* istanbul ignore if  */\n  options.styleTagTransform(css, styleElement, options.options);\n}\nfunction removeStyleElement(styleElement) {\n  // istanbul ignore if\n  if (styleElement.parentNode === null) {\n    return false;\n  }\n  styleElement.parentNode.removeChild(styleElement);\n}\n\n/* istanbul ignore next  */\nfunction domAPI(options) {\n  if (typeof document === \"undefined\") {\n    return {\n      update: function update() {},\n      remove: function remove() {}\n    };\n  }\n  var styleElement = options.insertStyleElement(options);\n  return {\n    update: function update(obj) {\n      apply(styleElement, options, obj);\n    },\n    remove: function remove() {\n      removeStyleElement(styleElement);\n    }\n  };\n}\nmodule.exports = domAPI;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","__webpack_require__.nc = undefined;","\n      import API from \"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../node_modules/css-loader/dist/cjs.js!./styles.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../node_modules/css-loader/dist/cjs.js!./styles.css\";\n       export default content && content.locals ? content.locals : undefined;\n","const input = Object.seal({\r\n  left: false,\r\n  right: false,\r\n  jump: false,\r\n  down: false,\r\n  roll: false,\r\n  attackBuffered: false,\r\n  throwBuffered: false,\r\n  reloadBuffered: false,\r\n  interactBuffered: false,\r\n  attackDown: false,\r\n  throwDown: false,\r\n  squadCommandCycleBuffered: false,\r\n  squadCommandSelect: null,\r\n  serverBrowserToggleBuffered: false,\r\n  serverBrowserNavigate: 0,\r\n  serverBrowserJoinBuffered: false,\r\n  serverBrowserHostBuffered: false,\r\n  serverBrowserStopHostBuffered: false,\r\n  serverBrowserCopyOfferBuffered: false,\r\n  serverBrowserPasteOfferBuffered: false,\r\n  serverBrowserAcceptAnswerBuffered: false,\n  serverBrowserCopyCandidatesBuffered: false,\n  serverBrowserPasteCandidatesBuffered: false\r\n});\r\n\r\nlet initialized = false;\r\n\r\nfunction handleKey(isDown, event) {\r\n  switch (event.code) {\r\n    case \"ArrowLeft\":\r\n    case \"KeyA\":\r\n      input.left = isDown;\r\n      event.preventDefault();\r\n      break;\r\n    case \"ArrowRight\":\r\n    case \"KeyD\":\r\n      input.right = isDown;\r\n      event.preventDefault();\r\n      break;\r\n    case \"ArrowUp\":\r\n    case \"KeyW\":\r\n    case \"Space\":\r\n      input.jump = isDown;\r\n      event.preventDefault();\r\n      break;\r\n    case \"ArrowDown\":\r\n    case \"KeyS\":\r\n      input.down = isDown;\r\n      event.preventDefault();\r\n      break;\r\n    case \"ShiftLeft\":\r\n    case \"ShiftRight\":\r\n      if (isDown) {\r\n        input.roll = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyJ\":\r\n    case \"KeyF\":\r\n      if (isDown) {\r\n        input.attackBuffered = true;\r\n        input.attackDown = true;\r\n        event.preventDefault();\r\n      } else {\r\n        input.attackDown = false;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyG\":\r\n      if (isDown) {\r\n        input.throwBuffered = true;\r\n        input.throwDown = true;\r\n        event.preventDefault();\r\n      } else {\r\n        input.throwDown = false;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyR\":\r\n      if (isDown) {\r\n        input.reloadBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyE\":\r\n      if (isDown) {\r\n        input.interactBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyT\":\r\n      if (isDown) {\r\n        input.squadCommandCycleBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyZ\":\r\n      if (isDown) {\r\n        input.squadCommandSelect = \"hold\";\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyX\":\r\n      if (isDown) {\r\n        input.squadCommandSelect = \"defend\";\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyC\":\r\n      if (isDown) {\r\n        input.squadCommandSelect = \"attack\";\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyV\":\r\n      if (isDown) {\r\n        input.squadCommandSelect = \"flank\";\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyL\":\r\n      if (isDown) {\r\n        input.serverBrowserToggleBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"BracketLeft\":\r\n      if (isDown) {\r\n        input.serverBrowserNavigate = -1;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"BracketRight\":\n      if (isDown) {\n        input.serverBrowserNavigate = 1;\n        event.preventDefault();\n      }\n      break;\n    case \"Slash\":\n      if (isDown) {\n        input.serverBrowserNavigate = 1;\n        event.preventDefault();\n      }\n      break;\r\n    case \"Enter\":\r\n      if (isDown) {\r\n        input.serverBrowserJoinBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyH\":\r\n      if (isDown) {\r\n        input.serverBrowserHostBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyU\":\n      if (isDown) {\n        input.serverBrowserStopHostBuffered = true;\n        event.preventDefault();\n      }\n      break;\n    case \"KeyO\":\n      if (isDown) {\n        input.serverBrowserCopyOfferBuffered = true;\n        event.preventDefault();\n      }\n      break;\n    case \"KeyP\":\n      if (isDown) {\n        input.serverBrowserPasteOfferBuffered = true;\n        event.preventDefault();\n      }\n      break;\n    case \"KeyI\":\n      if (isDown) {\n        input.serverBrowserAcceptAnswerBuffered = true;\n        event.preventDefault();\n      }\n      break;\n    case \"KeyM\":\n      if (isDown) {\n        input.serverBrowserCopyCandidatesBuffered = true;\n        event.preventDefault();\n      }\n      break;\n    case \"KeyN\":\n      if (isDown) {\n        input.serverBrowserPasteCandidatesBuffered = true;\n        event.preventDefault();\n      }\n      break;\n    default:\r\n      break;\r\n  }\r\n}\r\n\r\nfunction handleMouseDown(event) {\r\n  if (event.button === 0) {\r\n    input.attackBuffered = true;\r\n    input.attackDown = true;\r\n    event.preventDefault();\r\n  } else if (event.button === 2) {\r\n    input.throwBuffered = true;\r\n    input.throwDown = true;\r\n    event.preventDefault();\r\n  }\r\n}\r\n\r\nfunction handleMouseUp(event) {\r\n  if (event.button === 0) {\r\n    input.attackDown = false;\r\n    event.preventDefault();\r\n  } else if (event.button === 2) {\r\n    input.throwDown = false;\r\n    event.preventDefault();\r\n  }\r\n}\r\n\r\nfunction resetInputs() {\r\n  input.left = false;\r\n  input.right = false;\r\n  input.jump = false;\r\n  input.down = false;\r\n  input.roll = false;\r\n  input.attackBuffered = false;\r\n  input.throwBuffered = false;\r\n  input.reloadBuffered = false;\r\n  input.interactBuffered = false;\r\n  input.attackDown = false;\r\n  input.throwDown = false;\r\n  input.squadCommandCycleBuffered = false;\r\n  input.squadCommandSelect = null;\r\n  input.serverBrowserToggleBuffered = false;\r\n  input.serverBrowserNavigate = 0;\r\n  input.serverBrowserJoinBuffered = false;\r\n  input.serverBrowserHostBuffered = false;\r\n  input.serverBrowserStopHostBuffered = false;\r\n  input.serverBrowserCopyOfferBuffered = false;\r\n  input.serverBrowserPasteOfferBuffered = false;\r\n  input.serverBrowserAcceptAnswerBuffered = false;\n  input.serverBrowserCopyCandidatesBuffered = false;\n  input.serverBrowserPasteCandidatesBuffered = false;\n}\r\n\r\nfunction initializeInput() {\r\n  if (initialized) {\r\n    return;\r\n  }\r\n  window.addEventListener(\"keydown\", (event) => handleKey(true, event));\r\n  window.addEventListener(\"keyup\", (event) => handleKey(false, event));\r\n  window.addEventListener(\"mousedown\", handleMouseDown);\r\n  window.addEventListener(\"mouseup\", handleMouseUp);\r\n  window.addEventListener(\"contextmenu\", (event) => event.preventDefault());\r\n  window.addEventListener(\"blur\", resetInputs);\r\n  initialized = true;\r\n}\r\n\r\nexport { input, initializeInput, resetInputs };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","const WEAPON_DEFINITIONS = {\r\n  combatFists: {\r\n    id: \"combatFists\",\r\n    name: \"Combat Fists\",\r\n    description: \"Baseline martial arts combo with balanced speed and control.\",\r\n    category: \"melee-short\",\r\n    attackChain: [\r\n      {\r\n        name: \"Quick Jab\",\r\n        windup: 0.06,\r\n        active: 0.12,\r\n        recovery: 0.14,\r\n        comboStart: 0.12,\r\n        comboWindow: 0.18,\r\n        range: 74,\r\n        heightOffset: -46,\r\n        radius: 26,\r\n        damage: 8,\r\n        knockback: 140,\r\n        launch: 0\r\n      },\r\n      {\r\n        name: \"Cross Strike\",\r\n        windup: 0.08,\r\n        active: 0.12,\r\n        recovery: 0.18,\r\n        comboStart: 0.18,\r\n        comboWindow: 0.2,\r\n        range: 82,\r\n        heightOffset: -40,\r\n        radius: 28,\r\n        damage: 12,\r\n        knockback: 180,\r\n        launch: 0\r\n      },\r\n      {\r\n        name: \"Rising Kick\",\r\n        windup: 0.1,\r\n        active: 0.14,\r\n        recovery: 0.24,\r\n        comboStart: 0.24,\r\n        comboWindow: 0.2,\r\n        range: 68,\r\n        heightOffset: -64,\r\n        radius: 30,\r\n        damage: 16,\r\n        knockback: 220,\r\n        launch: 160\r\n      }\r\n    ]\r\n  },\r\n  shockBaton: {\r\n    id: \"shockBaton\",\r\n    name: \"Shock Baton\",\r\n    description: \"Electrified staff built for crowd control and guard breaks.\",\r\n    category: \"melee-mid\",\r\n    attackChain: [\r\n      {\r\n        name: \"Jab Feint\",\r\n        windup: 0.06,\r\n        active: 0.08,\r\n        recovery: 0.14,\r\n        comboStart: 0.14,\r\n        comboWindow: 0.16,\r\n        range: 68,\r\n        heightOffset: -30,\r\n        radius: 26,\r\n        damage: 9,\r\n        knockback: 90,\r\n        launch: 0\r\n      },\r\n      {\r\n        name: \"Slide Sweep\",\r\n        windup: 0.1,\r\n        active: 0.12,\r\n        recovery: 0.2,\r\n        comboStart: 0.2,\r\n        comboWindow: 0.18,\r\n        range: 86,\r\n        heightOffset: -12,\r\n        radius: 34,\r\n        damage: 16,\r\n        knockback: 180,\r\n        launch: 30\r\n      },\r\n      {\r\n        name: \"Arc Burst\",\r\n        windup: 0.16,\r\n        active: 0.2,\r\n        recovery: 0.32,\r\n        comboStart: 0.32,\r\n        comboWindow: 0.2,\r\n        range: 94,\r\n        heightOffset: -28,\r\n        radius: 42,\r\n        damage: 26,\r\n        knockback: 280,\r\n        launch: 160\r\n      }\r\n    ]\r\n  },\r\n  strikerPistol: {\r\n    id: \"strikerPistol\",\r\n    name: \"Striker Pistol\",\r\n    description: \"Semi-auto sidearm. Tap fire for consistent ranged pressure.\",\r\n    category: \"ranged-short\",\r\n    attackChain: [],\r\n    projectile: {\r\n      radius: 6,\r\n      speed: 520,\r\n      damage: 14,\r\n      knockback: 90,\r\n      lifetime: 0.9,\r\n      gravityFactor: 0.25,\r\n      color: \"#ffca7a\"\r\n    },\r\n    ammo: {\r\n      magazine: 12,\r\n      reserve: 48,\r\n      reloadSeconds: 1.3\r\n    }\r\n  },\r\n  vectorSmg: {\r\n    id: \"vectorSmg\",\r\n    name: \"Vector SMG\",\r\n    description: \"Rapid PDW prototype tuned for controllable spray.\",\r\n    category: \"ranged-mid\",\r\n    attackChain: [],\r\n    projectile: {\r\n      radius: 5,\r\n      speed: 620,\r\n      damage: 10,\r\n      knockback: 70,\r\n      lifetime: 0.85,\r\n      gravityFactor: 0.18,\r\n      color: \"#98d8ff\"\r\n    },\r\n    ammo: {\r\n      magazine: 32,\r\n      reserve: 160,\r\n      reloadSeconds: 2.1\r\n    },\r\n    recoil: {\r\n      horizontal: 0.6,\r\n      vertical: 1.4,\r\n      decay: 10\r\n    },\r\n    spread: {\r\n      base: 1.5,\r\n      perShot: 0.6,\r\n      max: 6.5,\r\n      recovery: 3.2\r\n    }\r\n  },\r\n  fragGrenade: {\r\n    id: \"fragGrenade\",\r\n    name: \"Frag Grenade\",\r\n    description: \"Timed explosive. Toss, bounce, and detonate in a wide area.\",\r\n    category: \"throwable\",\r\n    attackChain: [],\r\n    throwable: {\r\n      fuseSeconds: 1.6,\r\n      explosionRadius: 120,\r\n      damage: 45,\r\n      knockback: 260,\r\n      arcVelocity: { vx: 280, vy: -420 },\r\n      gravityFactor: 0.5,\r\n      bounciness: 0.45,\r\n      color: \"#ffb347\",\r\n      radius: 16,\r\n      cooldownSeconds: 1.05,\r\n      explosionDuration: 0.32,\r\n      selfDamageScale: 0.55,\r\n      selfKnockbackScale: 0.5,\r\n      effectType: \"explosive\"\r\n    }\r\n  },\r\n  flashBang: {\r\n    id: \"flashBang\",\r\n    name: \"Flashbang\",\r\n    description: \"Blinding charge that staggers enemies caught in the burst.\",\r\n    category: \"throwable\",\r\n    attackChain: [],\r\n    throwable: {\r\n      fuseSeconds: 1.2,\r\n      explosionRadius: 160,\r\n      damage: 0,\r\n      knockback: 0,\r\n      arcVelocity: { vx: 260, vy: -420 },\r\n      gravityFactor: 0.45,\r\n      bounciness: 0.4,\r\n      color: \"#f9f2c7\",\r\n      radius: 14,\r\n      cooldownSeconds: 1.4,\r\n      explosionDuration: 0.24,\r\n      effectType: \"flash\",\r\n      stunDuration: 1.8,\r\n      playerStunDuration: 0.9\r\n    }\r\n  },\r\n  smokeCanister: {\r\n    id: \"smokeCanister\",\r\n    name: \"Smoke Canister\",\r\n    description: \"Rapid-deploy screen that slows foes and softens line of sight.\",\r\n    category: \"throwable\",\r\n    attackChain: [],\r\n    throwable: {\r\n      fuseSeconds: 0.9,\r\n      explosionRadius: 80,\r\n      damage: 0,\r\n      knockback: 0,\r\n      arcVelocity: { vx: 220, vy: -360 },\r\n      gravityFactor: 0.52,\r\n      bounciness: 0.35,\r\n      color: \"#aeb9c6\",\r\n      radius: 18,\r\n      cooldownSeconds: 2.3,\r\n      explosionDuration: 0.2,\r\n      effectType: \"smoke\",\r\n      smokeDuration: 4.6,\r\n      smokeRadius: 150,\r\n      smokeExpansion: 1.35,\r\n      smokeSlowMultiplier: 0.55,\r\n      smokeTickDuration: 0.45\r\n    }\r\n  },\r\n  turretDrone: {\r\n    id: \"turretDrone\",\r\n    name: \"Deployable Turret\",\r\n    description: \"Drops an auto-targeting sentry that covers a lane with suppressive fire.\",\r\n    category: \"gadget\",\r\n    attackChain: [],\r\n    gadget: {\r\n      type: \"turret\",\r\n      cooldownSeconds: 3.2,\r\n      duration: 8.5,\r\n      range: 260,\r\n      fireInterval: 0.55,\r\n      maxActive: 2,\r\n      height: 54,\r\n      spawnOffset: { x: 70, y: 0 },\r\n      baseColor: \"#6f7bff\",\r\n      headColor: \"#d6dcff\",\r\n      projectile: {\r\n        speed: 540,\r\n        radius: 4,\r\n        damage: 9,\r\n        knockback: 80,\r\n        lifetime: 1.1,\r\n        color: \"#9ae9ff\"\r\n      }\r\n    }\r\n  },\r\n  grappleRig: {\r\n    id: \"grappleRig\",\r\n    name: \"Grapple Rig\",\r\n    description: \"Launch, latch, and zip to an overhead anchor for quick repositioning.\",\r\n    category: \"gadget\",\r\n    attackChain: [],\r\n    gadget: {\r\n      type: \"grapple\",\r\n      cooldownSeconds: 1.8,\r\n      duration: 0.6,\r\n      maxLength: 320,\r\n      maxRise: 260,\r\n      travelSpeed: 900,\r\n      pullSpeed: 760,\r\n      color: \"#8cf1ff\",\r\n    }\r\n  },\r\n  thunderCannon: {\r\n    id: \"thunderCannon\",\r\n    name: \"Thunder Cannon\",\r\n    description: \"Supply drop-exclusive launcher that fires high-impact bolts.\",\r\n    category: \"ranged-heavy\",\r\n    attackChain: [],\r\n    projectile: {\r\n      radius: 10,\r\n      speed: 620,\r\n      damage: 42,\r\n      knockback: 260,\r\n      lifetime: 1.2,\r\n      gravityFactor: 0.18,\r\n      color: \"#ffd76a\"\r\n    },\r\n    ammo: {\r\n      magazine: 4,\r\n      reserve: 12,\r\n      reloadSeconds: 2.9\r\n    },\r\n    recoil: {\r\n      horizontal: 2.2,\r\n      vertical: 5.4,\r\n      recovery: 6.5\r\n    },\r\n    spread: {\r\n      base: 1.5,\r\n      max: 6,\r\n      increase: 1.1,\r\n      recovery: 3.5\r\n    }\r\n  },\r\n  shieldBubble: {\r\n    id: \"shieldBubble\",\r\n    name: \"Shield Bubble\",\r\n    description: \"Pop a temporary energy shell that soaks damage and keeps you grounded.\",\r\n    category: \"gadget\",\r\n    attackChain: [],\r\n    gadget: {\r\n      type: \"shield\",\r\n      cooldownSeconds: 4.5,\r\n      duration: 6,\r\n      strength: 90,\r\n      radius: 96,\r\n      color: \"#7cd6ff\"\r\n    }\r\n  }\r\n};\r\n\r\nconst DEFAULT_LOADOUT = [\"combatFists\", \"shockBaton\", \"strikerPistol\", \"fragGrenade\", \"flashBang\", \"smokeCanister\", \"turretDrone\", \"grappleRig\", \"shieldBubble\"];\r\n\r\nexport { WEAPON_DEFINITIONS, DEFAULT_LOADOUT };\r\n\r\n","const canvas = document.getElementById(\"game-canvas\");\nconst context = canvas.getContext(\"2d\");\n\nif (!context) {\n  throw new Error(\"Canvas 2D context not available.\");\n}\n\nconst GROUND_Y = canvas.height - 60;\n\nexport { canvas, context, GROUND_Y };\r\n","\r\nimport { GROUND_Y } from \"../environment/canvas.js\";\r\n\r\nconst SPEED = 240;\r\nconst JUMP_SPEED = 460;\r\nconst ROLL_SPEED = 420;\r\nconst ROLL_DURATION = 0.32;\r\nconst GRAVITY = 1400;\r\n\r\nconst POSES = {\r\n  standing: {\r\n    headRadius: 16,\r\n    bodyLength: 34,\r\n    legLength: 36,\r\n    armLength: 28,\r\n    strideMultiplier: 1,\r\n    armSwingAmplitude: 12,\r\n    legSwingAmplitude: 12\r\n  },\r\n  crouching: {\r\n    headRadius: 16,\r\n    bodyLength: 24,\r\n    legLength: 24,\r\n    armLength: 22,\r\n    strideMultiplier: 0.6,\r\n    armSwingAmplitude: 6,\r\n    legSwingAmplitude: 6\r\n  },\r\n  rolling: {\r\n    headRadius: 16,\r\n    bodyLength: 18,\r\n    legLength: 18,\r\n    armLength: 18,\r\n    strideMultiplier: 0,\r\n    armSwingAmplitude: 0,\r\n    legSwingAmplitude: 0\r\n  }\r\n};\r\n\r\nconst DEBUG_PLATFORMS = [\r\n  { x: -240, y: GROUND_Y - 26, width: 520, height: 26, type: \"street\" },\r\n  { x: 320, y: GROUND_Y - 26, width: 420, height: 26, type: \"street\" },\r\n  { x: 820, y: GROUND_Y - 26, width: 380, height: 26, type: \"street\" },\r\n  { x: 1220, y: GROUND_Y - 26, width: 520, height: 26, type: \"street\" },\r\n  { x: 40, y: GROUND_Y - 120, width: 260, height: 18, type: \"metro\" },\r\n  { x: 360, y: GROUND_Y - 180, width: 280, height: 16, type: \"rooftop\" },\r\n  { x: 680, y: GROUND_Y - 240, width: 220, height: 16, type: \"skybridge\" },\r\n  { x: 960, y: GROUND_Y - 180, width: 320, height: 18, type: \"rooftop\" },\r\n  { x: 1240, y: GROUND_Y - 140, width: 280, height: 16, type: \"terrace\" },\r\n  { x: 1460, y: GROUND_Y - 220, width: 200, height: 14, type: \"balcony\" },\r\n  { x: 600, y: GROUND_Y - 88, width: 260, height: 14, type: \"median\" },\r\n  { x: 980, y: GROUND_Y - 96, width: 320, height: 14, type: \"median\" }\r\n];\r\n\r\nconst LEVEL_WATER_ZONES = [\r\n  { x: 580, width: 220, top: GROUND_Y - 16, depth: 18 }\r\n];\r\n\r\nconst LEVEL_DECOR = [\r\n  { type: \"building\", x: -120, y: GROUND_Y - 360, width: 220, height: 360 },\r\n  { type: \"building\", x: 220, y: GROUND_Y - 420, width: 180, height: 420 },\r\n  { type: \"building\", x: 520, y: GROUND_Y - 360, width: 260, height: 360 },\r\n  { type: \"building\", x: 860, y: GROUND_Y - 440, width: 220, height: 440 },\r\n  { type: \"building\", x: 1120, y: GROUND_Y - 400, width: 260, height: 400 },\r\n  { type: \"building\", x: 1400, y: GROUND_Y - 360, width: 200, height: 360 },\r\n  { type: \"billboard\", x: 320, y: GROUND_Y - 210, width: 180, height: 90, text: \"Neo District\" },\r\n  { type: \"billboard\", x: 1040, y: GROUND_Y - 230, width: 200, height: 96, text: \"Rail 7\" },\r\n  { type: \"streetlight\", x: 180, y: GROUND_Y - 160 },\r\n  { type: \"streetlight\", x: 760, y: GROUND_Y - 160 },\r\n  { type: \"streetlight\", x: 1280, y: GROUND_Y - 160 },\r\n  { type: \"hovercar\", x: 560, y: GROUND_Y - 120 },\r\n  { type: \"hovercar\", x: 1180, y: GROUND_Y - 150 }\r\n];\r\n\r\nexport {\r\n  SPEED,\r\n  JUMP_SPEED,\r\n  ROLL_SPEED,\r\n  ROLL_DURATION,\r\n  GRAVITY,\r\n  POSES,\r\n  DEBUG_PLATFORMS,\r\n  LEVEL_WATER_ZONES,\r\n  LEVEL_DECOR\r\n};\r\n","const SQUAD_COMMANDS = [\n  {\n    id: \"hold\",\n    label: \"Hold\",\n    description: \"Regroup on you and stay close.\",\n    order: 0\n  },\n  {\n    id: \"defend\",\n    label: \"Defend\",\n    description: \"Form a defensive ring and cover your position.\",\n    order: 1\n  },\n  {\n    id: \"attack\",\n    label: \"Attack\",\n    description: \"Press the nearest enemy with ranged fire.\",\n    order: 2\n  },\n  {\n    id: \"flank\",\n    label: \"Flank\",\n    description: \"Split wide and pressure the enemy from the side.\",\n    order: 3\n  }\n];\n\nconst SQUAD_SETTINGS = {\n  maxSquadSize: 3,\n  commandRange: 640,\n  followRadius: 120,\n  defendRadius: 180,\n  flankOffset: 220,\n  commandCooldown: 1.4,\n  supportFireCooldown: 0.45,\n  projectileSpeed: 520,\n  projectileDamage: 12\n};\n\nexport { SQUAD_COMMANDS, SQUAD_SETTINGS };\r\n","import { canvas, GROUND_Y } from \"../environment/canvas.js\";\r\nimport { POSES } from \"../config/constants.js\";\r\nimport { SQUAD_COMMANDS } from \"../config/squad.js\";\r\n\r\nfunction getTotalHeight(pose) {\r\n  return pose.headRadius * 2 + pose.bodyLength + pose.legLength;\r\n}\r\n\r\nfunction createGruntEnemy(spawnX = canvas.width * 0.25) {\r\n  const spawnY = GROUND_Y - 118;\r\n  return {\r\n    id: `grunt-${Math.random().toString(36).slice(2, 8)}`,\r\n    spawnX,\r\n    spawnY,\r\n    x: spawnX,\r\n    y: spawnY,\r\n    vx: 0,\r\n    vy: 0,\r\n    radius: 22,\r\n    height: 118,\r\n    facing: 1,\r\n    onGround: true,\r\n    state: \"patrol\",\r\n    stateTimer: 1 + Math.random(),\r\n    patrolRange: { min: spawnX - 100, max: spawnX + 220 },\r\n    aggressionRange: 360,\r\n    attackRange: 86,\r\n    moveSpeed: 160,\r\n    health: 120,\r\n    maxHealth: 120,\r\n    attackCooldown: 0,\r\n    attackWindup: 0,\r\n    attackActive: 0,\r\n    attackDamage: 12,\r\n    attackKnockback: 120,\r\n    attackLaunch: -80,\r\n    flashTimer: 0,\r\n    shakeTimer: 0,\r\n    shakeMagnitude: 0,\r\n    invulnerability: 0,\r\n    respawnTimer: 0,\r\n    stunTimer: 0,\r\n    smokeSlowTimer: 0,\r\n    smokeSlowStrength: 1\r\n  };\r\n}\r\n\r\n\r\nfunction createSquadmate(offsetX = 0, name = \"Ally\") {\r\n  const spawnX = canvas.width * 0.5 + offsetX;\r\n  const spawnY = GROUND_Y - getTotalHeight(POSES.standing);\r\n  return {\r\n    id: `squad-${Math.random().toString(36).slice(2, 8)}`,\r\n    name,\r\n    x: spawnX,\r\n    y: spawnY,\r\n    vx: 0,\r\n    vy: 0,\r\n    facing: 1,\r\n    onGround: true,\r\n    state: \"follow\",\r\n    fireCooldown: 0,\r\n    commandTimer: 0,\r\n    targetEnemyId: null,\r\n    flashTimer: 0,\r\n    highlight: 0,\r\n    roleIndex: 0\r\n  };\r\n}\r\n\r\nconst stickman = {\r\n  x: canvas.width * 0.5,\r\n  y: GROUND_Y - getTotalHeight(POSES.standing),\r\n  vx: 0,\r\n  vy: 0,\r\n  facing: 1,\r\n  onGround: true,\r\n  controlMode: \"onFoot\",\r\n  vehicleId: null,\r\n  vehicleCandidateId: null,\r\n  squadCommandIndex: 0,\r\n  squadCommandId: SQUAD_COMMANDS[0]?.id ?? \"hold\",\r\n  squadCommandCooldown: 0,\r\n  rolling: false,\r\n  rollTimer: 0,\r\n  crouching: false,\r\n  currentPose: POSES.standing,\r\n  attacking: false,\r\n  attackIndex: -1,\r\n  currentAttack: null,\r\n  attackElapsed: 0,\r\n  attackInstanceId: 0,\r\n  comboWindowOpen: false,\r\n  comboWindowTimer: 0,\r\n  nextAttackQueued: false,\r\n  hitboxSpawned: false,\r\n  activeHitboxes: [],\r\n  health: 100,\r\n  maxHealth: 100,\r\n  invulnerability: 0,\r\n  deadTimer: 0,\r\n  throwCooldown: 0,\r\n  gadgetCooldown: 0,\r\n  reloading: false,\r\n  stunTimer: 0,\r\n  flashBlindTimer: 0,\r\n  smokeSlowTimer: 0,\r\n  smokeSlowStrength: 1,\r\n  equippedWeaponId: \"combatFists\"\r\n};\r\n\r\nconst squadmates = [\r\n  createSquadmate(-120, \"Sparrow\"),\r\n  createSquadmate(40, \"Rook\"),\r\n  createSquadmate(120, \"Viper\")\r\n];\r\n\r\nconst remotePlayers = new Map();\r\n\r\nfunction upsertRemotePlayer(state) {\r\n  if (!state || !state.id) {\r\n    return;\r\n  }\r\n  const now = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n  const existing = remotePlayers.get(state.id) ?? {};\r\n  remotePlayers.set(state.id, {\r\n    id: state.id,\r\n    name: state.name ?? existing.name ?? \"Remote\",\r\n    x: state.x ?? existing.x ?? 0,\r\n    y: state.y ?? existing.y ?? GROUND_Y - getTotalHeight(POSES.standing),\r\n    facing: state.facing ?? existing.facing ?? 1,\r\n    commandId: state.commandId ?? existing.commandId ?? \"hold\",\r\n    lastUpdate: now\r\n  });\r\n}\r\n\r\nfunction getRemotePlayers() {\r\n  return Array.from(remotePlayers.values());\r\n}\r\n\r\nfunction pruneRemotePlayers(maxAgeMs = 6000) {\r\n  const now = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n  for (const [id, player] of remotePlayers.entries()) {\r\n    if (now - (player.lastUpdate ?? now) > maxAgeMs) {\r\n      remotePlayers.delete(id);\r\n    }\r\n  }\r\n}\r\n\r\nconst trainingDummy = {\r\n  id: \"training-dummy\",\r\n  x: canvas.width * 0.75,\r\n  y: GROUND_Y - 120,\r\n  height: 120,\r\n  radius: 26,\r\n  maxHealth: 150,\r\n  health: 150,\r\n  flashTimer: 0,\r\n  shakeTimer: 0,\r\n  shakeMagnitude: 0,\r\n  respawnTimer: 0\r\n};\r\n\r\nconst enemies = [\r\n  createGruntEnemy(canvas.width * 0.24),\r\n  createGruntEnemy(canvas.width * 0.68)\r\n];\r\n\r\nexport { stickman, trainingDummy, enemies, squadmates, remotePlayers, createGruntEnemy, createSquadmate, upsertRemotePlayer, getRemotePlayers, pruneRemotePlayers, getTotalHeight };\r\n","import { DEFAULT_LOADOUT, WEAPON_DEFINITIONS } from \"../config/weapons.js\";\r\nimport { stickman } from \"./entities.js\";\r\n\r\nconst weaponState = {\r\n  inventory: [...DEFAULT_LOADOUT],\r\n  activeIndex: 0\r\n};\r\n\r\nfunction isValidIndex(index) {\r\n  return index >= 0 && index < weaponState.inventory.length;\r\n}\r\n\r\nfunction getCurrentWeaponId() {\r\n  return weaponState.inventory[weaponState.activeIndex];\r\n}\r\n\r\nfunction setActiveWeaponByIndex(index) {\r\n  if (!isValidIndex(index)) {\r\n    return false;\r\n  }\r\n  weaponState.activeIndex = index;\r\n  stickman.equippedWeaponId = weaponState.inventory[index];\r\n  return true;\r\n}\r\n\r\nfunction getWeaponInventory() {\r\n  return weaponState.inventory.slice();\r\n}\r\n\r\nfunction addWeaponToInventory(weaponId, { autoEquip = false } = {}) {\r\n  if (!weaponId || !WEAPON_DEFINITIONS[weaponId]) {\r\n    return false;\r\n  }\r\n  let index = weaponState.inventory.indexOf(weaponId);\r\n  if (index === -1) {\r\n    weaponState.inventory.push(weaponId);\r\n    index = weaponState.inventory.length - 1;\r\n  }\r\n  if (autoEquip) {\r\n    setActiveWeaponByIndex(index);\r\n  } else {\r\n    ensureEquippedWeaponValid();\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction getThrowableCount() {\r\n  return weaponState.inventory\r\n    .map((id) => WEAPON_DEFINITIONS?.[id]?.category)\r\n    .filter((category) => category === \"throwable\")\r\n    .length;\r\n}\r\n\r\nfunction ensureEquippedWeaponValid() {\r\n  const existingIndex = weaponState.inventory.indexOf(stickman.equippedWeaponId);\r\n  if (existingIndex >= 0) {\r\n    weaponState.activeIndex = existingIndex;\r\n    return;\r\n  }\r\n\r\n  weaponState.inventory[0] = weaponState.inventory[0] ?? DEFAULT_LOADOUT[0];\r\n  weaponState.activeIndex = 0;\r\n  stickman.equippedWeaponId = weaponState.inventory[0];\r\n}\r\n\r\nensureEquippedWeaponValid();\r\n\r\nexport { weaponState, getCurrentWeaponId, setActiveWeaponByIndex, getWeaponInventory, getThrowableCount, addWeaponToInventory };\r\n","import { WEAPON_DEFINITIONS } from \"../config/weapons.js\";\nimport { stickman } from \"./entities.js\";\n\nconst ammoState = new Map();\n\nfunction ensureAmmoEntry(weaponId) {\n  if (!weaponId) {\n    return null;\n  }\n  const def = WEAPON_DEFINITIONS[weaponId];\n  if (!def) {\n    ammoState.delete(weaponId);\n    return null;\n  }\n\n  const ammoDef = def.ammo;\n  const spreadDef = def.spread;\n\n  const hasAmmo = ammoDef !== undefined;\n  const capacity = hasAmmo ? Math.max(0, ammoDef.magazine ?? 0) : Number.POSITIVE_INFINITY;\n  const reserve = hasAmmo ? Math.max(0, ammoDef.reserve ?? 0) : Number.POSITIVE_INFINITY;\n  const reloadSeconds = hasAmmo ? Math.max(0.1, ammoDef.reloadSeconds ?? 1.2) : 0;\n\n  let entry = ammoState.get(weaponId);\n  if (!entry) {\n    entry = {\n      capacity,\n      magazine: capacity === Number.POSITIVE_INFINITY ? Number.POSITIVE_INFINITY : capacity,\n      reserve,\n      reloadSeconds,\n      reloadTimer: 0,\n      reloading: false,\n      spreadDef: spreadDef ?? null,\n      spread: spreadDef ? { current: spreadDef.base ?? 0 } : null\n    };\n    ammoState.set(weaponId, entry);\n  } else {\n    entry.capacity = capacity;\n    if (capacity === Number.POSITIVE_INFINITY) {\n      entry.magazine = Number.POSITIVE_INFINITY;\n    } else if (!hasAmmo) {\n      entry.magazine = capacity;\n    } else {\n      entry.magazine = Math.min(entry.magazine, capacity);\n    }\n    entry.reserve = reserve;\n    entry.reloadSeconds = reloadSeconds;\n    entry.spreadDef = spreadDef ?? null;\n    if (!entry.spread && spreadDef) {\n      entry.spread = { current: spreadDef.base ?? 0 };\n    }\n    if (!spreadDef) {\n      entry.spread = null;\n    }\n  }\n  return entry;\n}\n\nfunction getAmmoStatus(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry) {\n    return null;\n  }\n  return {\n    magazine: entry.magazine,\n    reserve: entry.reserve,\n    capacity: entry.capacity,\n    reloading: entry.reloading,\n    reloadTimer: entry.reloadTimer,\n    reloadSeconds: entry.reloadSeconds\n  };\n}\n\nfunction consumeAmmo(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry) {\n    return true;\n  }\n  if (entry.capacity === Number.POSITIVE_INFINITY) {\n    return true;\n  }\n  if (entry.reloading) {\n    return false;\n  }\n  if (entry.magazine <= 0) {\n    return false;\n  }\n  entry.magazine -= 1;\n  return true;\n}\n\nfunction startReload(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry) {\n    return false;\n  }\n  if (entry.capacity === Number.POSITIVE_INFINITY) {\n    return false;\n  }\n  if (entry.reloading) {\n    return false;\n  }\n  if (entry.magazine >= entry.capacity) {\n    return false;\n  }\n  if (entry.reserve <= 0) {\n    return false;\n  }\n  entry.reloading = true;\n  entry.reloadTimer = entry.reloadSeconds;\n  if (stickman.equippedWeaponId === weaponId) {\n    stickman.reloading = true;\n  }\n  return true;\n}\n\nfunction cancelReload(weaponId) {\n  const entry = ammoState.get(weaponId);\n  if (!entry) {\n    return;\n  }\n  entry.reloading = false;\n  entry.reloadTimer = 0;\n  if (stickman.equippedWeaponId === weaponId) {\n    stickman.reloading = false;\n  }\n}\n\nfunction registerShot(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  const def = entry?.spreadDef;\n  if (!entry || !def) {\n    return 0;\n  }\n\n  if (!entry.spread) {\n    entry.spread = { current: def.base ?? 0 };\n  }\n  const spreadState = entry.spread;\n  const base = def.base ?? 0;\n  const current = Math.max(base, spreadState.current ?? base);\n  const max = def.max ?? current;\n  const effectiveDegrees = Math.min(max, current);\n  const radians = effectiveDegrees * (Math.PI / 180);\n  const angle = radians > 0 ? (Math.random() * 2 - 1) * radians : 0;\n\n  const perShot = def.perShot ?? 0;\n  spreadState.current = Math.min(max, effectiveDegrees + perShot);\n\n  return angle;\n}\n\nfunction updateAmmoTimers(delta, activeWeaponId) {\n  const completedReloads = [];\n  for (const [weaponId, entry] of ammoState.entries()) {\n    const def = WEAPON_DEFINITIONS[weaponId];\n    if (!def) {\n      ammoState.delete(weaponId);\n      continue;\n    }\n\n    if (entry.reloading) {\n      entry.reloadTimer = Math.max(0, entry.reloadTimer - delta);\n      if (entry.reloadTimer <= 0) {\n        if (entry.capacity !== Number.POSITIVE_INFINITY) {\n          const needed = entry.capacity - entry.magazine;\n          if (needed > 0) {\n            const loaded = Math.min(needed, entry.reserve);\n            entry.magazine += loaded;\n            entry.reserve -= loaded;\n          }\n        }\n        entry.reloading = false;\n        entry.reloadTimer = 0;\n        completedReloads.push(weaponId);\n      }\n    }\n\n    if (entry.spread && entry.spreadDef) {\n      const base = entry.spreadDef.base ?? 0;\n      const recovery = entry.spreadDef.recovery ?? 0;\n      if (recovery > 0) {\n        entry.spread.current = Math.max(base, entry.spread.current - recovery * delta);\n      } else {\n        entry.spread.current = Math.max(base, entry.spread.current ?? base);\n      }\n    }\n  }\n\n  if (activeWeaponId) {\n    const entry = ammoState.get(activeWeaponId);\n    stickman.reloading = entry?.reloading ?? false;\n  } else {\n    stickman.reloading = false;\n  }\n\n  if (typeof window !== \"undefined\") {\n    for (const weaponId of completedReloads) {\n      window.dispatchEvent(new CustomEvent(\"weapon:reload-finish\", { detail: { weaponId } }));\n    }\n  }\n}\n\nfunction refillWeaponAmmo(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry || entry.capacity === Number.POSITIVE_INFINITY) {\n    return;\n  }\n  entry.magazine = entry.capacity;\n  entry.reserve = WEAPON_DEFINITIONS[weaponId]?.ammo?.reserve ?? entry.reserve;\n  entry.reloading = false;\n  entry.reloadTimer = 0;\n}\n\nexport {\n  ensureAmmoEntry,\n  getAmmoStatus,\n  consumeAmmo,\n  startReload,\n  cancelReload,\n  registerShot,\n  updateAmmoTimers,\n  refillWeaponAmmo\n};\r\n\r\n","import { WEAPON_DEFINITIONS } from \"../../config/weapons.js\";\nimport { stickman } from \"../../state/entities.js\";\nimport { weaponState, getCurrentWeaponId, setActiveWeaponByIndex, getWeaponInventory } from \"../../state/weapons.js\";\nimport { getAmmoStatus, ensureAmmoEntry, cancelReload } from \"../../state/ammo.js\";\n\nlet controlsInitialized = false;\n\nconst previousWeaponState = {\n  id: stickman.equippedWeaponId\n};\n\nequipWeaponIndex(weaponState.activeIndex);\n\nfunction getWeaponDefinitionById(id) {\n  return WEAPON_DEFINITIONS[id];\n}\n\nfunction getCurrentWeapon() {\n  const weaponId = getCurrentWeaponId();\n  return getWeaponDefinitionById(weaponId) ?? null;\n}\n\nfunction equipWeaponIndex(index) {\n  const previousId = stickman.equippedWeaponId;\n  if (!setActiveWeaponByIndex(index)) {\n    return false;\n  }\n  if (previousId && previousId !== stickman.equippedWeaponId) {\n    cancelReload(previousId);\n  }\n\n  ensureAmmoEntry(stickman.equippedWeaponId);\n\n  stickman.attacking = false;\n  stickman.currentAttack = null;\n  stickman.attackElapsed = 0;\n  stickman.comboWindowOpen = false;\n  stickman.comboWindowTimer = 0;\n  stickman.attackIndex = -1;\n  stickman.hitboxSpawned = false;\n\n  const ammoStatus = getAmmoStatus(stickman.equippedWeaponId);\n  stickman.reloading = ammoStatus?.reloading ?? false;\n\n  previousWeaponState.id = stickman.equippedWeaponId;\n  return true;\n}\n\nfunction equipWeaponBySlot(slotNumber) {\n  const index = slotNumber - 1;\n  equipWeaponIndex(index);\n}\n\nfunction getSlotFromCode(code) {\n  if (code.startsWith(\"Digit\")) {\n    return Number.parseInt(code.slice(5), 10);\n  }\n  if (code.startsWith(\"Numpad\")) {\n    return Number.parseInt(code.slice(6), 10);\n  }\n  return Number.NaN;\n}\n\nfunction handleWeaponKey(event) {\n  const slot = getSlotFromCode(event.code);\n  if (!Number.isNaN(slot) && slot >= 1) {\n    equipWeaponBySlot(slot);\n    event.preventDefault();\n  }\n}\n\nfunction initializeWeaponControls() {\n  if (controlsInitialized) {\n    return;\n  }\n  window.addEventListener(\"keydown\", handleWeaponKey);\n  controlsInitialized = true;\n}\n\nfunction getWeaponSlots() {\n  return getWeaponInventory().map((id) => WEAPON_DEFINITIONS[id] ?? { id, name: \"Unknown\" });\n}\n\nexport {\n  getCurrentWeapon,\n  getWeaponDefinitionById,\n  equipWeaponBySlot,\n  initializeWeaponControls,\n  getWeaponSlots\n};\r\n","let audioContext = null;\r\nlet initialized = false;\r\nconst lastTriggers = new Map();\r\n\r\nconst EVENT_SOUND_MAP = {\r\n  \"weapon:shot-fired\": { frequency: () => 880 + Math.random() * 220, duration: 0.08, gain: 0.05, shape: \"square\", cooldown: 40 },\r\n  \"weapon:muzzle-flash\": { frequency: () => 760 + Math.random() * 120, duration: 0.06, gain: 0.045, shape: \"sawtooth\", cooldown: 35 },\r\n  \"weapon:reload-start\": { frequency: 210, duration: 0.18, gain: 0.08, shape: \"triangle\", cooldown: 120 },\r\n  \"weapon:reload-finish\": { frequency: 320, duration: 0.16, gain: 0.09, shape: \"triangle\", cooldown: 120 },\r\n  \"weapon:recoil-kick\": { frequency: (detail) => 480 + (detail?.recoil?.horizontal ?? 0) * 60, duration: 0.12, gain: 0.045, shape: \"sine\", cooldown: 90 },\r\n  \"shield:hit\": { frequency: 140, duration: 0.22, gain: 0.1, shape: \"sine\", cooldown: 140 },\r\n  \"shield:shatter\": { frequency: 90, duration: 0.4, gain: 0.14, shape: \"sawtooth\", cooldown: 260 },\r\n  \"shield:end\": { frequency: 260, duration: 0.16, gain: 0.05, shape: \"triangle\", cooldown: 200 },\r\n  \"throwable:explosion\": { frequency: 180, duration: 0.35, gain: 0.12, shape: \"sawtooth\", cooldown: 240 },\r\n  \"throwable:flash-burst\": { frequency: () => 960 + Math.random() * 180, duration: 0.18, gain: 0.07, shape: \"triangle\", cooldown: 220 },\r\n  \"throwable:smoke-detonate\": { frequency: 220, duration: 0.32, gain: 0.055, shape: \"sine\", cooldown: 260 },\r\n  \"throwable:smoke-dissipate\": { frequency: 150, duration: 0.36, gain: 0.035, shape: \"sine\", cooldown: 320 },\r\n};\r\n\r\nfunction ensureAudioContext() {\r\n  if (audioContext || typeof window === \"undefined\") {\r\n    return audioContext;\r\n  }\r\n  const AudioCtor = window.AudioContext || window.webkitAudioContext;\r\n  if (!AudioCtor) {\r\n    return null;\r\n  }\r\n  audioContext = new AudioCtor();\r\n  return audioContext;\r\n}\r\n\r\nfunction resumeAudio() {\r\n  if (!audioContext) {\r\n    return;\r\n  }\r\n  if (audioContext.state === \"suspended\" && typeof audioContext.resume === \"function\") {\r\n    audioContext.resume().catch(() => {\r\n      /* ignore resume issues */\r\n    });\r\n  }\r\n}\r\n\r\nfunction scheduleTone(config, detail) {\r\n  const ctx = ensureAudioContext();\r\n  if (!ctx) {\r\n    return;\r\n  }\r\n  resumeAudio();\r\n\r\n  const now = performance.now();\r\n  const cooldown = config.cooldown ?? 80;\r\n  const key = config;\r\n  const last = lastTriggers.get(key) ?? 0;\r\n  if (now - last < cooldown) {\r\n    return;\r\n  }\r\n  lastTriggers.set(key, now);\r\n\r\n  const osc = ctx.createOscillator();\r\n  osc.type = config.shape ?? \"sine\";\r\n  const baseFrequency = typeof config.frequency === \"function\" ? config.frequency(detail) : config.frequency;\r\n  osc.frequency.setValueAtTime(Math.max(40, baseFrequency ?? 440), ctx.currentTime);\r\n\r\n  const gainNode = ctx.createGain();\r\n  const baseGain = Math.max(0.001, config.gain ?? 0.05);\r\n  const rampDuration = Math.max(0.05, config.duration ?? 0.12);\r\n  gainNode.gain.setValueAtTime(baseGain, ctx.currentTime);\r\n  gainNode.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + rampDuration);\r\n\r\n  osc.connect(gainNode);\r\n  gainNode.connect(ctx.destination);\r\n\r\n  osc.start();\r\n  osc.stop(ctx.currentTime + rampDuration);\r\n}\r\n\r\nfunction bindAudio(eventName) {\r\n  const config = EVENT_SOUND_MAP[eventName];\r\n  if (!config) {\r\n    return;\r\n  }\r\n  window.addEventListener(eventName, (event) => {\r\n    scheduleTone(config, event?.detail ?? {});\r\n  });\r\n}\r\n\r\nfunction primeAudioContext() {\r\n  resumeAudio();\r\n  window.removeEventListener(\"pointerdown\", primeAudioContext);\r\n  window.removeEventListener(\"keydown\", primeAudioContext);\r\n}\r\n\r\nfunction initializePlaceholderAudio() {\r\n  if (initialized || typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  initialized = true;\r\n  ensureAudioContext();\r\n  Object.keys(EVENT_SOUND_MAP).forEach(bindAudio);\r\n  window.addEventListener(\"pointerdown\", primeAudioContext);\r\n  window.addEventListener(\"keydown\", primeAudioContext);\r\n}\r\n\r\nexport { initializePlaceholderAudio };\r\n","\r\nfunction getP2P() {\r\n  if (typeof window === \"undefined\" || !window.P2P) {\r\n    const error = new Error(\"P2P module not loaded\");\r\n    error.code = \"P2P_NOT_AVAILABLE\";\r\n    throw error;\r\n  }\r\n  return window.P2P;\r\n}\r\nimport { GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { stickman, remotePlayers, upsertRemotePlayer, pruneRemotePlayers, getTotalHeight } from \"../../state/entities.js\";\r\n\r\nconst peerId = `peer-${Math.random().toString(36).slice(2, 8)}`;\r\nlet peerConnection = null;\r\nlet outboundChannel = null;\r\nlet inboundChannel = null;\r\nlet lastSendTime = 0;\r\nlet connectionStatus = \"disconnected\";\r\nlet localDescriptionString = null;\r\nconst localCandidates = [];\r\n\r\nfunction ensurePeerConnection() {\r\n  if (peerConnection || typeof window === \"undefined\" || !window.RTCPeerConnection) {\r\n    return peerConnection;\r\n  }\r\n  peerConnection = new RTCPeerConnection({ iceServers: [] });\r\n  connectionStatus = \"connecting\";\r\n\r\n  outboundChannel = peerConnection.createDataChannel(\"stickman\", { ordered: true });\r\n  setupDataChannel(outboundChannel);\r\n\r\n  peerConnection.addEventListener(\"icecandidate\", (event) => {\r\n    if (event.candidate) {\r\n      localCandidates.push(JSON.stringify(event.candidate));\r\n    }\r\n  });\r\n\r\n  peerConnection.addEventListener(\"connectionstatechange\", () => {\r\n    connectionStatus = peerConnection.connectionState ?? \"unknown\";\r\n  });\r\n\r\n  peerConnection.addEventListener(\"datachannel\", (event) => {\r\n    inboundChannel = event.channel;\r\n    setupDataChannel(inboundChannel);\r\n  });\r\n\r\n  return peerConnection;\r\n}\r\n\r\nfunction setupDataChannel(channel) {\r\n  if (!channel) {\r\n    return;\r\n  }\r\n  channel.addEventListener(\"open\", () => {\r\n    connectionStatus = \"connected\";\r\n  });\r\n  channel.addEventListener(\"close\", () => {\r\n    connectionStatus = \"disconnected\";\r\n  });\r\n  channel.addEventListener(\"message\", (event) => {\r\n    try {\r\n      const payload = JSON.parse(event.data);\r\n      handleIncomingMessage(payload);\r\n    } catch (error) {\r\n      console.warn(\"Failed to parse P2P payload\", error);\r\n    }\r\n  });\r\n}\r\n\r\nfunction handleIncomingMessage(payload) {\r\n  if (!payload || typeof payload !== \"object\") {\r\n    return;\r\n  }\r\n  switch (payload.type) {\r\n    case \"playerState\":\r\n      upsertRemotePlayer({\r\n        id: payload.id,\r\n        name: payload.name,\r\n        x: payload.x,\r\n        y: payload.y,\r\n        facing: payload.facing,\r\n        commandId: payload.commandId\r\n      });\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n}\r\n\r\nasync function createOffer() {\r\n  ensurePeerConnection();\r\n  const offer = await peerConnection.createOffer();\r\n  await peerConnection.setLocalDescription(offer);\r\n  localDescriptionString = JSON.stringify(offer);\r\n  return localDescriptionString;\r\n}\r\n\r\nasync function createAnswer(remoteDescriptionString) {\r\n  ensurePeerConnection();\r\n  const description = JSON.parse(remoteDescriptionString);\r\n  await peerConnection.setRemoteDescription(new RTCSessionDescription(description));\r\n  const answer = await peerConnection.createAnswer();\r\n  await peerConnection.setLocalDescription(answer);\r\n  localDescriptionString = JSON.stringify(answer);\r\n  return localDescriptionString;\r\n}\r\n\r\nasync function acceptRemoteDescription(remoteDescriptionString) {\r\n  ensurePeerConnection();\r\n  const description = JSON.parse(remoteDescriptionString);\r\n  await peerConnection.setRemoteDescription(new RTCSessionDescription(description));\r\n}\r\n\r\nasync function addRemoteCandidate(candidateString) {\r\n  if (!candidateString) {\r\n    return;\r\n  }\r\n  ensurePeerConnection();\r\n  const candidate = new RTCIceCandidate(JSON.parse(candidateString));\r\n  await peerConnection.addIceCandidate(candidate);\r\n}\r\n\r\nfunction getLocalDescription() {\r\n  return localDescriptionString;\r\n}\r\n\r\nfunction getLocalCandidates() {\r\n  return [...localCandidates];\r\n}\r\n\r\nfunction getConnectionStatus() {\r\n  return connectionStatus;\r\n}\r\n\r\nfunction updateP2P(delta) {\r\n  pruneRemotePlayers();\r\n  ensurePeerConnection();\r\n  if (!outboundChannel || outboundChannel.readyState !== \"open\") {\r\n    return;\r\n  }\r\n  const now = (typeof performance !== \"undefined\" ? performance.now() : Date.now());\r\n  if (now - lastSendTime < 60) {\r\n    return;\r\n  }\r\n  lastSendTime = now;\r\n  const payload = {\r\n    type: \"playerState\",\r\n    id: peerId,\r\n    name: \"Remote\",\r\n    x: stickman.x,\r\n    y: stickman.y,\r\n    facing: stickman.facing,\r\n    commandId: stickman.squadCommandId\r\n  };\r\n  try {\r\n    outboundChannel.send(JSON.stringify(payload));\r\n  } catch {\r\n    // ignore send errors\r\n  }\r\n}\r\n\r\nfunction initializeP2PNetworking() {\r\n  ensurePeerConnection();\r\n  if (typeof window !== \"undefined\") {\r\n    window.P2P = {\r\n      createOffer,\r\n      createAnswer,\r\n      acceptRemoteDescription,\r\n      addRemoteCandidate,\r\n      getLocalDescription,\r\n      getLocalCandidates,\r\n      getStatus: getP2PStatus,\r\n      close: closeConnection\r\n    };\r\n  }\r\n}\r\n\r\nfunction closeConnection() {\r\n  if (outboundChannel) {\r\n    outboundChannel.close();\r\n    outboundChannel = null;\r\n  }\r\n  if (inboundChannel) {\r\n    inboundChannel.close();\r\n    inboundChannel = null;\r\n  }\r\n  if (peerConnection) {\r\n    peerConnection.close();\r\n    peerConnection = null;\r\n  }\r\n  connectionStatus = \"disconnected\";\r\n}\r\n\r\nfunction getP2PStatus() {\r\n  return {\r\n    id: peerId,\r\n    status: connectionStatus,\r\n    localDescription: localDescriptionString,\r\n    localCandidates: [...localCandidates]\r\n  };\r\n}\r\n\r\nfunction getRemotePlayersList() {\r\n  return Array.from(remotePlayers.values());\r\n}\r\n\r\nexport { initializeP2PNetworking, updateP2P, getP2PStatus, getRemotePlayersList, getP2P };\r\n","const NETWORK_CONFIG = {\n  serverApiBase: \"https://projectstickfightinggame.onrender.com\",\n  refreshIntervalMs: 15000,\n  heartbeatIntervalMs: 45000,\n  hostTtlSeconds: 150,\n  hostSecret: \"sk-stickman-host-123456789987654321\", // set this to match SERVER_SECRET on Render\n  hostName: \"ProjectStickFightingGame Lobby\",\n  defaultRegion: \"na-west\"\n};\n\nexport { NETWORK_CONFIG };\n","import { NETWORK_CONFIG } from \"../config/network.js\";\r\n\r\nconst serverBrowserState = {\r\n  servers: [],\r\n  visible: false,\r\n  selectedIndex: 0,\r\n  lastFetch: 0,\r\n  fetching: false,\r\n  error: null,\r\n  statusMessage: null,\r\n  hosting: false,\r\n  hostingSessionId: null,\r\n  hostingLastHeartbeat: 0,\r\n  hostingExpiresAt: 0,\r\n  joinStatus: null,\r\n  joinError: null,\r\n  hostingMetrics: {\r\n    playerCount: 1,\r\n    enemyCount: 0,\r\n    alliesCount: 0\r\n  },\r\n  p2p: {\r\n    offer: null,\r\n    answer: null,\r\n    pendingOffer: false,\r\n    pendingAnswer: false,\r\n    pendingCandidates: false,\r\n    localCandidates: [],\r\n    remoteCandidates: [],\r\n    error: null\r\n  }\r\n};\r\n\r\nfunction getServerBrowserState() {\r\n  return serverBrowserState;\r\n}\r\n\r\nfunction setVisible(visible) {\r\n  serverBrowserState.visible = visible;\r\n  if (!visible) {\r\n    serverBrowserState.statusMessage = null;\r\n    serverBrowserState.error = null;\r\n  }\r\n}\r\n\r\nfunction toggleVisible() {\r\n  setVisible(!serverBrowserState.visible);\r\n}\r\n\r\nfunction setServers(list) {\r\n  const previousSelection = serverBrowserState.servers[serverBrowserState.selectedIndex]?.id;\r\n  serverBrowserState.servers = Array.isArray(list) ? list : [];\r\n  if (previousSelection) {\r\n    const matchedIndex = serverBrowserState.servers.findIndex((server) => server.id === previousSelection);\r\n    if (matchedIndex >= 0) {\r\n      serverBrowserState.selectedIndex = matchedIndex;\r\n    }\r\n  }\r\n  if (serverBrowserState.selectedIndex >= serverBrowserState.servers.length) {\r\n    serverBrowserState.selectedIndex = Math.max(0, serverBrowserState.servers.length - 1);\r\n  }\r\n}\r\n\r\nfunction setError(message) {\r\n  serverBrowserState.error = message;\r\n}\r\n\r\nfunction setStatusMessage(message) {\r\n  serverBrowserState.statusMessage = message;\r\n}\r\n\r\nfunction setJoinStatus(message) {\r\n  serverBrowserState.joinStatus = message;\r\n}\r\n\r\nfunction setJoinError(message) {\r\n  serverBrowserState.joinError = message;\r\n}\r\n\r\nfunction setJoinedSessionId(id) {\r\n  serverBrowserState.joinedSessionId = id ?? null;\r\n}\r\n\r\nfunction selectNext(delta) {\r\n  if (serverBrowserState.servers.length === 0) {\r\n    return;\r\n  }\r\n  serverBrowserState.selectedIndex = (serverBrowserState.selectedIndex + delta + serverBrowserState.servers.length) % serverBrowserState.servers.length;\r\n}\r\n\r\nfunction recordFetchTimestamp(timestamp) {\r\n  serverBrowserState.lastFetch = timestamp;\r\n}\r\n\r\nfunction setFetching(fetching) {\r\n  serverBrowserState.fetching = fetching;\r\n}\r\n\r\nfunction setHostingSession({ id, expiresAt }) {\r\n  serverBrowserState.hosting = Boolean(id);\r\n  serverBrowserState.hostingSessionId = id ?? null;\r\n  serverBrowserState.hostingLastHeartbeat = performance.now();\r\n  serverBrowserState.hostingExpiresAt = expiresAt ?? 0;\r\n}\r\n\r\nfunction updateHostingHeartbeatTimestamp(timestamp) {\r\n  serverBrowserState.hostingLastHeartbeat = timestamp;\r\n}\r\n \r\nfunction clearHosting() {\r\n  serverBrowserState.hosting = false;\r\n  serverBrowserState.hostingSessionId = null;\r\n  serverBrowserState.hostingExpiresAt = 0;\r\n  serverBrowserState.hostingLastHeartbeat = 0;\r\n  clearP2PState();\r\n}\r\nfunction setHostingMetrics(metrics = {}) {\r\n  if (Number.isFinite(metrics.playerCount)) {\r\n    serverBrowserState.hostingMetrics.playerCount = Math.max(1, Math.round(metrics.playerCount));\r\n  }\r\n  if (Number.isFinite(metrics.enemyCount)) {\r\n    serverBrowserState.hostingMetrics.enemyCount = Math.max(0, Math.round(metrics.enemyCount));\r\n  }\r\n  if (Number.isFinite(metrics.alliesCount)) {\r\n    serverBrowserState.hostingMetrics.alliesCount = Math.max(0, Math.round(metrics.alliesCount));\r\n  }\r\n}\r\n\r\nfunction setP2POffer(offer) {\r\n  serverBrowserState.p2p.offer = offer ?? null;\r\n}\r\n\r\nfunction setP2PAnswer(answer) {\r\n  serverBrowserState.p2p.answer = answer ?? null;\r\n}\r\n\r\nfunction setP2PLocalCandidates(candidates) {\r\n  if (!Array.isArray(candidates)) {\r\n    candidates = [];\r\n  }\r\n  const next = candidates.slice();\r\n  const current = serverBrowserState.p2p.localCandidates || [];\r\n  if (current.length === next.length && current.every((value, index) => value === next[index])) {\r\n    return;\r\n  }\r\n  serverBrowserState.p2p.localCandidates = next;\r\n}\r\n \r\nfunction setP2PRemoteCandidates(candidates) {\r\n  if (!Array.isArray(candidates)) {\r\n    candidates = [];\r\n  }\r\n  const next = candidates.slice();\r\n  const current = serverBrowserState.p2p.remoteCandidates || [];\r\n  if (current.length === next.length && current.every((value, index) => value === next[index])) {\r\n    return;\r\n  }\r\n  serverBrowserState.p2p.remoteCandidates = next;\r\n}\r\n\r\nfunction setP2PError(message) {\r\n  serverBrowserState.p2p.error = message ?? null;\r\n}\r\nfunction setP2PPending({ offer, answer, candidates }) {\r\n  if (typeof offer === \"boolean\") {\r\n    serverBrowserState.p2p.pendingOffer = offer;\r\n  }\r\n  if (typeof answer === \"boolean\") {\r\n    serverBrowserState.p2p.pendingAnswer = answer;\r\n  }\r\n  if (typeof candidates === \"boolean\") {\r\n    serverBrowserState.p2p.pendingCandidates = candidates;\r\n  }\r\n}\r\n\r\nfunction clearP2PState() {\r\n  serverBrowserState.p2p.offer = null;\r\n  serverBrowserState.p2p.answer = null;\r\n  serverBrowserState.p2p.pendingOffer = false;\r\n  serverBrowserState.p2p.pendingAnswer = false;\r\n  serverBrowserState.p2p.pendingCandidates = false;\r\n  serverBrowserState.p2p.localCandidates = [];\r\n  serverBrowserState.p2p.remoteCandidates = [];\r\n  serverBrowserState.p2p.error = null;\r\n}\r\n\r\nexport {\r\n  serverBrowserState,\r\n  getServerBrowserState,\r\n  setVisible,\r\n  toggleVisible,\r\n  setServers,\r\n  setError,\r\n  setStatusMessage,\r\n  setJoinStatus,\r\n  setJoinError,\r\n  setJoinedSessionId,\r\n  selectNext,\r\n  recordFetchTimestamp,\r\n  setFetching,\r\n  setHostingSession,\r\n  updateHostingHeartbeatTimestamp,\r\n  clearHosting,\r\n  setHostingMetrics,\r\n  setP2POffer,\r\n  setP2PAnswer,\r\n  setP2PLocalCandidates,\r\n  setP2PRemoteCandidates,\r\n  setP2PPending,\r\n  setP2PError,\r\n  clearP2PState\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { canvas, GROUND_Y } from \"../environment/canvas.js\";\r\n\r\nfunction clamp(value, min, max) {\r\n  return Math.max(min, Math.min(max, value));\r\n}\r\n\r\nconst VEHICLE_DEFINITIONS = {\r\n  buggy: {\r\n    label: \"Recon Buggy\",\r\n    movementType: \"ground\",\r\n    width: 132,\r\n    height: 48,\r\n    wheelRadius: 18,\r\n    wheelBase: 76,\r\n    driverSeat: { x: -6, y: 42 },\r\n    exitOffsets: [\r\n      { x: 72, y: 0 },\r\n      { x: -72, y: 0 }\r\n    ],\r\n    enterRadius: 96,\r\n    acceleration: 540,\r\n    braking: 880,\r\n    maxSpeed: 420,\r\n    idleDrag: 320,\r\n    airDrag: 0.92,\r\n    baseHealth: 280,\r\n    colorBody: \"#2e3147\",\r\n    colorAccent: \"#ffb84d\",\r\n    colorDetail: \"#f7f9ff\"\r\n  },\r\n  raptorHeli: {\r\n    label: \"Raptor Helicopter\",\r\n    movementType: \"air\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"raptorHeli.noseCannon\",\r\n        label: \"Nose Cannon\",\r\n        binding: \"primary\",\r\n        offset: { x: 32, y: 2 },\r\n        muzzles: [\r\n          { x: 46, y: -3 },\r\n          { x: 46, y: 3 }\r\n        ],\r\n        projectile: {\r\n          speed: 720,\r\n          damage: 14,\r\n          radius: 4,\r\n          color: \"#8cf4ff\",\r\n          gravityFactor: 0.04,\r\n          knockback: 70\r\n        },\r\n        scatter: 3.5,\r\n        fireInterval: 0.1,\r\n        flashDuration: 0.07,\r\n        flashRadius: 12,\r\n        barrelLength: 52,\r\n        barrelWidth: 5,\r\n        barrelColor: \"#8cf4ff\"\r\n      }\r\n    ],\r\n    width: 156,\r\n    height: 54,\r\n    driverSeat: { x: 6, y: 44 },\r\n    exitOffsets: [\r\n      { x: 88, y: 0 },\r\n      { x: -88, y: 0 }\r\n    ],\r\n    enterRadius: 128,\r\n    horizontalAcceleration: 320,\r\n    horizontalMaxSpeed: 300,\r\n    horizontalDrag: 180,\r\n    idleDrag: 140,\r\n    airDrag: 0.98,\r\n    liftPower: 880,\r\n    descendPower: 620,\r\n    gravityScale: 0.3,\r\n    maxVerticalSpeed: 240,\r\n    verticalDamping: 0.9,\r\n    hoverMinAltitude: 28,\r\n    hoverMaxAltitude: 260,\r\n    spawnHover: 60,\r\n    autopilotStrength: 5.2,\r\n    baseHealth: 420,\r\n    colorBody: \"#303952\",\r\n    colorAccent: \"#8cf4ff\",\r\n    colorDetail: \"#f4fbff\",\r\n    rotorSpan: 210,\r\n    rotorThickness: 7,\r\n    tailLength: 86\r\n  },\r\n  arrowJet: {\r\n    label: \"Arrow Fighter\",\r\n    movementType: \"air\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"arrowJet.rackRockets\",\r\n        label: \"Wing Rockets\",\r\n        binding: \"secondary\",\r\n        offset: { x: 12, y: -6 },\r\n        muzzles: [\r\n          { x: 52, y: -12 },\r\n          { x: 52, y: 12 }\r\n        ],\r\n        projectile: {\r\n          speed: 780,\r\n          damage: 24,\r\n          radius: 6,\r\n          color: \"#ff6b80\",\r\n          gravityFactor: 0.05,\r\n          knockback: 140\r\n        },\r\n        scatter: 4,\r\n        fireInterval: 0.28,\r\n        flashDuration: 0.09,\r\n        flashRadius: 15,\r\n        barrelLength: 54,\r\n        barrelWidth: 5,\r\n        barrelColor: \"#ff6b80\"\r\n      }\r\n    ],\r\n    width: 180,\r\n    height: 36,\r\n    driverSeat: { x: 0, y: 32 },\r\n    exitOffsets: [\r\n      { x: 96, y: -8 },\r\n      { x: -96, y: -8 }\r\n    ],\r\n    enterRadius: 140,\r\n    horizontalAcceleration: 520,\r\n    horizontalMaxSpeed: 520,\r\n    horizontalDrag: 120,\r\n    idleDrag: 80,\r\n    airDrag: 0.99,\r\n    liftPower: 780,\r\n    descendPower: 540,\r\n    gravityScale: 0.42,\r\n    maxVerticalSpeed: 280,\r\n    verticalDamping: 0.92,\r\n    hoverMinAltitude: 80,\r\n    hoverMaxAltitude: 360,\r\n    spawnHover: 120,\r\n    autopilotStrength: 3.8,\r\n    baseHealth: 350,\r\n    colorBody: \"#262c3e\",\r\n    colorAccent: \"#ff6b80\",\r\n    colorDetail: \"#f8f8ff\",\r\n    wingSpan: 230\r\n  },\r\n  tideSkiff: {\r\n    label: \"Tide Skiff\",\r\n    movementType: \"water\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"tideSkiff.prowCannon\",\r\n        label: \"Prow Cannon\",\r\n        binding: \"primary\",\r\n        offset: { x: 28, y: -18 },\r\n        muzzles: [\r\n          { x: 36, y: -4 }\r\n        ],\r\n        projectile: {\r\n          speed: 560,\r\n          damage: 18,\r\n          radius: 6,\r\n          color: \"#ffdd8a\",\r\n          gravityFactor: 0.08,\r\n          knockback: 110\r\n        },\r\n        scatter: 2.5,\r\n        fireInterval: 0.22,\r\n        flashDuration: 0.1,\r\n        flashRadius: 14,\r\n        barrelLength: 46,\r\n        barrelWidth: 6,\r\n        barrelColor: \"#5fd3ff\"\r\n      }\r\n    ],\r\n    width: 150,\r\n    height: 42,\r\n    driverSeat: { x: -10, y: 34 },\r\n    exitOffsets: [\r\n      { x: 92, y: -4 },\r\n      { x: -92, y: -4 }\r\n    ],\r\n    enterRadius: 120,\r\n    waterSurfaceOffset: 28,\r\n    waterAcceleration: 260,\r\n    waterMaxSpeed: 240,\r\n    waterReverseSpeed: 140,\r\n    waterIdleDrag: 180,\r\n    turnDrag: 220,\r\n    bobAmplitude: 6,\r\n    bobSpeed: 1.5,\r\n    buoyancyPoint: 0.58,\r\n    splashIntensity: 0.4,\r\n    baseHealth: 320,\r\n    colorBody: \"#1f2e3f\",\r\n    colorAccent: \"#5fd3ff\",\r\n    colorDetail: \"#f5fbff\"\r\n  },\r\n  stormBarge: {\r\n    label: \"Storm Barge\",\r\n    movementType: \"water\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"stormBarge.deckChaingun\",\r\n        label: \"Deck Chaingun\",\r\n        binding: \"primary\",\r\n        offset: { x: 18, y: -24 },\r\n        muzzles: [\r\n          { x: 58, y: -6 },\r\n          { x: 58, y: 6 }\r\n        ],\r\n        projectile: {\r\n          speed: 620,\r\n          damage: 16,\r\n          radius: 5,\r\n          color: \"#ffc86d\",\r\n          gravityFactor: 0.06,\r\n          knockback: 90\r\n        },\r\n        scatter: 5,\r\n        fireInterval: 0.12,\r\n        flashDuration: 0.08,\r\n        flashRadius: 16,\r\n        barrelLength: 58,\r\n        barrelWidth: 6,\r\n        barrelColor: \"#ffa94d\"\r\n      }\r\n    ],\r\n    width: 200,\r\n    height: 60,\r\n    driverSeat: { x: 14, y: 46 },\r\n    exitOffsets: [\r\n      { x: 110, y: -6 },\r\n      { x: -110, y: -6 }\r\n    ],\r\n    enterRadius: 132,\r\n    waterSurfaceOffset: 32,\r\n    waterAcceleration: 180,\r\n    waterMaxSpeed: 180,\r\n    waterReverseSpeed: 110,\r\n    waterIdleDrag: 260,\r\n    turnDrag: 320,\r\n    bobAmplitude: 4,\r\n    bobSpeed: 1.2,\r\n    buoyancyPoint: 0.62,\r\n    splashIntensity: 0.3,\r\n    baseHealth: 480,\r\n    colorBody: \"#232f3a\",\r\n    colorAccent: \"#ffa94d\",\r\n    colorDetail: \"#f0f4ff\"\r\n  },\r\n  abyssSub: {\r\n    label: \"Abyss Sub\",\r\n    movementType: \"water\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"abyssSub.torpedoLauncher\",\r\n        label: \"Twin Torpedoes\",\r\n        binding: \"secondary\",\r\n        offset: { x: 12, y: -10 },\r\n        muzzles: [\r\n          { x: 40, y: -6 },\r\n          { x: 40, y: 6 }\r\n        ],\r\n        projectile: {\r\n          speed: 480,\r\n          damage: 28,\r\n          radius: 7,\r\n          color: \"#8c9eff\",\r\n          gravityFactor: 0.02,\r\n          knockback: 160\r\n        },\r\n        scatter: 1.5,\r\n        fireInterval: 0.6,\r\n        flashDuration: 0.12,\r\n        flashRadius: 18,\r\n        barrelLength: 48,\r\n        barrelWidth: 7,\r\n        barrelColor: \"#8c9eff\"\r\n      }\r\n    ],\r\n    width: 132,\r\n    height: 48,\r\n    driverSeat: { x: 0, y: 36 },\r\n    exitOffsets: [\r\n      { x: 78, y: -10 },\r\n      { x: -78, y: -10 }\r\n    ],\r\n    enterRadius: 110,\r\n    waterSurfaceOffset: 36,\r\n    waterAcceleration: 300,\r\n    waterMaxSpeed: 260,\r\n    waterReverseSpeed: 160,\r\n    waterIdleDrag: 210,\r\n    turnDrag: 240,\r\n    bobAmplitude: 3,\r\n    bobSpeed: 1.1,\r\n    buoyancyPoint: 0.5,\r\n    submergedOffset: 18,\r\n    splashIntensity: 0.2,\r\n    baseHealth: 360,\r\n    colorBody: \"#182733\",\r\n    colorAccent: \"#8c9eff\",\r\n    colorDetail: \"#e9f1ff\"\r\n  },\r\n  scoutDrone: {\r\n    label: \"Scout Drone\",\r\n    movementType: \"air\",\r\n    width: 72,\r\n    height: 28,\r\n    driverSeat: { x: 0, y: 20 },\r\n    exitOffsets: [\r\n      { x: 48, y: 0 },\r\n      { x: -48, y: 0 }\r\n    ],\r\n    enterRadius: 90,\r\n    horizontalAcceleration: 280,\r\n    horizontalMaxSpeed: 260,\r\n    horizontalDrag: 220,\r\n    idleDrag: 200,\r\n    airDrag: 0.95,\r\n    liftPower: 660,\r\n    descendPower: 520,\r\n    gravityScale: 0.26,\r\n    maxVerticalSpeed: 200,\r\n    verticalDamping: 0.88,\r\n    hoverMinAltitude: 24,\r\n    hoverMaxAltitude: 220,\r\n    spawnHover: 48,\r\n    autopilotStrength: 6.2,\r\n    baseHealth: 180,\r\n    colorBody: \"#293444\",\r\n    colorAccent: \"#ffe066\",\r\n    colorDetail: \"#edf4ff\"\r\n  }\r\n};\r\n\r\nlet vehicleCounter = 0;\r\n\r\nfunction createVehicle(type, x, options = {}) {\r\n  const definition = VEHICLE_DEFINITIONS[type];\r\n  if (!definition) {\r\n    throw new Error(`Unknown vehicle type: ${type}`);\r\n  }\r\n\r\n  const movementType = definition.movementType ?? \"ground\";\r\n  const minX = definition.width * 0.5;\r\n  const maxX = canvas.width - definition.width * 0.5;\r\n  const centerX = clamp(x ?? canvas.width * 0.5, minX, maxX);\r\n\r\n  let top;\r\n  let onGround = true;\r\n  let waterLineY = null;\r\n  let preferredAltitude = options.hover ?? definition.spawnHover ?? 0;\r\n\r\n  if (movementType === \"air\") {\r\n    const minAltitude = definition.hoverMinAltitude ?? 0;\r\n    const maxAltitude = definition.hoverMaxAltitude ?? minAltitude;\r\n    const altitude = clamp(preferredAltitude, minAltitude, maxAltitude);\r\n    top = GROUND_Y - definition.height - altitude;\r\n    onGround = false;\r\n    preferredAltitude = altitude;\r\n  } else if (movementType === \"water\") {\r\n    const surfaceOffset = definition.waterSurfaceOffset ?? 24;\r\n    waterLineY = GROUND_Y - surfaceOffset;\r\n    const buoyancyPoint = clamp(definition.buoyancyPoint ?? 0.55, 0.2, 0.9);\r\n    const submergedOffset = definition.submergedOffset ?? 0;\r\n    top = waterLineY - definition.height * buoyancyPoint + submergedOffset;\r\n    onGround = false;\r\n    preferredAltitude = 0;\r\n  } else {\r\n    top = GROUND_Y - definition.height;\r\n  }\r\n\r\n  const vehicle = {\r\n    id: `vehicle-${type}-${vehicleCounter += 1}`,\r\n    type,\r\n    x: centerX,\r\n    y: top,\r\n    vx: 0,\r\n    vy: 0,\r\n    tilt: 0,\r\n    facing: 1,\r\n    driverId: null,\r\n    health: definition.baseHealth,\r\n    maxHealth: definition.baseHealth,\r\n    enterCooldown: 0,\r\n    damageFlash: 0,\r\n    onGround,\r\n    preferredAltitude: movementType === \"air\" ? preferredAltitude : 0,\r\n    waterLineY,\r\n    bobPhase: Math.random() * Math.PI * 2\r\n  };\r\n\r\n  vehicle.mounts = (definition.mountedWeapons ?? []).map((mountDef, index) => ({\r\n    id: mountDef.id ?? `${type}-mount-${index}`,\r\n    cooldown: 0,\r\n    flashTimer: 0,\r\n    muzzleIndex: 0,\r\n    lastMuzzleX: null,\r\n    lastMuzzleY: null\r\n  }));\r\n\r\n  return vehicle;\r\n}\r\n\r\nconst vehicles = [\r\n  createVehicle(\"buggy\", canvas.width * 0.14),\r\n  createVehicle(\"buggy\", canvas.width * 0.28),\r\n  createVehicle(\"tideSkiff\", canvas.width * 0.38),\r\n  createVehicle(\"raptorHeli\", canvas.width * 0.56, { hover: 140 }),\r\n  createVehicle(\"arrowJet\", canvas.width * 0.64, { hover: 200 }),\r\n  createVehicle(\"stormBarge\", canvas.width * 0.74),\r\n  createVehicle(\"abyssSub\", canvas.width * 0.78),\r\n  createVehicle(\"scoutDrone\", canvas.width * 0.9, { hover: 100 })\r\n];\r\n\r\nfunction getVehicleById(id) {\r\n  return vehicles.find((vehicle) => vehicle.id === id) ?? null;\r\n}\r\n\r\nexport { VEHICLE_DEFINITIONS, vehicles, createVehicle, getVehicleById };","function clamp(value, min, max) {\n  return Math.max(min, Math.min(max, value));\n}\n\nexport { clamp };\r\n","let elapsed = 0;\n\nfunction advanceTime(delta) {\n  elapsed += delta;\n}\n\nfunction getElapsedTime() {\n  return elapsed;\n}\n\nexport { advanceTime, getElapsedTime };\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { GRAVITY } from \"../../config/constants.js\";\r\n\r\nconst RAGDOLL_BLUEPRINTS = {\r\n  player: [\r\n    { radius: 16, offsetX: 0, offsetY: -42, color: \"#f4f7ff\" },\r\n    { radius: 12, offsetX: 0, offsetY: -14, color: \"#cfd3df\" },\r\n    { radius: 10, offsetX: -14, offsetY: 6, color: \"#f4f7ff\" },\r\n    { radius: 10, offsetX: 14, offsetY: 6, color: \"#f4f7ff\" },\r\n    { radius: 11, offsetX: -10, offsetY: 34, color: \"#cfd3df\" },\r\n    { radius: 11, offsetX: 10, offsetY: 34, color: \"#cfd3df\" }\r\n  ],\r\n  enemy: [\r\n    { radius: 16, offsetX: 0, offsetY: -40, color: \"#fa5b4a\" },\r\n    { radius: 12, offsetX: 0, offsetY: -12, color: \"#d94d3f\" },\r\n    { radius: 10, offsetX: -12, offsetY: 8, color: \"#ff9488\" },\r\n    { radius: 10, offsetX: 12, offsetY: 8, color: \"#ff9488\" },\r\n    { radius: 11, offsetX: -10, offsetY: 36, color: \"#d94d3f\" },\r\n    { radius: 11, offsetX: 10, offsetY: 36, color: \"#d94d3f\" }\r\n  ]\r\n};\r\n\r\nconst ragdolls = [];\r\n\r\nfunction spawnRagdoll(kind, originX, originY, facing = 1, baseVx = 0, baseVy = 0) {\r\n  const blueprint = RAGDOLL_BLUEPRINTS[kind];\r\n  if (!blueprint) {\r\n    return;\r\n  }\r\n\r\n  for (const part of blueprint) {\r\n    ragdolls.push({\r\n      x: originX + part.offsetX * facing,\r\n      y: originY + part.offsetY,\r\n      vx: baseVx + facing * (40 + Math.random() * 80) + (Math.random() - 0.5) * 60,\r\n      vy: baseVy - (80 + Math.random() * 140),\r\n      radius: part.radius,\r\n      color: part.color,\r\n      life: 1.6 + Math.random() * 0.8,\r\n      maxLife: 1.6 + Math.random() * 0.8\r\n    });\r\n  }\r\n}\r\n\r\nfunction updateRagdolls(delta, groundY) {\r\n  for (const piece of ragdolls) {\r\n    piece.life -= delta;\r\n    piece.vy += GRAVITY * delta * 0.9;\r\n    piece.x += piece.vx * delta;\r\n    piece.y += piece.vy * delta;\r\n    piece.vx *= 0.96;\r\n\r\n    if (piece.y + piece.radius >= groundY) {\r\n      piece.y = groundY - piece.radius;\r\n      piece.vy = -piece.vy * 0.35;\r\n      piece.vx *= 0.7;\r\n      if (Math.abs(piece.vy) < 20) {\r\n        piece.vy = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  for (let i = ragdolls.length - 1; i >= 0; i -= 1) {\r\n    if (ragdolls[i].life <= 0.05) {\r\n      ragdolls.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawRagdolls() {\r\n  context.save();\r\n  for (const piece of ragdolls) {\r\n    const alpha = clamp(piece.life / piece.maxLife, 0, 1);\r\n    context.globalAlpha = alpha * 0.85;\r\n    context.fillStyle = piece.color;\r\n    context.beginPath();\r\n    context.arc(piece.x, piece.y, piece.radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction getRagdolls() {\r\n  return ragdolls;\r\n}\r\n\r\nexport { spawnRagdoll, updateRagdolls, drawRagdolls, getRagdolls };\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst damagePopups = [];\r\n\r\nfunction spawnDamagePopup(x, y, value) {\r\n  damagePopups.push({\r\n    x,\r\n    y,\r\n    value,\r\n    life: 0.75,\r\n    maxLife: 0.75,\r\n    vx: (Math.random() - 0.5) * 24,\r\n    vy: -60 - Math.random() * 20\r\n  });\r\n}\r\n\r\nfunction updateDamagePopups(delta) {\r\n  for (const popup of damagePopups) {\r\n    popup.life -= delta;\r\n    popup.x += popup.vx * delta;\r\n    popup.y += popup.vy * delta;\r\n    popup.vy -= 40 * delta;\r\n  }\r\n\r\n  for (let i = damagePopups.length - 1; i >= 0; i -= 1) {\r\n    if (damagePopups[i].life <= 0) {\r\n      damagePopups.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawDamagePopups() {\r\n  context.save();\r\n  context.font = \"18px 'Segoe UI', Arial, sans-serif\";\r\n  context.textAlign = \"center\";\r\n  for (const popup of damagePopups) {\r\n    const opacity = clamp(popup.life / popup.maxLife, 0, 1);\r\n    context.fillStyle = `rgba(255, 214, 102, ${opacity})`;\r\n    context.fillText(`-${Math.round(popup.value)}`, popup.x, popup.y);\r\n  }\r\n  context.restore();\r\n}\r\n\r\nexport { spawnDamagePopup, updateDamagePopups, drawDamagePopups };\r\n","import { canvas, GROUND_Y, context } from \"../../environment/canvas.js\";\r\nimport { stickman, trainingDummy, enemies, getTotalHeight } from \"../../state/entities.js\";\r\nimport { spawnProjectile } from \"../combat/projectiles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst turrets = [];\r\n\r\nfunction createTurret(config, facing) {\r\n  const height = config.height ?? 54;\r\n  const spawnOffset = config.spawnOffset ?? { x: 64, y: 0 };\r\n  const baseHeight = getTotalHeight(stickman.currentPose ?? null) || 0;\r\n  const spawnX = clamp(stickman.x + facing * (spawnOffset.x ?? 64), 40, canvas.width - 40);\r\n  const spawnYBase = stickman.y + baseHeight;\r\n  const spawnY = Math.min(spawnYBase + (spawnOffset.y ?? 0), GROUND_Y);\r\n  const y = Math.min(GROUND_Y - height, spawnY - height);\r\n\r\n  return {\r\n    id: `turret-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`,\r\n    x: spawnX,\r\n    y,\r\n    height,\r\n    facing,\r\n    range: config.range ?? 260,\r\n    fireInterval: Math.max(0.1, config.fireInterval ?? 0.6),\r\n    fireTimer: 0.1,\r\n    duration: config.duration ?? 8,\r\n    maxDuration: config.duration ?? 8,\r\n    projectile: {\r\n      speed: config.projectile?.speed ?? 520,\r\n      radius: config.projectile?.radius ?? 5,\r\n      damage: config.projectile?.damage ?? 10,\r\n      knockback: config.projectile?.knockback ?? 70,\r\n      lifetime: config.projectile?.lifetime ?? 1.1,\r\n      color: config.projectile?.color ?? \"#9ae9ff\"\r\n    },\r\n    baseColor: config.baseColor ?? \"#7a8bff\",\r\n    headColor: config.headColor ?? \"#cfd8ff\"\r\n  };\r\n}\r\n\r\nfunction deployTurret(config) {\r\n  const facing = stickman.facing || 1;\r\n  const turret = createTurret(config, facing);\r\n  const maxActive = Math.max(1, config.maxActive ?? 1);\r\n  if (turrets.length >= maxActive) {\r\n    turrets.shift();\r\n  }\r\n  turrets.push(turret);\r\n}\r\n\r\nfunction getTargets() {\r\n  const targets = [];\r\n  if (trainingDummy.health > 0) {\r\n    targets.push({\r\n      id: trainingDummy.id,\r\n      x: trainingDummy.x,\r\n      y: trainingDummy.y + trainingDummy.height * 0.5\r\n    });\r\n  }\r\n  for (const enemy of enemies) {\r\n    if (enemy.health > 0) {\r\n      targets.push({\r\n        id: enemy.id,\r\n        x: enemy.x,\r\n        y: enemy.y + enemy.height * 0.5,\r\n        ref: enemy\r\n      });\r\n    }\r\n  }\r\n  return targets;\r\n}\r\n\r\nfunction acquireTarget(turret) {\r\n  const targets = getTargets();\r\n  let closest = null;\r\n  let closestDistSq = Infinity;\r\n  for (const target of targets) {\r\n    const dx = target.x - turret.x;\r\n    const dy = target.y - (turret.y + turret.height * 0.4);\r\n    const distSq = dx * dx + dy * dy;\r\n    if (distSq <= turret.range * turret.range && distSq < closestDistSq) {\r\n      closest = target;\r\n      closestDistSq = distSq;\r\n    }\r\n  }\r\n  return closest;\r\n}\r\n\r\nfunction fireTurret(turret, target) {\r\n  const originX = turret.x;\r\n  const originY = turret.y + turret.height * 0.35;\r\n  const dx = target.x - originX;\r\n  const dy = target.y - originY;\r\n  turret.facing = Math.sign(dx) || turret.facing;\r\n  const distance = Math.hypot(dx, dy) || 1;\r\n  const speed = turret.projectile.speed;\r\n  const vx = (dx / distance) * speed;\r\n  const vy = (dy / distance) * speed;\r\n  spawnProjectile({\r\n    x: originX,\r\n    y: originY,\r\n    vx,\r\n    vy,\r\n    radius: turret.projectile.radius,\r\n    lifetime: turret.projectile.lifetime,\r\n    color: turret.projectile.color,\r\n    damage: turret.projectile.damage,\r\n    knockback: turret.projectile.knockback,\r\n    facing: Math.sign(vx) || 1,\r\n    gravityFactor: 0\r\n  });\r\n  turret.fireTimer = turret.fireInterval;\r\n}\r\n\r\nfunction updateTurrets(delta) {\r\n  for (const turret of turrets) {\r\n    turret.duration -= delta;\r\n    turret.fireTimer -= delta;\r\n    const target = acquireTarget(turret);\r\n    if (target && turret.fireTimer <= 0) {\r\n      fireTurret(turret, target);\r\n    }\r\n  }\r\n  for (let i = turrets.length - 1; i >= 0; i -= 1) {\r\n    if (turrets[i].duration <= 0) {\r\n      turrets.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawTurrets() {\r\n  if (turrets.length === 0) {\r\n    return;\r\n  }\r\n  context.save();\r\n  for (const turret of turrets) {\r\n    const baseWidth = 40;\r\n    const baseHeight = turret.height * 0.4;\r\n    const remainingRatio = clamp(turret.duration / (turret.maxDuration || 1), 0, 1);\r\n    context.fillStyle = turret.baseColor;\r\n    context.fillRect(turret.x - baseWidth * 0.5, turret.y + turret.height - baseHeight, baseWidth, baseHeight);\r\n\r\n    const headHeight = turret.height * 0.6;\r\n    context.fillStyle = turret.headColor;\r\n    context.fillRect(turret.x - baseWidth * 0.3, turret.y, baseWidth * 0.6, headHeight);\r\n\r\n    context.fillStyle = \"#ffd66d\";\r\n    context.fillRect(turret.x - baseWidth * 0.3, turret.y - 6, baseWidth * 0.6 * remainingRatio, 4);\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction clearTurrets() {\r\n  turrets.length = 0;\r\n}\r\n\r\nfunction getTurretCount() {\r\n  return turrets.length;\r\n}\r\n\r\nexport { turrets, deployTurret, updateTurrets, drawTurrets, clearTurrets, getTurretCount };\r\n","import { canvas, GROUND_Y, context } from \"../../environment/canvas.js\";\r\nimport { stickman } from \"../../state/entities.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst grappleState = {\r\n  active: false,\r\n  tetherLength: 0,\r\n  maxLength: 0,\r\n  targetX: 0,\r\n  targetY: 0,\r\n  duration: 0,\r\n  retracting: false,\r\n  cooldown: 0,\r\n  color: \"#8cf1ff\",\r\n  travelSpeed: 860,\r\n  pullSpeed: 740\r\n};\r\n\r\nfunction canGrapple(config) {\r\n  if (grappleState.active) {\r\n    return false;\r\n  }\r\n  if ((stickman.gadgetCooldown ?? 0) > 0) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction startGrapple(config) {\r\n  const clampRect = config.clamp ?? { left: 80, right: canvas.width - 80 };\r\n  const apex = config.apex ?? { y: GROUND_Y - 280 };\r\n  const launchLength = config.maxLength ?? 320;\r\n  const facing = stickman.facing || 1;\r\n  const anchorX = clamp(stickman.x + facing * launchLength, clampRect.left, clampRect.right);\r\n  const anchorY = Math.min(apex.y ?? (GROUND_Y - 240), stickman.y - (config.maxRise ?? 260));\r\n\r\n  grappleState.active = true;\r\n  grappleState.retracting = false;\r\n  grappleState.tetherLength = 0;\r\n  grappleState.maxLength = Math.hypot(anchorX - stickman.x, anchorY - stickman.y);\r\n  grappleState.targetX = anchorX;\r\n  grappleState.targetY = anchorY;\r\n  grappleState.duration = config.duration ?? 0.65;\r\n  grappleState.cooldown = config.cooldownSeconds ?? 1.6;\r\n  grappleState.color = config.color ?? \"#8cf1ff\";\r\n  grappleState.travelSpeed = config.travelSpeed ?? 860;\r\n  grappleState.pullSpeed = config.pullSpeed ?? 740;\r\n  stickman.gadgetCooldown = grappleState.cooldown;\r\n}\r\n\r\nfunction updateGrapple(delta) {\r\n  if (!grappleState.active) {\r\n    return;\r\n  }\r\n\r\n  const travelSpeed = grappleState.travelSpeed ?? 860;\r\n  const pullSpeed = grappleState.pullSpeed ?? 740;\r\n  const progressSpeed = (grappleState.retracting ? pullSpeed : travelSpeed) * delta;\r\n\r\n  if (!grappleState.retracting) {\r\n    grappleState.tetherLength += progressSpeed;\r\n    if (grappleState.tetherLength >= grappleState.maxLength) {\r\n      grappleState.tetherLength = grappleState.maxLength;\r\n      grappleState.retracting = true;\r\n    }\r\n  } else {\r\n    grappleState.duration -= delta;\r\n    const dx = grappleState.targetX - stickman.x;\r\n    const dy = grappleState.targetY - stickman.y;\r\n    const distance = Math.hypot(dx, dy);\r\n\r\n    if (distance > 12) {\r\n      const step = Math.min(distance, pullSpeed * delta);\r\n      stickman.vx = (dx / distance) * step / delta;\r\n      stickman.vy = (dy / distance) * step / delta;\r\n      stickman.x += (dx / distance) * step;\r\n      stickman.y += (dy / distance) * step;\r\n    }\r\n\r\n    grappleState.tetherLength = Math.max(0, grappleState.tetherLength - progressSpeed);\r\n    if (grappleState.duration <= 0 || grappleState.tetherLength <= 0) {\r\n      endGrapple();\r\n    }\r\n  }\r\n}\r\n\r\nfunction endGrapple() {\r\n  grappleState.active = false;\r\n  grappleState.retracting = false;\r\n  grappleState.tetherLength = 0;\r\n  grappleState.maxLength = 0;\r\n}\r\n\r\nfunction clearGrapple() {\r\n  endGrapple();\r\n}\r\n\r\nfunction updateGrappleState(delta) {\r\n  if (grappleState.cooldown > 0) {\r\n    grappleState.cooldown = Math.max(0, grappleState.cooldown - delta);\r\n  }\r\n  updateGrapple(delta);\r\n}\r\n\r\nfunction drawGrapple() {\r\n  if (!grappleState.active) {\r\n    return;\r\n  }\r\n  context.save();\r\n  context.strokeStyle = grappleState.color;\r\n  context.lineWidth = 3;\r\n  context.beginPath();\r\n  context.moveTo(stickman.x, stickman.y);\r\n  const ratio = grappleState.tetherLength / (grappleState.maxLength || 1);\r\n  const currentX = stickman.x + (grappleState.targetX - stickman.x) * ratio;\r\n  const currentY = stickman.y + (grappleState.targetY - stickman.y) * ratio;\r\n  context.lineTo(currentX, currentY);\r\n  context.stroke();\r\n  context.restore();\r\n}\r\n\r\nfunction hasActiveGrapple() {\r\n  return grappleState.active;\r\n}\r\n\r\nexport { canGrapple, startGrapple, updateGrappleState, drawGrapple, hasActiveGrapple, clearGrapple };\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { stickman } from \"../../state/entities.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst shieldState = {\r\n  active: false,\r\n  strength: 0,\r\n  maxStrength: 0,\r\n  duration: 0,\r\n  maxDuration: 0,\r\n  radius: 90,\r\n  color: \"#7cd6ff\",\r\n  flashTimer: 0\r\n};\r\n\r\nfunction getShieldCenter() {\r\n  const poseHeight = (stickman.currentPose?.headRadius ?? 16) * 2 + (stickman.currentPose?.bodyLength ?? 34) + (stickman.currentPose?.legLength ?? 36);\r\n  return {\r\n    x: stickman.x,\r\n    y: stickman.y + poseHeight * 0.5\r\n  };\r\n}\r\n\r\nfunction dispatchShieldEvent(type, detail = {}) {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.dispatchEvent(new CustomEvent(type, { detail }));\r\n}\r\n\r\nfunction activateShield(config = {}) {\r\n  const strength = config.strength ?? 90;\r\n  if (shieldState.active) {\r\n    return false;\r\n  }\r\n  shieldState.active = true;\r\n  shieldState.strength = strength;\r\n  shieldState.maxStrength = strength;\r\n  shieldState.duration = config.duration ?? 6;\r\n  shieldState.maxDuration = shieldState.duration;\r\n  shieldState.radius = config.radius ?? 96;\r\n  shieldState.color = config.color ?? \"#7cd6ff\";\r\n  shieldState.flashTimer = 0;\r\n  stickman.gadgetCooldown = config.cooldownSeconds ?? 4.5;\r\n  return true;\r\n}\r\n\r\nfunction updateShield(delta) {\r\n  if (!shieldState.active) {\r\n    return;\r\n  }\r\n  shieldState.duration -= delta;\r\n  shieldState.flashTimer = Math.max(0, shieldState.flashTimer - delta);\r\n  if (shieldState.duration <= 0) {\r\n    deactivateShield(\"expired\");\r\n  } else if (shieldState.strength <= 0) {\r\n    const center = getShieldCenter();\r\n    dispatchShieldEvent(\"shield:shatter\", {\r\n      reason: \"decayed\",\r\n      center,\r\n      maxStrength: shieldState.maxStrength,\r\n      radius: shieldState.radius,\r\n    });\r\n    deactivateShield(\"shatter\");\r\n  }\r\n}\r\n\r\nfunction deactivateShield(reason = \"expired\") {\r\n  if (!shieldState.active) {\r\n    return;\r\n  }\r\n  const detail = {\r\n    reason,\r\n    remainingStrength: shieldState.strength,\r\n    maxStrength: shieldState.maxStrength,\r\n    duration: shieldState.duration,\r\n    maxDuration: shieldState.maxDuration,\r\n    center: getShieldCenter(),\r\n    radius: shieldState.radius\r\n  };\r\n  shieldState.active = false;\r\n  shieldState.strength = 0;\r\n  shieldState.duration = 0;\r\n  shieldState.flashTimer = 0;\r\n  dispatchShieldEvent(\"shield:end\", detail);\r\n}\r\n\r\nfunction absorbShieldHit(hit) {\r\n  if (!shieldState.active) {\r\n    return hit;\r\n  }\r\n  const damage = hit.damage ?? 0;\r\n  if (damage <= 0) {\r\n    return hit;\r\n  }\r\n  const absorb = Math.min(damage, shieldState.strength);\r\n  shieldState.strength -= absorb;\r\n  shieldState.flashTimer = Math.max(shieldState.flashTimer, 0.2);\r\n\r\n  const center = getShieldCenter();\r\n  dispatchShieldEvent(\"shield:hit\", {\r\n    absorb,\r\n    remainingStrength: Math.max(0, shieldState.strength),\r\n    maxStrength: shieldState.maxStrength,\r\n    duration: shieldState.duration,\r\n    maxDuration: shieldState.maxDuration,\r\n    center,\r\n    radius: shieldState.radius,\r\n  });\r\n\r\n  const residualDamage = damage - absorb;\r\n  const result = {\r\n    ...hit,\r\n    damage: residualDamage\r\n  };\r\n  if (residualDamage <= 0) {\r\n    result.damage = 0;\r\n    result.knockback = (hit.knockback ?? 0) * 0.25;\r\n    result.launch = (hit.launch ?? 0) * 0.25;\r\n  }\r\n  if (shieldState.strength <= 0) {\r\n    dispatchShieldEvent(\"shield:shatter\", {\r\n      reason: \"damage\",\r\n      absorb,\r\n      center,\r\n      maxStrength: shieldState.maxStrength,\r\n      radius: shieldState.radius\r\n    });\r\n    deactivateShield(\"shatter\");\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction drawShield() {\r\n  if (!shieldState.active) {\r\n    return;\r\n  }\r\n  context.save();\r\n  const alpha = clamp(shieldState.flashTimer > 0 ? 0.45 : 0.25 + shieldState.strength / Math.max(1, shieldState.maxStrength) * 0.35, 0.15, 0.6);\r\n  context.strokeStyle = shieldState.color;\r\n  context.lineWidth = 4;\r\n  context.globalAlpha = alpha;\r\n  context.beginPath();\r\n  const center = getShieldCenter();\r\n  context.arc(center.x, center.y, shieldState.radius, 0, Math.PI * 2);\r\n  context.stroke();\r\n  context.globalAlpha = alpha * 0.4;\r\n  context.fillStyle = shieldState.color;\r\n  context.beginPath();\r\n  context.arc(center.x, center.y, shieldState.radius * 0.9, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction clearShield() {\r\n  deactivateShield(\"cleared\");\r\n}\r\n\r\nfunction getShieldStatus() {\r\n  return {\r\n    active: shieldState.active,\r\n    strength: shieldState.strength,\r\n    maxStrength: shieldState.maxStrength,\r\n    duration: shieldState.duration,\r\n    maxDuration: shieldState.maxDuration\r\n  };\r\n}\r\n\r\nexport { activateShield, updateShield, drawShield, clearShield, absorbShieldHit, getShieldStatus };\r\n\r\n","import { stickman } from \"../../state/entities.js\";\r\nimport { deployTurret, updateTurrets, drawTurrets, clearTurrets, getTurretCount } from \"./turret.js\";\r\nimport { canGrapple, startGrapple, updateGrappleState, drawGrapple, hasActiveGrapple, clearGrapple } from \"./grapple.js\";\r\nimport { activateShield, updateShield, drawShield, clearShield, absorbShieldHit, getShieldStatus } from \"./shield.js\";\r\n\r\nfunction deployGadget(weapon) {\r\n  const gadgetConfig = weapon?.gadget;\r\n  if (!gadgetConfig) {\r\n    return false;\r\n  }\r\n  const cooldown = stickman.gadgetCooldown ?? 0;\r\n  if (cooldown > 0) {\r\n    return false;\r\n  }\r\n\r\n  const type = gadgetConfig.type ?? \"turret\";\r\n  switch (type) {\r\n    case \"turret\":\r\n      deployTurret(gadgetConfig);\r\n      stickman.gadgetCooldown = gadgetConfig.cooldownSeconds ?? 2.5;\r\n      return true;\r\n    case \"grapple\":\r\n      if (!canGrapple(gadgetConfig)) {\r\n        return false;\r\n      }\r\n      startGrapple(gadgetConfig);\r\n      return true;\r\n    case \"shield\":\r\n      activateShield(gadgetConfig);\r\n      return true;\r\n    default:\r\n      return false;\r\n  }\r\n}\r\n\r\nfunction updateGadgets(delta) {\r\n  updateTurrets(delta);\r\n  updateShield(delta);\r\n}\r\n\r\nfunction updateGadgetMovement(delta) {\r\n  updateGrappleState(delta);\r\n}\r\n\r\nfunction drawGadgets() {\r\n  drawShield();\r\n  drawTurrets();\r\n  drawGrapple();\r\n}\r\n\r\nfunction clearGadgets() {\r\n  clearTurrets();\r\n  clearShield();\r\n  clearGrapple();\r\n}\r\n\r\nfunction getGadgetStatus() {\r\n  const shield = getShieldStatus();\r\n  return {\r\n    turretCount: getTurretCount(),\r\n    grappleActive: hasActiveGrapple(),\r\n    shieldActive: shield.active,\r\n    shieldStrength: shield.strength,\r\n    shieldMaxStrength: shield.maxStrength,\r\n    gadgetCooldown: stickman.gadgetCooldown ?? 0\r\n  };\r\n}\r\n\r\nexport { deployGadget, updateGadgets, updateGadgetMovement, drawGadgets, clearGadgets, getGadgetStatus, absorbShieldHit };\r\n","import { stickman, trainingDummy } from \"../../state/entities.js\";\r\nimport { spawnRagdoll } from \"../effects/ragdoll.js\";\r\nimport { spawnDamagePopup } from \"../effects/damage.js\";\r\nimport { absorbShieldHit } from \"../gadgets/index.js\";\r\n\r\nfunction applyDamageToDummy(hit) {\r\n  const damage = hit.damage ?? 0;\r\n  const knockback = hit.knockback ?? 0;\r\n\r\n  trainingDummy.health = Math.max(0, trainingDummy.health - damage);\r\n  trainingDummy.flashTimer = 0.18;\r\n  trainingDummy.shakeTimer = Math.min(0.4, trainingDummy.shakeTimer + 0.22);\r\n  trainingDummy.shakeMagnitude = Math.min(14, trainingDummy.shakeMagnitude + knockback / 60);\r\n\r\n  const popupY = trainingDummy.y + trainingDummy.height * 0.55 - trainingDummy.radius - 12;\r\n  spawnDamagePopup(trainingDummy.x, popupY, damage);\r\n\r\n  if (trainingDummy.health === 0 && trainingDummy.respawnTimer <= 0) {\r\n    trainingDummy.respawnTimer = 2.5;\r\n  }\r\n}\r\n\r\nfunction applyDamageToEnemy(enemy, hit) {\r\n  if (enemy.health <= 0 || enemy.invulnerability > 0) {\r\n    return;\r\n  }\r\n\r\n  const damage = hit.damage ?? 0;\r\n  const knockback = hit.knockback ?? 0;\r\n  const launch = hit.launch ?? 0;\r\n  const facing = hit.facing ?? stickman.facing;\r\n\r\n  enemy.health = Math.max(0, enemy.health - damage);\r\n  enemy.flashTimer = 0.18;\r\n  enemy.shakeTimer = Math.min(0.5, enemy.shakeTimer + 0.24);\r\n  enemy.shakeMagnitude = Math.min(18, enemy.shakeMagnitude + knockback / 55);\r\n  enemy.vx += knockback * facing * 0.35;\r\n  if (launch > 0) {\r\n    enemy.vy -= launch * 0.3;\r\n  }\r\n\r\n  spawnDamagePopup(enemy.x + enemy.facing * 14, enemy.y - 14, damage);\r\n  enemy.invulnerability = 0.15;\r\n\r\n  if (enemy.health === 0) {\r\n    if (enemy.respawnTimer <= 0) {\r\n      spawnRagdoll(\"enemy\", enemy.x, enemy.y, facing, enemy.vx, enemy.vy);\r\n    }\r\n    enemy.state = \"defeated\";\r\n    enemy.attackCooldown = 1.2;\r\n    enemy.respawnTimer = 3;\r\n  }\r\n}\r\n\r\nfunction applyDamageToPlayer(enemy, hit) {\r\n  if (stickman.invulnerability > 0 || stickman.health <= 0) {\r\n    return;\r\n  }\r\n\r\n  const baseDamage = hit?.damage ?? enemy.attackDamage ?? 0;\r\n  const baseKnockback = hit?.knockback ?? enemy.attackKnockback ?? 0;\r\n  const baseLaunch = hit?.launch ?? enemy.attackLaunch ?? 0;\r\n  const facing = hit?.facing ?? enemy.facing ?? 1;\r\n\r\n  let adjustedHit = absorbShieldHit({\r\n    damage: baseDamage,\r\n    knockback: baseKnockback,\r\n    launch: baseLaunch,\r\n    facing\r\n  });\r\n\r\n  const finalDamage = adjustedHit?.damage ?? 0;\r\n  const finalKnockback = adjustedHit?.knockback ?? baseKnockback;\r\n  const finalLaunch = adjustedHit?.launch ?? baseLaunch;\r\n  const finalFacing = adjustedHit?.facing ?? facing;\r\n\r\n  if (finalDamage > 0) {\r\n    stickman.health = Math.max(0, stickman.health - finalDamage);\r\n    stickman.invulnerability = 0.6;\r\n  } else {\r\n    stickman.invulnerability = Math.max(stickman.invulnerability, 0.2);\r\n  }\r\n\r\n  stickman.vx += finalKnockback * finalFacing;\r\n  stickman.vy += finalLaunch;\r\n  spawnDamagePopup(stickman.x, stickman.y + 10, Math.max(0, Math.round(finalDamage)));\r\n\r\n  if (finalDamage > 0 && stickman.health === 0 && stickman.deadTimer <= 0) {\r\n    stickman.deadTimer = 2.6;\r\n    stickman.attacking = false;\r\n    stickman.activeHitboxes = [];\r\n    stickman.comboWindowOpen = false;\r\n    stickman.attackIndex = -1;\r\n    stickman.rolling = false;\r\n    spawnRagdoll(\"player\", stickman.x, stickman.y, -finalFacing, stickman.vx, stickman.vy);\r\n  }\r\n}\r\n\r\nexport { applyDamageToDummy, applyDamageToEnemy, applyDamageToPlayer };\r\n","import { GROUND_Y } from \"../environment/canvas.js\";\r\n\r\nconst DESTRUCTIBLE_TEMPLATES = {\r\n  concreteBarrier: {\r\n    maxHealth: 600,\r\n    width: 180,\r\n    height: 110,\r\n    rubbleHeight: 34,\r\n    material: \"concrete\",\r\n    bodyColor: \"#4c5564\",\r\n    edgeColor: \"#2a313c\",\r\n    accentColor: \"#9aa4b4\",\r\n    damageHighlight: \"#d5dde8\",\r\n    debrisColor: \"#3a424f\",\r\n    smokeDuration: 2.4,\r\n    shakeFactor: 16\r\n  },\r\n  streetCar: {\r\n    maxHealth: 420,\r\n    width: 168,\r\n    height: 90,\r\n    rubbleHeight: 38,\r\n    material: \"vehicle\",\r\n    bodyColor: \"#ba3c38\",\r\n    edgeColor: \"#1c1d25\",\r\n    accentColor: \"#f4f7fb\",\r\n    glassColor: \"#4ac3ff\",\r\n    damageHighlight: \"#ffe5dc\",\r\n    debrisColor: \"#5a1f1a\",\r\n    smokeDuration: 3.4,\r\n    shakeFactor: 22,\r\n    deathBlast: {\r\n      radius: 140,\r\n      maxDamage: 160,\r\n      knockback: 320,\r\n      minDamageRatio: 0.32\r\n    }\r\n  },\r\n  fuelBarrelCluster: {\r\n    maxHealth: 220,\r\n    width: 96,\r\n    height: 96,\r\n    rubbleHeight: 28,\r\n    material: \"volatile\",\r\n    bodyColor: \"#c0671c\",\r\n    edgeColor: \"#2f1a08\",\r\n    accentColor: \"#ffe7ba\",\r\n    stripeColor: \"#ffd45f\",\r\n    damageHighlight: \"#ffd4a1\",\r\n    debrisColor: \"#6e2c05\",\r\n    smokeDuration: 4.2,\r\n    shakeFactor: 26,\r\n    deathBlast: {\r\n      radius: 180,\r\n      maxDamage: 240,\r\n      knockback: 400,\r\n      minDamageRatio: 0.4\r\n    }\r\n  }\r\n};\r\n\r\nconst groundLevel = GROUND_Y;\r\nconst streetTop = GROUND_Y - 26;\r\n\r\nconst DESTRUCTIBLE_SPAWNS = [\r\n  { id: \"neo-barrier-west\", type: \"concreteBarrier\", x: 260, baseY: groundLevel },\r\n  { id: \"neo-barrier-east\", type: \"concreteBarrier\", x: 1140, baseY: groundLevel },\r\n  { id: \"neo-car-market\", type: \"streetCar\", x: 620, baseY: groundLevel, facing: -1 },\r\n  { id: \"neo-car-docks\", type: \"streetCar\", x: 1340, baseY: groundLevel, facing: 1 },\r\n  { id: \"neo-barrels-market\", type: \"fuelBarrelCluster\", x: 440, baseY: streetTop },\r\n  { id: \"neo-barrels-rail\", type: \"fuelBarrelCluster\", x: 920, baseY: streetTop }\r\n];\r\n\r\nexport { DESTRUCTIBLE_TEMPLATES, DESTRUCTIBLE_SPAWNS };\r\n","import { DESTRUCTIBLE_TEMPLATES, DESTRUCTIBLE_SPAWNS } from \"../config/destructibles.js\";\r\n\r\nfunction createDestructibleFromSpawn(spawn) {\r\n  const template = DESTRUCTIBLE_TEMPLATES[spawn.type];\r\n  if (!template) {\r\n    throw new Error(`Unknown destructible template: ${spawn.type}`);\r\n  }\r\n\r\n  const width = spawn.width ?? template.width;\r\n  const height = spawn.height ?? template.height;\r\n\r\n  return {\r\n    id: spawn.id,\r\n    type: spawn.type,\r\n    template,\r\n    x: spawn.x,\r\n    y: spawn.baseY,\r\n    width,\r\n    height,\r\n    halfWidth: width / 2,\r\n    health: template.maxHealth,\r\n    maxHealth: template.maxHealth,\r\n    destroyed: false,\r\n    flashTimer: 0,\r\n    shakeTimer: 0,\r\n    shakeMagnitude: 0,\r\n    smokeTimer: 0,\r\n    rubbleLevel: 0,\r\n    deathTriggered: false,\r\n    facing: spawn.facing ?? 1,\r\n    spawnConfig: { ...spawn }\r\n  };\r\n}\r\n\r\nfunction createInitialState() {\r\n  return DESTRUCTIBLE_SPAWNS.map((spawn) => createDestructibleFromSpawn(spawn));\r\n}\r\n\r\nconst destructibles = createInitialState();\r\n\r\nfunction resetDestructibles() {\r\n  destructibles.length = 0;\r\n  const fresh = createInitialState();\r\n  for (const item of fresh) {\r\n    destructibles.push(item);\r\n  }\r\n}\r\n\r\nfunction getDestructibles() {\r\n  return destructibles;\r\n}\r\n\r\nfunction getDestructibleById(id) {\r\n  return destructibles.find((item) => item.id === id) ?? null;\r\n}\r\n\r\nexport { destructibles, getDestructibles, getDestructibleById, resetDestructibles };\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst particles = [];\r\nconst rings = [];\r\nlet listenersAttached = false;\r\n\r\nfunction spawnRingBurst(options = {}) {\r\n  const ttl = options.ttl ?? 0.4;\r\n  const ring = {\r\n    x: options.x ?? 0,\r\n    y: options.y ?? 0,\r\n    startRadius: options.startRadius ?? 70,\r\n    endRadius: options.endRadius ?? 140,\r\n    color: options.color ?? \"#ffffff\",\r\n    maxTtl: ttl,\r\n    ttl,\r\n    lineWidth: options.lineWidth ?? 5\r\n  };\r\n  rings.push(ring);\r\n  return ring;\r\n}\r\n\r\nfunction spawnMuzzleParticles(detail = {}) {\r\n  const count = 6;\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const facing = detail.facing ?? 1;\r\n  for (let i = 0; i < count; i += 1) {\r\n    const speed = 140 + Math.random() * 120;\r\n    const angle = (Math.random() * 0.6 - 0.3) + (facing > 0 ? 0 : Math.PI);\r\n    const vx = Math.cos(angle) * speed;\r\n    const vy = Math.sin(angle) * speed;\r\n    const ttl = 0.18 + Math.random() * 0.08;\r\n    particles.push({\r\n      type: \"spark\",\r\n      x: baseX,\r\n      y: baseY,\r\n      vx,\r\n      vy,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 4 + Math.random() * 3,\r\n      color: \"#ffdd9a\"\r\n    });\r\n  }\r\n}\r\n\r\nfunction spawnShieldRing(detail = {}, config = {}) {\r\n  const center = detail.center ?? { x: detail.x ?? 0, y: detail.y ?? 0 };\r\n  return spawnRingBurst({\r\n    x: center.x,\r\n    y: center.y,\r\n    ttl: config.ttl ?? 0.4,\r\n    startRadius: config.startRadius ?? (detail.radius ?? 70),\r\n    endRadius: config.endRadius ?? (detail.radius ?? 70) * 1.25,\r\n    color: config.color ?? \"#7cd6ff\",\r\n    lineWidth: config.lineWidth ?? 5\r\n  });\r\n}\r\n\r\nfunction spawnShieldHitParticles(detail = {}) {\r\n  const center = detail.center ?? { x: 0, y: 0 };\r\n  for (let i = 0; i < 9; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 90 + Math.random() * 150;\r\n    const vx = Math.cos(angle) * speed;\r\n    const vy = Math.sin(angle) * speed;\r\n    const ttl = 0.3 + Math.random() * 0.2;\r\n    particles.push({\r\n      type: \"shield\",\r\n      x: center.x,\r\n      y: center.y,\r\n      vx,\r\n      vy,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 6 + Math.random() * 6,\r\n      color: \"#9be9ff\"\r\n    });\r\n  }\r\n  spawnShieldRing(detail, {\r\n    ttl: 0.35,\r\n    startRadius: (detail.radius ?? 72) * 0.75,\r\n    endRadius: (detail.radius ?? 72) * 1.15,\r\n    lineWidth: 4,\r\n    color: \"#a9f0ff\"\r\n  });\r\n}\r\n\r\nfunction spawnShieldShatter(detail = {}) {\r\n  spawnShieldRing(detail, {\r\n    ttl: 0.55,\r\n    startRadius: (detail.radius ?? 96) * 0.9,\r\n    endRadius: (detail.radius ?? 96) * 1.6,\r\n    lineWidth: 7,\r\n    color: \"#7cd6ff\"\r\n  });\r\n  spawnShieldHitParticles({ center: detail.center, radius: detail.radius ?? 96 });\r\n}\r\n\r\nfunction spawnDestructibleHitParticles(detail = {}) {\r\n  const material = detail.material ?? \"generic\";\r\n  const paletteMap = {\r\n    concrete: [\"#dfe6f2\", \"#b9c3d0\", \"#6c7584\"],\r\n    vehicle: [\"#ffd6c8\", \"#ff9a82\", \"#3a1a1a\"],\r\n    volatile: [\"#ffd38a\", \"#ff9c3b\", \"#6e2c05\"],\r\n    generic: [\"#f2f5ff\", \"#c9d0de\"]\r\n  };\r\n  const palette = paletteMap[material] ?? paletteMap.generic;\r\n  const maxHealth = Math.max(1, detail.maxHealth ?? detail.health ?? 1);\r\n  const remaining = Math.max(0, Math.min(maxHealth, detail.health ?? maxHealth));\r\n  const intensity = clamp(1 - remaining / maxHealth, 0, 1);\r\n  const count = Math.max(6, Math.round(6 + intensity * 6));\r\n  const baseSpeed = 160 + intensity * 200;\r\n  for (let i = 0; i < count; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = baseSpeed * (0.45 + Math.random() * 0.65);\r\n    particles.push({\r\n      type: \"debris\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      vx: Math.cos(angle) * speed,\r\n      vy: Math.sin(angle) * speed * 0.7 - 50,\r\n      ttl: 0.45 + Math.random() * 0.3,\r\n      maxTtl: 0.45 + Math.random() * 0.3,\r\n      radius: 3 + Math.random() * 4,\r\n      color: palette[i % palette.length]\r\n    });\r\n  }\r\n}\r\n\r\nfunction ensureListeners() {\r\n  if (listenersAttached || typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.addEventListener(\"weapon:muzzle-flash\", (event) => {\r\n    spawnMuzzleParticles(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"shield:hit\", (event) => {\r\n    spawnShieldHitParticles(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"shield:shatter\", (event) => {\r\n    spawnShieldShatter(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"throwable:explosion\", (event) => {\r\n    spawnExplosionParticles(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"throwable:flash-burst\", (event) => {\r\n    spawnFlashBurst(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"throwable:smoke-spawn\", (event) => {\r\n    spawnSmokePuffs(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"throwable:smoke-dissipate\", (event) => {\r\n    spawnSmokeDissipateRing(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"destructible:hit\", (event) => {\r\n    spawnDestructibleHitParticles(event?.detail ?? {});\r\n  });\r\n  listenersAttached = true;\r\n}\r\n\r\nfunction spawnExplosionParticles(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const radius = detail.radius ?? 110;\r\n  const count = 18;\r\n  for (let i = 0; i < count; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 220 + Math.random() * 220;\r\n    const ttl = 0.3 + Math.random() * 0.25;\r\n    particles.push({\r\n      type: \"ember\",\r\n      x: baseX,\r\n      y: baseY,\r\n      vx: Math.cos(angle) * speed,\r\n      vy: Math.sin(angle) * speed,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 5 + Math.random() * 4,\r\n      color: Math.random() > 0.55 ? \"#ff9c4a\" : \"#ffd56b\"\r\n    });\r\n  }\r\n  spawnRingBurst({\r\n    x: baseX,\r\n    y: baseY,\r\n    startRadius: radius * 0.45,\r\n    endRadius: radius * 1.05,\r\n    color: \"#ffb347\",\r\n    lineWidth: 6,\r\n    ttl: 0.45\r\n  });\r\n}\r\n\r\nfunction spawnExplosionDebris(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const count = detail.count ?? 14;\r\n  const radius = detail.radius ?? 120;\r\n  const speedBase = detail.speed ?? 260;\r\n  const palette = detail.palette ?? [\"#ffdd9a\", \"#f7a24a\", \"#b55628\", \"#5b4340\"];\r\n  for (let i = 0; i < count; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = speedBase * (0.45 + Math.random() * 0.65);\r\n    const tilt = (Math.random() - 0.5) * 0.6;\r\n    particles.push({\r\n      type: \"debris\",\r\n      x: baseX + Math.cos(angle) * (detail.offsetRadius ?? 0),\r\n      y: baseY + Math.sin(angle) * (detail.offsetRadius ?? 0),\r\n      vx: Math.cos(angle + tilt) * speed,\r\n      vy: Math.sin(angle + tilt) * speed * 0.7 - 60,\r\n      ttl: 0.4 + Math.random() * 0.3,\r\n      maxTtl: 0.4 + Math.random() * 0.3,\r\n      radius: 3 + Math.random() * 4,\r\n      color: palette[i % palette.length]\r\n    });\r\n  }\r\n}\r\nfunction spawnFlashBurst(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const radius = detail.radius ?? 140;\r\n  spawnRingBurst({\r\n    x: baseX,\r\n    y: baseY,\r\n    startRadius: radius * 0.6,\r\n    endRadius: radius * 1.35,\r\n    color: \"#fff6d0\",\r\n    lineWidth: 8,\r\n    ttl: 0.32\r\n  });\r\n  for (let i = 0; i < 12; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 160 + Math.random() * 140;\r\n    const ttl = 0.18 + Math.random() * 0.08;\r\n    particles.push({\r\n      type: \"flash\",\r\n      x: baseX,\r\n      y: baseY,\r\n      vx: Math.cos(angle) * speed,\r\n      vy: Math.sin(angle) * speed,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 5 + Math.random() * 3,\r\n      color: \"#fffbe0\"\r\n    });\r\n  }\r\n}\r\n\r\nfunction spawnSmokePuffs(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const radius = detail.radius ?? detail.maxRadius ?? 120;\r\n  const count = 14;\r\n  for (let i = 0; i < count; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 30 + Math.random() * 60;\r\n    const vx = Math.cos(angle) * speed * 0.4;\r\n    const vy = -40 - Math.random() * 50;\r\n    const ttl = 0.9 + Math.random() * 0.5;\r\n    particles.push({\r\n      type: \"smoke\",\r\n      x: baseX + Math.cos(angle) * radius * 0.2,\r\n      y: baseY + Math.sin(angle) * radius * 0.1,\r\n      vx,\r\n      vy,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: radius * (0.15 + Math.random() * 0.18),\r\n      color: \"#aec4d8\"\r\n    });\r\n  }\r\n  spawnRingBurst({\r\n    x: baseX,\r\n    y: baseY,\r\n    startRadius: radius * 0.5,\r\n    endRadius: radius * 1.2,\r\n    color: \"#9db8ca\",\r\n    lineWidth: 4,\r\n    ttl: 0.5\r\n  });\r\n}\r\n\r\nfunction spawnSmokeDissipateRing(detail = {}) {\r\n  spawnRingBurst({\r\n    x: detail.x ?? 0,\r\n    y: detail.y ?? 0,\r\n    startRadius: (detail.radius ?? 110) * 0.8,\r\n    endRadius: (detail.radius ?? 110) * 1.1,\r\n    color: \"#95a8b8\",\r\n    lineWidth: 3,\r\n    ttl: 0.4\r\n  });\r\n}\r\n\r\nfunction updateParticles(delta) {\r\n  ensureListeners();\r\n  for (let i = particles.length - 1; i >= 0; i -= 1) {\r\n    const p = particles[i];\r\n    p.ttl -= delta;\r\n    if (p.ttl <= 0) {\r\n      particles.splice(i, 1);\r\n      continue;\r\n    }\r\n    const life = clamp(p.ttl / p.maxTtl, 0, 1);\r\n    p.x += p.vx * delta;\r\n    p.y += p.vy * delta;\r\n    if (p.type === \"shield\") {\r\n      p.vx *= 0.88;\r\n      p.vy *= 0.88;\r\n      p.radius *= 0.96 + life * 0.04;\r\n    } else if (p.type === \"smoke\") {\r\n      p.vx *= 0.9;\r\n      p.vy = (p.vy ?? 0) * 0.9 - 24 * delta;\r\n      p.radius *= 0.995 + life * 0.02;\r\n    } else if (p.type === \"ember\") {\r\n      p.vx *= 0.94;\r\n      p.vy *= 0.94;\r\n    } else if (p.type === \"debris\") {\r\n      p.vy += 520 * delta;\r\n      p.vx *= 0.88;\r\n      p.vy *= 0.9;\r\n      p.radius *= 0.95;\r\n    } else if (p.type === \"flash\") {\r\n      p.vx *= 0.8;\r\n      p.vy *= 0.8;\r\n      p.radius *= 0.9 + life * 0.08;\r\n    } else {\r\n      p.vx *= 0.86;\r\n      p.vy *= 0.86;\r\n    }\r\n  }\r\n\r\n  for (let i = rings.length - 1; i >= 0; i -= 1) {\r\n    const ring = rings[i];\r\n    ring.ttl -= delta;\r\n    if (ring.ttl <= 0) {\r\n      rings.splice(i, 1);\r\n      continue;\r\n    }\r\n  }\r\n}\r\nfunction drawParticles() {\r\n  ensureListeners();\r\n  if (particles.length === 0 && rings.length === 0) {\r\n    return;\r\n  }\r\n\r\n  context.save();\r\n  for (const ring of rings) {\r\n    const life = clamp(ring.ttl / ring.maxTtl, 0, 1);\r\n    const progress = 1 - life;\r\n    const radius = ring.startRadius + (ring.endRadius - ring.startRadius) * progress;\r\n    context.globalAlpha = clamp(life, 0, 1) * 0.6;\r\n    context.lineWidth = ring.lineWidth;\r\n    context.strokeStyle = ring.color;\r\n    context.beginPath();\r\n    context.arc(ring.x, ring.y, radius, 0, Math.PI * 2);\r\n    context.stroke();\r\n  }\r\n\r\n  for (const particle of particles) {\r\n    const life = clamp(particle.ttl / particle.maxTtl, 0, 1);\r\n    let alpha = clamp(life, 0, 1);\r\n    if (particle.type === \"smoke\") {\r\n      alpha *= 0.55;\r\n    } else if (particle.type === \"flash\") {\r\n      alpha = 0.35 + alpha * 0.65;\r\n    } else if (particle.type === \"debris\") {\r\n      alpha = 0.5 + alpha * 0.5;\r\n    }\r\n    context.globalAlpha = alpha;\r\n    context.fillStyle = particle.color;\r\n    let sizeFactor = life;\r\n    if (particle.type === \"smoke\") {\r\n      sizeFactor = 1;\r\n    } else if (particle.type === \"debris\") {\r\n      sizeFactor = 0.6 + life * 0.4;\r\n    }\r\n    const radius = Math.max(1.2, particle.radius * sizeFactor);\r\n    context.beginPath();\r\n    context.arc(particle.x, particle.y, radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport { spawnExplosionParticles, spawnExplosionDebris, spawnDestructibleHitParticles, spawnSmokePuffs, spawnSmokeDissipateRing, spawnRingBurst, updateParticles, drawParticles };\r\n","import { stickman, trainingDummy, enemies, getTotalHeight } from \"../../state/entities.js\";\nimport { applyDamageToDummy, applyDamageToEnemy, applyDamageToPlayer } from \"./damageHandlers.js\";\nimport { clamp } from \"../utils/math.js\";\n\nfunction computeExplosionFalloff(distance, radius, minRatio = 0.25) {\n  const clampedRadius = Math.max(1, radius);\n  const falloff = clamp(1 - distance / clampedRadius, 0, 1);\n  return clamp(minRatio + falloff * (1 - minRatio), 0, 1);\n}\n\nfunction applyExplosionImpulse({\n  x,\n  y,\n  radius,\n  maxDamage = 0,\n  maxKnockback = 0,\n  minDamageRatio = 0.25,\n  selfDamageScale = 1,\n  selfKnockbackScale = 1,\n  includeTrainingDummy = true,\n  includeEnemies = true,\n  includePlayer = true\n}) {\n  const summary = {\n    dummyHit: false,\n    enemiesHit: 0,\n    playerHit: false\n  };\n\n  const damageCap = Math.max(0, maxDamage);\n  const knockbackCap = Math.max(0, maxKnockback ?? damageCap * 1.2);\n  const radiusSafe = Math.max(1, radius);\n  const minRatio = clamp(minDamageRatio, 0, 1);\n\n  if (includeTrainingDummy && trainingDummy.health > 0) {\n    const dummyX = trainingDummy.x;\n    const dummyY = trainingDummy.y + trainingDummy.height * 0.55;\n    const distance = Math.hypot(dummyX - x, dummyY - y);\n    if (distance <= radiusSafe) {\n      const ratio = computeExplosionFalloff(distance, radiusSafe, minRatio);\n      const damage = damageCap * ratio;\n      const knockback = knockbackCap * ratio;\n      const facing = dummyX >= x ? 1 : -1;\n      applyDamageToDummy({\n        damage,\n        knockback,\n        launch: knockback * 0.18,\n        facing\n      });\n      summary.dummyHit = true;\n    }\n  }\n\n  if (includeEnemies) {\n    for (const enemy of enemies) {\n      if (enemy.health <= 0) {\n        continue;\n      }\n      const enemyX = enemy.x;\n      const enemyY = enemy.y + enemy.height * 0.5;\n      const distance = Math.hypot(enemyX - x, enemyY - y);\n      if (distance > radiusSafe) {\n        continue;\n      }\n      const ratio = computeExplosionFalloff(distance, radiusSafe, minRatio);\n      const damage = damageCap * ratio;\n      const knockback = knockbackCap * ratio;\n      const facing = enemyX >= x ? 1 : -1;\n      if (damage <= 0 && knockback <= 0) {\n        continue;\n      }\n      applyDamageToEnemy(enemy, {\n        damage,\n        knockback,\n        launch: knockback * 0.24,\n        facing\n      });\n      summary.enemiesHit += 1;\n    }\n  }\n\n  if (includePlayer && stickman.health > 0) {\n    const pose = stickman.currentPose ?? { headRadius: 16, bodyLength: 34, legLength: 36 };\n    const playerHeight = getTotalHeight(pose);\n    const playerCenterY = stickman.y + playerHeight * 0.6;\n    const distance = Math.hypot(stickman.x - x, playerCenterY - y);\n    if (distance <= radiusSafe) {\n      const ratio = computeExplosionFalloff(distance, radiusSafe, minRatio);\n      const damage = Math.max(0, damageCap * ratio * selfDamageScale);\n      const knockback = knockbackCap * ratio * selfKnockbackScale;\n      const facing = stickman.x >= x ? 1 : -1;\n      if (damage > 0 || knockback > 0) {\n        applyDamageToPlayer(null, {\n          damage,\n          knockback,\n          launch: knockback * 0.25,\n          facing\n        });\n        summary.playerHit = true;\n      }\n    }\n  }\n\n  return summary;\n}\n\nexport { computeExplosionFalloff, applyExplosionImpulse };\r\n","import { destructibles, getDestructibles } from \"../../state/destructibles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { spawnExplosionParticles, spawnExplosionDebris, spawnSmokePuffs, spawnRingBurst } from \"../effects/particles.js\";\r\nimport { applyExplosionImpulse, computeExplosionFalloff } from \"../combat/explosions.js\";\r\n\r\nfunction getBounds(destructible) {\r\n  const halfWidth = destructible.halfWidth ?? destructible.width / 2;\r\n  const left = destructible.x - halfWidth;\r\n  const right = destructible.x + halfWidth;\r\n  const top = destructible.y - destructible.height;\r\n  const bottom = destructible.y;\r\n  return { left, right, top, bottom };\r\n}\r\n\r\nfunction circleIntersectsDestructible(x, y, radius, destructible) {\r\n  const { left, right, top, bottom } = getBounds(destructible);\r\n  const closestX = clamp(x, left, right);\r\n  const closestY = clamp(y, top, bottom);\r\n  const dx = x - closestX;\r\n  const dy = y - closestY;\r\n  return dx * dx + dy * dy <= radius * radius;\r\n}\r\n\r\nfunction distanceToDestructible(x, y, destructible) {\r\n  const { left, right, top, bottom } = getBounds(destructible);\r\n  const dx = Math.max(left - x, 0, x - right);\r\n  const dy = Math.max(top - y, 0, y - bottom);\r\n  return Math.hypot(dx, dy);\r\n}\r\n\r\nfunction spawnDamageEffects(destructible, hit = {}) {\r\n  if (typeof window !== \"undefined\") {\r\n    window.dispatchEvent(\r\n      new CustomEvent(\"destructible:hit\", {\r\n        detail: {\r\n          id: destructible.id,\r\n          type: destructible.type,\r\n          material: destructible.template?.material ?? \"generic\",\r\n          cause: hit.cause ?? \"impact\",\r\n          x: hit.impactX ?? destructible.x,\r\n          y: hit.impactY ?? destructible.y - destructible.height * 0.5,\r\n          health: destructible.health,\r\n          maxHealth: destructible.maxHealth\r\n        }\r\n      })\r\n    );\r\n  }\r\n}\r\n\r\nfunction triggerDestructibleDeath(destructible, hit = {}) {\r\n  const template = destructible.template;\r\n  if (!template || destructible.deathTriggered) {\r\n    return;\r\n  }\r\n  destructible.deathTriggered = true;\r\n  const centerX = hit.impactX ?? destructible.x;\r\n  const centerY = hit.impactY ?? (destructible.y - destructible.height * 0.35);\r\n\r\n  spawnExplosionParticles({\r\n    x: centerX,\r\n    y: centerY,\r\n    radius: Math.max(destructible.width, destructible.height) * 0.8\r\n  });\r\n  spawnSmokePuffs({\r\n    x: centerX,\r\n    y: centerY,\r\n    radius: Math.max(destructible.width, destructible.height),\r\n    maxRadius: (template.deathBlast?.radius ?? destructible.width * 1.2) * 0.6\r\n  });\r\n  spawnRingBurst({\r\n    x: centerX,\r\n    y: centerY,\r\n    startRadius: destructible.width * 0.35,\r\n    endRadius: destructible.width * 1.1,\r\n    color: \"#ffb347\",\r\n    ttl: 0.55,\r\n    lineWidth: 5\r\n  });\r\n\r\n  if (template.deathBlast) {\r\n    const blast = template.deathBlast;\r\n    if (typeof window !== \"undefined\") {\r\n      window.dispatchEvent(\r\n        new CustomEvent(\"destructible:explosion\", {\r\n          detail: {\r\n            id: destructible.id,\r\n            x: centerX,\r\n            y: centerY,\r\n            radius: blast.radius\r\n          }\r\n        })\r\n      );\r\n    }\r\n\r\n    applyExplosionImpulse({\r\n      x: centerX,\r\n      y: centerY,\r\n      radius: blast.radius,\r\n      maxDamage: blast.maxDamage,\r\n      maxKnockback: blast.knockback,\r\n      minDamageRatio: blast.minDamageRatio ?? 0.25\r\n    });\r\n\r\n    damageDestructiblesInRadius({\r\n      x: centerX,\r\n      y: centerY,\r\n      radius: blast.radius,\r\n      maxDamage: blast.maxDamage,\r\n      minDamageRatio: blast.minDamageRatio ?? 0.25,\r\n      sourceId: destructible.id,\r\n      cause: \"chain-explosion\"\r\n    });\r\n  }\r\n}\r\n\r\nfunction damageDestructible(destructible, hit = {}) {\r\n  if (!destructible || destructible.destroyed) {\r\n    return { applied: false, destroyed: false };\r\n  }\r\n\r\n  const template = destructible.template;\r\n  const damage = Math.max(0, hit.damage ?? 0);\r\n  if (damage <= 0) {\r\n    return { applied: false, destroyed: false };\r\n  }\r\n\r\n  const appliedDamage = Math.min(damage, destructible.health);\r\n  destructible.health = Math.max(0, destructible.health - appliedDamage);\r\n  destructible.flashTimer = 0.2;\r\n  destructible.shakeTimer = Math.min(0.45, destructible.shakeTimer + 0.18 + (appliedDamage / destructible.maxHealth) * 0.3);\r\n  const baseShake = template?.shakeFactor ?? 14;\r\n  destructible.shakeMagnitude = Math.max(destructible.shakeMagnitude * 0.6, baseShake * (0.35 + (appliedDamage / destructible.maxHealth) * 1.2));\r\n  destructible.smokeTimer = Math.min(template?.smokeDuration ?? 0, (destructible.smokeTimer ?? 0) + 0.5);\r\n  spawnDamageEffects(destructible, hit);\r\n\r\n  let destroyed = false;\r\n  if (destructible.health <= 0) {\r\n    destructible.destroyed = true;\r\n    destructible.rubbleLevel = Math.max(destructible.rubbleLevel, 0.05);\r\n    destructible.smokeTimer = template?.smokeDuration ?? 0;\r\n    triggerDestructibleDeath(destructible, hit);\r\n    destroyed = true;\r\n  }\r\n\r\n  return { applied: true, destroyed };\r\n}\r\n\r\nfunction damageDestructiblesInRadius({ x, y, radius, maxDamage, minDamageRatio = 0.25, sourceId = null, cause = \"explosion\" }) {\r\n  const damageMax = Math.max(0, maxDamage ?? 0);\r\n  if (damageMax <= 0 || radius <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  const minRatio = clamp(minDamageRatio, 0, 1);\r\n  let hits = 0;\r\n  for (const destructible of destructibles) {\r\n    if (destructible.id === sourceId || (destructible.destroyed && destructible.deathTriggered)) {\r\n      continue;\r\n    }\r\n    const distance = distanceToDestructible(x, y, destructible);\r\n    if (distance > radius) {\r\n      continue;\r\n    }\r\n    const falloff = computeExplosionFalloff(distance, radius, minRatio);\r\n    const damage = damageMax * falloff;\r\n    if (damage <= 0) {\r\n      continue;\r\n    }\r\n    const impactX = clamp(x, destructible.x - destructible.halfWidth, destructible.x + destructible.halfWidth);\r\n    const impactY = clamp(y, destructible.y - destructible.height, destructible.y);\r\n    const result = damageDestructible(destructible, { damage, cause, impactX, impactY });\r\n    if (result.applied) {\r\n      hits += 1;\r\n    }\r\n  }\r\n  return hits;\r\n}\r\n\r\nfunction handleProjectileCollision(projectile) {\r\n  for (const destructible of destructibles) {\r\n    if (destructible.destroyed) {\r\n      continue;\r\n    }\r\n    if (circleIntersectsDestructible(projectile.x, projectile.y, projectile.radius, destructible)) {\r\n      damageDestructible(destructible, {\r\n        damage: projectile.damage ?? 0,\r\n        cause: \"projectile\",\r\n        impactX: projectile.x,\r\n        impactY: projectile.y\r\n      });\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction handleHitboxCollision(hitbox) {\r\n  let hit = false;\r\n  for (const destructible of destructibles) {\r\n    if (destructible.destroyed || hitbox.hitTargets.has(destructible.id)) {\r\n      continue;\r\n    }\r\n    if (circleIntersectsDestructible(hitbox.x, hitbox.y, hitbox.radius, destructible)) {\r\n      hitbox.hitTargets.add(destructible.id);\r\n      damageDestructible(destructible, {\r\n        damage: hitbox.damage ?? 0,\r\n        cause: \"melee\",\r\n        impactX: hitbox.x,\r\n        impactY: hitbox.y\r\n      });\r\n      hit = true;\r\n    }\r\n  }\r\n  return hit;\r\n}\r\n\r\nfunction updateDestructibles(delta) {\r\n  for (const destructible of destructibles) {\r\n    destructible.flashTimer = Math.max(0, (destructible.flashTimer ?? 0) - delta);\r\n    destructible.shakeTimer = Math.max(0, (destructible.shakeTimer ?? 0) - delta);\r\n    destructible.smokeTimer = Math.max(0, (destructible.smokeTimer ?? 0) - delta);\r\n    destructible.shakeMagnitude *= destructible.shakeTimer > 0 ? 0.92 : 0.6;\r\n    if (destructible.destroyed) {\r\n      destructible.rubbleLevel = Math.min(1, (destructible.rubbleLevel ?? 0) + delta * 2.2);\r\n    } else {\r\n      destructible.rubbleLevel = Math.max(0, (destructible.rubbleLevel ?? 0) - delta * 0.8);\r\n    }\r\n  }\r\n}\r\n\r\nexport {\r\n  getDestructibles,\r\n  updateDestructibles,\r\n  damageDestructible,\r\n  damageDestructiblesInRadius,\r\n  handleProjectileCollision,\r\n  handleHitboxCollision\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { context, GROUND_Y } from \"../../environment/canvas.js\";\nimport { GRAVITY } from \"../../config/constants.js\";\nimport { trainingDummy, enemies } from \"../../state/entities.js\";\nimport { applyDamageToDummy, applyDamageToEnemy } from \"./damageHandlers.js\";\nimport { handleProjectileCollision } from \"../world/destructibles.js\";\n\nconst projectiles = [];\n\nfunction spawnProjectile({\n  x,\n  y,\n  vx,\n  vy,\n  radius = 6,\n  lifetime = 1.4,\n  color = \"#ffcf7a\",\n  damage = 0,\n  knockback = 0,\n  facing = 1,\n  gravityFactor = 0.2\n}) {\n  projectiles.push({\n    x,\n    y,\n    vx,\n    vy,\n    radius,\n    life: lifetime,\n    maxLife: lifetime,\n    color,\n    damage,\n    knockback,\n    facing,\n    gravityFactor,\n    hitTargets: new Set()\n  });\n}\n\nfunction circleOverlap(ax, ay, ar, bx, by, br) {\n  const dx = ax - bx;\n  const dy = ay - by;\n  const radii = ar + br;\n  return dx * dx + dy * dy <= radii * radii;\n}\n\nfunction updateProjectiles(delta) {\n  for (const projectile of projectiles) {\n    projectile.life -= delta;\n    projectile.vy += GRAVITY * delta * projectile.gravityFactor;\n    projectile.x += projectile.vx * delta;\n    projectile.y += projectile.vy * delta;\n\n    if (projectile.y + projectile.radius >= GROUND_Y) {\n      projectile.life = 0;\n      continue;\n    }\n\n    if (trainingDummy.health > 0 && !projectile.hitTargets.has(trainingDummy.id)) {\n      if (circleOverlap(projectile.x, projectile.y, projectile.radius, trainingDummy.x, trainingDummy.y + trainingDummy.height * 0.55, trainingDummy.radius)) {\n        projectile.hitTargets.add(trainingDummy.id);\n        applyDamageToDummy({\n          damage: projectile.damage,\n          knockback: projectile.knockback,\n          facing: projectile.facing\n        });\n        projectile.life = 0;\n        continue;\n      }\n    }\n\n    for (const enemy of enemies) {\n      if (enemy.health <= 0 || projectile.hitTargets.has(enemy.id)) {\n        continue;\n      }\n      if (circleOverlap(projectile.x, projectile.y, projectile.radius, enemy.x, enemy.y + enemy.height * 0.5, enemy.radius)) {\n        projectile.hitTargets.add(enemy.id);\n        applyDamageToEnemy(enemy, {\n          damage: projectile.damage,\n          knockback: projectile.knockback,\n          launch: 0,\n          facing: projectile.facing\n        });\n        projectile.life = 0;\n        break;\n      }\n    }\n    if (projectile.life > 0) {\n      if (handleProjectileCollision(projectile)) {\n        projectile.life = 0;\n        continue;\n      }\n    }\n  }\n\n  for (let i = projectiles.length - 1; i >= 0; i -= 1) {\n    if (projectiles[i].life <= 0) {\n      projectiles.splice(i, 1);\n    }\n  }\n}\n\nfunction drawProjectiles() {\n  if (projectiles.length === 0) {\n    return;\n  }\n  context.save();\n  context.lineWidth = 2;\n  for (const projectile of projectiles) {\n    const alpha = Math.max(0, projectile.life / projectile.maxLife);\n    context.fillStyle = `rgba(255, 200, 120, ${alpha})`;\n    context.beginPath();\n    context.arc(projectile.x, projectile.y, projectile.radius, 0, Math.PI * 2);\n    context.fill();\n  }\n  context.restore();\n}\n\nfunction clearProjectiles() {\n  projectiles.length = 0;\n}\n\nexport { spawnProjectile, updateProjectiles, drawProjectiles, clearProjectiles };\r\n\r\n","\r\nimport { context, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { GRAVITY } from \"../../config/constants.js\";\r\nimport { stickman, trainingDummy, enemies, getTotalHeight } from \"../../state/entities.js\";\r\nimport { getCurrentWeapon } from \"./weapons.js\";\r\nimport { damageDestructiblesInRadius } from \"../world/destructibles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { getElapsedTime } from \"../utils/time.js\";\r\nimport { applyExplosionImpulse } from \"./explosions.js\";\r\nimport { spawnExplosionDebris } from \"../effects/particles.js\";\r\n\r\nconst throwables = [];\r\nconst smokeClouds = [];\r\n\r\nfunction dispatchThrowableEvent(type, detail = {}) {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.dispatchEvent(new CustomEvent(type, { detail }));\r\n}\r\n\r\nfunction throwEquippedWeapon() {\r\n  const weapon = getCurrentWeapon();\r\n  if ((stickman.stunTimer ?? 0) > 0) {\r\n    return false;\r\n  }\r\n  if (!weapon || weapon.category !== \"throwable\") {\r\n    return false;\r\n  }\r\n  if (stickman.throwCooldown > 0 || stickman.health <= 0 || stickman.rolling) {\r\n    return false;\r\n  }\r\n\r\n  const config = weapon.throwable ?? {};\r\n  const facing = stickman.facing || 1;\r\n  const arc = config.arcVelocity ?? { vx: 260, vy: -420 };\r\n  const spawnOffset = config.spawnOffset ?? { x: 22, y: 12 };\r\n\r\n  stickman.throwCooldown = config.cooldownSeconds ?? 0.9;\r\n\r\n  const grenade = {\r\n    id: `grenade-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`,\r\n    x: stickman.x + facing * (spawnOffset.x ?? 22),\r\n    y: stickman.y + (spawnOffset.y ?? 12),\r\n    vx: facing * (arc.vx ?? 260),\r\n    vy: arc.vy ?? -420,\r\n    radius: config.radius ?? 16,\r\n    fuse: config.fuseSeconds ?? 1.5,\r\n    maxFuse: config.fuseSeconds ?? 1.5,\r\n    explosionRadius: config.explosionRadius ?? 120,\r\n    damage: config.damage ?? 45,\r\n    knockback: config.knockback ?? 260,\r\n    gravityFactor: config.gravityFactor ?? 0.5,\r\n    bounciness: clamp(config.bounciness ?? 0.45, 0, 0.95),\r\n    color: config.color ?? \"#ffb347\",\r\n    explosionDuration: config.explosionDuration ?? 0.32,\r\n    selfDamageScale: clamp(config.selfDamageScale ?? 0.65, 0, 1),\r\n    selfKnockbackScale: clamp(config.selfKnockbackScale ?? 0.6, 0, 1),\r\n    effectType: config.effectType ?? \"explosive\",\r\n    stunDuration: config.stunDuration ?? 0,\r\n    playerStunDuration: config.playerStunDuration ?? 0,\r\n    smokeDuration: config.smokeDuration ?? 0,\r\n    smokeRadius: config.smokeRadius ?? (config.explosionRadius ?? 120),\r\n    smokeExpansion: config.smokeExpansion ?? 1.1,\r\n    smokeSlowMultiplier: clamp(config.smokeSlowMultiplier ?? 0.55, 0.1, 1),\r\n    smokeTickDuration: config.smokeTickDuration ?? 0.5,\r\n    detonated: false,\r\n    explosionTimer: 0\r\n  };\r\n\r\n  throwables.push(grenade);\r\n  dispatchThrowableEvent(\"throwable:thrown\", {\r\n    id: grenade.id,\r\n    effectType: grenade.effectType,\r\n    x: grenade.x,\r\n    y: grenade.y,\r\n    radius: grenade.explosionRadius,\r\n    fuse: grenade.fuse\r\n  });\r\n\r\n  return true;\r\n}\r\n\r\nfunction applyExplosiveDamage(grenade) {\r\n  const { x, y, explosionRadius, damage, knockback } = grenade;\r\n  applyExplosionImpulse({\r\n    x,\r\n    y,\r\n    radius: explosionRadius,\r\n    maxDamage: damage,\r\n    maxKnockback: knockback,\r\n    minDamageRatio: grenade.damageFalloff ?? 0.3,\r\n    selfDamageScale: grenade.selfDamageScale ?? 1,\r\n    selfKnockbackScale: grenade.selfKnockbackScale ?? 1\r\n  });\r\n\r\n  if (damage > 0) {\r\n    damageDestructiblesInRadius({\r\n      x,\r\n      y,\r\n      radius: explosionRadius,\r\n      maxDamage: damage,\r\n      minDamageRatio: grenade.destructibleFalloff ?? 0.35,\r\n      cause: grenade.effectType ?? \"explosion\"\r\n    });\r\n  }\r\n\r\n  spawnExplosionDebris({\r\n    x,\r\n    y,\r\n    radius: explosionRadius,\r\n    count: Math.max(10, Math.round(explosionRadius / 10)),\r\n    speed: 220 + Math.max(0, knockback ?? 0) * 0.5\r\n  });\r\n}\r\n\r\nfunction applyFlashEffect(grenade) {\r\n  const { x, y, explosionRadius, stunDuration, playerStunDuration } = grenade;\r\n  const duration = Math.max(0.1, stunDuration);\r\n\r\n  if (trainingDummy.health > 0) {\r\n    const dx = trainingDummy.x - x;\r\n    const dy = (trainingDummy.y + trainingDummy.height * 0.55) - y;\r\n    if (Math.hypot(dx, dy) <= explosionRadius) {\r\n      trainingDummy.flashTimer = Math.max(trainingDummy.flashTimer, duration * 0.6);\r\n      trainingDummy.shakeTimer = Math.max(trainingDummy.shakeTimer, duration * 0.5);\r\n      trainingDummy.shakeMagnitude = Math.max(trainingDummy.shakeMagnitude, 14);\r\n    }\r\n  }\r\n\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const dx = enemy.x - x;\r\n    const dy = (enemy.y + enemy.height * 0.5) - y;\r\n    if (Math.hypot(dx, dy) <= explosionRadius) {\r\n      enemy.stunTimer = Math.max(enemy.stunTimer ?? 0, duration);\r\n      enemy.flashTimer = Math.max(enemy.flashTimer, duration * 0.7);\r\n      enemy.shakeTimer = Math.max(enemy.shakeTimer, duration * 0.4);\r\n      enemy.shakeMagnitude = Math.max(enemy.shakeMagnitude, 12);\r\n    }\r\n  }\r\n\r\n  if (playerStunDuration > 0 && stickman.health > 0) {\r\n    const pose = stickman.currentPose ?? { headRadius: 16, bodyLength: 34, legLength: 36 };\r\n    const playerHeight = getTotalHeight(pose);\r\n    const playerCenterY = stickman.y + playerHeight * 0.6;\r\n    const dx = stickman.x - x;\r\n    const dy = playerCenterY - y;\r\n    if (Math.hypot(dx, dy) <= explosionRadius) {\r\n      stickman.flashBlindTimer = Math.max(stickman.flashBlindTimer ?? 0, playerStunDuration);\r\n      stickman.stunTimer = Math.max(stickman.stunTimer ?? 0, playerStunDuration * 0.6);\r\n    }\r\n  }\r\n}\r\n\r\nfunction spawnSmokeCloud(grenade) {\r\n  const duration = Math.max(0.5, grenade.smokeDuration);\r\n  const radius = Math.max(40, grenade.smokeRadius);\r\n  const cloud = {\r\n    id: `smoke-${Date.now()}-${Math.random().toString(36).slice(2, 5)}`,\r\n    x: grenade.x,\r\n    y: grenade.y,\r\n    radius,\r\n    baseRadius: radius,\r\n    maxRadius: radius * (grenade.smokeExpansion ?? 1.1),\r\n    duration,\r\n    life: duration,\r\n    slowMultiplier: clamp(grenade.smokeSlowMultiplier ?? 0.55, 0.1, 1),\r\n    tick: grenade.smokeTickDuration ?? 0.5,\r\n    tickTimer: 0\r\n  };\r\n  smokeClouds.push(cloud);\r\n  dispatchThrowableEvent(\"throwable:smoke-spawn\", {\r\n    id: cloud.id,\r\n    x: cloud.x,\r\n    y: cloud.y,\r\n    radius: cloud.radius,\r\n    maxRadius: cloud.maxRadius,\r\n    duration: cloud.duration\r\n  });\r\n  return cloud;\r\n}\r\n\r\nfunction detonate(grenade) {\r\n  if (grenade.detonated) {\r\n    return;\r\n  }\r\n\r\n  grenade.detonated = true;\r\n  grenade.explosionTimer = Math.max(grenade.explosionDuration, 0.08);\r\n  grenade.fuse = 0;\r\n\r\n  const baseDetail = {\r\n    id: grenade.id,\r\n    effectType: grenade.effectType,\r\n    x: grenade.x,\r\n    y: grenade.y,\r\n    radius: grenade.explosionRadius\r\n  };\r\n\r\n  switch (grenade.effectType) {\r\n    case \"flash\": {\r\n      applyFlashEffect(grenade);\r\n      baseDetail.radius = grenade.explosionRadius;\r\n      baseDetail.stunDuration = grenade.stunDuration;\r\n      baseDetail.playerStunDuration = grenade.playerStunDuration;\r\n      dispatchThrowableEvent(\"throwable:flash-burst\", {\r\n        ...baseDetail,\r\n        stunDuration: grenade.stunDuration,\r\n        playerStunDuration: grenade.playerStunDuration\r\n      });\r\n      break;\r\n    }\r\n    case \"smoke\": {\r\n      const cloud = spawnSmokeCloud(grenade);\r\n      baseDetail.radius = cloud.maxRadius;\r\n      baseDetail.duration = cloud.duration;\r\n      baseDetail.cloudId = cloud.id;\r\n      dispatchThrowableEvent(\"throwable:smoke-detonate\", {\r\n        ...baseDetail,\r\n        radius: cloud.maxRadius,\r\n        duration: cloud.duration,\r\n        cloudId: cloud.id\r\n      });\r\n      break;\r\n    }\r\n    default: {\r\n      applyExplosiveDamage(grenade);\r\n      baseDetail.damage = grenade.damage;\r\n      baseDetail.knockback = grenade.knockback;\r\n      dispatchThrowableEvent(\"throwable:explosion\", {\r\n        ...baseDetail,\r\n        damage: grenade.damage,\r\n        knockback: grenade.knockback\r\n      });\r\n      break;\r\n    }\r\n  }\r\n\r\n  dispatchThrowableEvent(\"throwable:detonate\", baseDetail);\r\n}\r\n\r\nfunction updateSmokeClouds(delta) {\r\n  for (const cloud of smokeClouds) {\r\n    cloud.life = Math.max(0, cloud.life - delta);\r\n    const progress = 1 - cloud.life / cloud.duration;\r\n    cloud.radius = clamp(cloud.baseRadius + (cloud.maxRadius - cloud.baseRadius) * clamp(progress, 0, 1), cloud.baseRadius, cloud.maxRadius);\r\n    cloud.tickTimer -= delta;\r\n    if (cloud.tickTimer <= 0) {\r\n      cloud.tickTimer = cloud.tick;\r\n      const effectiveRadius = cloud.radius;\r\n      for (const enemy of enemies) {\r\n        if (enemy.health <= 0) {\r\n          continue;\r\n        }\r\n        const dx = enemy.x - cloud.x;\r\n        const dy = (enemy.y + enemy.height * 0.5) - cloud.y;\r\n        if (Math.hypot(dx, dy) <= effectiveRadius) {\r\n          enemy.smokeSlowTimer = Math.max(enemy.smokeSlowTimer ?? 0, cloud.tick + 0.4);\r\n          enemy.smokeSlowStrength = Math.min(enemy.smokeSlowStrength ?? 1, cloud.slowMultiplier);\r\n        }\r\n      }\r\n      const pose = stickman.currentPose ?? { headRadius: 16, bodyLength: 34, legLength: 36 };\r\n      const playerHeight = getTotalHeight(pose);\r\n      const playerCenterY = stickman.y + playerHeight * 0.6;\r\n      const pdx = stickman.x - cloud.x;\r\n      const pdy = playerCenterY - cloud.y;\r\n      if (Math.hypot(pdx, pdy) <= effectiveRadius) {\r\n        stickman.smokeSlowTimer = Math.max(stickman.smokeSlowTimer ?? 0, cloud.tick + 0.4);\r\n        stickman.smokeSlowStrength = Math.min(stickman.smokeSlowStrength ?? 1, cloud.slowMultiplier + 0.1);\r\n      }\r\n    }\r\n  }\r\n\r\n  for (let i = smokeClouds.length - 1; i >= 0; i -= 1) {\r\n    if (smokeClouds[i].life <= 0) {\r\n      const dissipated = smokeClouds.splice(i, 1)[0];\r\n      dispatchThrowableEvent(\"throwable:smoke-dissipate\", {\r\n        id: dissipated.id,\r\n        x: dissipated.x,\r\n        y: dissipated.y,\r\n        radius: dissipated.maxRadius ?? dissipated.radius\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateThrowables(delta) {\r\n  const width = context.canvas.width;\r\n\r\n  for (const grenade of throwables) {\r\n    if (!grenade.detonated) {\r\n      grenade.fuse -= delta;\r\n      grenade.vy += GRAVITY * grenade.gravityFactor * delta;\r\n      grenade.x += grenade.vx * delta;\r\n      grenade.y += grenade.vy * delta;\r\n\r\n      if (grenade.y + grenade.radius >= GROUND_Y) {\r\n        grenade.y = GROUND_Y - grenade.radius;\r\n        if (grenade.vy > 0) {\r\n          grenade.vy = -grenade.vy * grenade.bounciness;\r\n        }\r\n        grenade.vx *= 0.7;\r\n        if (Math.abs(grenade.vy) < 36) {\r\n          grenade.vy = 0;\r\n        }\r\n      }\r\n\r\n      if (grenade.x - grenade.radius <= 0 || grenade.x + grenade.radius >= width) {\r\n        grenade.x = clamp(grenade.x, grenade.radius, width - grenade.radius);\r\n        grenade.vx = -grenade.vx * 0.45;\r\n      }\r\n\r\n      if (grenade.fuse <= 0) {\r\n        detonate(grenade);\r\n      }\r\n    } else {\r\n      grenade.explosionTimer -= delta;\r\n    }\r\n  }\r\n\r\n  for (let i = throwables.length - 1; i >= 0; i -= 1) {\r\n    if (throwables[i].detonated && throwables[i].explosionTimer <= 0) {\r\n      throwables.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  updateSmokeClouds(delta);\r\n}\r\n\r\nfunction drawSmokeClouds() {\r\n  if (smokeClouds.length === 0) {\r\n    return;\r\n  }\r\n\r\n  context.save();\r\n  for (const cloud of smokeClouds) {\r\n    const lifeRatio = clamp(cloud.life / cloud.duration, 0, 1);\r\n    const radius = cloud.radius;\r\n    const gradient = context.createRadialGradient(cloud.x, cloud.y, radius * 0.15, cloud.x, cloud.y, radius);\r\n    gradient.addColorStop(0, \"rgba(172, 196, 216, 0.35)\");\r\n    gradient.addColorStop(1, \"rgba(40, 52, 64, 0)\");\r\n    context.globalAlpha = lifeRatio;\r\n    context.fillStyle = gradient;\r\n    context.beginPath();\r\n    context.arc(cloud.x, cloud.y, radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction drawThrowables() {\r\n  const elapsed = getElapsedTime();\r\n  context.save();\r\n\r\n  for (const grenade of throwables) {\r\n    if (!grenade.detonated) {\r\n      context.globalAlpha = 1;\r\n      context.fillStyle = grenade.color;\r\n      context.beginPath();\r\n      context.arc(grenade.x, grenade.y, grenade.radius, 0, Math.PI * 2);\r\n      context.fill();\r\n\r\n      const fuseRatio = grenade.maxFuse > 0 ? clamp(grenade.fuse / grenade.maxFuse, 0, 1) : 0;\r\n      context.strokeStyle = \"rgba(255, 232, 194, 0.85)\";\r\n      context.lineWidth = 3;\r\n      context.beginPath();\r\n      context.arc(grenade.x, grenade.y, grenade.radius * 0.65, -Math.PI / 2, -Math.PI / 2 + Math.PI * 2 * fuseRatio);\r\n      context.stroke();\r\n\r\n      const sparkOffsetX = Math.cos(elapsed * 20) * grenade.radius * 0.4;\r\n      const sparkOffsetY = Math.sin(elapsed * 24) * grenade.radius * 0.2 - grenade.radius * 0.8;\r\n      context.fillStyle = \"rgba(255, 240, 210, 0.9)\";\r\n      context.beginPath();\r\n      context.arc(grenade.x + sparkOffsetX, grenade.y + sparkOffsetY, 3.2, 0, Math.PI * 2);\r\n      context.fill();\r\n    } else {\r\n      const duration = Math.max(grenade.explosionDuration, 0.001);\r\n      const progress = clamp(1 - grenade.explosionTimer / duration, 0, 1);\r\n      const alpha = clamp(1 - progress, 0, 1);\r\n\r\n      if (grenade.effectType === \"flash\") {\r\n        const flashRadius = grenade.explosionRadius * (0.8 + progress * 0.5);\r\n        const flashAlpha = Math.max(0, Math.min(1, 0.75 * alpha + 0.15));\r\n        context.fillStyle = `rgba(255, 255, 224, ${flashAlpha.toFixed(3)})`;\r\n        context.beginPath();\r\n        context.arc(grenade.x, grenade.y, flashRadius, 0, Math.PI * 2);\r\n        context.fill();\r\n      } else if (grenade.effectType === \"smoke\") {\r\n        const puffRadius = grenade.explosionRadius * (0.6 + progress * 0.6);\r\n        const puffAlpha = Math.max(0, Math.min(0.65, 0.5 * alpha + 0.1));\r\n        context.fillStyle = `rgba(180, 200, 220, ${puffAlpha.toFixed(3)})`;\r\n        context.beginPath();\r\n        context.arc(grenade.x, grenade.y, puffRadius, 0, Math.PI * 2);\r\n        context.fill();\r\n      } else {\r\n        const outerRadius = grenade.explosionRadius * (0.65 + progress * 0.4);\r\n        const ringAlpha = Math.max(0, Math.min(1, 0.7 * alpha));\r\n        context.strokeStyle = `rgba(255, 196, 120, ${ringAlpha.toFixed(3)})`;\r\n        context.lineWidth = 6 * (1 - progress * 0.6);\r\n        context.beginPath();\r\n        context.arc(grenade.x, grenade.y, outerRadius, 0, Math.PI * 2);\r\n        context.stroke();\r\n\r\n        const coreAlpha = Math.max(0, Math.min(1, 0.75 * alpha));\r\n        context.fillStyle = `rgba(255, 118, 64, ${coreAlpha.toFixed(3)})`;\r\n        context.beginPath();\r\n        context.arc(grenade.x, grenade.y, outerRadius * 0.6, 0, Math.PI * 2);\r\n        context.fill();\r\n      }\r\n    }\r\n  }\r\n\r\n  context.restore();\r\n  drawSmokeClouds();\r\n}\r\n\r\nexport { throwEquippedWeapon, updateThrowables, drawThrowables };\r\n\r\n\r\n\r\n\r\n\r\n\r\n","const SUPPLY_DROP_TYPES = {\r\n  ammo: {\r\n    id: \"ammo\",\r\n    label: \"Ammo Cache\",\r\n    description: \"Refills magazines and reserves for all weapons.\",\r\n    weight: 0.45,\r\n    crateColor: \"#4d7cff\",\r\n    glowColor: \"#b5c8ff\"\r\n  },\r\n  medkit: {\r\n    id: \"medkit\",\r\n    label: \"Field Medkit\",\r\n    description: \"Restores health and grants brief damage resistance.\",\r\n    weight: 0.35,\r\n    crateColor: \"#ff6f6f\",\r\n    glowColor: \"#ffb4b4\"\r\n  },\r\n  heavy: {\r\n    id: \"heavy\",\r\n    label: \"Heavy Arsenal\",\r\n    description: \"Drops a powerful heavy weapon with fresh ammo.\",\r\n    weight: 0.2,\r\n    crateColor: \"#ffb347\",\r\n    glowColor: \"#ffe0a3\",\r\n    weaponId: \"thunderCannon\"\r\n  }\r\n};\r\n\r\nconst SUPPLY_DROP_SETTINGS = {\r\n  initialDelay: 18,\r\n  intervalMin: 26,\r\n  intervalMax: 38,\r\n  maxActiveDrops: 3,\r\n  spawnHeight: 280,\r\n  driftSpeed: 18,\r\n  descentAcceleration: 140,\r\n  maxDescentSpeed: 180,\r\n  pickupRadius: 68,\r\n  despawnDelay: 12,\r\n  collectedFanfare: 3.5,\r\n  warningLead: 6,\r\n  armorBoostDuration: 6,\r\n  armorBoostValue: 0.4\r\n};\r\n\r\nexport { SUPPLY_DROP_TYPES, SUPPLY_DROP_SETTINGS };\r\n","\r\nimport { canvas, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { stickman, getTotalHeight } from \"../../state/entities.js\";\r\nimport { WEAPON_DEFINITIONS } from \"../../config/weapons.js\";\r\nimport { SUPPLY_DROP_TYPES, SUPPLY_DROP_SETTINGS } from \"../../config/supplyDrops.js\";\r\nimport { ensureAmmoEntry, refillWeaponAmmo } from \"../../state/ammo.js\";\r\nimport { getWeaponInventory, addWeaponToInventory } from \"../../state/weapons.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst supplyDrops = [];\r\nconst manager = {\r\n  nextDropTimer: SUPPLY_DROP_SETTINGS.initialDelay,\r\n  nextDropTypeId: chooseWeightedType(),\r\n  incomingMessage: null,\r\n  incomingTimer: 0,\r\n  incomingDuration: 3,\r\n  rewardMessage: null,\r\n  rewardTimer: 0,\r\n  rewardDuration: SUPPLY_DROP_SETTINGS.collectedFanfare,\r\n  dropSequence: 0\r\n};\r\n\r\nfunction randomBetween(min, max) {\r\n  return min + Math.random() * (max - min);\r\n}\r\n\r\nfunction chooseWeightedType() {\r\n  const entries = Object.values(SUPPLY_DROP_TYPES);\r\n  if (entries.length === 0) {\r\n    return null;\r\n  }\r\n  const totalWeight = entries.reduce((sum, entry) => sum + (entry.weight ?? 1), 0);\r\n  let roll = Math.random() * totalWeight;\r\n  for (const entry of entries) {\r\n    const weight = entry.weight ?? 1;\r\n    if (roll <= weight) {\r\n      return entry.id;\r\n    }\r\n    roll -= weight;\r\n  }\r\n  return entries[entries.length - 1].id;\r\n}\r\n\r\nfunction scheduleNextDrop() {\r\n  manager.nextDropTimer = randomBetween(SUPPLY_DROP_SETTINGS.intervalMin, SUPPLY_DROP_SETTINGS.intervalMax);\r\n  manager.nextDropTypeId = chooseWeightedType();\r\n}\r\n\r\nfunction spawnSupplyDrop(typeId) {\r\n  const definition = SUPPLY_DROP_TYPES[typeId] ?? SUPPLY_DROP_TYPES.ammo;\r\n  const width = 52;\r\n  const height = 42;\r\n  const x = clamp(canvas.width * (0.2 + Math.random() * 0.6), width * 0.6, canvas.width - width * 0.6);\r\n  const spawnY = -SUPPLY_DROP_SETTINGS.spawnHeight;\r\n  const drop = {\r\n    id: `supply-${manager.dropSequence += 1}`,\r\n    typeId: definition.id,\r\n    label: definition.label,\r\n    description: definition.description,\r\n    crateColor: definition.crateColor ?? \"#4d7cff\",\r\n    glowColor: definition.glowColor ?? \"#9ab5ff\",\r\n    width,\r\n    height,\r\n    x,\r\n    y: spawnY,\r\n    vx: (Math.random() * 2 - 1) * SUPPLY_DROP_SETTINGS.driftSpeed,\r\n    vy: 0,\r\n    state: \"descending\",\r\n    timer: 0,\r\n    highlight: 0,\r\n    despawnTimer: SUPPLY_DROP_SETTINGS.despawnDelay,\r\n    parachutePhase: 0\r\n  };\r\n  supplyDrops.push(drop);\r\n  manager.incomingMessage = `${definition.label} inbound!`;\r\n  manager.incomingTimer = manager.incomingDuration;\r\n}\r\n\r\nfunction applyAmmoReward() {\r\n  const inventory = getWeaponInventory();\r\n  for (const weaponId of inventory) {\r\n    const entry = ensureAmmoEntry(weaponId);\r\n    if (!entry || entry.capacity === Number.POSITIVE_INFINITY) {\r\n      continue;\r\n    }\r\n    refillWeaponAmmo(weaponId);\r\n  }\r\n  stickman.reloading = false;\r\n}\r\n\r\nfunction applyMedkitReward() {\r\n  const healAmount = 70;\r\n  stickman.health = Math.min(stickman.maxHealth, stickman.health + healAmount);\r\n  stickman.invulnerability = Math.max(stickman.invulnerability, SUPPLY_DROP_SETTINGS.armorBoostValue ?? 0.4);\r\n}\r\n\r\nfunction applyHeavyWeaponReward() {\r\n  const heavyType = SUPPLY_DROP_TYPES.heavy;\r\n  const weaponId = heavyType?.weaponId ?? null;\r\n  if (weaponId && WEAPON_DEFINITIONS[weaponId]) {\r\n    addWeaponToInventory(weaponId, { autoEquip: true });\r\n    ensureAmmoEntry(weaponId);\r\n    refillWeaponAmmo(weaponId);\r\n  }\r\n}\r\n\r\nfunction applySupplyDropReward(typeId) {\r\n  switch (typeId) {\r\n    case \"medkit\":\r\n      applyMedkitReward();\r\n      manager.rewardMessage = \"Health restored\";\r\n      break;\r\n    case \"heavy\":\r\n      applyHeavyWeaponReward();\r\n      manager.rewardMessage = \"Heavy weapon acquired\";\r\n      break;\r\n    case \"ammo\":\r\n    default:\r\n      applyAmmoReward();\r\n      manager.rewardMessage = \"Ammo resupply\";\r\n      break;\r\n  }\r\n  manager.rewardTimer = manager.rewardDuration;\r\n}\r\n\r\nfunction updateHighlight(drop, delta) {\r\n  const playerX = stickman.x;\r\n  const pose = stickman.currentPose ?? POSES.standing;\r\n  const playerFeetY = stickman.y + getTotalHeight(pose);\r\n  const crateCenterX = drop.x;\r\n  const crateCenterY = drop.y + drop.height * 0.5;\r\n  const dx = playerX - crateCenterX;\r\n  const dy = playerFeetY - crateCenterY;\r\n  const distance = Math.hypot(dx, dy);\r\n  if (distance <= SUPPLY_DROP_SETTINGS.pickupRadius) {\r\n    drop.highlight = clamp(drop.highlight + delta * 4, 0, 1);\r\n    return true;\r\n  }\r\n  drop.highlight = clamp(drop.highlight - delta * 2, 0, 1);\r\n  return false;\r\n}\r\n\r\nfunction pickupDrop(drop) {\r\n  applySupplyDropReward(drop.typeId);\r\n  drop.state = \"collected\";\r\n  drop.despawnTimer = SUPPLY_DROP_SETTINGS.collectedFanfare;\r\n  drop.highlight = 1;\r\n}\r\n\r\nfunction updateSupplyDrops(delta) {\r\n  manager.nextDropTimer -= delta;\r\n  if (manager.nextDropTimer <= 0 && supplyDrops.length < SUPPLY_DROP_SETTINGS.maxActiveDrops) {\r\n    spawnSupplyDrop(manager.nextDropTypeId);\r\n    scheduleNextDrop();\r\n  }\r\n\r\n  if (manager.incomingTimer > 0) {\r\n    manager.incomingTimer = Math.max(0, manager.incomingTimer - delta);\r\n  }\r\n  if (manager.rewardTimer > 0) {\r\n    manager.rewardTimer = Math.max(0, manager.rewardTimer - delta);\r\n  }\r\n\r\n  for (let i = supplyDrops.length - 1; i >= 0; i -= 1) {\r\n    const drop = supplyDrops[i];\r\n    drop.timer += delta;\r\n    if (drop.state === \"descending\") {\r\n      drop.vy = Math.min(SUPPLY_DROP_SETTINGS.maxDescentSpeed, drop.vy + SUPPLY_DROP_SETTINGS.descentAcceleration * delta);\r\n      drop.y += drop.vy * delta;\r\n      drop.x = clamp(drop.x + drop.vx * delta, drop.width * 0.5, canvas.width - drop.width * 0.5);\r\n      drop.parachutePhase += delta;\r\n      if (drop.y >= GROUND_Y - drop.height) {\r\n        drop.y = GROUND_Y - drop.height;\r\n        drop.vy = 0;\r\n        drop.state = \"ready\";\r\n        drop.timer = 0;\r\n      }\r\n    } else if (drop.state === \"ready\") {\r\n      const withinPickup = updateHighlight(drop, delta);\r\n      if (withinPickup) {\r\n        pickupDrop(drop);\r\n      } else {\r\n        drop.despawnTimer -= delta;\r\n        if (drop.despawnTimer <= 0) {\r\n          supplyDrops.splice(i, 1);\r\n          continue;\r\n        }\r\n      }\r\n    } else if (drop.state === \"collected\") {\r\n      drop.highlight = clamp(drop.highlight - delta * 0.6, 0, 1);\r\n      drop.despawnTimer -= delta;\r\n      if (drop.despawnTimer <= 0) {\r\n        supplyDrops.splice(i, 1);\r\n        continue;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction getSupplyDrops() {\r\n  return supplyDrops;\r\n}\r\n\r\nfunction getSupplyDropStatus() {\r\n  return {\r\n    timeUntilNext: Math.max(0, manager.nextDropTimer),\r\n    nextDropLabel: SUPPLY_DROP_TYPES[manager.nextDropTypeId]?.label ?? null,\r\n    incomingMessage: manager.incomingTimer > 0 ? manager.incomingMessage : null,\r\n    incomingAlpha: manager.incomingTimer > 0 ? manager.incomingTimer / manager.incomingDuration : 0,\r\n    rewardMessage: manager.rewardTimer > 0 ? manager.rewardMessage : null,\r\n    rewardAlpha: manager.rewardTimer > 0 ? manager.rewardTimer / manager.rewardDuration : 0,\r\n    activeCount: supplyDrops.length\r\n  };\r\n}\r\n\r\nexport { updateSupplyDrops, getSupplyDrops, getSupplyDropStatus };\r\n","\r\nimport { context } from \"../../environment/canvas.js\";\r\nimport { SUPPLY_DROP_SETTINGS, SUPPLY_DROP_TYPES } from \"../../config/supplyDrops.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { getSupplyDrops } from \"../world/supplyDrops.js\";\r\n\r\nfunction drawCrate(drop) {\r\n  const baseAlpha = drop.state === \"collected\" ? clamp(drop.despawnTimer / SUPPLY_DROP_SETTINGS.collectedFanfare, 0, 1) : 1;\r\n  context.save();\r\n  context.globalAlpha = baseAlpha;\r\n\r\n  if (drop.state === \"descending\") {\r\n    const parachuteWidth = drop.width * 1.8;\r\n    const canopyHeight = drop.height * 0.9;\r\n    context.fillStyle = drop.glowColor;\r\n    context.beginPath();\r\n    context.moveTo(drop.x - parachuteWidth * 0.5, drop.y + canopyHeight * 0.2);\r\n    context.quadraticCurveTo(drop.x, drop.y - canopyHeight * 0.8, drop.x + parachuteWidth * 0.5, drop.y + canopyHeight * 0.2);\r\n    context.closePath();\r\n    context.fill();\r\n\r\n    context.strokeStyle = drop.glowColor;\r\n    context.lineWidth = 2;\r\n    context.beginPath();\r\n    context.moveTo(drop.x - parachuteWidth * 0.3, drop.y + canopyHeight * 0.25);\r\n    context.lineTo(drop.x - drop.width * 0.25, drop.y + drop.height * 0.1);\r\n    context.moveTo(drop.x + parachuteWidth * 0.3, drop.y + canopyHeight * 0.25);\r\n    context.lineTo(drop.x + drop.width * 0.25, drop.y + drop.height * 0.1);\r\n    context.stroke();\r\n  }\r\n\r\n  const topColor = drop.glowColor;\r\n  const bodyColor = drop.crateColor;\r\n  const highlightAlpha = drop.highlight ?? 0;\r\n\r\n  context.fillStyle = bodyColor;\r\n  context.fillRect(drop.x - drop.width * 0.5, drop.y, drop.width, drop.height);\r\n  context.fillStyle = topColor;\r\n  context.fillRect(drop.x - drop.width * 0.5, drop.y - drop.height * 0.25, drop.width, drop.height * 0.25);\r\n\r\n  context.strokeStyle = \"rgba(12, 16, 24, 0.65)\";\r\n  context.lineWidth = 3;\r\n  context.strokeRect(drop.x - drop.width * 0.5, drop.y, drop.width, drop.height);\r\n\r\n  if (highlightAlpha > 0) {\r\n    context.globalAlpha = highlightAlpha * 0.6;\r\n    context.fillStyle = drop.glowColor;\r\n    context.beginPath();\r\n    context.arc(drop.x, drop.y + drop.height * 0.5, SUPPLY_DROP_SETTINGS.pickupRadius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n\r\n  context.restore();\r\n}\r\n\r\nfunction drawSupplyDrops() {\r\n  const drops = getSupplyDrops();\r\n  if (drops.length === 0) {\r\n    return;\r\n  }\r\n\r\n  context.save();\r\n  context.textAlign = \"center\";\r\n  context.font = \"15px 'Segoe UI', Arial, sans-serif\";\r\n\r\n  for (const drop of drops) {\r\n    drawCrate(drop);\r\n    const typeDef = SUPPLY_DROP_TYPES[drop.typeId];\r\n    if (drop.state !== \"descending\") {\r\n      context.fillStyle = drop.glowColor;\r\n      context.globalAlpha = 0.9;\r\n      context.fillText(typeDef?.label ?? drop.label ?? \"Supply Drop\", drop.x, drop.y - 16);\r\n    }\r\n  }\r\n\r\n  context.restore();\r\n}\r\n\r\nexport { drawSupplyDrops };\r\n","import { context } from \"../../environment/canvas.js\";\nimport { getDestructibles } from \"../../state/destructibles.js\";\nimport { getElapsedTime } from \"../utils/time.js\";\nimport { clamp } from \"../utils/math.js\";\n\nfunction drawBarrierBody(destructible, template, elapsed) {\n  const width = destructible.width;\n  const height = destructible.height;\n  const top = -height;\n  const bodyColor = template.bodyColor ?? \"#555\";\n  const accentColor = template.accentColor ?? \"#888\";\n  const edgeColor = template.edgeColor ?? \"#333\";\n  const crackColor = template.damageHighlight ?? \"#d5dde8\";\n  const damageRatio = clamp(1 - (destructible.health / destructible.maxHealth), 0, 1);\n  context.fillStyle = bodyColor;\n  context.fillRect(-width / 2, top, width, height);\n\n  context.fillStyle = accentColor;\n  context.fillRect(-width / 2, top, width, Math.max(10, height * 0.12));\n  context.fillRect(-width / 2, top + height * 0.55, width, Math.max(8, height * 0.1));\n\n  context.strokeStyle = edgeColor;\n  context.lineWidth = 4;\n  context.strokeRect(-width / 2, top, width, height);\n\n  if (damageRatio > 0) {\n    const crackCount = 3 + Math.floor(damageRatio * 3);\n    const phase = elapsed * 3 + destructible.x * 0.02;\n    context.strokeStyle = crackColor;\n    context.lineWidth = 2;\n    for (let i = 0; i < crackCount; i += 1) {\n      const offset = (i + 1) / (crackCount + 1);\n      const startX = -width * 0.45 + width * offset;\n      const crackHeight = height * (0.2 + damageRatio * 0.5);\n      const wobble = Math.sin(phase + i * 1.7) * 12;\n      context.beginPath();\n      context.moveTo(startX, top + height * 0.18);\n      context.lineTo(startX + wobble * 0.3, top + height * 0.18 + crackHeight * 0.45);\n      context.lineTo(startX + wobble, top + height * 0.18 + crackHeight);\n      context.stroke();\n    }\n  }\n}\n\nfunction drawRubble(destructible, template, progress) {\n  const width = destructible.width;\n  const rubbleHeight = Math.max(8, (template.rubbleHeight ?? 32) * progress);\n  const debrisColor = template.debrisColor ?? template.bodyColor ?? \"#4a4a4a\";\n  context.fillStyle = debrisColor;\n  context.beginPath();\n  context.moveTo(-width / 2, 0);\n  context.lineTo(-width * 0.35, -rubbleHeight * 0.3);\n  context.lineTo(-width * 0.12, -rubbleHeight);\n  context.lineTo(width * 0.08, -rubbleHeight * 0.65);\n  context.lineTo(width * 0.32, -rubbleHeight * 0.9);\n  context.lineTo(width / 2, 0);\n  context.closePath();\n  context.fill();\n\n  context.fillStyle = \"rgba(30, 32, 40, 0.6)\";\n  context.fillRect(-width / 2, 0, width, Math.max(6, rubbleHeight * 0.2));\n}\n\nfunction drawStreetCar(destructible, template, elapsed) {\n  const width = destructible.width;\n  const height = destructible.height;\n  const top = -height;\n  const facing = destructible.facing ?? 1;\n  const damageRatio = clamp(1 - (destructible.health / destructible.maxHealth), 0, 1);\n\n  context.save();\n  context.scale(facing, 1);\n\n  const bodyColor = template.bodyColor ?? \"#b13d30\";\n  const windowColor = template.glassColor ?? \"#4ac3ff\";\n  const accentColor = template.accentColor ?? \"#f7f9ff\";\n  const edgeColor = template.edgeColor ?? \"#1c1d25\";\n\n  const bodyTop = top + height * 0.15;\n  const cabinHeight = height * 0.55;\n  const wheelRadius = Math.max(12, height * 0.18);\n\n  context.fillStyle = bodyColor;\n  context.beginPath();\n  context.moveTo(-width / 2, bodyTop + height * 0.1);\n  context.lineTo(-width * 0.42, top + cabinHeight * 0.45);\n  context.lineTo(-width * 0.25, top);\n  context.lineTo(width * 0.22, top);\n  context.lineTo(width * 0.45, top + cabinHeight * 0.5);\n  context.lineTo(width / 2, bodyTop + height * 0.1);\n  context.closePath();\n  context.fill();\n\n  context.fillStyle = windowColor;\n  const windowHeight = cabinHeight * 0.55;\n  context.fillRect(-width * 0.28, top + cabinHeight * 0.12, width * 0.42, windowHeight);\n\n  context.fillStyle = accentColor;\n  context.fillRect(-width / 2, bodyTop + cabinHeight * 0.55, width, height * 0.2);\n\n  context.fillStyle = edgeColor;\n  context.beginPath();\n  context.arc(-width * 0.28, wheelRadius * -0.15, wheelRadius, 0, Math.PI * 2);\n  context.arc(width * 0.28, wheelRadius * -0.15, wheelRadius, 0, Math.PI * 2);\n  context.fill();\n\n  if (!destructible.destroyed && damageRatio > 0.05) {\n    context.strokeStyle = \"rgba(0, 0, 0, 0.35)\";\n    context.lineWidth = 2;\n    context.beginPath();\n    context.moveTo(-width * 0.12, top + cabinHeight * 0.8);\n    context.lineTo(-width * 0.22, bodyTop + height * 0.55);\n    context.lineTo(-width * 0.05, bodyTop + height * 0.7);\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(width * 0.18, top + cabinHeight * 0.6);\n    context.lineTo(width * 0.3, bodyTop + height * 0.4);\n    context.lineTo(width * 0.12, bodyTop + height * 0.65);\n    context.stroke();\n  }\n\n  context.restore();\n}\r\nfunction drawBarrelCluster(destructible, template, elapsed) {\n  const width = destructible.width;\n  const height = destructible.height;\n  const damageRatio = clamp(1 - (destructible.health / destructible.maxHealth), 0, 1);\n  const barrelRadius = width * 0.22;\n  const barrelHeight = height * 0.48;\n  const top = -height;\n  const bodyColor = template.bodyColor ?? \"#c0671c\";\n  const stripeColor = template.stripeColor ?? template.accentColor ?? \"#ffd45f\";\n  const edgeColor = template.edgeColor ?? \"#2f1a08\";\n\n  const positions = [\n    { x: -width * 0.22, y: top + height * 0.45 },\n    { x: width * 0.22, y: top + height * 0.5 },\n    { x: 0, y: top + height * 0.1 }\n  ];\n\n  const visibleCount = destructible.destroyed ? 1 : 3;\n  for (let i = 0; i < visibleCount; i += 1) {\n    const pos = positions[i];\n    context.save();\n    context.translate(pos.x, pos.y);\n    context.fillStyle = bodyColor;\n    context.beginPath();\n    context.ellipse(0, 0, barrelRadius, barrelHeight * 0.5, 0, 0, Math.PI * 2);\n    context.fill();\n\n    context.fillRect(-barrelRadius, -barrelHeight * 0.5, barrelRadius * 2, barrelHeight);\n\n    context.fillStyle = stripeColor;\n    context.fillRect(-barrelRadius, -barrelHeight * 0.12, barrelRadius * 2, barrelHeight * 0.24);\n\n    context.strokeStyle = edgeColor;\n    context.lineWidth = 3;\n    context.strokeRect(-barrelRadius, -barrelHeight * 0.5, barrelRadius * 2, barrelHeight);\n    context.restore();\n  }\n\n  if (!destructible.destroyed && damageRatio > 0.2) {\n    const flicker = 0.2 + Math.abs(Math.sin(elapsed * 8 + destructible.x * 0.05)) * 0.3 * damageRatio;\n    context.fillStyle = `rgba(255, 174, 72, ${flicker.toFixed(3)})`;\n    context.beginPath();\n    context.ellipse(0, top + height * 0.1, width * 0.12, height * 0.18, 0, 0, Math.PI * 2);\n    context.fill();\n  }\n}\r\nfunction drawHealthTick(width, ratio, yOffset) {\n  const clamped = clamp(ratio, 0, 1);\n  const barWidth = width * 0.85;\n  context.fillStyle = \"rgba(0, 0, 0, 0.45)\";\n  context.fillRect(-barWidth / 2, yOffset, barWidth, 5);\n  context.fillStyle = clamped > 0.5 ? \"#58ec8c\" : clamped > 0.25 ? \"#ffd15c\" : \"#ff675c\";\n  context.fillRect(-barWidth / 2, yOffset, barWidth * clamped, 5);\n}\n\nfunction drawSmokeColumn(destructible, template, elapsed) {\n  if ((destructible.smokeTimer ?? 0) <= 0) {\n    return;\n  }\n  const duration = template.smokeDuration ?? 1.5;\n  const lifeRatio = clamp((destructible.smokeTimer ?? 0) / duration, 0, 1);\n  const baseAlpha = 0.25 + lifeRatio * 0.35;\n  const layers = 4;\n  for (let i = 0; i < layers; i += 1) {\n    const phase = elapsed * (0.4 + i * 0.15) + destructible.x * 0.03 + i * 1.3;\n    const radius = (destructible.width * 0.35) * (1 + lifeRatio * 0.6 + i * 0.15);\n    context.globalAlpha = clamp(baseAlpha - i * 0.06, 0, 0.45);\n    context.fillStyle = \"#9fb6c8\";\n    context.beginPath();\n    context.arc(\n      Math.sin(phase) * destructible.width * 0.12,\n      -destructible.height * (0.65 + i * 0.2) - Math.cos(phase * 0.6) * 6,\n      radius * 0.3,\n      0,\n      Math.PI * 2\n    );\n    context.fill();\n  }\n  context.globalAlpha = 1;\n}\n\nfunction drawDestructible(destructible, elapsed) {\n  const template = destructible.template;\n  if (!template) {\n    return;\n  }\n\n  const shakeMag = destructible.shakeMagnitude ?? 0;\n  const shakeTimer = destructible.shakeTimer ?? 0;\n  const wobblePhase = elapsed * 8 + destructible.x * 0.05;\n  const shakeX = shakeTimer > 0 ? Math.sin(wobblePhase) * shakeMag * 0.35 : 0;\n  const shakeY = shakeTimer > 0 ? Math.cos(wobblePhase * 0.75) * shakeMag * 0.22 : 0;\n\n  context.save();\n  context.translate(destructible.x + shakeX, destructible.y + shakeY);\n\n  if (destructible.destroyed) {\n    drawRubble(destructible, template, clamp(destructible.rubbleLevel ?? 0, 0, 1));\n  }\n\n  if (!destructible.destroyed || (destructible.rubbleLevel ?? 0) < 1) {\n    switch (template.material) {\n      case \"vehicle\":\n        drawStreetCar(destructible, template, elapsed);\n        break;\n      case \"volatile\":\n        drawBarrelCluster(destructible, template, elapsed);\n        break;\n      default:\n        drawBarrierBody(destructible, template, elapsed);\n        break;\n    }\n  }\n\n  if (!destructible.destroyed && destructible.maxHealth > 0) {\n    const healthRatio = clamp(destructible.health / destructible.maxHealth, 0, 1);\n    if (healthRatio < 0.95) {\n      drawHealthTick(destructible.width, healthRatio, -destructible.height - 10);\n    }\n  }\n\n  const flashTimer = destructible.flashTimer ?? 0;\n  if (flashTimer > 0) {\n    const alpha = clamp(flashTimer / 0.2, 0, 1) * 0.45;\n    context.fillStyle = `rgba(255, 255, 255, ${alpha.toFixed(3)})`;\n    context.fillRect(-destructible.width / 2, -destructible.height, destructible.width, destructible.height);\n  }\n\n  drawSmokeColumn(destructible, template, elapsed);\n  context.restore();\n}\n\nfunction drawDestructibles() {\n  const elapsed = getElapsedTime();\n  const items = getDestructibles();\n  if (!items || items.length === 0) {\n    return;\n  }\n\n  context.save();\n  for (const destructible of items) {\n    drawDestructible(destructible, elapsed);\n  }\n  context.restore();\n}\n\nexport { drawDestructibles };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { stickman } from \"../../state/entities.js\";\r\n\r\nconst muzzleFlashes = [];\r\nconst shieldBursts = [];\r\nconst throwableBursts = [];\r\nconst notices = [];\r\nconst shotIndicators = [];\r\n\r\nconst filters = {\r\n  weapons: true,\r\n  shield: true,\r\n  throwables: true\r\n};\r\n\r\nconst FILTER_TOGGLE_MAP = {\r\n  Digit6: \"weapons\",\r\n  Digit7: \"shield\",\r\n  Digit8: \"throwables\"\r\n};\r\n\r\nfunction pushNotice(message, ttl = 1.8) {\r\n  const last = notices[notices.length - 1];\r\n  if (last && last.message === message) {\r\n    last.ttl = ttl;\r\n    last.maxTtl = ttl;\r\n    last.age = 0;\r\n    return;\r\n  }\r\n  notices.push({ message, ttl, maxTtl: ttl, age: 0 });\r\n  while (notices.length > 6) {\r\n    notices.shift();\r\n  }\r\n}\r\n\r\nfunction pushThrowableBurst(type, detail = {}, ttl = 0.4) {\r\n  const burst = {\r\n    type,\r\n    x: detail.x ?? stickman.x,\r\n    y: detail.y ?? stickman.y,\r\n    radius: detail.radius ?? 110,\r\n    ttl,\r\n    maxTtl: ttl\r\n  };\r\n  throwableBursts.push(burst);\r\n  return burst;\r\n}\r\n\r\nfunction shouldCapture(category) {\r\n  return filters[category] !== false;\r\n}\r\n\r\nfunction toggleFilter(category) {\r\n  filters[category] = !filters[category];\r\n  const pretty = category.charAt(0).toUpperCase() + category.slice(1);\r\n  const stateLabel = filters[category] ? \"ON\" : \"OFF\";\r\n  pushNotice(`Debug filter ${pretty} ${stateLabel}`, 1.4);\r\n  if (!filters[category]) {\r\n    if (category === \"weapons\") {\r\n      muzzleFlashes.length = 0;\r\n      shotIndicators.length = 0;\r\n    } else if (category === \"shield\") {\r\n      shieldBursts.length = 0;\r\n    } else if (category === \"throwables\") {\r\n      throwableBursts.length = 0;\r\n    }\r\n  }\r\n}\r\n\r\nfunction handleFilterToggle(event) {\r\n  if (!event.altKey || event.repeat) {\r\n    return;\r\n  }\r\n  const category = FILTER_TOGGLE_MAP[event.code];\r\n  if (!category) {\r\n    return;\r\n  }\r\n  if (typeof event.preventDefault === \"function\") {\r\n    event.preventDefault();\r\n  }\r\n  toggleFilter(category);\r\n}\r\n\r\nfunction handleMuzzleFlash(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const ttl = 0.12;\r\n  muzzleFlashes.push({\r\n    weaponId: detail.weaponId ?? \"unknown\",\r\n    x: detail.x ?? stickman.x,\r\n    y: detail.y ?? stickman.y,\r\n    facing: detail.facing ?? stickman.facing ?? 1,\r\n    ttl,\r\n    maxTtl: ttl\r\n  });\r\n}\r\n\r\nfunction handleShotFired(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const ttl = 0.4;\r\n  const weaponId = detail.weaponId ?? \"unknown\";\r\n  const existing = shotIndicators.find((entry) => entry.weaponId === weaponId);\r\n  if (existing) {\r\n    existing.ttl = ttl;\r\n    existing.maxTtl = ttl;\r\n    existing.age = 0;\r\n    return;\r\n  }\r\n  shotIndicators.push({ weaponId, ttl, maxTtl: ttl, age: 0 });\r\n  while (shotIndicators.length > 5) {\r\n    shotIndicators.shift();\r\n  }\r\n}\r\n\r\nfunction handleReloadStart(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const weaponId = event?.detail?.weaponId ?? \"unknown\";\r\n  pushNotice(`Reloading ${weaponId}`);\r\n}\r\n\r\nfunction handleReloadFinish(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const weaponId = event?.detail?.weaponId ?? \"unknown\";\r\n  pushNotice(`Reload complete ${weaponId}`, 1.4);\r\n}\r\n\r\nfunction handleRecoilKick(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const weaponId = detail.weaponId ?? \"unknown\";\r\n  const horizontal = detail.recoil?.horizontal ?? 0;\r\n  const vertical = detail.recoil?.vertical ?? 0;\r\n  const magnitude = Math.hypot(horizontal, vertical);\r\n  if (magnitude <= 0) {\r\n    return;\r\n  }\r\n  pushNotice(`Recoil ${weaponId}: ${magnitude.toFixed(2)}`, 1.2);\r\n}\r\n\r\nfunction handleShieldHit(event) {\r\n  if (!shouldCapture(\"shield\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const ttl = 0.28;\r\n  const center = {\r\n    x: detail.center?.x ?? stickman.x,\r\n    y: detail.center?.y ?? stickman.y\r\n  };\r\n  shieldBursts.push({\r\n    type: \"hit\",\r\n    absorb: detail.absorb ?? 0,\r\n    center,\r\n    ttl,\r\n    maxTtl: ttl\r\n  });\r\n  if (detail.absorb !== undefined) {\r\n    pushNotice(`Shield absorb ${Math.round(detail.absorb)}`, 1.2);\r\n  }\r\n}\r\n\r\nfunction handleShieldShatter(event) {\r\n  if (!shouldCapture(\"shield\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const ttl = 0.45;\r\n  const center = {\r\n    x: detail.center?.x ?? stickman.x,\r\n    y: detail.center?.y ?? stickman.y\r\n  };\r\n  shieldBursts.push({\r\n    type: \"shatter\",\r\n    center,\r\n    ttl,\r\n    maxTtl: ttl\r\n  });\r\n  const reason = detail.reason ?? \"shatter\";\r\n  pushNotice(`Shield ${reason}`, 1.6);\r\n}\r\n\r\nfunction handleShieldEnd(event) {\r\n  if (!shouldCapture(\"shield\")) {\r\n    return;\r\n  }\r\n  const reason = event?.detail?.reason ?? \"ended\";\r\n  if (reason === \"shatter\") {\r\n    return;\r\n  }\r\n  pushNotice(`Shield ${reason}`, 1.4);\r\n}\r\n\r\nfunction handleThrowableThrown(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const effect = detail.effectType ?? \"unknown\";\r\n  pushNotice(`Throwable thrown (${effect})`, 1.4);\r\n}\r\n\r\nfunction handleThrowableExplosion(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  pushThrowableBurst(\"explosion\", detail, 0.55);\r\n  if (detail.damage !== undefined) {\r\n    pushNotice(`Explosion damage ${detail.damage}`, 1.6);\r\n  } else {\r\n    pushNotice(\"Explosion triggered\", 1.4);\r\n  }\r\n}\r\n\r\nfunction handleThrowableFlashBurst(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  pushThrowableBurst(\"flash\", detail, 0.45);\r\n  const stunDuration = detail.stunDuration ?? 0;\r\n  const stunLabel = typeof stunDuration === \"number\" ? stunDuration.toFixed(1) : String(stunDuration);\r\n  pushNotice(`Flash burst (stun ${stunLabel}s)`, 1.6);\r\n}\r\n\r\nfunction handleThrowableSmokeDetonate(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const burst = pushThrowableBurst(\"smoke\", detail, 0.6);\r\n  burst.maxRadius = detail.radius ?? burst.radius;\r\n  const durationSeconds = Math.round(((detail.duration ?? 0) + Number.EPSILON) * 10) / 10;\r\n  pushNotice(`Smoke deployed (${durationSeconds}s)`, 1.6);\r\n}\r\n\r\nfunction handleThrowableSmokeDissipate(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  pushThrowableBurst(\"smoke-fade\", detail, 0.4);\r\n  pushNotice(\"Smoke dissipated\", 1.4);\r\n}\r\n\r\nlet listenersRegistered = false;\r\n\r\nfunction ensureListeners() {\r\n  if (listenersRegistered || typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.addEventListener(\"weapon:muzzle-flash\", handleMuzzleFlash);\r\n  window.addEventListener(\"weapon:shot-fired\", handleShotFired);\r\n  window.addEventListener(\"weapon:reload-start\", handleReloadStart);\r\n  window.addEventListener(\"weapon:reload-finish\", handleReloadFinish);\r\n  window.addEventListener(\"weapon:recoil-kick\", handleRecoilKick);\r\n  window.addEventListener(\"shield:hit\", handleShieldHit);\r\n  window.addEventListener(\"shield:shatter\", handleShieldShatter);\r\n  window.addEventListener(\"shield:end\", handleShieldEnd);\r\n  window.addEventListener(\"throwable:thrown\", handleThrowableThrown);\r\n  window.addEventListener(\"throwable:explosion\", handleThrowableExplosion);\r\n  window.addEventListener(\"throwable:flash-burst\", handleThrowableFlashBurst);\r\n  window.addEventListener(\"throwable:smoke-detonate\", handleThrowableSmokeDetonate);\r\n  window.addEventListener(\"throwable:smoke-dissipate\", handleThrowableSmokeDissipate);\r\n  window.addEventListener(\"keydown\", handleFilterToggle);\r\n  listenersRegistered = true;\r\n}\r\n\r\nfunction updateList(list, delta) {\r\n  for (let i = list.length - 1; i >= 0; i -= 1) {\r\n    const entry = list[i];\r\n    entry.ttl -= delta;\r\n    entry.age = (entry.age ?? 0) + delta;\r\n    if (entry.ttl <= 0) {\r\n      list.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updatePolishDebug(delta) {\r\n  ensureListeners();\r\n  updateList(muzzleFlashes, delta);\r\n  updateList(shieldBursts, delta);\r\n  updateList(throwableBursts, delta);\r\n  updateList(notices, delta);\r\n  updateList(shotIndicators, delta);\r\n}\r\n\r\nfunction getPolishDebugState() {\r\n  ensureListeners();\r\n  return {\r\n    muzzleFlashes,\r\n    shieldBursts,\r\n    throwableBursts,\r\n    notices,\r\n    shotIndicators,\r\n    filters: { ...filters }\r\n  };\r\n}\r\n\r\nexport { updatePolishDebug, getPolishDebugState };\r\n","import { getElapsedTime } from \"../core/utils/time.js\";\r\n\r\n\r\nconst recoilState = {\r\n  horizontalKick: 0,\r\n  verticalKick: 0,\r\n  decay: 12,\r\n  lastShotTime: 0\r\n};\r\n\r\nfunction applyRecoil(kick) {\r\n  recoilState.horizontalKick += kick?.horizontal ?? 0;\r\n  recoilState.verticalKick += kick?.vertical ?? 0;\r\n  recoilState.decay = kick?.decay ?? recoilState.decay;\r\n  recoilState.lastShotTime = getElapsedTime();\r\n}\r\n\r\nfunction updateRecoil(delta) {\r\n  const decayRate = recoilState.decay ?? 12;\r\n  const decayFactor = Math.max(0, 1 - decayRate * delta);\r\n  recoilState.horizontalKick *= decayFactor;\r\n  recoilState.verticalKick *= decayFactor;\r\n}\r\n\r\nfunction getRecoilOffset() {\r\n  return {\r\n    horizontal: recoilState.horizontalKick,\r\n    vertical: recoilState.verticalKick\r\n  };\r\n}\r\n\r\nexport { applyRecoil, updateRecoil, getRecoilOffset };\r\n\r\n\r\n","import { context } from \"../../environment/canvas.js\";\nimport { DEBUG_PLATFORMS, LEVEL_WATER_ZONES, LEVEL_DECOR } from \"../../config/constants.js\";\n\nfunction resolvePlatformLanding(entity, previousY, height) {\n  const prevFeet = previousY + height;\n  for (const platform of DEBUG_PLATFORMS) {\n    if (entity.vy < 0) {\n      continue;\n    }\n    const nextFeet = entity.y + height;\n    if (prevFeet <= platform.y && nextFeet >= platform.y) {\n      if (entity.x >= platform.x && entity.x <= platform.x + platform.width) {\n        entity.y = platform.y - height;\n        entity.vy = 0;\n        if (Object.prototype.hasOwnProperty.call(entity, \"onGround\")) {\n          entity.onGround = true;\n        }\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nconst PLATFORM_STYLES = {\n  street: { fill: \"#2c2f36\", stroke: \"#1b1d22\" },\n  metro: { fill: \"#3d4252\", stroke: \"#272b37\" },\n  rooftop: { fill: \"#4c5566\", stroke: \"#2f3541\" },\n  skybridge: { fill: \"#596274\", stroke: \"#323846\" },\n  terrace: { fill: \"#46505f\", stroke: \"#2a303b\" },\n  balcony: { fill: \"#525a6a\", stroke: \"#2f3540\" },\n  median: { fill: \"#3a404a\", stroke: \"#23272f\" },\n  plain: { fill: \"#36404c\", stroke: \"#222730\" }\n};\n\nfunction drawWaterBodies() {\n  for (const zone of LEVEL_WATER_ZONES) {\n    const gradient = context.createLinearGradient(zone.x, zone.top, zone.x, zone.top + zone.depth);\n    gradient.addColorStop(0, \"rgba(54, 98, 144, 0.88)\");\n    gradient.addColorStop(0.7, \"rgba(36, 72, 112, 0.9)\");\n    gradient.addColorStop(1, \"rgba(24, 50, 84, 0.95)\");\n    context.fillStyle = gradient;\n    context.fillRect(zone.x, zone.top, zone.width, zone.depth);\n\n    context.fillStyle = \"rgba(255, 204, 112, 0.25)\";\n    context.fillRect(zone.x - 10, zone.top + 2, zone.width + 20, 4);\n\n    context.strokeStyle = \"rgba(255, 255, 255, 0.12)\";\n    context.lineWidth = 1.6;\n    for (let i = 0; i < zone.width; i += 40) {\n      const waveY = zone.top + 6 + Math.sin((i + zone.top) * 0.03) * 3;\n      context.beginPath();\n      context.moveTo(zone.x + i, waveY);\n      context.quadraticCurveTo(zone.x + i + 10, waveY + 3, zone.x + i + 20, waveY);\n      context.stroke();\n    }\n  }\n}\n\nfunction drawPlatform(platform) {\n  const style = PLATFORM_STYLES[platform.type] ?? PLATFORM_STYLES.plain;\n  context.fillStyle = style.fill;\n  context.fillRect(platform.x, platform.y, platform.width, platform.height);\n  context.strokeStyle = style.stroke;\n  context.lineWidth = 2;\n  context.strokeRect(platform.x, platform.y, platform.width, platform.height);\n}\n\nfunction drawDecor() {\n  for (const decor of LEVEL_DECOR) {\n    switch (decor.type) {\n      case \"building\": {\n        context.save();\n        context.fillStyle = \"#2a3240\";\n        context.fillRect(decor.x, decor.y, decor.width, decor.height);\n        context.fillStyle = \"#4a6076\";\n        const floors = Math.max(3, Math.floor(decor.height / 60));\n        for (let f = 0; f < floors; f += 1) {\n          const y = decor.y + 20 + f * (decor.height / floors);\n          context.fillRect(decor.x + 10, y, decor.width - 20, 8);\n        }\n        context.restore();\n        break;\n      }\n      case \"billboard\": {\n        context.save();\n        context.fillStyle = \"#1f2330\";\n        context.fillRect(decor.x - decor.width / 2, decor.y - decor.height, decor.width, decor.height);\n        context.fillStyle = \"#ffc851\";\n        context.font = \"18px 'Segoe UI', Arial, sans-serif\";\n        context.textAlign = \"center\";\n        context.fillText(decor.text ?? \"Ad\", decor.x, decor.y - decor.height / 2);\n        context.strokeStyle = \"#ffa940\";\n        context.lineWidth = 3;\n        context.strokeRect(decor.x - decor.width / 2, decor.y - decor.height, decor.width, decor.height);\n        context.restore();\n        break;\n      }\n      case \"streetlight\": {\n        context.save();\n        context.strokeStyle = \"#707789\";\n        context.lineWidth = 4;\n        context.beginPath();\n        context.moveTo(decor.x, decor.y + 140);\n        context.lineTo(decor.x, decor.y + 30);\n        context.stroke();\n        context.fillStyle = \"#ffd97a\";\n        context.beginPath();\n        context.arc(decor.x, decor.y + 12, 10, 0, Math.PI * 2);\n        context.fill();\n        context.restore();\n        break;\n      }\n      case \"hovercar\": {\n        context.save();\n        context.fillStyle = \"#5d8fff\";\n        context.beginPath();\n        context.ellipse(decor.x, decor.y, 46, 16, 0, 0, Math.PI * 2);\n        context.fill();\n        context.fillStyle = \"#1f2536\";\n        context.fillRect(decor.x - 26, decor.y - 8, 52, 16);\n        context.restore();\n        break;\n      }\n      default:\n        break;\n    }\n  }\n}\n\nfunction drawDebugArena() {\n  drawWaterBodies();\n  for (const platform of DEBUG_PLATFORMS) {\n    drawPlatform(platform);\n  }\n  drawDecor();\n}\n\nexport { resolvePlatformLanding, drawDebugArena };\r\n","import { GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { SPEED, GRAVITY, POSES } from \"../../config/constants.js\";\r\nimport { SQUAD_COMMANDS, SQUAD_SETTINGS } from \"../../config/squad.js\";\r\nimport { stickman, squadmates, enemies, getTotalHeight } from \"../../state/entities.js\";\r\nimport { resolvePlatformLanding } from \"../world/arena.js\";\r\nimport { spawnProjectile } from \"../combat/projectiles.js\";\r\n\r\nfunction getActiveCommand() {\r\n  return SQUAD_COMMANDS[stickman.squadCommandIndex % SQUAD_COMMANDS.length] ?? SQUAD_COMMANDS[0];\r\n}\r\n\r\nfunction cycleSquadCommand() {\r\n  if (stickman.squadCommandCooldown > 0) {\r\n    return getActiveCommand();\r\n  }\r\n  stickman.squadCommandIndex = (stickman.squadCommandIndex + 1) % SQUAD_COMMANDS.length;\r\n  const command = getActiveCommand();\r\n  stickman.squadCommandId = command?.id ?? stickman.squadCommandId;\r\n  stickman.squadCommandCooldown = SQUAD_SETTINGS.commandCooldown;\r\n  return command;\r\n}\r\n\r\nfunction setSquadCommandById(commandId) {\r\n  const index = SQUAD_COMMANDS.findIndex((command) => command.id === commandId);\r\n  if (index >= 0) {\r\n    stickman.squadCommandIndex = index;\r\n    stickman.squadCommandId = commandId;\r\n    stickman.squadCommandCooldown = SQUAD_SETTINGS.commandCooldown;\r\n  }\r\n}\r\n\r\nfunction findNearestEnemy(x, y) {\r\n  let best = null;\r\n  let bestDist = Number.POSITIVE_INFINITY;\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const dx = enemy.x - x;\r\n    const dy = (enemy.y + enemy.height * 0.5) - y;\r\n    const dist = Math.hypot(dx, dy);\r\n    if (dist < bestDist) {\r\n      bestDist = dist;\r\n      best = enemy;\r\n    }\r\n  }\r\n  return best;\r\n}\r\n\r\nfunction updateMovement(entity, delta) {\r\n  entity.vy += GRAVITY * delta;\r\n  const previousY = entity.y;\r\n  entity.x += entity.vx * delta;\r\n  entity.y += entity.vy * delta;\r\n  entity.onGround = false;\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  const landed = resolvePlatformLanding(entity, previousY, standingHeight);\r\n  if (!landed) {\r\n    const feetY = entity.y + standingHeight;\r\n    if (feetY >= GROUND_Y) {\r\n      entity.y = GROUND_Y - standingHeight;\r\n      entity.vy = 0;\r\n      entity.onGround = true;\r\n    }\r\n  }\r\n  entity.vx = Math.max(-SPEED, Math.min(SPEED, entity.vx));\r\n}\r\n\r\nfunction steerTowards(entity, targetX, delta, speedFactor = 1) {\r\n  const desired = targetX - entity.x;\r\n  const threshold = 12;\r\n  entity.vx = 0;\r\n  if (Math.abs(desired) > threshold) {\r\n    const dir = Math.sign(desired);\r\n    entity.vx = dir * SPEED * speedFactor;\r\n    entity.facing = dir;\r\n  }\r\n}\r\n\r\nfunction fireAtTarget(entity, target, delta) {\r\n  entity.fireCooldown = Math.max(0, (entity.fireCooldown ?? 0) - delta);\r\n  if (entity.fireCooldown > 0) {\r\n    return;\r\n  }\r\n  entity.fireCooldown = SQUAD_SETTINGS.supportFireCooldown;\r\n  const facing = target.x >= entity.x ? 1 : -1;\r\n  const muzzleX = entity.x + facing * 24;\r\n  const muzzleY = entity.y + getTotalHeight(POSES.standing) * 0.4;\r\n  spawnProjectile({\r\n    x: muzzleX,\r\n    y: muzzleY,\r\n    vx: facing * SQUAD_SETTINGS.projectileSpeed,\r\n    vy: -20,\r\n    radius: 5,\r\n    lifetime: 0.8,\r\n    color: facing > 0 ? \"#8cffd4\" : \"#a0ffe1\",\r\n    damage: SQUAD_SETTINGS.projectileDamage,\r\n    knockback: 110,\r\n    facing\r\n  });\r\n  entity.flashTimer = 0.12;\r\n}\r\n\r\nfunction updateSquadmate(squadmate, delta) {\r\n  const command = getActiveCommand();\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  const feetY = squadmate.y + standingHeight;\r\n  if (feetY >= GROUND_Y - 2 && Math.abs(squadmate.vy) < 1) {\r\n    squadmate.onGround = true;\r\n  }\r\n\r\n  squadmate.targetEnemyId = null;\r\n\r\n  switch (command?.id) {\r\n    case \"attack\": {\r\n      const target = findNearestEnemy(squadmate.x, squadmate.y);\r\n      if (target && Math.abs(target.x - stickman.x) <= SQUAD_SETTINGS.commandRange) {\r\n        steerTowards(squadmate, target.x - 24, delta, 0.95);\r\n        fireAtTarget(squadmate, target, delta);\r\n        squadmate.targetEnemyId = target.id;\r\n      } else {\r\n        steerTowards(squadmate, stickman.x - 60, delta, 0.8);\r\n      }\r\n      break;\r\n    }\r\n    case \"defend\": {\r\n      const offset = (squadmate.roleIndex ?? 0) * 40 - 40;\r\n      steerTowards(squadmate, stickman.x + offset, delta, 0.7);\r\n      const target = findNearestEnemy(squadmate.x, squadmate.y);\r\n      if (target && Math.abs(target.x - stickman.x) <= SQUAD_SETTINGS.defendRadius) {\r\n        fireAtTarget(squadmate, target, delta);\r\n        squadmate.targetEnemyId = target.id;\r\n      }\r\n      break;\r\n    }\r\n    case \"flank\": {\r\n      const flankSide = (squadmate.roleIndex ?? 0) % 2 === 0 ? -1 : 1;\r\n      const offset = flankSide * SQUAD_SETTINGS.flankOffset;\r\n      steerTowards(squadmate, stickman.x + offset, delta, 0.9);\r\n      const target = findNearestEnemy(squadmate.x, squadmate.y);\r\n      if (target) {\r\n        fireAtTarget(squadmate, target, delta);\r\n        squadmate.targetEnemyId = target.id;\r\n      }\r\n      break;\r\n    }\r\n    case \"hold\":\r\n    default: {\r\n      const offset = (squadmate.roleIndex ?? 0) * 36 - 36;\r\n      steerTowards(squadmate, stickman.x + offset, delta, 0.6);\r\n      break;\r\n    }\r\n  }\r\n\r\n  updateMovement(squadmate, delta);\r\n  squadmate.flashTimer = Math.max(0, (squadmate.flashTimer ?? 0) - delta);\r\n}\r\n\r\nfunction updateSquadmates(delta) {\r\n  stickman.squadCommandCooldown = Math.max(0, stickman.squadCommandCooldown - delta);\r\n  let roleIndex = 0;\r\n  for (const squadmate of squadmates) {\r\n    squadmate.roleIndex = roleIndex;\r\n    roleIndex += 1;\r\n    updateSquadmate(squadmate, delta);\r\n  }\r\n}\r\n\r\nfunction getSquadStatus() {\r\n  return {\r\n    command: getActiveCommand(),\r\n    cooldown: stickman.squadCommandCooldown,\r\n    members: squadmates\r\n  };\r\n}\r\n\r\nexport { updateSquadmates, cycleSquadCommand, setSquadCommandById, getSquadStatus };\r\n","import { canvas, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { vehicles, VEHICLE_DEFINITIONS, getVehicleById } from \"../../state/vehicles.js\";\r\nimport { stickman, getTotalHeight } from \"../../state/entities.js\";\r\nimport { input } from \"../input/index.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { spawnProjectile } from \"../combat/projectiles.js\";\r\nimport { POSES, GRAVITY } from \"../../config/constants.js\";\r\n\r\nconst PLAYER_DRIVER_ID = \"player-stickman\";\r\n\r\nfunction getPlayerVehicle() {\r\n  return stickman.vehicleId ? getVehicleById(stickman.vehicleId) : null;\r\n}\r\n\r\nfunction applyIdleDrag(vehicle, dragAmount, delta) {\r\n  if (dragAmount <= 0) {\r\n    return;\r\n  }\r\n  const drag = dragAmount * delta;\r\n  if (vehicle.vx > 0) {\r\n    vehicle.vx = Math.max(0, vehicle.vx - drag);\r\n  } else if (vehicle.vx < 0) {\r\n    vehicle.vx = Math.min(0, vehicle.vx + drag);\r\n  }\r\n}\r\n\r\nfunction applyGroundDriverInput(vehicle, definition, delta) {\r\n  const accelerateRight = input.right && !input.left;\r\n  const accelerateLeft = input.left && !input.right;\r\n  const direction = accelerateRight ? 1 : accelerateLeft ? -1 : 0;\r\n  const acceleration = definition.acceleration ?? 0;\r\n  const braking = definition.braking ?? 600;\r\n  const maxSpeed = definition.maxSpeed ?? 360;\r\n  const idleDrag = definition.idleDrag ?? 0;\r\n\r\n  if (direction !== 0 && acceleration > 0) {\r\n    vehicle.vx += direction * acceleration * delta;\r\n  }\r\n\r\n  if (input.down && vehicle.onGround && braking > 0) {\r\n    const brake = braking * delta;\r\n    if (vehicle.vx > 0) {\r\n      vehicle.vx = Math.max(0, vehicle.vx - brake);\r\n    } else if (vehicle.vx < 0) {\r\n      vehicle.vx = Math.min(0, vehicle.vx + brake);\r\n    }\r\n  } else if (direction === 0) {\r\n    applyIdleDrag(vehicle, idleDrag, delta);\r\n  }\r\n\r\n  if (maxSpeed > 0) {\r\n    vehicle.vx = clamp(vehicle.vx, -maxSpeed, maxSpeed);\r\n  }\r\n\r\n  if (direction !== 0) {\r\n    vehicle.facing = direction;\r\n  } else if (Math.abs(vehicle.vx) > 8) {\r\n    vehicle.facing = vehicle.vx > 0 ? 1 : -1;\r\n  }\r\n}\r\n\r\nfunction syncStickmanWithVehicle(vehicle, definition) {\r\n  const seat = definition.driverSeat ?? { x: 0, y: definition.height };\r\n  const baseHeight = getTotalHeight(POSES.standing);\r\n  const seatWorldX = vehicle.x + seat.x;\r\n  const seatWorldY = vehicle.y + seat.y;\r\n  const clampedX = clamp(seatWorldX, 40, canvas.width - 40);\r\n  stickman.x = clampedX;\r\n  stickman.y = seatWorldY - baseHeight;\r\n  stickman.vx = vehicle.vx;\r\n  stickman.vy = vehicle.vy;\r\n  const movementType = definition.movementType ?? \"ground\";\r\n  if (movementType === \"air\") {\r\n    stickman.onGround = false;\r\n  } else if (movementType === \"water\") {\r\n    stickman.onGround = true;\r\n  } else {\r\n    stickman.onGround = vehicle.onGround;\r\n  }\r\n  stickman.facing = vehicle.facing ?? stickman.facing;\r\n}\r\n\r\nfunction enterVehicle(vehicle) {\r\n  const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n  if (!definition) {\r\n    return;\r\n  }\r\n\r\n  vehicle.driverId = PLAYER_DRIVER_ID;\r\n  vehicle.enterCooldown = 0.45;\r\n  stickman.vehicleId = vehicle.id;\r\n  stickman.controlMode = \"vehicle\";\r\n  stickman.vehicleCandidateId = null;\r\n  stickman.attacking = false;\r\n  stickman.currentAttack = null;\r\n  stickman.attackIndex = -1;\r\n  stickman.attackElapsed = 0;\r\n  stickman.comboWindowOpen = false;\r\n  stickman.comboWindowTimer = 0;\r\n  stickman.nextAttackQueued = false;\r\n  stickman.hitboxSpawned = false;\r\n  stickman.activeHitboxes.length = 0;\r\n  stickman.crouching = false;\r\n  stickman.rolling = false;\r\n  syncStickmanWithVehicle(vehicle, definition);\r\n}\r\n\r\nfunction exitVehicle(vehicle, options = {}) {\r\n  const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n  if (!definition) {\r\n    stickman.vehicleId = null;\r\n    stickman.controlMode = \"onFoot\";\r\n    return;\r\n  }\r\n\r\n  vehicle.driverId = null;\r\n  if (!options.skipCooldown) {\r\n    vehicle.enterCooldown = Math.max(vehicle.enterCooldown, options.cooldown ?? 0.35);\r\n  }\r\n\r\n  const baseHeight = getTotalHeight(POSES.standing);\r\n  const preferRight = options.preferDirection ?? (vehicle.facing >= 0 ? 1 : -1);\r\n  const exitOffsets = definition.exitOffsets ?? [];\r\n  const fallbackOffset = preferRight >= 0 ? { x: definition.width * 0.6, y: 0 } : { x: -definition.width * 0.6, y: 0 };\r\n  const chosenOffset = preferRight >= 0 ? exitOffsets[0] ?? fallbackOffset : exitOffsets[1] ?? fallbackOffset;\r\n\r\n  stickman.vehicleId = null;\r\n  stickman.controlMode = \"onFoot\";\r\n  stickman.vehicleCandidateId = null;\r\n  stickman.x = clamp(vehicle.x + chosenOffset.x, 40, canvas.width - 40);\r\n  stickman.y = GROUND_Y - baseHeight;\r\n  if (options.inheritVelocity === false) {\r\n    stickman.vx = 0;\r\n    stickman.vy = 0;\r\n  } else {\r\n    stickman.vx = vehicle.vx * 0.5;\r\n    stickman.vy = Math.min(vehicle.vy, 0);\r\n  }\r\n  stickman.onGround = true;\r\n  stickman.facing = preferRight >= 0 ? 1 : -1;\r\n}\r\n\r\nfunction forcePlayerExitVehicle(options = {}) {\r\n  const vehicle = getPlayerVehicle();\r\n  if (!vehicle) {\r\n    stickman.vehicleId = null;\r\n    stickman.controlMode = \"onFoot\";\r\n    return;\r\n  }\r\n  exitVehicle(vehicle, { skipCooldown: true, inheritVelocity: false, ...options });\r\n}\r\n\r\nfunction handleVehicleInteraction(interactRequested) {\r\n  if (stickman.vehicleId) {\r\n    stickman.vehicleCandidateId = null;\r\n    const vehicle = getPlayerVehicle();\r\n    if (interactRequested && vehicle && vehicle.enterCooldown <= 0.01) {\r\n      exitVehicle(vehicle, { preferDirection: vehicle.facing });\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (stickman.health <= 0) {\r\n    stickman.vehicleCandidateId = null;\r\n    return;\r\n  }\r\n\r\n  let bestVehicle = null;\r\n  let bestScore = Number.POSITIVE_INFINITY;\r\n  const playerHeight = getTotalHeight(POSES.standing);\r\n  const playerFeetY = stickman.y + playerHeight;\r\n\r\n  for (const vehicle of vehicles) {\r\n    const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n    if (!definition) {\r\n      continue;\r\n    }\r\n    if (vehicle.driverId) {\r\n      continue;\r\n    }\r\n    if (vehicle.enterCooldown > 0) {\r\n      continue;\r\n    }\r\n\r\n    const horizontal = Math.abs(stickman.x - vehicle.x);\r\n    const maxHorizontal = definition.enterRadius ?? 64;\r\n    if (horizontal > maxHorizontal) {\r\n      continue;\r\n    }\r\n\r\n    const vehicleFeet = vehicle.y + definition.height;\r\n    const vertical = Math.abs(playerFeetY - vehicleFeet);\r\n    const movementType = definition.movementType ?? \"ground\";\r\n    let verticalAllowance;\r\n    if (movementType === \"air\") {\r\n      verticalAllowance = Math.max(120, (definition.hoverMinAltitude ?? 0) + 80);\r\n    } else if (movementType === \"water\") {\r\n      verticalAllowance = Math.max(90, (definition.waterSurfaceOffset ?? 24) + 70);\r\n    } else {\r\n      verticalAllowance = 80;\r\n    }\r\n    if (vertical > verticalAllowance) {\r\n      continue;\r\n    }\r\n\r\n    const score = horizontal + vertical * 0.5;\r\n    if (score < bestScore) {\r\n      bestScore = score;\r\n      bestVehicle = vehicle;\r\n    }\r\n  }\r\n\r\n  stickman.vehicleCandidateId = bestVehicle?.id ?? null;\r\n\r\n  if (interactRequested && bestVehicle) {\r\n    enterVehicle(bestVehicle);\r\n  }\r\n}\r\n\r\nfunction updateGroundVehicle(vehicle, definition, delta, isControlled) {\r\n  if (isControlled) {\r\n    applyGroundDriverInput(vehicle, definition, delta);\r\n  } else {\r\n    applyIdleDrag(vehicle, definition.idleDrag ?? 0, delta);\r\n  }\r\n\r\n  const airDrag = definition.airDrag ?? 1;\r\n  if (!vehicle.onGround && airDrag > 0 && airDrag < 1) {\r\n    vehicle.vx *= Math.pow(airDrag, Math.max(0, delta * 60));\r\n  }\r\n\r\n  vehicle.vy += GRAVITY * delta;\r\n  vehicle.x += vehicle.vx * delta;\r\n  vehicle.y += vehicle.vy * delta;\r\n\r\n  const groundTop = GROUND_Y - definition.height;\r\n  if (vehicle.y >= groundTop) {\r\n    vehicle.y = groundTop;\r\n    vehicle.vy = 0;\r\n    vehicle.onGround = true;\r\n  } else {\r\n    vehicle.onGround = false;\r\n  }\r\n\r\n  const halfWidth = definition.width * 0.5;\r\n  const minX = halfWidth + 32;\r\n  const maxX = canvas.width - halfWidth - 32;\r\n  vehicle.x = clamp(vehicle.x, minX, maxX);\r\n  if (vehicle.x === minX || vehicle.x === maxX) {\r\n    vehicle.vx = 0;\r\n  }\r\n\r\n  const targetTilt = clamp(vehicle.vx / Math.max(1, definition.maxSpeed ?? 360) * 0.12, -0.25, 0.25);\r\n  vehicle.tilt += (targetTilt - vehicle.tilt) * Math.min(1, delta * 10);\r\n}\r\n\r\nfunction updateWaterVehicle(vehicle, definition, delta, isControlled) {\r\n  const acceleration = definition.waterAcceleration ?? definition.acceleration ?? 220;\r\n  const maxSpeed = definition.waterMaxSpeed ?? definition.maxSpeed ?? 220;\r\n  const reverseSpeed = definition.waterReverseSpeed ?? Math.max(80, maxSpeed * 0.6);\r\n  const idleDrag = definition.waterIdleDrag ?? definition.idleDrag ?? 200;\r\n  const brakeStrength = (definition.turnDrag ?? 220);\r\n  const bobAmplitude = definition.bobAmplitude ?? 4;\r\n  const bobSpeed = definition.bobSpeed ?? 1.4;\r\n  const splashIntensity = definition.splashIntensity ?? 0.3;\r\n  const waterSurface = vehicle.waterLineY ?? (GROUND_Y - (definition.waterSurfaceOffset ?? 24));\r\n  const buoyancyPoint = definition.buoyancyPoint ?? 0.55;\r\n  const submergedOffset = definition.submergedOffset ?? 0;\r\n\r\n  const steerRight = isControlled && input.right && !input.left;\r\n  const steerLeft = isControlled && input.left && !input.right;\r\n  const direction = steerRight ? 1 : steerLeft ? -1 : 0;\r\n\r\n  if (direction !== 0 && acceleration > 0) {\r\n    vehicle.vx += direction * acceleration * delta;\r\n  } else {\r\n    applyIdleDrag(vehicle, idleDrag, delta);\r\n  }\r\n\r\n  if (isControlled && input.down) {\r\n    const brake = brakeStrength * delta;\r\n    if (vehicle.vx > 0) {\r\n      vehicle.vx = Math.max(vehicle.vx - brake, -reverseSpeed);\r\n    } else if (vehicle.vx < 0) {\r\n      vehicle.vx = Math.min(vehicle.vx + brake, reverseSpeed);\r\n    } else if (brake > 0) {\r\n      vehicle.vx = clamp(vehicle.vx - vehicle.facing * brake * 0.15, -reverseSpeed, reverseSpeed);\r\n    }\r\n  }\r\n\r\n  vehicle.vx = clamp(vehicle.vx, -reverseSpeed, maxSpeed);\r\n\r\n  if (direction !== 0) {\r\n    vehicle.facing = direction;\r\n  } else if (Math.abs(vehicle.vx) > 4) {\r\n    vehicle.facing = vehicle.vx > 0 ? 1 : -1;\r\n  }\r\n\r\n  vehicle.x += vehicle.vx * delta;\r\n  const halfWidth = definition.width * 0.5;\r\n  const minX = halfWidth + 32;\r\n  const maxX = canvas.width - halfWidth - 32;\r\n  vehicle.x = clamp(vehicle.x, minX, maxX);\r\n  if (vehicle.x === minX || vehicle.x === maxX) {\r\n    vehicle.vx = 0;\r\n  }\r\n\r\n  vehicle.vy = 0;\r\n\r\n  vehicle.bobPhase = (vehicle.bobPhase ?? 0) + delta * (bobSpeed * (isControlled ? 1.2 : 0.85));\r\n  const bobOffset = Math.sin(vehicle.bobPhase) * bobAmplitude;\r\n  const sprayOffset = Math.sin(vehicle.bobPhase * 0.5 + vehicle.x * 0.02) * splashIntensity * 6;\r\n  const targetY = waterSurface - definition.height * buoyancyPoint + submergedOffset + bobOffset + sprayOffset;\r\n  vehicle.y += (targetY - vehicle.y) * Math.min(1, delta * 6.5);\r\n\r\n  vehicle.onGround = false;\r\n\r\n  const tiltTarget = clamp(vehicle.vx / Math.max(1, maxSpeed) * 0.22 + Math.sin(vehicle.bobPhase + vehicle.facing * 0.4) * 0.05, -0.45, 0.45);\r\n  vehicle.tilt += (tiltTarget - vehicle.tilt) * Math.min(1, delta * 5);\r\n}\r\n\r\nfunction updateAirVehicle(vehicle, definition, delta, isControlled) {\r\n  const horizontalAcceleration = definition.horizontalAcceleration ?? definition.acceleration ?? 0;\r\n  const horizontalMaxSpeed = definition.horizontalMaxSpeed ?? definition.maxSpeed ?? 320;\r\n  const horizontalDrag = definition.horizontalDrag ?? definition.idleDrag ?? 200;\r\n  const airDrag = definition.airDrag ?? 0.97;\r\n  const minAltitude = definition.hoverMinAltitude ?? 0;\r\n  const maxAltitude = Math.max(minAltitude, definition.hoverMaxAltitude ?? minAltitude);\r\n  const altitudeRate = definition.altitudeRate ?? 160;\r\n  const autopilotStrength = definition.autopilotStrength ?? 4;\r\n  const verticalDamping = definition.verticalDamping ?? 0.9;\r\n  const maxVerticalSpeed = definition.maxVerticalSpeed ?? 220;\r\n  const liftPower = definition.liftPower ?? 0;\r\n  const descendPower = definition.descendPower ?? liftPower;\r\n\r\n  const accelerateRight = isControlled && input.right && !input.left;\r\n  const accelerateLeft = isControlled && input.left && !input.right;\r\n  const direction = accelerateRight ? 1 : accelerateLeft ? -1 : 0;\r\n\r\n  if (direction !== 0 && horizontalAcceleration > 0) {\r\n    vehicle.vx += direction * horizontalAcceleration * delta;\r\n  } else {\r\n    applyIdleDrag(vehicle, horizontalDrag, delta);\r\n  }\r\n\r\n  if (horizontalMaxSpeed > 0) {\r\n    vehicle.vx = clamp(vehicle.vx, -horizontalMaxSpeed, horizontalMaxSpeed);\r\n  }\r\n\r\n  if (direction !== 0) {\r\n    vehicle.facing = direction;\r\n  } else if (Math.abs(vehicle.vx) > 6) {\r\n    vehicle.facing = vehicle.vx > 0 ? 1 : -1;\r\n  }\r\n\r\n  vehicle.vx *= Math.pow(airDrag, delta * 60);\r\n\r\n  const gravity = GRAVITY * (definition.gravityScale ?? 0.25);\r\n  vehicle.vy += gravity * delta;\r\n\r\n  if (!Number.isFinite(vehicle.preferredAltitude)) {\r\n    vehicle.preferredAltitude = definition.spawnHover ?? minAltitude;\r\n  }\r\n\r\n  if (isControlled) {\r\n    if (input.jump) {\r\n      vehicle.preferredAltitude += altitudeRate * delta;\r\n    }\r\n    if (input.down) {\r\n      vehicle.preferredAltitude -= altitudeRate * delta;\r\n    }\r\n  } else {\r\n    const altitude = GROUND_Y - (vehicle.y + definition.height);\r\n    vehicle.preferredAltitude += (altitude - vehicle.preferredAltitude) * Math.min(1, delta * 0.5);\r\n  }\r\n\r\n  vehicle.preferredAltitude = clamp(vehicle.preferredAltitude, minAltitude, maxAltitude);\r\n\r\n  const altitude = clamp(GROUND_Y - (vehicle.y + definition.height), minAltitude, maxAltitude);\r\n  const altitudeError = vehicle.preferredAltitude - altitude;\r\n  vehicle.vy -= altitudeError * autopilotStrength * delta;\r\n\r\n  if (isControlled && liftPower > 0) {\r\n    if (input.jump) {\r\n      vehicle.vy -= liftPower * 0.25 * delta;\r\n    }\r\n    if (input.down) {\r\n      vehicle.vy += descendPower * 0.25 * delta;\r\n    }\r\n  }\r\n\r\n  vehicle.vy *= Math.pow(verticalDamping, delta * 60);\r\n  if (maxVerticalSpeed > 0) {\r\n    vehicle.vy = clamp(vehicle.vy, -maxVerticalSpeed, maxVerticalSpeed);\r\n  }\r\n\r\n  vehicle.x += vehicle.vx * delta;\r\n  vehicle.y += vehicle.vy * delta;\r\n\r\n  const halfWidth = definition.width * 0.5;\r\n  const minX = halfWidth + 32;\r\n  const maxX = canvas.width - halfWidth - 32;\r\n  vehicle.x = clamp(vehicle.x, minX, maxX);\r\n  if (vehicle.x === minX || vehicle.x === maxX) {\r\n    vehicle.vx = 0;\r\n  }\r\n\r\n  const newAltitude = clamp(GROUND_Y - (vehicle.y + definition.height), minAltitude, maxAltitude);\r\n  vehicle.y = GROUND_Y - definition.height - newAltitude;\r\n  if ((newAltitude === minAltitude && vehicle.vy > 0) || (newAltitude === maxAltitude && vehicle.vy < 0)) {\r\n    vehicle.vy = 0;\r\n  }\r\n\r\n  vehicle.onGround = false;\r\n\r\n  const targetTilt = clamp(vehicle.vx / Math.max(1, horizontalMaxSpeed) * 0.35 - altitudeError * 0.02, -0.6, 0.6);\r\n  vehicle.tilt += (targetTilt - vehicle.tilt) * Math.min(1, delta * 6);\r\n}\r\n\r\nfunction fireMountedWeaponProjectile(vehicle, mountDef, mountState, facingSign) {\r\n  const followFacing = mountDef.followVehicleFacing !== false;\r\n  const vehicleFacing = vehicle.facing ?? 1;\r\n  const appliedFacing = facingSign !== undefined ? facingSign : (mountDef.facing ?? 1) * (followFacing ? vehicleFacing : 1);\r\n  const offsetX = mountDef.offset?.x ?? 0;\r\n  const offsetY = mountDef.offset?.y ?? 0;\r\n  const facingMultiplier = followFacing ? vehicleFacing : 1;\r\n  const baseX = vehicle.x + offsetX * facingMultiplier;\r\n  const baseY = vehicle.y + offsetY;\r\n  const muzzles = mountDef.muzzles && mountDef.muzzles.length > 0 ? mountDef.muzzles : [{ x: mountDef.muzzle?.x ?? 0, y: mountDef.muzzle?.y ?? 0 }];\r\n  const muzzleIndex = mountState.muzzleIndex ?? 0;\r\n  const muzzle = muzzles[muzzleIndex % muzzles.length];\r\n  mountState.muzzleIndex = (muzzleIndex + 1) % muzzles.length;\r\n  const muzzleX = baseX + (muzzle?.x ?? 0) * facingMultiplier;\r\n  const muzzleY = baseY + (muzzle?.y ?? 0);\r\n\r\n  const projectileDef = mountDef.projectile ?? {};\r\n  const speed = projectileDef.speed ?? 600;\r\n  const scatterRadians = (mountDef.scatter ?? 0) * (Math.PI / 180);\r\n  const spreadAngle = scatterRadians > 0 ? (Math.random() - 0.5) * scatterRadians : 0;\r\n  const facingSignValue = appliedFacing >= 0 ? 1 : -1;\r\n  const vx = Math.cos(spreadAngle) * speed * facingSignValue;\r\n  const vy = Math.sin(spreadAngle) * speed + (projectileDef.verticalSpeed ?? 0);\r\n\r\n  spawnProjectile({\r\n    x: muzzleX,\r\n    y: muzzleY,\r\n    vx,\r\n    vy,\r\n    radius: projectileDef.radius ?? 5,\r\n    lifetime: projectileDef.lifetime ?? 1.3,\r\n    color: projectileDef.color ?? \"#ffd27a\",\r\n    damage: projectileDef.damage ?? 12,\r\n    knockback: projectileDef.knockback ?? 80,\r\n    facing: facingSignValue,\r\n    gravityFactor: projectileDef.gravityFactor ?? 0.12\r\n  });\r\n\r\n  mountState.flashTimer = mountDef.flashDuration ?? 0.1;\r\n  mountState.lastMuzzleX = muzzleX;\r\n  mountState.lastMuzzleY = muzzleY;\r\n}\r\n\r\nfunction updateMountedWeaponsForVehicle(vehicle, definition, delta, isControlled) {\r\n  const mountDefs = definition.mountedWeapons ?? [];\r\n  const mounts = vehicle.mounts ?? [];\r\n  if (mountDefs.length === 0 || mounts.length === 0) {\r\n    return;\r\n  }\r\n\r\n  const vehicleFacing = vehicle.facing ?? 1;\r\n  const wantsPrimary = isControlled && input.attackDown;\r\n  const wantsSecondary = isControlled && input.throwDown;\r\n\r\n  for (let index = 0; index < mountDefs.length; index += 1) {\r\n    const mountDef = mountDefs[index];\r\n    const mountState = mounts[index];\r\n    if (!mountDef || !mountState) {\r\n      continue;\r\n    }\r\n\r\n    mountState.cooldown = Math.max(0, (mountState.cooldown ?? 0) - delta);\r\n    mountState.flashTimer = Math.max(0, (mountState.flashTimer ?? 0) - delta);\r\n\r\n    let shouldFire = false;\r\n    const binding = mountDef.binding ?? \"primary\";\r\n    if (isControlled) {\r\n      if (binding === \"primary\") {\r\n        shouldFire = wantsPrimary;\r\n      } else if (binding === \"secondary\") {\r\n        shouldFire = wantsSecondary;\r\n      }\r\n    } else if (mountDef.autoFire) {\r\n      shouldFire = true;\r\n    }\r\n\r\n    if (!shouldFire || mountState.cooldown > 0) {\r\n      continue;\r\n    }\r\n\r\n    const followFacing = mountDef.followVehicleFacing !== false;\r\n    const facingSign = (mountDef.facing ?? 1) * (followFacing ? vehicleFacing : 1);\r\n    fireMountedWeaponProjectile(vehicle, mountDef, mountState, facingSign);\r\n    mountState.cooldown = mountDef.fireInterval ?? 0.2;\r\n  }\r\n}\r\n\r\nfunction updateVehicles(delta) {\r\n  for (const vehicle of vehicles) {\r\n    const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n    if (!definition) {\r\n      continue;\r\n    }\r\n\r\n    vehicle.enterCooldown = Math.max(0, vehicle.enterCooldown - delta);\r\n    vehicle.damageFlash = Math.max(0, vehicle.damageFlash - delta);\r\n\r\n    const isControlled = vehicle.driverId === PLAYER_DRIVER_ID;\r\n    const movementType = definition.movementType ?? \"ground\";\r\n\r\n    if (movementType === \"air\") {\r\n      updateAirVehicle(vehicle, definition, delta, isControlled);\r\n    } else if (movementType === \"water\") {\r\n      updateWaterVehicle(vehicle, definition, delta, isControlled);\r\n    } else {\r\n      updateGroundVehicle(vehicle, definition, delta, isControlled);\r\n    }\r\n\r\n    updateMountedWeaponsForVehicle(vehicle, definition, delta, isControlled);\r\n\r\n    if (isControlled) {\r\n      syncStickmanWithVehicle(vehicle, definition);\r\n    } else if (movementType === \"ground\") {\r\n      vehicle.tilt += (0 - vehicle.tilt) * Math.min(1, delta * 10);\r\n    }\r\n  }\r\n}\r\n\r\nexport { updateVehicles, handleVehicleInteraction, getPlayerVehicle, forcePlayerExitVehicle };","import { context, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { POSES, SPEED } from \"../../config/constants.js\";\r\nimport { stickman, trainingDummy, enemies, squadmates, getRemotePlayers } from \"../../state/entities.js\";\r\nimport { getServerBrowserState } from \"../../state/serverBrowser.js\";\r\nimport { vehicles, VEHICLE_DEFINITIONS, getVehicleById } from \"../../state/vehicles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { getElapsedTime } from \"../utils/time.js\";\r\nimport { getCurrentWeapon, getWeaponSlots } from \"../combat/weapons.js\";\r\nimport { getAmmoStatus } from \"../../state/ammo.js\";\r\nimport { drawProjectiles } from \"../combat/projectiles.js\";\r\nimport { drawThrowables } from \"../combat/throwables.js\";\r\nimport { drawGadgets, getGadgetStatus } from \"../gadgets/index.js\";\r\nimport { drawSupplyDrops } from \"./supplyDrops.js\";\r\nimport { drawDestructibles } from \"./destructibles.js\";\r\nimport { drawParticles } from \"../effects/particles.js\";\r\nimport { getPolishDebugState } from \"../events/polishDebug.js\";\r\nimport { getRecoilOffset } from \"../../state/recoil.js\";\r\nimport { getSupplyDropStatus } from \"../world/supplyDrops.js\";\r\nimport { getP2PStatus } from \"../network/p2p.js\";\r\nimport { getSquadStatus } from \"../squad/index.js\";\r\nimport { getPlayerVehicle } from \"../vehicles/index.js\";\r\n\r\nfunction drawBackground() {\r\n  const skyGradient = context.createLinearGradient(0, 0, 0, context.canvas.height);\r\n  skyGradient.addColorStop(0, \"#111a2c\");\r\n  skyGradient.addColorStop(0.4, \"#182439\");\r\n  skyGradient.addColorStop(0.75, \"#1f2d44\");\r\n  skyGradient.addColorStop(1, \"#232f49\");\r\n  context.fillStyle = skyGradient;\r\n  context.fillRect(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n  // distant skyline\r\n  context.fillStyle = \"#1a2437\";\r\n  context.beginPath();\r\n  context.moveTo(0, GROUND_Y - 220);\r\n  context.lineTo(220, GROUND_Y - 260);\r\n  context.lineTo(420, GROUND_Y - 210);\r\n  context.lineTo(640, GROUND_Y - 280);\r\n  context.lineTo(820, GROUND_Y - 230);\r\n  context.lineTo(1040, GROUND_Y - 260);\r\n  context.lineTo(1220, GROUND_Y - 210);\r\n  context.lineTo(1380, GROUND_Y - 260);\r\n  context.lineTo(context.canvas.width, GROUND_Y - 200);\r\n  context.lineTo(context.canvas.width, GROUND_Y);\r\n  context.lineTo(0, GROUND_Y);\r\n  context.closePath();\r\n  context.fill();\r\n\r\n  // far water sheen behind coastline\r\n  const horizon = context.createLinearGradient(0, GROUND_Y - 120, 0, GROUND_Y - 40);\r\n  horizon.addColorStop(0, \"rgba(46, 86, 126, 0.25)\");\r\n  horizon.addColorStop(1, \"rgba(28, 52, 84, 0)\");\r\n  context.fillStyle = horizon;\r\n  context.fillRect(0, GROUND_Y - 140, context.canvas.width, 120);\r\n\r\n  context.fillStyle = \"#1b2231\";\r\n  context.fillRect(0, GROUND_Y, context.canvas.width, context.canvas.height - GROUND_Y);\r\n}\r\n\r\nfunction drawVehicles() {\n  const playerVehicle = getPlayerVehicle();\n  const candidateId = stickman.vehicleCandidateId;\n\n  for (const vehicle of vehicles) {\n    const definition = VEHICLE_DEFINITIONS[vehicle.type];\n    if (!definition) {\n      continue;\n    }\n\n    const isPlayerVehicle = playerVehicle?.id === vehicle.id;\n    const isCandidate = !isPlayerVehicle && candidateId === vehicle.id;\n    const bodyWidth = definition.width ?? 120;\n    const bodyHeight = definition.height ?? 48;\n    const bodyColor = definition.colorBody ?? \"#2c3245\";\n    const accentColor = definition.colorAccent ?? \"#f0b239\";\n\n    context.save();\n    context.translate(vehicle.x, vehicle.y);\n    context.rotate(((vehicle.tilt ?? 0) * Math.PI) / 180);\n\n    context.fillStyle = bodyColor;\n    context.fillRect(-bodyWidth / 2, -bodyHeight / 2, bodyWidth, bodyHeight);\n\n    context.fillStyle = accentColor;\n    context.fillRect(-bodyWidth / 2, -bodyHeight / 2 - 6, bodyWidth * 0.6, 8);\n\n    context.restore();\n\n    if (isPlayerVehicle || isCandidate) {\n      context.save();\n      context.lineWidth = isPlayerVehicle ? 4 : 3;\n      context.strokeStyle = isPlayerVehicle ? \"#8cffd4\" : \"#ffc66d\";\n      context.setLineDash(isPlayerVehicle ? [] : [8, 8]);\n      context.strokeRect(\n        vehicle.x - bodyWidth / 2 - 10,\n        vehicle.y - bodyHeight / 2 - 12,\n        bodyWidth + 20,\n        bodyHeight + 24\n      );\n      context.restore();\n    }\n  }\n}\n\nfunction drawRemotePlayers() {\r\n  const players = getRemotePlayers();\r\n  for (const remote of players) {\r\n    const pose = POSES.standing;\r\n    const headRadius = pose.headRadius;\r\n    const bodyLength = pose.bodyLength;\r\n    const legLength = pose.legLength;\r\n    const armLength = pose.armLength;\r\n    context.save();\r\n    context.strokeStyle = \"#ff9cf7\";\r\n    context.lineWidth = 4;\r\n    const headCenterY = remote.y + headRadius;\r\n    context.beginPath();\r\n    context.arc(remote.x, headCenterY, headRadius, 0, Math.PI * 2);\r\n    context.stroke();\r\n    const neckY = remote.y + headRadius * 2;\r\n    const torsoBottomY = neckY + bodyLength;\r\n    context.beginPath();\r\n    context.moveTo(remote.x, neckY);\r\n    context.lineTo(remote.x, torsoBottomY);\r\n    context.stroke();\r\n    context.beginPath();\r\n    context.moveTo(remote.x, neckY + 4);\r\n    context.lineTo(remote.x - armLength, neckY + armLength * 0.8);\r\n    context.moveTo(remote.x, neckY + 4);\r\n    context.lineTo(remote.x + armLength, neckY + armLength * 0.6);\r\n    context.stroke();\r\n    const legReach = Math.max(armLength * 0.7, 14);\r\n    const leftFootY = Math.min(GROUND_Y, torsoBottomY + legLength);\r\n    const rightFootY = Math.min(GROUND_Y, torsoBottomY + legLength * 0.95);\r\n    context.beginPath();\r\n    context.moveTo(remote.x, torsoBottomY);\r\n    context.lineTo(remote.x - legReach, leftFootY);\r\n    context.moveTo(remote.x, torsoBottomY);\r\n    context.lineTo(remote.x + legReach, rightFootY);\r\n    context.stroke();\r\n    context.fillStyle = \"#ffd6ff\";\r\n    context.font = \"13px 'Segoe UI', Arial, sans-serif\";\r\n    context.textAlign = \"center\";\r\n    context.fillText(remote.name ?? remote.id ?? \"Peer\", remote.x, remote.y - 16);\r\n    context.restore();\r\n  }\r\n}\r\n\r\nfunction drawSquadmates() {\r\n  const squadStatus = getSquadStatus();\r\n  const commandId = squadStatus?.command?.id ?? \"hold\";\r\n  const commandColors = {\r\n    hold: \"#8cffd4\",\r\n    defend: \"#66b3ff\",\r\n    attack: \"#ff9f7a\",\r\n    flank: \"#ffdd6f\"\r\n  };\r\n  for (const ally of squadmates) {\r\n    const pose = POSES.standing;\r\n    const headRadius = pose.headRadius;\r\n    const bodyLength = pose.bodyLength;\r\n    const legLength = pose.legLength;\r\n    const armLength = pose.armLength;\r\n\r\n    context.save();\r\n    const outline = commandColors[commandId] ?? \"#8cffd4\";\r\n    context.strokeStyle = outline;\r\n    context.lineWidth = 4;\r\n    context.lineCap = \"round\";\r\n\r\n    const headCenterY = ally.y + headRadius;\r\n    context.beginPath();\r\n    context.arc(ally.x, headCenterY, headRadius, 0, Math.PI * 2);\r\n    context.stroke();\r\n\r\n    const neckY = ally.y + headRadius * 2;\r\n    const torsoBottomY = neckY + bodyLength;\r\n    context.beginPath();\r\n    context.moveTo(ally.x, neckY);\r\n    context.lineTo(ally.x, torsoBottomY);\r\n    context.stroke();\r\n\r\n    context.beginPath();\r\n    context.moveTo(ally.x, neckY + 4);\r\n    context.lineTo(ally.x - armLength, neckY + armLength * 0.8);\r\n    context.moveTo(ally.x, neckY + 4);\r\n    context.lineTo(ally.x + armLength, neckY + armLength * 0.6);\r\n    context.stroke();\r\n\r\n    const legReach = Math.max(armLength * 0.7, 14);\r\n    const leftFootY = Math.min(GROUND_Y, torsoBottomY + legLength);\r\n    const rightFootY = Math.min(GROUND_Y, torsoBottomY + legLength * 0.95);\r\n\r\n    context.beginPath();\r\n    context.moveTo(ally.x, torsoBottomY);\r\n    context.lineTo(ally.x - legReach, leftFootY);\r\n    context.moveTo(ally.x, torsoBottomY);\r\n    context.lineTo(ally.x + legReach, rightFootY);\r\n    context.stroke();\r\n\r\n    if ((ally.flashTimer ?? 0) > 0) {\r\n      const alpha = Math.min(1, ally.flashTimer / 0.12);\r\n      context.fillStyle = `rgba(140, 255, 212, ${alpha})`;\r\n      context.beginPath();\r\n      context.arc(ally.x + ally.facing * 30, neckY + armLength * 0.2, 12, 0, Math.PI * 2);\r\n      context.fill();\r\n    }\r\n\r\n    context.fillStyle = outline;\r\n    context.font = \"14px 'Segoe UI', Arial, sans-serif\";\r\n    context.textAlign = \"center\";\r\n    context.fillText(ally.name ?? \"Ally\", ally.x, ally.y - 12);\r\n    context.restore();\r\n  }\r\n}\r\n\r\nfunction drawStickman() {\r\n  if (stickman.health <= 0 || stickman.vehicleId) {\r\n    return;\r\n  }\r\n\r\n  const pose = stickman.currentPose || POSES.standing;\r\n  const attack = stickman.currentAttack;\r\n  const { headRadius, bodyLength, legLength, armLength, strideMultiplier, armSwingAmplitude, legSwingAmplitude } = pose;\r\n  const elapsed = getElapsedTime();\r\n\r\n  const baseStride = Math.min(1, Math.abs(stickman.vx) / SPEED);\r\n  const strideStrength = baseStride * strideMultiplier;\r\n\r\n  let swing = Math.sin(elapsed * 8) * armSwingAmplitude * strideStrength;\r\n  if (stickman.attacking && attack) {\r\n    const totalDuration = attack.windup + attack.active + attack.recovery;\r\n    const progress = clamp(stickman.attackElapsed / totalDuration, 0, 1);\r\n    swing += Math.sin(progress * Math.PI) * 28 * stickman.facing;\r\n  }\r\n\r\n  context.lineWidth = 4;\r\n  context.strokeStyle = \"#f4f7ff\";\r\n  context.lineCap = \"round\";\r\n\r\n  const headCenterY = stickman.y + headRadius;\r\n  context.beginPath();\r\n  context.arc(stickman.x, headCenterY, headRadius, 0, Math.PI * 2);\r\n  context.stroke();\r\n\r\n  const neckY = stickman.y + headRadius * 2;\r\n  const torsoBottomY = neckY + bodyLength;\r\n  context.beginPath();\r\n  context.moveTo(stickman.x, neckY);\r\n  context.lineTo(stickman.x, torsoBottomY);\r\n  context.stroke();\r\n\r\n  context.beginPath();\r\n  context.moveTo(stickman.x, neckY + 6);\r\n  context.lineTo(stickman.x - armLength, neckY + armLength + swing);\r\n  context.moveTo(stickman.x, neckY + 6);\r\n  context.lineTo(stickman.x + armLength, neckY + armLength - swing);\r\n  context.stroke();\r\n\r\n  const phaseOffset = Math.PI / 2;\r\n  const legSwingBase = Math.sin(elapsed * 8 + phaseOffset) * legSwingAmplitude * strideStrength;\r\n  const legReach = Math.max(armLength * 0.7, 14);\r\n  const leftFootY = Math.min(GROUND_Y, torsoBottomY + legLength + legSwingBase);\r\n  const rightFootY = Math.min(GROUND_Y, torsoBottomY + legLength - legSwingBase);\r\n\r\n  context.beginPath();\r\n  context.moveTo(stickman.x, torsoBottomY);\r\n  context.lineTo(stickman.x - legReach, leftFootY);\r\n  context.moveTo(stickman.x, torsoBottomY);\r\n  context.lineTo(stickman.x + legReach, rightFootY);\r\n  context.stroke();\r\n\r\n  if (stickman.rolling) {\r\n    context.strokeStyle = \"#9aa2b1\";\r\n    context.beginPath();\r\n    context.arc(stickman.x, torsoBottomY - legLength * 0.5, headRadius + 4, 0, Math.PI * 2);\r\n    context.stroke();\r\n    context.strokeStyle = \"#f4f7ff\";\r\n  }\r\n}\r\n\r\nfunction drawHitboxes() {\r\n  for (const hitbox of stickman.activeHitboxes) {\r\n    const alpha = clamp(hitbox.remaining / hitbox.duration, 0, 1);\r\n    context.fillStyle = `rgba(255, 153, 102, ${0.2 * alpha})`;\r\n    context.beginPath();\r\n    context.arc(hitbox.x, hitbox.y, hitbox.radius, 0, Math.PI * 2);\r\n    context.fill();\r\n\r\n    context.strokeStyle = `rgba(255, 198, 141, ${alpha})`;\r\n    context.lineWidth = 2;\r\n    context.beginPath();\r\n    context.arc(hitbox.x, hitbox.y, hitbox.radius, 0, Math.PI * 2);\r\n    context.stroke();\r\n  }\r\n}\r\n\r\nfunction drawTrainingDummy() {\r\n  const dummy = trainingDummy;\r\n  const elapsed = getElapsedTime();\r\n  const headRadius = 20;\r\n  const topY = dummy.y;\r\n  const shake = dummy.shakeTimer > 0 ? Math.sin(elapsed * 40) * dummy.shakeMagnitude * clamp(dummy.shakeTimer / 0.4, 0, 1) : 0;\r\n  const offsetX = dummy.health > 0 ? shake : 0;\r\n  const bodyColor = dummy.health > 0 ? (dummy.flashTimer > 0 ? \"#ffe3af\" : \"#9ca4b8\") : \"#3b3f49\";\r\n\r\n  context.lineWidth = 5;\r\n  context.strokeStyle = bodyColor;\r\n  context.lineCap = \"round\";\r\n\r\n  const centerX = dummy.x + offsetX;\r\n  context.beginPath();\r\n  context.arc(centerX, topY + headRadius, headRadius, 0, Math.PI * 2);\r\n  context.stroke();\r\n\r\n  context.beginPath();\r\n  context.moveTo(centerX, topY + headRadius * 2);\r\n  context.lineTo(centerX, GROUND_Y - headRadius);\r\n  context.stroke();\r\n\r\n  context.beginPath();\r\n  context.moveTo(centerX, GROUND_Y - headRadius);\r\n  context.lineTo(centerX - 28, GROUND_Y);\r\n  context.moveTo(centerX, GROUND_Y - headRadius);\r\n  context.lineTo(centerX + 28, GROUND_Y);\r\n  context.stroke();\r\n\r\n  const armY = topY + headRadius * 2.4;\r\n  context.beginPath();\r\n  context.moveTo(centerX, armY);\r\n  context.lineTo(centerX - 36, armY + 18);\r\n  context.moveTo(centerX, armY);\r\n  context.lineTo(centerX + 36, armY + 18);\r\n  context.stroke();\r\n\r\n  const barWidth = 140;\r\n  const barHeight = 10;\r\n  const barX = centerX - barWidth / 2;\r\n  const barY = topY - 24;\r\n  context.fillStyle = \"#23262d\";\r\n  context.fillRect(barX, barY, barWidth, barHeight);\r\n  const healthRatio = dummy.health / dummy.maxHealth;\r\n  context.fillStyle = dummy.health > 0 ? \"#5fffb5\" : \"#44474f\";\r\n  context.fillRect(barX, barY, barWidth * clamp(healthRatio, 0, 1), barHeight);\r\n  context.strokeStyle = \"#50535b\";\r\n  context.strokeRect(barX, barY, barWidth, barHeight);\r\n\r\n  context.fillStyle = \"#cfd3df\";\r\n  context.font = \"14px 'Segoe UI', Arial, sans-serif\";\r\n  context.textAlign = \"center\";\r\n  const label = dummy.health > 0 ? `Training Dummy ${Math.round(dummy.health)}/${dummy.maxHealth}` : \"Respawning...\";\r\n  context.fillText(label, centerX, barY - 6);\r\n  context.textAlign = \"left\";\r\n}\r\n\r\nfunction drawEnemies() {\r\n  const elapsed = getElapsedTime();\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n\r\n    const shake = enemy.shakeTimer > 0 ? Math.sin(elapsed * 32) * enemy.shakeMagnitude * clamp(enemy.shakeTimer / 0.4, 0, 1) : 0;\r\n    const centerX = enemy.x + shake;\r\n    const headRadius = 18;\r\n    const bodyColor = enemy.stunTimer > 0 ? \"#ffd166\" : (enemy.flashTimer > 0 ? \"#ff9488\" : \"#fa5b4a\");\r\n\r\n    context.lineWidth = 5;\r\n    context.strokeStyle = bodyColor;\r\n    context.lineCap = \"round\";\r\n\r\n    const topY = enemy.y;\r\n    context.beginPath();\r\n    context.arc(centerX, topY + headRadius, headRadius, 0, Math.PI * 2);\r\n    context.stroke();\r\n\r\n    context.beginPath();\r\n    context.moveTo(centerX, topY + headRadius * 2);\r\n    context.lineTo(centerX, topY + enemy.height - 24);\r\n    context.stroke();\r\n\r\n    context.beginPath();\r\n    context.moveTo(centerX, topY + headRadius * 2.4);\r\n    context.lineTo(centerX - 30, topY + headRadius * 3);\r\n    context.moveTo(centerX, topY + headRadius * 2.4);\r\n    context.lineTo(centerX + 30, topY + headRadius * 3);\r\n    context.stroke();\r\n\r\n    context.beginPath();\r\n    context.moveTo(centerX, enemy.y + enemy.height - 26);\r\n    context.lineTo(centerX - 24, enemy.y + enemy.height);\r\n    context.moveTo(centerX, enemy.y + enemy.height - 26);\r\n    context.lineTo(centerX + 24, enemy.y + enemy.height);\r\n    context.stroke();\r\n\r\n    const barWidth = 110;\r\n    const barHeight = 8;\r\n    const barX = centerX - barWidth / 2;\r\n    const barY = topY - 20;\r\n    context.fillStyle = \"#230c0a\";\r\n    context.fillRect(barX, barY, barWidth, barHeight);\r\n    const ratio = enemy.health / enemy.maxHealth;\r\n    context.fillStyle = \"#ff6f61\";\r\n    context.fillRect(barX, barY, barWidth * clamp(ratio, 0, 1), barHeight);\r\n    context.strokeStyle = \"#5c3029\";\r\n    context.strokeRect(barX, barY, barWidth, barHeight);\r\n  }\r\n}\r\n\r\nfunction drawHud() {\r\n  const currentWeapon = getCurrentWeapon();\r\n  const weaponName = currentWeapon?.name ?? \"Unarmed\";\r\n  const weaponSlots = getWeaponSlots();\r\n  const ammoStatus = currentWeapon ? getAmmoStatus(currentWeapon.id) : null;\r\n  const recoilOffset = getRecoilOffset();\r\n\r\n  if ((stickman.flashBlindTimer ?? 0) > 0) {\r\n    const overlayAlpha = Math.min(0.55, (stickman.flashBlindTimer ?? 0) / 1.2);\r\n    context.fillStyle = `rgba(255, 255, 224, ${overlayAlpha})`;\r\n    context.fillRect(0, 0, context.canvas.width, context.canvas.height);\r\n  }\r\n\r\n  context.fillStyle = \"#d0d4de\";\r\n  context.font = \"16px 'Segoe UI', Arial, sans-serif\";\r\n  context.textAlign = \"left\";\r\n  context.fillText(\"Move: WASD/Arrows   Jump: Space   Crouch: S   Roll: Shift   Attack: J or Left Click   Throw: G or Right Click\", 24, 32);\r\n  context.fillText(\"Server Browser: L (toggle)  |  Join: Enter  |  Host: H  |  Offer: O  |  Paste: P  |  Apply: I  |  ICE Copy: M  |  ICE Apply: N\", 24, 48);\r\n\r\n  const comboText = stickman.attacking && stickman.currentAttack ? `Combo: ${stickman.currentAttack.name}` : \"Combo: Ready\";\r\n  context.fillText(comboText, 24, 52);\r\n\r\n  context.fillText(`Weapon: ${weaponName}`, 24, 72);\r\n\r\n  let infoY = 92;\r\n  const playerVehicle = getPlayerVehicle();\r\n  if (playerVehicle) {\r\n    const vehicleDefinition = VEHICLE_DEFINITIONS[playerVehicle.type];\r\n    const vehicleLabel = vehicleDefinition?.label ?? playerVehicle.type;\r\n    const movementType = vehicleDefinition?.movementType ?? \"ground\";\r\n    context.fillStyle = \"#8cffd4\";\r\n    context.fillText(`Vehicle: ${vehicleLabel} (E to exit)`, 24, infoY);\r\n    infoY += 20;\r\n    context.fillStyle = \"#9aa2b1\";\r\n    if (movementType === \"air\") {\r\n      context.fillText(\"Controls: A/D strafe   Space rise   S descend\", 24, infoY);\r\n    } else if (movementType === \"water\") {\r\n      context.fillText(\"Controls: A/D throttle   S brake/reverse\", 24, infoY);\r\n    } else {\r\n      context.fillText(\"Controls: A/D drive   S brake\", 24, infoY);\r\n    }\r\n    infoY += 20;\r\n    const mountedWeapons = vehicleDefinition?.mountedWeapons ?? [];\r\n    if (mountedWeapons.length > 0) {\r\n      for (const mount of mountedWeapons) {\r\n        const bindingLabel = (mount.binding ?? \"primary\").toLowerCase() === \"secondary\" ? \"Secondary\" : \"Primary\";\r\n        const mountLabel = mount.label ?? mount.id ?? \"Mounted Weapon\";\r\n        context.fillStyle = bindingLabel === \"Primary\" ? \"#cfe3ff\" : \"#ffd3a3\";\r\n        context.fillText(`${bindingLabel}: ${mountLabel}`, 24, infoY);\r\n        infoY += 18;\r\n      }\r\n    }\r\n  } else if (stickman.vehicleCandidateId) {\r\n    const candidate = getVehicleById(stickman.vehicleCandidateId);\r\n    if (candidate) {\r\n      const candidateDefinition = VEHICLE_DEFINITIONS[candidate.type];\r\n      const candidateLabel = candidateDefinition?.label ?? candidate.type;\r\n      const movementType = candidateDefinition?.movementType ?? \"ground\";\r\n      context.fillStyle = \"#ffc66d\";\r\n      context.fillText(`Nearby: ${candidateLabel} [E to enter]`, 24, infoY);\r\n      infoY += 20;\r\n      context.fillStyle = \"#9aa2b1\";\r\n      if (movementType === \"air\") {\r\n        context.fillText(\"Tip: Space rises, S descends when piloting\", 24, infoY);\r\n        infoY += 20;\r\n      } else if (movementType === \"water\") {\r\n        context.fillText(\"Tip: Boats use A/D throttle, S to brake/reverse\", 24, infoY);\r\n        infoY += 20;\r\n      } else {\r\n        context.fillText(\"Tip: Hold S to brake while driving\", 24, infoY);\r\n        infoY += 20;\r\n      }\r\n      const candidateWeapons = candidateDefinition?.mountedWeapons ?? [];\r\n      if (candidateWeapons.length > 0) {\r\n        context.fillStyle = \"#d6e2ff\";\r\n        for (const mount of candidateWeapons) {\r\n          const bindingLabel = (mount.binding ?? \"primary\").toLowerCase() === \"secondary\" ? \"Secondary\" : \"Primary\";\r\n          const mountLabel = mount.label ?? mount.id ?? \"Mounted Weapon\";\r\n          context.fillText(`${bindingLabel}: ${mountLabel}`, 24, infoY);\r\n          infoY += 18;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  context.fillStyle = \"#d0d4de\";\r\n\r\n  const supplyStatus = getSupplyDropStatus();\r\n  if (supplyStatus) {\r\n    if (supplyStatus.incomingMessage) {\r\n      const alpha = clamp(0.35 + 0.65 * (supplyStatus.incomingAlpha ?? 0), 0, 1);\r\n      context.fillStyle = `rgba(176, 210, 255, ${alpha})`;\r\n      context.fillText(supplyStatus.incomingMessage, 24, infoY);\r\n      infoY += 20;\r\n      context.fillStyle = \"#d0d4de\";\r\n    }\r\n    if ((supplyStatus.timeUntilNext ?? 0) > 0.2 && supplyStatus.nextDropLabel) {\r\n      const eta = supplyStatus.timeUntilNext;\r\n      context.fillText(`Next Drop (${supplyStatus.nextDropLabel}): ${eta.toFixed(1)}s`, 24, infoY);\r\n      infoY += 20;\r\n    }\r\n    if ((supplyStatus.activeCount ?? 0) > 0) {\r\n      context.fillStyle = \"#8cffd4\";\r\n      context.fillText(`Drops on field: ${supplyStatus.activeCount}`, 24, infoY);\r\n      infoY += 20;\r\n      context.fillStyle = \"#d0d4de\";\r\n    }\r\n    if (supplyStatus.rewardMessage) {\r\n      const rewardAlpha = clamp(0.3 + 0.7 * (supplyStatus.rewardAlpha ?? 0), 0, 1);\r\n      context.fillStyle = `rgba(140, 255, 212, ${rewardAlpha})`;\r\n      context.fillText(`Reward: ${supplyStatus.rewardMessage}`, 24, infoY);\r\n      infoY += 20;\r\n      context.fillStyle = \"#d0d4de\";\r\n    }\r\n  }\r\n\r\n  const squadStatus = getSquadStatus();\r\n  if (squadStatus?.command) {\r\n    context.fillStyle = \"#cfe3ff\";\r\n    context.fillText(`Squad: ${squadStatus.command.label}`, 24, infoY);\r\n    infoY += 18;\r\n    context.fillStyle = \"#9aa2b1\";\r\n    context.fillText(\"Commands: Z Hold   X Defend   C Attack   V Flank   T Cycle\", 24, infoY);\r\n    infoY += 18;\r\n    if ((squadStatus.cooldown ?? 0) > 0.05) {\r\n      context.fillText(`Command cooldown: ${squadStatus.cooldown.toFixed(1)}s`, 24, infoY);\r\n      infoY += 18;\r\n    }\r\n    if (Array.isArray(squadStatus.members) && squadStatus.members.length > 0) {\r\n      context.fillStyle = \"#8cffd4\";\r\n      const maxShown = Math.min(3, squadStatus.members.length);\r\n      for (let i = 0; i < maxShown; i += 1) {\r\n        const member = squadStatus.members[i];\r\n        const distance = Math.abs(member.x - stickman.x);\r\n        const status = member.targetEnemyId ? \"engaging\" : \"ready\";\r\n        context.fillText(`${member.name ?? \"Ally\"}: ${distance.toFixed(0)}u (${status})`, 24, infoY);\r\n        infoY += 18;\r\n      }\r\n      context.fillStyle = \"#d0d4de\";\r\n    }\r\n  }\r\n\r\n  const p2pStatus = getP2PStatus?.();\r\n  if (p2pStatus) {\r\n    context.fillStyle = \"#b6c9ff\";\r\n    context.fillText(`P2P: ${p2pStatus.status ?? \"unknown\"}`, 24, infoY);\r\n    infoY += 18;\r\n    if (p2pStatus.status !== \"connected\") {\r\n      context.fillStyle = \"#8495c9\";\r\n      context.fillText(\"Use window.P2P.createOffer() / createAnswer() in console\", 24, infoY);\r\n      infoY += 18;\r\n      context.fillText(\"window.P2P.getLocalDescription() to copy SDP\", 24, infoY);\r\n      infoY += 18;\r\n    } else {\r\n      context.fillStyle = \"#8cffd4\";\r\n      context.fillText(\"Remote peers: \" + getRemotePlayers().length, 24, infoY);\r\n      infoY += 18;\r\n    }\r\n    context.fillStyle = \"#d0d4de\";\r\n  }\r\n\r\n  if (ammoStatus) {\r\n\r\n\r\n    const isInfinite = ammoStatus.capacity === Number.POSITIVE_INFINITY;\r\n    const magazineDisplay = isInfinite ? \"INF\" : `${Math.max(0, ammoStatus.magazine)}`;\r\n    const reserveDisplay = isInfinite ? \"INF\" : `${Math.max(0, ammoStatus.reserve)}`;\r\n    let ammoLabel = `Ammo: ${magazineDisplay}/${reserveDisplay}`;\r\n    if (ammoStatus.reloading) {\r\n      ammoLabel += ` (Reloading ${Math.max(0, ammoStatus.reloadTimer).toFixed(1)}s)`;\r\n    }\r\n    context.fillText(ammoLabel, 24, infoY);\r\n    infoY += 20;\r\n  }\r\n\r\n  const recoilMagnitude = Math.hypot(recoilOffset?.horizontal ?? 0, recoilOffset?.vertical ?? 0);\r\n  if (recoilMagnitude > 0.05) {\r\n    const recoilLabel = `Recoil Kick: H ${(recoilOffset.horizontal ?? 0).toFixed(2)}  V ${(recoilOffset.vertical ?? 0).toFixed(2)}`;\r\n    context.fillText(recoilLabel, 24, infoY);\r\n    infoY += 20;\r\n  }\r\n\r\n  context.fillText(`Player HP: ${stickman.health}/${stickman.maxHealth}`, 24, infoY);\r\n  infoY += 20;\r\n  context.fillText(`Dummy HP: ${Math.round(trainingDummy.health)}/${trainingDummy.maxHealth}`, 24, infoY);\r\n  infoY += 20;\r\n  const aliveEnemies = enemies.filter((enemy) => enemy.health > 0).length;\r\n  context.fillText(`Enemies Alive: ${aliveEnemies}`, 24, infoY);\r\n  infoY += 20;\r\n\r\n  if (weaponSlots.length > 0) {\r\n    const slotLabel = weaponSlots\r\n      .map((weapon, index) => {\r\n        const label = `${index + 1}: ${weapon.name}`;\r\n        return weapon.id === currentWeapon?.id ? `[${label}]` : label;\r\n      })\r\n      .join(\"   \");\r\n    context.fillStyle = \"#9aa2b1\";\r\n    context.fillText(`Loadout ${slotLabel}`, 24, 152);\r\n  }\r\n\r\n  let nextHudY = 172;\r\n  const gadgetStatus = getGadgetStatus();\r\n\r\n  if (stickman.comboWindowOpen) {\r\n    context.fillStyle = \"#ffcf7a\";\r\n    context.fillText(\"Press attack now to chain!\", 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if (currentWeapon?.category === \"throwable\") {\r\n    const ready = stickman.throwCooldown <= 0;\r\n    const cooldownLabel = ready ? \"Ready\" : `${stickman.throwCooldown.toFixed(1)}s`;\r\n    context.fillStyle = ready ? \"#8cffd4\" : \"#ffcf7a\";\r\n    context.fillText(`Grenade: ${cooldownLabel}`, 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if (currentWeapon?.category === \"gadget\") {\r\n    const ready = (gadgetStatus.gadgetCooldown ?? 0) <= 0.01;\r\n    const label = ready ? \"Ready\" : `${gadgetStatus.gadgetCooldown.toFixed(1)}s`;\r\n    context.fillStyle = ready ? \"#8cffd4\" : \"#ffcf7a\";\r\n    context.fillText(`Gadget: ${label}`, 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if ((gadgetStatus.turretCount ?? 0) > 0) {\r\n    context.fillStyle = \"#9ae9ff\";\r\n    context.fillText(`Turrets Active: ${gadgetStatus.turretCount}`, 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if (gadgetStatus.shieldActive) {\r\n    const maxShield = gadgetStatus.shieldMaxStrength ?? 0;\r\n    const shieldValue = Math.max(0, gadgetStatus.shieldStrength ?? 0);\r\n    const ratio = maxShield > 0 ? Math.max(0, Math.min(1, shieldValue / maxShield)) : 0;\r\n    context.fillStyle = \"#7cd6ff\";\r\n    const label = maxShield > 0 ? `${Math.ceil(shieldValue)}/${Math.ceil(maxShield)}` : \"Active\";\r\n    context.fillText(`Shield: ${label}`, 24, nextHudY);\r\n    nextHudY += 14;\r\n    const barWidth = 120;\r\n    context.fillStyle = \"#2d3c4d\";\r\n    context.fillRect(24, nextHudY, barWidth, 6);\r\n    context.fillStyle = \"#7cd6ff\";\r\n    context.fillRect(24, nextHudY, barWidth * ratio, 6);\r\n    nextHudY += 14;\r\n  }\r\n\r\n  if ((stickman.stunTimer ?? 0) > 0) {\r\n    context.fillStyle = \"#ffb48a\";\r\n    context.fillText(`Stunned: ${stickman.stunTimer.toFixed(1)}s`, 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if ((stickman.flashBlindTimer ?? 0) > 0) {\r\n    context.fillStyle = \"#ffe27a\";\r\n    context.fillText(`Blinded: ${stickman.flashBlindTimer.toFixed(1)}s`, 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if ((stickman.smokeSlowTimer ?? 0) > 0) {\r\n    context.fillStyle = \"#b8c7dd\";\r\n    context.fillText(`In Smoke: ${stickman.smokeSlowTimer.toFixed(1)}s`, 24, nextHudY);\r\n    nextHudY += 20;\r\n  }\r\n\r\n  if (stickman.health <= 0) {\r\n    context.fillStyle = \"#ff8c7a\";\r\n    context.fillText(\"Respawning soon...\", 24, nextHudY);\r\n  }\r\n\r\n  const debugState = getPolishDebugState();\r\n  const activeNotices = debugState.notices.slice(-4).reverse();\r\n  if (activeNotices.length > 0 || debugState.shotIndicators.length > 0 || debugState.filters) {\r\n    context.save();\r\n    const rightMargin = context.canvas.width - 24;\r\n    context.textAlign = \"right\";\r\n    let debugY = 32;\r\n    for (const notice of activeNotices) {\r\n      const life = notice.maxTtl > 0 ? clamp(notice.ttl / notice.maxTtl, 0, 1) : 0;\r\n      context.globalAlpha = clamp(life, 0.25, 1);\r\n      context.fillStyle = \"#c3cdea\";\r\n      context.fillText(notice.message, rightMargin, debugY);\r\n      debugY += 18;\r\n    }\r\n    if (debugState.shotIndicators.length > 0) {\r\n      if (activeNotices.length > 0) {\r\n        debugY += 6;\r\n      }\r\n      for (const entry of debugState.shotIndicators) {\r\n        const life = entry.maxTtl > 0 ? clamp(entry.ttl / entry.maxTtl, 0, 1) : 0;\r\n        context.globalAlpha = clamp(life, 0.3, 0.85);\r\n        context.fillStyle = \"#9aa2b1\";\r\n        context.fillText(\"Shot: \" + entry.weaponId, rightMargin, debugY);\r\n        debugY += 16;\r\n      }\r\n    }\r\n    const filters = debugState.filters;\r\n    if (filters) {\r\n      if (debugY > 32) {\r\n        debugY += 6;\r\n      }\r\n      context.globalAlpha = 0.6;\r\n      context.fillStyle = \"#7f8aad\";\r\n      context.fillText(\"Filters (Alt+6/7/8)\", rightMargin, debugY);\r\n      debugY += 16;\r\n      const filterLines = [\r\n        { label: \"Weapons\", value: filters.weapons },\r\n        { label: \"Shield\", value: filters.shield },\r\n        { label: \"Throwables\", value: filters.throwables }\r\n      ];\r\n      for (const line of filterLines) {\r\n        context.globalAlpha = line.value ? 0.85 : 0.35;\r\n        context.fillStyle = line.value ? \"#c3cdea\" : \"#6c7389\";\r\n        context.fillText(line.label + \": \" + (line.value ? \"ON\" : \"OFF\"), rightMargin, debugY);\r\n        debugY += 16;\r\n      }\r\n    }\r\n    context.globalAlpha = 1;\r\n    context.restore();\r\n  }\r\n}\r\nfunction drawGadgetsLayer() {\r\n  drawGadgets();\r\n}\r\n\r\nfunction drawPolishDebugEffects() {\r\n  const { muzzleFlashes, shieldBursts, throwableBursts } = getPolishDebugState();\r\n  if (muzzleFlashes.length === 0 && shieldBursts.length === 0 && throwableBursts.length === 0) {\r\n    return;\r\n  }\r\n\r\n  context.save();\r\n\r\n  for (const flash of muzzleFlashes) {\r\n    const life = clamp(flash.ttl / flash.maxTtl, 0, 1);\r\n    const alpha = 0.25 + life * 0.6;\r\n    const radius = 12 + (1 - life) * 14;\r\n    const offset = (flash.facing ?? 1) * (10 + (1 - life) * 6);\r\n    context.globalAlpha = alpha;\r\n    context.fillStyle = \"#ffd27a\";\r\n    context.beginPath();\r\n    context.arc(flash.x + offset, flash.y, radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n\r\n  for (const burst of shieldBursts) {\r\n    const life = clamp(burst.ttl / burst.maxTtl, 0, 1);\r\n    const alpha = (burst.type === \"shatter\" ? 0.55 : 0.35) * life;\r\n    if (alpha <= 0) {\r\n      continue;\r\n    }\r\n    const radiusBase = burst.type === \"shatter\" ? 120 : 80;\r\n    const radius = radiusBase * (1 - life * 0.35);\r\n    context.globalAlpha = alpha;\r\n    context.lineWidth = burst.type === \"shatter\" ? 6 : 3;\r\n    context.strokeStyle = burst.type === \"shatter\" ? \"#7cd6ff\" : \"#9be9ff\";\r\n    context.beginPath();\r\n    context.arc(burst.center.x, burst.center.y, radius, 0, Math.PI * 2);\r\n    context.stroke();\r\n  }\r\n\r\n  for (const burst of throwableBursts) {\r\n    const life = clamp(burst.ttl / burst.maxTtl, 0, 1);\r\n    if (life <= 0) {\r\n      continue;\r\n    }\r\n    let stroke = \"#ffb347\";\r\n    if (burst.type === \"flash\") {\r\n      stroke = \"#fff6d0\";\r\n    } else if (burst.type === \"smoke\" || burst.type === \"smoke-fade\") {\r\n      stroke = \"#9db8ca\";\r\n    }\r\n    const radius = burst.radius * (1 + (1 - life) * 0.35);\r\n    context.globalAlpha = (burst.type === \"smoke-fade\" ? 0.3 : 0.45) * life;\r\n    context.lineWidth = burst.type === \"flash\" ? 5 : 4;\r\n    context.strokeStyle = stroke;\r\n    context.beginPath();\r\n    context.arc(burst.x, burst.y, radius, 0, Math.PI * 2);\r\n    context.stroke();\r\n  }\r\n\r\n  context.restore();\r\n}\r\n\r\nfunction drawProjectilesLayer() {\r\n  drawProjectiles();\r\n  drawThrowables();\r\n  drawParticles();\r\n  drawPolishDebugEffects();\r\n}\r\n\r\nfunction drawServerBrowser() {\n  const state = getServerBrowserState();\n  if (!state.visible) {\n    return;\n  }\n\n  const panelWidth = 480;\n  const panelHeight = 420;\n  const x = context.canvas.width * 0.5 - panelWidth * 0.5;\n  const y = context.canvas.height * 0.5 - panelHeight * 0.5;\n\n  context.save();\n  context.fillStyle = \"rgba(12, 16, 24, 0.82)\";\n  context.fillRect(x, y, panelWidth, panelHeight);\n  context.strokeStyle = \"#6f7fa0\";\n  context.lineWidth = 3;\n  context.strokeRect(x, y, panelWidth, panelHeight);\n\n  context.fillStyle = \"#cfe3ff\";\n  context.font = \"18px 'Segoe UI', Arial, sans-serif\";\n  context.textAlign = \"left\";\n  context.fillText(\"Server Browser\", x + 20, y + 32);\n\n  context.font = \"13px 'Segoe UI', Arial, sans-serif\";\n  context.fillStyle = \"#9aa9c7\";\n  context.fillText(\"Join: Enter  |  Navigate: [ / ]  |  Close: L\", x + 20, y + 52);\n  context.fillText(\"Host: H  |  Stop: U  |  Offer: O  |  Paste Offer: P  |  Answer: I  |  ICE Copy: M  |  ICE Apply: N\", x + 20, y + 68);\n\n  let statusY = y + 88;\n  if (state.error) {\n    context.fillStyle = \"#ff8080\";\n    context.fillText(state.error, x + 20, statusY);\n    statusY += 18;\n  }\n  if (state.statusMessage) {\n    context.fillStyle = \"#8cffd4\";\n    context.fillText(state.statusMessage, x + 20, statusY);\n    statusY += 18;\n  }\n  if (state.joinError) {\n    context.fillStyle = \"#ff9a9a\";\n    context.fillText(state.joinError, x + 20, statusY);\n    statusY += 18;\n  }\n  if (state.joinStatus) {\n    context.fillStyle = \"#cfe3ff\";\n    context.fillText(state.joinStatus, x + 20, statusY);\n    statusY += 18;\n  }\n\n  const listTop = statusY + 12;\n  const rowHeight = 34;\n  const listBottom = y + panelHeight - 140;\n  const servers = state.servers ?? [];\n  const maxRows = Math.max(0, Math.floor((listBottom - listTop) / rowHeight));\n  const rowsToDraw = Math.min(servers.length, Math.min(maxRows, 8));\n\n  context.font = \"14px 'Segoe UI', Arial, sans-serif\";\n  for (let i = 0; i < rowsToDraw; i += 1) {\n    const server = servers[i];\n    const rowY = listTop + i * rowHeight;\n    const isSelected = i === state.selectedIndex;\n    if (isSelected) {\n      context.fillStyle = \"rgba(108, 132, 220, 0.4)\";\n      context.fillRect(x + 12, rowY - 6, panelWidth - 24, rowHeight - 4);\n    }\n    context.fillStyle = \"#e4ecff\";\n    context.fillText(server.name ?? server.id ?? \"Server\", x + 24, rowY + 8);\n    context.fillStyle = \"#9aa9c7\";\n    const details = `${server.map ?? \"Unknown\"} | ${server.players ?? \"?\"}/${server.maxPlayers ?? \"?\"} | ${server.region ?? \"--\"}`;\n    context.fillText(details, x + 24, rowY + 22);\n  }\n\n  if (servers.length === 0) {\n    context.fillStyle = \"#a6b2cf\";\n    context.fillText(\"No servers available.\", x + 24, listTop + 16);\n  }\n\n  const snippet = (value, limit = 64) => {\n    if (typeof value !== \"string\") {\n      return \"\";\n    }\n    return value.length > limit ? `${value.slice(0, limit)}...` : value;\n  };\n\n  const p2p = state.p2p ?? {};\n  let p2pY = y + panelHeight - 120;\n  context.font = \"12px 'Segoe UI', Arial, sans-serif\";\n  context.fillStyle = \"#9aa9c7\";\n  context.fillText(\"P2P Handshake\", x + 20, p2pY);\n  p2pY += 16;\n\n  if (p2p.error) {\n    context.fillStyle = \"#ff8080\";\n    context.fillText(p2p.error, x + 20, p2pY);\n    p2pY += 16;\n  }\n\n  if (state.hosting) {\n    if (p2p.pendingOffer) {\n      context.fillStyle = \"#ffd27f\";\n      context.fillText(\"Generating offer...\", x + 20, p2pY);\n      p2pY += 16;\n    } else if (p2p.offer) {\n      context.fillStyle = \"#8cffd4\";\n      context.fillText(\"Offer ready (press O to copy).\", x + 20, p2pY);\n      p2pY += 16;\n      context.fillStyle = \"#9aa9c7\";\n      context.fillText(snippet(p2p.offer), x + 20, p2pY);\n      p2pY += 16;\n    } else {\n      context.fillStyle = \"#9aa9c7\";\n      context.fillText(\"Press O to generate an offer for peers.\", x + 20, p2pY);\n      p2pY += 16;\n    }\n\n    if (p2p.pendingAnswer) {\n      context.fillStyle = \"#ffd27f\";\n      context.fillText(\"Waiting for a joiner answer...\", x + 20, p2pY);\n      p2pY += 16;\n    }\n  } else {\n    if (p2p.pendingAnswer) {\n      context.fillStyle = \"#ffd27f\";\n      context.fillText(\"Generating answer...\", x + 20, p2pY);\n      p2pY += 16;\n    } else if (p2p.answer) {\n      context.fillStyle = \"#8cffd4\";\n      context.fillText(\"Answer ready. Share it with the host.\", x + 20, p2pY);\n      p2pY += 16;\n      context.fillStyle = \"#9aa9c7\";\n      context.fillText(snippet(p2p.answer), x + 20, p2pY);\n      p2pY += 16;\n    } else {\n      context.fillStyle = \"#9aa9c7\";\n      context.fillText(\"Press P after copying the host offer JSON.\", x + 20, p2pY);\n      p2pY += 16;\n    }\n  }\n\n  const localCandidates = Array.isArray(p2p.localCandidates) ? p2p.localCandidates : [];\n  const remoteCandidates = Array.isArray(p2p.remoteCandidates) ? p2p.remoteCandidates : [];\n\n  if (p2p.pendingCandidates) {\n    context.fillStyle = \"#ffd27f\";\n    context.fillText(\"Processing ICE candidates...\", x + 20, p2pY);\n    p2pY += 16;\n  }\n\n  const candidateSummary =\n    \"Local ICE ready: \" + localCandidates.length + \"  |  Remote applied: \" + remoteCandidates.length;\n  context.fillStyle = \"#9aa9c7\";\n  context.fillText(candidateSummary, x + 20, p2pY);\n  p2pY += 16;\n\n  if (localCandidates.length > 0) {\n    const lastLocalLabel = \"Last local: \" + snippet(localCandidates[localCandidates.length - 1], 54);\n    context.fillStyle = \"#6f86d0\";\n    context.fillText(lastLocalLabel, x + 20, p2pY);\n    p2pY += 16;\n  } else if (!p2p.pendingCandidates) {\n    context.fillStyle = \"#9aa9c7\";\n    context.fillText(\"Local ICE will appear shortly after offer/answer.\", x + 20, p2pY);\n    p2pY += 16;\n  }\n\n  if (remoteCandidates.length > 0) {\n    const lastRemoteLabel = \"Last remote: \" + snippet(remoteCandidates[remoteCandidates.length - 1], 54);\n    context.fillStyle = \"#6fd0c5\";\n    context.fillText(lastRemoteLabel, x + 20, p2pY);\n    p2pY += 16;\n  } else if (!p2p.pendingCandidates) {\n    context.fillStyle = \"#9aa9c7\";\n    if (state.hosting) {\n      context.fillText(\"Press N after players send their ICE (M).\", x + 20, p2pY);\n    } else {\n      context.fillText(\"Press M to copy your ICE and send it to the host.\", x + 20, p2pY);\n    }\n    p2pY += 16;\n  }\n\n  context.restore();\n}\r\nexport { drawBackground, drawDestructibles, drawVehicles, drawSupplyDrops, drawRemotePlayers, drawServerBrowser, drawSquadmates, drawStickman, drawHitboxes, drawTrainingDummy, drawEnemies, drawHud, drawProjectilesLayer, drawGadgetsLayer };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { stickman } from \"../../state/entities.js\";\r\nimport { POSES, ROLL_DURATION } from \"../../config/constants.js\";\r\nimport { getCurrentWeapon } from \"./weapons.js\";\r\n\r\nfunction determinePose() {\r\n  if (stickman.rolling) {\r\n    return POSES.rolling;\r\n  }\r\n  if (stickman.crouching) {\r\n    return POSES.crouching;\r\n  }\r\n  return POSES.standing;\r\n}\r\n\r\nfunction startRoll(direction) {\r\n  if (stickman.vehicleId) {\r\n    return;\r\n  }\r\n  if (!stickman.onGround || stickman.rolling || stickman.attacking || stickman.health <= 0 || (stickman.stunTimer ?? 0) > 0) {\r\n    return;\r\n  }\r\n\r\n  const { left, right } = direction;\r\n  if (left && !right) {\r\n    stickman.facing = -1;\r\n  } else if (right && !left) {\r\n    stickman.facing = 1;\r\n  }\r\n\r\n  stickman.rolling = true;\r\n  stickman.rollTimer = ROLL_DURATION;\r\n  stickman.crouching = false;\r\n  stickman.vy = 0;\r\n}\r\n\r\nfunction startAttack(index) {\r\n  const weapon = getCurrentWeapon();\r\n  const attackChain = weapon?.attackChain ?? [];\r\n  const attack = attackChain[index];\r\n  if (!attack) {\r\n    return;\r\n  }\r\n\r\n  stickman.attacking = true;\r\n  stickman.attackIndex = index;\r\n  stickman.currentAttack = attack;\r\n  stickman.attackElapsed = 0;\r\n  stickman.comboWindowOpen = false;\r\n  stickman.comboWindowTimer = 0;\r\n  stickman.nextAttackQueued = false;\r\n  stickman.hitboxSpawned = false;\r\n  stickman.attackInstanceId += 1;\r\n}\r\n\r\nfunction attemptAttack() {\r\n  if (stickman.vehicleId) {\r\n    return;\r\n  }\r\n  if (stickman.rolling || stickman.health <= 0 || (stickman.stunTimer ?? 0) > 0 || stickman.reloading) {\r\n    return;\r\n  }\r\n\r\n  const weapon = getCurrentWeapon();\r\n  const attackChain = weapon?.attackChain ?? [];\r\n  if (attackChain.length === 0) {\r\n    return;\r\n  }\r\n\r\n  if (!stickman.attacking) {\r\n    startAttack(0);\r\n    return;\r\n  }\r\n\r\n  if (stickman.comboWindowOpen && stickman.attackIndex + 1 < attackChain.length) {\r\n    stickman.nextAttackQueued = true;\r\n  }\r\n}\r\n\r\nfunction advanceAttack(delta, spawnHitboxFn) {\r\n  if (stickman.vehicleId) {\r\n    stickman.attacking = false;\r\n    stickman.currentAttack = null;\r\n    stickman.attackElapsed = 0;\r\n    stickman.comboWindowOpen = false;\r\n    stickman.comboWindowTimer = 0;\r\n    stickman.hitboxSpawned = false;\r\n    stickman.attackIndex = -1;\r\n    return;\r\n  }\r\n  const attack = stickman.currentAttack;\r\n  if (!attack) {\r\n    return;\r\n  }\r\n  if ((stickman.stunTimer ?? 0) > 0 || stickman.reloading) {\r\n    stickman.attacking = false;\r\n    stickman.currentAttack = null;\r\n    stickman.attackElapsed = 0;\r\n    stickman.comboWindowOpen = false;\r\n    stickman.comboWindowTimer = 0;\r\n    stickman.hitboxSpawned = false;\r\n    return;\r\n  }\r\n\r\n  stickman.attackElapsed += delta;\r\n\r\n  if (!stickman.hitboxSpawned && stickman.attackElapsed >= attack.windup) {\r\n    spawnHitboxFn(attack);\r\n    stickman.hitboxSpawned = true;\r\n  }\r\n\r\n  if (!stickman.comboWindowOpen && stickman.attackElapsed >= attack.comboStart) {\r\n    stickman.comboWindowOpen = true;\r\n    stickman.comboWindowTimer = attack.comboWindow;\r\n  }\r\n\r\n  if (stickman.comboWindowOpen) {\r\n    stickman.comboWindowTimer -= delta;\r\n    if (stickman.comboWindowTimer <= 0) {\r\n      stickman.comboWindowOpen = false;\r\n    }\r\n  }\r\n\r\n  const weapon = getCurrentWeapon();\r\n  const attackChain = weapon?.attackChain ?? [];\r\n\r\n  if (stickman.attackElapsed >= attack.windup + attack.active + attack.recovery) {\r\n    const nextIndex = stickman.attackIndex + 1;\r\n    const shouldChain = stickman.nextAttackQueued && nextIndex < attackChain.length;\r\n\r\n    stickman.attacking = false;\r\n    stickman.currentAttack = null;\r\n    stickman.attackElapsed = 0;\r\n    stickman.comboWindowOpen = false;\r\n    stickman.comboWindowTimer = 0;\r\n    stickman.hitboxSpawned = false;\r\n    stickman.nextAttackQueued = false;\r\n\r\n    if (shouldChain) {\r\n      startAttack(nextIndex);\r\n    } else {\r\n      stickman.attackIndex = -1;\r\n    }\r\n  }\r\n}\r\n\r\nexport { determinePose, startRoll, attemptAttack, advanceAttack };\r\n","import { stickman, trainingDummy, enemies } from \"../../state/entities.js\";\nimport { getCurrentWeapon } from \"./weapons.js\";\nimport { spawnProjectile } from \"./projectiles.js\";\nimport { applyDamageToDummy, applyDamageToEnemy, applyDamageToPlayer } from \"./damageHandlers.js\";\nimport { handleHitboxCollision } from \"../world/destructibles.js\";\nimport { consumeAmmo, startReload, registerShot } from \"../../state/ammo.js\";\nimport { applyRecoil } from \"../../state/recoil.js\";\n\nfunction spawnHitbox(attack) {\n  stickman.activeHitboxes.push({\n    id: stickman.attackInstanceId,\n    attackIndex: stickman.attackIndex,\n    remaining: attack.active,\n    duration: attack.active,\n    offsetX: attack.range,\n    heightOffset: attack.heightOffset,\n    radius: attack.radius,\n    damage: attack.damage,\n    knockback: attack.knockback,\n    launch: attack.launch,\n    ownerFacing: stickman.facing,\n    hitTargets: new Set(),\n    x: 0,\n    y: 0\n  });\n}\n\nfunction updateHitboxes(delta, baseHeight) {\n  stickman.activeHitboxes = stickman.activeHitboxes.filter((hitbox) => {\n    hitbox.remaining -= delta;\n    hitbox.ownerFacing = stickman.facing;\n    hitbox.x = stickman.x + stickman.facing * hitbox.offsetX;\n    hitbox.y = stickman.y + baseHeight + hitbox.heightOffset;\n    return hitbox.remaining > 0;\n  });\n}\n\nfunction resolveHitDetection() {\r\n  for (const hitbox of stickman.activeHitboxes) {\r\n    if (trainingDummy.health > 0 && !hitbox.hitTargets.has(trainingDummy.id)) {\r\n      const dx = hitbox.x - trainingDummy.x;\r\n      const dy = hitbox.y - (trainingDummy.y + trainingDummy.height * 0.55);\r\n      const distance = Math.hypot(dx, dy);\r\n      if (distance <= hitbox.radius + trainingDummy.radius) {\r\n        hitbox.hitTargets.add(trainingDummy.id);\r\n        applyDamageToDummy({\r\n          damage: hitbox.damage,\r\n          knockback: hitbox.knockback,\r\n          launch: hitbox.launch,\r\n          facing: hitbox.ownerFacing\r\n        });\r\n      }\r\n    }\r\n\r\n    for (const enemy of enemies) {\r\n      if (enemy.health <= 0 || hitbox.hitTargets.has(enemy.id)) {\r\n        continue;\r\n      }\r\n      const dx = hitbox.x - enemy.x;\r\n      const dy = hitbox.y - (enemy.y + enemy.height * 0.5);\r\n      const distance = Math.hypot(dx, dy);\r\n      if (distance <= hitbox.radius + enemy.radius) {\r\n        hitbox.hitTargets.add(enemy.id);\r\n        applyDamageToEnemy(enemy, {\r\n          damage: hitbox.damage,\r\n          knockback: hitbox.knockback,\r\n          launch: hitbox.launch,\r\n          facing: hitbox.ownerFacing\r\n        });\r\n      }\r\n    }\r\n\r\n    handleHitboxCollision(hitbox);\r\n  }\r\n}\n\nfunction fireEquippedWeaponProjectile() {\n  const weapon = getCurrentWeapon();\n  if (!weapon || !weapon.category?.startsWith(\"ranged\")) {\n    return;\n  }\n\n  if (!consumeAmmo(weapon.id)) {\n    if (startReload(weapon.id)) {\n      stickman.attacking = false;\n      stickman.currentAttack = null;\n      stickman.attackIndex = -1;\n      if (typeof window !== \"undefined\") {\n        window.dispatchEvent(new CustomEvent(\"weapon:reload-start\", { detail: { weaponId: weapon.id } }));\n      }\n    }    return;\n  }\n\n  const projectileConfig = weapon.projectile ?? {};\n  const speed = projectileConfig.speed ?? 460;\n  const facing = stickman.facing;\n  const baseVx = facing * speed;\n  const baseVy = projectileConfig.initialVy ?? -12;\n  const magnitude = Math.hypot(baseVx, baseVy);\n  const baseAngle = Math.atan2(baseVy, baseVx);\n  const spreadAngle = registerShot(weapon.id);\n  const finalAngle = baseAngle + spreadAngle;\n  const vx = Math.cos(finalAngle) * magnitude;\n  const vy = Math.sin(finalAngle) * magnitude;\n\n  if (weapon.recoil) {\n    applyRecoil(weapon.recoil);\n    if (typeof window !== \"undefined\") {\n      window.dispatchEvent(new CustomEvent(\"weapon:recoil-kick\", { detail: { weaponId: weapon.id, recoil: weapon.recoil } }));\n    }\n  }\n\n  if (typeof window !== \"undefined\") {\n    window.dispatchEvent(new CustomEvent(\"weapon:muzzle-flash\", { detail: { weaponId: weapon.id, x: stickman.x + facing * 34, y: stickman.y + 20, facing } }));\n  }\n\n  spawnProjectile({\n    x: stickman.x + facing * 34,\n    y: stickman.y + 20,\n    vx,\n    vy,\n    radius: projectileConfig.radius ?? 5,\n    lifetime: projectileConfig.lifetime ?? 0.9,\n    color: projectileConfig.color ?? \"#ffca7a\",\n    damage: projectileConfig.damage ?? 10,\n    knockback: projectileConfig.knockback ?? 60,\n    facing,\n    gravityFactor: projectileConfig.gravityFactor ?? 0.2\n  });\n\n  if (typeof window !== \"undefined\") {\n    window.dispatchEvent(new CustomEvent(\"weapon:shot-fired\", { detail: { weaponId: weapon.id } }));\n  }\n}\n\nexport { spawnHitbox, updateHitboxes, resolveHitDetection, applyDamageToEnemy, applyDamageToPlayer, fireEquippedWeaponProjectile };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { GRAVITY } from \"../../config/constants.js\";\r\nimport { canvas, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { stickman, enemies } from \"../../state/entities.js\";\r\nimport { resolvePlatformLanding } from \"./arena.js\";\r\nimport { applyDamageToPlayer } from \"../combat/damageHandlers.js\";\r\n\r\nfunction updateEnemyAI(enemy, delta) {\r\n  enemy.invulnerability = Math.max(0, enemy.invulnerability - delta);\r\n  enemy.attackCooldown = Math.max(0, enemy.attackCooldown - delta);\r\n  enemy.stunTimer = Math.max(0, (enemy.stunTimer ?? 0) - delta);\r\n  enemy.smokeSlowTimer = Math.max(0, (enemy.smokeSlowTimer ?? 0) - delta);\r\n  if (enemy.smokeSlowTimer <= 0) {\r\n    enemy.smokeSlowStrength = 1;\r\n  }\r\n\r\n  if (enemy.flashTimer > 0) {\r\n    enemy.flashTimer = Math.max(0, enemy.flashTimer - delta);\r\n  }\r\n\r\n  if (enemy.shakeTimer > 0) {\r\n    enemy.shakeTimer = Math.max(0, enemy.shakeTimer - delta);\r\n  }\r\n\r\n  enemy.shakeMagnitude = Math.max(0, enemy.shakeMagnitude - delta * 20);\r\n\r\n  if (enemy.health <= 0) {\r\n    enemy.respawnTimer = Math.max(0, enemy.respawnTimer - delta);\r\n    if (enemy.respawnTimer === 0) {\r\n      enemy.health = enemy.maxHealth;\r\n      enemy.x = enemy.spawnX;\r\n      enemy.y = enemy.spawnY;\r\n      enemy.vx = 0;\r\n      enemy.vy = 0;\r\n      enemy.state = \"patrol\";\r\n      enemy.stateTimer = 1 + Math.random();\r\n      enemy.attackCooldown = 0.6;\r\n      enemy.onGround = true;\r\n      enemy.stunTimer = 0;\r\n      enemy.smokeSlowTimer = 0;\r\n      enemy.smokeSlowStrength = 1;\r\n    }\r\n    return;\r\n  }\r\n\r\n  const targetX = stickman.x;\r\n  const distanceX = targetX - enemy.x;\r\n  const absDistance = Math.abs(distanceX);\r\n  enemy.facing = distanceX >= 0 ? 1 : -1;\r\n\r\n  const stunned = enemy.stunTimer > 0;\r\n  const slowMultiplier = enemy.smokeSlowTimer > 0 ? Math.max(0.2, Math.min(1, enemy.smokeSlowStrength ?? 1)) : 1;\r\n  const moveSpeed = enemy.moveSpeed * slowMultiplier;\r\n  const effectiveAggression = enemy.aggressionRange * (enemy.smokeSlowTimer > 0 ? 0.85 : 1);\r\n  const disengageDistance = effectiveAggression * 1.8;\r\n  const shouldChase = !stunned && absDistance < effectiveAggression;\r\n\r\n  if (absDistance > disengageDistance) {\r\n    enemy.vx = 0;\r\n    enemy.state = \"idle\";\r\n    return;\r\n  }\r\n\r\n  if (stunned) {\r\n    enemy.state = \"stunned\";\r\n    enemy.vx = 0;\r\n    enemy.attackWindup = 0;\r\n    enemy.attackActive = 0;\r\n    enemy.stateTimer = Math.max(enemy.stateTimer, enemy.stunTimer);\r\n    enemy.attackCooldown = Math.max(enemy.attackCooldown, enemy.stunTimer + 0.2);\r\n  } else if (enemy.state === \"stunned\") {\r\n    enemy.state = \"idle\";\r\n    enemy.stateTimer = 0.6;\r\n  }\r\n\r\n  if (!stunned) {\r\n  switch (enemy.state) {\r\n    case \"idle\":\r\n      enemy.vx = 0;\r\n      enemy.stateTimer -= delta;\r\n      if (enemy.stateTimer <= 0) {\r\n        enemy.state = \"patrol\";\r\n        enemy.stateTimer = 1.2 + Math.random();\r\n        enemy.facing = Math.random() < 0.5 ? -1 : 1;\r\n      }\r\n      if (shouldChase) {\r\n        enemy.state = \"chase\";\r\n      }\r\n      break;\r\n    case \"patrol\":\r\n      enemy.vx = moveSpeed * enemy.facing;\r\n      if (enemy.x <= enemy.patrolRange.min) {\r\n        enemy.facing = 1;\r\n      } else if (enemy.x >= enemy.patrolRange.max) {\r\n        enemy.facing = -1;\r\n      }\r\n      enemy.stateTimer -= delta;\r\n      if (enemy.stateTimer <= 0) {\r\n        enemy.state = \"idle\";\r\n        enemy.stateTimer = 1 + Math.random();\r\n        enemy.vx = 0;\r\n      }\r\n      if (shouldChase) {\r\n        enemy.state = \"chase\";\r\n      }\r\n      break;\r\n    case \"chase\":\r\n      if (!shouldChase) {\r\n        enemy.state = \"patrol\";\r\n        break;\r\n      }\r\n      const chaseDir = distanceX >= 0 ? 1 : -1;\r\n      enemy.vx = moveSpeed * chaseDir;\r\n      if (absDistance <= enemy.attackRange && enemy.attackCooldown <= 0) {\r\n        enemy.state = \"attack-windup\";\r\n        enemy.attackWindup = 0.35;\r\n        enemy.attackActive = 0.16;\r\n        enemy.vx = 0;\r\n      }\r\n      break;\r\n    case \"attack-windup\":\r\n      enemy.vx = 0;\r\n      enemy.attackWindup -= delta;\r\n      if (enemy.attackWindup <= 0) {\r\n        enemy.state = \"attack-active\";\r\n        enemy.attackActive = 0.16;\r\n      }\r\n      break;\r\n    case \"attack-active\":\r\n      enemy.vx = moveSpeed * 0.35 * enemy.facing;\r\n      enemy.attackActive -= delta;\r\n      if (enemy.attackActive <= 0) {\r\n        enemy.state = \"recover\";\r\n        enemy.stateTimer = 0.4;\r\n        enemy.attackCooldown = 1.2;\r\n      }\r\n      break;\r\n    case \"recover\":\r\n      enemy.vx = 0;\r\n      enemy.stateTimer -= delta;\r\n      if (enemy.stateTimer <= 0) {\r\n        enemy.state = shouldChase ? \"chase\" : \"idle\";\r\n        enemy.stateTimer = 0.9 + Math.random() * 0.4;\r\n      }\r\n      break;\r\n    default:\r\n      enemy.vx = 0;\r\n      break;\r\n  }\r\n  }\r\n\r\n  const previousY = enemy.y;\r\n  enemy.vy += GRAVITY * delta;\r\n  enemy.x += enemy.vx * delta;\r\n  enemy.y += enemy.vy * delta;\r\n  enemy.onGround = false;\r\n\r\n  const landed = resolvePlatformLanding(enemy, previousY, enemy.height);\r\n  if (!landed && enemy.y + enemy.height >= GROUND_Y) {\r\n    enemy.y = GROUND_Y - enemy.height;\r\n    enemy.vy = 0;\r\n    enemy.onGround = true;\r\n  }\r\n\r\n  enemy.x = Math.max(60, Math.min(canvas.width - 60, enemy.x));\r\n}\r\n\r\nfunction updateEnemyAttacks(enemy) {\r\n  if (enemy.health <= 0) {\r\n    return;\r\n  }\r\n  if (enemy.state !== \"attack-active\") {\r\n    return;\r\n  }\r\n\r\n  const attackReach = enemy.attackRange + enemy.radius;\r\n  const dx = stickman.x - enemy.x;\r\n  const dy = stickman.y - enemy.y;\r\n  const distanceSq = dx * dx + dy * dy;\r\n  if (distanceSq <= attackReach * attackReach) {\r\n    applyDamageToPlayer(enemy);\r\n  }\r\n}\r\n\r\nfunction updateEnemies(delta) {\r\n  for (const enemy of enemies) {\r\n    updateEnemyAI(enemy, delta);\r\n  }\r\n  for (const enemy of enemies) {\r\n    updateEnemyAttacks(enemy);\r\n  }\r\n}\r\n\r\nexport { updateEnemyAI, updateEnemyAttacks, updateEnemies };\r\n\r\n","const ENEMY_SPAWN_SETTINGS = {\n  minCount: 24,\n  maxCount: 100,\n  spawnBatch: 6,\n  spawnInterval: 2.2,\n  spawnPadding: 80\n};\n\nexport { ENEMY_SPAWN_SETTINGS };\r\n","import { canvas } from \"../../environment/canvas.js\";\nimport { enemies, createGruntEnemy } from \"../../state/entities.js\";\nimport { ENEMY_SPAWN_SETTINGS } from \"../../config/spawn.js\";\n\nconst spawnState = {\n  timer: ENEMY_SPAWN_SETTINGS.spawnInterval,\n  seeded: false\n};\n\nfunction seedInitialEnemies() {\n  if (spawnState.seeded) {\n    return;\n  }\n  spawnState.seeded = true;\n  const initial = Math.max(ENEMY_SPAWN_SETTINGS.minCount - enemies.length, 0);\n  if (initial <= 0) {\n    return;\n  }\n  spawnEnemies(initial);\n}\n\nfunction spawnEnemies(count) {\n  for (let i = 0; i < count; i += 1) {\n    if (enemies.length >= ENEMY_SPAWN_SETTINGS.maxCount) {\n      break;\n    }\n    const padding = ENEMY_SPAWN_SETTINGS.spawnPadding ?? 80;\n    const spawnX = padding + Math.random() * (canvas.width - padding * 2);\n    const enemy = createGruntEnemy(spawnX);\n    enemy.spawnX = spawnX;\n    enemy.spawnY = enemy.y;\n    enemy.respawnTimer = 0;\n    enemies.push(enemy);\n  }\n}\n\nfunction updateEnemySpawner(delta) {\n  seedInitialEnemies();\n  if (enemies.length >= ENEMY_SPAWN_SETTINGS.maxCount) {\n    spawnState.timer = ENEMY_SPAWN_SETTINGS.spawnInterval;\n    return;\n  }\n\n  spawnState.timer -= delta;\n  if (spawnState.timer <= 0) {\n    const deficit = Math.max(ENEMY_SPAWN_SETTINGS.minCount - enemies.length, 0);\n    const batch = Math.min(ENEMY_SPAWN_SETTINGS.spawnBatch, ENEMY_SPAWN_SETTINGS.maxCount - enemies.length);\n    const spawnCount = Math.max(batch, deficit);\n    spawnEnemies(spawnCount);\n    spawnState.timer = ENEMY_SPAWN_SETTINGS.spawnInterval;\n  }\n}\n\nexport { updateEnemySpawner };\r\n","import { NETWORK_CONFIG } from \"../../config/network.js\";\r\nimport { getP2P } from \"./p2p.js\";\r\nimport {\r\n  getServerBrowserState,\r\n  setVisible,\r\n  toggleVisible,\r\n  setServers,\r\n  setError,\r\n  setStatusMessage,\r\n  setJoinStatus,\r\n  setJoinError,\r\n  setJoinedSessionId,\r\n  selectNext,\r\n  recordFetchTimestamp,\r\n  setFetching,\r\n  setHostingSession,\r\n  updateHostingHeartbeatTimestamp,\r\n  clearHosting,\r\n  clearP2PState,\r\n  setP2POffer,\r\n  setP2PAnswer,\r\n  setP2PLocalCandidates,\r\n  setP2PRemoteCandidates,\r\n  setP2PPending,\r\n  setP2PError\r\n} from \"../../state/serverBrowser.js\";\r\n\r\nfunction getApiBase() {\r\n  return (NETWORK_CONFIG.serverApiBase ?? \"\").replace(/\\/$/, \"\");\r\n}\r\n\r\nfunction getHostSecret() {\r\n  return NETWORK_CONFIG.hostSecret ?? \"\";\r\n}\r\n\r\nfunction getSessionId() {\r\n  if (typeof crypto !== \"undefined\" && crypto.randomUUID) {\r\n    return crypto.randomUUID();\r\n  }\r\n  return `session-${Math.random().toString(36).slice(2, 10)}`;\r\n}\r\n\r\nfunction sanitizeSignal(raw) {\r\n  if (typeof raw !== \"string\") {\r\n    return \"\";\r\n  }\r\n  return raw.trim();\r\n}\r\n\r\nasync function copyToClipboard(text) {\r\n  if (!text || typeof navigator === \"undefined\" || !navigator.clipboard?.writeText) {\r\n    return false;\r\n  }\r\n  try {\r\n    await navigator.clipboard.writeText(text);\r\n    return true;\r\n  } catch (error) {\r\n    console.warn(\"Clipboard write failed\", error);\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction normalizeCandidate(candidate) {\r\n  if (typeof candidate === \"string\") {\r\n    return sanitizeSignal(candidate);\r\n  }\r\n  if (candidate && typeof candidate === \"object\") {\r\n    try {\r\n      return sanitizeSignal(JSON.stringify(candidate));\r\n    } catch {\r\n      return \"\";\r\n    }\r\n  }\r\n  return \"\";\r\n}\r\n\r\nfunction normalizeCandidateList(list) {\r\n  if (!Array.isArray(list)) {\r\n    return [];\r\n  }\r\n  return list\r\n    .map((candidate) => normalizeCandidate(candidate))\r\n    .filter((candidate) => candidate.length > 0);\r\n}\r\n\r\nasync function fetchSessionDetail(serverId) {\r\n  const apiBase = getApiBase();\r\n  if (!apiBase) {\r\n    throw new Error(\"Server API base not configured\");\r\n  }\r\n  console.debug(`[serverBrowser] fetching session detail for ${serverId}`);\r\n  const response = await fetch(`${apiBase}/sessions/${serverId}`);\r\n  if (response.status === 404) {\r\n    console.warn(`[serverBrowser] session ${serverId} no longer exists (404)`);\r\n    return { notFound: true };\r\n  }\r\n  if (!response.ok) {\r\n    console.warn(`[serverBrowser] session detail request failed ${response.status} for ${serverId}`);\r\n    throw new Error(`Session lookup failed (HTTP ${response.status})`);\r\n  }\r\n  const payload = await response.json();\r\n  console.debug(`[serverBrowser] received session detail for ${serverId}`);\r\n  return payload;\r\n}\r\n\r\nfunction syncLocalCandidates() {\r\n  let p2p;\r\n  try {\r\n    p2p = getP2P();\r\n  } catch {\r\n    setP2PLocalCandidates([]);\r\n    return [];\r\n  }\r\n  if (!p2p?.getLocalCandidates) {\r\n    setP2PLocalCandidates([]);\r\n    return [];\r\n  }\r\n  const normalized = normalizeCandidateList(p2p.getLocalCandidates() ?? []);\r\n  setP2PLocalCandidates(normalized);\r\n  return normalized;\r\n}\r\n\r\nfunction parseCandidateInput(rawInput) {\r\n  const sanitized = sanitizeSignal(rawInput);\r\n  if (!sanitized) {\r\n    return [];\r\n  }\r\n  try {\r\n    const parsed = JSON.parse(sanitized);\r\n    if (Array.isArray(parsed)) {\r\n      return normalizeCandidateList(parsed);\r\n    }\r\n    if (parsed && typeof parsed === \"object\") {\r\n      return normalizeCandidateList([parsed]);\r\n    }\r\n    if (typeof parsed === \"string\") {\r\n      return normalizeCandidateList([parsed]);\r\n    }\r\n  } catch {\r\n    // fall through to newline parsing\r\n  }\r\n  const segments = sanitized\r\n    .split(/\\r?\\n+/)\r\n    .map((segment) => segment.trim())\r\n    .filter((segment) => segment.length > 0);\r\n  return normalizeCandidateList(segments);\r\n}\r\n\r\nasync function copyLocalCandidates({ silent = false } = {}) {\r\n  try {\r\n    setP2PPending({ candidates: true });\r\n    const candidates = syncLocalCandidates();\r\n    if (candidates.length === 0) {\r\n      if (!silent) {\r\n        setStatusMessage(\"No ICE candidates yet. Wait a moment after generating offer/answer.\");\r\n      }\r\n      return { copied: false, count: 0 };\r\n    }\r\n    const payload = candidates.join(\"\\n\");\r\n    const copied = await copyToClipboard(payload);\r\n    if (!silent) {\r\n      if (copied) {\r\n        setStatusMessage(`Copied ${candidates.length} ICE candidate${candidates.length === 1 ? \"\" : \"s\"}.`);\r\n      } else {\r\n        setStatusMessage(\"Candidates ready. Copy manually if clipboard access is blocked.\");\r\n      }\r\n    }\r\n    return { copied, count: candidates.length, payload };\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to copy ICE candidates\";\r\n    setP2PError(message);\r\n    throw error;\r\n  } finally {\r\n    setP2PPending({ candidates: false });\r\n  }\r\n}\r\n\r\nfunction mergeCandidates(existing, incoming) {\r\n  const merged = [...existing, ...incoming];\r\n  const seen = new Set();\r\n  const unique = [];\r\n  for (const candidate of merged) {\r\n    if (!seen.has(candidate)) {\r\n      seen.add(candidate);\r\n      unique.push(candidate);\r\n    }\r\n  }\r\n  return unique;\r\n}\r\n\r\nasync function promptForRemoteCandidates() {\r\n  if (typeof window === \"undefined\" || typeof window.prompt !== \"function\") {\r\n    throw new Error(\"Prompts unavailable in this environment\");\r\n  }\r\n  const state = getServerBrowserState();\r\n  const existing = (state.p2p.remoteCandidates ?? []).join(\"\\n\");\r\n  const input = window.prompt(\"Paste remote ICE candidates (JSON array or newline separated)\", existing);\r\n  if (input == null) {\r\n    setStatusMessage(\"Candidate entry cancelled.\");\r\n    return null;\r\n  }\r\n  const candidates = parseCandidateInput(input);\r\n  if (candidates.length === 0) {\r\n    setStatusMessage(\"No valid ICE candidates detected.\");\r\n    throw new Error(\"No ICE candidates provided\");\r\n  }\r\n  const p2p = getP2POrThrow();\r\n  setP2PError(null);\r\n  setP2PPending({ candidates: true });\r\n  try {\r\n    for (const candidate of candidates) {\r\n      await p2p.addRemoteCandidate(candidate);\r\n    }\r\n    const merged = mergeCandidates(state.p2p.remoteCandidates ?? [], candidates);\r\n    setP2PRemoteCandidates(merged);\r\n    setStatusMessage(`Applied ${candidates.length} ICE candidate${candidates.length === 1 ? \"\" : \"s\"}.`);\r\n    return candidates;\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to apply ICE candidates\";\r\n    setP2PError(message);\r\n    throw error;\r\n  } finally {\r\n    setP2PPending({ candidates: false });\r\n  }\r\n}function getP2POrThrow() {\r\n  try {\r\n    return getP2P();\r\n  } catch (error) {\r\n    const message = error?.message ?? \"P2P subsystem unavailable\";\r\n    setP2PError(message);\r\n    throw error;\r\n  }\r\n}\r\n\r\nfunction buildHostingMetadata(metrics, fallbackPlayerCount) {\r\n  const playerCount = metrics?.playerCount ?? fallbackPlayerCount;\r\n  return {\r\n    playerCount,\r\n    enemyCount: metrics?.enemyCount ?? 0,\r\n    alliesCount: metrics?.alliesCount ?? Math.max(0, playerCount - 1)\r\n  };\r\n}\r\n\r\nasync function fetchServerList() {\r\n  const apiBase = getApiBase();\r\n  if (!apiBase) {\r\n    setError(\"Server list URL not configured\");\r\n    setServers([]);\r\n    return;\r\n  }\r\n  setFetching(true);\r\n  setStatusMessage(\"Fetching server list...\");\r\n  try {\r\n    const response = await fetch(`${apiBase}/sessions`, {\r\n      headers: { Accept: \"application/json\" }\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}`);\r\n    }\r\n    const data = await response.json();\r\n    const servers = Array.isArray(data) ? data : Array.isArray(data?.servers) ? data.servers : [];\r\n    const mappedServers = servers.map((server) => {\r\n      const metadata = server.metadata ?? {};\r\n      return {\r\n        id: server.id,\r\n        name: server.name ?? server.id,\r\n        map: server.map ?? metadata.map ?? \"Unknown\",\r\n        players: metadata.playerCount ?? server.playerCount ?? server.players ?? 0,\r\n        maxPlayers: server.maxPlayers ?? metadata.maxPlayers ?? 0,\r\n        region: server.region ?? metadata.region ?? \"--\",\r\n        mode: server.mode ?? metadata.mode ?? \"\",\r\n        enemyCount: metadata.enemyCount ?? null,\r\n        alliesCount: metadata.alliesCount ?? null,\r\n        updatedAt: server.updatedAt ?? null,\r\n        signal: {\r\n          hostOffer: server.signal?.hostOffer ?? null,\r\n          hostCandidates: Array.isArray(server.signal?.hostCandidates) ? server.signal.hostCandidates.slice() : [],\r\n          joinAnswer: server.signal?.joinAnswer ?? null,\r\n          joinCandidates: Array.isArray(server.signal?.joinCandidates) ? server.signal.joinCandidates.slice() : []\r\n        }\r\n      };\r\n    });\r\n    const staleThresholdMs = Math.max(30_000, Math.round((NETWORK_CONFIG.hostTtlSeconds ?? 150) * 1000 * 1.1));\r\n    const now = Date.now();\r\n    const filteredServers = mappedServers.filter((server) => {\r\n      if (!server.updatedAt) {\r\n        return true;\r\n      }\r\n      const updatedAtMs = Date.parse(server.updatedAt);\r\n      if (Number.isNaN(updatedAtMs)) {\r\n        return true;\r\n      }\r\n      return now - updatedAtMs <= staleThresholdMs;\r\n    });\r\n    setServers(filteredServers);\r\n    setError(null);\r\n    setStatusMessage(filteredServers.length === 0 ? \"No active sessions.\" : \"Fetched session list.\");\r\n  } catch (error) {\r\n    setServers([]);\r\n    setError(`Failed to fetch servers: ${error.message}`);\r\n    setStatusMessage(\"Unable to reach session service.\");\r\n  } finally {\r\n    setFetching(false);\r\n  }\r\n}\r\nasync function hostSession({\r\n  id = getSessionId(),\r\n  name = NETWORK_CONFIG.hostName ?? \"Stickman Lobby\",\r\n  region = NETWORK_CONFIG.defaultRegion ?? \"na\",\r\n  map = \"Neo District\",\r\n  playerCount = 1,\r\n  maxPlayers = 4,\r\n  mode = \"freeplay\",\r\n  signal = null\r\n} = {}) {\r\n  const apiBase = getApiBase();\r\n  const secret = getHostSecret();\r\n  if (!apiBase) {\r\n    throw new Error(\"Server API base not configured\");\r\n  }\r\n  if (!secret) {\r\n    throw new Error(\"Host secret not provided\");\r\n  }\r\n  const state = getServerBrowserState();\r\n  const metrics = state.hostingMetrics ?? {};\r\n  const ttlSeconds = NETWORK_CONFIG.hostTtlSeconds ?? 150;\r\n  const computedPlayerCount = metrics.playerCount ?? playerCount;\r\n  const effectiveSignal = signal ?? {\r\n    hostOffer: state.p2p.offer ?? null,\r\n    hostCandidates: state.p2p.localCandidates ?? []\r\n  };\r\n  const response = await fetch(`${apiBase}/sessions`, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      \"x-session-secret\": secret\r\n    },\r\n    body: JSON.stringify({\r\n      id,\r\n      name,\r\n      region,\r\n      map,\r\n      mode,\r\n      playerCount: computedPlayerCount,\r\n      maxPlayers,\r\n      ttlSeconds,\r\n      metadata: buildHostingMetadata(metrics, computedPlayerCount),\r\n      signal: {\r\n        hostOffer: effectiveSignal.hostOffer ?? null,\r\n        hostCandidates: Array.isArray(effectiveSignal.hostCandidates) ? effectiveSignal.hostCandidates : []\r\n      }\r\n    })\r\n  });\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to host session (HTTP ${response.status})`);\r\n  }\r\n  const payload = await response.json();\r\n  setP2PLocalCandidates(Array.isArray(effectiveSignal.hostCandidates) ? effectiveSignal.hostCandidates : []);\r\n  setHostingSession({ id, expiresAt: Date.now() + (payload?.ttlSeconds ?? ttlSeconds) * 1000 });\r\n  setStatusMessage(`Hosting ${name}`);\r\n  return { id, ttlSeconds: payload?.ttlSeconds ?? ttlSeconds };\r\n}\r\n\r\nasync function heartbeatSession() {\r\n  const apiBase = getApiBase();\r\n  const secret = getHostSecret();\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting || !state.hostingSessionId || !apiBase || !secret) {\r\n    return;\r\n  }\r\n  const metrics = state.hostingMetrics ?? {};\r\n  const computedPlayerCount = metrics.playerCount ?? 1;\r\n  try {\r\n    const response = await fetch(`${apiBase}/sessions/${state.hostingSessionId}/heartbeat`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"x-session-secret\": secret\r\n      },\r\n      body: JSON.stringify({\r\n        playerCount: computedPlayerCount,\r\n        ttlSeconds: NETWORK_CONFIG.hostTtlSeconds ?? 150,\r\n        metadata: buildHostingMetadata(metrics, computedPlayerCount),\r\n        signal: {\r\n          hostOffer: state.p2p.offer ?? null,\r\n          hostCandidates: Array.isArray(state.p2p.localCandidates) ? state.p2p.localCandidates : []\r\n        }\r\n      })\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}`);\r\n    }\r\n    const payload = await response.json();\r\n    updateHostingHeartbeatTimestamp(performance.now());\r\n    if (payload?.ttlSeconds) {\r\n      setHostingSession({ id: state.hostingSessionId, expiresAt: Date.now() + payload.ttlSeconds * 1000 });\r\n    }\r\n  } catch (error) {\r\n    console.warn(\"Heartbeat failed\", error);\r\n    setStatusMessage(\"Heartbeat failed; hosting paused.\");\r\n    clearHosting();\r\n  }\r\n}\r\n\r\nasync function stopHosting() {\r\n  const apiBase = getApiBase();\r\n  const secret = getHostSecret();\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting || !state.hostingSessionId || !apiBase || !secret) {\r\n    clearHosting();\r\n    return;\r\n  }\r\n  try {\r\n    await fetch(`${apiBase}/sessions/${state.hostingSessionId}`, {\r\n      method: \"DELETE\",\r\n      headers: {\r\n        \"x-session-secret\": secret\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.warn(\"Failed to stop hosting\", error);\r\n  } finally {\r\n    clearHosting();\r\n  }\r\n}\r\n\r\nasync function joinServer(serverId, payload = {}) {\r\n  const apiBase = getApiBase();\r\n  if (!apiBase) {\r\n    throw new Error(\"Server API base not configured\");\r\n  }\r\n  setJoinStatus(\"Contacting host...\");\r\n  setJoinError(null);\r\n  const url = `${apiBase}/sessions/${serverId}/join`;\r\n  const response = await fetch(url, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\"\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n  if (!response.ok) {\r\n    const message = `Join failed (HTTP ${response.status})`;\r\n    setJoinStatus(null);\r\n    setJoinError(message);\r\n    throw new Error(message);\r\n  }\r\n  const result = await response.json();\r\n  const joinedName = result?.session?.name ?? serverId;\r\n  clearP2PState();\r\n  setJoinStatus(`Joined ${joinedName}`);\r\n  setStatusMessage(\"Joined lobby. Press P to paste the host offer.\");\r\n  return result;\r\n}\r\n\r\nfunction showServerBrowser() {\r\n  setVisible(true);\r\n  recordFetchTimestamp(0);\r\n  fetchServerList();\r\n}\r\n\r\nfunction hideServerBrowser() {\r\n  setVisible(false);\r\n}\r\n\r\nfunction updateServerBrowser(delta, timestamp) {\r\n  const state = getServerBrowserState();\r\n  pumpSignalUpdates();\r\n  if (!state.visible) {\r\n    if (state.hosting) {\r\n      const interval = NETWORK_CONFIG.heartbeatIntervalMs ?? 45000;\r\n      if (timestamp - state.hostingLastHeartbeat >= interval) {\r\n        heartbeatSession();\r\n      }\r\n    }\r\n    return;\r\n  }\r\n\r\n  syncLocalCandidates();\r\n\r\n  if (timestamp - state.lastFetch >= (NETWORK_CONFIG.refreshIntervalMs ?? 10000) && !state.fetching) {\r\n    recordFetchTimestamp(timestamp);\r\n    fetchServerList();\r\n  }\r\n\r\n  if (state.hosting) {\r\n    const interval = NETWORK_CONFIG.heartbeatIntervalMs ?? 45000;\r\n    if (timestamp - state.hostingLastHeartbeat >= interval) {\r\n      heartbeatSession();\r\n    }\r\n  }\r\n  pumpSignalUpdates();\r\n}\r\n\r\nasync function ensureHostOffer({ forceRegenerate = false } = {}) {\r\n  const state = getServerBrowserState();\r\n  const shouldRebuild = forceRegenerate || !state.p2p.offer;\r\n  if (!shouldRebuild) {\r\n    syncLocalCandidates();\r\n    return state.p2p.offer;\r\n  }\r\n  const p2p = getP2POrThrow();\r\n  setP2PError(null);\r\n  setP2PPending({ offer: true });\r\n  try {\r\n    const offer = await p2p.createOffer();\r\n    setP2POffer(offer);\r\n    syncLocalCandidates();\r\n    return offer;\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to create offer\";\r\n    setP2PError(message);\r\n    throw error;\r\n  } finally {\r\n    setP2PPending({ offer: false });\r\n  }\r\n}\r\n\r\nasync function copyHostOffer({ forceRegenerate = false, silent = false } = {}) {\r\n  const offer = await ensureHostOffer({ forceRegenerate });\r\n  const copied = await copyToClipboard(offer);\r\n  if (!silent) {\r\n    if (copied) {\r\n      setStatusMessage(\"Offer copied. Share it with your party.\");\r\n    } else {\r\n      setStatusMessage(\"Offer ready. Copy it manually if clipboard access is blocked.\");\r\n    }\r\n  }\r\n  return { offer, copied };\r\n}\r\n\r\nasync function acceptHostOffer(rawOffer, { autoCopyAnswer = true } = {}) {\r\n  const offerString = sanitizeSignal(rawOffer);\r\n  if (!offerString) {\r\n    throw new Error(\"Offer empty\");\r\n  }\r\n  let normalizedOffer;\r\n  try {\r\n    normalizedOffer = JSON.stringify(JSON.parse(offerString));\r\n  } catch (error) {\r\n    setP2PError(\"Offer must be valid JSON\");\r\n    throw error;\r\n  }\r\n  const p2p = getP2POrThrow();\r\n  setP2PError(null);\r\n  setP2PPending({ answer: true });\r\n  try {\r\n    const answer = await p2p.createAnswer(normalizedOffer);\r\n    setP2PAnswer(answer);\r\n    syncLocalCandidates();\r\n    if (autoCopyAnswer) {\r\n      const copied = await copyToClipboard(answer);\r\n      if (copied) {\r\n        setStatusMessage(\"Answer copied. Send it back to the host.\");\r\n      } else {\r\n        setStatusMessage(\"Answer ready. Copy it manually for the host.\");\r\n      }\r\n    } else {\r\n      setStatusMessage(\"Answer ready. Share it with the host.\");\r\n    }\r\n    return answer;\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to build answer\";\r\n    setP2PError(message);\r\n    throw error;\r\n  } finally {\r\n    setP2PPending({ answer: false });\r\n  }\r\n}\r\n\r\nasync function applyJoinerAnswer(rawAnswer) {\r\n  const answerString = sanitizeSignal(rawAnswer);\r\n  if (!answerString) {\r\n    throw new Error(\"Answer empty\");\r\n  }\r\n  let normalizedAnswer;\r\n  try {\r\n    normalizedAnswer = JSON.stringify(JSON.parse(answerString));\r\n  } catch (error) {\r\n    setP2PError(\"Answer must be valid JSON\");\r\n    throw error;\r\n  }\r\n  const p2p = getP2POrThrow();\r\n  setP2PError(null);\r\n  try {\r\n    await p2p.acceptRemoteDescription(normalizedAnswer);\r\n    setP2PAnswer(normalizedAnswer);\r\n    setStatusMessage(\"Answer applied. Waiting for connection...\");\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to accept answer\";\r\n    setP2PError(message);\r\n    throw error;\r\n  }\r\n}\r\n\r\n\r\nfunction applyRemoteCandidates(candidates) {\r\n  if (!Array.isArray(candidates) || candidates.length === 0) {\r\n    return;\r\n  }\r\n  const normalized = normalizeCandidateList(candidates);\r\n  if (normalized.length === 0) {\r\n    return;\r\n  }\r\n  let p2p;\r\n  try {\r\n    p2p = getP2POrThrow();\r\n  } catch (error) {\r\n    console.warn(\"P2P unavailable while applying candidates\", error);\r\n    return;\r\n  }\r\n  const state = getServerBrowserState();\r\n  const current = Array.isArray(state.p2p.remoteCandidates) ? state.p2p.remoteCandidates : [];\r\n  const seen = new Set(current);\r\n  const updated = current.slice();\r\n  for (const candidate of normalized) {\r\n    if (seen.has(candidate)) {\r\n      continue;\r\n    }\r\n    try {\r\n      p2p.addRemoteCandidate(candidate);\r\n      updated.push(candidate);\r\n      seen.add(candidate);\r\n    } catch (error) {\r\n      console.warn(\"Failed to add ICE candidate\", error);\r\n    }\r\n  }\r\n  setP2PRemoteCandidates(updated);\r\n}\r\n\r\nfunction pumpSignalUpdates() {\r\n  const state = getServerBrowserState();\r\n  if (state.hosting && state.hostingSessionId) {\r\n    const hostSession = state.servers.find((entry) => entry.id === state.hostingSessionId);\r\n    const signal = hostSession?.signal ?? null;\r\n    if (signal) {\r\n      if (signal.joinAnswer && state.p2p.answer !== signal.joinAnswer) {\r\n        applyJoinerAnswer(signal.joinAnswer).catch((error) => {\r\n          console.warn(\"Failed to apply joiner answer\", error);\r\n        });\r\n      }\r\n      if (Array.isArray(signal.joinCandidates) && signal.joinCandidates.length > 0) {\r\n        applyRemoteCandidates(signal.joinCandidates);\r\n      }\r\n      if (signal.joinAnswer && (state.hostingMetrics?.playerCount ?? 1) < 2) {\r\n        setHostingMetrics({ playerCount: Math.max(2, state.hostingMetrics?.playerCount ?? 1) });\r\n        heartbeatSession().catch((error) => console.warn(\"Heartbeat update failed\", error));\r\n      }\r\n    }\r\n  }\r\n  if (state.joinedSessionId) {\r\n    const joinedSession = state.servers.find((entry) => entry.id === state.joinedSessionId);\r\n    const signal = joinedSession?.signal ?? null;\r\n    if (signal && Array.isArray(signal.hostCandidates) && signal.hostCandidates.length > 0) {\r\n      applyRemoteCandidates(signal.hostCandidates);\r\n    } else if (!joinedSession) {\r\n      setJoinedSessionId(null);\r\n    }\r\n  }\r\n}\r\n\r\nasync function promptForHostOffer() {\r\n  if (typeof window === \"undefined\" || typeof window.prompt !== \"function\") {\r\n    throw new Error(\"Prompts unavailable in this environment\");\r\n  }\r\n  const input = window.prompt(\"Paste the host offer JSON\", \"\");\r\n  if (input == null) {\r\n    setStatusMessage(\"Offer entry cancelled.\");\r\n    return null;\r\n  }\r\n  try {\r\n    return await acceptHostOffer(input, { autoCopyAnswer: true });\r\n  } catch (error) {\r\n    setStatusMessage(\"Invalid offer. Please try again.\");\r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function promptForJoinerAnswer() {\r\n  if (typeof window === \"undefined\" || typeof window.prompt !== \"function\") {\r\n    throw new Error(\"Prompts unavailable in this environment\");\r\n  }\r\n  const input = window.prompt(\"Paste the player's answer JSON\", \"\");\r\n  if (input == null) {\r\n    setStatusMessage(\"Answer entry cancelled.\");\r\n    return null;\r\n  }\r\n  try {\r\n    await applyJoinerAnswer(input);\r\n    return input;\r\n  } catch (error) {\r\n    setStatusMessage(\"Invalid answer. Ask the player to resend it.\");\r\n    throw error;\r\n  }\r\n}\r\n\r\nfunction attemptHostSession() {\r\n  const state = getServerBrowserState();\r\n  if (state.hosting) {\r\n    setStatusMessage(\"Already hosting.\");\r\n    return Promise.resolve({ alreadyHosting: true });\r\n  }\r\n  clearP2PState();\r\n  setJoinedSessionId(null);\r\n  setStatusMessage(\"Preparing host offer...\");\r\n  setError(null);\r\n  return ensureHostOffer({ forceRegenerate: true })\r\n    .then((offer) => {\r\n      const candidates = syncLocalCandidates();\r\n      return hostSession({\r\n        signal: {\r\n          hostOffer: offer,\r\n          hostCandidates: candidates\r\n        }\r\n      }).then((result) => {\r\n        setStatusMessage(`Hosting ${state.hostingSessionId ?? result.id}`);\r\n        return result;\r\n      });\r\n    })\r\n    .catch((error) => {\r\n      const message = typeof error?.message === \"string\" ? error.message : \"Host failed\";\r\n      setError(message);\r\n      setStatusMessage(null);\r\n      throw error;\r\n    });\r\n}\r\n\r\nfunction attemptStopHosting() {\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting) {\r\n    setStatusMessage(\"Not hosting any session.\");\r\n    return Promise.resolve({ alreadyStopped: true });\r\n  }\r\n  setStatusMessage(\"Stopping session...\");\r\n  setError(null);\r\n  return stopHosting()\r\n    .then(() => {\r\n      setStatusMessage(\"Hosting stopped.\");\r\n      setJoinedSessionId(null);\r\n    })\r\n    .catch((error) => {\r\n      const message = typeof error?.message === \"string\" ? error.message : \"Stop failed\";\r\n      setError(message);\r\n      throw error;\r\n    });\r\n}\r\n\r\nfunction attemptJoinSession(server) {\r\n  if (!server) {\r\n    setJoinError(\"No server selected.\");\r\n    return Promise.reject(new Error(\"No server selected\"));\r\n  }\r\n  const resolveSignal = () => {\r\n    const directSignal = server.signal ?? {};\r\n    if (directSignal.hostOffer) {\r\n      console.debug(`[serverBrowser] using cached signal for ${server.id}`);\r\n      return Promise.resolve({ server, signal: directSignal });\r\n    }\r\n    console.debug(`[serverBrowser] cached signal missing for ${server.id}, fetching detail`);\r\n    setStatusMessage(\"Syncing host signal...\");\r\n    return fetchSessionDetail(server.id).then((result) => {\r\n      if (result?.notFound) {\r\n        console.warn(`[serverBrowser] session ${server.id} vanished before join`);\r\n        const state = getServerBrowserState();\r\n        const index = state.servers.findIndex((entry) => entry.id === server.id);\r\n        if (index >= 0) {\r\n          state.servers.splice(index, 1);\r\n        }\r\n        setJoinedSessionId(null);\r\n        throw new Error(\"Session no longer available\");\r\n      }\r\n      const refreshed = result?.session;\r\n      const refreshedSignal = refreshed?.signal ?? {};\r\n      if (!refreshedSignal.hostOffer) {\r\n        throw new Error(\"Host offer unavailable. Ask the host to refresh.\");\r\n      }\r\n      const state = getServerBrowserState();\r\n      const updatedEntry = {\r\n        ...server,\r\n        signal: {\r\n          hostOffer: refreshedSignal.hostOffer ?? null,\r\n          hostCandidates: Array.isArray(refreshedSignal.hostCandidates) ? refreshedSignal.hostCandidates.slice() : [],\r\n          joinAnswer: refreshedSignal.joinAnswer ?? null,\r\n          joinCandidates: Array.isArray(refreshedSignal.joinCandidates) ? refreshedSignal.joinCandidates.slice() : []\r\n        },\r\n        updatedAt: refreshed?.updatedAt ?? server.updatedAt\r\n      };\r\n      const index = state.servers.findIndex((entry) => entry.id === server.id);\r\n      if (index >= 0) {\r\n        state.servers[index] = updatedEntry;\r\n      }\r\n      console.debug(`[serverBrowser] refreshed signal for ${server.id}`);\r\n      return { server: updatedEntry, signal: updatedEntry.signal };\r\n    });\r\n  };\r\n\r\n  return resolveSignal()\r\n    .then(({ server: resolvedServer, signal }) => {\r\n      clearP2PState();\r\n      setJoinedSessionId(null);\r\n      setJoinError(null);\r\n      console.debug(`[serverBrowser] applying host offer for ${resolvedServer.id}`);\r\n      setStatusMessage(`Connecting to ${resolvedServer.name ?? resolvedServer.id}...`);\r\n      setError(null);\r\n      return acceptHostOffer(signal.hostOffer, { autoCopyAnswer: false })\r\n        .then((answer) => {\r\n          const candidates = syncLocalCandidates();\r\n          console.debug(`[serverBrowser] posting join payload for ${resolvedServer.id}`);\r\n          return joinServer(resolvedServer.id, {\r\n            signalAnswer: answer,\r\n            signalCandidates: candidates\r\n          }).then((result) => {\r\n            setJoinedSessionId(resolvedServer.id);\r\n            if (Array.isArray(result?.session?.signal?.hostCandidates)) {\r\n              applyRemoteCandidates(result.session.signal.hostCandidates);\r\n            }\r\n            setStatusMessage(`Joined ${result?.session?.name ?? resolvedServer.name ?? resolvedServer.id}`);\r\n            return result;\r\n          });\r\n        });\r\n    })\r\n    .catch((error) => {\r\n      const message = typeof error?.message === \"string\" ? error.message : \"Join failed\";\r\n      console.warn(`[serverBrowser] join failed for ${server.id}: ${message}`);\r\n      setJoinError(message);\r\n      setStatusMessage(null);\r\n      throw error;\r\n    });\r\n}\r\n\r\nexport {\r\n  getServerBrowserState,\r\n  setVisible,\r\n  toggleVisible,\r\n  showServerBrowser,\r\n  hideServerBrowser,\r\n  fetchServerList,\r\n  hostSession,\r\n  joinServer,\r\n  stopHosting,\r\n  updateServerBrowser,\r\n  selectNext,\r\n  heartbeatSession as hostHeartbeat,\r\n  attemptHostSession,\r\n  attemptStopHosting,\r\n  attemptJoinSession,\r\n  copyHostOffer,\r\n  promptForHostOffer,\r\n  promptForJoinerAnswer,\r\n  ensureHostOffer,\r\n  acceptHostOffer,\r\n  applyJoinerAnswer,\r\n  copyLocalCandidates,\r\n  promptForRemoteCandidates,\r\n  syncLocalCandidates\r\n};\r\n\r\nexport const hostServer = hostSession;\r\n\r\nif (typeof window !== \"undefined\") {\r\n  window.ServerBrowser = {\r\n    fetch: fetchServerList,\r\n    host: hostSession,\r\n    join: joinServer,\r\n    stop: stopHosting,\r\n    attemptHost: attemptHostSession,\r\n    attemptStop: attemptStopHosting,\r\n    attemptJoin: attemptJoinSession,\r\n    copyOffer: copyHostOffer,\r\n    regenerateOffer: () => copyHostOffer({ forceRegenerate: true, silent: true }),\r\n    promptOffer: promptForHostOffer,\r\n    promptAnswer: promptForJoinerAnswer,\r\n    copyCandidates: copyLocalCandidates,\r\n    promptCandidates: promptForRemoteCandidates,\r\n    syncCandidates: syncLocalCandidates,\r\n    state: getServerBrowserState\r\n  };\r\n}\r\n\r\nexport { setHostingMetrics } from \"../../state/serverBrowser.js\";\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { SPEED, JUMP_SPEED, ROLL_SPEED, GRAVITY, POSES } from \"../../config/constants.js\";\r\nimport { canvas, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { input } from \"../input/index.js\";\r\nimport { stickman, trainingDummy, enemies, getTotalHeight, getRemotePlayers, squadmates } from \"../../state/entities.js\";\r\nimport { determinePose, startRoll, attemptAttack, advanceAttack } from \"../combat/playerActions.js\";\r\nimport { spawnHitbox, updateHitboxes, resolveHitDetection, fireEquippedWeaponProjectile } from \"../combat/melee.js\";\r\nimport { throwEquippedWeapon, updateThrowables } from \"../combat/throwables.js\";\r\nimport { deployGadget, updateGadgets, updateGadgetMovement, clearGadgets } from \"../gadgets/index.js\";\r\nimport { updateTrainingDummy } from \"./trainingDummy.js\";\r\nimport { updateDamagePopups } from \"../effects/damage.js\";\r\nimport { updateParticles } from \"../effects/particles.js\";\r\nimport { updateEnemies } from \"./enemyAI.js\";\r\nimport { updateProjectiles } from \"../combat/projectiles.js\";\r\nimport { updateVehicles, handleVehicleInteraction, getPlayerVehicle, forcePlayerExitVehicle } from \"../vehicles/index.js\";\r\nimport { updateSupplyDrops } from \"./supplyDrops.js\";\r\nimport { updateDestructibles } from \"./destructibles.js\";\r\nimport { updateEnemySpawner } from \"./enemySpawner.js\";\r\nimport { updateServerBrowser, showServerBrowser, hideServerBrowser, selectNext as selectServerBrowser, attemptJoinSession, getServerBrowserState, setHostingMetrics, attemptHostSession, attemptStopHosting, copyHostOffer, promptForHostOffer, promptForJoinerAnswer, copyLocalCandidates, promptForRemoteCandidates } from \"../network/serverBrowser.js\";\r\nimport { updateP2P } from \"../network/p2p.js\";\r\nimport { updateSquadmates, cycleSquadCommand, setSquadCommandById } from \"../squad/index.js\";\r\nimport { updateRagdolls } from \"../effects/ragdoll.js\";\r\nimport { updatePolishDebug } from \"../events/polishDebug.js\";\r\nimport { resolvePlatformLanding } from \"./arena.js\";\r\nimport { advanceTime } from \"../utils/time.js\";\r\nimport { getCurrentWeapon } from \"../combat/weapons.js\";\r\nimport { updateRecoil } from \"../../state/recoil.js\";\r\nimport { updateAmmoTimers, getAmmoStatus, startReload as requestReload } from \"../../state/ammo.js\";\r\n\r\nfunction clampPlayerX() {\r\n  stickman.x = Math.max(40, Math.min(canvas.width - 40, stickman.x));\r\n}\r\n\r\nfunction updatePlayerAlive(delta) {\r\n  if (stickman.vehicleId) {\r\n    return;\r\n  }\r\n\r\n  stickman.crouching = input.down && stickman.onGround && !stickman.rolling && !stickman.attacking;\r\n\r\n  if (stickman.rolling) {\r\n    stickman.vx = stickman.facing * ROLL_SPEED;\r\n    stickman.vy = 0;\r\n    stickman.rollTimer -= delta;\r\n    if (stickman.rollTimer <= 0) {\r\n      stickman.rolling = false;\r\n    }\r\n  } else {\r\n    let moveSpeed = SPEED;\r\n    if (stickman.crouching) {\r\n      moveSpeed *= 0.55;\r\n    }\r\n    if (stickman.attacking) {\r\n      moveSpeed *= 0.7;\r\n    }\r\n    if (stickman.reloading) {\r\n      moveSpeed *= 0.8;\r\n    }\r\n    if (stickman.smokeSlowTimer > 0) {\r\n      const slowFactor = stickman.smokeSlowStrength ?? 0.6;\r\n      moveSpeed *= Math.max(0.1, Math.min(1, slowFactor));\r\n    }\r\n    if (stickman.stunTimer > 0) {\r\n      moveSpeed *= 0.25;\r\n    }\r\n\r\n    stickman.vx = 0;\r\n    if (input.left) {\r\n      stickman.vx -= moveSpeed;\r\n      stickman.facing = -1;\r\n    }\r\n    if (input.right) {\r\n      stickman.vx += moveSpeed;\r\n      stickman.facing = 1;\r\n    }\r\n\r\n    const canJump = stickman.stunTimer <= 0;\r\n    if (stickman.onGround && canJump && input.jump && !stickman.crouching && !stickman.attacking) {\r\n      stickman.vy = -JUMP_SPEED;\r\n      stickman.onGround = false;\r\n    }\r\n\r\n    stickman.vy += GRAVITY * delta;\r\n  }\r\n\r\n  const previousY = stickman.y;\r\n  stickman.x += stickman.vx * delta;\r\n  stickman.y += stickman.vy * delta;\r\n  stickman.onGround = false;\r\n\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  const landedPlatform = resolvePlatformLanding(stickman, previousY, standingHeight);\r\n\r\n  if (!landedPlatform) {\r\n    const feetY = stickman.y + standingHeight;\r\n    if (feetY >= GROUND_Y) {\r\n      stickman.y = GROUND_Y - standingHeight;\r\n      stickman.vy = 0;\r\n      stickman.onGround = true;\r\n    }\r\n  }\r\n\r\n  clampPlayerX();\r\n}\r\n\r\nfunction updatePlayerInVehicle() {\r\n  const vehicle = getPlayerVehicle();\r\n  if (!vehicle) {\r\n    stickman.vehicleId = null;\r\n    stickman.controlMode = \"onFoot\";\r\n    return;\r\n  }\r\n  stickman.controlMode = \"vehicle\";\r\n  stickman.crouching = false;\r\n  stickman.rolling = false;\r\n  stickman.onGround = vehicle.onGround || vehicle.waterLineY != null;\r\n}\r\n\r\n\r\nfunction updatePlayerDead(delta) {\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  stickman.vehicleId = null;\r\n  stickman.controlMode = \"onFoot\";\r\n  stickman.vehicleCandidateId = null;\r\n  stickman.deadTimer = Math.max(0, stickman.deadTimer - delta);\r\n  stickman.vx *= 0.9;\r\n  stickman.vy += GRAVITY * delta;\r\n  stickman.x += stickman.vx * delta;\r\n  stickman.y += stickman.vy * delta;\r\n\r\n  const feetY = stickman.y + standingHeight;\r\n  if (feetY >= GROUND_Y) {\r\n    stickman.y = GROUND_Y - standingHeight;\r\n    stickman.vy = 0;\r\n    stickman.onGround = true;\r\n  }\r\n\r\n  clampPlayerX();\r\n\r\n  if (stickman.deadTimer === 0) {\r\n    stickman.health = stickman.maxHealth;\r\n    stickman.invulnerability = 1.2;\r\n    stickman.throwCooldown = 0;\r\n    stickman.gadgetCooldown = 0;\r\n    stickman.reloading = false;\r\n    stickman.stunTimer = 0;\r\n    stickman.flashBlindTimer = 0;\r\n    stickman.smokeSlowTimer = 0;\r\n    stickman.smokeSlowStrength = 1;\r\n    clearGadgets();\r\n    stickman.x = canvas.width * 0.5;\r\n    stickman.y = GROUND_Y - standingHeight;\r\n    stickman.vx = 0;\r\n    stickman.vy = 0;\r\n    stickman.onGround = true;\r\n  }\r\n}\r\n\r\nfunction updateGame(delta) {\r\n  advanceTime(delta);\r\n  stickman.invulnerability = Math.max(0, stickman.invulnerability - delta);\r\n  stickman.throwCooldown = Math.max(0, stickman.throwCooldown - delta);\r\n  stickman.gadgetCooldown = Math.max(0, (stickman.gadgetCooldown ?? 0) - delta);\r\n  stickman.stunTimer = Math.max(0, (stickman.stunTimer ?? 0) - delta);\r\n  stickman.flashBlindTimer = Math.max(0, (stickman.flashBlindTimer ?? 0) - delta);\r\n  stickman.smokeSlowTimer = Math.max(0, (stickman.smokeSlowTimer ?? 0) - delta);\r\n  if (stickman.smokeSlowTimer <= 0) {\r\n    stickman.smokeSlowStrength = 1;\r\n  }\r\n\r\n  const interactRequested = input.interactBuffered;\r\n  input.interactBuffered = false;\r\n  const squadCycleRequested = input.squadCommandCycleBuffered;\r\n  const squadSelectRequested = input.squadCommandSelect;\r\n  const serverBrowserToggleRequested = input.serverBrowserToggleBuffered;\r\n  const serverBrowserNavigate = input.serverBrowserNavigate;\r\n  const serverBrowserJoinRequested = input.serverBrowserJoinBuffered;\r\n  const serverBrowserHostRequested = input.serverBrowserHostBuffered;\r\n  const serverBrowserStopRequested = input.serverBrowserStopHostBuffered;\r\n  const serverBrowserCopyOfferRequested = input.serverBrowserCopyOfferBuffered;\r\n  const serverBrowserPasteOfferRequested = input.serverBrowserPasteOfferBuffered;\r\n  const serverBrowserAcceptAnswerRequested = input.serverBrowserAcceptAnswerBuffered;\r\n  const serverBrowserCopyCandidatesRequested = input.serverBrowserCopyCandidatesBuffered;\r\n  const serverBrowserPasteCandidatesRequested = input.serverBrowserPasteCandidatesBuffered;\r\n  input.squadCommandCycleBuffered = false;\r\n  input.squadCommandSelect = null;\r\n  input.serverBrowserToggleBuffered = false;\r\n  input.serverBrowserNavigate = 0;\r\n  input.serverBrowserJoinBuffered = false;\r\n  input.serverBrowserHostBuffered = false;\r\n  input.serverBrowserStopHostBuffered = false;\r\n  input.serverBrowserCopyOfferBuffered = false;\r\n  input.serverBrowserPasteOfferBuffered = false;\r\n  input.serverBrowserAcceptAnswerBuffered = false;\r\n\r\n  const rawAttackRequested = stickman.health > 0 ? input.attackBuffered : false;\r\n  const rawThrowRequested = stickman.health > 0 ? input.throwBuffered : false;\r\n  const rawReloadRequested = stickman.health > 0 ? input.reloadBuffered : false;\r\n\r\n  input.attackBuffered = false;\r\n  input.throwBuffered = false;\r\n  input.reloadBuffered = false;\r\n\r\n  const rollAttempted = input.roll;\r\n  input.roll = false;\r\n\r\n  handleVehicleInteraction(interactRequested);\r\n  if (squadCycleRequested) {\r\n    cycleSquadCommand();\r\n  }\r\n  if (squadSelectRequested) {\r\n    setSquadCommandById(squadSelectRequested);\r\n  }\r\n  if (serverBrowserToggleRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      hideServerBrowser();\r\n    } else {\r\n      showServerBrowser();\r\n    }\r\n  }\r\n  if (serverBrowserNavigate !== 0) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      selectServerBrowser(serverBrowserNavigate);\r\n    }\r\n  }\r\n  if (serverBrowserJoinRequested) {\r\n    const state = getServerBrowserState();\r\n    const selectedServer = state.visible ? state.servers[state.selectedIndex] : null;\r\n    if (selectedServer) {\r\n      attemptJoinSession(selectedServer).catch((error) => console.warn(\"Join failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserHostRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      attemptHostSession().catch((error) => console.warn(\"Host failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserStopRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      attemptStopHosting().catch((error) => console.warn(\"Stop hosting failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserCopyOfferRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible && state.hosting) {\r\n      copyHostOffer({ forceRegenerate: false, silent: false }).catch((error) => console.warn(\"Offer copy failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserPasteOfferRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      promptForHostOffer().catch((error) => console.warn(\"Offer accept failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserAcceptAnswerRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible && state.hosting) {\r\n      promptForJoinerAnswer().catch((error) => console.warn(\"Answer apply failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserCopyCandidatesRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible && state.hosting) {\r\n      copyLocalCandidates({ silent: false }).catch((error) => console.warn(\"Candidate copy failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserPasteCandidatesRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      promptForRemoteCandidates().catch((error) => console.warn(\"Candidate apply failed\", error));\r\n    }\r\n  }\r\n  let playerVehicle = getPlayerVehicle();\r\n  let inVehicle = Boolean(playerVehicle);\r\n\r\n  if (stickman.health <= 0 && inVehicle) {\r\n    forcePlayerExitVehicle({ preferDirection: playerVehicle?.facing });\r\n    playerVehicle = null;\r\n    inVehicle = false;\r\n  }\r\n\r\n  if (rollAttempted && stickman.health > 0 && !inVehicle) {\r\n    startRoll({ left: input.left, right: input.right });\r\n  }\r\n\r\n  if (!inVehicle && stickman.controlMode === \"vehicle\") {\r\n    stickman.controlMode = \"onFoot\";\r\n  }\r\n\r\n  const canAct = !inVehicle && stickman.stunTimer <= 0 && !stickman.reloading;\r\n\r\n  const attackRequested = canAct ? rawAttackRequested : false;\r\n  const throwRequested = canAct ? rawThrowRequested : false;\r\n  const reloadRequested = canAct ? rawReloadRequested : false;\r\n\r\n  if (stickman.health > 0) {\r\n    if (inVehicle) {\r\n      updatePlayerInVehicle();\r\n    } else {\r\n      updatePlayerAlive(delta);\r\n    }\r\n  } else {\r\n    updatePlayerDead(delta);\r\n  }\r\n\r\n  stickman.currentPose = determinePose();\r\n  const baseHeight = getTotalHeight(stickman.currentPose);\r\n\r\n  const remotePlayerCount = getRemotePlayers().length;\r\n  const aliveEnemies = enemies.reduce((count, enemy) => count + (enemy.health > 0 ? 1 : 0), 0);\r\n  const activeAllies = squadmates.reduce((count, ally) => count + (ally && ally.state !== \"defeated\" ? 1 : 0), 0);\r\n  setHostingMetrics({\r\n    playerCount: 1 + remotePlayerCount,\r\n    enemyCount: aliveEnemies,\r\n    alliesCount: activeAllies\r\n  });\r\n\r\n  const timestampNow = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n  updateVehicles(delta);\r\n  updateSupplyDrops(delta);\r\n  updateDestructibles(delta);\r\n  updateEnemySpawner(delta);\r\n  updateServerBrowser(delta, timestampNow);\r\n  updateP2P(delta);\r\n  updateSquadmates(delta);\r\n  playerVehicle = getPlayerVehicle();\r\n  inVehicle = Boolean(playerVehicle);\r\n  if (inVehicle) {\r\n    stickman.controlMode = \"vehicle\";\r\n  }\r\n\r\n  if (!canAct) {\r\n    stickman.attacking = false;\r\n    stickman.currentAttack = null;\r\n    stickman.attackElapsed = 0;\r\n    stickman.comboWindowOpen = false;\r\n    stickman.comboWindowTimer = 0;\r\n    stickman.nextAttackQueued = false;\r\n    stickman.hitboxSpawned = false;\r\n    stickman.attackIndex = -1;\r\n    stickman.activeHitboxes.length = 0;\r\n  }\r\n\r\n  const weapon = getCurrentWeapon();\r\n  const weaponCategory = weapon?.category ?? \"\";\r\n  const attackChain = weapon?.attackChain ?? [];\r\n  const hasMeleeChain = attackChain.length > 0;\r\n  const isRangedWeapon = weaponCategory.startsWith(\"ranged\");\r\n  const isThrowableWeapon = weaponCategory === \"throwable\";\r\n  const isGadgetWeapon = weaponCategory === \"gadget\";\r\n\r\n  if (isGadgetWeapon) {\r\n    if (attackRequested || throwRequested) {\r\n      deployGadget(weapon);\r\n    }\r\n    stickman.activeHitboxes.length = 0;\r\n  } else if (isThrowableWeapon) {\r\n    if (attackRequested || throwRequested) {\r\n      throwEquippedWeapon();\r\n    }\r\n    stickman.activeHitboxes.length = 0;\r\n  } else if (isRangedWeapon && !hasMeleeChain) {\r\n    stickman.activeHitboxes.length = 0;\r\n    if (weapon) {\r\n      const ammoStatus = getAmmoStatus(weapon.id);\r\n      if (reloadRequested) {\r\n        if (requestReload(weapon.id)) {\r\n          stickman.attacking = false;\r\n          stickman.currentAttack = null;\r\n          stickman.attackIndex = -1;\r\n        }\r\n      }\r\n      if (attackRequested) {\r\n        fireEquippedWeaponProjectile();\r\n      }\r\n      if (ammoStatus && ammoStatus.magazine <= 0 && ammoStatus.reserve > 0 && !ammoStatus.reloading) {\r\n        requestReload(weapon.id);\r\n      }\r\n    }\r\n  } else if (hasMeleeChain) {\r\n    if (attackRequested) {\r\n      attemptAttack();\r\n    }\r\n\r\n    if (stickman.attacking) {\r\n      advanceAttack(delta, spawnHitbox);\r\n    }\r\n\r\n    updateHitboxes(delta, baseHeight);\r\n    resolveHitDetection();\r\n  } else {\r\n    stickman.activeHitboxes.length = 0;\r\n    if (isRangedWeapon && attackRequested) {\r\n      fireEquippedWeaponProjectile();\r\n    }\r\n  }\r\n\r\n  updateTrainingDummy(delta);\r\n  updateThrowables(delta);\r\n  updateGadgets(delta);\r\n  updateGadgetMovement(delta);\r\n  updateAmmoTimers(delta, weapon?.id ?? null);\r\n  updateRecoil(delta);\r\n  updateDamagePopups(delta);\r\n  updateParticles(delta);\r\n  updatePolishDebug(delta);\r\n  updateProjectiles(delta);\r\n  updateRagdolls(delta, GROUND_Y);\r\n  updateEnemies(delta);\r\n}\r\n\r\nexport { updateGame };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { trainingDummy } from \"../../state/entities.js\";\r\n\r\nfunction updateTrainingDummy(delta) {\r\n  if (trainingDummy.flashTimer > 0) {\r\n    trainingDummy.flashTimer = Math.max(0, trainingDummy.flashTimer - delta);\r\n  }\r\n\r\n  if (trainingDummy.shakeTimer > 0) {\r\n    trainingDummy.shakeTimer = Math.max(0, trainingDummy.shakeTimer - delta);\r\n  }\r\n\r\n  trainingDummy.shakeMagnitude = Math.max(0, trainingDummy.shakeMagnitude - delta * 20);\r\n\r\n  if (trainingDummy.health <= 0) {\r\n    trainingDummy.respawnTimer = Math.max(0, trainingDummy.respawnTimer - delta);\r\n    if (trainingDummy.respawnTimer === 0) {\r\n      trainingDummy.health = trainingDummy.maxHealth;\r\n      trainingDummy.flashTimer = 0;\r\n      trainingDummy.shakeTimer = 0;\r\n      trainingDummy.shakeMagnitude = 0;\r\n    }\r\n  }\r\n}\r\n\r\nexport { updateTrainingDummy };\r\n","import \"./styles.css\";\r\n\r\nimport { initializeInput } from \"./core/input/index.js\";\r\nimport { initializeWeaponControls } from \"./core/combat/weapons.js\";\r\nimport { initializePlaceholderAudio } from \"./core/audio/placeholder.js\";\r\nimport { initializeP2PNetworking } from \"./core/network/p2p.js\";\r\nimport { drawBackground, drawDestructibles, drawVehicles, drawSupplyDrops, drawRemotePlayers, drawServerBrowser, drawSquadmates, drawStickman, drawHitboxes, drawTrainingDummy, drawEnemies, drawHud, drawProjectilesLayer, drawGadgetsLayer } from \"./core/render/index.js\";\r\nimport { drawDebugArena } from \"./core/world/arena.js\";\r\nimport { drawDamagePopups } from \"./core/effects/damage.js\";\r\nimport { drawRagdolls } from \"./core/effects/ragdoll.js\";\r\nimport { updateGame } from \"./core/world/update.js\";\r\n\r\ninitializeInput();\r\ninitializeWeaponControls();\r\ninitializePlaceholderAudio();\r\ninitializeP2PNetworking();\r\n\r\nlet lastTime = performance.now();\r\n\r\nfunction loop(timestamp) {\r\n  const delta = Math.min((timestamp - lastTime) / 1000, 0.1);\r\n  lastTime = timestamp;\r\n\r\n  updateGame(delta);\r\n\r\n  drawBackground();\r\n  drawDebugArena();\r\n  drawDestructibles();\r\n  drawVehicles();\r\n  drawSupplyDrops();\r\n  drawRemotePlayers();\r\n  drawServerBrowser();\r\n  drawSquadmates();\r\n  drawTrainingDummy();\r\n  drawEnemies();\r\n  drawGadgetsLayer();\r\n  drawRagdolls();\r\n  drawStickman();\r\n  drawHitboxes();\r\n  drawProjectilesLayer();\r\n  drawDamagePopups();\r\n  drawHud();\r\n\r\n  window.requestAnimationFrame(loop);\r\n}\r\n\r\nwindow.requestAnimationFrame(loop);\r\n\r\n\r\n"],"names":["module","exports","styleElement","nonce","setAttribute","stylesInDOM","getIndexByIdentifier","identifier","result","i","length","modulesToDom","list","options","idCountMap","identifiers","item","id","base","count","concat","indexByIdentifier","obj","css","media","sourceMap","supports","layer","references","updater","addElementStyle","byIndex","splice","push","api","domAPI","update","newObj","remove","lastIdentifiers","newList","index","newLastIdentifiers","_i","_index","styleSheet","cssText","firstChild","removeChild","appendChild","document","createTextNode","cssWithMappingToString","toString","this","map","content","needLayer","join","modules","dedupe","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","___CSS_LOADER_EXPORT___","element","createElement","setAttributes","attributes","insert","memo","style","target","styleTarget","querySelector","window","HTMLIFrameElement","contentDocument","head","e","getTarget","Error","insertStyleElement","styleTagTransform","apply","parentNode","removeStyleElement","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","prop","prototype","hasOwnProperty","call","nc","locals","input","seal","left","right","jump","down","roll","attackBuffered","throwBuffered","reloadBuffered","interactBuffered","attackDown","throwDown","squadCommandCycleBuffered","squadCommandSelect","serverBrowserToggleBuffered","serverBrowserNavigate","serverBrowserJoinBuffered","serverBrowserHostBuffered","serverBrowserStopHostBuffered","serverBrowserCopyOfferBuffered","serverBrowserPasteOfferBuffered","serverBrowserAcceptAnswerBuffered","serverBrowserCopyCandidatesBuffered","serverBrowserPasteCandidatesBuffered","initialized","handleKey","isDown","event","code","preventDefault","combatFists","name","description","category","attackChain","windup","active","recovery","comboStart","comboWindow","range","heightOffset","radius","damage","knockback","launch","shockBaton","strikerPistol","projectile","speed","lifetime","gravityFactor","color","ammo","magazine","reserve","reloadSeconds","vectorSmg","recoil","horizontal","vertical","decay","spread","perShot","max","fragGrenade","throwable","fuseSeconds","explosionRadius","arcVelocity","vx","vy","bounciness","cooldownSeconds","explosionDuration","selfDamageScale","selfKnockbackScale","effectType","flashBang","stunDuration","playerStunDuration","smokeCanister","smokeDuration","smokeRadius","smokeExpansion","smokeSlowMultiplier","smokeTickDuration","turretDrone","gadget","type","duration","fireInterval","maxActive","height","spawnOffset","x","y","baseColor","headColor","grappleRig","maxLength","maxRise","travelSpeed","pullSpeed","thunderCannon","increase","shieldBubble","strength","DEFAULT_LOADOUT","canvas","getElementById","context","getContext","GROUND_Y","SPEED","GRAVITY","standing","headRadius","bodyLength","legLength","armLength","strideMultiplier","armSwingAmplitude","legSwingAmplitude","crouching","rolling","DEBUG_PLATFORMS","width","LEVEL_WATER_ZONES","top","depth","LEVEL_DECOR","text","SQUAD_COMMANDS","label","order","getTotalHeight","pose","createGruntEnemy","spawnX","spawnY","Math","random","slice","facing","onGround","state","stateTimer","patrolRange","min","aggressionRange","attackRange","moveSpeed","health","maxHealth","attackCooldown","attackWindup","attackActive","attackDamage","attackKnockback","attackLaunch","flashTimer","shakeTimer","shakeMagnitude","invulnerability","respawnTimer","stunTimer","smokeSlowTimer","smokeSlowStrength","createSquadmate","offsetX","fireCooldown","commandTimer","targetEnemyId","highlight","roleIndex","stickman","controlMode","vehicleId","vehicleCandidateId","squadCommandIndex","squadCommandId","squadCommandCooldown","rollTimer","currentPose","attacking","attackIndex","currentAttack","attackElapsed","attackInstanceId","comboWindowOpen","comboWindowTimer","nextAttackQueued","hitboxSpawned","activeHitboxes","deadTimer","throwCooldown","gadgetCooldown","reloading","flashBlindTimer","equippedWeaponId","squadmates","Map","getRemotePlayers","Array","from","values","trainingDummy","enemies","weaponState","inventory","activeIndex","setActiveWeaponByIndex","isValidIndex","getWeaponInventory","ensureEquippedWeaponValid","existingIndex","indexOf","ammoState","ensureAmmoEntry","weaponId","def","delete","ammoDef","spreadDef","hasAmmo","capacity","Number","POSITIVE_INFINITY","entry","current","reloadTimer","set","getAmmoStatus","startReload","refillWeaponAmmo","controlsInitialized","previousWeaponState","getCurrentWeapon","equipWeaponIndex","previousId","cancelReload","ammoStatus","audioContext","lastTriggers","EVENT_SOUND_MAP","frequency","gain","shape","cooldown","detail","ensureAudioContext","AudioCtor","AudioContext","webkitAudioContext","resumeAudio","resume","catch","primeAudioContext","removeEventListener","getP2P","P2P","error","peerId","peerConnection","outboundChannel","inboundChannel","lastSendTime","connectionStatus","localDescriptionString","localCandidates","ensurePeerConnection","RTCPeerConnection","iceServers","createDataChannel","ordered","setupDataChannel","addEventListener","candidate","connectionState","channel","payload","parse","now","performance","Date","existing","commandId","lastUpdate","upsertRemotePlayer","console","warn","getP2PStatus","status","localDescription","serverBrowserState","servers","visible","selectedIndex","lastFetch","fetching","statusMessage","hosting","hostingSessionId","hostingLastHeartbeat","hostingExpiresAt","joinStatus","joinError","hostingMetrics","playerCount","enemyCount","alliesCount","p2p","offer","answer","pendingOffer","pendingAnswer","pendingCandidates","remoteCandidates","getServerBrowserState","setVisible","setServers","previousSelection","isArray","matchedIndex","findIndex","server","setError","message","setStatusMessage","setJoinStatus","setJoinError","setJoinedSessionId","joinedSessionId","recordFetchTimestamp","timestamp","setFetching","setHostingSession","expiresAt","Boolean","clearHosting","clearP2PState","setP2PAnswer","setP2PLocalCandidates","candidates","next","every","value","setP2PRemoteCandidates","setP2PError","setP2PPending","clamp","VEHICLE_DEFINITIONS","buggy","movementType","wheelRadius","wheelBase","driverSeat","exitOffsets","enterRadius","acceleration","braking","maxSpeed","idleDrag","airDrag","baseHealth","colorBody","colorAccent","colorDetail","raptorHeli","mountedWeapons","binding","offset","muzzles","scatter","flashDuration","flashRadius","barrelLength","barrelWidth","barrelColor","horizontalAcceleration","horizontalMaxSpeed","horizontalDrag","liftPower","descendPower","gravityScale","maxVerticalSpeed","verticalDamping","hoverMinAltitude","hoverMaxAltitude","spawnHover","autopilotStrength","rotorSpan","rotorThickness","tailLength","arrowJet","wingSpan","tideSkiff","waterSurfaceOffset","waterAcceleration","waterMaxSpeed","waterReverseSpeed","waterIdleDrag","turnDrag","bobAmplitude","bobSpeed","buoyancyPoint","splashIntensity","stormBarge","abyssSub","submergedOffset","scoutDrone","vehicleCounter","createVehicle","minX","maxX","centerX","waterLineY","preferredAltitude","hover","minAltitude","altitude","surfaceOffset","vehicle","tilt","driverId","enterCooldown","damageFlash","bobPhase","PI","mounts","mountDef","muzzleIndex","lastMuzzleX","lastMuzzleY","vehicles","getVehicleById","find","elapsed","getElapsedTime","RAGDOLL_BLUEPRINTS","player","offsetY","enemy","ragdolls","spawnRagdoll","kind","originX","originY","baseVx","baseVy","blueprint","part","life","maxLife","damagePopups","spawnDamagePopup","turrets","acquireTarget","turret","targets","ref","getTargets","closest","closestDistSq","Infinity","dx","dy","distSq","fireTurret","sign","distance","hypot","spawnProjectile","fireTimer","grappleState","tetherLength","targetX","targetY","retracting","endGrapple","shieldState","maxStrength","maxDuration","getShieldCenter","poseHeight","dispatchShieldEvent","dispatchEvent","CustomEvent","deactivateShield","reason","remainingStrength","center","deployGadget","weapon","gadgetConfig","config","baseHeight","spawnYBase","createTurret","shift","deployTurret","clampRect","apex","launchLength","anchorX","anchorY","startGrapple","activateShield","applyDamageToDummy","hit","popupY","applyDamageToEnemy","applyDamageToPlayer","baseDamage","baseKnockback","baseLaunch","adjustedHit","absorb","residualDamage","absorbShieldHit","finalDamage","finalKnockback","finalLaunch","finalFacing","round","DESTRUCTIBLE_TEMPLATES","concreteBarrier","rubbleHeight","material","bodyColor","edgeColor","accentColor","damageHighlight","debrisColor","shakeFactor","streetCar","glassColor","deathBlast","maxDamage","minDamageRatio","fuelBarrelCluster","stripeColor","streetTop","destructibles","baseY","spawn","template","halfWidth","destroyed","smokeTimer","rubbleLevel","deathTriggered","spawnConfig","createDestructibleFromSpawn","particles","rings","listenersAttached","spawnRingBurst","ttl","ring","startRadius","endRadius","maxTtl","lineWidth","spawnShieldRing","spawnShieldHitParticles","angle","cos","sin","ensureListeners","baseX","spawnMuzzleParticles","spawnShieldShatter","spawnExplosionParticles","spawnFlashBurst","spawnSmokePuffs","spawnSmokeDissipateRing","paletteMap","concrete","volatile","generic","palette","intensity","baseSpeed","spawnDestructibleHitParticles","maxRadius","computeExplosionFalloff","minRatio","falloff","applyExplosionImpulse","maxKnockback","includeTrainingDummy","includeEnemies","includePlayer","summary","dummyHit","enemiesHit","playerHit","damageCap","knockbackCap","radiusSafe","dummyX","dummyY","ratio","enemyX","enemyY","playerHeight","playerCenterY","getBounds","destructible","bottom","circleIntersectsDestructible","distanceToDestructible","damageDestructible","applied","appliedDamage","baseShake","cause","impactX","impactY","spawnDamageEffects","centerY","blast","damageDestructiblesInRadius","sourceId","triggerDestructibleDeath","damageMax","hits","handleProjectileCollision","handleHitboxCollision","hitbox","hitTargets","has","add","projectiles","Set","circleOverlap","ax","ay","ar","bx","by","br","radii","throwables","smokeClouds","dispatchThrowableEvent","detonate","grenade","detonated","explosionTimer","fuse","baseDetail","applyFlashEffect","cloud","baseRadius","slowMultiplier","tick","tickTimer","spawnSmokeCloud","cloudId","damageFalloff","destructibleFalloff","speedBase","offsetRadius","spawnExplosionDebris","applyExplosiveDamage","SUPPLY_DROP_TYPES","weight","crateColor","glowColor","medkit","heavy","supplyDrops","manager","nextDropTimer","nextDropTypeId","chooseWeightedType","incomingMessage","incomingTimer","incomingDuration","rewardMessage","rewardTimer","rewardDuration","dropSequence","entries","totalWeight","reduce","sum","applySupplyDropReward","typeId","heavyType","autoEquip","addWeaponToInventory","applyHeavyWeaponReward","applyAmmoReward","updateHighlight","drop","delta","playerX","POSES","playerFeetY","pickupDrop","despawnTimer","updateSupplyDrops","timer","parachutePhase","spawnSupplyDrop","drawCrate","baseAlpha","save","globalAlpha","parachuteWidth","canopyHeight","fillStyle","beginPath","moveTo","quadraticCurveTo","closePath","fill","strokeStyle","lineTo","stroke","topColor","highlightAlpha","fillRect","strokeRect","arc","restore","drawDestructible","shakeMag","wobblePhase","shakeX","shakeY","translate","progress","drawRubble","damageRatio","scale","windowColor","bodyTop","cabinHeight","windowHeight","drawStreetCar","barrelRadius","barrelHeight","positions","visibleCount","pos","ellipse","flicker","abs","toFixed","drawBarrelCluster","crackColor","crackCount","floor","phase","startX","crackHeight","wobble","drawBarrierBody","healthRatio","yOffset","clamped","barWidth","drawHealthTick","alpha","lifeRatio","drawSmokeColumn","muzzleFlashes","shieldBursts","throwableBursts","notices","shotIndicators","filters","weapons","shield","FILTER_TOGGLE_MAP","Digit6","Digit7","Digit8","pushNotice","last","age","pushThrowableBurst","burst","shouldCapture","handleFilterToggle","altKey","repeat","charAt","toUpperCase","toggleFilter","handleMuzzleFlash","handleShotFired","handleReloadStart","handleReloadFinish","handleRecoilKick","magnitude","handleShieldHit","handleShieldShatter","handleShieldEnd","handleThrowableThrown","handleThrowableExplosion","handleThrowableFlashBurst","String","handleThrowableSmokeDetonate","EPSILON","handleThrowableSmokeDissipate","listenersRegistered","updateList","getPolishDebugState","recoilState","horizontalKick","verticalKick","lastShotTime","resolvePlatformLanding","entity","previousY","prevFeet","platform","nextFeet","PLATFORM_STYLES","street","metro","rooftop","skybridge","terrace","balcony","median","plain","drawPlatform","getActiveCommand","findNearestEnemy","best","bestDist","dist","steerTowards","speedFactor","desired","dir","fireAtTarget","updateSquadmate","squadmate","command","standingHeight","updateMovement","getSquadStatus","members","PLAYER_DRIVER_ID","getPlayerVehicle","applyIdleDrag","dragAmount","drag","syncStickmanWithVehicle","seat","seatWorldX","seatWorldY","clampedX","exitVehicle","skipCooldown","preferRight","preferDirection","fallbackOffset","chosenOffset","inheritVelocity","updateGroundVehicle","isControlled","accelerateRight","accelerateLeft","direction","brake","applyGroundDriverInput","pow","groundTop","targetTilt","updateWaterVehicle","reverseSpeed","brakeStrength","waterSurface","steerRight","steerLeft","bobOffset","sprayOffset","tiltTarget","updateAirVehicle","maxAltitude","altitudeRate","gravity","isFinite","altitudeError","newAltitude","fireMountedWeaponProjectile","mountState","facingSign","followFacing","followVehicleFacing","vehicleFacing","appliedFacing","facingMultiplier","muzzle","muzzleX","muzzleY","projectileDef","scatterRadians","spreadAngle","facingSignValue","verticalSpeed","updateMountedWeaponsForVehicle","mountDefs","wantsPrimary","wantsSecondary","shouldFire","autoFire","drawHud","currentWeapon","weaponName","weaponSlots","recoilOffset","overlayAlpha","font","textAlign","fillText","comboText","infoY","playerVehicle","vehicleDefinition","vehicleLabel","mount","bindingLabel","toLowerCase","mountLabel","candidateDefinition","candidateLabel","candidateWeapons","supplyStatus","timeUntilNext","nextDropLabel","incomingAlpha","rewardAlpha","activeCount","eta","squadStatus","maxShown","member","p2pStatus","isInfinite","ammoLabel","recoilLabel","aliveEnemies","filter","slotLabel","nextHudY","gadgetStatus","turretCount","grappleActive","shieldActive","shieldStrength","shieldMaxStrength","getGadgetStatus","ready","cooldownLabel","maxShield","shieldValue","ceil","debugState","activeNotices","reverse","rightMargin","debugY","notice","filterLines","line","drawProjectilesLayer","drawProjectiles","flashAlpha","puffRadius","puffAlpha","outerRadius","ringAlpha","coreAlpha","fuseRatio","maxFuse","sparkOffsetX","sparkOffsetY","gradient","createRadialGradient","addColorStop","drawSmokeClouds","drawThrowables","particle","sizeFactor","drawParticles","flash","drawPolishDebugEffects","startAttack","attack","spawnHitbox","remaining","ownerFacing","fireEquippedWeaponProjectile","startsWith","consumeAmmo","projectileConfig","initialVy","finalAngle","atan2","spreadState","effectiveDegrees","radians","registerShot","kick","updateEnemyAI","distanceX","absDistance","stunned","effectiveAggression","shouldChase","chaseDir","updateEnemyAttacks","attackReach","spawnState","seeded","spawnEnemies","padding","getApiBase","replace","getSessionId","crypto","randomUUID","sanitizeSignal","raw","trim","async","copyToClipboard","navigator","clipboard","writeText","normalizeCandidateList","normalizeCandidate","syncLocalCandidates","getLocalCandidates","normalized","copyLocalCandidates","silent","copied","promptForRemoteCandidates","prompt","rawInput","sanitized","parsed","split","segment","parseCandidateInput","getP2POrThrow","addRemoteCandidate","merged","incoming","seen","unique","mergeCandidates","buildHostingMetadata","metrics","fallbackPlayerCount","fetchServerList","apiBase","response","fetch","headers","Accept","ok","json","mappedServers","metadata","players","maxPlayers","region","mode","updatedAt","signal","hostOffer","hostCandidates","joinAnswer","joinCandidates","staleThresholdMs","filteredServers","updatedAtMs","isNaN","hostSession","secret","computedPlayerCount","effectiveSignal","method","body","ttlSeconds","heartbeatSession","stopHosting","joinServer","serverId","url","joinedName","session","ensureHostOffer","forceRegenerate","createOffer","setP2POffer","copyHostOffer","acceptHostOffer","rawOffer","autoCopyAnswer","offerString","normalizedOffer","createAnswer","applyJoinerAnswer","rawAnswer","answerString","normalizedAnswer","acceptRemoteDescription","applyRemoteCandidates","updated","pumpSignalUpdates","setHostingMetrics","joinedSession","promptForHostOffer","promptForJoinerAnswer","attemptHostSession","Promise","resolve","alreadyHosting","then","attemptStopHosting","alreadyStopped","attemptJoinSession","directSignal","debug","notFound","fetchSessionDetail","refreshed","refreshedSignal","updatedEntry","resolveSignal","resolvedServer","signalAnswer","signalCandidates","reject","clampPlayerX","updateGame","advanceTime","interactRequested","squadCycleRequested","squadSelectRequested","serverBrowserToggleRequested","serverBrowserJoinRequested","serverBrowserHostRequested","serverBrowserStopRequested","serverBrowserCopyOfferRequested","serverBrowserPasteOfferRequested","serverBrowserAcceptAnswerRequested","serverBrowserCopyCandidatesRequested","serverBrowserPasteCandidatesRequested","rawAttackRequested","rawThrowRequested","rawReloadRequested","rollAttempted","bestVehicle","bestScore","vehicleFeet","verticalAllowance","score","enterVehicle","handleVehicleInteraction","cycleSquadCommand","setSquadCommandById","selectedServer","inVehicle","forcePlayerExitVehicle","startRoll","canAct","attackRequested","throwRequested","reloadRequested","updatePlayerInVehicle","slowFactor","canJump","updatePlayerAlive","updatePlayerDead","ally","timestampNow","updateVehicles","updateDestructibles","initial","seedInitialEnemies","deficit","batch","updateEnemySpawner","interval","updateServerBrowser","maxAgeMs","pruneRemotePlayers","readyState","send","updateP2P","updateSquadmates","weaponCategory","hasMeleeChain","isRangedWeapon","isThrowableWeapon","throwEquippedWeapon","attemptAttack","spawnHitboxFn","nextIndex","shouldChain","advanceAttack","updateHitboxes","resolveHitDetection","updateTrainingDummy","effectiveRadius","pdx","pdy","dissipated","updateSmokeClouds","updateThrowables","updateTurrets","updateShield","updateGadgets","progressSpeed","step","updateGrapple","updateGrappleState","updateGadgetMovement","activeWeaponId","completedReloads","needed","loaded","updateAmmoTimers","decayRate","decayFactor","updateRecoil","popup","updateDamagePopups","p","updateParticles","updatePolishDebug","updateProjectiles","groundY","piece","updateRagdolls","updateEnemies","ServerBrowser","host","stop","attemptHost","attemptStop","attemptJoin","copyOffer","regenerateOffer","promptOffer","promptAnswer","copyCandidates","promptCandidates","syncCandidates","button","slot","parseInt","NaN","keys","forEach","eventName","ctx","osc","createOscillator","baseFrequency","setValueAtTime","currentTime","gainNode","createGain","baseGain","rampDuration","exponentialRampToValueAtTime","connect","destination","start","scheduleTone","setLocalDescription","remoteDescriptionString","setRemoteDescription","RTCSessionDescription","candidateString","RTCIceCandidate","addIceCandidate","getLocalDescription","getStatus","close","lastTime","requestAnimationFrame","loop","skyGradient","createLinearGradient","horizon","drawBackground","zone","waveY","drawWaterBodies","decor","floors","f","drawDecor","drawDebugArena","items","drawDestructibles","candidateId","isPlayerVehicle","isCandidate","bodyWidth","bodyHeight","rotate","setLineDash","drawVehicles","drops","typeDef","drawSupplyDrops","remote","headCenterY","neckY","torsoBottomY","legReach","leftFootY","rightFootY","drawRemotePlayers","panelHeight","panelWidth","statusY","listTop","listBottom","maxRows","rowsToDraw","rowY","rowHeight","details","snippet","limit","p2pY","candidateSummary","lastLocalLabel","lastRemoteLabel","drawServerBrowser","commandColors","hold","defend","flank","outline","lineCap","drawSquadmates","dummy","topY","shake","armY","barX","barY","drawTrainingDummy","barHeight","drawEnemies","drawShield","baseWidth","remainingRatio","headHeight","drawTurrets","currentX","currentY","drawGrapple","drawRagdolls","strideStrength","swing","totalDuration","phaseOffset","legSwingBase","drawStickman","drawHitboxes","opacity","drawDamagePopups"],"sourceRoot":""}