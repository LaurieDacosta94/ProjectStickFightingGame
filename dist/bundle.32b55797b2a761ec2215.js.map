{"version":3,"file":"bundle.32b55797b2a761ec2215.js","mappings":"uCASAA,EAAOC,QANP,SAAwCC,GACtC,IAAIC,EAAmD,KACnDA,GACFD,EAAaE,aAAa,QAASD,EAEvC,C,SCNA,IAAIE,EAAc,GAClB,SAASC,EAAqBC,GAE5B,IADA,IAAIC,GAAU,EACLC,EAAI,EAAGA,EAAIJ,EAAYK,OAAQD,IACtC,GAAIJ,EAAYI,GAAGF,aAAeA,EAAY,CAC5CC,EAASC,EACT,KACF,CAEF,OAAOD,CACT,CACA,SAASG,EAAaC,EAAMC,GAG1B,IAFA,IAAIC,EAAa,CAAC,EACdC,EAAc,GACTN,EAAI,EAAGA,EAAIG,EAAKF,OAAQD,IAAK,CACpC,IAAIO,EAAOJ,EAAKH,GACZQ,EAAKJ,EAAQK,KAAOF,EAAK,GAAKH,EAAQK,KAAOF,EAAK,GAClDG,EAAQL,EAAWG,IAAO,EAC1BV,EAAa,GAAGa,OAAOH,EAAI,KAAKG,OAAOD,GAC3CL,EAAWG,GAAME,EAAQ,EACzB,IAAIE,EAAoBf,EAAqBC,GACzCe,EAAM,CACRC,IAAKP,EAAK,GACVQ,MAAOR,EAAK,GACZS,UAAWT,EAAK,GAChBU,SAAUV,EAAK,GACfW,MAAOX,EAAK,IAEd,IAA2B,IAAvBK,EACFhB,EAAYgB,GAAmBO,aAC/BvB,EAAYgB,GAAmBQ,QAAQP,OAClC,CACL,IAAIO,EAAUC,EAAgBR,EAAKT,GACnCA,EAAQkB,QAAUtB,EAClBJ,EAAY2B,OAAOvB,EAAG,EAAG,CACvBF,WAAYA,EACZsB,QAASA,EACTD,WAAY,GAEhB,CACAb,EAAYkB,KAAK1B,EACnB,CACA,OAAOQ,CACT,CACA,SAASe,EAAgBR,EAAKT,GAC5B,IAAIqB,EAAMrB,EAAQsB,OAAOtB,GAYzB,OAXAqB,EAAIE,OAAOd,GACG,SAAiBe,GAC7B,GAAIA,EAAQ,CACV,GAAIA,EAAOd,MAAQD,EAAIC,KAAOc,EAAOb,QAAUF,EAAIE,OAASa,EAAOZ,YAAcH,EAAIG,WAAaY,EAAOX,WAAaJ,EAAII,UAAYW,EAAOV,QAAUL,EAAIK,MACzJ,OAEFO,EAAIE,OAAOd,EAAMe,EACnB,MACEH,EAAII,QAER,CAEF,CACAtC,EAAOC,QAAU,SAAUW,EAAMC,GAG/B,IAAI0B,EAAkB5B,EADtBC,EAAOA,GAAQ,GADfC,EAAUA,GAAW,CAAC,GAGtB,OAAO,SAAgB2B,GACrBA,EAAUA,GAAW,GACrB,IAAK,IAAI/B,EAAI,EAAGA,EAAI8B,EAAgB7B,OAAQD,IAAK,CAC/C,IACIgC,EAAQnC,EADKiC,EAAgB9B,IAEjCJ,EAAYoC,GAAOb,YACrB,CAEA,IADA,IAAIc,EAAqB/B,EAAa6B,EAAS3B,GACtC8B,EAAK,EAAGA,EAAKJ,EAAgB7B,OAAQiC,IAAM,CAClD,IACIC,EAAStC,EADKiC,EAAgBI,IAEK,IAAnCtC,EAAYuC,GAAQhB,aACtBvB,EAAYuC,GAAQf,UACpBxB,EAAY2B,OAAOY,EAAQ,GAE/B,CACAL,EAAkBG,CACpB,CACF,C,UCtEA1C,EAAOC,QAVP,SAA2BsB,EAAKrB,GAC9B,GAAIA,EAAa2C,WACf3C,EAAa2C,WAAWC,QAAUvB,MAC7B,CACL,KAAOrB,EAAa6C,YAClB7C,EAAa8C,YAAY9C,EAAa6C,YAExC7C,EAAa+C,YAAYC,SAASC,eAAe5B,GACnD,CACF,C,UCNAvB,EAAOC,QAAU,SAAUmD,GACzB,IAAIxC,EAAO,GA4EX,OAzEAA,EAAKyC,SAAW,WACd,OAAOC,KAAKC,IAAI,SAAUvC,GACxB,IAAIwC,EAAU,GACVC,OAA+B,IAAZzC,EAAK,GAoB5B,OAnBIA,EAAK,KACPwC,GAAW,cAAcpC,OAAOJ,EAAK,GAAI,QAEvCA,EAAK,KACPwC,GAAW,UAAUpC,OAAOJ,EAAK,GAAI,OAEnCyC,IACFD,GAAW,SAASpC,OAAOJ,EAAK,GAAGN,OAAS,EAAI,IAAIU,OAAOJ,EAAK,IAAM,GAAI,OAE5EwC,GAAWJ,EAAuBpC,GAC9ByC,IACFD,GAAW,KAETxC,EAAK,KACPwC,GAAW,KAETxC,EAAK,KACPwC,GAAW,KAENA,CACT,GAAGE,KAAK,GACV,EAGA9C,EAAKH,EAAI,SAAWkD,EAASnC,EAAOoC,EAAQlC,EAAUC,GAC7B,iBAAZgC,IACTA,EAAU,CAAC,CAAC,KAAMA,OAASE,KAE7B,IAAIC,EAAyB,CAAC,EAC9B,GAAIF,EACF,IAAK,IAAIG,EAAI,EAAGA,EAAIT,KAAK5C,OAAQqD,IAAK,CACpC,IAAI9C,EAAKqC,KAAKS,GAAG,GACP,MAAN9C,IACF6C,EAAuB7C,IAAM,EAEjC,CAEF,IAAK,IAAI+C,EAAK,EAAGA,EAAKL,EAAQjD,OAAQsD,IAAM,CAC1C,IAAIhD,EAAO,GAAGI,OAAOuC,EAAQK,IACzBJ,GAAUE,EAAuB9C,EAAK,WAGrB,IAAVW,SACc,IAAZX,EAAK,KAGdA,EAAK,GAAK,SAASI,OAAOJ,EAAK,GAAGN,OAAS,EAAI,IAAIU,OAAOJ,EAAK,IAAM,GAAI,MAAMI,OAAOJ,EAAK,GAAI,MAF/FA,EAAK,GAAKW,GAMVH,IACGR,EAAK,IAGRA,EAAK,GAAK,UAAUI,OAAOJ,EAAK,GAAI,MAAMI,OAAOJ,EAAK,GAAI,KAC1DA,EAAK,GAAKQ,GAHVR,EAAK,GAAKQ,GAMVE,IACGV,EAAK,IAGRA,EAAK,GAAK,cAAcI,OAAOJ,EAAK,GAAI,OAAOI,OAAOJ,EAAK,GAAI,KAC/DA,EAAK,GAAKU,GAHVV,EAAK,GAAK,GAAGI,OAAOM,IAMxBd,EAAKqB,KAAKjB,GACZ,CACF,EACOJ,CACT,C,UClFAZ,EAAOC,QAAU,SAAUe,GACzB,IAAIwC,EAAUxC,EAAK,GACfiD,EAAajD,EAAK,GACtB,IAAKiD,EACH,OAAOT,EAET,GAAoB,mBAATU,KAAqB,CAC9B,IAAIC,EAASD,KAAKE,SAASC,mBAAmBC,KAAKC,UAAUN,MACzDO,EAAO,+DAA+DpD,OAAO+C,GAC7EM,EAAgB,OAAOrD,OAAOoD,EAAM,OACxC,MAAO,CAAChB,GAASpC,OAAO,CAACqD,IAAgBf,KAAK,KAChD,CACA,MAAO,CAACF,GAASE,KAAK,KACxB,C,gECZIgB,E,MAA0B,GAA4B,KAE1DA,EAAwBzC,KAAK,CAACjC,EAAOiB,GAAI,6aAsBtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,8BAA8B,MAAQ,GAAG,SAAW,yMAAyM,eAAiB,CAAC,0dAA4d,WAAa,MAEtxB,S,UCpBAjB,EAAOC,QANP,SAA4BY,GAC1B,IAAI8D,EAAUzB,SAAS0B,cAAc,SAGrC,OAFA/D,EAAQgE,cAAcF,EAAS9D,EAAQiE,YACvCjE,EAAQkE,OAAOJ,EAAS9D,EAAQA,SACzB8D,CACT,C,UCNA,IAAIK,EAAO,CAAC,EA+BZhF,EAAOC,QAPP,SAA0B8E,EAAQE,GAChC,IAAIC,EAtBN,SAAmBA,GACjB,QAA4B,IAAjBF,EAAKE,GAAyB,CACvC,IAAIC,EAAcjC,SAASkC,cAAcF,GAGzC,GAAIG,OAAOC,mBAAqBH,aAAuBE,OAAOC,kBAC5D,IAGEH,EAAcA,EAAYI,gBAAgBC,IAC5C,CAAE,MAAOC,GAEPN,EAAc,IAChB,CAEFH,EAAKE,GAAUC,CACjB,CACA,OAAOH,EAAKE,EACd,CAIeQ,CAAUX,GACvB,IAAKG,EACH,MAAM,IAAIS,MAAM,2GAElBT,EAAOjC,YAAYgC,EACrB,C,UC4BAjF,EAAOC,QAjBP,SAAgBY,GACd,GAAwB,oBAAbqC,SACT,MAAO,CACLd,OAAQ,WAAmB,EAC3BE,OAAQ,WAAmB,GAG/B,IAAIpC,EAAeW,EAAQ+E,mBAAmB/E,GAC9C,MAAO,CACLuB,OAAQ,SAAgBd,IAjD5B,SAAepB,EAAcW,EAASS,GACpC,IAAIC,EAAM,GACND,EAAII,WACNH,GAAO,cAAcH,OAAOE,EAAII,SAAU,QAExCJ,EAAIE,QACND,GAAO,UAAUH,OAAOE,EAAIE,MAAO,OAErC,IAAIiC,OAAiC,IAAdnC,EAAIK,MACvB8B,IACFlC,GAAO,SAASH,OAAOE,EAAIK,MAAMjB,OAAS,EAAI,IAAIU,OAAOE,EAAIK,OAAS,GAAI,OAE5EJ,GAAOD,EAAIC,IACPkC,IACFlC,GAAO,KAELD,EAAIE,QACND,GAAO,KAELD,EAAII,WACNH,GAAO,KAET,IAAIE,EAAYH,EAAIG,UAChBA,GAA6B,oBAATyC,OACtB3C,GAAO,uDAAuDH,OAAO8C,KAAKE,SAASC,mBAAmBC,KAAKC,UAAU9C,MAAe,QAKtIZ,EAAQgF,kBAAkBtE,EAAKrB,EAAcW,EAAQA,QACvD,CAoBMiF,CAAM5F,EAAcW,EAASS,EAC/B,EACAgB,OAAQ,YArBZ,SAA4BpC,GAE1B,GAAgC,OAA5BA,EAAa6F,WACf,OAAO,EAET7F,EAAa6F,WAAW/C,YAAY9C,EACtC,CAgBM8F,CAAmB9F,EACrB,EAEJ,C,GC1DI+F,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBtC,IAAjBuC,EACH,OAAOA,EAAanG,QAGrB,IAAID,EAASiG,EAAyBE,GAAY,CACjDlF,GAAIkF,EAEJlG,QAAS,CAAC,GAOX,OAHAoG,EAAoBF,GAAUnG,EAAQA,EAAOC,QAASiG,GAG/ClG,EAAOC,OACf,CCrBAiG,EAAoBI,EAAKtG,IACxB,IAAIuG,EAASvG,GAAUA,EAAOwG,WAC7B,IAAOxG,EAAiB,QACxB,IAAM,EAEP,OADAkG,EAAoBO,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,GCLRL,EAAoBO,EAAI,CAACxG,EAAS0G,KACjC,IAAI,IAAIC,KAAOD,EACXT,EAAoBW,EAAEF,EAAYC,KAASV,EAAoBW,EAAE5G,EAAS2G,IAC5EE,OAAOC,eAAe9G,EAAS2G,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3EV,EAAoBW,EAAI,CAACvF,EAAK4F,IAAUJ,OAAOK,UAAUC,eAAeC,KAAK/F,EAAK4F,GCAlFhB,EAAoBoB,QAAKzD,E,uHCWrBhD,EAAU,CAAC,EAEfA,EAAQgF,kBAAoB,IAC5BhF,EAAQgE,cAAgB,IACxBhE,EAAQkE,OAAS,SAAc,KAAM,QACrClE,EAAQsB,OAAS,IACjBtB,EAAQ+E,mBAAqB,IAEhB,IAAI,IAAS/E,GAKJ,KAAW,IAAQ0G,QAAS,IAAQA,OAAnD,MCxBDC,EAAStE,SAASuE,eAAe,eACjC,EAAUD,EAAOE,WAAW,MAElC,IAAK,EACH,MAAM,IAAI/B,MAAM,oCAGlB,MAAMgC,EAAWH,EAAOI,OAAS,GCH3BC,EAFc,EACGL,EAAOM,MAExBC,EAAaJ,EAEnB,SAASK,EAAOC,GACd,MAAwB,iBAAVA,EANI,EAMiBA,EAAsBA,CAC3D,CAEA,SAASC,EAAetH,GACtB,OAAOA,EAAK2C,IAAK4E,IAAa,IACzBA,EACHC,EAAGJ,EAAOG,EAASC,GACnBN,MAAOE,EAAOG,EAASL,SAE3B,CAEA,SAASO,EAAgBzH,GACvB,OAAOA,EAAK2C,IAAK+E,IAAS,IACrBA,EACHF,EAAGJ,EAAOM,EAAKF,GACfN,MAAOE,EAAOM,EAAKR,SAEvB,CAEA,SAASS,EAAW3H,GAClB,OAAOA,EAAK2C,IAAKiF,IACf,MAAMC,EAAS,IAAKD,GAgBpB,MAfwB,iBAAbC,EAAOL,IAChBK,EAAOL,EAAIJ,EAAOS,EAAOL,IAEC,iBAAjBK,EAAOC,QAChBD,EAAOC,MAAQV,EAAOS,EAAOC,QAEH,iBAAjBD,EAAOX,QAChBW,EAAOX,MAAQE,EAAOS,EAAOX,QAE3Ba,MAAMC,QAAQH,EAAOI,UACvBJ,EAAOI,OAASJ,EAAOI,OAAOtF,IAAKuF,IAAU,IACxCA,EACHV,EAAGJ,EAAOc,EAAMV,OAGbK,GAEX,CAEA,SAASM,EAAmBnI,GAC1B,OAAOA,EAAK2C,IAAKvC,IAAS,IACrBA,EACHoH,EAAGJ,EAAOhH,EAAKoH,KAEnB,CAEA,SAASY,EAAmBpI,GAC1B,OAAOA,EAAK2C,IAAKvC,IAAS,IACrBA,EACHoH,EAAGJ,EAAOhH,EAAKoH,GACfa,KAAMjB,EAAOhH,EAAKiI,MAClBC,KAAMlB,EAAOhH,EAAKkI,QAEtB,CAEA,SAASC,EAAmBvI,GAC1B,OAAOA,EAAK2C,IAAK6F,IAAU,IACtBA,EACHhB,EAAGJ,EAAOoB,EAAMhB,GAChBiB,OAAgC,iBAAjBD,EAAMC,OAnEL,EAmE2BD,EAAMC,OAAuBD,EAAMC,SAElF,CAEA,SAASC,EAAgBC,EAAOC,EAAY,CAAC,GAC3C,MAAMC,EAAaD,EAAUC,YAAc,IACrC3B,EAAQD,EAAa4B,EACrBrB,EAAiB,GAAbP,EAAmBC,EAAQ,EAC/B4B,EAAYF,EAAUE,WAAa,GACnCC,EAAQH,EAAUG,OAAS,GAajC,MAAO,IAAIJ,EAZS,CAClBnB,IACAN,QACA8B,IAAK7B,EAAa2B,EAClBC,QACAE,UAAWL,EAAUK,UACrBC,eAAgBN,EAAUM,eAC1BC,SAAUP,EAAUO,SACpBC,SAAUR,EAAUQ,SACpBC,YAAaT,EAAUS,YACvBC,YAAaV,EAAUU,aAG3B,CAEA,MAAMC,EAAejC,EAAe,CAClC,CAAEE,GAAI,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,UAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,UAC5D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,UAC5D,CAAEjC,EAAG,KAAMgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,UAC7D,CAAEjC,EAAG,GAAIgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,SAC5D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,WAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,aAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,WAC7D,CAAEjC,EAAG,KAAMgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,WAC9D,CAAEjC,EAAG,KAAMgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,WAC9D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,UAC5D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,YAGxDC,EAAgBhB,EACpBjB,EAAgB,CACd,CAAED,EAAG,IAAKN,MAAO,IAAK8B,IAAK7B,EAAa,GAAI4B,MAAO,MAErD,CACED,UAAW,GACXC,MAAO,GACPI,SAAU,2BACVC,SAAU,0BACVC,YAAa,yBACbC,YAAa,2BACbJ,eAAgB,8BAIdS,EAAWhC,EAAW,CAC1B,CAAE8B,KAAM,WAAYjC,GAAI,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,KACtE,CAAEyC,KAAM,WAAYjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,KACrE,CAAEyC,KAAM,WAAYjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,KACrE,CAAEyC,KAAM,WAAYjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,KACrE,CAAEyC,KAAM,WAAYjC,EAAG,KAAMgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,KACtE,CAAEyC,KAAM,WAAYjC,EAAG,KAAMgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,KACtE,CAAEyC,KAAM,YAAajC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAI4C,KAAM,gBAChF,CAAEH,KAAM,YAAajC,EAAG,KAAMgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAI4C,KAAM,UACjF,CAAEH,KAAM,cAAejC,EAAG,IAAKgC,EAAGrC,EAAa,KAC/C,CAAEsC,KAAM,cAAejC,EAAG,IAAKgC,EAAGrC,EAAa,KAC/C,CAAEsC,KAAM,cAAejC,EAAG,KAAMgC,EAAGrC,EAAa,KAChD,CAAEsC,KAAM,WAAYjC,EAAG,IAAKgC,EAAGrC,EAAa,KAC5C,CAAEsC,KAAM,WAAYjC,EAAG,KAAMgC,EAAGrC,EAAa,OAGzC0C,EAAmB1B,EAAmB,CAC1C,CAAE9H,GAAI,mBAAoBoJ,KAAM,kBAAmBjC,EAAG,IAAKsC,MAAO3C,GAClE,CAAE9G,GAAI,mBAAoBoJ,KAAM,kBAAmBjC,EAAG,KAAMsC,MAAO3C,GACnE,CAAE9G,GAAI,iBAAkBoJ,KAAM,YAAajC,EAAG,IAAKsC,MAAO3C,EAAY4C,QAAS,GAC/E,CAAE1J,GAAI,gBAAiBoJ,KAAM,YAAajC,EAAG,KAAMsC,MAAO3C,EAAY4C,OAAQ,GAC9E,CAAE1J,GAAI,qBAAsBoJ,KAAM,oBAAqBjC,EAAG,IAAKsC,MAAO3C,EAAa,IACnF,CAAE9G,GAAI,mBAAoBoJ,KAAM,oBAAqBjC,EAAG,IAAKsC,MAAO3C,EAAa,MAG7E6C,EAAmB5B,EAAmB,CAC1C,CAAE/H,GAAI,mBAAoBoJ,KAAM,YAAajC,EAAG,IAAKsC,MAAO3C,EAAa,GAAIkB,KAAM,IAAKC,KAAM,KAC9F,CAAEjI,GAAI,oBAAqBoJ,KAAM,YAAajC,EAAG,IAAKsC,MAAO3C,EAAa,IAAKkB,KAAM,IAAKC,KAAM,KAChG,CAAEjI,GAAI,mBAAoBoJ,KAAM,aAAcjC,EAAG,IAAKsC,MAAO3C,EAAa,IAAKkB,KAAM,GAAIC,KAAM,KAC/F,CAAEjI,GAAI,uBAAwBoJ,KAAM,aAAcjC,EAAG,IAAKsC,MAAO3C,EAAa,IAAKkB,KAAM,IAAKC,KAAM,KACpG,CAAEjI,GAAI,kBAAmBoJ,KAAM,YAAajC,EAAG,IAAKsC,MAAO3C,EAAa,IACxE,CAAE9G,GAAI,gBAAiBoJ,KAAM,YAAajC,EAAG,KAAMsC,MAAO3C,EAAa,MAGnE8C,EAAmB1B,EAAmB,CAC1C,CAAElI,GAAI,eAAgBoJ,KAAM,QAASjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKsB,OAAQ,IAAKyB,UAAW,IAAMC,MAAO,UAAWC,UAAW,EAAGC,QAAS,KACzI,CAAEhK,GAAI,eAAgBoJ,KAAM,QAASjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKsB,OAAQ,IAAKyB,UAAW,IAAMC,MAAO,UAAWC,UAAW,EAAGC,QAAS,KACzI,CAAEhK,GAAI,eAAgBoJ,KAAM,QAASjC,EAAG,KAAMgC,EAAGrC,EAAa,IAAKsB,OAAQ,IAAKyB,UAAW,IAAMC,MAAO,UAAWC,UAAW,EAAGC,QAAS,OAGtIC,EAAmBhD,EAAe,CACtC,CAAEE,GAAI,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,eAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,eAC5D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,eAC5D,CAAEjC,EAAG,KAAMgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,eAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,SAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,UAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,UAC7D,CAAEjC,EAAG,KAAMgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,YAG1Dc,EAAe7B,EACnBjB,EAAgB,CACd,CAAED,EAAG,IAAKN,MAAO,IAAK8B,IAAK7B,EAAa,GAAI4B,MAAO,IACnD,CAAEvB,EAAG,IAAKN,MAAO,IAAK8B,IAAK7B,EAAa,GAAI4B,MAAO,MAErD,CACED,UAAW,GACXC,MAAO,GACPI,SAAU,0BACVC,SAAU,yBACVC,YAAa,yBACbC,YAAa,4BACbJ,eAAgB,8BAIdsB,EAAe7C,EAAW,CAC9B,CAAE8B,KAAM,OAAQ3B,OAAQ,GAAIgC,MAAO3C,EAAYH,OAAQ,KACvD,CAAEyC,KAAM,OAAQ3B,MAAO,IAAKgC,MAAO3C,EAAa,EAAGH,OAAQ,KAC3D,CAAEyC,KAAM,OAAQ3B,MAAO,IAAKgC,MAAO3C,EAAa,GAAIH,OAAQ,KAC5D,CAAEyC,KAAM,OAAQ3B,MAAO,IAAKgC,MAAO3C,EAAa,GAAIH,OAAQ,KAC5D,CAAEyC,KAAM,OAAQjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,KACjE,CAAEyC,KAAM,OAAQjC,EAAG,KAAMgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,KAClE,CAAEyC,KAAM,WAAYjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,KACrE,CAAEyC,KAAM,YAAajC,EAAG,IAAKgC,EAAGrC,EAAa,IAC7C,CAAEsC,KAAM,YAAajC,EAAG,IAAKgC,EAAGrC,EAAa,IAC7C,CAAEsC,KAAM,YAAajC,EAAG,KAAMgC,EAAGrC,EAAa,GAAID,MAAO,GAAIF,OAAQ,OAGjEyD,EAAuBtC,EAAmB,CAC9C,CAAE9H,GAAI,oBAAqBoJ,KAAM,aAAcjC,EAAG,IAAKsC,MAAO3C,GAC9D,CAAE9G,GAAI,oBAAqBoJ,KAAM,aAAcjC,EAAG,KAAMsC,MAAO3C,GAC/D,CACE9G,GAAI,mBACJoJ,KAAM,aACNjC,EAAG,IACHsC,MAAO3C,EAAa,IACpBuD,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACbC,YAAa,UACbC,gBAAiB,UACjBC,YAAa,YAGjB,CACE1K,GAAI,cACJoJ,KAAM,cACNjC,EAAG,IACHsC,MAAO3C,EAAa,GACpBuD,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACbE,gBAAiB,UACjBC,YAAa,cAKbC,EAAuB5C,EAAmB,CAC9C,CACE/H,GAAI,oBACJoJ,KAAM,YACNjC,EAAG,IACHsC,MAAO3C,EAAa,GACpBkB,KAAM,IACNC,KAAM,IACNoC,kBAAmB,CACjBC,UAAW,UACXM,UAAW,UACXC,WAAY,UACZhC,eAAgB,YAGpB,CACE7I,GAAI,qBACJoJ,KAAM,YACNjC,EAAG,IACHsC,MAAO3C,EAAa,IACpBkB,KAAM,IACNC,KAAM,IACNoC,kBAAmB,CACjBC,UAAW,UACXM,UAAW,UACXC,WAAY,UACZhC,eAAgB,YAGpB,CACE7I,GAAI,eACJoJ,KAAM,aACNjC,EAAG,IACHsC,MAAO3C,EAAa,GACpBkB,KAAM,GACNC,KAAM,IACNoC,kBAAmB,CACjBC,UAAW,UACXE,YAAa,UACbI,UAAW,UACX9B,SAAU,YAGd,CACE9I,GAAI,aACJoJ,KAAM,YACNjC,EAAG,IACHsC,MAAO3C,EAAa,GACpBuD,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACbO,UAAW,cAKXC,EAAuB7C,EAAmB,CAC9C,CAAElI,GAAI,eAAgBoJ,KAAM,QAASjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAIsB,OAAQ,IAAKyB,UAAW,IAAMC,MAAO,UAAWC,UAAW,EAAGC,QAAS,KACxI,CAAEhK,GAAI,eAAgBoJ,KAAM,QAASjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAIsB,OAAQ,IAAKyB,UAAW,IAAMC,MAAO,UAAWC,UAAW,EAAGC,QAAS,KACxI,CAAEhK,GAAI,cAAeoJ,KAAM,QAASjC,EAAG,KAAMgC,EAAGrC,EAAa,IAAKsB,OAAQ,IAAKyB,UAAW,GAAKC,MAAO,UAAWC,UAAW,EAAGC,QAAS,OAGpIgB,EAAgB,CACpB,CAAE7D,GAAI,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,QAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,QAC5D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,QAC5D,CAAEjC,EAAG,KAAMgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,QAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,SAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,WAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,WAC7D,CAAEjC,EAAG,KAAMgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,YAG1D6B,EAAY5C,EAChBjB,EAAgB,CACd,CAAED,EAAG,IAAKN,MAAO,IAAK8B,IAAK7B,EAAa,GAAI4B,MAAO,MAErD,CACED,UAAW,GACXC,MAAO,GACPI,SAAU,2BACVC,SAAU,0BACVC,YAAa,0BACbC,YAAa,4BACbJ,eAAgB,8BAIdqC,EAAY5D,EAAW,CAC3B,CAAE8B,KAAM,OAAQ3B,MAAO,IAAKgC,MAAO3C,EAAYD,MAAO,IAAKF,OAAQ,KACnE,CAAEyC,KAAM,OAAQ3B,MAAO,IAAKgC,MAAO3C,EAAYD,MAAO,IAAKF,OAAQ,KACnE,CAAEyC,KAAM,OAAQ3B,MAAO,KAAMgC,MAAO3C,EAAYD,MAAO,IAAKF,OAAQ,KACpE,CAAEyC,KAAM,YAAa3B,MAAO,IAAKgC,MAAO3C,EAAYH,OAAQ,KAC5D,CAAEyC,KAAM,YAAa3B,MAAO,KAAMgC,MAAO3C,EAAYH,OAAQ,KAC7D,CAAEyC,KAAM,WAAY3B,MAAO,IAAKgC,MAAO3C,EAAa,IACpD,CAAEsC,KAAM,UAAWjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKH,OAAQ,OAGpDwE,EAAoBrD,EAAmB,CAC3C,CACE9H,GAAI,oBACJoJ,KAAM,cACNjC,EAAG,IACHsC,MAAO3C,EACPuD,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACbE,gBAAiB,UACjBC,YAAa,YAGjB,CACE1K,GAAI,oBACJoJ,KAAM,cACNjC,EAAG,KACHsC,MAAO3C,EACPuD,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACbE,gBAAiB,UACjBC,YAAa,YAGjB,CACE1K,GAAI,aACJoJ,KAAM,aACNjC,EAAG,IACHsC,MAAO3C,EAAa,GACpB4C,QAAS,EACTW,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACba,WAAY,UACZX,gBAAiB,UACjBC,YAAa,YAGjB,CACE1K,GAAI,YACJoJ,KAAM,aACNjC,EAAG,IACHsC,MAAO3C,EAAa,IACpBuD,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACbC,YAAa,UACbC,gBAAiB,UACjBC,YAAa,cAKbW,EAAoBtD,EAAmB,CAC3C,CACE/H,GAAI,aACJoJ,KAAM,YACNjC,EAAG,IACHsC,MAAO3C,EAAa,GACpBkB,KAAM,IACNC,KAAM,IACNoC,kBAAmB,CACjBC,UAAW,UACXM,UAAW,UACXC,WAAY,UACZhC,eAAgB,YAGpB,CACE7I,GAAI,cACJoJ,KAAM,aACNjC,EAAG,IACHsC,MAAO3C,EAAa,GACpBkB,KAAM,IACNC,KAAM,IACNoC,kBAAmB,CACjBC,UAAW,UACXE,YAAa,UACbI,UAAW,UACX9B,SAAU,YAGd,CACE9I,GAAI,YACJoJ,KAAM,YACNjC,EAAG,KACHsC,MAAO3C,EAAa,GACpBuD,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACbO,UAAW,cAKXQ,EAAoBpD,EAAmB,CAC3C,CAAElI,GAAI,YAAaoJ,KAAM,QAASjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAIsB,OAAQ,IAAKyB,UAAW,IAAKC,MAAO,UAAWC,UAAW,EAAGC,QAAS,KACpI,CAAEhK,GAAI,cAAeoJ,KAAM,QAASjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKsB,OAAQ,IAAKyB,UAAW,GAAKC,MAAO,UAAWC,UAAW,EAAGC,QAAS,OAGnIuB,EAAmBtE,EAAe,CACtC,CAAEE,GAAI,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,QAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,QAC5D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,QAC5D,CAAEjC,EAAG,KAAMgC,EAAGrC,EAAa,GAAID,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,QAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,WAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,WAC7D,CAAEjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,UAC7D,CAAEjC,EAAG,KAAMgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,GAAIyC,KAAM,YAgB1DoC,GAbenD,EACnBjB,EAAgB,IAChB,CACEqB,UAAW,GACXC,MAAO,GACPI,SAAU,2BACVC,SAAU,2BACVC,YAAa,0BACbC,YAAa,4BACbJ,eAAgB,6BAICvB,EAAW,CAC9B,CAAE8B,KAAM,QAAS3B,MAAO,IAAKgC,MAAO3C,EAAYH,OAAQ,KACxD,CAAEyC,KAAM,QAAS3B,MAAO,IAAKgC,MAAO3C,EAAYH,OAAQ,KACxD,CAAEyC,KAAM,QAAS3B,MAAO,KAAMgC,MAAO3C,EAAYH,OAAQ,KACzD,CAAEyC,KAAM,gBAAiBjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKD,MAAO,IAAKF,OAAQ,IAAK4C,KAAM,UACrF,CAAEH,KAAM,aAAc3B,MAAO,IAAKgC,MAAO3C,EAAa,GAAIH,OAAQ,KAClE,CAAEyC,KAAM,aAAc3B,MAAO,KAAMgC,MAAO3C,EAAa,GAAIH,OAAQ,KACnE,CAAEyC,KAAM,WAAYjC,EAAG,IAAKgC,EAAGrC,EAAa,KAC5C,CAAEsC,KAAM,WAAYjC,EAAG,KAAMgC,EAAGrC,EAAa,QAGzC2E,EAAuB3D,EAAmB,CAC9C,CACE9H,GAAI,uBACJoJ,KAAM,cACNjC,EAAG,IACHsC,MAAO3C,EACPuD,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACbE,gBAAiB,UACjBC,YAAa,YAGjB,CACE1K,GAAI,uBACJoJ,KAAM,cACNjC,EAAG,KACHsC,MAAO3C,EACPuD,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACbE,gBAAiB,UACjBC,YAAa,YAGjB,CACE1K,GAAI,kBACJoJ,KAAM,aACNjC,EAAG,IACHsC,MAAO3C,EAAa,GACpBuD,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACbC,YAAa,UACbC,gBAAiB,YAGrB,CACEzK,GAAI,gBACJoJ,KAAM,aACNjC,EAAG,IACHsC,MAAO3C,EAAa,IACpB4C,OAAQ,EACRW,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACba,WAAY,UACZX,gBAAiB,UACjBC,YAAa,cAKbgB,EAAuB3D,EAAmB,CAC9C,CACE/H,GAAI,sBACJoJ,KAAM,YACNjC,EAAG,IACHsC,MAAO3C,EAAa,GACpBkB,KAAM,IACNC,KAAM,IACNoC,kBAAmB,CACjBC,UAAW,UACXM,UAAW,UACXC,WAAY,UACZhC,eAAgB,YAGpB,CACE7I,GAAI,sBACJoJ,KAAM,YACNjC,EAAG,KACHsC,MAAO3C,EAAa,IACpBkB,KAAM,IACNC,KAAM,KACNoC,kBAAmB,CACjBC,UAAW,UACXM,UAAW,UACXC,WAAY,UACZhC,eAAgB,YAGpB,CACE7I,GAAI,iBACJoJ,KAAM,aACNjC,EAAG,IACHsC,MAAO3C,EAAa,GACpBkB,KAAM,IACNC,KAAM,IACNoC,kBAAmB,CACjBC,UAAW,UACXE,YAAa,UACbI,UAAW,UACX9B,SAAU,YAGd,CACE9I,GAAI,eACJoJ,KAAM,YACNjC,EAAG,IACHsC,MAAO3C,EAAa,GACpBuD,kBAAmB,CACjBC,UAAW,UACXC,YAAa,UACbO,UAAW,cAKXa,EAAuBzD,EAAmB,CAC9C,CAAElI,GAAI,iBAAkBoJ,KAAM,QAASjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKsB,OAAQ,IAAKyB,UAAW,IAAKC,MAAO,UAAWC,UAAW,GAAIC,QAAS,KAC3I,CAAEhK,GAAI,iBAAkBoJ,KAAM,QAASjC,EAAG,KAAMgC,EAAGrC,EAAa,IAAKsB,OAAQ,IAAKyB,UAAW,IAAKC,MAAO,UAAWC,UAAW,GAAIC,QAAS,KAC5I,CAAEhK,GAAI,gBAAiBoJ,KAAM,OAAQjC,EAAG,IAAKgC,EAAGrC,EAAa,IAAKsB,OAAQ,IAAKyB,UAAW,GAAKC,MAAO,UAAW8B,UAAW,EAAGC,IAAe,GAAVC,KAAKC,GAAUC,QAAS,GAAKjC,UAAW,MAGxKkC,EAA0B,CAC9BC,YAAa,CACXlM,GAAI,cACJmM,KAAM,eACNC,MAAO,QACPvF,MAAOD,EACPyF,WAAY,CACVC,cAAe,CACb,CAAEC,OAAQ,EAAGzC,MAAO,WACpB,CAAEyC,OAAQ,GAAKzC,MAAO,WACtB,CAAEyC,OAAQ,IAAMzC,MAAO,WACvB,CAAEyC,OAAQ,EAAGzC,MAAO,YAEtB0C,YAAa,CACXC,MAAO3F,EAAa,IACpBH,OAAQ,IACRmC,SAAU,0BACVE,YAAa,uBAEf0D,YAAa,UACbC,YAAa,CACX,CACE7C,MAAO,UACPlC,OAAQ,CACN,CAAET,EAAG,EAAGgC,EAAGrC,EAAa,KACxB,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,MAAOoC,EAAGrC,EAAa,KACnC,CAAEK,EAAGJ,EAAO,MAAOoC,EAAGrC,EAAa,KACnC,CAAEK,EAAGJ,EAAO,MAAOoC,EAAGrC,EAAa,KACnC,CAAEK,EAAGP,EAAYuC,EAAGrC,EAAa,KACjC,CAAEK,EAAGP,EAAYuC,EAAGrC,GACpB,CAAEK,EAAG,EAAGgC,EAAGrC,OAKnB8F,UAAW1D,EACX2D,WAAYxD,EACZ9B,MAAO+B,EACPwD,cAAetD,EACfuD,cAAepD,EACfqD,cAAepD,EACfqD,MAAO,CACLC,OAAQ,CAAE/F,EAAgB,GAAbP,GACbuG,cAAe,CAAEhG,EAAgB,IAAbP,GACpBwG,aAAc,EAAE,IAAK,GAAI,KACzBC,QAAS,CAAc,IAAbzG,EAAgC,IAAbA,KAGjC0G,aAAc,CACZtN,GAAI,eACJmM,KAAM,gBACNC,MAAO,SACPvF,MAAOD,EACPyF,WAAY,CACVC,cAAe,CACb,CAAEC,OAAQ,EAAGzC,MAAO,WACpB,CAAEyC,OAAQ,IAAMzC,MAAO,WACvB,CAAEyC,OAAQ,GAAKzC,MAAO,WACtB,CAAEyC,OAAQ,EAAGzC,MAAO,YAEtB0C,YAAa,CACXC,MAAO3F,EAAa,IACpBH,OAAQ,IACRmC,SAAU,yBACVE,YAAa,uBAEf0D,YAAa,UACbC,YAAa,CACX,CACE7C,MAAO,UACPlC,OAAQ,CACN,CAAET,EAAG,EAAGgC,EAAGrC,EAAa,KACxB,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGP,EAAYuC,EAAGrC,EAAa,KACjC,CAAEK,EAAGP,EAAYuC,EAAGrC,GACpB,CAAEK,EAAG,EAAGgC,EAAGrC,OAKnB8F,UAAW3C,EACX4C,WAAY3C,EACZ3C,MAAO4C,EACP2C,cAAe1C,EACf2C,cAAepC,EACfqC,cAAejC,EACfkC,MAAO,CACLC,OAAQ,CAAE/F,EAAgB,IAAbP,GACbuG,cAAe,CAAEhG,EAAgB,GAAbP,GACpBwG,aAAc,EAAE,KAAM,GAAI,KAC1BC,QAAS,CAAc,GAAbzG,EAA+B,GAAbA,KAGhC2G,YAAa,CACXvN,GAAI,cACJmM,KAAM,eACNC,MAAO,SACPvF,MAAOD,EACPyF,WAAY,CACVC,cAAe,CACb,CAAEC,OAAQ,EAAGzC,MAAO,WACpB,CAAEyC,OAAQ,IAAMzC,MAAO,WACvB,CAAEyC,OAAQ,IAAMzC,MAAO,WACvB,CAAEyC,OAAQ,EAAGzC,MAAO,YAEtB0C,YAAa,CACXC,MAAO3F,EAAa,IACpBH,OAAQ,IACRmC,SAAU,2BACVE,YAAa,wBAEf0D,YAAa,UACbC,YAAa,CACX,CACE7C,MAAO,UACPlC,OAAQ,CACN,CAAET,EAAG,EAAGgC,EAAGrC,EAAa,KACxB,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGP,EAAYuC,EAAGrC,EAAa,KACjC,CAAEK,EAAGP,EAAYuC,EAAGrC,GACpB,CAAEK,EAAG,EAAGgC,EAAGrC,OAKnB8F,UAAW5B,EACX6B,WAAY5B,EACZ1D,MAAO2D,EACP4B,cAAe3B,EACf4B,cAAe1B,EACf2B,cAAe1B,EACf2B,MAAO,CACLC,OAAQ,CAAE/F,EAAgB,IAAbP,GACbuG,cAAe,CAAEhG,EAAgB,IAAbP,GACpBwG,aAAc,EAAE,KAAM,GAAI,KAC1BC,QAAS,CAAc,IAAbzG,EAAgC,IAAbA,KAGjC4G,aAAc,CACZxN,GAAI,eACJmM,KAAM,gBACNC,MAAO,SACPvF,MAAOD,EACPyF,WAAY,CACVC,cAAe,CACb,CAAEC,OAAQ,EAAGzC,MAAO,WACpB,CAAEyC,OAAQ,GAAKzC,MAAO,WACtB,CAAEyC,OAAQ,IAAMzC,MAAO,WACvB,CAAEyC,OAAQ,EAAGzC,MAAO,YAEtB0C,YAAa,CACXC,MAAO3F,EAAa,IACpBH,OAAQ,IACRmC,SAAU,2BACVE,YAAa,uBAEf0D,YAAa,UACbC,YAAa,CACX,CACE7C,MAAO,UACPlC,OAAQ,CACN,CAAET,EAAG,EAAGgC,EAAGrC,EAAa,KACxB,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,KAAMoC,EAAGrC,EAAa,KAClC,CAAEK,EAAGJ,EAAO,MAAOoC,EAAGrC,EAAa,KACnC,CAAEK,EAAGJ,EAAO,MAAOoC,EAAGrC,EAAa,KACnC,CAAEK,EAAGP,EAAYuC,EAAGrC,EAAa,KACjC,CAAEK,EAAGP,EAAYuC,EAAGrC,GACpB,CAAEK,EAAG,EAAGgC,EAAGrC,OAKnB8F,UAAWrB,EACXsB,WAAY,GACZtF,MAAOiE,EACPsB,cAAerB,EACfsB,cAAerB,EACfsB,cAAerB,EACfsB,MAAO,CACLC,OAAQ,CAAE/F,EAAgB,GAAbP,GACbuG,cAAe,CAAEhG,EAAgB,IAAbP,GACpBwG,aAAc,EAAE,KAAM,GAAI,KAC1BC,QAAS,CAAc,GAAbzG,EAA+B,GAAbA,MAK5B6G,GAAuB,CAAC,cAAe,eAAgB,cAAe,gBCjxBtEC,GAAgB,CACpBC,UAAW,IACXC,QAAS,IAGX,IAAIC,GAAe,EAMnB,SAASC,KACP,OAAOJ,GAAcC,SACvB,CAEA,SAASI,GAAiBC,GACxBN,GAAcC,UAAY7B,KAAKmC,IAAI,EAAGnC,KAAKoC,MAAMF,GAAU,GAC7D,CAEA,SAASG,GAAaH,EAAQI,EAAS,IAChCC,OAAOC,SAASN,IAAsB,IAAXA,IAGhCN,GAAcC,UAAY7B,KAAKmC,IAAI,EAAGP,GAAcC,UAAY7B,KAAKyC,MAAMP,IAC7E,CAkBA,SAASQ,IAAmB,EAAErH,EAAI,EAAC,EAAEgC,EAAI,EAAC,OAAE6E,EAAS,GAAE,GAAES,EAA6B,IAAvB3C,KAAK4C,SAAW,IAAS,GAAEC,GAAK,IAAI,IAAEC,EAAM,GAAM,CAAC,GAChH,MAAMC,EAAS,CACb7O,GAAI,WAAW6N,KACf1G,IACAgC,IACAsF,KACAE,KACAX,OAAQlC,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMP,GAAU,IACzCY,MACAE,OAAQF,EACRG,WAAW,GAGb,OADArB,GAAcE,QAAQ5M,KAAK6N,GACpBA,CACT,CCpDA,IAAIG,GAAuBvB,GAAqB,IAAM5H,OAAOoJ,KAAKhD,GAAyB,GAC3F,MAAMiD,GAAY,IAAIC,IACtB,IAAIC,IAAsB,EAE1B,SAASC,GAAyBrP,EAAKgP,IACrC,MAAMtJ,EAAauG,EAAwBjM,GAC3C,GAAI0F,EACF,OAAOA,EAET,MAAM4J,EAAa7B,GAAqB,IAAM5H,OAAOoJ,KAAKhD,GAAyB,GAEnF,OADA+C,GAAuBM,EAChBrD,EAAwBqD,EACjC,CAEA,SAAS,KACP,MAAMC,EAAcF,KACpB,MAAqC,iBAAvBE,GAAa1I,MAAqB0I,EAAY1I,MAAQN,EAAOM,KAC7E,CAMA,SAAS2I,KACP,MAAMD,EAAcF,KACpB,OAAO3H,MAAMC,QAAQ4H,GAAa3C,WAAa2C,EAAY3C,UAAY,EACzE,CA2BA,SAAS6C,KACP,MAAMF,EAAcF,KACpB,OAAOE,GAAatC,OAAS,CAAC,CAChC,CAEA,SAASyC,KACP,MAAMhK,EAAa2J,KACnB,IAAK,MAAMM,KAAYT,GACrB,IACES,EAASjK,EACX,CAAE,MAAOkK,GACgB,oBAAZC,SAA2BA,QAAQD,OAC5CC,QAAQD,MAAM,6BAA8BA,EAEhD,CAEoB,oBAAXxL,QAA0D,mBAAzBA,OAAO0L,eACjD1L,OAAO0L,cACL,IAAIC,YAAY,sBAAuB,CACrCC,OAAQ,CAAET,YAAa7J,EAAY1F,GAAI0F,GAAY1F,IAAMgP,MAIjE,CAEA,SAASiB,GAAeC,GACtB,SAAKA,IAAkBjE,EAAwBiE,IAG3CA,IAAkBlB,KAGtBA,GAAuBkB,ED9BvBxC,GAAcE,QAAQnO,OAAS,ECgC/BiQ,KACO,GACT,CAYA,SAASS,GAAoBR,EAAU/P,EAAU,CAAC,GAChD,MAAwB,mBAAb+P,EACF,QAETT,GAAUkB,IAAIT,IACY,IAAtB/P,EAAQyQ,WACVV,EAASN,MAEJ,KACLH,GAAUoB,OAAOX,IAErB,CCjHA,MAAMY,GAAc,CAClBpJ,EAAkB,GAAfZ,EAAOM,MACV2J,QAAwB,GAAfjK,EAAOM,OAGlB,SAAS4J,KACP,MAAsB,GAAflK,EAAOM,KAChB,CAEA,SAAS6J,GAAa1J,GACpB,MAAM2J,EAAOF,KACPG,EAAW,KACjB,OAAIA,GAAYrK,EAAOM,MACC,GAAfN,EAAOM,MAETiF,KAAK+E,IAAI/E,KAAKmC,IAAIjH,EAAO2J,GAAOC,EAAWD,EACpD,CAWA,SAASG,KALT,IAAsB3J,IAOI,GADP,KALjBoJ,GAAYpJ,EAAIuJ,GAAavJ,GAC7BoJ,GAAYC,QAAUD,GAAYpJ,CAMpC,CAUA,SAAS4J,KACP,MAAMJ,EAAOF,KACPG,EAAW,KACXI,EAAWN,GAAaH,GAAYpJ,GAC1C,IAAI8J,EAAOD,EAAWL,EAOtB,OALEM,EADEL,GAAYrK,EAAOM,MACdiF,KAAKmC,IAAI,EAAe,GAAX2C,EAAkBD,GAE/B7E,KAAK+E,IAAI/E,KAAKmC,IAAI,EAAGgD,GAAOL,EAAWrK,EAAOM,OAGhD,CACLM,EAAG6J,EACH7H,EAAG,EACH+H,UAAWP,EACXM,OACAE,MANYF,EAAO1K,EAAOM,MAO1BuK,QAASH,EAEb,CAEAd,GAAoB,KAClBW,OAGFA,KCjEA,MAAMO,GAAQxL,OAAOyL,KAAK,CACxBL,MAAM,EACNE,OAAO,EACPI,MAAM,EACNC,MAAM,EACNC,MAAM,EACNC,gBAAgB,EAChBC,eAAe,EACfC,gBAAgB,EAChBC,kBAAkB,EAClBC,YAAY,EACZC,WAAW,EACXC,2BAA2B,EAC3BC,mBAAoB,KACpBC,6BAA6B,EAC7BC,sBAAuB,EACvBC,2BAA2B,EAC3BC,2BAA2B,EAC3BC,+BAA+B,EAC/BC,gCAAgC,EAChCC,iCAAiC,EACjCC,mCAAmC,EACnCC,qCAAqC,EACrCC,sCAAsC,EACtCC,qBAAqB,EACrBC,mBAAoB,EACpBC,sBAAsB,EACtBC,qBAAqB,EACrBC,wBAAwB,EACxBC,uBAAuB,EACvBC,oBAAoB,EACpBC,uBAAuB,IAGnBC,GAAUvN,OAAOyL,KAAK,CAC1B+B,QAAwB,GAAf9M,EAAOM,MAChByM,QAAyB,GAAhB/M,EAAOI,OAChB4M,OAAuB,GAAfhN,EAAOM,MACf2M,OAAwB,GAAhBjN,EAAOI,OACf8M,QAAQ,EACRC,WAAY,IAGd,SAASC,KACP,MAAMC,EAAS7C,KACTK,EAAUwC,GAAQxC,SAAW,EAC7ByC,EAAUD,GAAQzK,GAAK,EAC7BiK,GAAQG,OAASH,GAAQC,QAAUjC,EACnCgC,GAAQI,OAASJ,GAAQE,QAAUO,CACrC,CAEA,SAASC,GAAsBC,GAC7B,IAAKxN,IAAWwN,EAEd,YADAJ,KAGF,MAAMK,EAAOzN,EAAO0N,wBACdC,EAASH,EAAMI,QAAUH,EAAK/C,KAC9BmD,EAASL,EAAMM,QAAUL,EAAKrL,IAC9B5B,EAASiN,EAAKnN,MAAQ,EAAIN,EAAOM,MAAQmN,EAAKnN,MAAQ,EACtDyN,EAASN,EAAKrN,OAAS,EAAIJ,EAAOI,OAASqN,EAAKrN,OAAS,EAC/DyM,GAAQC,QAAUa,EAASnN,EAC3BqM,GAAQE,QAAUc,EAASE,EAC3BlB,GAAQK,OAASS,GAAU,GAAKA,GAAUF,EAAKnN,OAASuN,GAAU,GAAKA,GAAUJ,EAAKrN,OACtFyM,GAAQM,WAAoC,oBAAhBa,YAA8BA,YAAYC,MAAQC,KAAKD,MACnFb,IACF,CAUA,IAAIe,IAAc,EAElB,SAASC,GAAUC,EAAQb,GACzB,OAAQA,EAAMc,MACZ,IAAK,YACL,IAAK,OACHxD,GAAMJ,KAAO2D,EACbb,EAAMe,iBACN,MACF,IAAK,aACL,IAAK,OACHzD,GAAMF,MAAQyD,EACdb,EAAMe,iBACN,MACF,IAAK,UACL,IAAK,OACL,IAAK,QACHzD,GAAME,KAAOqD,EACbb,EAAMe,iBACN,MACF,IAAK,YACL,IAAK,OACHzD,GAAMG,KAAOoD,EACbb,EAAMe,iBACN,MACF,IAAK,QACCF,IACFvD,GAAMwB,oBAAsB,EAC5BkB,EAAMe,kBAER,MACF,IAAK,SACCF,IACFvD,GAAMwB,mBAAqB,EAC3BkB,EAAMe,kBAER,MACF,IAAK,SACCF,IACFvD,GAAM0B,qBAAsB,EAC5BgB,EAAMe,kBAEV,IAAK,YACL,IAAK,aACCF,IACFvD,GAAMI,MAAO,EACbsC,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMuB,qBAAsB,EAC5BmB,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAM2B,wBAAyB,EAC/Be,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAM4B,uBAAwB,EAC9Bc,EAAMe,kBAER,MACF,IAAK,KACCF,IACFvD,GAAM6B,oBAAqB,EAC3Ba,EAAMe,kBAER,MACF,IAAK,OACL,IAAK,OACCF,GACFvD,GAAMK,gBAAiB,EACvBL,GAAMS,YAAa,EACnBiC,EAAMe,mBAENzD,GAAMS,YAAa,EACnBiC,EAAMe,kBAER,MACF,IAAK,OACCF,GACFvD,GAAMM,eAAgB,EACtBN,GAAMU,WAAY,EAClBgC,EAAMe,mBAENzD,GAAMU,WAAY,EAClBgC,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMO,gBAAiB,EACvBmC,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMQ,kBAAmB,EACzBkC,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMW,2BAA4B,EAClC+B,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAM8B,uBAAwB,EAC9BY,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMY,mBAAqB,OAC3B8B,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMY,mBAAqB,SAC3B8B,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMY,mBAAqB,SAC3B8B,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMY,mBAAqB,QAC3B8B,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMa,6BAA8B,EACpC6B,EAAMe,kBAER,MACF,IAAK,cACCF,IACFvD,GAAMc,uBAAyB,EAC/B4B,EAAMe,kBAER,MACF,IAAK,eAML,IAAK,QACCF,IACFvD,GAAMc,sBAAwB,EAC9B4B,EAAMe,kBAER,MACF,IAAK,QACCF,IACFvD,GAAMe,2BAA4B,EAClC2B,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMgB,2BAA4B,EAClC0B,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMiB,+BAAgC,EACtCyB,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMkB,gCAAiC,EACvCwB,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMmB,iCAAkC,EACxCuB,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMoB,mCAAoC,EAC1CsB,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMqB,qCAAsC,EAC5CqB,EAAMe,kBAER,MACF,IAAK,OACCF,IACFvD,GAAMsB,sCAAuC,EAC7CoB,EAAMe,kBAMd,CA0BA,SAASC,KACP1D,GAAMJ,MAAO,EACbI,GAAMF,OAAQ,EACdE,GAAME,MAAO,EACbF,GAAMG,MAAO,EACbH,GAAMI,MAAO,EACbJ,GAAMK,gBAAiB,EACvBL,GAAMM,eAAgB,EACtBN,GAAMO,gBAAiB,EACvBP,GAAMQ,kBAAmB,EACzBR,GAAMS,YAAa,EACnBT,GAAMU,WAAY,EAClBV,GAAMW,2BAA4B,EAClCX,GAAMY,mBAAqB,KAC3BZ,GAAMa,6BAA8B,EACpCb,GAAMc,sBAAwB,EAC9Bd,GAAMe,2BAA4B,EAClCf,GAAMgB,2BAA4B,EAClChB,GAAMiB,+BAAgC,EACtCjB,GAAMkB,gCAAiC,EACvClB,GAAMmB,iCAAkC,EACxCnB,GAAMoB,mCAAoC,EAC1CpB,GAAMqB,qCAAsC,EAC5CrB,GAAMsB,sCAAuC,EAC7CtB,GAAM8B,uBAAwB,CAChC,CC3VA,MAAM,GAAqB,CACzB6B,YAAa,CACXhV,GAAI,cACJmM,KAAM,eACN8I,YAAa,+DACbC,SAAU,cACVC,YAAa,CACX,CACEhJ,KAAM,YACNiJ,OAAQ,IACR3B,OAAQ,GACR4B,SAAU,IACVC,WAAY,GACZC,YAAa,IACbC,MAAO,GACPC,cAAe,GACfrN,OAAQ,GACRsN,OAAQ,EACRC,UAAW,IACXC,OAAQ,GAEV,CACEzJ,KAAM,eACNiJ,OAAQ,IACR3B,OAAQ,IACR4B,SAAU,IACVC,WAAY,IACZC,YAAa,IACbC,MAAO,GACPC,cAAe,GACfrN,OAAQ,GACRsN,OAAQ,GACRC,UAAW,IACXC,OAAQ,GAEV,CACEzJ,KAAM,cACNiJ,OAAQ,IACR3B,OAAQ,IACR4B,SAAU,IACVC,WAAY,IACZC,YAAa,IACbC,MAAO,GACPC,cAAe,GACfrN,OAAQ,GACRsN,OAAQ,GACRC,UAAW,IACXC,OAAQ,OAIdC,WAAY,CACV7V,GAAI,aACJmM,KAAM,cACN8I,YAAa,8DACbC,SAAU,YACVC,YAAa,CACX,CACEhJ,KAAM,YACNiJ,OAAQ,IACR3B,OAAQ,IACR4B,SAAU,IACVC,WAAY,IACZC,YAAa,IACbC,MAAO,GACPC,cAAe,GACfrN,OAAQ,GACRsN,OAAQ,GACRC,UAAW,IACXC,OAAQ,GAEV,CACEzJ,KAAM,cACNiJ,OAAQ,GACR3B,OAAQ,IACR4B,SAAU,GACVC,WAAY,GACZC,YAAa,IACbC,MAAO,GACPC,cAAe,GACfrN,OAAQ,GACRsN,OAAQ,GACRC,UAAW,IACXC,OAAQ,IAEV,CACEzJ,KAAM,YACNiJ,OAAQ,IACR3B,OAAQ,GACR4B,SAAU,GACVC,WAAY,IACZC,YAAa,IACbC,MAAO,GACPC,cAAe,GACfrN,OAAQ,GACRsN,OAAQ,GACRC,UAAW,IACXC,OAAQ,OAIdE,cAAe,CACb9V,GAAI,gBACJmM,KAAM,iBACN8I,YAAa,8DACbC,SAAU,eACVC,YAAa,GACbY,aAAc,IACdC,MAAM,EACNC,OAAQ,CACNhW,KAAM,GACNiW,QAAS,IACTjI,IAAK,EACLoH,SAAU,GAEZc,WAAY,CACV/N,OAAQ,EACRgO,MAAO,IACPV,OAAQ,GACRC,UAAW,GACXU,SAAU,KACVC,cAAe,IACfxM,MAAO,WAETyM,KAAM,CACJC,SAAU,GACVC,QAAS,GACTC,cAAe,KAEjBC,OAAQ,CACNC,WAAY,IACZC,SAAU,IACVC,MAAO,KAGXC,UAAW,CACT/W,GAAI,YACJmM,KAAM,aACN8I,YAAa,oDACbC,SAAU,aACVC,YAAa,GACbY,aAAc,IACdC,MAAM,EACNG,WAAY,CACV/N,OAAQ,EACRgO,MAAO,IACPV,OAAQ,GACRC,UAAW,GACXU,SAAU,GACVC,cAAe,IACfxM,MAAO,WAETyM,KAAM,CACJC,SAAU,GACVC,QAAS,IACTC,cAAe,KAEjBC,OAAQ,CACNC,WAAY,IACZC,SAAU,IACVC,MAAO,IAETb,OAAQ,CACNhW,KAAM,IACNiW,QAAS,IACTjI,IAAK,IACLoH,SAAU,IAGd2B,YAAa,CACXhX,GAAI,cACJmM,KAAM,eACN8I,YAAa,8DACbC,SAAU,YACVC,YAAa,GACb8B,UAAW,CACTC,YAAa,IACbC,gBAAiB,IACjBzB,OAAQ,GACRC,UAAW,IACXyB,YAAa,CAAE3I,GAAI,IAAKE,IAAK,KAC7B2H,cAAe,GACfe,WAAY,IACZvN,MAAO,UACP1B,OAAQ,GACRkP,gBAAiB,IACjBC,kBAAmB,IACnBC,gBAAiB,IACjBC,mBAAoB,IACpBC,WAAY,cAGhBC,UAAW,CACT3X,GAAI,YACJmM,KAAM,YACN8I,YAAa,6DACbC,SAAU,YACVC,YAAa,GACb8B,UAAW,CACTC,YAAa,KACbC,gBAAiB,IACjBzB,OAAQ,EACRC,UAAW,EACXyB,YAAa,CAAE3I,GAAI,IAAKE,IAAK,KAC7B2H,cAAe,IACfe,WAAY,GACZvN,MAAO,UACP1B,OAAQ,GACRkP,gBAAiB,IACjBC,kBAAmB,IACnBG,WAAY,QACZE,aAAc,IACdC,mBAAoB,MAGxBC,cAAe,CACb9X,GAAI,gBACJmM,KAAM,iBACN8I,YAAa,iEACbC,SAAU,YACVC,YAAa,GACb8B,UAAW,CACTC,YAAa,GACbC,gBAAiB,GACjBzB,OAAQ,EACRC,UAAW,EACXyB,YAAa,CAAE3I,GAAI,IAAKE,IAAK,KAC7B2H,cAAe,IACfe,WAAY,IACZvN,MAAO,UACP1B,OAAQ,GACRkP,gBAAiB,IACjBC,kBAAmB,GACnBG,WAAY,QACZK,cAAe,EACfC,YAAa,IACbC,eAAgB,IAChBC,oBAAqB,GACrBC,kBAAmB,MAGvBC,YAAa,CACXpY,GAAI,cACJmM,KAAM,oBACN8I,YAAa,2EACbC,SAAU,SACVC,YAAa,GACbkD,OAAQ,CACNjP,KAAM,SACNkO,gBAAiB,IACjBgB,SAAU,GACV9C,MAAO,IACPO,aAAc,IACdwC,UAAW,EACX5R,OAAQ,GACR6R,YAAa,CAAErR,EAAG,GAAIgC,EAAG,GACzBsP,UAAW,UACXC,UAAW,UACXvC,WAAY,CACVC,MAAO,IACPhO,OAAQ,EACRsN,OAAQ,GACRC,UAAW,GACXU,SAAU,KACVvM,MAAO,aAIb6O,WAAY,CACV3Y,GAAI,aACJmM,KAAM,cACN8I,YAAa,wEACbC,SAAU,SACVC,YAAa,GACbkD,OAAQ,CACNjP,KAAM,UACNkO,gBAAiB,IACjBgB,SAAU,IACVM,UAAW,IACXC,QAAS,IACTC,YAAa,IACbC,UAAW,IACXjP,MAAO,YAGXkP,cAAe,CACbhZ,GAAI,gBACJmM,KAAM,iBACN8I,YAAa,+DACbC,SAAU,eACVC,YAAa,GACbY,aAAc,GACdC,MAAM,EACNG,WAAY,CACV/N,OAAQ,GACRgO,MAAO,IACPV,OAAQ,GACRC,UAAW,IACXU,SAAU,IACVC,cAAe,IACfxM,MAAO,WAETyM,KAAM,CACJC,SAAU,EACVC,QAAS,EACTC,cAAe,KAEjBC,OAAQ,CACNC,WAAY,IACZC,SAAU,IACVC,MAAO,KAETb,OAAQ,CACNhW,KAAM,IACNiW,QAAS,IACTjI,IAAK,IACLoH,SAAU,MAGd4D,aAAc,CACZjZ,GAAI,eACJmM,KAAM,gBACN8I,YAAa,yEACbC,SAAU,SACVC,YAAa,GACbkD,OAAQ,CACNjP,KAAM,SACNkO,gBAAiB,EACjBgB,SAAU,IACVY,SAAU,IACV9Q,OAAQ,IACR0B,MAAO,aAKPqP,GAAkB,CAAC,cAAe,aAAc,gBAAiB,cAAe,YAAa,gBAAiB,cAAe,aAAc,gBChV3IC,GAAQ,IAIRC,GAAU,KAEV,GAAQ,CACZC,SAAU,CACRC,WAAY,GACZC,WAAY,GACZC,UAAW,GACXC,UAAW,GACXC,iBAAkB,EAClBC,kBAAmB,GACnBC,kBAAmB,IAErBC,UAAW,CACTP,WAAY,GACZC,WAAY,GACZC,UAAW,GACXC,UAAW,GACXC,iBAAkB,GAClBC,kBAAmB,EACnBC,kBAAmB,GAErBE,QAAS,CACPR,WAAY,GACZC,WAAY,GACZC,UAAW,GACXC,UAAW,GACXC,iBAAkB,EAClBC,kBAAmB,EACnBC,kBAAmB,IChCjBG,GAAiB,CACrB,CACEha,GAAI,OACJia,MAAO,OACPhF,YAAa,iCACbiF,MAAO,GAET,CACEla,GAAI,SACJia,MAAO,SACPhF,YAAa,iDACbiF,MAAO,GAET,CACEla,GAAI,SACJia,MAAO,SACPhF,YAAa,4CACbiF,MAAO,GAET,CACEla,GAAI,QACJia,MAAO,QACPhF,YAAa,mDACbiF,MAAO,IClBX,SAASC,GAAezQ,EAAS,EAAGK,EAAY,IAC9C,MAAMqQ,EAAY1Q,GAAU,EAAI,EAAIoC,KAAKC,GACnC0C,EAAK3C,KAAKuO,IAAID,GACdzL,EAAK7C,KAAKwO,IAAIF,GACpB,MAAO,CACLG,MAAOH,EACPI,YAAaJ,EACbK,QAAShM,EACTiM,QAAS/L,EACTgM,UAAW,EACXC,QAAS,EACTC,QAAS,EACTrK,QAAS/B,EACTqM,QAASnM,EACT5E,YACA0J,QAAQ,EACRsH,YAAa,EAEjB,CAEA,SAASC,GAAeC,GACtB,OAAyB,EAAlBA,EAAK1B,WAAiB0B,EAAKzB,WAAayB,EAAKxB,SACtD,CAEA,SAASyB,GAAiBC,EAAQvb,EAAU,CAAC,GAC3C,MAAMwb,EAAgB3L,KAChB4L,EAAa3T,MAAMC,QAAQyT,GAAe/N,SAAW+N,EAAc/N,QAAU,GAC7EiO,EAA8B,iBAAXH,EAAsBA,EAASE,EAAW,IAA8B,IAAxB,KAKnEE,EAASH,GAAeI,QAAU9U,EADpB,IAEd+U,EAAa7b,EAAQ8b,SAAW,UAChCC,EAAc/b,EAAQ+b,aAA8B,aAAfF,EACrCG,EAAYhc,EAAQgc,WAAa,KACjCC,EAAgBjc,EAAQ8J,QAAU,EAGxC,MAAO,CACL1J,GAHS,SAAS8L,KAAK4C,SAAStM,SAAS,IAAI0Z,MAAM,EAAG,KAItDX,OAAQG,EACRC,SACApU,EAAGmU,EACHnS,EAAGoS,EACH9M,GAAI,EACJE,GAAI,EACJvG,OAAQ,GACRzB,OAjBkB,IAkBlB+C,OAAQmS,EACRE,UAAU,EACVC,MAAO,SACPC,WAAY,EAAInQ,KAAK4C,SACrBwN,YAAa,CAAErL,IAAKyK,EAAY,IAAKrN,IAAKqN,EAAY,KACtDa,gBAAiB,IACjBC,YAAa,GACbC,UA1BoB,IA2BpBC,OA7BoB,IA8BpBC,UA9BoB,IA+BpBC,eAAgB,EAChBC,aAAc,EACdC,aAAc,EACdC,aAjCuB,GAkCvBC,gBAAiB,IACjBC,cAAe,GACfC,UAAW,CACTP,UAtCkB,IAuClBI,aAtCqB,GAuCrBN,UAtCkB,KAwCpBU,WAAY,EACZC,WAAY,EACZC,eAAgB,EAChBC,gBAAiB,EACjBC,aAAc,EACdC,UAAW,EACXC,eAAgB,EAChBC,kBAAmB,EACnBC,aAAc9B,EACdE,cACAC,YACA4B,IAAKrD,GAAe0B,EAAe,IACnCpI,QAAQ,EAEZ,CAEA,SAASgK,GAAgBrM,EAAU,EAAGjF,EAAO,OAAQ1E,EAAgC,GAAxB,MAC3D,MAAM0T,EAAS1T,EAAQ2J,EACjBmK,EAAS7U,EAAWsU,GAAe,GAAM1B,UAC/C,MAAO,CACLtZ,GAAI,SAAS8L,KAAK4C,SAAStM,SAAS,IAAI0Z,MAAM,EAAG,KACjD3P,OACAhF,EAAGgU,EACHhS,EAAGoS,EACH9M,GAAI,EACJE,GAAI,EACJjF,OAAQ,EACRqS,UAAU,EACVC,MAAO,SACP0B,aAAc,EACdC,aAAc,EACdC,cAAe,KACfb,WAAY,EACZnU,UAAW,EACXiV,qBAAsB,EACtBC,wBAAyB,EACzBN,IAAKrD,GAAe,EAAG,IACvB4D,UAAW,EAEf,CAEA,MAAM3C,GAAgB3L,KAChBuO,GAAiBhD,GAAe,GAAM1B,UACtC2E,GAAe7C,IAAelO,QAAQ/F,GAA6B,GAAxB,KAG3C+W,GAAW,CACf/W,EAAG8W,GACH9U,EAJmBiS,IAAelO,QAAQ/D,GAAKzC,EAAWsX,GAK1DvP,GAAI,EACJE,GAAI,EACJjF,OAAQ,EACRqS,UAAU,EACVoC,YAAa,SACbC,UAAW,KACXC,mBAAoB,KACpBC,kBAAmB,EACnBC,eAAgBvE,GAAe,IAAIha,IAAM,OACzCwe,qBAAsB,EACtBzE,SAAS,EACT0E,UAAW,EACX3E,WAAW,EACX4E,YAAa,GAAMpF,SACnBqF,WAAW,EACXC,aAAc,EACdC,cAAe,KACfC,cAAe,EACfC,iBAAkB,EAClBC,iBAAiB,EACjBC,iBAAkB,EAClBC,kBAAkB,EAClBC,eAAe,EACfC,eAAgB,GAChB9C,OAAQ,IACRC,UAAW,IACXW,gBAAiB,EACjBmC,UAAW,EACXC,cAAe,EACf5B,aAAc,EACd6B,eAAgB,EAChBC,WAAW,EACXpC,UAAW,EACXqC,gBAAiB,EACjBpC,eAAgB,EAChBC,kBAAmB,EACnBO,qBAAsB,EACtBC,wBAAyB,EACzBN,IAAKrD,GAAe,EAAG,IACvBuF,iBAAkB,eAGdtS,GAAe1F,MAAMC,QAAQyT,IAAehO,cAC9CgO,GAAchO,aACd,EAAE,IAAK,GAAI,KAETuS,GAAa,CACjBlC,GAAgBrQ,GAAa,KAAO,IAAK,UAAW6Q,IACpDR,GAAgBrQ,GAAa,IAAM,GAAI,OAAQ6Q,IAC/CR,GAAgBrQ,GAAa,IAAM,IAAK,QAAS6Q,KAG7C,GAAgB,IAAI2B,IAE1B,SAASC,GAAmB7D,GAC1B,IAAKA,IAAUA,EAAMhc,GACnB,OAEF,MAAMwU,EAA6B,oBAAhBD,YAA8BA,YAAYC,MAAQC,KAAKD,MACpEsL,EAAW,GAAc9Z,IAAIgW,EAAMhc,KAAO,CAAC,EACjD,GAAc+f,IAAI/D,EAAMhc,GAAI,CAC1BA,GAAIgc,EAAMhc,GACVmM,KAAM6P,EAAM7P,MAAQ2T,EAAS3T,MAAQ,SACrChF,EAAG6U,EAAM7U,GAAK2Y,EAAS3Y,GAAK,EAC5BgC,EAAG6S,EAAM7S,GAAK2W,EAAS3W,GAAKzC,EAAWsX,GACvCtU,OAAQsS,EAAMtS,QAAUoW,EAASpW,QAAU,EAC3CsW,UAAWhE,EAAMgE,WAAaF,EAASE,WAAa,OACpDtM,WAAYc,GAEhB,CAEA,SAASyL,KACP,OAAOvY,MAAMwY,KAAK,GAAcC,SAClC,CAWA,MAAMhT,GAAgB,CACpBnN,GAAI,iBACJmH,EAAGiU,IAAejO,eAAehG,GAA6B,IAAxB,KACtCgC,EAAGiS,IAAejO,eAAehE,GAAKzC,EAAW,IACjDC,OAAQ,IACRyB,OAAQ,GACRmU,UAAW,IACXD,OAAQ,IACRS,WAAY,EACZC,WAAY,EACZC,eAAgB,EAChBE,aAAc,GAGViD,GAAe1Y,MAAMC,QAAQyT,IAAe/N,SAC9C+N,GAAc/N,QACd,CAAyB,IAAxB,KAAsD,IAAxB,MAE7BA,GAAU,CACd6N,GAAiBkF,GAAa,GAAI,CAAE1E,QAAS,UAAWC,aAAa,EAAMC,UAAW,EAAGlS,OAAQ,IACjGwR,GAAiBkF,GAAa,GAAI,CAAE1E,QAAS,UAAWC,aAAa,EAAMC,UAAW,EAAGlS,QAAS,KAcpG,SAAS2W,GAAqBpT,EAAOqT,GACnC,MAAMC,EAAU7Y,MAAMC,QAAQsF,EAAMI,SAAWJ,EAAMI,QAAU,GACzDmT,EAAkB1U,KAAKmC,IAAI,EAAGsS,EAAQ9gB,QAAU,GAChDghB,EAAiBpT,GAAQqT,OAAQC,GAAiC,YAAvBA,EAAMpD,cACjDqD,EAAgB,IAAIzR,IAAIsR,EAAene,IAAKqe,GAAUA,EAAM/E,WAAa6E,EAAeI,QAAQF,KAEtG,IAAK,IAAIG,EAAO,EAAGA,EAAON,EAAiBM,GAAQ,EACjD,IAAKF,EAAcG,IAAID,GAAO,CAC5B,MAAME,EAAWV,GAAoB,IAATQ,GAAc,IAAM,KAE1CG,EAAW/F,GADuB,iBAAlBqF,EAAQO,GAAqBP,EAAQO,GAAQE,EACzB,CAAEtF,QAAS,UAAWC,aAAa,EAAMC,UAAWkF,EAAMpX,OAAiB,IAAToX,EAAa,GAAK,IAC9HzT,GAAQrM,KAAKigB,GACbR,EAAezf,KAAKigB,GACpBL,EAAcxQ,IAAI0Q,EACpB,CAGF,IAAK,MAAMH,KAASF,EAAgB,CAClC,MAAMK,EAAOH,EAAM/E,WAAa,EAC1BoF,EAAWV,GAAoB,IAATQ,GAAc,IAAM,KAC1C3F,EAAkC,iBAAlBoF,EAAQO,GAAqBP,EAAQO,GAAQE,EAC7DzF,EAAStO,EAAMuO,QAAU9U,EAAWia,EAAMha,OAChDga,EAAM/E,UAAYkF,EAClBH,EAAMpD,aAAe,UACrBoD,EAAMhF,aAAc,EACpBgF,EAAMxF,OAASA,EACfwF,EAAMpF,OAASA,EACfoF,EAAMxZ,EAAIgU,EACVwF,EAAMxX,EAAIoS,EACVoF,EAAMlS,GAAK,EACXkS,EAAMhS,GAAK,EACXgS,EAAMrE,OAASqE,EAAMpE,UACrBoE,EAAMzD,gBAAkB,EACxByD,EAAM5D,WAAa,EACnB4D,EAAM3D,WAAa,EACnB2D,EAAM1D,eAAiB,EACvB0D,EAAMxD,aAAe,EACrBwD,EAAM3E,MAAQ,SACd2E,EAAM1E,WAAa,EAAInQ,KAAK4C,SAC5BiS,EAAMzE,YAAc,CAAErL,IAAKsK,EAAS,IAAKlN,IAAKkN,EAAS,KACvDwF,EAAM5E,UAAW,EACjB4E,EAAMjX,OAAkB,IAAToX,EAAa,GAAK,CACnC,CACF,CA6DA,SAASI,KACP,IAAK,IAAI1hB,EAAI6N,GAAQ5N,OAAS,EAAGD,GAAK,EAAGA,GAAK,EACZ,YAA5B6N,GAAQ7N,GAAG+d,cACblQ,GAAQtM,OAAOvB,EAAG,EAGxB,CAEA,SAAS2hB,KACP,MAAMlU,EAAQwC,KAEd4Q,GAAqBpT,EADLA,EAAMC,QAAQ/F,GAA6B,GAAxB,KAErC,CAxHAkG,GAAQ+T,QAAQ,CAACT,EAAOnf,MAPxB,SAAgCmf,EAAOnf,GACrCmf,EAAM/E,UAAYpa,EAClBmf,EAAMpD,aAAeoD,EAAMpD,cAAgB,UAC3CoD,EAAMhF,YAAcgF,EAAMhF,cAAe,EACzCgF,EAAMjX,OAAmB,IAAVlI,EAAc,GAAK,CACpC,CAGE6f,CAAuBV,EAAOnf,KA0HhC2O,GAAqBZ,KA1ErB,SAA+BA,GAC7B,MAAMtC,EAAQsC,GAAatC,OAAS,CAAC,EAC/BqT,EAAUrT,EAAMC,QAAQ/F,GAA6B,GAAxB,KAC7Bma,EAAatG,GAAekD,GAASQ,aAAe,GAAMpF,UAC1DiI,EAAUtU,EAAMC,QAAQ/D,GAAKzC,EAAW4a,EAE9CpD,GAAS/W,EAAImZ,EACbpC,GAAS/U,EAAIoY,EACbrD,GAASzP,GAAK,EACdyP,GAASvP,GAAK,EACduP,GAASnC,UAAW,EACpBmC,GAASC,YAAc,SACvBD,GAASE,UAAY,KACrBF,GAASG,mBAAqB,KAC9BH,GAASO,UAAY,EACrBP,GAASpE,WAAY,EACrBoE,GAASS,WAAY,EACrBT,GAASU,aAAe,EACxBV,GAASW,cAAgB,KACzBX,GAASY,cAAgB,EACzBZ,GAASc,iBAAkB,EAC3Bd,GAASe,iBAAmB,EAC5Bf,GAASgB,kBAAmB,EAC5BhB,GAASiB,eAAgB,EACzBjB,GAASkB,eAAe3f,OAAS,EACjCye,GAASmB,UAAY,EACrBnB,GAAS5B,OAAS4B,GAAS3B,UAC3B2B,GAASL,qBAAuB,EAChCK,GAASJ,wBAA0B,EACnCI,GAAShB,gBAAkB,EAE3B,MAAMsE,EAAU9Z,MAAMC,QAAQsF,EAAMG,cAAgBH,EAAMG,aAAeA,GACzEuS,GAAWyB,QAAQ,CAACK,EAAMjgB,KACxB,MAAM+K,EAASiV,EAAQhgB,IAAwB,IAAbA,EAAQ,GACpCkgB,EAAQpB,EAAU/T,EAClBoV,EAAQjb,EAAWsU,GAAe,GAAM1B,UAC9CmI,EAAKta,EAAIua,EACTD,EAAKtY,EAAIwY,EACTF,EAAKhT,GAAK,EACVgT,EAAK9S,GAAK,EACV8S,EAAK1F,UAAW,EAChB0F,EAAKzF,MAAQ,SACbyF,EAAK1E,WAAa,EAClB0E,EAAK7Y,UAAY,EACjB6Y,EAAK5D,qBAAuB,EAC5B4D,EAAK3D,wBAA0B,IAGjC3Q,GAAchG,EAAI8F,EAAME,eAAehG,GAA6B,IAAxB,KAC5CgG,GAAchE,EAAI8D,EAAME,eAAehE,GAAKzC,EAAWyG,GAAcxG,OACrEwG,GAAcmP,OAASnP,GAAcoP,UACrCpP,GAAc4P,WAAa,EAC3B5P,GAAc6P,WAAa,EAC3B7P,GAAc8P,eAAiB,EAC/B9P,GAAcgQ,aAAe,EAE7BkD,GAAqBpT,EAAOqT,EAC9B,CAkBEsB,CAAsBrS,KCvWxB,MAAMsS,GAAc,CAClBC,UAAW,IAAI3I,IACf4I,YAAa,GAOf,SAASC,KACP,OAAOH,GAAYC,UAAUD,GAAYE,YAC3C,CAEA,SAASE,GAAuBzgB,GAC9B,QATF,SAAsBA,GACpB,OAAOA,GAAS,GAAKA,EAAQqgB,GAAYC,UAAUriB,MACrD,CAOOyiB,CAAa1gB,KAGlBqgB,GAAYE,YAAcvgB,EAC1B0c,GAASwB,iBAAmBmC,GAAYC,UAAUtgB,IAC3C,EACT,CAEA,SAAS2gB,KACP,OAAON,GAAYC,UAAUhG,OAC/B,CA0BA,SAASsG,GAAmBC,EAAe,IAAI,QAAEC,GAAY,CAAC,GAC5D,MAAMC,EAAW7a,MAAMC,QAAQ0a,GAAgBA,EAAe,GACxDG,EAAS9a,MAAMwY,KAAK,IAAI/Q,IAAIoT,EAAS7B,OAAQ1gB,GAAO,GAAmBA,MACvE8hB,EAAYU,EAAO/iB,OAAS,EAAI+iB,EAAS,IAAIrJ,IACnD0I,GAAYC,UAAYA,EACxB,IAAIW,EAAYH,GAAWR,EAAUY,SAASJ,GAAWA,EAAUpE,GAASwB,iBACvE+C,GAAcX,EAAUY,SAASD,KACpCA,EAAYX,EAAU,IAExB5D,GAASwB,iBAAmB+C,EAC5BZ,GAAYE,YAAcD,EAAUjB,QAAQ4B,GAC5CE,IACF,CAMA,SAASA,KACP,MAAMC,EAAgBf,GAAYC,UAAUjB,QAAQ3C,GAASwB,kBACzDkD,GAAiB,EACnBf,GAAYE,YAAca,GAI5Bf,GAAYC,UAAU,GAAKD,GAAYC,UAAU,IAAM3I,GAAgB,GACvE0I,GAAYE,YAAc,EAC1B7D,GAASwB,iBAAmBmC,GAAYC,UAAU,GACpD,CAEAa,KChFA,MAAME,GAAY,IAAIjD,IAEtB,SAASkD,GAAgBC,GACvB,IAAKA,EACH,OAAO,KAET,MAAMC,EAAM,GAAmBD,GAC/B,IAAKC,EAEH,OADAH,GAAUvS,OAAOyS,GACV,KAGT,MAAME,EAAUD,EAAIzM,KACd2M,EAAYF,EAAI/M,OAEhBkN,OAAsBvgB,IAAZqgB,EACVG,EAAWD,EAAUrX,KAAKmC,IAAI,EAAGgV,EAAQzM,UAAY,GAAKnI,OAAOgV,kBACjE5M,EAAU0M,EAAUrX,KAAKmC,IAAI,EAAGgV,EAAQxM,SAAW,GAAKpI,OAAOgV,kBAC/D3M,EAAgByM,EAAUrX,KAAKmC,IAAI,GAAKgV,EAAQvM,eAAiB,KAAO,EAE9E,IAAI4M,EAAQT,GAAU7c,IAAI+c,GAgC1B,OA/BKO,GAaHA,EAAMF,SAAWA,EACbA,IAAa/U,OAAOgV,kBACtBC,EAAM9M,SAAWnI,OAAOgV,kBAIxBC,EAAM9M,SAHI2M,EAGOrX,KAAK+E,IAAIyS,EAAM9M,SAAU4M,GAFzBA,EAInBE,EAAM7M,QAAUA,EAChB6M,EAAM5M,cAAgBA,EACtB4M,EAAMJ,UAAYA,GAAa,MAC1BI,EAAMrN,QAAUiN,IACnBI,EAAMrN,OAAS,CAAEsN,QAASL,EAAUjjB,MAAQ,IAEzCijB,IACHI,EAAMrN,OAAS,QA3BjBqN,EAAQ,CACNF,WACA5M,SAAU4M,IAAa/U,OAAOgV,kBAAoBhV,OAAOgV,kBAAoBD,EAC7E3M,UACAC,gBACA8M,YAAa,EACbhE,WAAW,EACX0D,UAAWA,GAAa,KACxBjN,OAAQiN,EAAY,CAAEK,QAASL,EAAUjjB,MAAQ,GAAM,MAEzD4iB,GAAU9C,IAAIgD,EAAUO,IAoBnBA,CACT,CAEA,SAASG,GAAcV,GACrB,MAAMO,EAAQR,GAAgBC,GAC9B,OAAKO,EAGE,CACL9M,SAAU8M,EAAM9M,SAChBC,QAAS6M,EAAM7M,QACf2M,SAAUE,EAAMF,SAChB5D,UAAW8D,EAAM9D,UACjBgE,YAAaF,EAAME,YACnB9M,cAAe4M,EAAM5M,eARd,IAUX,CAoBA,SAASgN,GAAYX,GACnB,MAAMO,EAAQR,GAAgBC,GAC9B,SAAKO,GAGDA,EAAMF,WAAa/U,OAAOgV,mBAG1BC,EAAM9D,WAGN8D,EAAM9M,UAAY8M,EAAMF,UAGxBE,EAAM7M,SAAW,IAGrB6M,EAAM9D,WAAY,EAClB8D,EAAME,YAAcF,EAAM5M,cACtBwH,GAASwB,mBAAqBqD,IAChC7E,GAASsB,WAAY,GAEhB,GACT,CAyFA,SAASmE,GAAiBZ,GACxB,MAAMO,EAAQR,GAAgBC,GACzBO,GAASA,EAAMF,WAAa/U,OAAOgV,oBAGxCC,EAAM9M,SAAW8M,EAAMF,SACvBE,EAAM7M,QAAU,GAAmBsM,IAAWxM,MAAME,SAAW6M,EAAM7M,QACrE6M,EAAM9D,WAAY,EAClB8D,EAAME,YAAc,EACtB,CACA,SAASI,GAAsBb,GAC7B,MAAMO,EAAQR,GAAgBC,GACzBO,IAGLA,EAAMF,SAAW/U,OAAOgV,kBACxBC,EAAM9M,SAAWnI,OAAOgV,kBACxBC,EAAM7M,QAAUpI,OAAOgV,kBACvBC,EAAM9D,WAAY,EAClB8D,EAAME,YAAc,EAChBtF,GAASwB,mBAAqBqD,IAChC7E,GAASsB,WAAY,GAEzB,CAUA,SAASqE,KACPhB,GAAUiB,QACN5F,GAASwB,kBACXoD,GAAgB5E,GAASwB,iBAE7B,CC5OA,IAAI,IAAsB,EAE1B,MAAMqE,GAAsB,CAC1B/jB,GAAIke,GAASwB,kBASf,SAASsE,KACP,MAAMjB,EAAWf,KACjB,OALO,GAKwBe,IAAa,IAC9C,CAEA,SAASkB,GAAiBziB,GACxB,MAAM0iB,EAAahG,GAASwB,iBAC5B,IAAKuC,GAAuBzgB,GAC1B,OAAO,EAEL0iB,GAAcA,IAAehG,GAASwB,kBDyF5C,SAAsBqD,GACpB,MAAMO,EAAQT,GAAU7c,IAAI+c,GACvBO,IAGLA,EAAM9D,WAAY,EAClB8D,EAAME,YAAc,EAChBtF,GAASwB,mBAAqBqD,IAChC7E,GAASsB,WAAY,GAEzB,CClGI2E,CAAaD,GAGfpB,GAAgB5E,GAASwB,kBAEzBxB,GAASS,WAAY,EACrBT,GAASW,cAAgB,KACzBX,GAASY,cAAgB,EACzBZ,GAASc,iBAAkB,EAC3Bd,GAASe,iBAAmB,EAC5Bf,GAASU,aAAe,EACxBV,GAASiB,eAAgB,EAEzB,MAAMiF,EAAaX,GAAcvF,GAASwB,kBAK1C,OAJAxB,GAASsB,UAAY4E,GAAY5E,YAAa,EAC9CtB,GAASR,aAAe,EAExBqG,GAAoB/jB,GAAKke,GAASwB,kBAC3B,CACT,CApCAuE,GAAiBpC,GAAYE,aCX7B,MAAMsC,GAAgB,CACpB,CACErkB,GAAI,eACJia,MAAO,UACPqK,kBAAmB,CAAC,cAAe,aACnCC,gBAAiB,eAEnB,CACEvkB,GAAI,iBACJia,MAAO,WACPqK,kBAAmB,CAAC,cAAe,aACnCC,gBAAiB,cAEnB,CACEvkB,GAAI,gBACJia,MAAO,SACPqK,kBAAmB,CAAC,eAAgB,aAAc,gBAClDC,gBAAiB,iBAEnB,CACEvkB,GAAI,iBACJia,MAAO,cACPqK,kBAAmB,CAAC,aACpBC,gBAAiB,eAEnB,CACEvkB,GAAI,gBACJia,MAAO,eACPqK,kBAAmB,CAAC,aACpBC,gBAAiB,aAEnB,CACEvkB,GAAI,iBACJia,MAAO,gBACPqK,kBAAmB,CAAC,aACpBC,gBAAiB,iBAEnB,CACEvkB,GAAI,cACJia,MAAO,WACPqK,kBAAmB,CAAC,UACpBC,gBAAiB,eAEnB,CACEvkB,GAAI,aACJia,MAAO,YACPqK,kBAAmB,CAAC,UACpBC,gBAAiB,cAEnB,CACEvkB,GAAI,cACJia,MAAO,aACPqK,kBAAmB,CAAC,UACpBC,gBAAiB,iBAIfC,GAAsB,8BCpD5B,SAASC,GAAyBC,GAChC,MAAMC,EAAajd,MAAMC,QAAQ+c,GAAMJ,mBAAqBI,EAAKJ,kBAAoB,GACrF,OAA0B,IAAtBK,EAAWllB,OACN,GAEFoG,OAAOsa,OAAO,IAClBO,OAAQkE,GAAWD,EAAWjC,SAASkC,EAAO1P,WAC9C2P,KAAK,CAACpf,EAAGqf,IAAMrf,EAAE0G,KAAK4Y,cAAcD,EAAE3Y,OACtC7J,IAAKsiB,GAAWA,EAAO5kB,GAC5B,CAEA,SAASglB,GAAqBN,EAAMljB,GAClC,MAAMyjB,EAAUR,GAAyBC,GACzC,GAAuB,IAAnBO,EAAQxlB,OACV,OAAO,KAET,MAAMylB,EAAY,CAChB/L,GAAgB3X,GAChBkjB,EAAKH,iBAEP,IAAK,MAAMY,KAAaD,EACtB,GAAIC,GAAaF,EAAQvC,SAASyC,GAChC,OAAOA,EAGX,OAAOF,EAAQ,EACjB,CAEA,SAASG,KACP,OAAOf,GAAc/hB,IAAI,CAACoiB,EAAMljB,KAAU,CACxC6jB,OAAQX,EAAK1kB,GACb+iB,SAAUiC,GAAqBN,EAAMljB,KAEzC,CAEA,IAAI8jB,GAAcF,KAMlB,SAASG,GAAmBF,GAC1B,OAAOC,GAAYE,UAAWlC,GAAUA,EAAM+B,SAAWA,EAC3D,CAEA,SAASI,KACP,MAAMC,EAAO,IAAIvW,IACjB,IAAK,IAAI3N,EAAQ,EAAGA,EAAQ8jB,GAAY7lB,OAAQ+B,GAAS,EAAG,CAC1D,MAAMkjB,EAAOL,GAAc7iB,GAC3B,IAAKkjB,EACH,SAEF,MAAMO,EAAUR,GAAyBC,GACnCpB,EAAQgC,GAAY9jB,GAC1B,IAAIuhB,EAAWO,EAAMP,SAChBA,GAAakC,EAAQvC,SAASK,KAAa2C,EAAK3E,IAAIgC,KACvDA,EAAWkC,EAAQU,KAAM3lB,IAAQ0lB,EAAK3E,IAAI/gB,KAAQilB,EAAQ,IAAM,MAElE3B,EAAMP,SAAWA,GAAY,KACzBA,GACF2C,EAAKtV,IAAI2S,EAEb,CACF,CA+EA,SAAS6C,IAAa,iBAAEC,GAAmB,GAAS,CAAC,GACnDJ,KACA,MAAMK,EA7DCR,GACJhjB,IAAKghB,GAAUA,EAAMP,UACrBrC,OAAQqC,GAAiC,iBAAbA,GAAyBA,EAAStjB,OAAS,GA4DpEqiB,EAAYgE,EAAWrmB,OAAS,EAAIqmB,EAAa3M,GAAgB2C,QAIvE,OAFAsG,GAAmBN,EAAW,CAAEQ,QADhBuD,EAAmB7D,KAAuBF,EAAU,KAEpE+B,KACO/B,CACT,CAEA,SAASiE,KACP,GAA4B,oBAAjBC,aACT,OAAO,EAET,IACE,MAAMC,EAAUX,GAAYhjB,IAAKghB,IAAU,IAAMA,KAEjD,OADA0C,aAAaE,QAAQ1B,GAAqBnhB,KAAKC,UAAU2iB,KAClD,CACT,CAAE,MAAOrW,GAEP,OADAC,QAAQsW,KAAK,yBAA0BvW,IAChC,CACT,CACF,CAyCA,SAASwW,KACP,OAAO/B,GAAc/hB,IAAI,CAACoiB,EAAMljB,KAC9B,MAAM6kB,EAAaf,GAAY9jB,GACzBuhB,EAAWsD,GAAYtD,UAAY,KACnC6B,EAAS7B,EAAW,GAAmBA,IAAa,KAAO,KACjE,MAAO,CACLvhB,QACA6jB,OAAQX,EAAK1kB,GACbia,MAAOyK,EAAKzK,MACZqK,kBAAmB5c,MAAMC,QAAQ+c,EAAKJ,mBAAqBI,EAAKJ,kBAAkBxI,QAAU,GAC5FwK,iBAAkB7B,GAAyBC,GAC3C3B,WACA6B,WAGN,CCvNA,MAEM2B,GAAU,CACdC,SAAS,EACTC,UAAW,EACXC,YAAa,EACbC,QAAS,KACTC,aAAc,GAGhB,IAAI,IAAc,EAgBlB,SAASC,GAAgBC,GACvB,MAAMC,EAAgBrf,MAAMC,QAAQmf,GAASA,EAAQV,MAfvD,SAAwBY,GACtB,GAAIA,GAAS,EAGX,OAFAT,GAAQE,UAAY,OACpBF,GAAQG,YAAc,GAGpBH,GAAQE,WAAaO,IACvBT,GAAQE,UAAYO,EAAQ,GAE1BT,GAAQE,UAAY,IACtBF,GAAQE,UAAY,EAExB,CAIEQ,CAAeF,EAActnB,QAC7B,MAAMynB,EAAaH,EAAcR,GAAQE,WACzC,IAAKS,EAEH,OADAX,GAAQG,YAAc,EACfK,EAET,MAAM9B,EAAUiC,EAAWZ,iBAC3B,IAAK5e,MAAMC,QAAQsd,IAA+B,IAAnBA,EAAQxlB,OAErC,OADA8mB,GAAQG,YAAc,EACfK,EAET,MAAMI,EAAelC,EAAQpE,QAAQqG,EAAWnE,UAEhD,OADAwD,GAAQG,YAAcS,GAAgB,EAAIA,EAAe,EAClDJ,CACT,CAEA,SAASK,GAAWT,GAClBJ,GAAQI,QAAUA,GAAW,KAC7BJ,GAAQK,aAAeD,EA9CA,IA8C6B,CACtD,CA2BA,SAASU,GAASC,GAChB,MAAMR,EAAQV,KACO,IAAjBU,EAAMrnB,SAGV8mB,GAAQE,WAAaF,GAAQE,UAAYa,EAAQR,EAAMrnB,QAAUqnB,EAAMrnB,OACvEonB,GAAgBC,GAClB,CAEA,SAASS,GAAYD,GACnB,MACMJ,EADQd,KACWG,GAAQE,WACjC,IAAKS,EACH,OAEF,MAAM3nB,EDiBR,SAAyB8lB,EAAQzZ,EAAY,GAC3C,MAAM6a,EAAYlB,GAAmBF,GACrC,IAAmB,IAAfoB,EACF,OAAO,KAET,MACMxB,EAAUR,GADHJ,GAAcoC,IAE3B,GAAuB,IAAnBxB,EAAQxlB,OACV,OAAO,KAET,MAAM8jB,EAAU+B,GAAYmB,GAAW1D,SACvC,IAAIoE,EAAelC,EAAQpE,QAAQ0C,IACb,IAAlB4D,IACFA,EAAe,GAEjB,MAEMK,EAxCR,SAAuBnC,EAAQtC,GAC7B,MAAM0D,EAAYlB,GAAmBF,GACrC,IAAmB,IAAfoB,EACF,OAAO,EAIT,IADgBhC,GADHJ,GAAcoC,IAEd/D,SAASK,GACpB,OAAO,EAET,MAAMQ,EAAU+B,GAAYmB,GAAW1D,SACvC,GAAIQ,IAAYR,EACd,OAAO,EAET,MAAM0E,EAAgBnC,GAAYE,UAAU,CAAClC,EAAO9hB,IAAUA,IAAUilB,GAAanD,EAAMP,WAAaA,GAMxG,OALI0E,GAAiB,IACnBnC,GAAYmC,GAAe1E,SAAWQ,GAExC+B,GAAYmB,GAAW1D,SAAWA,EAClC0C,MACO,CACT,CAmBkBiC,CAAcrC,EADfJ,GADIkC,EAAevb,EAAYqZ,EAAQxlB,QAAUwlB,EAAQxlB,SAGxE,MAAO,CACLgnB,YACA1D,SAAUuC,GAAYmB,GAAW1D,SACjCyE,UAEJ,CCxCiBG,CAAgBT,EAAW7B,OAAQiC,GAClD,IAAK/nB,IAA6B,IAAnBA,EAAOioB,QAEpB,YADAX,KAGF,MACMe,EADef,KACYN,GAAQE,WACnCoB,EAAaD,GAAahD,QAAQzY,MAAQ,UA/ClD,IAAyBwa,IAgDP,GAAGiB,GAAa3N,OAAS,YAAY4N,IA/CrDjC,GAAa,CAAEC,kBAAkB,IACjCE,KACAqB,GAAWT,EA8Cb,CAEA,SAASmB,KDgCPxC,GAAcF,KACdK,KApGOH,GAAYhjB,IAAKghB,IAAU,IAAMA,KCqExCsC,GAAa,CAAEC,kBAAkB,IACjCE,KACA,MAAMe,EAAQD,KACRkB,EAAcjB,EAAM,IAAIlC,QAAQzY,KACtCib,GAAWW,EAAc,sBAAsBA,cAA0B,oBAC3E,CAoDA,SAASC,GAAmBjU,GACrBwS,GAAQC,UAGbzS,EAAMe,iBACNf,EAAMkU,kBACR,CC/KA,MAAM,GAAsB,CAC1B,CACEjoB,GAAI,SACJia,MAAO,SACPhF,YAAa,yCACbrV,QAAS,CACP,CACEI,GAAI,cACJmM,KAAM,YACN8I,YAAa,yCACbjR,MAAO,CAAEoF,KAAM,SAEjB,CACEpJ,GAAI,gBACJmM,KAAM,eACN8I,YAAa,4CACbjR,MAAO,CACLoF,KAAM,QACN8e,WAAY,UACZ3d,YAAa,UACb4d,WAAY,UACZC,WAAY,KAGhB,CACEpoB,GAAI,kBACJmM,KAAM,gBACN8I,YAAa,gDACbjR,MAAO,CACLoF,KAAM,SACN8e,WAAY,UACZ3d,YAAa,UACb8d,UAAW,cAKnB,CACEroB,GAAI,QACJia,MAAO,QACPhF,YAAa,sCACbrV,QAAS,CACP,CACEI,GAAI,aACJmM,KAAM,gBACN8I,YAAa,uCACbjR,MAAO,CACLoF,KAAM,UACNkf,WAAY,UACZ/d,YAAa,YAGjB,CACEvK,GAAI,eACJmM,KAAM,iBACN8I,YAAa,2CACbjR,MAAO,CACLoF,KAAM,UACNmf,WAAY,UACZF,UAAW,UACXvd,UAAW,YAGf,CACE9K,GAAI,cACJmM,KAAM,gBACN8I,YAAa,wCACbjR,MAAO,CACLoF,KAAM,UACNkf,WAAY,UACZE,WAAY,UACZje,YAAa,cAKrB,CACEvK,GAAI,UACJia,MAAO,UACPhF,YAAa,sCACbrV,QAAS,CACP,CACEI,GAAI,eACJmM,KAAM,aACN8I,YAAa,2BACbjR,MAAO,CAAEoF,KAAM,SAEjB,CACEpJ,GAAI,iBACJmM,KAAM,mBACN8I,YAAa,iDACbjR,MAAO,CACLoF,KAAM,OACNkB,UAAW,UACXme,aAAc,UACdC,aAAc,MAGlB,CACE1oB,GAAI,kBACJmM,KAAM,eACN8I,YAAa,sCACbjR,MAAO,CACLoF,KAAM,WACNkB,UAAW,UACXqe,WAAY,UACZF,aAAc,UACdC,aAAc,QAOlBE,GAAiB,GAAoBC,OAAO,CAACvmB,EAAK4S,KACtDA,EAAStV,QAAQwhB,QAAS0H,IACxBxmB,EAAIwmB,EAAO9oB,IAAM,IAAK8oB,EAAQ5T,SAAUA,EAASlV,MAE5CsC,GACN,CAAC,GAEEymB,GAAoB,CACxBC,OAAQ,gBACRC,MAAO,eACPC,QAAS,gBAGLC,GAAuB,gCC7HvBC,GAAgB,CACpBC,WAAY,IAAKN,KAOnB,SAASO,GAAsBC,GAC7B,MAAMrU,EAAW,GAAoByQ,KAAMrC,GAAUA,EAAMtjB,KAAOupB,GAClE,OAAO7hB,MAAMC,QAAQuN,GAAUtV,SAAWsV,EAAStV,QAAQ0C,IAAKwmB,GAAWA,EAAO9oB,IAAM,EAC1F,CAEA,SAASwpB,GAAmBD,EAAYE,GACtC,MAAM7pB,EAAU0pB,GAAsBC,GACtC,GAAuB,IAAnB3pB,EAAQH,OACV,OAAO,KAET,GAAIgqB,GAAY7pB,EAAQ8iB,SAAS+G,GAC/B,OAAOA,EAET,MAAMzI,EAAW+H,GAAkBQ,GACnC,OAAIvI,GAAYphB,EAAQ8iB,SAAS1B,GACxBA,EAEFphB,EAAQ,EACjB,CAEA,SAAS8pB,KACP,MAAMC,EAAO,CAAC,EACd,GAAoBvI,QAASlM,IAC3ByU,EAAKzU,EAASlV,IAAMwpB,GAAmBtU,EAASlV,GAAIopB,GAAcC,WAAWnU,EAASlV,OAExFopB,GAAcC,WAAaM,CAC7B,CAoCA,SAASC,KACP,MAlEO,IAAKR,GAAcC,WAmE5B,CAEA,SAASQ,GAAkBJ,GACzB,OAAOb,GAAea,IAAa,IACrC,CAqBA,SAAS,KACP,GAA4B,oBAAjBzD,aACT,OAAO,EAET,IAEE,OADAA,aAAaE,QAAQiD,GAAsB9lB,KAAKC,UAAU8lB,GAAcC,cACjE,CACT,CAAE,MAAOzZ,GAEP,OADAC,QAAQsW,KAAK,2BAA4BvW,IAClC,CACT,CACF,CA2CA8Z,KC7IA,MAEM,GAAU,CACdlD,SAAS,EACTsD,cAAe,EACfpD,YAAa,EACbC,QAAS,KACTC,aAAc,GAGhB,IAAI,IAAc,EAElB,SAASmD,KACP,ODqHO,GAAoBznB,IAAK4S,IAAa,CAC3ClV,GAAIkV,EAASlV,GACbia,MAAO/E,EAAS+E,MAChBhF,YAAaC,EAASD,YACtBrV,QAASsV,EAAStV,QAAQ0C,IAAKwmB,IAAW,IACrCA,EACH5T,SAAUA,EAASlV,QC1HzB,CAgBA,SAAS,GAAgB2kB,GACvB,MAAMqF,EAAqBtiB,MAAMC,QAAQgd,GAAcA,EAAaoF,MAftE,SAA4B/C,GAC1B,GAAIA,GAAS,EAGX,OAFA,GAAQ8C,cAAgB,OACxB,GAAQpD,YAAc,GAGpB,GAAQoD,eAAiB9C,IAC3B,GAAQ8C,cAAgB9C,EAAQ,GAE9B,GAAQ8C,cAAgB,IAC1B,GAAQA,cAAgB,EAE5B,CAIEG,CAAmBD,EAAmBvqB,QACtC,MAAMyqB,EAAiBF,EAAmB,GAAQF,eAC5CT,EAAaO,KACnB,IAAKM,EAEH,OADA,GAAQxD,YAAc,EACf,CAAE/B,WAAYqF,EAAoBX,cAE3C,MAAMzpB,EAAU8H,MAAMC,QAAQuiB,EAAetqB,SAAWsqB,EAAetqB,QAAU,GACjF,GAAuB,IAAnBA,EAAQH,OAEV,OADA,GAAQinB,YAAc,EACf,CAAE/B,WAAYqF,EAAoBX,cAE3C,MAAMc,EAAad,EAAWa,EAAelqB,IACvCmnB,EAAevnB,EAAQ4lB,UAAWsD,GAAWA,EAAO9oB,KAAOmqB,GAEjE,OADA,GAAQzD,YAAcS,GAAgB,EAAIA,EAAe,EAClD,CAAExC,WAAYqF,EAAoBX,aAC3C,CAEA,SAAS,GAAW1C,GAClB,GAAQA,QAAUA,GAAW,KAC7B,GAAQC,aAAeD,EApDA,IAoD6B,CACtD,CAgCA,SAASyD,GAAa9C,GACpB,MAAM3C,EAAaoF,KACO,IAAtBpF,EAAWllB,SAGf,GAAQqqB,eAAiB,GAAQA,cAAgBxC,EAAQ3C,EAAWllB,QAAUklB,EAAWllB,OACzF,GAAgBklB,GAChB,GAAW,MACb,CAEA,SAAS,GAAY2C,GACnB,MAAM3C,EAAaoF,KACbG,EAAiBvF,EAAW,GAAQmF,eAC1C,IAAKI,EACH,OAEF,MAAM3qB,EDzDR,SAAgCgqB,EAAY3d,EAAY,GACtD,MAAMhM,EAAU0pB,GAAsBC,GACtC,GAAuB,IAAnB3pB,EAAQH,OACV,OAAO,KAET,MAAM8jB,EAAU6F,GAAcC,WAAWE,IAAe3pB,EAAQ,GAC1D4B,EAAQ5B,EAAQihB,QAAQ0C,GAExBkG,EAAW7pB,GADE4B,EAAQoK,EAAYhM,EAAQH,QAAUG,EAAQH,QAE3D+nB,EA3BR,SAA8B+B,EAAYE,GACxC,IAAKF,EACH,OAAO,EAET,MAAMc,EAAab,GAAmBD,EAAYE,GAClD,QAAKY,GAGDjB,GAAcC,WAAWE,KAAgBc,IAG7CjB,GAAcC,WAAa,IACtBD,GAAcC,WACjB,CAACE,GAAac,IAET,EACT,CAWkB,CAAqBd,EAAYE,GACjD,MAAO,CACLA,WACAjC,UAEJ,CC2CiB8C,CAAuBJ,EAAelqB,GAAIsnB,GACzD,IAAK/nB,EACH,OAEF,GAAgBolB,GAChB,MAAMmE,EAASe,GAAkBtqB,EAAOkqB,UACpClqB,EAAOioB,SAAWsB,GACpB,GAAW,GAAGoB,EAAejQ,UAAU6O,EAAO3c,QAEhD,IACF,CA0DA,SAAS,GAAmB4H,GACrB,GAAQyS,UAGbzS,EAAMe,iBACNf,EAAMkU,kBACR,CCzLA,MAAMsC,GAAuB,gCAEvBC,GAAoB,CACxB,CACExqB,GAAI,iBACJmM,KAAM,iBACN+D,cAAezC,KAAuB,IAAM5H,OAAOoJ,KAAKhD,GAAyB,GACjFgJ,YAAa,gDACbwV,kBAAmB,KACnBC,WAAY,EACZC,iBAAkB,IAClBC,gBAAiB,IACjBC,iBAAkB,CAAC,IAAM,MAE3B,CACE7qB,GAAI,uBACJmM,KAAM,uBACN+D,cAAezC,KAAuB,IAAM5H,OAAOoJ,KAAKhD,GAAyB,GACjFgJ,YAAa,gDACbwV,kBAAmB,KACnBC,WAAY,EACZC,iBAAkB,IAClBC,gBAAiB,IACjBC,iBAAkB,CAAC,IAAM,MAE3B,CACE7qB,GAAI,kBACJmM,KAAM,kBACN+D,cAAezC,KAAuB,IAAM5H,OAAOoJ,KAAKhD,GAAyB,GACjFgJ,YAAa,0DACbwV,kBAAmB,KACnBC,WAAY,GACZC,iBAAkB,GAClBC,gBAAiB,IACjBC,iBAAkB,CAAC,GAAK,OAI5B,SAASC,GAAcC,GACrB,OAAO1nB,KAAK2nB,MAAM3nB,KAAKC,UAAUynB,GACnC,CAEA,MAAME,GAAe,CACnBC,UAAWV,GAAkBloB,IAAIwoB,KAGnC,SAASK,GAAsBjb,GAC7B,OAAIA,GAAiBjE,EAAwBiE,GACpCA,EAEFzC,KAAuB,IAAM5H,OAAOoJ,KAAKhD,GAAyB,EAC3E,CAEA,SAASmf,GAAepkB,EAAOga,EAAW,IACxC,OAAK3S,OAAOC,SAAStH,GAGd8E,KAAK+E,IAAI,IAAM/E,KAAKmC,IAAI,IAAMjH,IAF5Bga,CAGX,CAyCA,SAASqK,KACP,GAA4B,oBAAjBrF,aACT,OAAO,EAET,IAEE,OADAA,aAAaE,QAAQqE,GAAsBlnB,KAAKC,UAAU2nB,GAAaC,aAChE,CACT,CAAE,MAAOtb,GAEP,OADAC,QAAQsW,KAAK,2BAA4BvW,IAClC,CACT,CACF,CAEA,SAAS0b,KACP,OAAOL,GAAaC,UAAU5oB,IAAIwoB,GACpC,CAWA,SAASS,GAAoB/pB,GAC3B,MAAM0pB,EAAYD,GAAaC,UAC/B,OAAyB,IAArBA,EAAUzrB,OACL,GAEA+B,EAAQ0pB,EAAUzrB,OAAUyrB,EAAUzrB,QAAUyrB,EAAUzrB,MACrE,CAEA,SAAS+rB,GAAiBhqB,EAAOiqB,EAAOzkB,GACtC,MAAMyf,EAAY8E,GAAoB/pB,GAChC+hB,EAAU0H,GAAaC,UAAUzE,GACvC,IAAKlD,EACH,OAAOA,EAET,MAAMoG,EAAO,IAAKpG,GAClB,OAAQkI,GACN,IAAK,OACH9B,EAAKxd,KAAwB,iBAAVnF,GAAsBA,EAAM0kB,OAAOjsB,OAAS,EAAIuH,EAAM0kB,OAASnI,EAAQpX,KAC1F,MACF,IAAK,cACHwd,EAAK1U,YAA+B,iBAAVjO,EAAqBA,EAAM0kB,OAASnI,EAAQtO,YACtE,MACF,IAAK,gBACH0U,EAAKzZ,cAAgBib,GAAsBnkB,IAAUuc,EAAQrT,cAC7D,MACF,IAAK,oBACHyZ,EAAKc,kBAAoB3e,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMF,OAAOrH,IAAU,IACjE,MACF,IAAK,aACH2iB,EAAKe,WAAa5e,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMF,OAAOrH,IAAU,IAC1D,MACF,IAAK,mBACH2iB,EAAKgB,iBAAmBS,GAAe/c,OAAOrH,GAAQuc,EAAQoH,kBAC9D,MACF,IAAK,kBACHhB,EAAKiB,gBAAkBQ,GAAe/c,OAAOrH,GAAQuc,EAAQqH,iBAC7D,MACF,IAAK,mBACCljB,MAAMC,QAAQX,IAAUA,EAAMvH,QAAU,IAC1CkqB,EAAKkB,iBAAmB,CAACO,GAAepkB,EAAM,GAAIuc,EAAQsH,iBAAiB,IAAKO,GAAepkB,EAAM,GAAIuc,EAAQsH,iBAAiB,MAQxI,OAFAI,GAAaC,UAAUzE,GAAakD,EACpC0B,KACO1B,CACT,CAEA,SAASgC,GAAqBnqB,EAAOiqB,EAAOnE,EAAOsE,EAAO,GACxD,MAAMnF,EAAY8E,GAAoB/pB,GAChC+hB,EAAU0H,GAAaC,UAAUzE,GACvC,IAAKlD,EACH,OAAOA,EAET,OAAQkI,GACN,IAAK,oBACH,OAAOD,GAAiB/E,EAAWgF,EAAOlI,EAAQkH,kBAAoBnD,EAAQsE,GAChF,IAAK,aACH,OAAOJ,GAAiB/E,EAAWgF,EAAOlI,EAAQmH,WAAapD,EAAQsE,GACzE,IAAK,mBACH,OAAOJ,GAAiB/E,EAAWgF,EAAOlI,EAAQoH,iBAAmBrD,EAAQsE,GAC/E,IAAK,kBACH,OAAOJ,GAAiB/E,EAAWgF,EAAOlI,EAAQqH,gBAAkBtD,EAAQsE,GAC9E,IAAK,iBACH,OAAOJ,GAAiB/E,EAAW,mBAAoB,CAAClD,EAAQsH,iBAAiB,GAAKvD,EAAQsE,EAAMrI,EAAQsH,iBAAiB,KAC/H,IAAK,kBACH,OAAOW,GAAiB/E,EAAW,mBAAoB,CAAClD,EAAQsH,iBAAiB,GAAItH,EAAQsH,iBAAiB,GAAKvD,EAAQsE,IAC7H,QACE,OAAOrI,EAEb,EAxHA,WACE,GAA4B,oBAAjByC,aACT,OAAOiF,GAAaC,UAEtB,IACE,MAAMW,EAAM7F,aAAa8F,QAAQvB,IACjC,IAAKsB,EACH,OAAOZ,GAAaC,UAEtB,MAAMa,EAAS1oB,KAAK2nB,MAAMa,GAC1B,IAAKnkB,MAAMC,QAAQokB,GACjB,OAAOd,GAAaC,UAEtB,MAAMvB,EAAOoC,EAAOzpB,IAAI,CAACghB,EAAO9hB,IA9BpC,SAA2B+B,EAAMyd,EAAWwJ,GAAkB,IAC5D,MAAMvqB,EAAOsD,GAAwB,iBAATA,EAAoBA,EAAOyd,EACvD,MAAO,CACLhhB,GAAuB,iBAAZC,EAAKD,GAAkBC,EAAKD,GAAKghB,EAAShhB,GACrDmM,KAA2B,iBAAdlM,EAAKkM,KAAoBlM,EAAKkM,KAAO6U,EAAS7U,KAC3D+D,cAAeib,GAAsBlrB,EAAKiQ,eAAiB8Q,EAAS9Q,eACpE+E,YAAyC,iBAArBhV,EAAKgV,YAA2BhV,EAAKgV,YAAc+L,EAAS/L,YAChFwV,kBAAmBpc,OAAOC,SAASrO,EAAKwqB,mBAAqB3e,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMtO,EAAKwqB,oBAAsBzJ,EAASyJ,kBACxHC,WAAYrc,OAAOC,SAASrO,EAAKyqB,YAAc5e,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMtO,EAAKyqB,aAAe1J,EAAS0J,WACnGC,iBAAkBS,GAAenrB,EAAK0qB,iBAAkB3J,EAAS2J,kBACjEC,gBAAiBQ,GAAenrB,EAAK2qB,gBAAiB5J,EAAS4J,iBAC/DC,iBAAkBnjB,MAAMC,QAAQ1H,EAAK4qB,mBAAqB5qB,EAAK4qB,iBAAiBprB,QAAU,EACtF,CAAC2rB,GAAenrB,EAAK4qB,iBAAiB,GAAI7J,EAAS6J,iBAAiB,IAAKO,GAAenrB,EAAK4qB,iBAAiB,GAAI7J,EAAS6J,iBAAiB,KAC5I7J,EAAS6J,iBAAiB/O,QAElC,CAe8CkQ,CAAkB1I,EAAOkH,GAAkBhpB,EAAQgpB,GAAkB/qB,UAC/GwrB,GAAaC,UAAYvB,CAC3B,CAAE,MAAO/Z,GACPC,QAAQsW,KAAK,2BAA4BvW,GACzCqb,GAAaC,UAAYV,GAAkBloB,IAAIwoB,GACjD,CACOG,GAAaC,SACtB,CA6HAe,GC7NA,MAEMC,GAAS,CACb,CAAElsB,GAAI,eAAgBia,MAAO,iBAC7B,CAAEja,GAAI,OAAQia,MAAO,gBAAiBkS,UAAU,GAChD,CAAEnsB,GAAI,gBAAiBia,MAAO,eAC9B,CAAEja,GAAI,oBAAqBia,MAAO,qBAAsB2R,KAAM,KAC9D,CAAE5rB,GAAI,aAAcia,MAAO,cAAe2R,KAAM,GAChD,CAAE5rB,GAAI,mBAAoBia,MAAO,iBAAkB2R,KAAM,KACzD,CAAE5rB,GAAI,kBAAmBia,MAAO,gBAAiB2R,KAAM,KACvD,CAAE5rB,GAAI,iBAAkBia,MAAO,eAAgB2R,KAAM,KACrD,CAAE5rB,GAAI,kBAAmBia,MAAO,gBAAiB2R,KAAM,KACvD,CAAE5rB,GAAI,cAAeia,MAAO,gBAAiBkS,UAAU,IAGnD,GAAU,CACd3F,SAAS,EACT4F,WAAY,EACZ3F,UAAW,EACXE,QAAS,KACTC,aAAc,GAGVyF,GAAe,CACnBC,mBAAoB,KACpBC,kBAAmB,KACnBC,cAAe,MAGjB,IAAI,IAAc,EAElB,SAAS,GAAW7F,GAClB,GAAQA,QAAUA,GAAW,KAC7B,GAAQC,aAAeD,EAjCA,IAiC6B,CACtD,CAUA,SAAS,KACF,GAAQH,UAGb,GAAQA,SAAU,EACpB,CAEA,SAASiG,GAAoBvc,GAC3B,MAAM8S,EAAM9S,EAAgBjE,EAAwBiE,GAAiB,KACrE,OAAO8S,GAAK7W,MAAQ+D,GAAiB,SACvC,CAWA,SAASwc,GAAWpF,IATpB,SAAyB9lB,GACvB,MAAMwlB,EAAQkF,GAAOzsB,OAKrB,GAAQ2sB,WAJM,IAAVpF,GAImBxlB,EAAQwlB,EAASA,GAASA,EAH1B,CAIzB,CAGE2F,CAAgB,GAAQP,WAAa9E,GACrC,GAAW,KACb,CAmCA,SAASsF,GAAYhhB,GACnB,MAAM6f,EAAQS,GAAO,GAAQE,YAC7B,IAAKX,EACH,OAIF,IAFkBH,KACS,GAAQ7E,WAEjC,OAEF,MAAMmF,EAAOH,EAAMG,MAAQ,EAC3B,OAAQH,EAAMzrB,IACZ,IAAK,gBA7CT,SAAmBsnB,GACjB,MAAM4D,EAAYI,KAClB,GAAyB,IAArBJ,EAAUzrB,OACZ,OAEF,MAAMotB,IAAc,GAAQpG,UAAYa,GAAS4D,EAAUzrB,OAASyrB,EAAUzrB,QAAUyrB,EAAUzrB,OAC9F,GAAQgnB,YAAcoG,IACxB,GAAQpG,UAAYoG,EACpB,GAAW,YAAYA,EAAY,MAAM3B,EAAU2B,GAAW1gB,QAElE,CAoCM2gB,CAAUlhB,GACV,MACF,IAAK,gBAAiB,CACpB,MAAM+d,ED+EZ,SAAkCnoB,EAAOoK,EAAY,GACnD,MAAM6a,EAAY8E,GAAoB/pB,GAChC+hB,EAAU0H,GAAaC,UAAUzE,GACvC,IAAKlD,EACH,OAAOA,EAET,MAAMwJ,EAAWrlB,MAAMC,QAAQ8F,KAAyBA,GAAqBhO,OAAS,EAClFgO,GACA5H,OAAOoJ,KAAKhD,GACVkb,EAAe4F,EAASlM,QAAQ0C,EAAQrT,eAG9C,OAAOsb,GAAiB/E,EAAW,gBAAiBsG,IAFjC5F,GAAgB,EAAIA,EAAe,GACtBvb,EAAYmhB,EAASttB,QAAUstB,EAASttB,QAE1E,CC5FmButB,CAAyB,GAAQvG,UAAW7a,GACzD,GAAW,gBAAgB6gB,GAAoB9C,EAAKzZ,kBACpD,KACF,CACA,IAAK,oBAEH,GAAW,cADEyb,GAAqB,GAAQlF,UAAW,oBAAqB7a,EAAWggB,GACvDnB,qBAC9B,MAEF,IAAK,aAEH,GAAW,YADEkB,GAAqB,GAAQlF,UAAW,aAAc7a,EAAWggB,GAClDlB,cAC5B,MAEF,IAAK,mBAEH,GAAW,kBAA0C,IADxCiB,GAAqB,GAAQlF,UAAW,mBAAoB7a,EAAWggB,GAClDjB,kBAAwBsC,QAAQ,OAClE,MAEF,IAAK,kBAEH,GAAW,iBAAwC,IADtCtB,GAAqB,GAAQlF,UAAW,kBAAmB7a,EAAWggB,GAClDhB,iBAAuBqC,QAAQ,OAChE,MAEF,IAAK,iBAEH,GAAW,gBAA2C,IADzCtB,GAAqB,GAAQlF,UAAW,iBAAkB7a,EAAWggB,GAClDf,iBAAiB,IAAUoC,QAAQ,OACnE,MAEF,IAAK,kBAEH,GAAW,iBAA4C,IAD1CtB,GAAqB,GAAQlF,UAAW,kBAAmB7a,EAAWggB,GAClDf,iBAAiB,IAAUoC,QAAQ,OAM1E,CA4EA,SAAS,GAAmBlZ,GACrB,GAAQyS,UAGbzS,EAAMe,iBACNf,EAAMkU,kBACR,CCjPA,MAAMiF,GAAoB,CACxBC,KAAM,CAAEC,UAqSV,SAA0BC,GACxB,MACM5tB,EAASqM,KAAKoC,MADH,IACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZK,EAAW7hB,KAAK8hB,IAAS,MAAJF,GACrBG,EAAoE,IAA7D/hB,KAAKwO,IAAI,EAAIxO,KAAKC,IAAM,IAAM,GAAKD,KAAKwO,IAAQ,IAAJoT,IAAYA,GAC/DI,EAAQhiB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,KAAO2hB,GAAK5hB,KAAK8hB,IAAS,IAAJF,GAAU,GAC/DK,EAAkC,KAAT,EAAhBjiB,KAAK4C,SAAe,GACnCnL,EAAK/D,IAAMquB,EAAOC,EAAQC,GAASJ,CACrC,CACA,OAAOJ,CACT,EAnTuCS,aAAc,CAAC,IAAM,MAAOC,KAAM,GAAKC,IAAK,KACjFC,OAAQ,CAAEf,UAoTZ,SAA4BC,GAC1B,MACM5tB,EAASqM,KAAKoC,MADH,IACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZK,EAAW7hB,KAAK8hB,IAAS,IAAJF,GACrBU,EAAsE,GAA9DtiB,KAAKwO,IAAI,EAAIxO,KAAKC,IAAM,KAAO,IAAMD,KAAKwO,IAAQ,GAAJoT,IAAWA,GACjEW,EAAiC,KAAT,EAAhBviB,KAAK4C,SAAe,GAClCnL,EAAK/D,IAAM4uB,EAAQC,GAAQV,CAC7B,CACA,OAAOJ,CACT,EAjU2CS,aAAc,CAAC,EAAG,MAAOC,KAAM,GAAKC,IAAK,IAClFI,YAAa,CAAElB,UAkUjB,SAAiCC,GAC/B,MACM5tB,EAASqM,KAAKoC,MADH,IACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZiB,EAAOziB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,IAAM2hB,GAAK5hB,KAAK8hB,IAAS,GAAJF,GACnDc,EAAU1iB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,IAAM2hB,GAAK5hB,KAAK8hB,IAAS,GAAJF,GAAS,GACrEnqB,EAAK/D,GAAwB,IAAlB+uB,EAAOC,EACpB,CACA,OAAOjB,CACT,EA9UqDS,aAAc,CAAC,EAAG,GAAIC,KAAM,KAC/EQ,aAAc,CAAErB,UA+UlB,SAAkCC,GAChC,MACM5tB,EAASqM,KAAKoC,MADH,IACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZiB,EAAOziB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,IAAM2hB,GAAK5hB,KAAK8hB,IAAS,GAAJF,GACnDgB,EAAW5iB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,IAAM2hB,GAAK5hB,KAAK8hB,IAAS,GAAJF,GAAS,GACtEnqB,EAAK/D,GAAyB,IAAnB+uB,EAAOG,EACpB,CACA,OAAOnB,CACT,EA3VuDS,aAAc,CAAC,EAAG,GAAIC,KAAM,IACjFtX,OAAQ,CAAEyW,UA4VZ,SAA4BC,GAC1B,MACM5tB,EAASqM,KAAKoC,MADH,IACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZqB,EAAQ7iB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,IAAM2hB,GAAK5hB,KAAK8hB,IAAS,GAAJF,GACpDK,GAAyB,EAAhBjiB,KAAK4C,SAAe,GAAK5C,KAAK8hB,IAAS,IAAJF,GAAU,IAC5DnqB,EAAK/D,GAAuB,IAAjBmvB,EAAQZ,EACrB,CACA,OAAOR,CACT,EAxW2CS,aAAc,CAAC,IAAM,MAAOC,KAAM,KAC3EW,aAAc,CAAExB,UAyWlB,SAA2BC,GACzB,MACM5tB,EAASqM,KAAKoC,MADH,GACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZuB,EAAQ/iB,KAAKwO,IAAI,EAAIxO,KAAKC,IAAM,IAAM,IAAM2hB,GAAKA,GAAK5hB,KAAK8hB,IAAS,GAAJF,GAChEK,GAAyB,EAAhBjiB,KAAK4C,SAAe,GAAK5C,KAAK8hB,IAAS,IAAJF,GAAU,IAC5DnqB,EAAK/D,GAAuB,KAAjBqvB,EAAQd,EACrB,CACA,OAAOR,CACT,EArXgDS,aAAc,CAAC,IAAM,MAAOC,KAAM,GAAKC,IAAK,KAC1FY,UAAW,CAAE1B,UAsXf,SAA+BC,GAC7B,MACM5tB,EAASqM,KAAKoC,MADH,GACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZK,EAAW7hB,KAAK8hB,IAAS,KAAJF,GACrBqB,EAAOjjB,KAAKwO,IAAI,EAAIxO,KAAKC,IAAM,GAAK,GAAKD,KAAKwO,IAAQ,EAAJoT,IAAUA,GAAK5hB,KAAK8hB,IAAS,KAAJF,GAAW,GACtFsB,GAAwB,EAAhBljB,KAAK4C,SAAe,GAAK5C,KAAK8hB,IAAS,KAAJF,GAAW,GAC5DnqB,EAAK/D,IAAMuvB,EAAOC,GAAQrB,CAC5B,CACA,OAAOJ,CACT,EAnYiDS,aAAc,CAAC,GAAK,MAAOC,KAAM,KAChFgB,MAAO,CAAE7B,UAoYX,SAA2BC,GACzB,MACM5tB,EAASqM,KAAKoC,MADH,IACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZK,EAAW7hB,KAAK8hB,IAAS,IAAJF,GACrBa,EAAqD,GAA9CziB,KAAKwO,IAAI,EAAIxO,KAAKC,IAAM,IAAM,IAAM2hB,GAAKA,GAChDwB,EAAUpjB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,KAAO2hB,GAAK5hB,KAAK8hB,IAAS,IAAJF,GAAU,GACvEnqB,EAAK/D,IAAM+uB,EAAOW,GAAWvB,CAC/B,CACA,OAAOJ,CACT,EAjZyCS,aAAc,CAAC,IAAM,MAAOC,KAAM,IACzEkB,WAAY,CAAE/B,UAkZhB,SAA2BC,GACzB,MACM5tB,EAASqM,KAAKoC,MADH,GACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZK,EAAW7hB,KAAK8hB,IAAS,GAAJF,GACrBK,EAAkC,KAAT,EAAhBjiB,KAAK4C,SAAe,GAC7B0gB,EAAOtjB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,GAAK2hB,GAAK5hB,KAAK8hB,IAAS,GAAJF,GAAS,GACjEnqB,EAAK/D,IAAMuuB,EAAQqB,GAAQzB,CAC7B,CACA,OAAOJ,CACT,EA/Z8CS,aAAc,CAAC,GAAK,MAAOC,KAAM,KAC7EoB,UAAW,CAAEjC,UAgaf,SAA+BC,GAC7B,MACM5tB,EAASqM,KAAKoC,MADH,GACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZ4B,EAAUpjB,KAAKwO,IAAI,EAAIxO,KAAKC,IAAM,IAAM,GAAKD,KAAKwO,IAAQ,GAAJoT,IAAWA,GAAK5hB,KAAK8hB,IAAS,GAAJF,GAAS,GACzFK,GAAyB,EAAhBjiB,KAAK4C,SAAe,GAAK5C,KAAK8hB,IAAS,IAAJF,GAAU,GAC5DnqB,EAAK/D,GAAK0vB,EAAUnB,CACtB,CACA,OAAOR,CACT,EA5aiDS,aAAc,CAAC,IAAM,MAAOC,KAAM,IACjFqB,cAAe,CAAElC,UA6anB,SAAmCC,GACjC,MACM5tB,EAASqM,KAAKoC,MADH,IACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZK,EAAW7hB,KAAK8hB,IAAS,KAAJF,GACrB6B,EAAsE,GAA5DzjB,KAAKwO,IAAI,EAAIxO,KAAKC,IAAM,IAAM,IAAMD,KAAKwO,IAAQ,EAAJoT,IAAUA,GACjE8B,EAAuE,GAA7D1jB,KAAKwO,IAAI,EAAIxO,KAAKC,IAAM,IAAM,IAAMD,KAAKwO,IAAQ,GAAJoT,IAAWA,GAClE+B,EAAmC,IAAT,EAAhB3jB,KAAK4C,SAAe,GACpCnL,EAAK/D,IAAM+vB,EAAUC,EAAUC,GAAU9B,CAC3C,CACA,OAAOJ,CACT,EA3byDS,aAAc,CAAC,IAAM,MAAOC,KAAM,GACzFyB,UAAW,CAAEtC,UA4bf,SAA+BC,GAC7B,MACM5tB,EAASqM,KAAKoC,MADH,GACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZiB,EAAOziB,KAAKwO,IAAI,EAAIxO,KAAKC,IAAM,IAAM,GAAK2hB,GAAKA,GAAK5hB,KAAK8hB,IAAS,GAAJF,GACpEnqB,EAAK/D,GAAY,GAAP+uB,CACZ,CACA,OAAOhB,CACT,EAvciDS,aAAc,CAAC,GAAK,MAAOC,KAAM,IAChF0B,OAAQ,CAAEvC,UAwcZ,SAA4BC,GAC1B,MACM5tB,EAASqM,KAAKoC,MADH,IACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZe,GAAwB,EAAhBviB,KAAK4C,SAAe,GAAK5C,KAAK8hB,IAAS,IAAJF,GAAU,IACrDkC,EAAQ9jB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,IAAM2hB,GAAK5hB,KAAK8hB,IAAS,IAAJF,GAAU,GACpEnqB,EAAK/D,GAAK6uB,EAAOuB,CACnB,CACA,OAAOrC,CACT,EApd2CS,aAAc,CAAC,IAAM,MAAOC,KAAM,GAAKC,IAAK,IACrF2B,iBAAkB,CAAEzC,UAqdtB,SAA2BC,GACzB,MACM5tB,EAASqM,KAAKoC,MADH,GACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZrtB,EAAO6L,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,IAAM2hB,GAAK5hB,KAAK8hB,IAAS,KAAJF,GAAW,GAC9DoC,EAAWhkB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,IAAM2hB,GAAK5hB,KAAK8hB,IAAS,KAAJF,GAAW,GAClE8B,EAAU1jB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,KAAO2hB,GAAK5hB,KAAK8hB,IAAS,KAAJF,GAAW,GACxEnqB,EAAK/D,GAAKS,EAAO6vB,EAAWN,CAC9B,CACA,OAAOjC,CACT,EAleoDS,aAAc,CAAC,IAAM,MAAOC,KAAM,KAGhF8B,GAAkB,CACtB,oBAAqB,CAAEC,MAAO,OAAQC,SAAU,GAAIpmB,UAAW,KAC/D,sBAAuB,CAAEmmB,MAAO,SAAUC,SAAU,GAAIpmB,UAAW,KACnE,sBAAuB,CAAEmmB,MAAO,cAAeC,SAAU,KACzD,uBAAwB,CAAED,MAAO,eAAgBC,SAAU,IAAKpmB,UAAW,KAC3E,qBAAsB,CAAEmmB,MAAO,SAAUC,SAAU,GAAIpmB,UAAW,KAClE,mBAAoB,CAAEmmB,MAAO,eAAgBC,SAAU,IACvD,sBAAuB,CAAED,MAAO,YAAaC,SAAU,IAAKpmB,UAAW,KACvE,wBAAyB,CAAEmmB,MAAO,QAASC,SAAU,IAAKpmB,UAAW,KACrE,2BAA4B,CAAEmmB,MAAO,aAAcC,SAAU,IAAKpmB,UAAW,KAC7E,4BAA6B,CAAEmmB,MAAO,aAAcC,SAAU,KAC9D,aAAc,CAAED,MAAO,YAAaC,SAAU,GAAIpmB,UAAW,KAC7D,iBAAkB,CAAEmmB,MAAO,gBAAiBC,SAAU,IAAKpmB,UAAW,KACtE,aAAc,CAAEmmB,MAAO,YAAaC,SAAU,KAC9C,mBAAoB,CAAED,MAAO,SAAUC,SAAU,IACjD,yBAA0B,CAAED,MAAO,YAAaC,SAAU,IAAKpmB,UAAW,KAC1E,sBAAuB,CAAEmmB,MAAO,mBAAoBC,SAAU,IAAKpmB,UAAW,MAGhF,IAAIqmB,GAAe,KACfC,GAAa,KACbC,GAAU,KACVC,GAAY,KACZ,IAAc,EACdC,IAAoB,EACpBC,GAAiB,KACjBC,GAAmB,IACnBC,GAAoB,EACxB,MAAMC,GAAe,IAAI9Q,IACnB+Q,GAAiB,IAAI/Q,IACrBgR,GAAoB,GAuG1B,SAASC,GAAiBC,EAAW9gB,GACnC,MAAM+gB,EAAShB,GAAgBe,GAC1BC,GAAWb,IAalB,SAAoBvqB,EAAKqrB,GACvB,GAAIA,GAAc,EAChB,OAAO,EAET,MAAMxc,EAAMD,YAAYC,MAExB,QAAIA,GADSmc,GAAe3qB,IAAIL,IAAQ,GACvBqrB,KAGjBL,GAAe5Q,IAAIpa,EAAK6O,IACjB,EACT,CArBOyc,CAAWH,EAAWC,EAAOd,UAAY,KAG9CiB,KAoBF,SAAmBC,EAASJ,EAAS,CAAC,GACpC,IAAKb,KAAiBE,GACpB,OAEF,MAAM7C,EAASmD,GAAa1qB,IAAImrB,GAChC,IAAK5D,EACH,OAEF,MAAMnf,EAAS8hB,GAAakB,qBAC5BhjB,EAAOmf,OAASA,EAChB,MAAM8D,EAAYN,EAAO/C,cAAgBd,GAAkBiE,IAAUnD,cAAgB,CAAC,EAAG,GACzF5f,EAAO4f,aAAahnB,MAAQsqB,GAAcD,EAAU,GAAIA,EAAU,IAClE,MAAME,EAAWrB,GAAasB,aACxBC,EAAWV,EAAO9C,MAAQf,GAAkBiE,IAAUlD,MAAQ,EACpEsD,EAAStD,KAAKjnB,MAAQ0qB,GAAYD,GAClC,IAAIE,EAAcJ,EAClB,MAAMK,EAAW1E,GAAkBiE,IAAUjD,IAC7C,GAAwB,iBAAb0D,GAAyB1B,GAAa2B,mBAAoB,CACnE,MAAMC,EAAS5B,GAAa2B,qBAC5BC,EAAO5D,IAAIlnB,MAAQsqB,IAAeM,EAAUA,GAC5CL,EAASQ,QAAQD,GACjBH,EAAcG,CAChB,CACAH,EAAYI,QAAQ3B,IACpBhiB,EAAO2jB,QAAQR,GACfnjB,EAAO3B,OACT,CA7CEulB,CAAUjB,EAAOf,MAAOe,GACpBA,EAAOlnB,WAiFb,SAA4BmE,EAAS,KACnCwiB,GAAmB1kB,KAAK+E,IAAI,IAAM2f,GAAmBxiB,GACrDikB,IACF,CAnFIC,CAAmBnB,EAAOlnB,WAE9B,CA2CA,SAASooB,KACP,GAAI3B,KAAsBJ,KAAiBG,GACzC,OAEFC,IAAoB,EACpB,MAGM6B,EAAgB,CAHJC,GA+RpB,SAAyB/E,GACvB,MACM5tB,EAASqM,KAAKoC,MADH,EACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YAC/C,IAAK,IAAI+E,EAAU,EAAGA,EAAU,EAAGA,GAAW,EAAG,CAC/C,MAAM9uB,EAAOgqB,EAAOE,eAAe4E,GAC7BC,EAAuB,IAAZD,EAAgB,IAAM,IACvC,IAAK,IAAI7yB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZK,EAAW,GAAM,GAAM7hB,KAAKwO,IAAIoT,EAAI5hB,KAAKC,GAAK,KAC9CwmB,EAASzmB,KAAKwO,IAAI,EAAIxO,KAAKC,IAAMumB,EAAW,EAAIxmB,KAAKwO,IAAQ,EAAJoT,IAAUA,GACnE8E,EAAiC,KAAT,EAAhB1mB,KAAK4C,SAAe,GAClCnL,EAAK/D,IAAe,GAAT+yB,EAAeC,GAAQ7E,CACpC,CACF,CACA,OAAOJ,CACT,CA/SwCkF,CAAgBvC,KAClCkC,GAgTtB,SAA2B/E,GACzB,MACM5tB,EAASqM,KAAKoC,MADH,EACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MACMkzB,EADIlzB,EAAI6tB,EAAIC,WACA,GACZK,EAAW+E,EAAQ,IAAO5mB,KAAK8hB,IAAa,IAAR8E,GAAc,EAClDC,EAAM7mB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,IAAM2mB,GAAS/E,EAClDpqB,EAAK/D,GAAW,GAANmzB,CACZ,CACA,OAAOpF,CACT,CA7T0CqF,CAAkB1C,KACvCkC,GA8TrB,SAA0B/E,GACxB,MACM5tB,EAASqM,KAAKoC,MADH,EACSmf,EAAIC,YACxBC,EAASF,EAAIG,aAAa,EAAG/tB,EAAQ4tB,EAAIC,YACzC/pB,EAAOgqB,EAAOE,eAAe,GACnC,IAAK,IAAIjuB,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAAG,CAClC,MAAMkuB,EAAIluB,EAAI6tB,EAAIC,WACZuF,EAAyC,GAAlC/mB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,IAAM2hB,GACpCoF,EAAuC,GAAjChnB,KAAKwO,IAAI,EAAIxO,KAAKC,GAAK,GAAK2hB,GACxCnqB,EAAK/D,IAAMqzB,EAAOC,IAAQ,GAAM,GAAMhnB,KAAKwO,IAAIoT,EAAI5hB,KAAKC,GAAK,IAC/D,CACA,OAAOwhB,CACT,CA1UyCwF,CAAiB7C,MACGxP,OAAOsS,SAClEpC,GAAkB5vB,QAAQmxB,GAC1B3B,GAAmB,IACnBC,GAAoB,CACtB,CAEA,SAAS2B,GAAoB7E,GAC3B,IAAKA,IAAW2C,KAAiBG,GAC/B,OAAO,KAET,MAAMjiB,EAAS8hB,GAAakB,qBAC5BhjB,EAAOmf,OAASA,EAChBnf,EAAO6kB,MAAO,EACd,MAAMhF,EAAOiC,GAAasB,aACtBjE,EAAOjV,UAAY,EACrB2V,EAAKA,KAAKjnB,MAAQ,IACTumB,EAAOjV,UAAY,EAC5B2V,EAAKA,KAAKjnB,MAAQ,GAElBinB,EAAKA,KAAKjnB,MAAQ,IAEpBoH,EAAO2jB,QAAQ9D,GAAM8D,QAAQ1B,IAC7B,MAAM6C,EAAYhD,GAAaiD,YAAc,IAE7C,OADA/kB,EAAO3B,MAAMymB,GACN9kB,CACT,CAOA,SAAS8iB,KACFhB,IAGsB,cAAvBA,GAAalU,OAAwD,mBAAxBkU,GAAakD,QAC5DlD,GAAakD,SAASC,MAAM,OAEhC,CAiCA,SAAS3B,GAAY1qB,GACnB,OAAO8E,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI,EAAGxC,OAAOC,SAAStH,GAASA,EAAQ,GAClE,CAEA,SAASsqB,GAAczgB,EAAK5C,GAC1B,OAAO4C,EAAM/E,KAAK4C,UAAYT,EAAM4C,EACtC,CCnSA,SAASyiB,KACP,GAAsB,oBAAXlvB,SAA2BA,OAAOmvB,IAAK,CAChD,MAAM3jB,EAAQ,IAAIlL,MAAM,yBAExB,MADAkL,EAAMiF,KAAO,oBACPjF,CACR,CACA,OAAOxL,OAAOmvB,GAChB,CAIA,MAAMC,GAAS,QAAQ1nB,KAAK4C,SAAStM,SAAS,IAAI0Z,MAAM,EAAG,KAC3D,IAAI2X,GAAiB,KACjBC,GAAkB,KAClBC,GAAiB,KACjBC,GAAe,EACfC,GAAmB,eACnBC,GAAyB,KAC7B,MAAMC,GAAkB,GAExB,SAASC,KACP,OAAIP,IAAoC,oBAAXrvB,SAA2BA,OAAO6vB,oBAG/DR,GAAiB,IAAIQ,kBAAkB,CAAEC,WAAY,KACrDL,GAAmB,aAEnBH,GAAkBD,GAAeU,kBAAkB,WAAY,CAAEC,SAAS,IAC1EC,GAAiBX,IAEjBD,GAAea,iBAAiB,eAAiBvgB,IAC3CA,EAAMoR,WACR4O,GAAgB/yB,KAAKqC,KAAKC,UAAUyQ,EAAMoR,cAI9CsO,GAAea,iBAAiB,wBAAyB,KACvDT,GAAmBJ,GAAec,iBAAmB,YAGvDd,GAAea,iBAAiB,cAAgBvgB,IAC9C4f,GAAiB5f,EAAMse,QACvBgC,GAAiBV,OApBVF,EAwBX,CAEA,SAASY,GAAiBhC,GACnBA,IAGLA,EAAQiC,iBAAiB,OAAQ,KAC/BT,GAAmB,cAErBxB,EAAQiC,iBAAiB,QAAS,KAChCT,GAAmB,iBAErBxB,EAAQiC,iBAAiB,UAAYvgB,IACnC,KAS2BkS,EART5iB,KAAK2nB,MAAMjX,EAAMxQ,QASF,iBAAZ0iB,GAIhB,gBADCA,EAAQ7c,MAEZyW,GAAmB,CACjB7f,GAAIimB,EAAQjmB,GACZmM,KAAM8Z,EAAQ9Z,KACdhF,EAAG8e,EAAQ9e,EACXgC,EAAG8c,EAAQ9c,EACXO,OAAQuc,EAAQvc,OAChBsW,UAAWiG,EAAQjG,WAlBvB,CAAE,MAAOpQ,GACPC,QAAQsW,KAAK,8BAA+BvW,EAC9C,CAIJ,IAA+BqW,IAF/B,CA8HA,SAASuO,KACP,MAAO,CACLx0B,GAAIwzB,GACJiB,OAAQZ,GACRa,iBAAkBZ,GAClBC,gBAAiB,IAAIA,IAEzB,CCxMA,MCEMY,GAAqB,CACzBC,QAAS,GACTpO,SAAS,EACTqO,cAAe,EACfC,UAAW,EACXC,UAAU,EACVnlB,MAAO,KACPolB,cAAe,KACfC,SAAS,EACTC,iBAAkB,KAClBC,qBAAsB,EACtBC,iBAAkB,EAClBC,WAAY,KACZC,UAAW,KACXC,eAAgB,CACdC,YAAa,EACb9K,WAAY,EACZ+K,YAAa,GAEfC,IAAK,CACHC,MAAO,KACPC,OAAQ,KACRC,cAAc,EACdC,eAAe,EACfC,mBAAmB,EACnBhC,gBAAiB,GACjBiC,iBAAkB,GAClBpmB,MAAO,OAIX,SAASqmB,KACP,OAAOtB,EACT,CAEA,SAASuB,GAAW1P,GAClBmO,GAAmBnO,QAAUA,EACxBA,IACHmO,GAAmBK,cAAgB,KACnCL,GAAmB/kB,MAAQ,KAE/B,CAMA,SAASumB,GAAWx2B,GAClB,MAAMy2B,EAAoBzB,GAAmBC,QAAQD,GAAmBE,gBAAgB70B,GAExF,GADA20B,GAAmBC,QAAUltB,MAAMC,QAAQhI,GAAQA,EAAO,GACtDy2B,EAAmB,CACrB,MAAMC,EAAe1B,GAAmBC,QAAQpP,UAAW8Q,GAAWA,EAAOt2B,KAAOo2B,GAChFC,GAAgB,IAClB1B,GAAmBE,cAAgBwB,EAEvC,CACI1B,GAAmBE,eAAiBF,GAAmBC,QAAQn1B,SACjEk1B,GAAmBE,cAAgB/oB,KAAKmC,IAAI,EAAG0mB,GAAmBC,QAAQn1B,OAAS,GAEvF,CAEA,SAAS82B,GAAS5P,GAChBgO,GAAmB/kB,MAAQ+W,CAC7B,CAEA,SAAS6P,GAAiB7P,GACxBgO,GAAmBK,cAAgBrO,CACrC,CAEA,SAAS8P,GAAc9P,GACrBgO,GAAmBU,WAAa1O,CAClC,CAEA,SAAS+P,GAAa/P,GACpBgO,GAAmBW,UAAY3O,CACjC,CAEA,SAASgQ,GAAmB32B,GAC1B20B,GAAmBiC,gBAAkB52B,GAAM,IAC7C,CASA,SAAS62B,GAAqBC,GAC5BnC,GAAmBG,UAAYgC,CACjC,CAEA,SAASC,GAAYhC,GACnBJ,GAAmBI,SAAWA,CAChC,CAEA,SAASiC,IAAkB,GAAEh3B,EAAE,UAAEi3B,IAC/BtC,GAAmBM,QAAUjC,QAAQhzB,GACrC20B,GAAmBO,iBAAmBl1B,GAAM,KAC5C20B,GAAmBQ,qBAAuB5gB,YAAYC,MACtDmgB,GAAmBS,iBAAmB6B,GAAa,CACrD,CAMA,SAASC,KACPvC,GAAmBM,SAAU,EAC7BN,GAAmBO,iBAAmB,KACtCP,GAAmBS,iBAAmB,EACtCT,GAAmBQ,qBAAuB,EAC1CgC,IACF,CACA,SAASC,GAAkBC,EAAU,CAAC,GAChChpB,OAAOC,SAAS+oB,EAAQ7B,eAC1Bb,GAAmBY,eAAeC,YAAc1pB,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAM8oB,EAAQ7B,eAE7EnnB,OAAOC,SAAS+oB,EAAQ3M,cAC1BiK,GAAmBY,eAAe7K,WAAa5e,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAM8oB,EAAQ3M,cAE5Erc,OAAOC,SAAS+oB,EAAQ5B,eAC1Bd,GAAmBY,eAAeE,YAAc3pB,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAM8oB,EAAQ5B,cAEnF,CAMA,SAAS6B,GAAa1B,GACpBjB,GAAmBe,IAAIE,OAASA,GAAU,IAC5C,CAEA,SAAS2B,GAAsBC,GACxB9vB,MAAMC,QAAQ6vB,KACjBA,EAAa,IAEf,MAAM7N,EAAO6N,EAAW1b,QAClByH,EAAUoR,GAAmBe,IAAI3B,iBAAmB,GACtDxQ,EAAQ9jB,SAAWkqB,EAAKlqB,QAAU8jB,EAAQkU,MAAM,CAACzwB,EAAOxF,IAAUwF,IAAU2iB,EAAKnoB,MAGrFmzB,GAAmBe,IAAI3B,gBAAkBpK,EAC3C,CAEA,SAAS+N,GAAuBF,GACzB9vB,MAAMC,QAAQ6vB,KACjBA,EAAa,IAEf,MAAM7N,EAAO6N,EAAW1b,QAClByH,EAAUoR,GAAmBe,IAAIM,kBAAoB,GACvDzS,EAAQ9jB,SAAWkqB,EAAKlqB,QAAU8jB,EAAQkU,MAAM,CAACzwB,EAAOxF,IAAUwF,IAAU2iB,EAAKnoB,MAGrFmzB,GAAmBe,IAAIM,iBAAmBrM,EAC5C,CAEA,SAASgO,GAAYhR,GACnBgO,GAAmBe,IAAI9lB,MAAQ+W,GAAW,IAC5C,CACA,SAASiR,IAAc,MAAEjC,EAAK,OAAEC,EAAM,WAAE4B,IACjB,kBAAV7B,IACThB,GAAmBe,IAAIG,aAAeF,GAElB,kBAAXC,IACTjB,GAAmBe,IAAII,cAAgBF,GAEf,kBAAf4B,IACT7C,GAAmBe,IAAIK,kBAAoByB,EAE/C,CAEA,SAASL,KACPxC,GAAmBe,IAAIC,MAAQ,KAC/BhB,GAAmBe,IAAIE,OAAS,KAChCjB,GAAmBe,IAAIG,cAAe,EACtClB,GAAmBe,IAAII,eAAgB,EACvCnB,GAAmBe,IAAIK,mBAAoB,EAC3CpB,GAAmBe,IAAI3B,gBAAkB,GACzCY,GAAmBe,IAAIM,iBAAmB,GAC1CrB,GAAmBe,IAAI9lB,MAAQ,IACjC,CCrLA,SAAS,GAAM5I,EAAO6J,EAAK5C,GACzB,OAAOnC,KAAKmC,IAAI4C,EAAK/E,KAAK+E,IAAI5C,EAAKjH,GACrC,CAEA,MAAM6wB,GAAsB,CAC1BC,MAAO,CACL7d,MAAO,cACP8d,aAAc,SACdlxB,MAAO,IACPF,OAAQ,GACRqxB,YAAa,GACbC,UAAW,GACXC,WAAY,CAAE/wB,GAAI,EAAGgC,EAAG,IACxBgvB,YAAa,CACX,CAAEhxB,EAAG,GAAIgC,EAAG,GACZ,CAAEhC,GAAI,GAAIgC,EAAG,IAEfivB,YAAa,GACbC,aAAc,IACdC,QAAS,IACTC,SAAU,IACVC,SAAU,IACVC,QAAS,IACTC,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,WAEfC,WAAY,CACV7e,MAAO,oBACP8d,aAAc,MACdgB,eAAgB,CACd,CACE/4B,GAAI,wBACJia,MAAO,cACP+e,QAAS,UACTzsB,OAAQ,CAAEpF,EAAG,GAAIgC,EAAG,GACpB8vB,QAAS,CACP,CAAE9xB,EAAG,GAAIgC,GAAI,GACb,CAAEhC,EAAG,GAAIgC,EAAG,IAEdgN,WAAY,CACVC,MAAO,IACPV,OAAQ,GACRtN,OAAQ,EACR0B,MAAO,UACPwM,cAAe,IACfX,UAAW,IAEbujB,QAAS,IACTnjB,aAAc,KACdojB,cAAe,IACfC,YAAa,GACbC,aAAc,GACdC,YAAa,EACbC,YAAa,YAGjB1yB,MAAO,IACPF,OAAQ,GACRuxB,WAAY,CAAE/wB,EAAG,EAAGgC,EAAG,IACvBgvB,YAAa,CACX,CAAEhxB,EAAG,GAAIgC,EAAG,GACZ,CAAEhC,GAAI,GAAIgC,EAAG,IAEfivB,YAAa,IACboB,uBAAwB,IACxBC,mBAAoB,IACpBC,eAAgB,IAChBlB,SAAU,IACVC,QAAS,IACTkB,UAAW,IACXC,aAAc,IACdC,aAAc,GACdC,iBAAkB,IAClBC,gBAAiB,GACjBC,iBAAkB,GAClBC,iBAAkB,IAClBC,WAAY,GACZC,kBAAmB,IACnBzB,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,UACbuB,UAAW,IACXC,eAAgB,EAChBC,WAAY,IAEdC,SAAU,CACRtgB,MAAO,gBACP8d,aAAc,MACdgB,eAAgB,CACd,CACE/4B,GAAI,uBACJia,MAAO,eACP+e,QAAS,YACTzsB,OAAQ,CAAEpF,EAAG,GAAIgC,GAAI,GACrB8vB,QAAS,CACP,CAAE9xB,EAAG,GAAIgC,GAAI,IACb,CAAEhC,EAAG,GAAIgC,EAAG,KAEdgN,WAAY,CACVC,MAAO,IACPV,OAAQ,GACRtN,OAAQ,EACR0B,MAAO,UACPwM,cAAe,IACfX,UAAW,KAEbujB,QAAS,EACTnjB,aAAc,IACdojB,cAAe,IACfC,YAAa,GACbC,aAAc,GACdC,YAAa,EACbC,YAAa,YAGjB1yB,MAAO,IACPF,OAAQ,GACRuxB,WAAY,CAAE/wB,EAAG,EAAGgC,EAAG,IACvBgvB,YAAa,CACX,CAAEhxB,EAAG,GAAIgC,GAAI,GACb,CAAEhC,GAAI,GAAIgC,GAAI,IAEhBivB,YAAa,IACboB,uBAAwB,IACxBC,mBAAoB,IACpBC,eAAgB,IAChBlB,SAAU,IACVC,QAAS,IACTkB,UAAW,IACXC,aAAc,IACdC,aAAc,IACdC,iBAAkB,IAClBC,gBAAiB,IACjBC,iBAAkB,GAClBC,iBAAkB,IAClBC,WAAY,IACZC,kBAAmB,IACnBzB,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,UACb2B,SAAU,KAEZC,UAAW,CACTxgB,MAAO,aACP8d,aAAc,QACdgB,eAAgB,CACd,CACE/4B,GAAI,uBACJia,MAAO,cACP+e,QAAS,UACTzsB,OAAQ,CAAEpF,EAAG,GAAIgC,GAAI,IACrB8vB,QAAS,CACP,CAAE9xB,EAAG,GAAIgC,GAAI,IAEfgN,WAAY,CACVC,MAAO,IACPV,OAAQ,GACRtN,OAAQ,EACR0B,MAAO,UACPwM,cAAe,IACfX,UAAW,KAEbujB,QAAS,IACTnjB,aAAc,GACdojB,cAAe,GACfC,YAAa,GACbC,aAAc,GACdC,YAAa,EACbC,YAAa,YAGjB1yB,MAAO,IACPF,OAAQ,GACRuxB,WAAY,CAAE/wB,GAAI,GAAIgC,EAAG,IACzBgvB,YAAa,CACX,CAAEhxB,EAAG,GAAIgC,GAAI,GACb,CAAEhC,GAAI,GAAIgC,GAAI,IAEhBivB,YAAa,IACbsC,mBAAoB,GACpBC,kBAAmB,IACnBC,cAAe,IACfC,kBAAmB,IACnBC,cAAe,IACfC,SAAU,IACVC,aAAc,EACdC,SAAU,IACVC,cAAe,IACfC,gBAAiB,GACjBzC,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,WAEfuC,WAAY,CACVnhB,MAAO,cACP8d,aAAc,QACdgB,eAAgB,CACd,CACE/4B,GAAI,0BACJia,MAAO,gBACP+e,QAAS,UACTzsB,OAAQ,CAAEpF,EAAG,GAAIgC,GAAI,IACrB8vB,QAAS,CACP,CAAE9xB,EAAG,GAAIgC,GAAI,GACb,CAAEhC,EAAG,GAAIgC,EAAG,IAEdgN,WAAY,CACVC,MAAO,IACPV,OAAQ,GACRtN,OAAQ,EACR0B,MAAO,UACPwM,cAAe,IACfX,UAAW,KAEbujB,QAAS,EACTnjB,aAAc,GACdojB,cAAe,IACfC,YAAa,GACbC,aAAc,GACdC,YAAa,EACbC,YAAa,YAGjB1yB,MAAO,IACPF,OAAQ,GACRuxB,WAAY,CAAE/wB,EAAG,GAAIgC,EAAG,IACxBgvB,YAAa,CACX,CAAEhxB,EAAG,IAAKgC,GAAI,GACd,CAAEhC,GAAI,IAAKgC,GAAI,IAEjBivB,YAAa,IACbsC,mBAAoB,GACpBC,kBAAmB,IACnBC,cAAe,IACfC,kBAAmB,IACnBC,cAAe,IACfC,SAAU,IACVC,aAAc,EACdC,SAAU,IACVC,cAAe,IACfC,gBAAiB,GACjBzC,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,WAEfwC,SAAU,CACRphB,MAAO,YACP8d,aAAc,QACdgB,eAAgB,CACd,CACE/4B,GAAI,2BACJia,MAAO,iBACP+e,QAAS,YACTzsB,OAAQ,CAAEpF,EAAG,GAAIgC,GAAI,IACrB8vB,QAAS,CACP,CAAE9xB,EAAG,GAAIgC,GAAI,GACb,CAAEhC,EAAG,GAAIgC,EAAG,IAEdgN,WAAY,CACVC,MAAO,IACPV,OAAQ,GACRtN,OAAQ,EACR0B,MAAO,UACPwM,cAAe,IACfX,UAAW,KAEbujB,QAAS,IACTnjB,aAAc,IACdojB,cAAe,IACfC,YAAa,GACbC,aAAc,GACdC,YAAa,EACbC,YAAa,YAGjB1yB,MAAO,IACPF,OAAQ,GACRuxB,WAAY,CAAE/wB,EAAG,EAAGgC,EAAG,IACvBgvB,YAAa,CACX,CAAEhxB,EAAG,GAAIgC,GAAI,IACb,CAAEhC,GAAI,GAAIgC,GAAI,KAEhBivB,YAAa,IACbsC,mBAAoB,GACpBC,kBAAmB,IACnBC,cAAe,IACfC,kBAAmB,IACnBC,cAAe,IACfC,SAAU,IACVC,aAAc,EACdC,SAAU,IACVC,cAAe,GACfI,gBAAiB,GACjBH,gBAAiB,GACjBzC,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,WAEf0C,WAAY,CACVthB,MAAO,cACP8d,aAAc,MACdlxB,MAAO,GACPF,OAAQ,GACRuxB,WAAY,CAAE/wB,EAAG,EAAGgC,EAAG,IACvBgvB,YAAa,CACX,CAAEhxB,EAAG,GAAIgC,EAAG,GACZ,CAAEhC,GAAI,GAAIgC,EAAG,IAEfivB,YAAa,GACboB,uBAAwB,IACxBC,mBAAoB,IACpBC,eAAgB,IAChBlB,SAAU,IACVC,QAAS,IACTkB,UAAW,IACXC,aAAc,IACdC,aAAc,IACdC,iBAAkB,IAClBC,gBAAiB,IACjBC,iBAAkB,GAClBC,iBAAkB,IAClBC,WAAY,GACZC,kBAAmB,IACnBzB,WAAY,IACZC,UAAW,UACXC,YAAa,UACbC,YAAa,YAIjB,IAAI2C,GAAiB,EAErB,SAASC,GAAcryB,EAAMjC,EAAGvH,EAAU,CAAC,GACzC,MAAM8F,EAAamyB,GAAoBzuB,GACvC,IAAK1D,EACH,MAAM,IAAIhB,MAAM,yBAAyB0E,KAG3C,MAAM2uB,EAAeryB,EAAWqyB,cAAgB,SAC1C/vB,EAA0B,GAAnBtC,EAAWmB,MAClB+J,EAAW,KAEX8qB,EAAU,GAAMv0B,GAAgB,GAAXyJ,EAAgB5I,EAD9B8D,KAAKmC,IAAIjG,EAAM4I,EAA8B,GAAnBlL,EAAWmB,QAGlD,IAAI8B,EACAoT,GAAW,EACX4f,EAAa,KACbC,EAAoBh8B,EAAQi8B,OAASn2B,EAAWw0B,YAAc,EAElE,GAAqB,QAAjBnC,EAAwB,CAC1B,MAAM+D,EAAcp2B,EAAWs0B,kBAAoB,EAE7C+B,EAAW,GAAMH,EAAmBE,EADtBp2B,EAAWu0B,kBAAoB6B,GAEnDnzB,EAAMjC,EAAWhB,EAAWiB,OAASo1B,EACrChgB,GAAW,EACX6f,EAAoBG,CACtB,MAAO,GAAqB,UAAjBhE,EAA0B,CACnC,MAAMiE,EAAgBt2B,EAAWg1B,oBAAsB,GACvDiB,EAAaj1B,EAAWs1B,EACxB,MAAMd,EAAgB,GAAMx1B,EAAWw1B,eAAiB,IAAM,GAAK,IAC7DI,EAAkB51B,EAAW41B,iBAAmB,EACtD3yB,EAAMgzB,EAAaj2B,EAAWiB,OAASu0B,EAAgBI,EACvDvf,GAAW,EACX6f,EAAoB,CACtB,MACEjzB,EAAMjC,EAAWhB,EAAWiB,OAG9B,MAAMs1B,EAAU,CACdj8B,GAAI,WAAWoJ,KAAQoyB,IAAkB,IACzCpyB,OACAjC,EAAGu0B,EACHvyB,EAAGR,EACH8F,GAAI,EACJE,GAAI,EACJutB,KAAM,EACNxyB,OAAQ,EACRyyB,SAAU,KACV7f,OAAQ5W,EAAWgzB,WACnBnc,UAAW7W,EAAWgzB,WACtB0D,cAAe,EACfC,YAAa,EACbtgB,WACA6f,kBAAoC,QAAjB7D,EAAyB6D,EAAoB,EAChED,aACAW,SAAUxwB,KAAK4C,SAAW5C,KAAKC,GAAK,GAYtC,OATAkwB,EAAQM,QAAU72B,EAAWqzB,gBAAkB,IAAIz2B,IAAI,CAACk6B,EAAUh7B,KAAU,CAC1ExB,GAAIw8B,EAASx8B,IAAM,GAAGoJ,WAAc5H,IACpCyuB,SAAU,EACVlT,WAAY,EACZ0f,YAAa,EACbC,YAAa,KACbC,YAAa,QAGRV,CACT,CAEA,MAAMW,GAAW,CACfnB,GAAc,QAAiC,IAAxB,MACvBA,GAAc,QAAiC,IAAxB,MACvBA,GAAc,YAAqC,IAAxB,MAC3BA,GAAc,aAAsC,IAAxB,KAA8B,CAAEI,MAAO,MACnEJ,GAAc,WAAoC,IAAxB,KAA8B,CAAEI,MAAO,MACjEJ,GAAc,aAAsC,IAAxB,MAC5BA,GAAc,WAAoC,IAAxB,MAC1BA,GAAc,aAAsC,GAAxB,KAA6B,CAAEI,MAAO,OClapE,SAAS,GAAM70B,EAAO6J,EAAK5C,GACzB,OAAOnC,KAAKmC,IAAI4C,EAAK/E,KAAK+E,IAAI5C,EAAKjH,GACrC,CCFA,IAAI61B,GAAU,EAMd,SAASC,KACP,OAAOD,EACT,CCRA,MCGME,GAA0B,CAC9BC,SAAU,EACVC,UAAW,EACXC,WAAY,GAGRC,GAAgB,CACpB1pB,QAAQ,EACR2pB,MAAO,WACPC,MAAO,EACPjO,KAAM,EACNkO,aAAc,EACdC,WAAY,EACZC,MAAO,EACPC,UAAW,EACXT,SAAU,EACVC,UAAW,EACXC,WAAY,EACZQ,YAAa,MAqBf,SAASC,IAAmB,cAAEC,GAAgB,GAAS,CAAC,IAlBxD,SAA6BC,GAAW,GAClCA,GACFd,GAAwBC,SAAWlxB,KAAKmC,IAAI8uB,GAAwBC,SAAUG,GAAcH,UAC5FD,GAAwBE,UAAYnxB,KAAKmC,IAAI8uB,GAAwBE,UAAWE,GAAcF,WAC9FF,GAAwBG,WAAapxB,KAAKmC,IAAI8uB,GAAwBG,WAAYC,GAAcD,cAEhGH,GAAwBC,SAAW,EACnCD,GAAwBE,UAAY,EACpCF,GAAwBG,WAAa,EAEzC,EAUIY,GADEF,GAKJT,GAAc1pB,QAAS,EACvB0pB,GAAcC,MAAQ,WACtBD,GAAcE,MAAQ,EACtBF,GAAc/N,KAAO,EACrB+N,GAAcG,aAAe,EAC7BH,GAAcI,WAAa,EAC3BJ,GAAcK,MAAQ,EACtBL,GAAcM,UAAY,EAC1BN,GAAcO,YAAc,KAC5BP,GAAcH,SAAWD,GAAwBC,SACjDG,GAAcF,UAAYF,GAAwBE,UAClDE,GAAcD,WAAaH,GAAwBG,UACrD,CAgBA,SAASa,GAAiBX,EAAOC,EAAQ,GACvCF,GAAcC,MAAQA,EACtBD,GAAcE,MAAQvxB,KAAKmC,IAAI,EAAGovB,GAAS,EAC7C,CAiBA,SAASW,GAAiBh3B,GACxBm2B,GAAcE,MAAQvxB,KAAKmC,IAAI,EAAGjH,GAAS,EAC7C,CAEA,SAASi3B,GAAwB/9B,GAC/Bi9B,GAAcG,aAAexxB,KAAKmC,IAAI,EAAGnC,KAAKoC,MAAMhO,GAAS,GAC/D,CAEA,SAASg+B,GAAsBlwB,GAC7B,MAAMmwB,EAASryB,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMP,GAAU,IAChDmvB,GAAcI,WAAaY,EACvBA,EAAS,IACXhB,GAAcM,WAAaU,EAC3BhB,GAAcD,WAAapxB,KAAKmC,IAAIkvB,GAAcD,WAAYC,GAAcM,WAC5EV,GAAwBG,WAAapxB,KAAKmC,IAAI8uB,GAAwBG,WAAYC,GAAcD,YAEpG,CAEA,SAASkB,GAA2BpwB,GAClC,MAAMmwB,EAASryB,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMP,GAAU,IAC5CmwB,GAAU,IAGdhB,GAAcM,WAAaU,EAC3BhB,GAAcD,WAAapxB,KAAKmC,IAAIkvB,GAAcD,WAAYC,GAAcM,WAC5EV,GAAwBG,WAAapxB,KAAKmC,IAAI8uB,GAAwBG,WAAYC,GAAcD,YAClG,CAiBA,SAASmB,GAAuBC,GAC9BnB,GAAcO,YAAcY,GAAW,IACzC,CAEA,SAASC,KACP,OAAOpB,EACT,CA5GEA,GAAcH,SAAWlxB,KAAKmC,IAAIkvB,GAAcH,SAAUD,GAAwBC,UAClFG,GAAcF,UAAYnxB,KAAKmC,IAAIkvB,GAAcF,UAAWF,GAAwBE,WACpFE,GAAcD,WAAapxB,KAAKmC,IAAIkvB,GAAcD,WAAYH,GAAwBG,YAkHxF/sB,GAAoB,KAClBwtB,GAAmB,CAAEC,eAAe,MCtJtC,MAAMY,GAAqB,CACzBtxB,OAAQ,CACN,CAAE9E,OAAQ,GAAIgJ,QAAS,EAAGyC,SAAU,GAAI/J,MAAO,WAC/C,CAAE1B,OAAQ,GAAIgJ,QAAS,EAAGyC,SAAU,GAAI/J,MAAO,WAC/C,CAAE1B,OAAQ,GAAIgJ,SAAU,GAAIyC,QAAS,EAAG/J,MAAO,WAC/C,CAAE1B,OAAQ,GAAIgJ,QAAS,GAAIyC,QAAS,EAAG/J,MAAO,WAC9C,CAAE1B,OAAQ,GAAIgJ,SAAU,GAAIyC,QAAS,GAAI/J,MAAO,WAChD,CAAE1B,OAAQ,GAAIgJ,QAAS,GAAIyC,QAAS,GAAI/J,MAAO,YAEjD6W,MAAO,CACL,CAAEvY,OAAQ,GAAIgJ,QAAS,EAAGyC,SAAU,GAAI/J,MAAO,WAC/C,CAAE1B,OAAQ,GAAIgJ,QAAS,EAAGyC,SAAU,GAAI/J,MAAO,WAC/C,CAAE1B,OAAQ,GAAIgJ,SAAU,GAAIyC,QAAS,EAAG/J,MAAO,WAC/C,CAAE1B,OAAQ,GAAIgJ,QAAS,GAAIyC,QAAS,EAAG/J,MAAO,WAC9C,CAAE1B,OAAQ,GAAIgJ,SAAU,GAAIyC,QAAS,GAAI/J,MAAO,WAChD,CAAE1B,OAAQ,GAAIgJ,QAAS,GAAIyC,QAAS,GAAI/J,MAAO,aAI7C20B,GAAW,GAEjB,SAASC,GAAaC,EAAMC,EAASC,EAASn1B,EAAS,EAAGo1B,EAAS,EAAGC,EAAS,GAC7E,MAAMC,EAAYR,GAAmBG,GACrC,GAAKK,EAIL,IAAK,MAAMC,KAAQD,EACjBP,GAASz9B,KAAK,CACZmG,EAAGy3B,EAAUK,EAAK7tB,QAAU1H,EAC5BP,EAAG01B,EAAUI,EAAKprB,QAClBpF,GAAIqwB,EAASp1B,GAAU,GAAqB,GAAhBoC,KAAK4C,UAAyC,IAAvB5C,KAAK4C,SAAW,IACnEC,GAAIowB,GAAU,GAAqB,IAAhBjzB,KAAK4C,UACxBtG,OAAQ62B,EAAK72B,OACb0B,MAAOm1B,EAAKn1B,MACZo1B,KAAM,IAAsB,GAAhBpzB,KAAK4C,SACjBywB,QAAS,IAAsB,GAAhBrzB,KAAK4C,UAG1B,CCxCA,MAAM0wB,GAAe,GAErB,SAASC,GAAiBl4B,EAAGgC,EAAGnC,GAC9Bo4B,GAAap+B,KAAK,CAChBmG,IACAgC,IACAnC,QACAk4B,KAAM,IACNC,QAAS,IACT1wB,GAA4B,IAAvB3C,KAAK4C,SAAW,IACrBC,IAAK,GAAqB,GAAhB7C,KAAK4C,UAEnB,CCZA,MAAM4wB,GAAY,GACZC,GAAQ,GACd,IAAIC,IAAoB,EAExB,MAAMC,GAAe,CAAC,UAAW,UAAW,UAAW,WACjDC,GAAoB,CAAC,0BAA2B,2BAChDC,GAAe,CAAC,UAAW,UAAW,WACtCC,GAAiB,CACrBC,KAAM,CAAC,UAAW,UAAW,WAC7BC,MAAO,CAAC,UAAW,UAAW,WAC9BC,MAAO,CAAC,UAAW,UAAW,WAC9BC,QAAS,CAAC,UAAW,YAGvB,SAASC,GAAW9f,GAClB,OAAOA,EAAOrU,KAAKoC,MAAMpC,KAAK4C,SAAWyR,EAAO1gB,UAAY0gB,EAAO,EACrE,CASA,SAAS+f,GAAetgC,EAAU,CAAC,GACjC,MAAMgP,EAAMhP,EAAQgP,KAAO,GACrBuxB,EAAO,CACXh5B,EAAGvH,EAAQuH,GAAK,EAChBgC,EAAGvJ,EAAQuJ,GAAK,EAChBi3B,YAAaxgC,EAAQwgC,aAAe,GACpCC,UAAWzgC,EAAQygC,WAAa,IAChCv2B,MAAOlK,EAAQkK,OAAS,UACxBgF,OAAQF,EACRA,MACA0xB,UAAW1gC,EAAQ0gC,WAAa,GAGlC,OADAf,GAAMv+B,KAAKm/B,GACJA,CACT,CAEA,SAASI,GAAgBvwB,EAAS,CAAC,GACjC,MAAMvI,EAAQuI,EAAO7I,GAAK,EACpBsC,EAAQuG,EAAO7G,GAAK,EACpBO,EAASsG,EAAOtG,QAAU,EAC1BG,EAAY,GAAMmG,EAAOnG,YAAemG,EAAO0F,QAAU,GAAK5J,KAAKmC,IAAI,EAAG+B,EAAOwwB,WAAa,IAAM,EAAG,GACvGxyB,EAASlC,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMyB,EAAOhC,QAAW,EAAgB,GAAZnE,IACtD42B,EAAYzwB,EAAOoG,OAAU,IAAkB,IAAZvM,EACnC62B,EAAU1wB,EAAO0wB,SAAW,IAClC,IAAK,IAAIlhC,EAAI,EAAGA,EAAIwO,EAAQxO,GAAK,EAAG,CAClC,MAAMyW,EAASjG,EAAOiG,QAAoB,IAAVnK,KAAKC,GAC/BwO,EAASzO,KAAK4C,SAAWuH,EAAkB,GAATA,GAAiBvM,GAAU,EAAI,EAAIoC,KAAKC,IAC1EqK,EAAQqqB,GAAa,IAAuB,GAAhB30B,KAAK4C,UACjCD,EAAK3C,KAAKuO,IAAIE,GAASnE,EACvBzH,EAAK7C,KAAKwO,IAAIC,GAASnE,GAAS,GAAiB,IAAZvM,GACrC+E,EAAM,IAAuB,IAAhB9C,KAAK4C,SACxB4wB,GAAUt+B,KAAK,CACboI,KAAM,QACNjC,EAAGM,EACH0B,EAAGM,EACHgF,KACAE,KACAC,MACAE,OAAQF,EACRxG,OAAQ,EAAoB,IAAhB0D,KAAK4C,SACjB5E,MAAOm2B,GAAWR,IAClBiB,WAEJ,CACA,MAAMC,EAAY70B,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAe,IAATP,IACzC,IAAK,IAAIxO,EAAI,EAAGA,EAAImhC,EAAWnhC,GAAK,EAAG,CACrC,MAAMohC,EAAM90B,KAAK4C,SAAW5C,KAAKC,GAAK,EAChCqK,EAAQ,GAAqB,IAAhBtK,KAAK4C,SAClBE,EAAM,IAAuB,GAAhB9C,KAAK4C,SACxB4wB,GAAUt+B,KAAK,CACboI,KAAM,YACNjC,EAAGM,EAAwB,EAAhBqE,KAAKuO,IAAIumB,GACpBz3B,EAAGM,EAAwB,EAAhBqC,KAAKwO,IAAIsmB,GACpBnyB,GAAI3C,KAAKuO,IAAIumB,GAAOxqB,EAAQ,GAC5BzH,GAAI7C,KAAKwO,IAAIsmB,GAAOxqB,EAAQ,GAAM,GAClCxH,MACAE,OAAQF,EACRxG,OAAQ,GAAqB,GAAhB0D,KAAK4C,SAClB5E,MAAOm2B,GAAWP,KAEtB,CACF,CAEA,SAASmB,GAAkB7wB,EAAS,CAAC,GACnC,MAAMvI,EAAQuI,EAAO7I,GAAK,EACpBsC,EAAQuG,EAAO7G,GAAK,EACpB6E,EAASlC,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMyB,EAAOhC,QAAU,IACjDyyB,EAAYzwB,EAAOoG,OAAS,IAC5B0qB,EAAUp5B,MAAMC,QAAQqI,EAAO8wB,UAAY9wB,EAAO8wB,QAAQrhC,OAAS,EAAIuQ,EAAO8wB,QAAUnB,GAC9F,IAAK,IAAIngC,EAAI,EAAGA,EAAIwO,EAAQxO,GAAK,EAAG,CAClC,MAAM+a,GAASvK,EAAOuK,OAAS,IAAMzO,KAAK4C,SAAW,KAAQsB,EAAOiG,QAAoB,GAAVnK,KAAKC,IAC7EqK,EAAQqqB,GAAa,GAAsB,GAAhB30B,KAAK4C,UAChCE,EAAM,IAAuB,IAAhB9C,KAAK4C,SACxB4wB,GAAUt+B,KAAK,CACboI,KAAM,QACNjC,EAAGM,EACH0B,EAAGM,EACHgF,GAAI3C,KAAKuO,IAAIE,GAASnE,EACtBzH,GAAI7C,KAAKwO,IAAIC,GAASnE,EACtBxH,MACAE,OAAQF,EACRxG,OAAQ,EAAoB,EAAhB0D,KAAK4C,SACjB5E,MAAOm2B,GAAWa,IAEtB,CACF,CAEA,SAASC,GAAgB/wB,EAAS,CAAC,GACjC,MAAMvI,EAAQuI,EAAO7I,GAAK,EACpBsC,EAAQuG,EAAO7G,GAAK,EACpB6E,EAASlC,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMyB,EAAOhC,QAAU,IACjD8yB,EAAUp5B,MAAMC,QAAQqI,EAAO8wB,UAAY9wB,EAAO8wB,QAAQrhC,OAAS,EACrEuQ,EAAO8wB,QAnGb,SAAwB30B,EAAM6U,EAAW4e,GAAeI,SACtD,OAAK7zB,EAGEyzB,GAAezzB,IAAS6U,EAFtBA,CAGX,CA+FMggB,CAAehxB,EAAOixB,YAAarB,GAAeI,SAChD5lB,EAAYpK,EAAOuK,OAAoB,IAAVzO,KAAKC,GAClCkK,EAASjG,EAAOiG,QAAoB,GAAVnK,KAAKC,GAC/B00B,EAAYzwB,EAAOoG,OAAS,IAClC,IAAK,IAAI5W,EAAI,EAAGA,EAAIwO,EAAQxO,GAAK,EAAG,CAClC,MAAM+a,EAAQH,GAAatO,KAAK4C,SAAW,IAAOuH,EAC5CG,EAAQqqB,GAAa,GAAsB,GAAhB30B,KAAK4C,UAChCE,EAAM,GAAsB,GAAhB9C,KAAK4C,SACvB4wB,GAAUt+B,KAAK,CACboI,KAAM,OACNjC,EAAGM,EACH0B,EAAGM,EACHgF,GAAI3C,KAAKuO,IAAIE,GAASnE,EACtBzH,GAAI7C,KAAKwO,IAAIC,GAASnE,EAAQ,GAC9BxH,MACAE,OAAQF,EACRxG,QAAS4H,EAAO5H,QAAU,KAAO,GAAsB,GAAhB0D,KAAK4C,UAC5C5E,MAAOm2B,GAAWa,IAEtB,CACF,CAEA,SAASI,GAAgBlxB,EAAS,CAAC,GACjC+wB,GAAgB,CACd55B,EAAG6I,EAAO7I,EACVgC,EAAG6G,EAAO7G,EACV6E,OAAQgC,EAAOhC,QAAU,EACzBizB,YAAajxB,EAAOixB,aAAe,OACnC7qB,MAAOpG,EAAOoG,OAAS,IACvBH,OAAQjG,EAAOiG,QAAoB,IAAVnK,KAAKC,GAC9BwO,MAAOvK,EAAOuK,OAAoB,IAAVzO,KAAKC,GAC7B3D,OAAQ4H,EAAO5H,QAAU,IAE7B,CA2BA,SAAS+4B,GAAgBnxB,EAAS,CAAC,EAAG+gB,EAAS,CAAC,GAC9C,MAAMqQ,EAASpxB,EAAOoxB,QAAU,CAAEj6B,EAAG6I,EAAO7I,GAAK,EAAGgC,EAAG6G,EAAO7G,GAAK,GACnE,OAAO+2B,GAAe,CACpB/4B,EAAGi6B,EAAOj6B,EACVgC,EAAGi4B,EAAOj4B,EACVyF,IAAKmiB,EAAOniB,KAAO,GACnBwxB,YAAarP,EAAOqP,aAAgBpwB,EAAO5H,QAAU,GACrDi4B,UAAWtP,EAAOsP,WAAqC,MAAvBrwB,EAAO5H,QAAU,IACjD0B,MAAOinB,EAAOjnB,OAAS,UACvBw2B,UAAWvP,EAAOuP,WAAa,GAEnC,CAEA,SAASe,GAAwBrxB,EAAS,CAAC,GACzC,MAAMoxB,EAASpxB,EAAOoxB,QAAU,CAAEj6B,EAAG,EAAGgC,EAAG,GAC3C,IAAK,IAAI3J,EAAI,EAAGA,EAAI,EAAGA,GAAK,EAAG,CAC7B,MAAM+a,EAAQzO,KAAK4C,SAAW5C,KAAKC,GAAK,EAClCqK,EAAQ,GAAqB,IAAhBtK,KAAK4C,SAClBD,EAAK3C,KAAKuO,IAAIE,GAASnE,EACvBzH,EAAK7C,KAAKwO,IAAIC,GAASnE,EACvBxH,EAAM,GAAsB,GAAhB9C,KAAK4C,SACvB4wB,GAAUt+B,KAAK,CACboI,KAAM,SACNjC,EAAGi6B,EAAOj6B,EACVgC,EAAGi4B,EAAOj4B,EACVsF,KACAE,KACAC,MACAE,OAAQF,EACRxG,OAAQ,EAAoB,EAAhB0D,KAAK4C,SACjB5E,MAAO,WAEX,CACAq3B,GAAgBnxB,EAAQ,CACtBpB,IAAK,IACLwxB,YAAqC,KAAvBpwB,EAAO5H,QAAU,IAC/Bi4B,UAAmC,MAAvBrwB,EAAO5H,QAAU,IAC7Bk4B,UAAW,EACXx2B,MAAO,WAEX,CA4CA,SAASw3B,KACH9B,IAAuC,oBAAXp7B,SAGhCA,OAAOkwB,iBAAiB,sBAAwBvgB,KAjHlD,SAA8B/D,EAAS,CAAC,GACtC,MACMvI,EAAQuI,EAAO7I,GAAK,EACpBsC,EAAQuG,EAAO7G,GAAK,EACpBO,EAASsG,EAAOtG,QAAU,EAChC,IAAK,IAAIlK,EAAI,EAAGA,EAJF,EAIaA,GAAK,EAAG,CACjC,MAAM4W,EAAQ,IAAsB,IAAhBtK,KAAK4C,SACnB6L,EAAyB,GAAhBzO,KAAK4C,SAAiB,IAAQhF,EAAS,EAAI,EAAIoC,KAAKC,IAC7D0C,EAAK3C,KAAKuO,IAAIE,GAASnE,EACvBzH,EAAK7C,KAAKwO,IAAIC,GAASnE,EACvBxH,EAAM,IAAuB,IAAhB9C,KAAK4C,SACxB4wB,GAAUt+B,KAAK,CACboI,KAAM,QACNjC,EAAGM,EACH0B,EAAGM,EACHgF,KACAE,KACAC,MACAE,OAAQF,EACRxG,OAAQ,EAAoB,EAAhB0D,KAAK4C,SACjB5E,MAAO,WAEX,CACF,CA2FIy3B,CAAqBxtB,GAAO/D,QAAU,CAAC,KAEzC5L,OAAOkwB,iBAAiB,aAAevgB,IACrCstB,GAAwBttB,GAAO/D,QAAU,CAAC,KAE5C5L,OAAOkwB,iBAAiB,iBAAmBvgB,KApD7C,SAA4B/D,EAAS,CAAC,GACpCmxB,GAAgBnxB,EAAQ,CACtBpB,IAAK,IACLwxB,YAAqC,IAAvBpwB,EAAO5H,QAAU,IAC/Bi4B,UAAmC,KAAvBrwB,EAAO5H,QAAU,IAC7Bk4B,UAAW,EACXx2B,MAAO,YAETu3B,GAAwB,CAAED,OAAQpxB,EAAOoxB,OAAQh5B,OAAQ4H,EAAO5H,QAAU,IAC5E,CA4CIo5B,CAAmBztB,GAAO/D,QAAU,CAAC,KAEvC5L,OAAOkwB,iBAAiB,sBAAwBvgB,IAC9C0tB,GAAwB1tB,GAAO/D,QAAU,CAAC,KAE5C5L,OAAOkwB,iBAAiB,wBAA0BvgB,KAuEpD,SAAyB/D,EAAS,CAAC,GACjC,MAAMvI,EAAQuI,EAAO7I,GAAK,EACpBsC,EAAQuG,EAAO7G,GAAK,EACpBf,EAAS4H,EAAO5H,QAAU,IAChC83B,GAAe,CACb/4B,EAAGM,EACH0B,EAAGM,EACH22B,YAAsB,GAATh4B,EACbi4B,UAAoB,KAATj4B,EACX0B,MAAO,UACPw2B,UAAW,EACX1xB,IAAK,MAEP,IAAK,IAAIpP,EAAI,EAAGA,EAAI,GAAIA,GAAK,EAAG,CAC9B,MAAM+a,EAAQzO,KAAK4C,SAAW5C,KAAKC,GAAK,EAClCqK,EAAQ,IAAsB,IAAhBtK,KAAK4C,SACnBE,EAAM,IAAuB,IAAhB9C,KAAK4C,SACxB4wB,GAAUt+B,KAAK,CACboI,KAAM,QACNjC,EAAGM,EACH0B,EAAGM,EACHgF,GAAI3C,KAAKuO,IAAIE,GAASnE,EACtBzH,GAAI7C,KAAKwO,IAAIC,GAASnE,EACtBxH,MACAE,OAAQF,EACRxG,OAAQ,EAAoB,EAAhB0D,KAAK4C,SACjB5E,MAAO,WAEX,CACF,CAnGI43B,CAAgB3tB,GAAO/D,QAAU,CAAC,KAEpC5L,OAAOkwB,iBAAiB,wBAA0BvgB,IAChD4tB,GAAgB5tB,GAAO/D,QAAU,CAAC,KAEpC5L,OAAOkwB,iBAAiB,4BAA8BvgB,KAkIxD,SAAiC/D,EAAS,CAAC,GACzCkwB,GAAe,CACb/4B,EAAG6I,EAAO7I,GAAK,EACfgC,EAAG6G,EAAO7G,GAAK,EACfi3B,YAAsC,IAAxBpwB,EAAO5H,QAAU,KAC/Bi4B,UAAoC,KAAxBrwB,EAAO5H,QAAU,KAC7B0B,MAAO,UACPw2B,UAAW,EACX1xB,IAAK,IAET,CA3IIgzB,CAAwB7tB,GAAO/D,QAAU,CAAC,KAE5C5L,OAAOkwB,iBAAiB,mBAAqBvgB,KAxD/C,SAAuC/D,EAAS,CAAC,GAC/C,MACM6xB,EAAa,CACjBC,SAAU,CAAC,UAAW,UAAW,WACjC7F,QAAS,CAAC,UAAW,UAAW,WAChC8F,SAAU,CAAC,UAAW,UAAW,WACjCC,QAAS,CAAC,UAAW,YAEjBlB,EAAUe,EAPC7xB,EAAOiyB,UAAY,YAOIJ,EAAWG,QAC7CzlB,EAAYzQ,KAAKmC,IAAI,EAAG+B,EAAOuM,WAAavM,EAAOsM,QAAU,GAE7DzS,EAAY,GAAM,EADNiC,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI0L,EAAWvM,EAAOsM,QAAUC,IAC3BA,EAAW,EAAG,GAChDrc,EAAQ4L,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAM,EAAgB,EAAZ1E,IACnCq4B,EAAY,IAAkB,IAAZr4B,EACxB,IAAK,IAAIrK,EAAI,EAAGA,EAAIU,EAAOV,GAAK,EAAG,CACjC,MAAM+a,EAAQzO,KAAK4C,SAAW5C,KAAKC,GAAK,EAClCqK,EAAQ8rB,GAAa,IAAuB,IAAhBp2B,KAAK4C,UACvC4wB,GAAUt+B,KAAK,CACboI,KAAM,SACNjC,EAAG6I,EAAO7I,GAAK,EACfgC,EAAG6G,EAAO7G,GAAK,EACfsF,GAAI3C,KAAKuO,IAAIE,GAASnE,EACtBzH,GAAI7C,KAAKwO,IAAIC,GAASnE,EAAQ,GAAM,GACpCxH,IAAK,IAAuB,GAAhB9C,KAAK4C,SACjBI,OAAQ,IAAuB,GAAhBhD,KAAK4C,SACpBtG,OAAQ,EAAoB,EAAhB0D,KAAK4C,SACjB5E,MAAOg3B,EAAQthC,EAAIshC,EAAQrhC,SAE/B,CACF,CA4BI0iC,CAA8BpuB,GAAO/D,QAAU,CAAC,KAElDwvB,IAAoB,EACtB,CAEA,SAASiC,GAAwBzxB,EAAS,CAAC,GACzC,MAAMvI,EAAQuI,EAAO7I,GAAK,EACpBsC,EAAQuG,EAAO7G,GAAK,EACpBf,EAAS4H,EAAO5H,QAAU,IAEhC,IAAK,IAAI5I,EAAI,EAAGA,EADF,GACaA,GAAK,EAAG,CACjC,MAAM+a,EAAQzO,KAAK4C,SAAW5C,KAAKC,GAAK,EAClCqK,EAAQ,IAAsB,IAAhBtK,KAAK4C,SACnBE,EAAM,GAAsB,IAAhB9C,KAAK4C,SACvB4wB,GAAUt+B,KAAK,CACboI,KAAM,QACNjC,EAAGM,EACH0B,EAAGM,EACHgF,GAAI3C,KAAKuO,IAAIE,GAASnE,EACtBzH,GAAI7C,KAAKwO,IAAIC,GAASnE,EACtBxH,MACAE,OAAQF,EACRxG,OAAQ,EAAoB,EAAhB0D,KAAK4C,SACjB5E,MAAOgC,KAAK4C,SAAW,IAAO,UAAY,WAE9C,CACAwxB,GAAe,CACb/4B,EAAGM,EACH0B,EAAGM,EACH22B,YAAsB,IAATh4B,EACbi4B,UAAoB,KAATj4B,EACX0B,MAAO,UACPw2B,UAAW,EACX1xB,IAAK,KAET,CAyDA,SAAS+yB,GAAgB3xB,EAAS,CAAC,GACjC,MAAMvI,EAAQuI,EAAO7I,GAAK,EACpBsC,EAAQuG,EAAO7G,GAAK,EACpBf,EAAS4H,EAAO5H,QAAU4H,EAAOoyB,WAAa,IAEpD,IAAK,IAAI5iC,EAAI,EAAGA,EADF,GACaA,GAAK,EAAG,CACjC,MAAM+a,EAAQzO,KAAK4C,SAAW5C,KAAKC,GAAK,EAClCqK,EAAQ,GAAqB,GAAhBtK,KAAK4C,SAClBD,EAAK3C,KAAKuO,IAAIE,GAASnE,EAAQ,GAC/BzH,GAAM,GAAqB,GAAhB7C,KAAK4C,SAChBE,EAAM,GAAsB,GAAhB9C,KAAK4C,SACvB4wB,GAAUt+B,KAAK,CACboI,KAAM,QACNjC,EAAGM,EAAQqE,KAAKuO,IAAIE,GAASnS,EAAS,GACtCe,EAAGM,EAAQqC,KAAKwO,IAAIC,GAASnS,EAAS,GACtCqG,KACAE,KACAC,MACAE,OAAQF,EACRxG,OAAQA,GAAU,IAAuB,IAAhB0D,KAAK4C,UAC9B5E,MAAO,WAEX,CACAo2B,GAAe,CACb/4B,EAAGM,EACH0B,EAAGM,EACH22B,YAAsB,GAATh4B,EACbi4B,UAAoB,IAATj4B,EACX0B,MAAO,UACPw2B,UAAW,EACX1xB,IAAK,IAET,CCzZA,MAAMyzB,GAAU,GAoEhB,SAASC,GAAcC,GACrB,MAAMC,EAvBR,WACE,MAAMA,EAAU,GACZr1B,GAAcmP,OAAS,GACzBkmB,EAAQxhC,KAAK,CACXhB,GAAImN,GAAcnN,GAClBmH,EAAGgG,GAAchG,EACjBgC,EAAGgE,GAAchE,EAA2B,GAAvBgE,GAAcxG,SAGvC,IAAK,MAAMga,KAAStT,GACdsT,EAAMrE,OAAS,GACjBkmB,EAAQxhC,KAAK,CACXhB,GAAI2gB,EAAM3gB,GACVmH,EAAGwZ,EAAMxZ,EACTgC,EAAGwX,EAAMxX,EAAmB,GAAfwX,EAAMha,OACnB87B,IAAK9hB,IAIX,OAAO6hB,CACT,CAGkBE,GAChB,IAAIC,EAAU,KACVC,EAAgBC,IACpB,IAAK,MAAM5+B,KAAUu+B,EAAS,CAC5B,MAAMM,EAAK7+B,EAAOkD,EAAIo7B,EAAOp7B,EACvB47B,EAAK9+B,EAAOkF,GAAKo5B,EAAOp5B,EAAoB,GAAhBo5B,EAAO57B,QACnCq8B,EAASF,EAAKA,EAAKC,EAAKA,EAC1BC,GAAUT,EAAO/sB,MAAQ+sB,EAAO/sB,OAASwtB,EAASJ,IACpDD,EAAU1+B,EACV2+B,EAAgBI,EAEpB,CACA,OAAOL,CACT,CAEA,SAASM,GAAWV,EAAQt+B,GAC1B,MAAM26B,EAAU2D,EAAOp7B,EACjB03B,EAAU0D,EAAOp5B,EAAoB,IAAhBo5B,EAAO57B,OAC5Bm8B,EAAK7+B,EAAOkD,EAAIy3B,EAChBmE,EAAK9+B,EAAOkF,EAAI01B,EACtB0D,EAAO74B,OAASoC,KAAKo3B,KAAKJ,IAAOP,EAAO74B,OACxC,MAAMy5B,EAAWr3B,KAAKs3B,MAAMN,EAAIC,IAAO,EACjC3sB,EAAQmsB,EAAOpsB,WAAWC,MAC1B3H,EAAMq0B,EAAKK,EAAY/sB,EAE7BitB,GAAgB,CACdl8B,EAAGy3B,EACHz1B,EAAG01B,EACHpwB,KACAE,GALUo0B,EAAKI,EAAY/sB,EAM3BhO,OAAQm6B,EAAOpsB,WAAW/N,OAC1BiO,SAAUksB,EAAOpsB,WAAWE,SAC5BvM,MAAOy4B,EAAOpsB,WAAWrM,MACzB4L,OAAQ6sB,EAAOpsB,WAAWT,OAC1BC,UAAW4sB,EAAOpsB,WAAWR,UAC7BjM,OAAQoC,KAAKo3B,KAAKz0B,IAAO,EACzB6H,cAAe,IAEjBisB,EAAOe,UAAYf,EAAOxsB,YAC5B,CC7GA,MAAMwtB,GAAe,CACnB9vB,QAAQ,EACR+vB,aAAc,EACd5qB,UAAW,EACXpI,QAAS,EACTsK,QAAS,EACTxC,SAAU,EACVmrB,YAAY,EACZxT,SAAU,EACVnmB,MAAO,UACPgP,YAAa,IACbC,UAAW,KAwEb,SAAS2qB,KACPH,GAAa9vB,QAAS,EACtB8vB,GAAaE,YAAa,EAC1BF,GAAaC,aAAe,EAC5BD,GAAa3qB,UAAY,CAC3B,CCzFA,MAAM+qB,GAAc,CAClBlwB,QAAQ,EACRyF,SAAU,EACV0qB,YAAa,EACbtrB,SAAU,EACVurB,YAAa,EACbz7B,OAAQ,GACR0B,MAAO,UACPiT,WAAY,GAGd,SAAS+mB,KACP,MAAMxiB,EAAwD,GAA1CpD,GAASQ,aAAanF,YAAc,KAAW2E,GAASQ,aAAalF,YAAc,KAAO0E,GAASQ,aAAajF,WAAa,IACjJ,MAAO,CACLtS,EAAG+W,GAAS/W,EACZgC,EAAG+U,GAAS/U,EAAiB,GAAbmY,EAEpB,CAEA,SAASyiB,GAAoB36B,EAAM4G,EAAS,CAAC,GACrB,oBAAX5L,QAGXA,OAAO0L,cAAc,IAAIC,YAAY3G,EAAM,CAAE4G,WAC/C,CAuCA,SAASg0B,GAAiBC,EAAS,WACjC,IAAKN,GAAYlwB,OACf,OAEF,MAAMzD,EAAS,CACbi0B,SACAC,kBAAmBP,GAAYzqB,SAC/B0qB,YAAaD,GAAYC,YACzBtrB,SAAUqrB,GAAYrrB,SACtBurB,YAAaF,GAAYE,YACzBzC,OAAQ0C,KACR17B,OAAQu7B,GAAYv7B,QAEtBu7B,GAAYlwB,QAAS,EACrBkwB,GAAYzqB,SAAW,EACvByqB,GAAYrrB,SAAW,EACvBqrB,GAAY5mB,WAAa,EACzBgnB,GAAoB,aAAc/zB,EACpC,CChFA,SAASm0B,GAAavf,GACpB,MAAMwf,EAAexf,GAAQvM,OAC7B,IAAK+rB,EACH,OAAO,EAGT,IADiBlmB,GAASqB,gBAAkB,GAC7B,EACb,OAAO,EAIT,OADa6kB,EAAah7B,MAAQ,UAEhC,IAAK,SAGH,OHsBN,SAAsB2nB,GACpB,MACMwR,EApCR,SAAsBxR,EAAQrnB,GAC5B,MAAM/C,EAASoqB,EAAOpqB,QAAU,GAC1B6R,EAAcuY,EAAOvY,aAAe,CAAErR,EAAG,GAAIgC,EAAG,GAChDk7B,EAAarpB,GAAekD,GAASQ,aAAe,OAAS,EAC7D9N,EAAW,KACXuK,EAAS,GAAM+C,GAAS/W,EAAIuC,GAAU8O,EAAYrR,GAAK,IAAK,GAAIyJ,EAAW,IAC3E0zB,EAAapmB,GAAS/U,EAAIk7B,EAC1B9oB,EAASzP,KAAK+E,IAAIyzB,GAAc9rB,EAAYrP,GAAK,GAAIzC,GACrDyC,EAAI2C,KAAK+E,IAAInK,EAAWC,EAAQ4U,EAAS5U,GAE/C,MAAO,CACL3G,GAAI,UAAUyU,KAAKD,SAAS1I,KAAK4C,SAAStM,SAAS,IAAI0Z,MAAM,EAAG,KAChE3U,EAAGgU,EACHhS,IACAxC,SACA+C,SACA8L,MAAOub,EAAOvb,OAAS,IACvBO,aAAcjK,KAAKmC,IAAI,GAAK8iB,EAAOhb,cAAgB,IACnDutB,UAAW,GACXhrB,SAAUyY,EAAOzY,UAAY,EAC7BurB,YAAa9S,EAAOzY,UAAY,EAChCnC,WAAY,CACVC,MAAO2a,EAAO5a,YAAYC,OAAS,IACnChO,OAAQ2oB,EAAO5a,YAAY/N,QAAU,EACrCsN,OAAQqb,EAAO5a,YAAYT,QAAU,GACrCC,UAAWob,EAAO5a,YAAYR,WAAa,GAC3CU,SAAU0a,EAAO5a,YAAYE,UAAY,IACzCvM,MAAOinB,EAAO5a,YAAYrM,OAAS,WAErC2O,UAAWsY,EAAOtY,WAAa,UAC/BC,UAAWqY,EAAOrY,WAAa,UAEnC,CAIiB6rB,CAAaxT,EADb7S,GAASxU,QAAU,GAE5B6O,EAAYzM,KAAKmC,IAAI,EAAG8iB,EAAOxY,WAAa,GAC9C8pB,GAAQ5iC,QAAU8Y,GACpB8pB,GAAQmC,QAEVnC,GAAQrhC,KAAKuhC,EACf,CGhCMkC,CAAaL,GACblmB,GAASqB,eAAiB6kB,EAAa9sB,iBAAmB,KACnD,EACT,IAAK,UACH,QFFAisB,GAAa9vB,SAGZyK,GAASqB,gBAAkB,GAAK,IAMvC,SAAsBwR,GACpB,MAAMngB,EAAW,KACX8zB,EAAY3T,EAAO4T,OAAS,CAAE1zB,KAAM,GAAIE,MAAOP,EAAW,IAC1Dg0B,EAAO7T,EAAO6T,MAAQ,CAAEz7B,EAAGzC,EAAW,KACtCm+B,EAAe9T,EAAOnY,WAAa,IACnClP,EAASwU,GAASxU,QAAU,EAC5BkR,EAAU,GAAMsD,GAAS/W,EAAIuC,EAASm7B,EAAcH,EAAUzzB,KAAMyzB,EAAUvzB,OAC9E0J,EAAU/O,KAAK+E,IAAI+zB,EAAKz7B,GAAMzC,EAAW,IAAMwX,GAAS/U,GAAK4nB,EAAOlY,SAAW,MAErF0qB,GAAa9vB,QAAS,EACtB8vB,GAAaE,YAAa,EAC1BF,GAAaC,aAAe,EAC5BD,GAAa3qB,UAAY9M,KAAKs3B,MAAMxoB,EAAUsD,GAAS/W,EAAG0T,EAAUqD,GAAS/U,GAC7Eo6B,GAAa/yB,QAAUoK,EACvB2oB,GAAazoB,QAAUD,EACvB0oB,GAAajrB,SAAWyY,EAAOzY,UAAY,IAC3CirB,GAAatT,SAAWc,EAAOzZ,iBAAmB,IAClDisB,GAAaz5B,MAAQinB,EAAOjnB,OAAS,UACrCy5B,GAAazqB,YAAciY,EAAOjY,aAAe,IACjDyqB,GAAaxqB,UAAYgY,EAAOhY,WAAa,IAC7CmF,GAASqB,eAAiBgkB,GAAatT,QACzC,CEzBM6U,CAAaV,GACN,IACT,IAAK,SAEH,ODCN,SAAwBrT,EAAS,CAAC,GAChC,MAAM7X,EAAW6X,EAAO7X,UAAY,IAChCyqB,GAAYlwB,SAGhBkwB,GAAYlwB,QAAS,EACrBkwB,GAAYzqB,SAAWA,EACvByqB,GAAYC,YAAc1qB,EAC1ByqB,GAAYrrB,SAAWyY,EAAOzY,UAAY,EAC1CqrB,GAAYE,YAAcF,GAAYrrB,SACtCqrB,GAAYv7B,OAAS2oB,EAAO3oB,QAAU,GACtCu7B,GAAY75B,MAAQinB,EAAOjnB,OAAS,UACpC65B,GAAY5mB,WAAa,EACzBmB,GAASqB,eAAiBwR,EAAOzZ,iBAAmB,IAEtD,CCjBMytB,CAAeX,IACR,EACT,QACE,OAAO,EAEb,CChBA,SAASY,GAAa9kC,EAAON,EAAU,CAAC,GACtC,MAAM6b,EAAa7b,EAAQ8b,SAAW,UAChCC,EAAc/b,EAAQ+b,aAA8B,aAAfF,EACrCwpB,EjBmRC5Y,GAAaG,ciB/Qd0Y,GAHiBD,GAAYv9B,MAAMC,QAAQs9B,EAASr9B,SAAWq9B,EAASr9B,OAAOnI,QAAU,KAAOwlC,EAASvpB,SAAWupB,EAASvpB,UAAYD,GAC3IwpB,EAASr9B,OACT,OAlBN,WACE,MAAMgJ,EAAW,KACXwK,EAAgB3L,KAChB7H,EAASF,MAAMC,QAAQyT,GAAe/N,SAAW+N,EAAc/N,QAAQyO,MAAM,EAAG,GAAK,GAC3F,OAAIlU,EAAOnI,QAAU,EACZmI,EAIF,CAFiB,IAAXgJ,EACY,IAAXA,EAEhB,CASwCu0B,GAChC5sB,EAAYzM,KAAK+E,IAAIq0B,EAAYzlC,OCvB7B,GDwBV,IAAI2lC,EAAU,EAEd,IAAK,IAAIC,EAAY,EAAGA,EAAYH,EAAYzlC,UAC1C2lC,GAAWllC,GAASmN,GAAQ5N,QC3BxB,GD0B8C4lC,GAAa,EAAG,CAItE,GAAmB,aAAf5pB,EAA2B,CAC7B,MAAM6pB,EAAWj4B,GAAQk4B,KACtB5kB,GAAiC,aAAvBA,EAAMpD,cAA+BoD,EAAM/E,YAAcypB,GAAa1kB,EAAMrE,OAAS,GAElG,GAAIgpB,EACF,QAEJ,CACA,MAAMnqB,EAAS+pB,EAAYG,GACrB1kB,EAAQzF,GAAiBC,EAAQ,CACrCO,QAASD,EACTE,cACAC,UAAWypB,EACX37B,OAAsB,IAAd27B,EAAkB,GAAK,IAOjC,GALA1kB,EAAMxF,OAASA,EACfwF,EAAMpF,OAASoF,EAAMxX,EACrBwX,EAAMxD,aAAe,EACrB9P,GAAQrM,KAAK2f,GACbykB,GAAW,EACPA,GAAW7sB,EACb,KAEJ,CACF,CEpCA,MAAMitB,GAAmB,WAazB,SAASC,KACP,IAAK,IAAIjmC,EAAI6N,GAAQ5N,OAAS,EAAGD,GAAK,EAAGA,GAAK,EACxC6N,GAAQ7N,GAAG+d,eAAiBioB,IAC9Bn4B,GAAQtM,OAAOvB,EAAG,EAGxB,CAUA,SAASkmC,GAAepH,GAAS,MAAElB,EAAQ,WAAU,MAAEC,EAAQ,GAAM,CAAC,GVwBpEF,GAAc1pB,OAASuf,QUvBL,OAClB+K,GAAiBX,EAAOC,GACxBgB,GAAuBC,GACvBL,GAAwB,GACxBwH,KACAtkB,IACF,CAEA,SAASwkB,GAAqBhlB,EAAOyO,GACnC,MAAMtS,EAAY6D,EAAM7D,WAAa,CAAC,EAChC4b,EAAa5b,EAAUP,WAAaoE,EAAMpE,WAAa,IACvDqpB,EAAa9oB,EAAUH,cAAgBgE,EAAMhE,cAAgB,GAC7DkpB,EAAW/oB,EAAUT,WAAasE,EAAMtE,WAAa,IAErDypB,EAAYh6B,KAAKmC,IAAI,EAAGmhB,EAAO,GAC/B2W,EAAmB,EXzDA,GWyDID,EACvBE,EAAmB,EXzDA,IWyDIF,EACvBG,EAAkB,EXzDA,IWyDIH,EAE5BnlB,EAAMpE,UAAYzQ,KAAKyC,MAAMmqB,EAAaqN,GAC1CplB,EAAMrE,OAASqE,EAAMpE,UACrBoE,EAAMhE,aAAe7Q,KAAKyC,MAAMq3B,EAAaI,GAC7CrlB,EAAMtE,UAAYwpB,EAAWI,EAC7BtlB,EAAM/D,gBAAkB9Q,KAAKyC,MAAMoS,EAAM/D,iBAAmB,EAAgB,IAAZkpB,IAChEnlB,EAAMulB,aAAe9W,CACvB,CAEA,SAAS+W,GAAqBC,EAAWhX,GACvC,GAAIgX,GAAa,EACf,OAEF,MAAMC,EAAc,IAAIl3B,IACtB9B,GAAQqT,OAAQC,GAAUA,EAAMpD,eAAiBioB,IAAkBljC,IAAKqe,GAAUA,EAAM3gB,KAE1FglC,GAAaoB,EAAW,CAAE1qB,QAAS8pB,GAAkB7pB,aAAa,IAClE,IAAK,MAAMgF,KAAStT,GACdsT,EAAMpD,eAAiBioB,IAAoBa,EAAYtlB,IAAIJ,EAAM3gB,KAGrE2lC,GAAqBhlB,EAAOyO,EAEhC,CAwBA,SAASkX,GAAehf,GACtB,MAAMtL,EAAQuiB,KAWd,GATIltB,GAAM2B,yBACR3B,GAAM2B,wBAAyB,EAC3BgJ,EAAMvI,OACRiyB,GAAe,YA/EnBxkB,KACAukB,KArBF,WACE,MAAMc,EAAUz6B,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI,EXnBhB,KWoBf21B,EAAe16B,KAAKyC,MAAM2P,GAAS3B,WAAagqB,GAAW,IACjEroB,GAAS5B,OAASxQ,KAAKmC,IAAIiQ,GAAS5B,OAAQkqB,GACxCtoB,GAAS5B,QAAU,IACrB4B,GAAS5B,OAASxQ,KAAKmC,IAAI,EAAGu4B,GAAgBtoB,GAAS3B,YAEzD2B,GAASmB,UAAY,EACrBnB,GAAShB,gBAAkBpR,KAAKmC,IAAIiQ,GAAShB,gBAAiB,GAChE,CAaEupB,GVmBAtJ,GAAc1pB,QAAS,EACvB0pB,GAAc/N,KAAO,EACrB+N,GAAcI,WAAa,EAC3BJ,GAAcK,MAAQ,EACtBL,GAAcM,UAAY,EAC1BN,GAAcO,YAAc,KAC5BK,GAAiB,YDpEE,GW6CnBM,GAAuB,SAiFlBriB,EAAMvI,QAA0B,WAAhBuI,EAAMohB,MAKzB,OAJAY,GAAiBlyB,KAAKmC,IAAI,EAAG+N,EAAMqhB,MAAQ/V,SACvCtL,EAAMqhB,OAAS,GACjBU,GAAiB,WAAY,IAKjC,IAAK/hB,EAAMvI,OACT,OAGFuqB,GAAiBlyB,KAAKmC,IAAI,EAAG+N,EAAMqhB,MAAQ/V,IAE3C,IAAK,IAAI9nB,EAAI6N,GAAQ5N,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CAC/C,MAAMmhB,EAAQtT,GAAQ7N,GAClBmhB,EAAMpD,eAAiBioB,IAAoB7kB,EAAMrE,QAAU,IAA2B,IAAtBqE,EAAMhF,aACxEtO,GAAQtM,OAAOvB,EAAG,EAEtB,CAEA,MAAMknC,EAAQr5B,GAAQwb,OACpB,CAAC3oB,EAAOygB,IAAUzgB,GAASygB,EAAMpD,eAAiBioB,IAAoB7kB,EAAMrE,OAAS,EAAI,EAAI,GAC7F,GAIF,GAFA2hB,GAAwByI,GAEpBxoB,GAAS5B,QAAU,EA1CvBopB,GAAe,SAAU,CAAEtI,MAAO,SAAUC,MAD/BvxB,KAAKmC,IAAI,EX5GN,UW4JhB,OAAQ+N,EAAMohB,OACZ,IAAK,YACH,GAAIphB,EAAMqhB,OAAS,EAAG,EVhF5B,WACEF,GAAc/N,MAAQ,EACN+N,GAAc/N,KAAO+N,GAAcH,WAEjDG,GAAcH,SAAWG,GAAc/N,KACvC2N,GAAwBC,SAAWlxB,KAAKmC,IAAI8uB,GAAwBC,SAAUG,GAAcH,UAGhG,CUyEQ2J,GACA,MAAMC,EX9JC,EACG,GW6JuC5qB,EAAMoT,KAAO,GACxDyX,EX7JF,EW+JJV,GADgBr6B,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI+1B,EAASC,IAChB7qB,EAAMoT,MACpC2O,GAAiB,OAAQ,EAC3B,CACA,MAEF,IAAK,OACH,GAAc,IAAV2I,EAAa,CACf,MAAMvI,EXlKA,GACK,IWiKoCniB,EAAMoT,KAAO,IAhFpE,SAA0BA,EAAM+O,GAC1BA,EAAS,GACXhwB,GAAagwB,GACbD,GAAsBC,IAEtBD,GAAsB,GAIRK,KACJvB,WAAa5N,IACrBjhB,GX3FW,IW4FXiwB,GX5FW,IW+FjB,CAkEQ0I,CAAiB9qB,EAAMoT,KAAM+O,GAC7BJ,GAAiB,OX7KT,GW8KV,KAAO,CACL,MAAM6I,EX5KC,EACG,GW2KuC5qB,EAAMoT,KAAO,GACxDyX,EX3KF,EW4KEE,EAAUj7B,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI+1B,EAASC,GAAOH,GACjDK,EAAU,GACZZ,GAAqBY,EAAS/qB,EAAMoT,KAExC,CACA,MAEF,IAAK,OACCpT,EAAMqhB,OAAS,GACjBU,GAAiB,YX3LJ,GWkMrB,CAoBA,SAASiJ,KACPtB,GAAe,SACf/H,GAAmB,CAAEC,eAAe,GACtC,CC1NA,MAAMqJ,GAAoB,CACxBC,iBAAkB,EAClBC,oBAAqB,EACrBC,oBAAqB,EACrBC,qBAAsB,EACtBC,cAAe,KAGXC,GAAoB,CACxB,CACEvnC,GAAI,iBACJmM,KAAM,iBACN+D,cAAe,cACf+E,YAAa,+DACbuyB,SAAU,4EACVC,UAAW,CACTr+B,KAAM,YACN6Q,MAAO,2BACPhW,OAAQ,GAEVgJ,MAAO,CACLy6B,UAAW,EACXC,eAAgB,IAChBhsB,aAAa,GAEfisB,QAAS,CACPj6B,UAAW,IAEbk6B,eAAgB,2CAChBC,eAAgB,iDAElB,CACE9nC,GAAI,kBACJmM,KAAM,iBACN+D,cAAe,eACf+E,YAAa,8DACbuyB,SAAU,mEACVC,UAAW,CACTr+B,KAAM,UACN6Q,MAAO,mCACP3B,SAAU,IAEZrL,MAAO,CACLy6B,UAAW,EACXC,eAAgB,IAChBhsB,aAAa,GAEfisB,QAAS,CACPj6B,UAAW,IAEbk6B,eAAgB,gDAChBC,eAAgB,wEAElB,CACE9nC,GAAI,oBACJmM,KAAM,oBACN+D,cAAe,eACf+E,YAAa,wFACbuyB,SAAU,6EACVC,UAAW,CACTr+B,KAAM,YACN6Q,MAAO,yBACPhW,OAAQ,GAEVgJ,MAAO,CACLy6B,UAAW,EACXC,eAAgB,IAChBhsB,aAAa,GAEfisB,QAAS,CACPj6B,UAAW,KAEbk6B,eAAgB,8CAChBC,eAAgB,yDCnDdC,GAAgB,CACpBt0B,QAAQ,EACR2pB,MAAO,WACP4K,cAAe,EACfC,UAAW,KACXC,kBAAmB,EACnBC,cAAeZ,GAAkB9nC,OACjCknB,QAAS,GACTyhB,WAAY,EACZX,UA5BO,CACLr+B,KAAM,OACN6Q,MAAO,GACPhW,OAAQ,EACRokC,SAAU,EACV/vB,SAAU,EACVgwB,UAAW,GAuBbr7B,MAlBO,CACLy6B,UAAW,EACXC,eAAgB,EAChBhsB,aAAa,EACbsU,SAAU,GAeZ2X,QAAS,CAAC,EACVC,eAAgB,oBAChBC,eAAgB,kBAChBN,SAAU,GACVt3B,cAAe,KACfwtB,YAAa,MAqBf,SAAS6K,KACP,OAAOR,EACT,CAEA,SAASS,GAA6BhnC,EAAQumC,GAAcC,cAC1D,OAAIxmC,EAAQ,GAAKA,GAAS+lC,GAAkB9nC,OACnC,KAEF8nC,GAAkB/lC,EAC3B,CAEA,SAASinC,KACP,OAAOlB,EACT,CAEA,SAASmB,GAAkBj1B,GACzBs0B,GAAct0B,OAASuf,QAAQvf,EACjC,CAEA,SAASk1B,GAAiBvL,EAAOC,EAAQ,GACvC0K,GAAc3K,MAAQA,EACtB2K,GAAcK,WAAat8B,KAAKmC,IAAI,EAAGovB,GAAS,EAClD,CAyCA,SAASuL,GAAmBjiB,GAC1BohB,GAAcphB,QAAUA,GAAW,EACrC,CAiBA,SAASkiB,GAAoB7hC,GAC3B+gC,GAAcN,UAAUY,SAAWv8B,KAAKmC,IAAI,EAAGjH,GAAS,EAC1D,CAcA,SAAS8hC,GAAyB9hC,GAChC+gC,GAAc96B,MAAMgjB,SAAWnkB,KAAKmC,IAAI,EAAGjH,GAAS,EACtD,CAMA,SAAS+hC,GAAuBzK,GAC9ByJ,GAAcrK,YAAcY,GAAW,IACzC,CAOA,SAAS0K,KACP,OAAO/B,EACT,CCpJA,MAAMgC,GAAmB,WAEzB,SAASC,KACP,IAAK,IAAI1pC,EAAI6N,GAAQ5N,OAAS,EAAGD,GAAK,EAAGA,GAAK,EACxC6N,GAAQ7N,GAAG+d,eAAiB0rB,IAC9B57B,GAAQtM,OAAOvB,EAAG,EAGxB,CAoBA,SAAS2pC,KACP,MAAMntB,EAAQusB,KACd,GAAoB,WAAhBvsB,EAAMohB,MACR,OAGF,IADgBoL,KAEd,OAEF,MAAMptB,EAAgBY,EAAM/O,OAAS,CAAC,EAChCy6B,EAAY57B,KAAKmC,IAAI,EAAGmN,EAAcssB,WAAa,GACzD,GAAIA,GAAa,EACf,OAEF,IAAKtsB,EAAc6U,UAAY,GAAK,EAClC,OAEF,MAAMyW,EAAQr5B,GAAQwb,OAAO,CAAC3oB,EAAOygB,IAC/BA,EAAMpD,eAAiB0rB,IAAoBtoB,EAAMrE,OAAS,EACrDpc,EAAQ,EAEVA,EACN,GACH,GAAIwmC,GAASgB,EACX,OAEF,IAAI0B,EAAiB1B,EAAYhB,EACjC,GAA6B,cAAzB1qB,EAAMyrB,UAAUr+B,KAAsB,CACxC,MAAMigC,EAAiBv9B,KAAKmC,IAAI,EAAG+N,EAAMyrB,UAAUxjC,OAAS+X,EAAMyrB,UAAUY,UAC5E,GAAIgB,GAAkB,EACpB,OAEFD,EAAiBt9B,KAAK+E,IAAIu4B,EAAgBC,EAC5C,CACA,GAAID,GAAkB,EACpB,OAEFpE,GAAaoE,EAAgB,CAC3B1tB,QAASutB,GACTttB,YAAaqX,QAAQ5X,EAAcO,eAErC,MAAM2tB,EAAQluB,EAAcusB,gBAAkB,EAC9CmB,GAAyBQ,EAAQ,EAAIA,EAAQ,IAC/C,CAeA,SAASC,GAAmBC,EAAkB,yBAC5C,MAAMxtB,EAAQusB,KACdI,GAAiB,SAAU,GAE3BC,GADc5sB,EAAMyrB,UAAUxtB,OAASuvB,GDqCvCzB,GAAcN,UAAUa,UAAYx8B,KAAKmC,IAAI,EAAG85B,GAAcN,UAAUnvB,UAAY,GClCpFuwB,GAAoB,GACpBC,GAAyB,GACzBK,IACF,CAEA,SAASM,GAAajoC,GACpB,MAAMkoC,EDnCR,SAAkCloC,GAChC,MAAMkoC,EAAUlB,GAA6BhnC,GAC7C,OAAKkoC,GAGL3B,GAAcC,aAAexmC,EAC7BumC,GAAcE,UAAYyB,EAAQ1pC,GAClC+nC,GAAc73B,cAAgBw5B,EAAQx5B,eAAiB,KACvD63B,GAAcN,UAAY,CACxBr+B,KAAMsgC,EAAQjC,WAAWr+B,MAAQ,OACjC6Q,MAAOyvB,EAAQjC,WAAWxtB,OAAS,GACnChW,OAAQ6H,KAAKmC,IAAI,EAAGnC,KAAKoC,MAAMw7B,EAAQjC,WAAWxjC,QAAUylC,EAAQjC,WAAWnvB,UAAY,IAC3F+vB,SAAU,EACV/vB,SAAUxM,KAAKmC,IAAI,EAAGy7B,EAAQjC,WAAWnvB,UAAY,GACrDgwB,UAAWx8B,KAAKmC,IAAI,EAAGy7B,EAAQjC,WAAWnvB,UAAY,IAExDyvB,GAAc96B,MAAQ,CACpBy6B,UAAW57B,KAAKmC,IAAI,EAAGnC,KAAKoC,MAAMw7B,EAAQz8B,OAAOy6B,WAAa,IAC9DC,eAAgB77B,KAAKmC,IAAI,EAAGy7B,EAAQz8B,OAAO06B,gBAAkB,GAC7DhsB,YAAaqX,QAAQ0W,EAAQz8B,OAAO0O,aACpCsU,SAAU,GAEZ8X,GAAcH,QAAU8B,EAAQ9B,SAAW,CAAC,EAC5CG,GAAcF,eAAiB6B,EAAQ7B,gBAAkB,oBACzDE,GAAcD,eAAiB4B,EAAQ5B,gBAAkB,kBACzDC,GAAcP,SAAWkC,EAAQlC,UAAYkC,EAAQz0B,aAAe,GACpE8yB,GAAcphB,QAAUohB,GAAcP,SACtCO,GAAcrK,YAAc,KACrBgM,GAzBE,IA0BX,CCMkBC,CAAyBnoC,GACzC,IAAKkoC,EAEH,OADAE,MACO,EAET,MAAMC,EAAWb,KA7FnB,IAAiC94B,EA8F/Bg5B,KACAhoB,MA/F+BhR,EAgGPw5B,EAAQx5B,gBA9FdD,GAAeC,IvCqGjCR,KuCNAwR,KACA,MAAMgmB,EAAmBwC,EAAQxC,kBAAoB2C,EAAS3C,kBAAoB,EAQlF,OAPIA,EAAmB,IAAMwC,EAAQlC,UAAY,IAAI9b,OAAOjsB,OAAS,GACnEkpC,GAAiB,WAAYzB,GAC7B0B,GAAmB,GAAGc,EAAQlC,uCAE9B+B,GAAmBG,EAAQjC,WAAWxtB,OAAS,qBAEjD8uB,GAAuB,OAChB,CACT,CAkBA,SAASe,KACP,MACMjd,EADQ0b,KACUP,aAAe,EAEnCnb,GADa4b,KACShpC,OACxBmqC,IAAiB,GAGnBH,GAAa5c,EACf,CAEA,SAAS+c,GAAiBG,GAAU,GAClC,MAAM/tB,EAAQusB,KACTvsB,EAAMvI,QAA0B,aAAhBuI,EAAMohB,OAI3B8L,KACA/nB,KACI4oB,GACFhB,GAAuB,YACvBH,GAAmB,qDAEnBG,GAAuB,WACvBH,GAAmB,kDAErBD,GAAiB,WAAY,GAC7BD,IAAkB,IAbhBvnB,IAcJ,CAEA,SAAS6oB,KACP,MAAMhuB,EAAQusB,KACd,GAAoB,WAAhBvsB,EAAMohB,MACR,OAEF,MAAMsM,EAAUlB,KACVqB,EAAWb,KACjBE,KAvJF,SAA6BtB,EAAU,CAAC,GACtC,MAAMj6B,EAAY7B,KAAKmC,IAAI,EAAGnC,KAAKoC,MAAM05B,EAAQj6B,WAAa,IAC1DA,EAAY,GACdQ,GAAaR,EAEjB,CAmJEs8B,CAAoBjuB,EAAM4rB,SDhC5B,SAA8B5gC,GAC5B,MAAMkjC,EAAYp+B,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI02B,GAAkB9nC,OAAQqM,KAAKoC,MAAMlH,GAAS,KACrF+gC,GAAcG,kBAAoBp8B,KAAKmC,IAAI85B,GAAcG,kBAAmBgC,EAC9E,CC8BEC,CAAqBnuB,EAAMgsB,aAAe,GAC1C,MAAMoC,EAAWV,GAASvC,qBAAuB0C,EAAS1C,qBAAuB,EAEjFyB,GAAmB,GADI5sB,EAAM6rB,gBAAkB,6CAE/Cc,GAAiB,UAAWyB,GAC5BrB,GAAuB,UACzB,CAmBA,SAASsB,KACP,GAAKh5B,GAAM8B,sBAKX,OAFA9B,GAAM8B,uBAAwB,EAChBo1B,KACAnL,OACZ,IAAK,WAeL,IAAK,WAGL,SAzGJ,SAAuBkN,EAAa,GAClCtD,KD1GAe,GAAct0B,QAAS,EACvBs0B,GAAc3K,MAAQ,WACtB2K,GAAcC,cAAgB,EAC9BD,GAAcE,UAAY,KAC1BF,GAAcG,kBAAoB,EAClCH,GAAcphB,QAAU,GACxBohB,GAAcK,WAAa,EAC3BL,GAAcN,UA9CP,CACLr+B,KAAM,OACN6Q,MAAO,GACPhW,OAAQ,EACRokC,SAAU,EACV/vB,SAAU,EACVgwB,UAAW,GAyCbP,GAAc96B,MApCP,CACLy6B,UAAW,EACXC,eAAgB,EAChBhsB,aAAa,EACbsU,SAAU,GAiCZ8X,GAAcH,QAAU,CAAC,EACzBG,GAAcF,eAAiB,oBAC/BE,GAAcD,eAAiB,kBAC/BC,GAAcP,SAAW,GACzBO,GAAc73B,cAAgB,KAC9B63B,GAAcrK,YAAc,KC8F5BgL,IAAkB,GAClB,MAAM6B,EAAW9B,KAEVgB,GADc39B,KAAK+E,IAAI/E,KAAKmC,IAAI,EAAGq8B,GAAax+B,KAAKmC,IAAI,EAAGs8B,EAAS9qC,OAAS,IAEvF,CAmGM+qC,CAAc,GACd,MAjBF,IAAK,WACHjB,KACA,MACF,IAAK,SAEH,MACF,IAAK,UACHO,KACA,MACF,IAAK,WA1FT,WACE,MAAM9tB,EAAQusB,KACR/mC,EAAQwa,EAAMgsB,cAAgB,EAAIhsB,EAAMgsB,aAAe,EAC7DU,IAAkB,GACXe,GAAajoC,EACtB,CAsFMipC,GASN,CCvPA,MAAMC,GAAkB,kBAelBC,GAAe,CACnBl3B,QAAQ,EACRm3B,gBAAgB,EAChBC,QAAQ,EACRC,UAAW,EACX1b,KAAM,EACNoO,MAAO,EACPR,SAAU,EACVC,UAAW,EACX8N,iBAAkB,EAClBC,QAAS,EACTC,cAAe,KACf3N,aAAc,EACdI,YAAa,KACbwN,kBAAmB,KACnBC,mBAAoB,KACpBC,kBAAmB,MAGrB,SAASC,KACP,IAAK,IAAI7rC,EAAI6N,GAAQ5N,OAAS,EAAGD,GAAK,EAAGA,GAAK,EACxC6N,GAAQ7N,GAAG+d,eAAiBmtB,IAC9Br9B,GAAQtM,OAAOvB,EAAG,EAGxB,CAEA,SAAS8rC,GAAoBC,GAAQ,GACnC,MAAMr9B,EAxCS,KA4Cf,MAAMqV,EAAUzV,MACZy9B,GAAShoB,EAAUrV,IACrBH,GAAiBjC,KAAKmC,IAAIsV,EAASrV,GAEvC,CAEA,SAASs9B,KACP,GAAIb,GAAaC,eACf,OAEF,MAAMa,EAAa5lC,OAAOoJ,KAAK,IACzBy8B,EAAcD,EAAW/oB,SAASxE,GAASwB,kBAC7CxB,GAASwB,iBACR+rB,EAAW/oB,SAAS,iBAAmB,gBAAkB+oB,EAAW,GACzErpB,GAAmBqpB,EAAY,CAAEnpB,QAASopB,IAC1C,IAAK,MAAM3oB,KAAY0oB,EACrB7nB,GAAsBb,GAExB4nB,GAAaC,gBAAiB,CAChC,CAkBA,SAASe,GAAqBhrB,EAAOyO,GACnC,MAAMnvB,EAAO0gB,EAAM7D,WAAa,CAAC,EAC3B4b,EAAaz4B,EAAKsc,WAAaoE,EAAMpE,WAAa,IAClDqpB,EAAa3lC,EAAK0c,cAAgBgE,EAAMhE,cAAgB,GACxDulB,EAAYjiC,EAAKoc,WAAasE,EAAMtE,WAAa,IACjDypB,EAAYh6B,KAAKmC,IAAI,EAAGmhB,EAAO,GAE/B2W,EAAmB,EAjFA,IAiFID,EACvBE,EAAmB,EAjFA,IAiFIF,EACvBG,EAAkB,EAjFA,IAiFIH,EAE5BnlB,EAAMpE,UAAYzQ,KAAKyC,MAAMmqB,EAAaqN,GAC1CplB,EAAMrE,OAASqE,EAAMpE,UACrBoE,EAAMhE,aAAe7Q,KAAKyC,MAAMq3B,EAAaI,GAC7CrlB,EAAMtE,UAAY6lB,EAAY+D,CAChC,CA+EA,SAAS2F,GAA0BtN,EAAU,YACtCqM,GAAal3B,QAAWk3B,GAAaC,gBAI1CD,GAAa3N,SAAWlxB,KAAKmC,IAAI08B,GAAa3N,SAAU2N,GAAavb,MACrEub,GAAa1N,UAAYnxB,KAAKmC,IAAI08B,GAAa1N,UAAW0N,GAAanN,OACvEmN,GAAal3B,QAAS,EACtBk3B,GAAaE,QAAS,EACtBF,GAAaG,UAAY,EACzBH,GAAaM,cAAgB,KAC7BN,GAAajN,YAAcY,EAE3B+M,KACAlqB,KA5HF,WACE,MAAM+pB,EAAoBP,GAAaO,kBACjCC,EAAqBR,GAAaQ,mBACpCD,GAAqBA,EAAkBzrC,OAAS,EAClD2iB,GAAmB8oB,EAAmB,CAAE5oB,QAAS6oB,IjCbnD/oB,GAAmBjJ,GAAiB,CAAEmJ,QAASnJ,GAAgB,KiCiB/D0K,KACA,MAAMgoB,EAAmB1pB,KACzB,IAAK,MAAMY,KAAY8oB,EACrB/oB,GAAgBC,GAElB4nB,GAAaC,gBAAiB,CAChC,CA+GEkB,GAC8C,iBAAnCnB,GAAaS,mBACtBr9B,GAAiB48B,GAAaS,mBAEhCT,GAAaO,kBAAoB,KACjCP,GAAaQ,mBAAqB,KAClCR,GAAaS,kBAAoB,MAnB/BT,GAAajN,YAAcY,CAoB/B,CCrMA,SAASyN,GAAmBpZ,GAC1B,MAAMjd,EAASid,EAAIjd,QAAU,EACvBC,EAAYgd,EAAIhd,WAAa,EAEnCxI,GAAcmP,OAASxQ,KAAKmC,IAAI,EAAGd,GAAcmP,OAAS5G,GAC1DvI,GAAc4P,WAAa,IAC3B5P,GAAc6P,WAAalR,KAAK+E,IAAI,GAAK1D,GAAc6P,WAAa,KACpE7P,GAAc8P,eAAiBnR,KAAK+E,IAAI,GAAI1D,GAAc8P,eAAiBtH,EAAY,IAEvF,MAAMq2B,EAAS7+B,GAAchE,EAA2B,IAAvBgE,GAAcxG,OAAgBwG,GAAc/E,OAAS,GAGtF,GAFAi3B,GAAiBlyB,GAAchG,EAAG6kC,EAAQt2B,GAEtCA,EAAS,EAAG,CACd,MAAMu2B,EAAS9+B,GAAchE,EAA2B,IAAvBgE,GAAcxG,OAC/Co6B,GAAgB,CACd55B,EAAGgG,GAAchG,EACjBgC,EAAG8iC,EACHj+B,OAAQlC,KAAKyC,MAAM,EAAa,GAATmH,GACvBorB,QAAS,CAAC,UAAW,UAAW,WAChC1qB,MAAO,IAAkB,GAAZT,EACbM,OAAkB,GAAVnK,KAAKC,GACbwO,MAAiB,IAAVzO,KAAKC,GACZ3D,OAAQ,IAEZ,CAE6B,IAAzB+E,GAAcmP,QAAgBnP,GAAcgQ,cAAgB,IAC9DhQ,GAAcgQ,aAAe,IAEjC,CAGA,SAAS+uB,GAAmBvrB,EAAOgS,GACjC,GAAIhS,EAAMrE,QAAU,GAAKqE,EAAMzD,gBAAkB,EAC/C,OAGF,MAAMxH,EAASid,EAAIjd,QAAU,EACvBC,EAAYgd,EAAIhd,WAAa,EAC7BC,EAAS+c,EAAI/c,QAAU,EACvBlM,EAASipB,EAAIjpB,QAAUwU,GAASxU,OAYxC,GAVEiX,EAAMrE,OAASxQ,KAAKmC,IAAI,EAAG0S,EAAMrE,OAAS5G,GAC1CiL,EAAM5D,WAAa,IACnB4D,EAAM3D,WAAalR,KAAK+E,IAAI,GAAK8P,EAAM3D,WAAa,KACpD2D,EAAM1D,eAAiBnR,KAAK+E,IAAI,GAAI8P,EAAM1D,eAAiBtH,EAAY,IACvEgL,EAAMlS,IAAMkH,EAAYjM,EAAS,IAC7BkM,EAAS,IACX+K,EAAMhS,IAAe,GAATiH,GAIZF,EAAS,EAAG,CACd,MAAMy2B,EAAUxrB,EAAMxZ,EAA2B,IAAtBwZ,EAAMvY,QAAU,IAAYsB,EACjD0iC,EAAUzrB,EAAMxX,EAA4B,KAAvBwX,EAAMha,QAAU,KACrC4V,EAAYoE,EAAM7D,WAAWP,WAAaoE,EAAMpE,WAAa,IACnEgkB,GAAgB,CACdp5B,EAAGglC,EACHhjC,EAAGijC,EACH1iC,SACAgM,SACA8qB,UAAWjkB,EACXvO,OAAQlC,KAAKyC,MAAM,EAAIzC,KAAK+E,IAAI,GAAa,GAAT6E,IACpC7L,UAAW,GAAM6L,EAAS5J,KAAKmC,IAAI,EAAGsO,KAE1C,CAKA,GAHE8iB,GAAiB1e,EAAMxZ,EAAmB,GAAfwZ,EAAMjX,OAAaiX,EAAMxX,EAAI,GAAIuM,GAC5DiL,EAAMzD,gBAAkB,IAEL,IAAjByD,EAAMrE,SACRikB,GAAgB,CACdp5B,EAAGwZ,EAAMxZ,EACTgC,EAAGwX,EAAMxX,EAA4B,IAAvBwX,EAAMha,QAAU,KAC9B+C,SACAsE,OAAQlC,KAAKyC,MAAM,GAAKzC,KAAK+E,IAAI,GAAI6E,IACrC7L,UAAW,IACX6L,OAAiB,IAATA,EACR8qB,UAAW7f,EAAM7D,WAAWP,WAAaoE,EAAMpE,WAAa,MAExDoE,EAAMxD,cAAgB,GACxBuhB,GAAa,QAAS/d,EAAMxZ,EAAGwZ,EAAMxX,EAAGO,EAAQiX,EAAMlS,GAAIkS,EAAMhS,IAElEgS,EAAM3E,MAAQ,WACd2E,EAAMnE,eAAiB,IACvBmE,EAAMxD,aAAe,EFiPzB,SAAqCwD,GACnC,IAAKA,GAASA,EAAMpD,eAAiB0rB,GACnC,OAEF,MAAMjtB,EAAQusB,KACM,WAAhBvsB,EAAMohB,OAA+C,cAAzBphB,EAAMyrB,UAAUr+B,MDjNlD,SAAmC4E,EAAS,GAC1C+5B,GAAcN,UAAUY,SAAWv8B,KAAKmC,IAAI,EAAGnC,KAAK+E,IACjDk3B,GAAcN,UAAUxjC,QAAU8jC,GAAcN,UAAUnvB,UAAYjK,OAAOgV,kBAC9E0kB,GAAcN,UAAUY,SAAWr6B,GAEvC,CC+MEq+B,CAA0B,EAC5B,CEzPIC,CAA4B3rB,GDsJhC,SAA2BA,GACpBA,GAASA,EAAMpD,eAAiBmtB,IAGhCC,GAAal3B,SAGlBk3B,GAAanN,OAAS,EACtBmN,GAAa1N,UAAYnxB,KAAKmC,IAAI08B,GAAa1N,UAAW0N,GAAanN,OACzE,CC9JI+O,CAAkB5rB,GfiDbwc,GAAc1pB,QehDK,CACtB,MAAM+4B,EhBvFE,GC8Gd,SAAgCx+B,EAAS,IAClCK,OAAOC,SAASN,IAAWA,GAAU,IAG1CmvB,GAAcK,OAASxvB,EACvBmvB,GAAcF,UAAYnxB,KAAKmC,IAAIkvB,GAAcF,UAAWE,GAAcK,OAC1ET,GAAwBE,UAAYnxB,KAAKmC,IAAI8uB,GAAwBE,UAAWE,GAAcF,WAChG,Ce7BMwP,CAAuB,GACnBD,EAAa,IACfpO,GAA2BoO,GAC3Br+B,GAAaq+B,GAEjB,CAEJ,CAEA,SAASE,GAAoB/rB,EAAOgS,GAClC,GAAIzU,GAAShB,gBAAkB,GAAKgB,GAAS5B,QAAU,EACrD,OAGF,MAAMspB,EAAajT,GAAKjd,QAAUiL,EAAMhE,cAAgB,EAClDgwB,EAAgBha,GAAKhd,WAAagL,EAAM/D,iBAAmB,EAC3DgwB,EAAaja,GAAK/c,QAAU+K,EAAM9D,cAAgB,EAClDnT,EAASipB,GAAKjpB,QAAUiX,EAAMjX,QAAU,EAE9C,IAAImjC,ETlCN,SAAyBla,GACvB,IAAKgR,GAAYlwB,OACf,OAAOkf,EAET,MAAMjd,EAASid,EAAIjd,QAAU,EAC7B,GAAIA,GAAU,EACZ,OAAOid,EAET,MAAMma,EAAShhC,KAAK+E,IAAI6E,EAAQiuB,GAAYzqB,UAC5CyqB,GAAYzqB,UAAY4zB,EACxBnJ,GAAY5mB,WAAajR,KAAKmC,IAAI01B,GAAY5mB,WAAY,IAE1D,MAAMqkB,EAAS0C,KACfC,GAAoB,aAAc,CAChC+I,SACA5I,kBAAmBp4B,KAAKmC,IAAI,EAAG01B,GAAYzqB,UAC3C0qB,YAAaD,GAAYC,YACzBtrB,SAAUqrB,GAAYrrB,SACtBurB,YAAaF,GAAYE,YACzBzC,SACAh5B,OAAQu7B,GAAYv7B,SAGtB,MAAM2kC,EAAiBr3B,EAASo3B,EAC1BvtC,EAAS,IACVozB,EACHjd,OAAQq3B,GAiBV,OAfIA,GAAkB,IACpBxtC,EAAOmW,OAAS,EAChBnW,EAAOoW,UAAmC,KAAtBgd,EAAIhd,WAAa,GACrCpW,EAAOqW,OAA6B,KAAnB+c,EAAI/c,QAAU,IAE7B+tB,GAAYzqB,UAAY,IAC1B6qB,GAAoB,iBAAkB,CACpCE,OAAQ,SACR6I,SACA1L,SACAwC,YAAaD,GAAYC,YACzBx7B,OAAQu7B,GAAYv7B,SAEtB47B,GAAiB,YAEZzkC,CACT,CSVoBytC,CAAgB,CAChCt3B,OAAQkwB,EACRjwB,UAAWg3B,EACX/2B,OAAQg3B,EACRljC,WAGEujC,EAAcJ,GAAan3B,QAAU,EACrCw3B,EAAiBL,GAAal3B,WAAag3B,EAC3CQ,EAAcN,GAAaj3B,QAAUg3B,EACzC,MAAMQ,EAAcP,GAAanjC,QAAUA,EAErC2jC,EAAkBvhC,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI,GAAKqN,GAASJ,yBAA2B,IAkBxF,GAjBMuvB,EAAkB,IACpBJ,GAAe,EAAII,EACnBH,GAAkB,EAAsB,GAAlBG,EACtBF,GAAe,EAAsB,GAAlBE,GAGjBJ,EAAc,GAChB/uB,GAAS5B,OAASxQ,KAAKmC,IAAI,EAAGiQ,GAAS5B,OAAS2wB,GAChD/uB,GAAShB,gBAAkB,IAE3BgB,GAAShB,gBAAkBpR,KAAKmC,IAAIiQ,GAAShB,gBAAiB,IAGhEgB,GAASzP,IAAMy+B,EAAiBE,EAChClvB,GAASvP,IAAMw+B,EACjB9N,GAAiBnhB,GAAS/W,EAAG+W,GAAS/U,EAAI,GAAI2C,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAM0+B,KAEjEA,EAAc,EAAG,CACnB,MAAMb,EAAUluB,GAAS/U,GAAK+U,GAASQ,aAAalF,YAAc,IAClE+mB,GAAgB,CACdp5B,EAAG+W,GAAS/W,EAA+C,IAA1C+W,GAASQ,aAAanF,YAAc,IAAY6zB,EACjEjkC,EAAGijC,EACH1iC,OAAQ0jC,EACR13B,OAAQu3B,EACRzM,UAAWtiB,GAAS3B,WAAa,IACjCvO,OAAQlC,KAAKyC,MAAM,EAAIzC,KAAK+E,IAAI,GAAkB,GAAdo8B,IACpCpjC,UAAW,GAAMojC,EAAcnhC,KAAKmC,IAAI,EAAGiQ,GAAS3B,WAAa,OAErE,CAEM0wB,EAAc,GAAyB,IAApB/uB,GAAS5B,QAAgB4B,GAASmB,WAAa,IACpEnB,GAASmB,UAAY,IACrBnB,GAASS,WAAY,EACrBT,GAASkB,eAAiB,GAC1BlB,GAASc,iBAAkB,EAC3Bd,GAASU,aAAe,EACxBV,GAASnE,SAAU,EACnB2kB,GAAa,SAAUxgB,GAAS/W,EAAG+W,GAAS/U,GAAIikC,EAAalvB,GAASzP,GAAIyP,GAASvP,IAEvF,CC7KA,MAAM2+B,GAAyB,CAC7BC,gBAAiB,CACfhxB,UAAW,IACX1V,MAAO,IACPF,OAAQ,IACR6mC,aAAc,GACdvL,SAAU,WACV33B,UAAW,UACXM,UAAW,UACXL,YAAa,UACbE,gBAAiB,UACjBC,YAAa,UACbqN,cAAe,IACf01B,YAAa,GACbC,QAAS,IAEXC,UAAW,CACTpxB,UAAW,IACX1V,MAAO,IACPF,OAAQ,GACR6mC,aAAc,GACdvL,SAAU,UACV33B,UAAW,UACXM,UAAW,UACXL,YAAa,UACba,WAAY,UACZX,gBAAiB,UACjBC,YAAa,UACbqN,cAAe,IACf01B,YAAa,GACbC,QAAS,GACTE,WAAY,CACVxlC,OAAQ,IACRo4B,UAAW,IACX7qB,UAAW,IACXk4B,eAAgB,MAGpBC,kBAAmB,CACjBvxB,UAAW,IACX1V,MAAO,GACPF,OAAQ,GACR6mC,aAAc,GACdvL,SAAU,WACV33B,UAAW,UACXM,UAAW,UACXL,YAAa,UACbC,YAAa,UACbC,gBAAiB,UACjBC,YAAa,UACbqN,cAAe,IACf01B,YAAa,GACbC,QAAS,GACTE,WAAY,CACVxlC,OAAQ,IACRo4B,UAAW,IACX7qB,UAAW,IACXk4B,eAAgB,KAGpBE,WAAY,CACVxxB,UAAW,IACX1V,MAAO,IACPF,OAAQ,IACR6mC,aAAc,GACdvL,SAAU,WACV33B,UAAW,UACXM,UAAW,UACXL,YAAa,UACbE,gBAAiB,UACjBC,YAAa,UACbqN,cAAe,IACf01B,YAAa,GACbC,QAAS,IAEXM,YAAa,CACXzxB,UAAW,IACX1V,MAAO,IACPF,OAAQ,GACR6mC,aAAc,GACdvL,SAAU,WACV33B,UAAW,UACXM,UAAW,UACXL,YAAa,UACbE,gBAAiB,UACjBC,YAAa,UACbqN,cAAe,IACf01B,YAAa,GACbC,QAAS,IAEXO,WAAY,CACV1xB,UAAW,IACX1V,MAAO,IACPF,OAAQ,GACR6mC,aAAc,GACdvL,SAAU,UACV33B,UAAW,UACXM,UAAW,UACXL,YAAa,UACba,WAAY,UACZX,gBAAiB,UACjBC,YAAa,UACbqN,cAAe,IACf01B,YAAa,GACbC,QAAS,GACTE,WAAY,CACVxlC,OAAQ,IACRo4B,UAAW,IACX7qB,UAAW,IACXk4B,eAAgB,MAGpBK,WAAY,CACV3xB,UAAW,IACX1V,MAAO,IACPF,OAAQ,IACR6mC,aAAc,GACdvL,SAAU,WACV33B,UAAW,UACXM,UAAW,UACXL,YAAa,UACbC,YAAa,UACbC,gBAAiB,UACjBC,YAAa,UACbqN,cAAe,IACf01B,YAAa,GACbC,QAAS,GACTE,WAAY,CACVxlC,OAAQ,IACRo4B,UAAW,IACX7qB,UAAW,IACXk4B,eAAgB,OCtFtB,SAASM,KACP,O3CJF,WACE,MAAM5+B,EAAcF,KACpB,OAAO3H,MAAMC,QAAQ4H,GAAazC,eAAiByC,EAAYzC,cAAgB,EACjF,C2CCSshC,GAAmC9rC,IAAK2K,GA3CjD,SAAqCA,GACnC,MAAMohC,EAAef,GAAuBrgC,EAAM7D,MAClD,IAAKilC,EACH,MAAM,IAAI3pC,MAAM,kCAAkCuI,EAAM7D,QAG1D,MAAMiB,EAAoB4C,EAAM5C,mBAAqB,CAAC,EAChDikC,EAAW,IAAKD,KAAiBhkC,GACjCxD,EAAQoG,EAAMpG,OAASynC,EAASznC,OAASwnC,EAAaxnC,MACtDF,EAASsG,EAAMtG,QAAU2nC,EAAS3nC,QAAU0nC,EAAa1nC,OACzDuK,EAAYrK,EAAQ,EACpB0V,EAAY+xB,EAAS/xB,WAAa8xB,EAAa9xB,WAAa,IAE5DgyB,EAAe,CACnBvuC,GAAIiN,EAAMjN,GACVoJ,KAAM6D,EAAM7D,KACZklC,WACAnnC,EAAG8F,EAAM9F,EACTgC,EAAG8D,EAAMxD,MACT5C,QACAF,SACAuK,YACAoL,OAAQC,EACRA,YACAiyB,WAAW,EACXzxB,WAAY,EACZC,WAAY,EACZC,eAAgB,EAChBwxB,WAAY,EACZC,YAAa,EACbC,gBAAgB,EAChBjlC,OAAQuD,EAAMvD,QAAU,EACxBklC,YAAa,IAAK3hC,IAOpB,OAJIA,EAAM1E,WAAwC,iBAApB0E,EAAM1E,WAClC1C,OAAOgpC,OAAON,EAActhC,EAAM1E,WAG7BgmC,CACT,CAG2DO,CAA4B7hC,GACvF,CAEA,MAAMH,GAAgBqhC,KC7CtB,SAASY,GAAwB5L,EAAU/6B,EAAQ4mC,EAAW,KAC5D,MACMC,EAAU,GAAM,EAAI9L,EADJr3B,KAAKmC,IAAI,EAAG7F,GACkB,EAAG,GACvD,OAAO,GAAM4mC,EAAWC,GAAW,EAAID,GAAW,EAAG,EACvD,CAEA,SAASE,IAAsB,EAC7B/nC,EAAC,EACDgC,EAAC,OACDf,EAAM,UACNo4B,EAAY,EAAC,aACb2O,EAAe,EAAC,eAChBtB,EAAiB,IAAI,gBACrBr2B,EAAkB,EAAC,mBACnBC,EAAqB,EAAC,qBACtB23B,GAAuB,EAAI,eAC3BC,GAAiB,EAAI,cACrBC,GAAgB,IAEhB,MAAMC,EAAU,CACdC,UAAU,EACVC,WAAY,EACZC,WAAW,GAGPC,EAAY7jC,KAAKmC,IAAI,EAAGuyB,GACxBoP,EAAe9jC,KAAKmC,IAAI,EAAGkhC,GAA4B,IAAZQ,GAC3CE,EAAa/jC,KAAKmC,IAAI,EAAG7F,GACzB4mC,EAAW,GAAMnB,EAAgB,EAAG,GAE1C,GAAIuB,GAAwBjiC,GAAcmP,OAAS,EAAG,CACpD,MAAMwzB,EAAS3iC,GAAchG,EACvB4oC,EAAS5iC,GAAchE,EAA2B,IAAvBgE,GAAcxG,OACzCw8B,EAAWr3B,KAAKs3B,MAAM0M,EAAS3oC,EAAG4oC,EAAS5mC,GACjD,GAAIg6B,GAAY0M,EAAY,CAC1B,MAAMG,EAAQjB,GAAwB5L,EAAU0M,EAAYb,GAEtDr5B,EAAYi6B,EAAeI,EAEjCjE,GAAmB,CACjBr2B,OAJai6B,EAAYK,EAKzBr6B,YACAC,OAAoB,IAAZD,EACRjM,OALaomC,GAAU3oC,EAAI,GAAK,IAOlCooC,EAAQC,UAAW,CACrB,CACF,CAEA,GAAIH,EACF,IAAK,MAAM1uB,KAAStT,GAAS,CAC3B,GAAIsT,EAAMrE,QAAU,EAClB,SAEF,MAAM2zB,EAAStvB,EAAMxZ,EACfqU,EAASmF,EAAMxX,EAAmB,GAAfwX,EAAMha,OACzBw8B,EAAWr3B,KAAKs3B,MAAM6M,EAAS9oC,EAAGqU,EAASrS,GACjD,GAAIg6B,EAAW0M,EACb,SAEF,MAAMG,EAAQjB,GAAwB5L,EAAU0M,EAAYb,GACtDt5B,EAASi6B,EAAYK,EACrBr6B,EAAYi6B,EAAeI,EAE7Bt6B,GAAU,GAAKC,GAAa,IAGhCu2B,GAAmBvrB,EAAO,CACxBjL,SACAC,YACAC,OAAoB,IAAZD,EACRjM,OARaumC,GAAU9oC,EAAI,GAAK,IAUlCooC,EAAQE,YAAc,EACxB,CAGF,GAAIH,GAAiBpxB,GAAS5B,OAAS,EAAG,CACxC,MACM4zB,EAAel1B,GADRkD,GAASQ,aAAe,CAAEnF,WAAY,GAAIC,WAAY,GAAIC,UAAW,KAE5E02B,EAAgBjyB,GAAS/U,EAAmB,GAAf+mC,EAC7B/M,EAAWr3B,KAAKs3B,MAAMllB,GAAS/W,EAAIA,EAAGgpC,EAAgBhnC,GAC5D,GAAIg6B,GAAY0M,EAAY,CAC1B,MAAMG,EAAQjB,GAAwB5L,EAAU0M,EAAYb,GACtDt5B,EAAS5J,KAAKmC,IAAI,EAAG0hC,EAAYK,EAAQx4B,GACzC7B,EAAYi6B,EAAeI,EAAQv4B,EACnC/N,EAASwU,GAAS/W,GAAKA,EAAI,GAAK,GAClCuO,EAAS,GAAKC,EAAY,KAC5B+2B,GAAoB,KAAM,CACxBh3B,SACAC,YACAC,OAAoB,IAAZD,EACRjM,WAEF6lC,EAAQG,WAAY,EAExB,CACF,CAEA,OAAOH,CACT,CClGA,SAASa,GAAU7B,GACjB,MAAMr9B,EAAYq9B,EAAar9B,WAAaq9B,EAAa1nC,MAAQ,EAKjE,MAAO,CAAEoK,KAJIs9B,EAAapnC,EAAI+J,EAIfC,MAHDo9B,EAAapnC,EAAI+J,EAGTvI,IAFV4lC,EAAaplC,EAAIolC,EAAa5nC,OAEf0pC,OADZ9B,EAAaplC,EAE9B,CAEA,SAASmnC,GAA6BnpC,EAAGgC,EAAGf,EAAQmmC,GAClD,MAAM,KAAEt9B,EAAI,MAAEE,EAAK,IAAExI,EAAG,OAAE0nC,GAAWD,GAAU7B,GAGzCzL,EAAK37B,EAFM,GAAMA,EAAG8J,EAAME,GAG1B4xB,EAAK55B,EAFM,GAAMA,EAAGR,EAAK0nC,GAG/B,OAAOvN,EAAKA,EAAKC,EAAKA,GAAM36B,EAASA,CACvC,CAEA,SAASmoC,GAAuBppC,EAAGgC,EAAGolC,GACpC,MAAM,KAAEt9B,EAAI,MAAEE,EAAK,IAAExI,EAAG,OAAE0nC,GAAWD,GAAU7B,GACzCzL,EAAKh3B,KAAKmC,IAAIgD,EAAO9J,EAAG,EAAGA,EAAIgK,GAC/B4xB,EAAKj3B,KAAKmC,IAAItF,EAAMQ,EAAG,EAAGA,EAAIknC,GACpC,OAAOvkC,KAAKs3B,MAAMN,EAAIC,EACxB,CAqGA,SAASyN,GAAmBjC,EAAc5b,EAAM,CAAC,GAC/C,IAAK4b,GAAgBA,EAAaC,UAChC,MAAO,CAAEiC,SAAS,EAAOjC,WAAW,GAGtC,MAAMF,EAAWC,EAAaD,SACxB54B,EAAS5J,KAAKmC,IAAI,EAAG0kB,EAAIjd,QAAU,GACzC,GAAIA,GAAU,EACZ,MAAO,CAAE+6B,SAAS,EAAOjC,WAAW,GAGtC,MAAMkC,EAAgB5kC,KAAK+E,IAAI6E,EAAQ64B,EAAajyB,QACpDiyB,EAAajyB,OAASxQ,KAAKmC,IAAI,EAAGsgC,EAAajyB,OAASo0B,GACxDnC,EAAaxxB,WAAa,GAC1BwxB,EAAavxB,WAAalR,KAAK+E,IAAI,IAAM09B,EAAavxB,WAAa,IAAQ0zB,EAAgBnC,EAAahyB,UAAa,IACrH,MAAMo0B,EAAYrC,GAAUb,aAAe,GAC3Cc,EAAatxB,eAAiBnR,KAAKmC,IAAkC,GAA9BsgC,EAAatxB,eAAsB0zB,GAAa,IAAQD,EAAgBnC,EAAahyB,UAAa,MACzIgyB,EAAaE,WAAa3iC,KAAK+E,IAAIy9B,GAAUv2B,eAAiB,GAAIw2B,EAAaE,YAAc,GAAK,IApHpG,SAA4BF,EAAc5b,EAAM,CAAC,GACzB,oBAAXvuB,QACTA,OAAO0L,cACL,IAAIC,YAAY,mBAAoB,CAClCC,OAAQ,CACNhQ,GAAIuuC,EAAavuC,GACjBoJ,KAAMmlC,EAAanlC,KACnB64B,SAAUsM,EAAaD,UAAUrM,UAAY,UAC7C2O,MAAOje,EAAIie,OAAS,SACpBzpC,EAAGwrB,EAAIwZ,SAAWoC,EAAapnC,EAC/BgC,EAAGwpB,EAAIyZ,SAAWmC,EAAaplC,EAA0B,GAAtBolC,EAAa5nC,OAChD2V,OAAQiyB,EAAajyB,OACrBC,UAAWgyB,EAAahyB,aAKlC,CAoGEs0B,CAAmBtC,EAAc5b,GAEjC,IAAI6b,GAAY,EAShB,OARID,EAAajyB,QAAU,IACzBiyB,EAAaC,WAAY,EACzBD,EAAaG,YAAc5iC,KAAKmC,IAAIsgC,EAAaG,YAAa,KAC9DH,EAAaE,WAAaH,GAAUv2B,eAAiB,EAxGzD,SAAkCw2B,EAAc5b,EAAM,CAAC,GACrD,MAAM2b,EAAWC,EAAaD,SAC9B,IAAKA,GAAYC,EAAaI,eAC5B,OAEFJ,EAAaI,gBAAiB,EAC9B,MAAMjT,EAAU/I,EAAIwZ,SAAWoC,EAAapnC,EACtC2pC,EAAUne,EAAIyZ,SAAYmC,EAAaplC,EAA0B,IAAtBolC,EAAa5nC,OAuB9D,GArBA86B,GAAwB,CACtBt6B,EAAGu0B,EACHvyB,EAAG2nC,EACH1oC,OAA4D,GAApD0D,KAAKmC,IAAIsgC,EAAa1nC,MAAO0nC,EAAa5nC,UAEpDg7B,GAAgB,CACdx6B,EAAGu0B,EACHvyB,EAAG2nC,EACH1oC,OAAQ0D,KAAKmC,IAAIsgC,EAAa1nC,MAAO0nC,EAAa5nC,QAClDy7B,UAAuE,IAA3DkM,EAASV,YAAYxlC,QAA+B,IAArBmmC,EAAa1nC,SAE1Dq5B,GAAe,CACb/4B,EAAGu0B,EACHvyB,EAAG2nC,EACH1Q,YAAkC,IAArBmO,EAAa1nC,MAC1Bw5B,UAAgC,IAArBkO,EAAa1nC,MACxBiD,MAAO,UACP8E,IAAK,IACL0xB,UAAW,IAGTgO,EAASV,WAAY,CACvB,MAAMmD,EAAQzC,EAASV,WACD,oBAAXxpC,QACTA,OAAO0L,cACL,IAAIC,YAAY,yBAA0B,CACxCC,OAAQ,CACNhQ,GAAIuuC,EAAavuC,GACjBmH,EAAGu0B,EACHvyB,EAAG2nC,EACH1oC,OAAQ2oC,EAAM3oC,WAMtB8mC,GAAsB,CACpB/nC,EAAGu0B,EACHvyB,EAAG2nC,EACH1oC,OAAQ2oC,EAAM3oC,OACdo4B,UAAWuQ,EAAMvQ,UACjB2O,aAAc4B,EAAMp7B,UACpBk4B,eAAgBkD,EAAMlD,gBAAkB,MAG1CmD,GAA4B,CAC1B7pC,EAAGu0B,EACHvyB,EAAG2nC,EACH1oC,OAAQ2oC,EAAM3oC,OACdo4B,UAAWuQ,EAAMvQ,UACjBqN,eAAgBkD,EAAMlD,gBAAkB,IACxCoD,SAAU1C,EAAavuC,GACvB4wC,MAAO,mBAEX,CACA,MAAMM,EAAgB5C,EAASZ,SAAW5hC,KAAKyC,OAAOggC,EAAahyB,WAAa,KAAO,IACvF,GAAI20B,EAAgB,EAAG,CACrB,MAAMC,EAASrlC,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAM2iC,EAAgB,KAChDE,EAAYtlC,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAM2iC,EAAgBC,IACzD,IAAK,IAAI3xC,EAAI,EAAGA,EAAI2xC,EAAQ3xC,GAAK,EAE/BgP,GAAmB,CACjBrH,EAAGu0B,GAFY5vB,KAAK4C,SAAW,KAAQ6/B,EAAa1nC,OAAS,KAAO,GAGpEsC,EAAG2nC,EACH9iC,OAAQojC,EACRziC,IAAK,IAAsB,GAAhB7C,KAAK4C,UAGtB,CACF,CA2BI2iC,CAAyB9C,EAAc5b,GACvC6b,GAAY,GAGP,CAAEiC,SAAS,EAAMjC,YAC1B,CAEA,SAASwC,IAA4B,EAAE7pC,EAAC,EAAEgC,EAAC,OAAEf,EAAM,UAAEo4B,EAAS,eAAEqN,EAAiB,IAAI,SAAEoD,EAAW,KAAI,MAAEL,EAAQ,cAC9G,MAAMU,EAAYxlC,KAAKmC,IAAI,EAAGuyB,GAAa,GAC3C,GAAI8Q,GAAa,GAAKlpC,GAAU,EAC9B,OAAO,EAGT,MAAM4mC,EAAW,GAAMnB,EAAgB,EAAG,GAC1C,IAAI0D,EAAO,EACX,IAAK,MAAMhD,KAAgBzhC,GAAe,CACxC,GAAIyhC,EAAavuC,KAAOixC,GAAa1C,EAAaC,WAAaD,EAAaI,eAC1E,SAEF,MAAMxL,EAAWoN,GAAuBppC,EAAGgC,EAAGolC,GAC9C,GAAIpL,EAAW/6B,EACb,SAEF,MACMsN,EAAS47B,EADCvC,GAAwB5L,EAAU/6B,EAAQ4mC,GAEtDt5B,GAAU,GAKC86B,GAAmBjC,EAAc,CAAE74B,SAAQk7B,QAAOzE,QAFjD,GAAMhlC,EAAGonC,EAAapnC,EAAIonC,EAAar9B,UAAWq9B,EAAapnC,EAAIonC,EAAar9B,WAEtBk7B,QAD1D,GAAMjjC,EAAGolC,EAAaplC,EAAIolC,EAAa5nC,OAAQ4nC,EAAaplC,KAEjEsnC,UACTc,GAAQ,EAEZ,CACA,OAAOA,CACT,CAEA,SAASC,GAA0Br7B,GACjC,IAAK,MAAMo4B,KAAgBzhC,GACzB,IAAIyhC,EAAaC,WAGb8B,GAA6Bn6B,EAAWhP,EAAGgP,EAAWhN,EAAGgN,EAAW/N,OAAQmmC,GAO9E,OANAiC,GAAmBjC,EAAc,CAC/B74B,OAAQS,EAAWT,QAAU,EAC7Bk7B,MAAO,aACPzE,QAASh2B,EAAWhP,EACpBilC,QAASj2B,EAAWhN,KAEf,EAGX,OAAO,CACT,CAEA,SAASsoC,GAAsBC,GAC7B,IAAI/e,GAAM,EACV,IAAK,MAAM4b,KAAgBzhC,GACrByhC,EAAaC,WAAakD,EAAOC,WAAW5wB,IAAIwtB,EAAavuC,KAG7DswC,GAA6BoB,EAAOvqC,EAAGuqC,EAAOvoC,EAAGuoC,EAAOtpC,OAAQmmC,KAClEmD,EAAOC,WAAWvhC,IAAIm+B,EAAavuC,IACnCwwC,GAAmBjC,EAAc,CAC/B74B,OAAQg8B,EAAOh8B,QAAU,EACzBk7B,MAAO,QACPzE,QAASuF,EAAOvqC,EAChBilC,QAASsF,EAAOvoC,IAElBwpB,GAAM,GAGV,OAAOA,CACT,CFlKAxiB,GAAoB,MAhBpB,WACErD,GAAcrN,OAAS,EACvB,MAAMmyC,EAAQzD,KACd,IAAK,MAAMpuC,KAAQ6xC,EACjB9kC,GAAc9L,KAAKjB,EAEvB,CAWE8xC,KGpEF,MAAMC,GAAuB,CAC3BC,UAAW,CACT/xC,GAAI,YACJmM,KAAM,uBACNtF,MAAO,IACPF,OAAQ,GACR4V,UAAW,IACXy1B,KAAM,GACNloC,MAAO,UACPS,YAAa,UACb0nC,YAAa,UACbC,UAAU,GAEZC,WAAY,CACVnyC,GAAI,aACJmM,KAAM,cACNtF,MAAO,IACPF,OAAQ,IACR4V,UAAW,IACXy1B,KAAM,GACNloC,MAAO,UACPS,YAAa,UACb0nC,YAAa,UACb1P,OAAQ,CACN/sB,MAAO,IACPya,SAAU,KACV9Z,WAAY,CACVC,MAAO,IACPV,OAAQ,GACR5L,MAAO,aAIbsoC,cAAe,CACbpyC,GAAI,gBACJmM,KAAM,iBACNtF,MAAO,IACPF,OAAQ,IACR4V,UAAW,IACXy1B,KAAM,GACNloC,MAAO,UACPS,YAAa,UACb0nC,YAAa,UACbI,OAAQ,CACNjqC,OAAQ,IACRkqC,gBAAiB,GACjBC,aAAc,IAEhBC,QAAS,CACPpqC,OAAQ,IACRyB,UAAW,GACXC,MAAO,UACPE,QAAS,MAGbyoC,UAAW,CACTzyC,GAAI,YACJmM,KAAM,aACNtF,MAAO,IACPF,OAAQ,GACR4V,UAAW,IACXy1B,KAAM,GACNloC,MAAO,UACPS,YAAa,UACb0nC,YAAa,UACbS,KAAM,CACJtqC,OAAQ,IACRsN,OAAQ,GACRi9B,KAAM,GACN1iB,SAAU,KAEZuiB,QAAS,CACPpqC,OAAQ,IACRyB,UAAW,GACXC,MAAO,UACPE,QAAS,MCxET4oC,GAAa,GAEbC,GAAa,CACjBp/B,QAAQ,EACRq/B,eAAgB,EAChBC,YAAa,CACX5rC,EAAG,EACHgC,EAAG,EACH6pC,OAAO,IAIX,SAASC,KACP,OAAOptC,OAAOsa,OAAO2xB,GACvB,CAEA,SAAS,GAAoBtwC,EAAQ,GACnC,MAAM0xC,EAAOD,KACb,OAAoB,IAAhBC,EAAKzzC,OACA,KAGFyzC,GADa1xC,EAAQ0xC,EAAKzzC,OAAUyzC,EAAKzzC,QAAUyzC,EAAKzzC,OAEjE,CAMA,SAAS0zC,KACPP,GAAWnzC,OAAS,CACtB,CAEA,SAAS,KACP,OAAOmzC,EACT,CAEA,SAAS,KACP,OAAOC,EACT,CAEA1iC,GAAoB,KAClBgjC,KACAN,GAAWp/B,QAAS,EACpBo/B,GAAWE,YAAc,IAAKF,GAAWE,YAAaC,OAAO,KCzC/D,MAAMI,GAAmB,IAAIxzB,IACvByzB,GAAkB,GACxB,IAAI,IAAoB,EACpBC,GhD2CJ,WACE,MAAM/jC,EAAcF,KACpB,OAAO3H,MAAMC,QAAQ4H,GAAavC,eAAiBuC,EAAYvC,cAAgB,EACjF,CgD9C+BumC,GAO/B,SAASC,GAAexsC,GACtB,OAAO,GAAMA,EAAO,EAAG,EACzB,CAqCA,SAASysC,GAAK3pC,EAAO4pC,GACnB,MAAM,EAAEC,EAAC,EAAEC,EAAC,EAAE9uB,GApChB,SAAoBhb,GAClB,GAAqB,iBAAVA,EACT,MAAO,CAAE6pC,EAAG,IAAKC,EAAG,IAAK9uB,EAAG,KAE9B,MAAM+uB,EAAU/pC,EAAM4hB,OACtB,GAAImoB,EAAQC,WAAW,KAAM,CAC3B,IAAIC,EAAMF,EAAQ/3B,MAAM,GAOxB,GANmB,IAAfi4B,EAAIt0C,SACNs0C,EAAMA,EACHC,MAAM,IACN1xC,IAAK2xC,GAASA,EAAOA,GACrBxxC,KAAK,KAES,IAAfsxC,EAAIt0C,OAAc,CACpB,MAAMy0C,EAAU7lC,OAAO8lC,SAASJ,EAAK,IACrC,IAAK1lC,OAAO+lC,MAAMF,GAChB,MAAO,CACLP,EAAIO,GAAW,GAAM,IACrBN,EAAIM,GAAW,EAAK,IACpBpvB,EAAa,IAAVovB,EAGT,CACF,CACA,MAAMG,EAAQR,EAAQQ,MAAM,+CAC5B,OAAIA,EACK,CACLV,EAAGtlC,OAAO8lC,SAASE,EAAM,GAAI,IAC7BT,EAAGvlC,OAAO8lC,SAASE,EAAM,GAAI,IAC7BvvB,EAAGzW,OAAO8lC,SAASE,EAAM,GAAI,KAG1B,CAAEV,EAAG,IAAKC,EAAG,IAAK9uB,EAAG,IAC9B,CAGsBwvB,CAAWxqC,GAE/B,MAAO,QAAQ6pC,MAAMC,MAAM9uB,MADN,GAAM4uB,EAAO,EAAG,OAEvC,CAEA,SAASa,GAAmBv0C,EAAIw0C,GAC9B,IAAIrsC,EAAQirC,GAAiBptC,IAAIhG,GAC5BmI,IACHA,EAAQ,CACNnI,KACA6J,UAAW,EACX4qC,gBAAiBjB,GAAegB,EAAM3qC,WAAa,GACnDT,KAAMorC,EAAMprC,MAAQ,QACpBW,UAAWyqC,EAAMzqC,WAAa,IAEhCqpC,GAAiBrzB,IAAI/f,EAAImI,IAE3BA,EAAMiB,KAAOorC,EAAMprC,MAAQjB,EAAMiB,MAAQ,QACzCjB,EAAMhB,EAAIqtC,EAAMrtC,GAAKgB,EAAMhB,GAAK,EAChCgB,EAAMgB,EAAIqrC,EAAMrrC,GAAKhB,EAAMgB,GAAK,EAChChB,EAAMC,OAASosC,EAAMpsC,QAAUD,EAAMC,QAAU,IAC/CD,EAAM0D,IAAM2oC,EAAM3oC,KAAO1D,EAAM0D,KAAOC,KAAKC,GAAK,EAChD5D,EAAMyD,UAAY4oC,EAAM5oC,WAAazD,EAAMyD,WAAa,EACxDzD,EAAM2B,MAAQ0qC,EAAM1qC,OAAS3B,EAAM2B,OAAS,UAC5C3B,EAAM6D,QAAUwoC,EAAMxoC,SAAW7D,EAAM6D,SAAW,EAClD7D,EAAM6B,QAAUwqC,EAAMxqC,SAAW7B,EAAM6B,SAAW,EAClD7B,EAAM4B,UAAYyqC,EAAMzqC,WAAa5B,EAAM4B,WAAa,GACxD5B,EAAMssC,gBAAkBjB,GAAegB,EAAM3qC,WAAa1B,EAAMssC,iBAAmB,GACnFtsC,EAAMsL,QAAS,CACjB,CAEA,SAASihC,GAAkB90C,EAAU,CAAC,GACpC,KACA,MAAMgP,EAAM9C,KAAKmC,IAAI,KAAOrO,EAAQgP,KAAO,IAC3CykC,GAAgBryC,KAAK,CACnBoI,KAAMxJ,EAAQwJ,MAAQ,QACtBjC,EAAGvH,EAAQuH,GAAK,EAChBgC,EAAGvJ,EAAQuJ,GAAK,EAChBf,OAAQxI,EAAQwI,QAAU,IAC1ByB,UAAW2pC,GAAe5zC,EAAQiK,WAAa,GAC/CC,MAAOlK,EAAQkK,OAAS,UACxB8B,UAAWhM,EAAQgM,WAAa,EAChCC,IAAKjM,EAAQiM,KAAOC,KAAKC,GAAK,EAC9BC,QAASpM,EAAQoM,SAAW,EAC5BhC,QAASpK,EAAQoK,SAAW,EAC5B8M,MAAO,GAAMlX,EAAQkX,OAAS,EAAG,GAAK,GACtClI,MACAE,OAAQF,GAEZ,CAEA,SAAS,KACH,IAAuC,oBAAXxK,SAGhCA,OAAOkwB,iBAAiB,sBAAwBvgB,IAC9C,MAAM/D,EAAS+D,GAAO/D,QAAU,CAAC,EACjC0kC,GAAkB,CAChBtrC,KAAM,QACNjC,EAAG6I,EAAO7I,GAAK,EACfgC,EAAG6G,EAAO7G,GAAK,EACff,OAAQ4H,EAAO5H,OAAyB,IAAhB4H,EAAO5H,OAAe,IAC9CyB,UAAW,IACXC,MAAO,UACP8E,IAAK,IACL5E,QAAS,IACT8M,MAAO,KAEoB,iBAAlB9G,EAAOtG,QAAyC,IAAlBsG,EAAOtG,QAC9CgrC,GAAkB,CAChBtrC,KAAM,OACNjC,EAAG6I,EAAO7I,GAAK,EACfgC,EAAG6G,EAAO7G,GAAK,EACff,OAAQ,IACRyB,UAAW,GACXC,MAAO,UACP8B,UAAWoE,EAAOtG,OAAS,EAAI,EAAIoC,KAAKC,GACxCF,IAAKC,KAAKC,GAAK,EACfC,QAAS,GACT4C,IAAK,IACL5E,QAAS,IACT8M,MAAO,OAIb1S,OAAOkwB,iBAAiB,sBAAwBvgB,IAC9C,MAAM/D,EAAS+D,GAAO/D,QAAU,CAAC,EAC3B5H,EAAS4H,EAAO5H,OAAyB,IAAhB4H,EAAO5H,OAAe,IACrDssC,GAAkB,CAChBtrC,KAAM,QACNjC,EAAG6I,EAAO7I,GAAK,EACfgC,EAAG6G,EAAO7G,GAAK,EACff,SACAyB,UAAW,IACXC,MAAO,UACP8E,IAAK,IACL5E,QAAS,IACT8M,MAAO,OAGX1S,OAAOkwB,iBAAiB,wBAA0BvgB,IAChD,MAAM/D,EAAS+D,GAAO/D,QAAU,CAAC,EACjC0kC,GAAkB,CAChBtrC,KAAM,QACNjC,EAAG6I,EAAO7I,GAAK,EACfgC,EAAG6G,EAAO7G,GAAK,EACff,OAAiC,KAAxB4H,EAAO5H,QAAU,KAC1ByB,UAAW,EACXC,MAAO,UACP8E,IAAK,IACL5E,QAAS,GACT8M,MAAO,OAGX1S,OAAOkwB,iBAAiB,wBAA0BvgB,IAChD,MAAM/D,EAAS+D,GAAO/D,QAAU,CAAC,EACjC0kC,GAAkB,CAChBtrC,KAAM,QACNjC,EAAG6I,EAAO7I,GAAK,EACfgC,EAAG6G,EAAO7G,GAAK,EACff,OAAiC,KAAxB4H,EAAO5H,QAAU,KAC1ByB,UAAW,GACXC,MAAO,UACP8E,IAAK,GACL5E,QAAS,GACT8M,MAAO,QAGX1S,OAAOkwB,iBAAiB,4BAA8BvgB,IACpD,MAAM/D,EAAS+D,GAAO/D,QAAU,CAAC,EACjC0kC,GAAkB,CAChBtrC,KAAM,QACNjC,EAAG6I,EAAO7I,GAAK,EACfgC,EAAG6G,EAAO7G,GAAK,EACff,OAAiC,KAAxB4H,EAAO5H,QAAU,KAC1ByB,UAAW,IACXC,MAAO,UACP8E,IAAK,GACL5E,QAAS,IACT8M,MAAO,QAGX1S,OAAOkwB,iBAAiB,mBAAqBvgB,IAC3C,MAAM/D,EAAS+D,GAAO/D,QAAU,CAAC,EACjC0kC,GAAkB,CAChBtrC,KAAM,QACNjC,EAAG6I,EAAOm8B,SAAWn8B,EAAO7I,GAAK,EACjCgC,EAAG6G,EAAOo8B,SAAWp8B,EAAO7G,GAAK,EACjCf,OAAQ,IACRyB,UAAW,IACXC,MAAO,UACP8E,IAAK,IACL5E,QAAS,GACT8M,MAAO,QAGX,IAAoB,EACtB,CAoDA,SAAS69B,GAAexsC,GACtB,MAAMC,EAASD,EAAMC,QAAU,EAC/B,GAAIA,GAAU,EACZ,OAAO,EAET,MAAMvB,EAAQ,EAAQN,OAAOM,MACvBF,EAAS,EAAQJ,OAAOI,OAC9B,OAAOwB,EAAMhB,EAAIiB,GAAU,GAAKD,EAAMhB,EAAIiB,GAAUvB,GAASsB,EAAMgB,EAAIf,GAAU,GAAKD,EAAMgB,EAAIf,GAAUzB,CAC5G,CAEA,SAASiuC,GAAezsC,EAAO+Q,GAC7B,IAAKy7B,GAAexsC,GAClB,OAEF,MAAMC,EAASD,EAAMC,QAAU,IACzBysC,EAAW,EAAQC,qBAAqB3sC,EAAMhB,EAAGgB,EAAMgB,EAAG,EAAGhB,EAAMhB,EAAGgB,EAAMgB,EAAGf,GACrFysC,EAASE,aAAa,EAAGtB,GAAKtrC,EAAM2B,MAAO,GAAiB,KAAXoP,EAAiB,EAAG,OACrE27B,EAASE,aAAa,GAAKtB,GAAKtrC,EAAM2B,MAAO,GAAiB,GAAXoP,EAAgB,EAAG,MACtE27B,EAASE,aAAa,EAAGtB,GAAKtrC,EAAM2B,MAAO,IAC3C,EAAQkrC,UAAYH,EACpB,EAAQI,YACR,EAAQC,IAAI/sC,EAAMhB,EAAGgB,EAAMgB,EAAGf,EAAQ,EAAa,EAAV0D,KAAKC,IAC9C,EAAQopC,MACV,CAEA,SAASC,GAAcjtC,EAAO+Q,GAC5B,IAAKy7B,GAAexsC,GAClB,OAEF,MAAMC,EAASD,EAAMC,QAAU,IACzByD,EAAM,GAAM1D,EAAM0D,KAAOC,KAAKC,GAAK,EAAGD,KAAKC,GAAK,GAAID,KAAKC,IACzDC,EAAU,GAAM7D,EAAM6D,SAAW,GAAK,GAAK,KACjD,EAAQqpC,OACR,EAAQC,UAAUntC,EAAMhB,EAAGgB,EAAMgB,GACjC,EAAQosC,OAAOptC,EAAMyD,WAAa,GAClC,EAAQ4pC,MAAM,EAAGxpC,GACjB,MAAM6oC,EAAW,EAAQC,qBAAqB,EAAG,EAAG,EAAG,EAAG,EAAG1sC,GAC7DysC,EAASE,aAAa,EAAGtB,GAAKtrC,EAAM2B,MAAO,GAAMoP,EAAU,EAAG,KAC9D27B,EAASE,aAAa,IAAMtB,GAAKtrC,EAAM2B,MAAO,GAAiB,GAAXoP,EAAgB,EAAG,MACvE27B,EAASE,aAAa,EAAGtB,GAAKtrC,EAAM2B,MAAO,IAC3C,EAAQkrC,UAAYH,EACpB,EAAQI,YACR,MAAMQ,EAAU5pC,EAAM,EACtB,EAAQ6pC,OAAO,EAAG,GAClB,EAAQR,IAAI,EAAG,EAAG9sC,GAASqtC,EAASA,GACpC,EAAQE,YACR,EAAQR,OACR,EAAQS,SACV,CA9SAzlC,GAAqBZ,IACnB+jC,GAA2B5rC,MAAMC,QAAQ4H,GAAavC,eAAiBuC,EAAYvC,cAAgB,GACnGomC,GAAiBtvB,UCLnB,MAAM+xB,GAAc,GAEpB,SAASxS,IAAgB,EACvBl8B,EAAC,EACDgC,EAAC,GACDsF,EAAE,GACFE,EAAE,OACFvG,EAAS,EAAC,SACViO,EAAW,IAAG,MACdvM,EAAQ,UAAS,OACjB4L,EAAS,EAAC,UACVC,EAAY,EAAC,OACbjM,EAAS,EAAC,cACV4M,EAAgB,KAEhBu/B,GAAY70C,KAAK,CACfmG,IACAgC,IACAsF,KACAE,KACAvG,SACA82B,KAAM7oB,EACN8oB,QAAS9oB,EACTvM,QACA4L,SACAC,YACAjM,SACA4M,gBACAw/B,cAAe,EACfnE,WAAY,IAAIxiC,KAEpB,CAEA,SAAS4mC,GAAcC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,GACzC,MAAMvT,EAAKkT,EAAKG,EACVpT,EAAKkT,EAAKG,EACVE,EAAQJ,EAAKG,EACnB,OAAOvT,EAAKA,EAAKC,EAAKA,GAAMuT,EAAQA,CACtC,CClCA,MAAMC,GAAa,GACbC,GAAc,GAEpB,SAASC,GAAuBrtC,EAAM4G,EAAS,CAAC,GACxB,oBAAX5L,QAGXA,OAAO0L,cAAc,IAAIC,YAAY3G,EAAM,CAAE4G,WAC/C,CA4LA,SAAS0mC,GAASC,GAChB,GAAIA,EAAQC,UACV,OAGFD,EAAQC,WAAY,EACpBD,EAAQE,eAAiB/qC,KAAKmC,IAAI0oC,EAAQp/B,kBAAmB,KAC7Do/B,EAAQG,KAAO,EAEf,MAAMC,EAAa,CACjB/2C,GAAI22C,EAAQ32C,GACZ0X,WAAYi/B,EAAQj/B,WACpBvQ,EAAGwvC,EAAQxvC,EACXgC,EAAGwtC,EAAQxtC,EACXf,OAAQuuC,EAAQx/B,iBAGlB,OAAQw/B,EAAQj/B,YACd,IAAK,SAvFT,SAA0Bi/B,GACxB,MAAM,EAAExvC,EAAC,EAAEgC,EAAC,gBAAEgO,EAAe,aAAES,EAAY,mBAAEC,GAAuB8+B,EAC9Dr+B,EAAWxM,KAAKmC,IAAI,GAAK2J,GAE/B,GAAIzK,GAAcmP,OAAS,EAAG,CAC5B,MAAMwmB,EAAK31B,GAAchG,EAAIA,EACvB47B,EAAM51B,GAAchE,EAA2B,IAAvBgE,GAAcxG,OAAiBwC,EACzD2C,KAAKs3B,MAAMN,EAAIC,IAAO5rB,IACxBhK,GAAc4P,WAAajR,KAAKmC,IAAId,GAAc4P,WAAuB,GAAXzE,GAC9DnL,GAAc6P,WAAalR,KAAKmC,IAAId,GAAc6P,WAAuB,GAAX1E,GAC9DnL,GAAc8P,eAAiBnR,KAAKmC,IAAId,GAAc8P,eAAgB,IAE1E,CAEA,IAAK,MAAM0D,KAAStT,GAAS,CAC3B,GAAIsT,EAAMrE,QAAU,EAClB,SAEF,MAAMwmB,EAAKniB,EAAMxZ,EAAIA,EACf47B,EAAMpiB,EAAMxX,EAAmB,GAAfwX,EAAMha,OAAgBwC,EACxC2C,KAAKs3B,MAAMN,EAAIC,IAAO5rB,IACxBwJ,EAAMvD,UAAYtR,KAAKmC,IAAI0S,EAAMvD,WAAa,EAAG9E,GACjDqI,EAAM5D,WAAajR,KAAKmC,IAAI0S,EAAM5D,WAAuB,GAAXzE,GAC9CqI,EAAM3D,WAAalR,KAAKmC,IAAI0S,EAAM3D,WAAuB,GAAX1E,GAC9CqI,EAAM1D,eAAiBnR,KAAKmC,IAAI0S,EAAM1D,eAAgB,IAE1D,CAEA,GAAIpF,EAAqB,GAAKqG,GAAS5B,OAAS,EAAG,CACjD,MACM4zB,EAAel1B,GADRkD,GAASQ,aAAe,CAAEnF,WAAY,GAAIC,WAAY,GAAIC,UAAW,KAE5E02B,EAAgBjyB,GAAS/U,EAAmB,GAAf+mC,EAC7BpN,EAAK5kB,GAAS/W,EAAIA,EAClB47B,EAAKoN,EAAgBhnC,EACvB2C,KAAKs3B,MAAMN,EAAIC,IAAO5rB,IACxB+G,GAASuB,gBAAkB3T,KAAKmC,IAAIiQ,GAASuB,iBAAmB,EAAG5H,GACnEqG,GAASd,UAAYtR,KAAKmC,IAAIiQ,GAASd,WAAa,EAAwB,GAArBvF,GAE3D,CACF,CAiDMm/B,CAAiBL,GACjBI,EAAW3uC,OAASuuC,EAAQx/B,gBAC5B4/B,EAAWn/B,aAAe++B,EAAQ/+B,aAClCm/B,EAAWl/B,mBAAqB8+B,EAAQ9+B,mBACxC4+B,GAAuB,wBAAyB,IAC3CM,EACHn/B,aAAc++B,EAAQ/+B,aACtBC,mBAAoB8+B,EAAQ9+B,qBAE9B,MAEF,IAAK,QAAS,CACZ,MAAMo/B,EA3DZ,SAAyBN,GACvB,MAAMr+B,EAAWxM,KAAKmC,IAAI,GAAK0oC,EAAQ5+B,eACjC3P,EAAS0D,KAAKmC,IAAI,GAAI0oC,EAAQ3+B,aAC9Bi/B,EAAQ,CACZj3C,GAAI,SAASyU,KAAKD,SAAS1I,KAAK4C,SAAStM,SAAS,IAAI0Z,MAAM,EAAG,KAC/D3U,EAAGwvC,EAAQxvC,EACXgC,EAAGwtC,EAAQxtC,EACXf,SACA8uC,WAAY9uC,EACZg6B,UAAWh6B,GAAUuuC,EAAQ1+B,gBAAkB,KAC/CK,WACA4mB,KAAM5mB,EACN6+B,eAAgB,GAAMR,EAAQz+B,qBAAuB,IAAM,GAAK,GAChEk/B,KAAMT,EAAQx+B,mBAAqB,GACnCk/B,UAAW,GAWb,OATAb,GAAYx1C,KAAKi2C,GACjBR,GAAuB,wBAAyB,CAC9Cz2C,GAAIi3C,EAAMj3C,GACVmH,EAAG8vC,EAAM9vC,EACTgC,EAAG8tC,EAAM9tC,EACTf,OAAQ6uC,EAAM7uC,OACdg6B,UAAW6U,EAAM7U,UACjB9pB,SAAU2+B,EAAM3+B,WAEX2+B,CACT,CAiCoBK,CAAgBX,GAC9BI,EAAW3uC,OAAS6uC,EAAM7U,UAC1B2U,EAAWz+B,SAAW2+B,EAAM3+B,SAC5By+B,EAAWQ,QAAUN,EAAMj3C,GAC3By2C,GAAuB,2BAA4B,IAC9CM,EACH3uC,OAAQ6uC,EAAM7U,UACd9pB,SAAU2+B,EAAM3+B,SAChBi/B,QAASN,EAAMj3C,KAEjB,KACF,CACA,SAjJJ,SAA8B22C,GAC5B,MAAM,EAAExvC,EAAC,EAAEgC,EAAC,gBAAEgO,EAAe,OAAEzB,EAAM,UAAEC,GAAcghC,EACrDzH,GAAsB,CACpB/nC,IACAgC,IACAf,OAAQ+O,EACRqpB,UAAW9qB,EACXy5B,aAAcx5B,EACdk4B,eAAgB8I,EAAQa,eAAiB,GACzChgC,gBAAiBm/B,EAAQn/B,iBAAmB,EAC5CC,mBAAoBk/B,EAAQl/B,oBAAsB,IAGhD/B,EAAS,GACXs7B,GAA4B,CAC1B7pC,IACAgC,IACAf,OAAQ+O,EACRqpB,UAAW9qB,EACXm4B,eAAgB8I,EAAQc,qBAAuB,IAC/C7G,MAAO+F,EAAQj/B,YAAc,crB0MnC,SAA8B1H,EAAS,CAAC,GACtC,MAAMvI,EAAQuI,EAAO7I,GAAK,EACpBsC,EAAQuG,EAAO7G,GAAK,EACpBjJ,EAAQ8P,EAAO9P,OAAS,GAExBugC,GADSzwB,EAAO5H,OACJ4H,EAAOoG,OAAS,KAC5B0qB,EAAU9wB,EAAO8wB,SAAW,CAAC,UAAW,UAAW,UAAW,WACpE,IAAK,IAAIthC,EAAI,EAAGA,EAAIU,EAAOV,GAAK,EAAG,CACjC,MAAM+a,EAAQzO,KAAK4C,SAAW5C,KAAKC,GAAK,EAClCqK,EAAQqqB,GAAa,IAAuB,IAAhB30B,KAAK4C,UACjCwtB,EAA+B,IAAvBpwB,KAAK4C,SAAW,IAC9B4wB,GAAUt+B,KAAK,CACboI,KAAM,SACNjC,EAAGM,EAAQqE,KAAKuO,IAAIE,IAAUvK,EAAO0nC,cAAgB,GACrDvuC,EAAGM,EAAQqC,KAAKwO,IAAIC,IAAUvK,EAAO0nC,cAAgB,GACrDjpC,GAAI3C,KAAKuO,IAAIE,EAAQ2hB,GAAQ9lB,EAC7BzH,GAAI7C,KAAKwO,IAAIC,EAAQ2hB,GAAQ9lB,EAAQ,GAAM,GAC3CxH,IAAK,GAAsB,GAAhB9C,KAAK4C,SAChBI,OAAQ,GAAsB,GAAhBhD,KAAK4C,SACnBtG,OAAQ,EAAoB,EAAhB0D,KAAK4C,SACjB5E,MAAOg3B,EAAQthC,EAAIshC,EAAQrhC,SAE/B,CACF,CqB7NEk4C,CAAqB,CACnBxwC,IACAgC,IACAf,OAAQ+O,EACRjX,MAAO4L,KAAKmC,IAAI,GAAInC,KAAKyC,MAAM4I,EAAkB,KACjDf,MAAO,IAAoC,GAA9BtK,KAAKmC,IAAI,EAAG0H,GAAa,IAE1C,EAmHMiiC,CAAqBjB,GACrBI,EAAWrhC,OAASihC,EAAQjhC,OAC5BqhC,EAAWphC,UAAYghC,EAAQhhC,UAC/B8gC,GAAuB,sBAAuB,IACzCM,EACHrhC,OAAQihC,EAAQjhC,OAChBC,UAAWghC,EAAQhhC,YAMzB8gC,GAAuB,qBAAsBM,EAC/C,CCzQA,IAAIc,GAAe,KAEnB,MAAMC,GAAmB,CACvBC,aAAc,EACdC,cAAe,EACfC,WAAY,EACZC,YAAa,EACbC,YAAa,EACbC,aAAc,EACdC,aAAc,EACdC,cAAe,EACfC,kBAAmB,EACnBC,mBAAoB,EACpBC,kBAAmB,EACnBC,mBAAoB,EACpBC,cAAe,EACfC,eAAgB,EAChBC,cAAe,EACfC,eAAgB,GAiBlB,SAAS,GAAa3xC,EAAG+J,EAAY,EAAG6nC,EAAS,KAC/C,MAAMnlC,EAASikC,GACf,IAAKjkC,EACH,OAAO,EAET,MAAM3C,GAAQ2C,EAAO3C,MAAQ,GAAK8nC,EAC5B5nC,GAASyC,EAAOzC,QAAWyC,EAAO3C,MAAQ,GAAgC,GAAzB2C,EAAO1C,WAAa,IAAY6nC,EAGvF,OADY5xC,EAAI+J,GACFD,GAFF9J,EAAI+J,GAEaC,CAC/B,CAEA,SAAS,GAAiB6nC,EAAQC,GAChC,MAAMC,EAAW,GAAGF,SACdG,EAAY,GAAGH,UACjBnzC,OAAOK,UAAUC,eAAeC,KAAK0xC,GAAkBoB,KACzDpB,GAAiBoB,IAAa,EAC1BD,GAAUpzC,OAAOK,UAAUC,eAAeC,KAAK0xC,GAAkBqB,KACnErB,GAAiBqB,IAAc,GAGrC,CCxDA,MAAMC,GAAoB,CACxB7iC,KAAM,CACJvW,GAAI,OACJia,MAAO,aACPhF,YAAa,kDACbokC,OAAQ,IACRC,WAAY,UACZxuC,UAAW,UACXyuC,gBAAiB,IAEnBC,OAAQ,CACNx5C,GAAI,SACJia,MAAO,eACPhF,YAAa,sDACbokC,OAAQ,IACRC,WAAY,UACZxuC,UAAW,UACXyuC,gBAAiB,IAEnBE,MAAO,CACLz5C,GAAI,QACJia,MAAO,gBACPhF,YAAa,iDACbokC,OAAQ,GACRC,WAAY,UACZxuC,UAAW,UACXiY,SAAU,gBACVw2B,gBAAiB,GACjBx2B,SAAU,kBClBR22B,GAAc,GACdC,GAAU,CACdC,cDqBc,GCpBdC,eAAgBC,KAChBC,gBAAiB,KACjBC,cAAe,EACfC,iBAAkB,EAClBC,cAAe,KACfC,YAAa,EACbC,eDwBkB,ICvBlBC,aAAc,GAOhB,SAASP,KACP,MAAMQ,EAAUz0C,OAAOsa,OAAOi5B,IAC9B,GAAuB,IAAnBkB,EAAQ76C,OACV,OAAO,KAET,MAAM86C,EAAcD,EAAQzxB,OAAO,CAAC2xB,EAAKl3B,IAAUk3B,GAAOl3B,EAAM+1B,QAAU,GAAI,GAC9E,IAAI5nC,EAAO3F,KAAK4C,SAAW6rC,EAC3B,IAAK,MAAMj3B,KAASg3B,EAAS,CAC3B,MAAMjB,EAAS/1B,EAAM+1B,QAAU,EAC/B,GAAI5nC,GAAQ4nC,EACV,OAAO/1B,EAAMtjB,GAEfyR,GAAQ4nC,CACV,CACA,OAAOiB,EAAQA,EAAQ76C,OAAS,GAAGO,EACrC,CAoEA,SAASy6C,GAAsBC,GAC7B,OAAQA,GACN,IAAK,SAhBPx8B,GAAS5B,OAASxQ,KAAK+E,IAAIqN,GAAS3B,UAAW2B,GAAS5B,OADrC,IAEnB4B,GAAShB,gBAAkBpR,KAAKmC,IAAIiQ,GAAShB,gBDnD5B,ICoEby8B,GAAQO,cAAgB,kBACxB,MACF,IAAK,SAhBT,WACE,MAAMS,EAAYvB,GAAkBK,MAC9B12B,EAAW43B,GAAW53B,UAAY,KACpCA,GAAY,GAAmBA,K9C1ErC,SAA8BA,GAAU,UAAE63B,GAAY,GAAU,CAAC,GAC/D,IAAK73B,IAAa,GAAmBA,GACnC,OAAO,EAET,IAAIvhB,EAAQqgB,GAAYC,UAAUjB,QAAQkC,IAC3B,IAAXvhB,IACFqgB,GAAYC,UAAU9gB,KAAK+hB,GAC3BvhB,EAAQqgB,GAAYC,UAAUriB,OAAS,GAErCm7C,EACF34B,GAAuBzgB,GAEvBmhB,IAGJ,C8C4DIk4B,CAAqB93B,EAAU,CAAE63B,WAAW,IAC5C93B,GAAgBC,GAChBY,GAAiBZ,GAErB,EASM+3B,GACAnB,GAAQO,cAAgB,wBACxB,MAEF,SAvCJ,WACE,MAAMp4B,EAAYK,KAClB,IAAK,MAAMY,KAAYjB,EAAW,CAChC,MAAMwB,EAAQR,GAAgBC,GACzBO,GAASA,EAAMF,WAAa/U,OAAOgV,mBAGxCM,GAAiBZ,EACnB,CACA7E,GAASsB,WAAY,CACvB,CA8BMu7B,GACApB,GAAQO,cAAgB,gBAG5BP,GAAQQ,YAAcR,GAAQS,eAC9B,MAAMY,EAAa5B,GAAkBsB,GACrC,GAAIM,GAAYzB,gBAAiB,CAC/B,MAAM0B,EAAgBnvC,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAmC,GAA7BysC,EAAWzB,kBACpD0B,EAAgB,IAClB9sC,GAAa8sC,GACbtB,GAAQO,cAAgB,GAAGP,GAAQO,mBAAmBe,eAE1D,CACF,CAEA,SAASC,GAAgBC,EAAM7zB,GAC7B,MAAMhH,EAAUpC,GAAS/W,EACnB8T,EAAOiD,GAASQ,aAAe08B,MAAM9hC,SACrC+hC,EAAcn9B,GAAS/U,EAAI6R,GAAeC,GAG1C6nB,EAAKxiB,EAFU66B,EAAKh0C,EAGpB47B,EAAKsY,GAFUF,EAAKhyC,EAAkB,GAAdgyC,EAAKx0C,QAInC,OADiBmF,KAAKs3B,MAAMN,EAAIC,IDxGlB,IC0GZoY,EAAKvyC,UAAY,GAAMuyC,EAAKvyC,UAAoB,EAAR0e,EAAW,EAAG,IAC/C,IAET6zB,EAAKvyC,UAAY,GAAMuyC,EAAKvyC,UAAoB,EAAR0e,EAAW,EAAG,IAC/C,EACT,CAEA,SAASg0B,GAAWH,GAClBV,GAAsBU,EAAKT,QAC3BS,EAAKn/B,MAAQ,YACbm/B,EAAKI,aDlHa,ICmHlBJ,EAAKvyC,UAAY,EACjB,MAAM4yC,EAAkBpC,GAAkB+B,EAAKT,SAASnB,iBAAmB,EAC3E,GAAIiC,EAAkB,EAAG,CACvB,MAAMC,EAAiB3vC,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAwB,GAAlBitC,IAC9C,GAAIC,EAAiB,EAAG,CACtB,MAAMtK,EAASrlC,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMktC,EAAiB,KACjDrK,EAAYtlC,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMktC,EAAiBtK,IAC1D,IAAK,IAAI3xC,EAAI,EAAGA,EAAI2xC,EAAQ3xC,GAAK,EAAG,CAClC,MAAMk8C,EAAiC,IAAvB5vC,KAAK4C,SAAW,IAChCF,GAAmB,CACjBrH,EAAGg0C,EAAKh0C,EAAIu0C,EACZvyC,EAAGgyC,EAAKhyC,EACR6E,OAAQojC,EACRziC,IAAK,IAAsB,GAAhB7C,KAAK4C,UAEpB,CACF,CACF,CACF,CACA,SAASitC,GAAkBr0B,GACrBqyB,GAAQC,eAAiB,GAAKF,GAAYj6C,OD9I9B,ICalB,SAAyBi7C,GACvB,MAAMh1C,EAAa0zC,GAAkBsB,IAAWtB,GAAkB7iC,KAG5D3F,EAAWgrC,sBACXC,EAAe/vC,KAAKmC,IAAIpH,KAAwB,IAAX+J,GAErCzJ,GADY2E,KAAKmC,IAAI,EAAG2C,EAA0B,EAAfirC,GAC/B,GAAMjrC,GAAY,GAAsB,GAAhB9E,KAAK4C,UAAiBmtC,EAAcjrC,EAAWirC,IAE3EV,EAAO,CACXn7C,GAAI,UAAU25C,GAAQU,cAAgB,IACtCK,OAAQh1C,EAAW1F,GACnBia,MAAOvU,EAAWuU,MAClBhF,YAAavP,EAAWuP,YACxBqkC,WAAY5zC,EAAW4zC,YAAc,UACrCxuC,UAAWpF,EAAWoF,WAAa,UACnCjE,MAdY,GAeZF,OAda,GAebQ,IACAgC,GAXa,IAYbsF,GD/BU,IC+BW,EAAhB3C,KAAK4C,SAAe,GACzBC,GAAI,EACJqN,MAAO,aACPqhB,MAAO,EACPz0B,UAAW,EACX2yC,aDhCY,GCiCZO,eAAgB,GAElBpC,GAAY14C,KAAKm6C,GACjBxB,GAAQI,gBAAkB,GAAGr0C,EAAWuU,iBACxC0/B,GAAQK,cAAgBL,GAAQM,gBAClC,CAmGI8B,CAAgBpC,GAAQE,gBAtI1BF,GAAQC,cDXK,GCVgB,GAAhB9tC,KAAK4C,SAsBlBirC,GAAQE,eAAiBC,MAyIrBH,GAAQK,cAAgB,IAC1BL,GAAQK,cAAgBluC,KAAKmC,IAAI,EAAG0rC,GAAQK,cAAgB1yB,IAE1DqyB,GAAQQ,YAAc,IACxBR,GAAQQ,YAAcruC,KAAKmC,IAAI,EAAG0rC,GAAQQ,YAAc7yB,IAG1D,IAAK,IAAI9nB,EAAIk6C,GAAYj6C,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CACnD,MAAM27C,EAAOzB,GAAYl6C,GAEzB,GADA27C,EAAK9d,OAAS/V,EACK,eAAf6zB,EAAKn/B,MAAwB,CAC/Bm/B,EAAKxsC,GAAK7C,KAAK+E,ID1JF,IC0J4CsqC,EAAKxsC,GD3J7C,IC2J6F2Y,GAC9G6zB,EAAKhyC,GAAKgyC,EAAKxsC,GAAK2Y,EACpB,MAAM1W,EAAWgrC,sBACjBT,EAAKh0C,EAAI,GAAMg0C,EAAKh0C,EAAIg0C,EAAK1sC,GAAK6Y,EAAoB,GAAb6zB,EAAKt0C,MAAa+J,EAAwB,GAAbuqC,EAAKt0C,OAC3Es0C,EAAKW,gBAAkBx0B,EACnB6zB,EAAKhyC,GAAKzC,EAAWy0C,EAAKx0C,SAC5Bw0C,EAAKhyC,EAAIzC,EAAWy0C,EAAKx0C,OACzBw0C,EAAKxsC,GAAK,EACVwsC,EAAKn/B,MAAQ,QACbm/B,EAAK9d,MAAQ,EAEjB,MAAO,GAAmB,UAAf8d,EAAKn/B,OAEd,GADqBk/B,GAAgBC,EAAM7zB,GAEzCg0B,GAAWH,QAGX,GADAA,EAAKI,cAAgBj0B,EACjB6zB,EAAKI,cAAgB,EAAG,CAC1B7B,GAAY34C,OAAOvB,EAAG,GACtB,QACF,OAEG,GAAmB,cAAf27C,EAAKn/B,QACdm/B,EAAKvyC,UAAY,GAAMuyC,EAAKvyC,UAAoB,GAAR0e,EAAa,EAAG,GACxD6zB,EAAKI,cAAgBj0B,EACjB6zB,EAAKI,cAAgB,GAAG,CAC1B7B,GAAY34C,OAAOvB,EAAG,GACtB,QACF,CAEJ,CACF,CC1NA,SAASw8C,GAAUb,GACjB,MAAMc,EAA2B,cAAfd,EAAKn/B,MAAwB,GAAMm/B,EAAKI,aFmCxC,IEnC8F,EAAG,GAAK,EAIxH,GAHA,EAAQlG,OACR,EAAQ6G,YAAcD,EAEH,eAAfd,EAAKn/B,MAAwB,CAC/B,MAAMmgC,EAA8B,IAAbhB,EAAKt0C,MACtBu1C,EAA6B,GAAdjB,EAAKx0C,OAC1B,EAAQquC,UAAYmG,EAAKrwC,UACzB,EAAQmqC,YACR,EAAQS,OAAOyF,EAAKh0C,EAAqB,GAAjBg1C,EAAsBhB,EAAKhyC,EAAmB,GAAfizC,GACvD,EAAQC,iBAAiBlB,EAAKh0C,EAAGg0C,EAAKhyC,EAAmB,GAAfizC,EAAoBjB,EAAKh0C,EAAqB,GAAjBg1C,EAAsBhB,EAAKhyC,EAAmB,GAAfizC,GACtG,EAAQzG,YACR,EAAQR,OAER,EAAQmH,YAAcnB,EAAKrwC,UAC3B,EAAQw1B,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAOyF,EAAKh0C,EAAqB,GAAjBg1C,EAAsBhB,EAAKhyC,EAAmB,IAAfizC,GACvD,EAAQG,OAAOpB,EAAKh0C,EAAiB,IAAbg0C,EAAKt0C,MAAcs0C,EAAKhyC,EAAkB,GAAdgyC,EAAKx0C,QACzD,EAAQ+uC,OAAOyF,EAAKh0C,EAAqB,GAAjBg1C,EAAsBhB,EAAKhyC,EAAmB,IAAfizC,GACvD,EAAQG,OAAOpB,EAAKh0C,EAAiB,IAAbg0C,EAAKt0C,MAAcs0C,EAAKhyC,EAAkB,GAAdgyC,EAAKx0C,QACzD,EAAQ61C,QACV,CAEA,MAAM1zC,EAAWqyC,EAAKrwC,UAChBR,EAAY6wC,EAAK7B,WACjBmD,EAAiBtB,EAAKvyC,WAAa,EAEzC,EAAQosC,UAAY1qC,EACpB,EAAQoyC,SAASvB,EAAKh0C,EAAiB,GAAbg0C,EAAKt0C,MAAas0C,EAAKhyC,EAAGgyC,EAAKt0C,MAAOs0C,EAAKx0C,QACrE,EAAQquC,UAAYlsC,EACpB,EAAQ4zC,SAASvB,EAAKh0C,EAAiB,GAAbg0C,EAAKt0C,MAAas0C,EAAKhyC,EAAkB,IAAdgyC,EAAKx0C,OAAew0C,EAAKt0C,MAAqB,IAAds0C,EAAKx0C,QAE1F,EAAQ21C,YAAc,yBACtB,EAAQhc,UAAY,EACpB,EAAQqc,WAAWxB,EAAKh0C,EAAiB,GAAbg0C,EAAKt0C,MAAas0C,EAAKhyC,EAAGgyC,EAAKt0C,MAAOs0C,EAAKx0C,QAEnE81C,EAAiB,IACnB,EAAQP,YAA+B,GAAjBO,EACtB,EAAQzH,UAAYmG,EAAKrwC,UACzB,EAAQmqC,YACR,EAAQC,IAAIiG,EAAKh0C,EAAGg0C,EAAKhyC,EAAkB,GAAdgyC,EAAKx0C,OFRtB,GEQuE,EAAa,EAAVmF,KAAKC,IAC3F,EAAQopC,QAGV,EAAQS,SACV,CChDA,MAAMgH,GAA2BvuC,OAAOgV,kBAGxC,SAASw5B,GAAetiC,GACtB,IAAIhb,EAASgb,EACb,KAAOhb,IAAWuM,KAAKC,IACrBxM,GAAoB,EAAVuM,KAAKC,GAEjB,KAAOxM,EAASuM,KAAKC,IACnBxM,GAAoB,EAAVuM,KAAKC,GAEjB,OAAOxM,CACT,CAuCA,SAASu9C,GAAgBC,GAAQ,YAAEviC,EAAW,QAAEhK,EAAO,QAAEsK,EAAO,QAAEF,EAAO,QAAEC,EAAO,UAAE9Q,EAAS,OAAE0J,GAAU6T,GACvG,MAAM9J,EAxBR,SAAyBu/B,EAAQC,EAAoB,KACnD,OAAKD,GAgB2B,iBAArBA,EAAOhzC,YAChBgzC,EAAOhzC,UAAYizC,GAEdD,GAlBE,CACLxiC,MAAO,EACPC,YAAa,EACbC,QAAS,EACTC,QAAS,EACTC,UAAW,EACXC,QAAS,EACTC,QAAS,EACTrK,QAAS,EACTsK,QAAS,EACT/Q,UAAWizC,EACXvpC,QAAQ,EACRsH,YAAa,EAOnB,CAGckiC,CAAgBF,EAAQhzC,GAC9ByK,EAA6B,oBAAhBD,YAA8BA,YAAYC,MAAQC,KAAKD,MACpE0oC,EApCR,SAAmB35B,EAAStf,EAAQ8F,EAAWud,GAC7C,MAAM61B,EALR,SAA2B55B,EAAStf,GAClC,OAAO44C,GAAe54C,EAASsf,EACjC,CAGe65B,CAAkB75B,EAAStf,GACxC,IAAKoK,OAAOC,SAAS6uC,GACnB,OAAOl5C,EAET,MAAMo5C,EAAOvxC,KAAKmC,IAAI,EAAGlE,GAAa,KAEtC,OAAO8yC,GAAet5B,EAAU45B,GADjB,EAAIrxC,KAAK8hB,KAAKyvB,EAAOvxC,KAAKmC,IAAIqZ,EAAO,KAEtD,CA4BoBg2B,CAAU9/B,EAAIjD,OAASC,EAAaA,EAAazQ,GAAayT,EAAIzT,UAAWud,GACzF7M,EAAU3O,KAAKuO,IAAI6iC,GACnBxiC,EAAU5O,KAAKwO,IAAI4iC,GAYzB,OAXA1/B,EAAIhD,YAAcA,EAClBgD,EAAIjD,MAAQ2iC,EACZ1/B,EAAI/C,QAAUpM,OAAOC,SAASmM,GAAWA,EAAU,EACnD+C,EAAI9C,QAAUrM,OAAOC,SAASoM,GAAWA,EAAU,EACnD8C,EAAI5C,QAAUA,EACd4C,EAAI3C,QAAUA,EACd2C,EAAIhN,QAAUA,EACdgN,EAAI1C,QAAUA,EACd0C,EAAI7C,UAAY7O,KAAKs3B,MAAM5yB,EAAUoK,EAASE,EAAUD,GACxD2C,EAAI/J,OAASuf,QAAQvf,GACrB+J,EAAIzC,YAAcvG,EACXgJ,CACT,CAuBA,SAAS+/B,KACP,OAAIlsC,GAAMJ,OAASI,GAAMF,MAChBrF,KAAKC,GAEVsF,GAAMF,QAAUE,GAAMJ,KACjB,EAELI,GAAMG,OAAS0M,GAASnC,SACT,GAAVjQ,KAAKC,GAEVmS,GAASzP,IAAM3C,KAAK0xC,IAAIt/B,GAASzP,IAAM,EAClCyP,GAASzP,GAAK,EAAI,EAAI3C,KAAKC,GAE7BmS,GAASxU,QAAU,EAAI,EAAIoC,KAAKC,EACzC,CAEA,SAAS0xC,GAAkBC,EAAQziC,GACjC,MAAM0iC,EAAe1iC,GAAQ,GAAM3B,SAC7BC,EAAaokC,EAAapkC,YAAc,GACxCqkC,EAAkBD,EAAajkC,UAAqC,GAAzBikC,EAAajkC,UAAkB,EAE1EmkC,EADQH,EAAOv0C,EAAiB,EAAboQ,EACCqkC,EAC1B,MAAO,CACLz2C,EAAGu2C,EAAOv2C,EACVgC,EAAG00C,EAEP,CAsDA,SAASC,GAAc99C,GACrB,OAAKA,EAGEqN,GAAQsY,KAAMhF,GAAUA,EAAM3gB,KAAOA,IAAO,KAF1C,IAGX,CAsGA,SAAS+9C,GAAgBz2B,GACvB3T,KAhKF,SAAyB2T,GACvB,MAAM9S,EAA6B,oBAAhBD,YAA8BA,YAAYC,MAAQC,KAAKD,MACpEyG,EAAOiD,GAASnE,QAAU,GAAMA,QAAWmE,GAASpE,UAAY,GAAMA,UAAY,GAAMR,SACxF0kC,EAASP,GAAkBv/B,GAAUjD,GACrCgjC,EArDR,WACE,MAAMrqC,EAAS7C,KACTK,EAAUwC,GAAQxC,SAAW,EAC7ByC,EAAUD,GAAQzK,GAAK,EAC7B,MAAO,CACLhC,EAAGiM,GAAQC,QAAUjC,EACrBjI,EAAGiK,GAAQE,QAAUO,EAEzB,CA6CuBqqC,GACfC,EAAiBF,EAAa92C,EAAI62C,EAAO72C,EACzCi3C,EAAiBH,EAAa90C,EAAI60C,EAAO70C,EACzCk1C,EAAkBvyC,KAAKs3B,MAAM+a,EAAgBC,GAC7CE,GAAoBlrC,GAAQM,YAAc,GAAK,EAC/C6qC,EAAqBF,GAhIJ,EAiIjBG,EAjDR,SAAyBhqC,GACvB,QAAKpB,GAAQK,UAGRpF,OAAOC,SAASsuC,KAIdpoC,GADMpB,GAAQM,YAAc,IACdkpC,GACvB,CAwCwB6B,CAAgBjqC,GAChCkqC,EAAmBH,IAAuBC,GAAiBF,GAEjE,IAAI9tC,EACAsK,EACAN,EAEJ,GAAIkkC,EACFluC,EAAUytC,EAAa92C,EACvB2T,EAAUmjC,EAAa90C,EACvBqR,EAAc1O,KAAK6yC,MAAMP,EAAgBD,QACpC,GAAIjgC,GAASV,IAAK,CACvB,MAAMohC,EAAgB1gC,GAASV,IAAIhD,aAAe0D,GAASV,IAAIjD,OAASgjC,KAClEsB,EAAQ,IACdrkC,EAAcokC,EACdpuC,EAAUwtC,EAAO72C,EAAI2E,KAAKuO,IAAIukC,GAAiBC,EAC/C/jC,EAAUkjC,EAAO70C,EAAI2C,KAAKwO,IAAIskC,GAAiBC,CACjD,KAAO,CACL,MAAMC,EAAgBvB,KACtB/iC,EAAcskC,EACd,MAAMD,EAAQ,IACdruC,EAAUwtC,EAAO72C,EAAI2E,KAAKuO,IAAIykC,GAAiBD,EAC/C/jC,EAAUkjC,EAAO70C,EAAI2C,KAAKwO,IAAIwkC,GAAiBD,CACjD,CAEA,MAAMrhC,EAAMs/B,GAAgB5+B,GAASV,IAAK,CACxChD,YAAaqiC,GAAeriC,GAC5BhK,UACAsK,UACAF,QAASojC,EAAO72C,EAChB0T,QAASmjC,EAAO70C,EAChBY,UAAWmU,GAASV,KAAKzT,WAAa,GACtC4Q,UAAW0jC,EACX5qC,OAAQirC,GACPp3B,GACHpJ,GAASV,IAAMA,EAEXkhC,GAAoBlhC,IACtBU,GAASxU,OAAS8T,EAAI/C,SAAW,EAAI,GAAK,EAE9C,CA+GEskC,CAAgBz3B,GAtGlB,SAAyBA,GACvB,IAAK,MAAM7F,KAAQ9B,GAAY,CAC7B,MACMq+B,EAASP,GAAkBh8B,EADpB,GAAMnI,UAEbqH,EAAQm9B,GAAcr8B,EAAK7D,eAC3BpN,EAAUmQ,EAAQA,EAAMxZ,EAAI+W,GAASV,KAAKhN,SAAYiR,EAAKta,EAAkB,IAAdsa,EAAK/X,OACpEoR,EAAU6F,EAAQA,EAAMxX,EAAmB,IAAfwX,EAAMha,OAAgBuX,GAASV,KAAK1C,SAAW2G,EAAKtY,EAChFoR,EAAQzO,KAAK6yC,MAAM7jC,EAAUkjC,EAAO70C,EAAGqH,EAAUwtC,EAAO72C,GAC9Dsa,EAAKjE,IAAMs/B,GAAgBr7B,EAAKjE,IAAK,CACnChD,YAAaqiC,GAAetiC,GAC5B/J,UACAsK,UACAF,QAASojC,EAAO72C,EAChB0T,QAASmjC,EAAO70C,EAChBY,UAAW0X,EAAKjE,KAAKzT,WAAa,GAClC0J,OAAQuf,QAAQrS,IACf2G,GACC7F,EAAKjE,MACPiE,EAAK/X,OAAS+X,EAAKjE,IAAI/C,SAAW,EAAI,GAAK,EAE/C,CACF,CAkFEukC,CAAgB13B,GAhFlB,SAAyBA,GACvB,MAAM23B,EAAexB,GAAkBv/B,GAAUA,GAASnE,QAAU,GAAMA,QAAWmE,GAASpE,UAAY,GAAMA,UAAY,GAAMR,UAClI,IAAK,MAAMqH,KAAStT,GAAS,CAC3B,GAAIsT,EAAMrE,QAAU,EAClB,SAEF,MAAM0hC,EAAS,CACb72C,EAAGwZ,EAAMxZ,EACTgC,EAAGwX,EAAMxX,EAA4B,KAAvBwX,EAAMha,QAAU,MAE1B6J,EAAUyuC,EAAa93C,EACvB2T,EAAUmkC,EAAa91C,EACvBoR,EAAQzO,KAAK6yC,MAAM7jC,EAAUkjC,EAAO70C,EAAGqH,EAAUwtC,EAAO72C,GAC9DwZ,EAAMnD,IAAMs/B,GAAgBn8B,EAAMnD,IAAK,CACrChD,YAAaqiC,GAAetiC,GAC5B/J,UACAsK,UACAF,QAASojC,EAAO72C,EAChB0T,QAASmjC,EAAO70C,EAChBY,UAAW4W,EAAMnD,KAAKzT,WAAa,GACnC0J,QAAQ,GACP6T,GACC3G,EAAMnD,MACRmD,EAAMjX,OAASiX,EAAMnD,IAAI/C,SAAW,EAAI,GAAK,EAEjD,CACF,CAuDEykC,CAAgB53B,GArDlB,SAAgCA,GAC9B,IAAK,MAAM2U,KAAWW,GAAU,CAC9B,MAAMl3B,EAAamyB,GAAoBoE,EAAQ7yB,MAC/C,IAAK1D,EACH,SAEF,MAAMy5C,EAAYz5C,EAAWqzB,gBAAkB,GAC1CrxB,MAAMC,QAAQs0B,EAAQM,UACzBN,EAAQM,OAAS,IAEnB,IAAK,IAAI/6B,EAAQ,EAAGA,EAAQ29C,EAAU1/C,OAAQ+B,GAAS,EAAG,CACxD,MAAMg7B,EAAW2iB,EAAU39C,GAC3B,IAAKg7B,EACH,SAEF,MAAM4iB,EAAanjB,EAAQM,OAAO/6B,KAAWy6B,EAAQM,OAAO/6B,GAAS,CAAC,GAChE69C,EAAc7iB,EAASjwB,QAAU,CAAEpF,EAAG,EAAGgC,EAAG,GAC5Cm2C,GAAgD,IAAjC9iB,EAAS+iB,oBACxBC,EAAmBF,EAAgBrjB,EAAQvyB,QAAU,EAAK,EAC1DkR,EAAUqhB,EAAQ90B,GAAKk4C,EAAYl4C,GAAK,GAAKq4C,EAC7C3kC,EAAUohB,EAAQ9yB,GAAKk2C,EAAYl2C,GAAK,GAC9C,IAAIqH,EACAsK,EACArH,GAAS,EACb,GAAyB,oBAArBwoB,EAAQE,UAAkCje,GAASV,IACrDhN,EAAU0N,GAASV,IAAIhN,QACvBsK,EAAUoD,GAASV,IAAI1C,QACvBrH,EAASyK,GAASV,IAAI/J,WACjB,CACL,MACMqrC,GADctiB,EAAS9yB,QAAU,IAAM41C,EAAgBrjB,EAAQvyB,QAAU,EAAK,IAChD,EAAI,EAAIoC,KAAKC,GAC3C8yC,EAAQriB,EAAShnB,OAAS,IAChChF,EAAUoK,EAAU9O,KAAKuO,IAAIykC,GAAiBD,EAC9C/jC,EAAUD,EAAU/O,KAAKwO,IAAIwkC,GAAiBD,CAChD,CACA,MAAMtkC,EAAQzO,KAAK6yC,MAAM7jC,EAAUD,EAASrK,EAAUoK,GACtDwkC,EAAW5hC,IAAMs/B,GAAgBsC,EAAW5hC,IAAK,CAC/ChD,YAAaqiC,GAAetiC,GAC5B/J,UACAsK,UACAF,UACAC,UACA9Q,UAAWq1C,EAAW5hC,KAAKzT,WAAa,GACxC0J,UACC6T,EACL,CACF,CACF,CAOEm4B,CAAuBn4B,EACzB,CC/PA,SAASo4B,GAAmB1B,GAAQ,OAAEv+C,EAAM,SAAEkgD,EAAQ,cAAEC,EAAgB,EAAC,QAAE5zC,EAAU,EAAC,YAAE6zC,EAAc,KACpG,MAAMC,EAAkBh0C,KAAKmC,IAAI,EAAGxO,EAASuM,GACvC+zC,EAAkC,IAAlBD,EAChBvzC,EAASszC,EAAcD,EACvBvlC,EAAMvO,KAAKuO,IAAIslC,GACfrlC,EAAMxO,KAAKwO,IAAIqlC,GAKrB,MAAO,CACLK,MAAO,CAAE74C,EALI62C,EAAO72C,EAAIkT,EAAM0lC,EAAgBzlC,EAAM/N,EAKhCpD,EAJP60C,EAAO70C,EAAImR,EAAMylC,EAAgB1lC,EAAM9N,GAKpD0zC,KAAM,CAAE94C,EAJI62C,EAAO72C,EAAIkT,EAAMylC,EAIX32C,EAHN60C,EAAO70C,EAAImR,EAAMwlC,GAKjC,CAEA,SAASI,GAAmBC,GAAK,OAAE1gD,EAAM,QAAE2R,EAAO,MAAEshB,EAAK,KAAE0tB,IACzD,MAAMC,EAAQF,EAAIh5C,EAAIiK,EAChBkvC,EAAQ55C,EAER65C,EADQz0C,KAAKmC,IAAI,GAAIykB,GACF0tB,EACnBI,EAAYL,EAAIh3C,EAAa,GAAT1J,EACpBghD,EAAQ30C,KAAK+E,IAAI2vC,EAAWF,EAAiB,IAAT7gD,EAAgB8gD,GAE1D,MAAO,CACLG,KAAM,CAAEv5C,EAFIg5C,EAAIh5C,EAAc,GAAViK,EAEFjI,EAAGs3C,GACrBE,KAAM,CAAEx5C,EAAGk5C,EAAOl3C,EAAGm3C,GAEzB,CAEA,SAASM,GAAST,EAAKU,EAAM/2C,EAAOw2B,EAAWoT,EAAQ,GACrD,EAAQ2B,OACR,EAAQiH,YAAcxyC,EACtB,EAAQw2B,UAAYA,EACpB,EAAQwgB,QAAU,QAClB,EAAQ5E,YAAcxI,EACtB,EAAQuB,YACR,EAAQS,OAAOyK,EAAIh5C,EAAGg5C,EAAIh3C,GAC1B,EAAQozC,OAAOsE,EAAKH,KAAKv5C,EAAG05C,EAAKH,KAAKv3C,GACtC,EAAQozC,OAAOsE,EAAKF,KAAKx5C,EAAG05C,EAAKF,KAAKx3C,GACtC,EAAQqzC,SACR,EAAQ5G,SACV,CAEA,SAASmL,GAAQC,EAAUC,EAAKn3C,EAAOw2B,EAAWoT,EAAQ,GACxD,EAAQ2B,OACR,EAAQiH,YAAcxyC,EACtB,EAAQw2B,UAAYA,EACpB,EAAQwgB,QAAU,QAClB,EAAQ5E,YAAcxI,EACtB,EAAQuB,YACR,EAAQS,OAAOsL,EAAS75C,EAAG65C,EAAS73C,GACpC,EAAQozC,OAAO0E,EAAIjB,MAAM74C,EAAG85C,EAAIjB,MAAM72C,GACtC,EAAQozC,OAAO0E,EAAIhB,KAAK94C,EAAG85C,EAAIhB,KAAK92C,GACpC,EAAQqzC,SACR,EAAQ5G,SACV,CAEA,SAASsL,GAASr5C,EAAOO,EAAQ0B,GAC/B,EAAQurC,OACR,EAAQL,UAAYlrC,EACpB,EAAQmrC,YACR,EAAQC,IAAIrtC,EAAMV,EAAGU,EAAMsB,EAAGf,EAAQ,EAAa,EAAV0D,KAAKC,IAC9C,EAAQopC,OACR,EAAQS,SACV,CAEA,SAASuL,GAAgBv8B,GACvB,IAAKA,IAAWA,EAAO1P,SACrB,OAAO,KAET,MAAMA,EAAW0P,EAAO1P,SACxB,GAAIA,EAAS4+B,WAAW,SAAU,CAChC,MAAMsN,EAAQlsC,EAASwN,SAAS,QAAUxN,EAASwN,SAAS,QACtDjjB,EAAS2hD,EAAQ,GAAK,GAC5B,MAAO,CACL3hD,SACA4hD,UAAWD,EAAQ,EAAI,EACvBt3C,MAAO,UACPw3C,YAAa,UACbC,aAAuB,GAAT9hD,EACd6oB,WAAY,UAEhB,CACA,GAAIpT,EAAS4+B,WAAW,gBAAiB,CACvC,MAAMr0C,EAAS,GACf,MAAO,CACLA,SACA4hD,UAAW,GACXv3C,MAAO,UACPw3C,YAAa,UACbC,aAAuB,IAAT9hD,EACd6oB,WAAY,UAEhB,CACA,GAAIpT,EAAS4+B,WAAW,cAAe,CACrC,MAAMr0C,EAAS,GACf,MAAO,CACLA,SACA4hD,UAAW,EACXv3C,MAAO,UACPw3C,YAAa,UACbC,aAAuB,IAAT9hD,EACd6oB,WAAY,UAEhB,CACA,GAAIpT,EAAS4+B,WAAW,UAAW,CACjC,MAAMr0C,EAAS,GACf,MAAO,CACLA,SACA4hD,UAAW,EACXv3C,MAAO,UACPw3C,YAAa,UACbC,aAAuB,IAAT9hD,EACd6oB,WAAY,UAEhB,CACA,OAAIpT,EAAS4+B,WAAW,aACf,CACLr0C,OAAQ,GACR4hD,UAAW,GACXv3C,MAAO,UACPw3C,YAAa,UACbC,aAAc,EACdj5B,WAAY,WAGT,IACT,CA+BA,SAASk5B,GAAoBr6C,EAAGgC,EAAGtC,EAAOF,EAAQyB,GAChD,MAAMurC,EAAI7nC,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAIzI,EAAkC,GAA1B0D,KAAK+E,IAAIhK,EAAOF,KACvD,EAAQsuC,YACR,EAAQS,OAAOvuC,EAAIwsC,EAAGxqC,GACtB,EAAQozC,OAAOp1C,EAAIN,EAAQ8sC,EAAGxqC,GAC9B,EAAQkzC,iBAAiBl1C,EAAIN,EAAOsC,EAAGhC,EAAIN,EAAOsC,EAAIwqC,GACtD,EAAQ4I,OAAOp1C,EAAIN,EAAOsC,EAAIxC,EAASgtC,GACvC,EAAQ0I,iBAAiBl1C,EAAIN,EAAOsC,EAAIxC,EAAQQ,EAAIN,EAAQ8sC,EAAGxqC,EAAIxC,GACnE,EAAQ41C,OAAOp1C,EAAIwsC,EAAGxqC,EAAIxC,GAC1B,EAAQ01C,iBAAiBl1C,EAAGgC,EAAIxC,EAAQQ,EAAGgC,EAAIxC,EAASgtC,GACxD,EAAQ4I,OAAOp1C,EAAGgC,EAAIwqC,GACtB,EAAQ0I,iBAAiBl1C,EAAGgC,EAAGhC,EAAIwsC,EAAGxqC,GACtC,EAAQwsC,WACV,CAoOA,SAAS8L,GAAkBC,GACzB,MAAM,OACJhE,EAAM,KACNziC,EAAO,GAAM3B,SACbkE,IAAKmkC,EAAY,KAAI,OACrB/8B,EAAS,KACTg9B,aAAcC,EAAuB,KAAI,UACzCC,EAAY,KAAI,aAChBC,EAAe,UAAS,aACxBC,EAAeD,EAAY,UAC3BzhB,EAAY,EAAC,UACbxmB,GAAY,EAAK,QACjBC,GAAU,EAAK,MACfE,EAAQ,KAAI,WACZgoC,EAAa,UAAS,cACtBC,GAAgB,EAAK,YACrBC,EAAc,KAAI,YAClBC,EAAc,UAAS,WACvBC,EAAa,KAAI,YACjBC,EAAc,EAAC,eACfz5C,EAAiB,KAAI,WACrB05C,EAAa,MACXb,EAEE/D,EAAe1iC,GAAQ,GAAM3B,SAE7BkE,EAxcR,SAAoBkgC,EAAQziC,EAAM0mC,EAAWa,EAAiB,GAC5D,MAAM1D,EAAgB0D,GAAkB,EAAI,EAAI12C,KAAKC,GAC/CiyC,EAASP,GAAkBC,EAAQziC,GACzC,IAAK0mC,EAGH,MAAO,CACLpnC,MAAOukC,EACPrkC,QAJS3O,KAAKuO,IAAIykC,GAKlBpkC,QAJS5O,KAAKwO,IAAIwkC,GAKlBlkC,QAASojC,EAAO72C,EAChB0T,QAASmjC,EAAO70C,EAChBsK,QAAQ,GAGZ,MAAM8G,EAAQlM,OAAOC,SAASqzC,EAAUpnC,OAASonC,EAAUpnC,MAAQukC,EAKnE,MAAO,CACLvkC,QACAE,QANcpM,OAAOC,SAASqzC,EAAUlnC,SAAWknC,EAAUlnC,QAAU3O,KAAKuO,IAAIE,GAOhFG,QANcrM,OAAOC,SAASqzC,EAAUjnC,SAAWinC,EAAUjnC,QAAU5O,KAAKwO,IAAIC,GAOhFK,QANcvM,OAAOC,SAASqzC,EAAU/mC,SAAW+mC,EAAU/mC,QAAUojC,EAAO72C,EAO9E0T,QANcxM,OAAOC,SAASqzC,EAAU9mC,SAAW8mC,EAAU9mC,QAAUmjC,EAAO70C,EAO9EsK,OAAQuf,QAAQ2uB,EAAUluC,QAE9B,CA4acgvC,CAAW/E,EAAQC,EAAcgE,EADtBjE,EAAOh0C,UAAYg0C,EAAOjvC,IAAM,IAAM,EAAI,GAAK,IAEhEmzC,EAAeC,GAAwBV,GAAgBv8B,GAEvDrL,EAAaokC,EAAapkC,YAAc,GACxCC,EAAamkC,EAAankC,YAAc,GACxCC,EAAYkkC,EAAalkC,WAAa,GACtCC,EAAYikC,EAAajkC,WAAa,GAEtCgpC,EAAYhF,EAAOjvC,IAAM,EACzBk0C,EAAa,GAAM72C,KAAK0xC,IAAIkF,GAAatpC,GAAO,EAAG,GACnDyjB,EAAUC,KACV8lB,EAA8C,IAAlC,GAAMF,EAAYtpC,IAAQ,EAAG,GAEzCypC,EAAe/oC,EAAY,EAAI,EAC/BgpC,EAAcpF,EAAOv2C,EAAgB,EAAZy7C,EACzBG,EAAcrF,EAAOv0C,EAAIoQ,EAA4B,GAAfspC,EACtCG,EAAQtF,EAAOv0C,EAAiB,EAAboQ,EAAgC,GAAfspC,EACpChF,EAAYmF,EAAQ,EAAmB,GAAfH,EAIxB7B,EAAW,CAAE75C,EAAG27C,EAAa35C,EAAG00C,GAChCsC,EAAM,CAAEh5C,EAJDu2C,EAAOv2C,EAAgB,EAAZy7C,EAIDz5C,EAHV00C,EAAYrkC,EAAaqpC,GAKhCI,EAAcpmB,GAAW,IAAmB,IAAb8lB,GAC/BO,EAAczpC,GAAa,IAAoB,IAAbkpC,IAAsB7oC,EAAY,GAAM,GAC1EqpC,EAAarpC,EAAY,EAAIhO,KAAKmC,IAAI,EAAe,IAAZwL,GACzC2pC,EAAYt3C,KAAKwO,IAAI2oC,GACrBI,EAAav3C,KAAKwO,IAAI2oC,EAAcn3C,KAAKC,IACzCu3C,EAAyB,EAAZV,EAEbW,EAAcL,EAAcG,EAAaV,EAAalpC,EAAY,GAAM6pC,EAExEE,EAAUtD,GAAmBC,EAAK,CAAE1gD,OAAQga,EAAWrI,QAH3BgyC,EAAYT,EAAalpC,EAAY,GAAnDypC,EAAyDI,EAGK5wB,MAAO0wB,EAAWhD,KAAM+C,IACpGM,EAAWvD,GAAmBC,EAAK,CAAE1gD,OAAQga,EAAWrI,QAASmyC,EAAa7wB,MAAO2wB,EAAYjD,KAAM+C,IAEvGxD,EAAWniC,EAAIjD,MACfmpC,EAAOlmC,EAAI/C,QACXkpC,EAAOnmC,EAAI9C,QACXkpC,EAAcF,GAAQ,EAAI,GAAK,EAErC,IAAIG,EAAalE,EACbmE,GAAe,EACfC,GAAmB,GAAkB,EAAbpB,EACxBqB,GAAerE,EAAyB,IAAdiE,EAC1BK,GAAiB,IACjBC,GAAqB,EAAiB,EAAbvB,EAE7B,GAAIJ,GAAY9uC,OAAQ,CACtB,MAAM40B,EAAW,GAAMka,EAAWla,UAAY,EAAG,EAAG,IAC/Cka,EAAWn5C,MAAQ,IAAI0qC,WAAW,UACrCgQ,GAAe,IAAiB,IAAXzb,EACrB0b,GAAmB,GAAgB,GAAX1b,EACxBwb,EAAalE,EAAWiE,EAAcvb,EAAW,IACjD2b,GAAerE,EAAWiE,GAAe,IAAkB,IAAXvb,GAChD4b,GAAiB,MACP1B,EAAWn5C,MAAQ,IAAI0qC,WAAW,YAC5CgQ,GAAe,EACfC,GAAmB,GAAgB,GAAX1b,EACxB2b,GAAerE,EAAWiE,GAAe,IAAkB,IAAXvb,GAChD4b,GAAiB,IAErB,CAEA,MAAME,GAAWzE,GAAmBsB,EAAU,CAC5CvhD,OAAQia,EACRimC,SAAUkE,EACVjE,cAAegE,EACf53C,QAAS83C,GACTjE,YAAakE,KAGTK,GAAa1E,GAAmBsB,EAAU,CAC9CvhD,OAAQia,EAAYuqC,GACpBtE,SAAUqE,GACVpE,eAAgBgE,EAChB53C,QAASi4C,GACTpE,YAAaqE,KAGTG,GAAUT,GAAe,EAAIJ,EAAUC,EACvCa,GAAWV,GAAe,EAAIH,EAAWD,EACzCe,GAAUX,GAAe,EAAIQ,GAAaD,GAC1CK,GAAiBZ,GAAe,EAAIO,GAAWC,GAC/CK,GAAmBb,GAAe,EAAIQ,GAAaD,GAEnDO,GAAgBpkB,EAEhBqkB,GAAgB7C,GAAa,KAC7B8C,GAAcD,IAAe37B,QAAQhlB,OAAS,KAC9C6gD,GAAaF,IAAe17B,OAAOjlB,OAAS,KAC5C8gD,GAAeH,IAAez7B,SAASllB,OAAS,KAiFtD,GA/EI8gD,IAAsC,SAAtBA,GAAa17C,MAzVnC,SAA6BpF,GAAO,QAAE+gD,EAAO,SAAE/D,EAAQ,IAAEb,IACvD,IAAKn8C,EACH,OAEF,MAAMyF,EAAQu3C,EAAS73C,EAAI,EACrB67C,EAAiBl5C,KAAKmC,IAAI,GAAIkyC,EAAIh3C,EAAIM,EAAQ,IACpD,GAAmB,SAAfzF,EAAMoF,KAAiB,CACzB,MAAM67C,EAAY,GACZ14C,EAAS,GAkBf,GAjBA,EAAQ8oC,OACR,EAAQ6G,YAAc,GACtB,EAAQlH,UAAYhxC,EAAMsG,WAAa,UACvC,EAAQoyC,SAASqI,EAAUx4C,EAAS04C,EAAY,EAAGx7C,EAAOw7C,EAAWD,GACrE,EAAQtI,SAASqI,EAAUx4C,EAAS04C,EAAY,EAAGx7C,EAAOw7C,EAAWD,GACjEhhD,EAAMuG,cACR,EAAQ+xC,YAAct4C,EAAMuG,YAC5B,EAAQ+1B,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAOqP,EAAUx4C,EAAQ9C,EAAQ,GACzC,EAAQ8yC,OAAOwI,EAAUx4C,EAAQ9C,EAAQu7C,EAAiB,IAC1D,EAAQtP,OAAOqP,EAAUx4C,EAAQ9C,EAAQ,GACzC,EAAQ8yC,OAAOwI,EAAUx4C,EAAQ9C,EAAQu7C,EAAiB,IAC1D,EAAQxI,UAEV,EAAQ5G,UAEJ5xC,EAAMykB,aAAc,CACtB,MAAMy8B,EAAyB,GAAZD,EACbE,EAAc,GACpB,EAAQ9P,OACR,EAAQL,UAAYhxC,EAAMykB,aAC1B,EAAQyzB,YAAcl4C,EAAM0kB,cAAgB,GAC5C,EAAQusB,YACR,EAAQS,OAAOqP,EAAUx4C,EAAS24C,EAAa,EAAGz7C,EAAQu7C,GAC1D,EAAQzI,OAAOwI,EAAUx4C,EAAQ9C,EAAQu7C,EAAiBG,GAC1D,EAAQ5I,OAAOwI,EAAUx4C,EAAS24C,EAAa,EAAGz7C,EAAQu7C,GAC1D,EAAQrP,YACR,EAAQR,OACR,EAAQF,YACR,EAAQS,OAAOqP,EAAUx4C,EAAS24C,EAAa,EAAGz7C,EAAQu7C,GAC1D,EAAQzI,OAAOwI,EAAUx4C,EAAQ9C,EAAQu7C,EAAiBG,GAC1D,EAAQ5I,OAAOwI,EAAUx4C,EAAS24C,EAAa,EAAGz7C,EAAQu7C,GAC1D,EAAQrP,YACR,EAAQR,OACR,EAAQS,SACV,CACA,MACF,CACA,GAAmB,aAAf5xC,EAAMoF,KAAqB,CAC7B,MAAM67C,EAAY,GACZG,EAAat5C,KAAKmC,IAAI,GAAIkyC,EAAIh3C,EAAIM,EAAQ,IAYhD,GAXA,EAAQ4rC,OACR,EAAQ6G,YAAc,IACtB,EAAQlH,UAAYhxC,EAAMsG,WAAa,UACvCk3C,GAAoBuD,EAAUE,EAAY,EAAGx7C,EAAOw7C,EAAWG,EAAY,IAC3E,EAAQjQ,OACJnxC,EAAM2kB,aACR,EAAQqsB,UAAYhxC,EAAM2kB,WAC1B64B,GAAoBuD,EAAUE,EAAY,EAAI,EAAGx7C,EAAQ,EAAGw7C,EAAY,EAAGG,EAAa,GAAI,GAC5F,EAAQjQ,QAEV,EAAQS,UACJ5xC,EAAMykB,aAAc,CACtB,EAAQ4sB,OACR,EAAQL,UAAYhxC,EAAMykB,aAC1B,EAAQyzB,YAAcl4C,EAAM0kB,cAAgB,GAC5C,MAAMw8B,EAAa,GACbC,EAAc,GACpB,EAAQlQ,YACR,EAAQS,OAAOqP,EAAUG,EAAa,EAAGz7C,EAAQ27C,GACjD,EAAQ7I,OAAOwI,EAASt7C,EAAQ27C,EAAaD,GAC7C,EAAQ5I,OAAOwI,EAAUG,EAAa,EAAGz7C,EAAQ27C,GACjD,EAAQzP,YACR,EAAQR,OACR,EAAQS,SACV,CAEF,CACF,CA4QIyP,CAAoBP,GAAc,CAChCC,QAASrH,EAAOv2C,EAChB65C,WACAb,QAIJS,GAAST,EAAKkE,GAAStC,EAAc2C,GAAe,KACpD9D,GAAST,EAAKmE,GAAUvC,EAAc2C,GAAe,GAErD,EAAQrP,OACR,EAAQiH,YAAcyF,EACtB,EAAQzhB,UAAYokB,GACpB,EAAQ5D,QAAU,QAClB,EAAQ7L,YACR,EAAQS,OAAOsL,EAAS75C,EAAG67C,GAC3B,EAAQzG,OAAO4D,EAAIh5C,EAAGg5C,EAAIh3C,GAC1B,EAAQqzC,SACR,EAAQ5G,UAEJiP,IAAkC,SAApBA,GAAWz7C,MA9R/B,SAA2BpF,GAAO,QAAE+gD,EAAO,SAAE/D,EAAQ,IAAEb,EAAG,UAAE7f,IAC1D,IAAKt8B,EACH,OAEF,MAAMshD,EAAOtE,EAAS73C,EAAI,EACpBo8C,EAAUpF,EAAIh3C,EAAI,GACxB,GAAmB,YAAfnF,EAAMoF,KAoBR,OAnBA,EAAQisC,OACR,EAAQiH,YAAct4C,EAAMskB,YAAc,UAC1C,EAAQgY,UAAYx0B,KAAKmC,IAAI,EAAe,IAAZqyB,GAChC,EAAQwgB,QAAU,QAClB,EAAQ7L,YACR,EAAQS,OAAOqP,EAAU,GAAIO,GAC7B,EAAQ/I,OAAOwI,EAAU,EAAGQ,GAC5B,EAAQ7P,OAAOqP,EAAU,GAAIO,GAC7B,EAAQ/I,OAAOwI,EAAU,EAAGQ,GAC5B,EAAQ/I,SACJx4C,EAAMuG,cACR,EAAQ+xC,YAAct4C,EAAMuG,YAC5B,EAAQ+1B,UAAY,IACpB,EAAQ2U,YACR,EAAQS,OAAOqP,EAAU,GAAIO,EAAO,IACpC,EAAQ/I,OAAOwI,EAAU,GAAIO,EAAO,IACpC,EAAQ9I,eAEV,EAAQ5G,UAGV,GAAmB,YAAf5xC,EAAMoF,KAAoB,CAC5B,MAAMo8C,EAAa,GACbC,EAAc35C,KAAKmC,IAAI,GAAIs3C,EAAUD,GACrCI,EAASX,EAAUS,EAAa,EAoBtC,OAnBA,EAAQnQ,OACR,EAAQ6G,YAAc,IACtB,EAAQlH,UAAYhxC,EAAMukB,YAAc,UACxCi5B,GAAoBkE,EAAQJ,EAAME,EAAYC,EAAa,IAC3D,EAAQtQ,OACJnxC,EAAMqkB,YACR,EAAQi0B,YAAct4C,EAAMqkB,UAC5B,EAAQiY,UAAY,EACpBkhB,GAAoBkE,EAAS,EAAGJ,EAAO,EAAGE,EAAa,EAAGC,EAAc,EAAG,GAC3E,EAAQjJ,UAENx4C,EAAM8G,YACR,EAAQkqC,UAAYhxC,EAAM8G,UAC1B,EAAQoxC,YAAc,GACtB,EAAQjH,YACR,EAAQC,IAAI6P,EAASO,EAAqB,IAAdG,EAAoB,EAAG,EAAa,EAAV35C,KAAKC,IAC3D,EAAQopC,aAEV,EAAQS,SAEV,CACA,GAAmB,YAAf5xC,EAAMoF,KAAoB,CAC5B,MAAMu8C,EAAa,GACbC,EAAc,EACpB,EAAQvQ,OACR,EAAQ6G,YAAc,GACtB,EAAQlH,UAAYhxC,EAAMskB,YAAc,UACxC,IAAK,IAAI9oB,EAAI,EAAGA,EAAI,EAAGA,GAAK,EAAG,CAC7B,MAAM2J,EAAIm8C,EAAO,EAAQ,GAAJ9lD,EACrB,EAAQk9C,SAASqI,EAAUY,EAAa,EAAGx8C,EAAGw8C,EAAYC,EAC5D,CACA,GAAI5hD,EAAMwkB,WAAY,CACpB,MAAMq9B,EAAa,GACbC,EAAc,GACd38C,EAAIo8C,EAAUO,EAAc,EAClC,EAAQ9Q,UAAYhxC,EAAMwkB,WAC1B,EAAQk0B,SAASqI,EAAUc,EAAa,EAAG18C,EAAG08C,EAAYC,GAC1D,EAAQpJ,SAASqI,EAAU,EAAG57C,EAAG08C,EAAYC,EAC/C,CACI9hD,EAAMuG,cACR,EAAQ+xC,YAAct4C,EAAMuG,YAC5B,EAAQ+1B,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAOqP,EAAU,GAAIO,EAAO,IACpC,EAAQ/I,OAAOwI,EAAU,GAAIO,EAAO,IACpC,EAAQ9I,UAEV,EAAQ5G,SACV,CACF,CA8MImQ,CAAkBlB,GAAY,CAC5BE,QAASrH,EAAOv2C,EAChB65C,WACAb,MACA7f,UAAWokB,KAIf3D,GAAQC,EAAUuD,GAASvC,EAA8B,GAAhB0C,GAAqB,KAnahE,SAA0B9C,EAAc3B,EAAM+F,EAAarG,GACzD,IAAKiC,EACH,OAEF,MAAM,OAAEniD,EAAM,UAAE4hD,EAAS,MAAEv3C,EAAK,YAAEw3C,EAAW,aAAEC,EAAY,WAAEj5B,GAAes5B,EAC5E,EAAQvM,OACR,EAAQC,UAAU2K,EAAK94C,EAAG84C,EAAK92C,GAC/B,EAAQosC,OAAOoK,GACf,EAAQ3K,UAAYlrC,EACpB,EAAQ4yC,UAAU6E,EAA2B,IAAZF,EAAiB5hD,EAAQ4hD,GACtDC,IACF,EAAQtM,UAAYsM,EACpB,EAAQ5E,SAAkC,GAATj9C,EAAf8hD,EAA0C,KAAZF,EAA2B,IAAT5hD,EAA2B,IAAZ4hD,GACjF,EAAQ3E,SAAkC,GAATj9C,EAAf8hD,EAA0C,KAAZF,EAA2B,IAAT5hD,EAA2B,IAAZ4hD,IAEnF,EAAQzL,UAEJoQ,IACF,EAAQ3Q,OACR,EAAQiH,YAAch0B,GAAcxe,EACpC,EAAQw2B,UAAYx0B,KAAKmC,IAAI,EAAe,IAAZozC,GAChC,EAAQpM,YACR,EAAQS,OAAOuK,EAAK94C,EAAG84C,EAAK92C,GAC5B,EAAQozC,OAAOyJ,EAAY7+C,EAAG6+C,EAAY78C,GAC1C,EAAQqzC,SACR,EAAQ5G,UAEZ,CA0YEqQ,CAAiBrE,EAAcuC,GAASlE,KAAMmE,GAAWnE,KAAMN,GAE/DoB,GAAQC,EAAUyD,GAAkBzC,EAA8B,GAAhB0C,GAAqB,IACvE3D,GAAQC,EAAUwD,GAAgBzC,EAAc2C,GAAe,GAE/DxD,GAASkD,GAAWnE,KAAM,IAAK+B,GAC/Bd,GAASiD,GAASlE,KAAM,IAAK8B,GAE7B,EAAQ1M,OACR,EAAQiH,YAAcyF,EACtB,EAAQzhB,UAAYokB,GACpB,EAAQ5D,QAAU,QAClB,EAAQ7L,YACR,EAAQC,IAAI4N,EAAaC,EAAaxpC,EAAY,EAAa,EAAVzN,KAAKC,IAC1D,EAAQywC,SACR,EAAQ5G,UAEJgP,IAAoC,SAArBA,GAAYx7C,MAvOjC,SAA4BpF,GAAO,YAAE8+C,EAAW,YAAEC,EAAW,WAAExpC,EAAU,SAAEomC,IACzE,IAAK37C,EACH,OAEF,MAAMkiD,EAAc3sC,EAAa,EACjC,GAAmB,UAAfvV,EAAMoF,KAAkB,CAC1B,EAAQisC,OACR,EAAQyL,QAAU,QAClB,EAAQxE,YAAct4C,EAAMkkB,YAAc,UAC1C,EAAQoY,UAAyB,GAAb/mB,EACpB,EAAQ07B,YACR,EAAQC,IAAI4N,EAAaC,EAAamD,EAAuB,IAAVp6C,KAAKC,GAAqB,KAAVD,KAAKC,IACxE,EAAQywC,SACJx4C,EAAMuG,cACR,EAAQ+xC,YAAct4C,EAAMuG,YAC5B,EAAQ+1B,UAAyB,IAAb/mB,EACpB,EAAQ07B,YACR,EAAQC,IAAI4N,EAAaC,EAAamD,EAAc,EAAa,GAAVp6C,KAAKC,GAAoB,IAAVD,KAAKC,IAC3E,EAAQywC,UAEV,EAAQ5G,UAER,EAAQP,OACR,EAAQC,UAAUwN,EAAaC,GAC/B,EAAQxN,OAAOoK,GACf,MAAMwG,EAA0B,IAAb5sC,EACb6sC,EAA2B,GAAb7sC,EASpB,OARA,EAAQy7B,UAAYhxC,EAAMmkB,YAAc,UACxC,EAAQ+zB,YAAcl4C,EAAMokB,YAAc,IAC1C,EAAQs0B,UAAUyJ,EAAa,GAAIC,EAAc,EAAGD,EAAYC,GAChE,EAAQlK,YAAc,EACtB,EAAQI,YAAct4C,EAAMkkB,YAAc,UAC1C,EAAQoY,UAAY,EACpB,EAAQqc,YAAYwJ,EAAa,GAAIC,EAAc,EAAGD,EAAYC,QAClE,EAAQxQ,SAEV,CACmB,WAAf5xC,EAAMoF,OACR,EAAQisC,OACR,EAAQyL,QAAU,QAClB,EAAQxE,YAAct4C,EAAMkkB,YAAc,UAC1C,EAAQoY,UAAyB,GAAb/mB,EACpB,EAAQ07B,YACR,EAAQC,IAAI4N,EAAaC,EAAamD,EAAuB,GAAVp6C,KAAKC,GAAoB,IAAVD,KAAKC,IACvE,EAAQywC,SACJx4C,EAAMuG,cACR,EAAQ+xC,YAAct4C,EAAMuG,YAC5B,EAAQ+1B,UAAyB,IAAb/mB,EACpB,EAAQ07B,YACR,EAAQC,IAAI4N,EAAaC,EAAamD,EAAc,EAAa,GAAVp6C,KAAKC,GAAoB,IAAVD,KAAKC,IAC3E,EAAQywC,UAENx4C,EAAMqkB,YACR,EAAQi0B,YAAct4C,EAAMqkB,UAC5B,EAAQiY,UAAY,IACpB,EAAQ2U,YACR,EAAQC,IAAI4N,EAAaC,EAAamD,EAAc,EAAa,IAAVp6C,KAAKC,GAAqB,KAAVD,KAAKC,IAC5E,EAAQywC,UAEV,EAAQ5G,UAEZ,CA2KIyQ,CAAmBzB,GAAa,CAC9B9B,cACAC,cACAxpC,aACAomC,aAIA92C,IACF,EAAQwsC,OACR,EAAQiH,YAAczzC,EACtB,EAAQy3B,UAA4B,GAAhBokB,GACpB,EAAQxI,YAAc,GACtB,EAAQjH,YACR,EAAQC,IAAIwI,EAAOv2C,EAAGu2C,EAAOv0C,EAAIoQ,EAAYA,EAAa,EAAG,EAAa,EAAVzN,KAAKC,IACrE,EAAQywC,SACR,EAAQ5G,WAGNyM,GAAcC,EAAc,IAC9B,EAAQjN,OACR,EAAQL,UAAYqN,EACpB,EAAQnG,YAAc,GAAMoG,EAAa,EAAG,GAC5C,EAAQrN,YACR,EAAQC,IAAIiP,GAASlE,KAAK94C,EAAW,EAAPu8C,EAAUS,GAASlE,KAAK92C,EAAW,EAAPw6C,EAAU,GAAI,EAAa,EAAV73C,KAAKC,IAChF,EAAQopC,OACR,EAAQS,WAGNsM,GAAgC,MAAfC,EAAqB,CACxC,MAAMt7C,EAAQ,GACRF,EAAS,EACT2/C,EAAO5I,EAAOv2C,EAAIN,EAAQ,EAC1B0/C,EAAO7I,EAAOv0C,EAAiB,IAAboQ,EACxB,EAAQ87B,OACR,EAAQL,UAAY,UACpB,EAAQ0H,SAAS4J,EAAMC,EAAM1/C,EAAOF,GACpC,EAAQquC,UAAYoN,EACpB,EAAQ1F,SAAS4J,EAAMC,EAAM1/C,EAAQ,GAAMs7C,EAAa,EAAG,GAAIx7C,GAC/D,EAAQ21C,YAAc,UACtB,EAAQhc,UAAY,IACpB,EAAQqc,WAAW2J,EAAMC,EAAM1/C,EAAOF,GACtC,EAAQivC,SACV,CAEI37B,IACF,EAAQo7B,OACR,EAAQL,UAAYiN,EACpB,EAAQuE,KAAO,qCACf,EAAQC,UAAY,SACpB,EAAQC,SAASzsC,EAAOyjC,EAAOv2C,EAAGu2C,EAAOv0C,EAAiB,IAAboQ,GAC7C,EAAQq8B,UAEZ,CCpcA,SAAS+Q,GAAiBpY,EAAc1R,GACtC,MAAMyR,EAAWC,EAAaD,SAC9B,IAAKA,EACH,OAGF,MAAMsY,EAAWrY,EAAatxB,gBAAkB,EAC1CD,EAAauxB,EAAavxB,YAAc,EACxC6pC,EAAwB,EAAVhqB,EAA+B,IAAjB0R,EAAapnC,EACzC2/C,EAAS9pC,EAAa,EAAIlR,KAAKwO,IAAIusC,GAAeD,EAAW,IAAO,EACpEG,EAAS/pC,EAAa,EAAIlR,KAAKuO,IAAkB,IAAdwsC,GAAsBD,EAAW,IAAO,EASjF,GAPA,EAAQvR,OACR,EAAQC,UAAU/G,EAAapnC,EAAI2/C,EAAQvY,EAAaplC,EAAI49C,GAExDxY,EAAaC,WAhLnB,SAAoBD,EAAcD,EAAUjG,GAC1C,MAAMxhC,EAAQ0nC,EAAa1nC,MACrB2mC,EAAe1hC,KAAKmC,IAAI,GAAIqgC,EAASd,cAAgB,IAAMnF,GAC3D39B,EAAc4jC,EAAS5jC,aAAe4jC,EAAShkC,WAAa,UAClE,EAAQ0qC,UAAYtqC,EACpB,EAAQuqC,YACR,EAAQS,QAAQ7uC,EAAQ,EAAG,GAC3B,EAAQ01C,OAAgB,KAAR11C,EAA8B,IAAf2mC,GAC/B,EAAQ+O,OAAgB,KAAR11C,GAAe2mC,GAC/B,EAAQ+O,OAAe,IAAR11C,EAA8B,KAAf2mC,GAC9B,EAAQ+O,OAAe,IAAR11C,EAA8B,IAAf2mC,GAC9B,EAAQ+O,OAAO11C,EAAQ,EAAG,GAC1B,EAAQ8uC,YACR,EAAQR,OAER,EAAQH,UAAY,wBACpB,EAAQ0H,UAAU71C,EAAQ,EAAG,EAAGA,EAAOiF,KAAKmC,IAAI,EAAkB,GAAfu/B,GACrD,CAgKIwZ,CAAWzY,EAAcD,EAAU,GAAMC,EAAaG,aAAe,EAAG,EAAG,KAGxEH,EAAaC,YAAcD,EAAaG,aAAe,GAAK,EAC/D,OAAQJ,EAASrM,UACf,IAAK,WAnKX,SAAuBsM,EAAcD,GACnC,MAAMznC,EAAQ0nC,EAAa1nC,MACrBF,EAAS4nC,EAAa5nC,OACtBgC,GAAOhC,EACP+C,EAAS6kC,EAAa7kC,QAAU,EAChCu9C,EAAc,GAAM,EAAK1Y,EAAajyB,OAASiyB,EAAahyB,UAAY,EAAG,GAEjF,EAAQ84B,OACR,EAAQG,MAAM9rC,EAAQ,GAEtB,MAAMY,EAAYgkC,EAAShkC,WAAa,UAClC48C,EAAc5Y,EAASljC,YAAc,UACrCb,EAAc+jC,EAAS/jC,aAAe,UACtCK,EAAY0jC,EAAS1jC,WAAa,UAElCu8C,EAAUx+C,EAAe,IAAThC,EAChBygD,EAAuB,IAATzgD,EACdqxB,EAAclsB,KAAKmC,IAAI,GAAa,IAATtH,GAEjC,EAAQquC,UAAY1qC,EACpB,EAAQ2qC,YACR,EAAQS,QAAQ7uC,EAAQ,EAAGsgD,EAAmB,GAATxgD,GACrC,EAAQ41C,OAAgB,KAAR11C,EAAc8B,EAAoB,IAAdy+C,GACpC,EAAQ7K,OAAgB,KAAR11C,EAAc8B,GAC9B,EAAQ4zC,OAAe,IAAR11C,EAAc8B,GAC7B,EAAQ4zC,OAAe,IAAR11C,EAAc8B,EAAoB,GAAdy+C,GACnC,EAAQ7K,OAAO11C,EAAQ,EAAGsgD,EAAmB,GAATxgD,GACpC,EAAQgvC,YACR,EAAQR,OAER,EAAQH,UAAYkS,EACpB,MAAMG,EAA6B,IAAdD,EACrB,EAAQ1K,SAAkB,KAAR71C,EAAc8B,EAAoB,IAAdy+C,EAA4B,IAARvgD,EAAcwgD,GAExE,EAAQrS,UAAYzqC,EACpB,EAAQmyC,UAAU71C,EAAQ,EAAGsgD,EAAwB,IAAdC,EAAoBvgD,EAAgB,GAATF,GAElE,EAAQquC,UAAYpqC,EACpB,EAAQqqC,YACR,EAAQC,IAAa,KAARruC,GAA6B,IAAfmxB,EAAqBA,EAAa,EAAa,EAAVlsB,KAAKC,IACrE,EAAQmpC,IAAY,IAARruC,GAA6B,IAAfmxB,EAAqBA,EAAa,EAAa,EAAVlsB,KAAKC,IACpE,EAAQopC,QAEH5G,EAAaC,WAAayY,EAAc,MAC3C,EAAQ3K,YAAc,sBACtB,EAAQhc,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAgB,KAAR7uC,EAAc8B,EAAoB,GAAdy+C,GACpC,EAAQ7K,OAAgB,KAAR11C,EAAcsgD,EAAmB,IAATxgD,GACxC,EAAQ41C,OAAgB,KAAR11C,EAAcsgD,EAAmB,GAATxgD,GACxC,EAAQ61C,SAER,EAAQvH,YACR,EAAQS,OAAe,IAAR7uC,EAAc8B,EAAoB,GAAdy+C,GACnC,EAAQ7K,OAAe,GAAR11C,EAAasgD,EAAmB,GAATxgD,GACtC,EAAQ41C,OAAe,IAAR11C,EAAcsgD,EAAmB,IAATxgD,GACvC,EAAQ61C,UAGV,EAAQ5G,SACV,CAwGQ0R,CAAc/Y,EAAcD,GAC5B,MACF,IAAK,YAzGX,SAA2BC,EAAcD,EAAUzR,GACjD,MAAMh2B,EAAQ0nC,EAAa1nC,MACrBF,EAAS4nC,EAAa5nC,OACtBsgD,EAAc,GAAM,EAAK1Y,EAAajyB,OAASiyB,EAAahyB,UAAY,EAAG,GAC3EgrC,EAAuB,IAAR1gD,EACf2gD,EAAwB,IAAT7gD,EACfgC,GAAOhC,EACP2D,EAAYgkC,EAAShkC,WAAa,UAClCE,EAAc8jC,EAAS9jC,aAAe8jC,EAAS/jC,aAAe,UAC9DK,EAAY0jC,EAAS1jC,WAAa,UAElC68C,EAAY,CAChB,CAAEtgD,EAAY,KAARN,EAAcsC,EAAGR,EAAe,IAAThC,GAC7B,CAAEQ,EAAW,IAARN,EAAcsC,EAAGR,EAAe,GAAThC,GAC5B,CAAEQ,EAAG,EAAGgC,EAAGR,EAAe,GAAThC,IAGb+gD,EAAenZ,EAAaC,UAAY,EAAI,EAClD,IAAK,IAAIhvC,EAAI,EAAGA,EAAIkoD,EAAcloD,GAAK,EAAG,CACxC,MAAMmoD,EAAMF,EAAUjoD,GACtB,EAAQ61C,OACR,EAAQC,UAAUqS,EAAIxgD,EAAGwgD,EAAIx+C,GAC7B,EAAQ6rC,UAAY1qC,EACpB,EAAQ2qC,YACR,EAAQ2S,QAAQ,EAAG,EAAGL,EAA6B,GAAfC,EAAoB,EAAG,EAAa,EAAV17C,KAAKC,IACnE,EAAQopC,OAER,EAAQuH,UAAU6K,EAA8B,IAAfC,EAAmC,EAAfD,EAAkBC,GAEvE,EAAQxS,UAAYxqC,EACpB,EAAQkyC,UAAU6K,EAA8B,KAAfC,EAAoC,EAAfD,EAAiC,IAAfC,GAExE,EAAQlL,YAAc1xC,EACtB,EAAQ01B,UAAY,EACpB,EAAQqc,YAAY4K,EAA8B,IAAfC,EAAmC,EAAfD,EAAkBC,GACzE,EAAQ5R,SACV,CAEA,IAAKrH,EAAaC,WAAayY,EAAc,GAAK,CAChD,MAAMj9C,EAAU,GAAgE,GAA1D8B,KAAK0xC,IAAI1xC,KAAKwO,IAAc,EAAVuiB,EAA+B,IAAjB0R,EAAapnC,IAAmB8/C,EACtF,EAAQjS,UAAY,sBAAsBhrC,EAAQijB,QAAQ,MAC1D,EAAQgoB,YACR,EAAQ2S,QAAQ,EAAGj/C,EAAe,GAAThC,EAAsB,IAARE,EAAuB,IAATF,EAAe,EAAG,EAAa,EAAVmF,KAAKC,IAC/E,EAAQopC,MACV,CACF,CA6DQ0S,CAAkBtZ,EAAcD,EAAUzR,GAC1C,MACF,SAnON,SAAyB0R,EAAcD,EAAUzR,GAC/C,MAAMh2B,EAAQ0nC,EAAa1nC,MACrBF,EAAS4nC,EAAa5nC,OACtBgC,GAAOhC,EACP2D,EAAYgkC,EAAShkC,WAAa,OAClCC,EAAc+jC,EAAS/jC,aAAe,OACtCK,EAAY0jC,EAAS1jC,WAAa,OAClCk9C,EAAaxZ,EAAS7jC,iBAAmB,UACzCw8C,EAAc,GAAM,EAAK1Y,EAAajyB,OAASiyB,EAAahyB,UAAY,EAAG,GAYjF,GAXA,EAAQy4B,UAAY1qC,EACpB,EAAQoyC,UAAU71C,EAAQ,EAAG8B,EAAK9B,EAAOF,GAEzC,EAAQquC,UAAYzqC,EACpB,EAAQmyC,UAAU71C,EAAQ,EAAG8B,EAAK9B,EAAOiF,KAAKmC,IAAI,GAAa,IAATtH,IACtD,EAAQ+1C,UAAU71C,EAAQ,EAAG8B,EAAe,IAAThC,EAAeE,EAAOiF,KAAKmC,IAAI,EAAY,GAATtH,IAErE,EAAQ21C,YAAc1xC,EACtB,EAAQ01B,UAAY,EACpB,EAAQqc,YAAY91C,EAAQ,EAAG8B,EAAK9B,EAAOF,GAEvCsgD,EAAc,EAAG,CACnB,MAAMc,EAAa,EAAIj8C,KAAKoC,MAAoB,EAAd+4C,GAC5Bv0B,EAAkB,EAAVmK,EAA+B,IAAjB0R,EAAapnC,EACzC,EAAQm1C,YAAcwL,EACtB,EAAQxnB,UAAY,EACpB,IAAK,IAAI9gC,EAAI,EAAGA,EAAIuoD,EAAYvoD,GAAK,EAAG,CACtC,MACMwoD,EAAkB,KAARnhD,EAAeA,IADfrH,EAAI,IAAMuoD,EAAa,IAEjCE,EAActhD,GAAU,GAAoB,GAAdsgD,GAC9B10B,EAAqC,GAA5BzmB,KAAKwO,IAAIoY,EAAY,IAAJlzB,GAChC,EAAQy1C,YACR,EAAQS,OAAOsS,EAAQr/C,EAAe,IAAThC,GAC7B,EAAQ41C,OAAOyL,EAAkB,GAATz1B,EAAc5pB,EAAe,IAAThC,EAA8B,IAAdshD,GAC5D,EAAQ1L,OAAOyL,EAASz1B,EAAQ5pB,EAAe,IAAThC,EAAgBshD,GACtD,EAAQzL,QACV,CACF,CACF,CA+LQ0L,CAAgB3Z,EAAcD,EAAUzR,GAK9C,IAAK0R,EAAaC,WAAaD,EAAahyB,UAAY,EAAG,CACzD,MAAM4lC,EAAc,GAAM5T,EAAajyB,OAASiyB,EAAahyB,UAAW,EAAG,GACvE4lC,EAAc,KAtEtB,SAAwBt7C,EAAOmpC,EAAOmY,GACpC,MAAMC,EAAU,GAAMpY,EAAO,EAAG,GAC1BqY,EAAmB,IAARxhD,EACjB,EAAQmuC,UAAY,sBACpB,EAAQ0H,UAAU2L,EAAW,EAAGF,EAASE,EAAU,GACnD,EAAQrT,UAAYoT,EAAU,GAAM,UAAYA,EAAU,IAAO,UAAY,UAC7E,EAAQ1L,UAAU2L,EAAW,EAAGF,EAASE,EAAWD,EAAS,EAC/D,CAgEME,CAAe/Z,EAAa1nC,MAAOs7C,GAAc5T,EAAa5nC,OAAS,GAE3E,CAEA,MAAMoW,EAAawxB,EAAaxxB,YAAc,EAC9C,GAAIA,EAAa,EAAG,CAClB,MAAM22B,EAAwC,IAAhC,GAAM32B,EAAa,GAAK,EAAG,GACzC,EAAQi4B,UAAY,uBAAuBtB,EAAMzmB,QAAQ,MACzD,EAAQyvB,UAAUnO,EAAa1nC,MAAQ,GAAI0nC,EAAa5nC,OAAQ4nC,EAAa1nC,MAAO0nC,EAAa5nC,OACnG,EAvEF,SAAyB4nC,EAAcD,EAAUzR,GAC/C,IAAK0R,EAAaE,YAAc,IAAM,EACpC,OAEF,MAAMn2B,EAAWg2B,EAASv2B,eAAiB,IACrCwwC,EAAY,IAAOha,EAAaE,YAAc,GAAKn2B,EAAU,EAAG,GAChE2jC,EAAY,IAAmB,IAAZsM,EAEzB,IAAK,IAAI/oD,EAAI,EAAGA,EADD,EACaA,GAAK,EAAG,CAClC,MAAMkzB,EAAQmK,GAAW,GAAU,IAAJr9B,GAA6B,IAAjB+uC,EAAapnC,EAAe,IAAJ3H,EAC7D4I,EAA+B,IAArBmmC,EAAa1nC,OAAiB,EAAgB,GAAZ0hD,EAAsB,IAAJ/oD,GACpE,EAAQ08C,YAAc,GAAMD,EAAgB,IAAJz8C,EAAU,EAAG,KACrD,EAAQw1C,UAAY,UACpB,EAAQC,YACR,EAAQC,IACNppC,KAAKwO,IAAIoY,GAAS6b,EAAa1nC,MAAQ,KACtC0nC,EAAa5nC,QAAU,IAAW,GAAJnH,GAAmC,EAAxBsM,KAAKuO,IAAY,GAARqY,GAC1C,GAATtqB,EACA,EACU,EAAV0D,KAAKC,IAEP,EAAQopC,MACV,CACA,EAAQ+G,YAAc,CACxB,CAiDEsM,CAAgBja,EAAcD,EAAUzR,GACxC,EAAQ+Y,SACV,CC5MA,SAAS,KACP,MAAM55B,EAAQ,KACRgjB,EAAY,GAAoBhjB,EAAM82B,gBAC5C,IAAK9T,EAEH,OADAhjB,EAAM+2B,YAAYC,OAAQ,EACnBh3B,EAAM+2B,YAEf,MAAM7hC,GAAa8tB,EAAUn4B,OAAS,KAAO,EACvC4hD,GAtCYzhD,EAsCMkX,GAAS/W,EAAI+W,GAASxU,OAASoC,KAAKmC,IAAI,IAAKiD,EAAY,IAxCjE,GAGTpF,KAAKyC,MAAMvH,EAHF,KAElB,IAAoBA,EAuClB,MAAM4J,EAAW,KACXI,EAAWlF,KAAKmC,IAAIiD,EAAY,GAAIpF,KAAK+E,IAAID,EAAWM,EAAY,GAAIu3C,IACxEC,EArCR,SAAsBvhD,EAAG+J,GACvB,IAAIy3C,EAAQjiD,EACZ,MAAMkG,EAAY4C,KAClB,IAAK,MAAMtI,KAAY0F,EAAW,CAChC,MAAMqE,EAAO/J,EAASC,EAAI+J,EACpBC,EAAQjK,EAASC,EAAID,EAASL,MAAQqK,EACxC/J,GAAK8J,GAAQ9J,GAAKgK,GAASjK,EAASiC,EAAIw/C,IAC1CA,EAAQzhD,EAASiC,EAErB,CACA,OAAOw/C,CACT,CA0BkBC,CAAa53C,EAAUE,GACjC8gC,EAAOhT,EAAUgT,MAAQ,EAc/B,OAbAh2B,EAAM+2B,YAAc,CAClB5rC,EAAG6J,EACH7H,EAAGu/C,EACH7hD,MAAOm4B,EAAUn4B,MACjBF,OAAQq4B,EAAUr4B,OAClBkiD,YAAa7pB,EAAUh/B,GACvBgyC,OACAloC,MAAOk1B,EAAUl1B,MACjBS,YAAay0B,EAAUz0B,YACvB0nC,YAAajT,EAAUiT,YACvBO,QAASxT,EAAUwT,SAAW,KAC9BQ,MAAOllC,MAAsBkkC,GAExBh2B,EAAM+2B,WACf,CA0BA,SAAS+V,KACP,MAAM9sC,EAAQ,KACR+sC,EAAU,KAChB,IAAKA,EAAQ/V,MACX,OAAO,EAET,MAAMhU,EAAY,GAAoBhjB,EAAM82B,gBAC5C,IAAK9T,EACH,OAAO,EAET,I3DpFF,SAAwBgT,GACtB,MAAMhkC,EAASlC,KAAKyC,MAAMyjC,GAAQ,GAClC,OAAIhkC,GAAU,KANhB,SAAmBgkC,GACjB,OAAOtkC,GAAcC,YAAcqkC,GAAQ,EAC7C,CAOOgX,CAAUh7C,KAGfN,GAAcC,WAAaK,GACpB,EACT,C2D0EOi7C,CAAejqB,EAAUgT,MAAQ,GAEpC,OADAh2B,EAAM+2B,YAAYC,OAAQ,GACnB,EAET,MAAMkW,EAtCR,SAAsClqB,EAAW+pB,GAC/C,MAAO,CACL/oD,GAAI,GAAGg/B,EAAUh/B,MAAMyU,KAAKD,MAAMpS,SAAS,OAAO0J,KAAKoC,MAAsB,IAAhBpC,KAAK4C,YAClEtF,KAAM41B,EAAUh/B,GAChBmH,EAAG4hD,EAAQ5hD,EACXgC,EAAG4/C,EAAQ5/C,EACXtC,MAAOm4B,EAAUn4B,MACjBF,OAAQq4B,EAAUr4B,OAClB2V,OAAQ0iB,EAAUziB,UAClBA,UAAWyiB,EAAUziB,UACrBzS,MAAOk1B,EAAUl1B,MACjBS,YAAay0B,EAAUz0B,YACvB0nC,YAAajT,EAAUiT,YACvBO,QAASxT,EAAUwT,SAAW,KAC9BN,SAAUlT,EAAUkT,WAAY,EAChC3P,OAAQvD,EAAUuD,QAAU,KAC5B8P,OAAQrT,EAAUqT,QAAU,KAC5BK,KAAM1T,EAAU0T,MAAQ,KACxBh1B,aAAc,EACdyrC,aAAc,EACdpsC,WAAY,EAEhB,CAgBoBqsC,CAA6BpqB,EAAW+pB,GAU1D,OXpGF,SAAsBG,GACpBtW,GAAW5xC,KAAKkoD,EAClB,CWyFEG,CAAaH,GACbhpB,GAAe,CACb/4B,EAAG+hD,EAAU/hD,EACbgC,EAAG+/C,EAAU//C,GAAK+/C,EAAUviD,QAAU,IACtCy5B,YAAa,GACbC,UAAWv0B,KAAKmC,IAAI,GAAIi7C,EAAUriD,OAAS,KAC3CiD,MAAOk1B,EAAUz0B,aAAe,UAChCqE,IAAK,OAEA,CACT,CAEA,SAAS06C,GAAgBC,GACvB,MAAMvtC,EAAQ,KAEZA,EAAMvI,OADkB,kBAAf81C,EACMA,GAECvtC,EAAMvI,OAEnBuI,EAAMvI,OAGT,KAFAuI,EAAM+2B,YAAYC,OAAQ,CAI9B,CAoCA,SAASwW,GAAgBN,EAAWl7C,IAC7Bk7C,GAAal7C,GAAU,IAG5Bk7C,EAAU5sC,OAASxQ,KAAKmC,IAAI,EAAGi7C,EAAU5sC,OAAStO,GAClDk7C,EAAUnsC,WAAa,IACzB,CAEA,SAAS0sC,GAAiB7W,EAAYpxC,EAAO0nD,GAC3ChpB,GAAe,CACb/4B,EAAG+hD,EAAU/hD,EACbgC,EAAG+/C,EAAU//C,GAAK+/C,EAAUviD,QAAU,IACtCy5B,YAAa,GACbC,UAAWv0B,KAAKmC,IAAI,IAAgC,KAA1Bi7C,EAAUriD,OAAS,MAC7CiD,MAAOo/C,EAAU3+C,aAAe,UAChCqE,IAAK,KAEPgkC,EAAW7xC,OAAOS,EAAO,GACzB,MAAMksC,EAAU5hC,KAAKmC,IAAI,EAAGnC,KAAKyC,OAAO26C,EAAU3sC,WAAa,KAAO,KACtE/N,GAAmB,CACjBrH,EAAG+hD,EAAU/hD,EACbgC,EAAG+/C,EAAU//C,GAAK+/C,EAAUviD,QAAU,IACtCqH,OAAQ0/B,EACR/+B,IAAK,KAET,CAEA,SAAS+6C,GAAaR,EAAW5hC,GAC/B,MAAMib,EAAS2mB,EAAU3mB,OACzB,IAAKA,EACH,OAGF,GADA2mB,EAAUxrC,aAAe5R,KAAKmC,IAAI,GAAIi7C,EAAUxrC,cAAgB,GAAK4J,GACjE4hC,EAAUxrC,aAAe,EAC3B,OAEF,IAAIisC,EAAY,KACZC,EAAWv7C,OAAOgV,kBACtB,MAAMwmC,EAAUX,EAAU//C,GAAK+/C,EAAUviD,QAAU,KAAO,GAC1D,IAAK,MAAMga,KAAStT,GAAS,CAC3B,GAAIsT,EAAMrE,QAAU,EAClB,SAEF,MAAMwmB,EAAKniB,EAAMxZ,EAAI+hD,EAAU/hD,EACzB47B,EAAMpiB,EAAMxX,EAAmB,GAAfwX,EAAMha,OAAgBkjD,EACtC1mB,EAAWr3B,KAAKs3B,MAAMN,EAAIC,GAC5BI,GAAYZ,EAAO/sB,OAAS,MAG5B2tB,EAAWymB,IACbA,EAAWzmB,EACXwmB,EAAYhpC,EAEhB,CACA,IAAKgpC,EACH,OAEF,MAAM7mB,EAAK6mB,EAAUxiD,EAAI+hD,EAAU/hD,EAC7B47B,EAAM4mB,EAAUxgD,EAAuB,GAAnBwgD,EAAUhjD,OAAgBkjD,EAC9C1mB,EAAWr3B,KAAKmC,IAAI,EAAGnC,KAAKs3B,MAAMN,EAAIC,IACtC3sB,EAAQmsB,EAAOpsB,YAAYC,OAAS,IACpC3H,EAAMq0B,EAAKK,EAAY/sB,EACvBzH,EAAMo0B,EAAKI,EAAY/sB,EAC7BitB,GAAgB,CACdl8B,EAAG+hD,EAAU/hD,EACbgC,EAAG0gD,EACHp7C,KACAE,KACAvG,OAAQm6B,EAAOpsB,YAAY/N,QAAU,EACrCiO,SAAU,IACVX,OAAQ6sB,EAAOpsB,YAAYT,QAAU,GACrC5L,MAAOy4B,EAAOpsB,YAAYrM,OAAS,UACnCJ,OAAQoC,KAAKo3B,KAAKJ,IAAO,EACzBxsB,cAAe,MAEjB4yC,EAAUxrC,aAAe6kB,EAAOtS,UAAY,GAC9C,CAEA,SAAS65B,GAAiBZ,EAAW5hC,GACnC,MAAM+qB,EAAS6W,EAAU7W,OACzB,IAAKA,EACH,OAEF,MAAMjqC,EAASiqC,EAAOjqC,QAAU,IAC1B2hD,EAAQb,EAAU//C,EAAgC,IAA3B+/C,EAAUviD,QAAU,KAC3CqjD,EAAS,CAAC9rC,MAAayB,IAC7B,IAAK,MAAMsqC,KAASD,EAAQ,CAC1B,IAAKC,GAASA,EAAM3tC,QAAU,EAC5B,SAEF,MAAMwmB,EAAKmnB,EAAM9iD,EAAI+hD,EAAU/hD,EACzB47B,EAAMknB,EAAM9gD,EAAI8gD,EAAMtjD,OAAUojD,EAClCj+C,KAAKs3B,MAAMN,EAAIC,IAAO36B,IACxB6hD,EAAMpsC,qBAAuB/R,KAAKmC,IAAIg8C,EAAMpsC,sBAAwB,EAAGw0B,EAAOE,cAAgB,IAC9F0X,EAAMnsC,wBAA0BhS,KAAKmC,IAAIg8C,EAAMnsC,yBAA2B,EAAGu0B,EAAOC,iBAAmB,IAE3G,CACF,CAEA,SAAS4X,GAAWhB,EAAW5hC,GAC7B,MAAMorB,EAAOwW,EAAUxW,KACvB,IAAKA,EACH,OAGF,GADAwW,EAAUC,aAAer9C,KAAKmC,IAAI,GAAIi7C,EAAUC,cAAgB,GAAK7hC,GACjE4hC,EAAUC,aAAe,EAC3B,OAEF,MAAM/gD,EAASsqC,EAAKtqC,QAAU,IACxBy2B,EAAUqqB,EAAU//C,EAA+B,IAA1B+/C,EAAUviD,QAAU,IACnD,IAAIwjD,GAAY,EAChB,IAAK,MAAMxpC,KAAStT,GAAS,CAC3B,GAAIsT,EAAMrE,QAAU,EAClB,SAEF,MAAMwmB,EAAKniB,EAAMxZ,EAAI+hD,EAAU/hD,EACzB47B,EAAMpiB,EAAMxX,EAAmB,GAAfwX,EAAMha,OAAgBk4B,EACxC/yB,KAAKs3B,MAAMN,EAAIC,IAAO36B,IACxB8jC,GAAmBvrB,EAAO,CACxBjL,OAAQg9B,EAAKh9B,QAAU,GACvBC,UAAW,IACXC,OAAQ,EACRlM,OAAQoC,KAAKo3B,KAAKJ,IAAO,IAE3BniB,EAAMvD,UAAYtR,KAAKmC,IAAI0S,EAAMvD,WAAa,EAAGs1B,EAAKC,MAAQ,IAC9DwX,GAAY,EAEhB,CACIA,IACFjB,EAAUC,aAAezW,EAAKziB,UAAY,IAC1CykB,GAAkB,CAChBtrC,KAAM,QACNjC,EAAG+hD,EAAU/hD,EACbgC,EAAG01B,EACHz2B,OAAiB,IAATA,EACRyB,UAAW,IACXC,MAAO4oC,EAAK5oC,OAAS,UACrB8E,IAAK,IACL5E,QAAS,GACT8M,MAAO,MAETopB,GAAe,CACb/4B,EAAG+hD,EAAU/hD,EACbgC,EAAG01B,EACHuB,YAAsB,GAATh4B,EACbi4B,UAAoB,IAATj4B,EACX0B,MAAO4oC,EAAK5oC,OAAS,UACrB8E,IAAK,GACL0xB,UAAW,IAGjB,CAEA,SAAS8pB,GAA0BlB,EAAW5hC,GAC5C,MAAMpW,GAAag4C,EAAUriD,OAAS,KAAO,EACvCy+C,EAAO4D,EAAU//C,GAAK+/C,EAAUviD,QAAU,IAChD,IAAK,MAAMga,KAAStT,GAAS,CAC3B,GAAIsT,EAAMrE,QAAU,EAClB,SAEF,MAAM+tC,EAAoBv+C,KAAK0xC,IAAI78B,EAAMxZ,EAAI+hD,EAAU/hD,IAAM+J,EAAYyP,EAAMvY,OAAS,GAClFkiD,EAAmB3pC,EAAMxX,EAAIwX,EAAMha,OAAU2+C,EAC/C+E,GAAqB,GAAKC,GAAmB,KAC/Cd,GAAgBN,GAAYvoC,EAAMhE,cAAgB,IAAM2K,GACxD3G,EAAMlS,IAAM,GACZkS,EAAM1E,WAAanQ,KAAKmC,IAAI0S,EAAM1E,YAAc,EAAG,IAEvD,CACF,CAiBA,SAASsuC,GAAqBjjC,IA3N9B,WACE,MAAMtL,EAAQ,KAKd,GAJI3K,GAAMuB,sBACR02C,KACAj4C,GAAMuB,qBAAsB,IAEzBoJ,EAAMvI,OAIT,OAHApC,GAAMwB,mBAAqB,EAC3BxB,GAAMyB,sBAAuB,OAC7BzB,GAAM0B,qBAAsB,GAGG,IAA7B1B,GAAMwB,qBA/GZ,SAAwBjH,GACtB,MAAMoQ,EAAQ,KACdA,EAAM82B,eAVR,SAA6BtxC,GAC3B,MAAM0xC,EAAOD,KACb,OAAoB,IAAhBC,EAAKzzC,OACA,GAEA+B,EAAQ0xC,EAAKzzC,OAAUyzC,EAAKzzC,QAAUyzC,EAAKzzC,MACtD,CAIyB+qD,CAAoBxuC,EAAM82B,eAAiBlnC,EACpE,CA6GI6+C,CAAep5C,GAAMwB,oBACrBxB,GAAMwB,mBAAqB,EAC3B,MAEExB,GAAM0B,sBACRu2C,IAAgB,GAChBj4C,GAAM0B,qBAAsB,IAE1B1B,GAAMyB,sBAAwBzB,GAAMK,kBAClCo3C,MACFz3C,GAAMyB,sBAAuB,EAC7BzB,GAAMK,gBAAiB,EACvBL,GAAMS,YAAa,EACnB,OAEAT,GAAMyB,sBAAuB,EAC7BzB,GAAMK,gBAAiB,GAG7B,CA4LEg5C,GAhBF,SAA0BpjC,GACxB,MAAMsrB,EAAa,KACnB,IAAK,IAAIpzC,EAAIozC,EAAWnzC,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CAClD,MAAM0pD,EAAYtW,EAAWpzC,GAC7B0pD,EAAUnsC,WAAajR,KAAKmC,IAAI,GAAIi7C,EAAUnsC,YAAc,GAAKuK,GACjE8iC,GAA0BlB,EAAW5hC,GACrCoiC,GAAaR,EAAW5hC,GACxBwiC,GAAiBZ,GACjBgB,GAAWhB,EAAW5hC,GAClB4hC,EAAU5sC,QAAU,GACtBmtC,GAAiB7W,EAAYpzC,EAAG0pD,EAEpC,CACF,CAIEyB,CAAiBrjC,GACH,KACJ7T,QACR,IAEJ,CAcA0/B,KCjYA,MAAMyX,GAAY,CAChBn3C,QAAQ,EACRo3C,UAAW,EACXC,cAAe,EACfC,gBAAiB,IACjBC,iBAAkB,EAClBC,eAAgB,EAChBC,OAAQ,aAAap/C,KAAK4C,SAAStM,SAAS,IAAI0Z,MAAM,EAAG,KACzD4hB,YAAa,YA+Cf,SAASytB,KACP,MAAO,CACL13C,OAAQm3C,GAAUn3C,OAClB23C,aAAcR,GAAUC,UACxBE,gBAAiBH,GAAUG,gBAC3BM,iBAAkBT,GAAUE,cAC5BE,iBAAkBJ,GAAUI,iBAC5BC,eAAgBL,GAAUK,eAC1BC,OAAQN,GAAUM,OAClBxtB,YAAaktB,GAAUltB,YAE3B,CClEA,MAAM4tB,GAAyB,CAC7BC,UAAW,CACTr2C,SAAU,UACVrO,MAAO,GACPF,OAAQ,GACR6kD,KAAM,IACNC,SAAU,IACVlzB,SAAU,IACVmzB,YAAa,IACbC,WAAY,IACZrhD,UAAW,UACXM,UAAW,UACXC,WAAY,UACZhC,eAAgB,WAElB+iD,WAAY,CACV12C,SAAU,UACV9M,OAAQ,GACRzB,OAAQ,GACR6kD,KAAM,IACNC,SAAU,IACVlzB,SAAU,IACVmzB,YAAa,IACbC,WAAY,IACZrhD,UAAW,UACXE,YAAa,UACbI,UAAW,UACX9B,SAAU,WAEZ2pC,UAAW,CACTv9B,SAAU,OACVrO,MAAO,IACPF,OAAQ,GACR+O,OAAQ,GACRC,UAAW,GACXC,QAAS,IACTqa,SAAU,IACVrY,aAAc,IACdtN,UAAW,UACXC,YAAa,UACbO,UAAW,YCUf,SAAS,KACP,O7DJF,WACE,MAAMyE,EAAcF,KACpB,OAAO3H,MAAMC,QAAQ4H,GAAaxC,eAAiBwC,EAAYxC,cAAgB,EACjF,C6DCS8+C,GAAmCvpD,IAAK2K,GAhDjD,SAAqCA,GACnC,MAAMohC,EAAeid,GAAuBr+C,EAAM7D,MAClD,IAAKilC,EACH,MAAM,IAAI3pC,MAAM,kCAAkCuI,EAAM7D,QAG1D,MAAMiB,EAAoB4C,EAAM5C,mBAAqB,CAAC,EAChDikC,EAAW,IAAKD,KAAiBhkC,GACjCxD,EAAQoG,EAAMpG,OAASynC,EAASznC,QAAUynC,EAASlmC,OAA2B,EAAlBkmC,EAASlmC,OAAa,IAClFzB,EAASsG,EAAMtG,QAAU2nC,EAAS3nC,QAAU,GAC5CyB,EAAS6E,EAAM7E,QAAUkmC,EAASlmC,QAAoC,GAA1B0D,KAAKmC,IAAIpH,EAAOF,GAE5DmlD,EAAe,CACnB9rD,GAAIiN,EAAMjN,GACVoJ,KAAM6D,EAAM7D,KACZklC,WACAnnC,EAAG8F,EAAM9F,EACTgC,EAAG8D,EAAMxD,MACTgF,GAAI,EACJE,GAAI,EACJ9H,QACAF,SACAyB,SACA4T,MAAOsyB,EAASyd,cAAgB,OAChC1uB,MAAO,EACPpN,SAAU,EACVrnB,UAAW,EACXuhD,WAAW,EACXptC,WAAY,EACZ0xB,WAAY,EACZ+c,KAAMld,EAASkd,MAAQ,EACvBC,SAAUnd,EAASmd,UAAY,EAC/BlzB,SAAU+V,EAAS/V,UAAY,IAC/BmzB,YAAapd,EAASod,aAAe,IACrCC,WAAYrd,EAASqd,YAAcrd,EAASod,aAAe,IAC3DhiD,OAAQuD,EAAMvD,QAAU,EACxB1B,KAAMiF,EAAMjF,MAAQ,KACpBC,KAAMgF,EAAMhF,MAAQ,MAOtB,OAJIgF,EAAM1E,WAAwC,iBAApB0E,EAAM1E,WAClC1C,OAAOgpC,OAAOid,EAAc7+C,EAAM1E,WAG7BujD,CACT,CAG2DE,CAA4B/+C,GACvF,CAEA,MAAMF,GAAgB,KCkDtB,SAASk/C,GAAiBH,EAAcjvB,GACtC,MAAMyR,EAAWwd,EAAaxd,UAAY,CAAC,EAC3C,OAAQA,EAASp5B,UACf,IAAK,WArGT,SAAmB42C,EAAcxd,EAAUzR,GACzC,MAAM3rB,GAAa46C,EAAajlD,OAAS,IAAM,EACzCF,EAASmlD,EAAanlD,QAAU,GAEhCulD,GADMJ,EAAa3iD,EACZ2C,KAAKwO,IAAc,EAAVuiB,EAA+B,IAAjBivB,EAAa3kD,IAAa2kD,EAAar9C,IAAM,GAAK,MAEtF,EAAQ4mC,OACR,EAAQC,UAAUwW,EAAa3kD,EAAG2kD,EAAa3iD,GAC/C,EAAQosC,OAAO2W,GAEf,EAAQlX,UAAY1G,EAAShkC,WAAa,UAC1C,EAAQoyC,UAAUxrC,GAAYvK,EAAoB,EAAZuK,EAAevK,GAErD,EAAQ21C,YAAchO,EAAS1jC,WAAa,UAC5C,EAAQ01B,UAAY,EACpB,EAAQqc,YAAYzrC,GAAYvK,EAAoB,EAAZuK,EAAevK,GAEvD,EAAQ21C,YAAchO,EAASzjC,YAAc,UAC7C,EAAQy1B,UAAY,EACpB,MAAM6rB,EAAyB,GAAZj7C,EACnB,EAAQ+jC,YACR,EAAQS,QAAQxkC,EAAqB,EAATvK,GAC5B,EAAQ41C,QAAQ4P,EAA+B,GAATxlD,EAATA,GAC7B,EAAQ+uC,OAAOxkC,EAAqB,EAATvK,GAC3B,EAAQ41C,OAAO4P,EAA+B,GAATxlD,EAATA,GAC5B,EAAQ+uC,QAAQxkC,EAA8B,IAATvK,EAATA,GAC5B,EAAQ41C,QAAQ4P,GAAa,GAC7B,EAAQzW,OAAOxkC,EAA8B,IAATvK,EAATA,GAC3B,EAAQ41C,OAAO4P,GAAa,GAC5B,EAAQ3P,SAER,EAAQ5G,SACV,CAsEM,CAAUkW,EAAcxd,EAAUzR,GAClC,MACF,IAAK,WAtET,SAAoBivB,EAAcxd,EAAUzR,GAC1C,MAAMz0B,EAAS0jD,EAAa1jD,QAAU,GAChCzB,EAASmlD,EAAanlD,QAAmB,IAATyB,EAChCO,EAAMmjD,EAAa3iD,EAAIxC,EACvB4rB,EAASzmB,KAAKwO,IAAc,EAAVuiB,EAA+B,IAAjBivB,EAAa3kD,IAAa2kD,EAAar9C,IAAM,GAAK,KAExF,EAAQ4mC,OACR,EAAQC,UAAUwW,EAAa3kD,EAAGwB,EAAMhC,EAAS,GACjD,EAAQ4uC,OAAOhjB,GAEf,EAAQyiB,UAAY1G,EAAShkC,WAAa,UAC1C,EAAQ2qC,YACR,EAAQ2S,QAAQ,EAAG,EAAGx/C,EAAiB,GAATzB,EAAc,EAAG,EAAa,EAAVmF,KAAKC,IACvD,EAAQopC,OAER,EAAQH,UAAY1G,EAASxlC,UAAY,UACzC,EAAQmsC,YACR,EAAQ2S,QAAQ,EAAa,IAATjhD,EAAuB,IAATyB,EAAwB,IAATA,EAAe,EAAG,EAAa,EAAV0D,KAAKC,IAC3E,EAAQopC,OAER,EAAQH,UAAY1G,EAAS1jC,WAAa,UAC1C,EAAQqqC,YACR,EAAQ2S,QAAQ,EAAY,GAATjhD,EAAuB,IAATyB,EAAwB,IAATA,EAAe,EAAG,EAAa,EAAV0D,KAAKC,IAC1E,EAAQopC,OAER,EAAQmH,YAAchO,EAAS9jC,aAAe,UAC9C,EAAQ81B,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAiB,KAATttC,EAAyB,KAATzB,GAChC,EAAQ41C,OAAgB,IAATn0C,EAAyB,IAATzB,GAC/B,EAAQ+uC,OAAiB,KAATttC,EAAwB,IAATzB,GAC/B,EAAQ41C,OAAgB,IAATn0C,EAAwB,GAATzB,GAC9B,EAAQ61C,SAER,EAAQ5G,SACV,CAoCMwW,CAAWN,EAAcxd,EAAUzR,GACnC,MACF,IAAK,QApCT,SAAkBivB,EAAcxd,EAAUzR,GACxC,MAAM3rB,GAAa46C,EAAajlD,OAAS,KAAO,EAC1CF,EAASmlD,EAAanlD,QAAU,GAChCgC,EAAMmjD,EAAa3iD,EAAIxC,EACvB0lD,EAAO/d,EAASxjC,WAAa,UAC7BwhD,EAAShe,EAAS/jC,aAAe,UACjCsjB,EAAOygB,EAAShkC,WAAa,UAC7BiiD,EAAwD,IAAhDzgD,KAAKwO,IAAc,EAAVuiB,EAA+B,IAAjBivB,EAAa3kD,GAAmB,KAAQ2kD,EAAa77B,SAAW,EAAI,GAAM,KAE/G,EAAQolB,OACR,EAAQC,UAAUwW,EAAa3kD,EAAG,GAElC,EAAQ6tC,UAAYnnB,EACpB,EAAQ6uB,UAAUxrC,EAAWvI,EAAiB,EAAZuI,EAAevK,GAEjD,EAAQquC,UAAYsX,EACpB,EAAQ5P,SAAsB,IAAZxrC,EAAiBvI,EAAe,IAAThC,EAA2B,IAAZuK,EAA0B,IAATvK,GAEzE,EAAQu1C,YAAc,GAAMqQ,EAAO,EAAG,GACtC,EAAQvX,UAAYqX,EACpB,EAAQ3P,UAAUxrC,EAAWvI,EAAM,EAAe,EAAZuI,EAAwB,GAATvK,GACrD,EAAQ+1C,UAAUxrC,EAAWvI,EAAMhC,EAAS,EAAe,EAAZuK,EAAwB,GAATvK,GAC9D,EAAQu1C,YAAc,EAEtB,EAAQtG,SACV,CAYM4W,CAASV,EAAcxd,EAAUzR,GAMrC,MAAM5N,EAAQ68B,EAAa/uC,YAAc,EACzC,GAAIkS,EAAQ,EAAG,CACb,MAAMykB,EAAmC,GAA3B,GAAMzkB,EAAQ,GAAK,EAAG,GAC9B/d,EAAY46C,EAAajlD,MAAQilD,EAAajlD,MAAQ,EAAIilD,EAAa1jD,OACvEzB,EAASmlD,EAAanlD,QAAsB,IAAZuK,EACtC,EAAQmkC,OACR,EAAQL,UAAY,uBAAuBtB,EAAMzmB,QAAQ,MACzD,EAAQqoB,UAAUwW,EAAa3kD,EAAG2kD,EAAa3iD,GAC/C,EAAQuzC,UAAUxrC,GAAYvK,EAAoB,EAAZuK,EAAevK,GACrD,EAAQivC,SACV,CAEA,MAAMhtC,EAAY,GAAMkjD,EAAaljD,WAAa,EAAG,EAAG,GACxD,GAAIA,EAAY,IAAM,CACpB,MAAM6jD,EAAoBne,EAASzlC,gBAAkBylC,EAAS/jC,aAAe,UACvE2G,EAAY46C,EAAajlD,MAAQilD,EAAajlD,MAAQ,EAAIilD,EAAa1jD,OACvEzB,EAASmlD,EAAanlD,QAAsB,IAAZuK,EACtC,EAAQmkC,OACR,EAAQ6G,YAA0B,IAAZtzC,EACtB,EAAQosC,UAAYyX,EACpB,EAAQnX,UAAUwW,EAAa3kD,EAAG2kD,EAAa3iD,GAC/C,EAAQuzC,SAAsB,MAAZxrC,EAA4B,MAATvK,EAA2B,IAAZuK,EAA0B,IAATvK,GACrE,EAAQivC,SACV,CACF,CDxEAzlC,GAAoB,MAhBpB,WACEpD,GAActN,OAAS,EACvB,MAAMmyC,EAAQ,KACd,IAAK,MAAM7xC,KAAQ6xC,EACjB7kC,GAAc/L,KAAKjB,EAEvB,CAWE2sD,KEvEF,MAAMC,GAAgB,GAChBC,GAAe,GACfC,GAAkB,GAClBC,GAAU,GACVC,GAAiB,GAEjBC,GAAU,CACdC,SAAS,EACT5a,QAAQ,EACRkE,YAAY,GAGR2W,GAAoB,CACxBC,OAAQ,UACRC,OAAQ,SACRC,OAAQ,cAGV,SAASC,GAAW3mC,EAAS/X,EAAM,KACjC,MAAM2+C,EAAOT,GAAQA,GAAQrtD,OAAS,GACtC,GAAI8tD,GAAQA,EAAK5mC,UAAYA,EAI3B,OAHA4mC,EAAK3+C,IAAMA,EACX2+C,EAAKz+C,OAASF,OACd2+C,EAAKC,IAAM,GAIb,IADAV,GAAQ9rD,KAAK,CAAE2lB,UAAS/X,MAAKE,OAAQF,EAAK4+C,IAAK,IACxCV,GAAQrtD,OAAS,GACtBqtD,GAAQtoB,OAEZ,CAEA,SAASipB,GAAmBrkD,EAAM4G,EAAS,CAAC,EAAGpB,EAAM,IACnD,MAAM8+C,EAAQ,CACZtkD,OACAjC,EAAG6I,EAAO7I,GAAK+W,GAAS/W,EACxBgC,EAAG6G,EAAO7G,GAAK+U,GAAS/U,EACxBf,OAAQ4H,EAAO5H,QAAU,IACzBwG,MACAE,OAAQF,GAGV,OADAi+C,GAAgB7rD,KAAK0sD,GACdA,CACT,CAEA,SAASC,GAAcz4C,GACrB,OAA6B,IAAtB83C,GAAQ93C,EACjB,CAmBA,SAAS04C,GAAmB75C,GAC1B,IAAKA,EAAM85C,QAAU95C,EAAM+5C,OACzB,OAEF,MAAM54C,EAAWg4C,GAAkBn5C,EAAMc,MACpCK,IAG+B,mBAAzBnB,EAAMe,gBACff,EAAMe,iBA1BV,SAAsBI,GACpB83C,GAAQ93C,IAAa83C,GAAQ93C,GAG7Bo4C,GAAW,gBAFIp4C,EAAS64C,OAAO,GAAGC,cAAgB94C,EAAS4G,MAAM,MAC9CkxC,GAAQ93C,GAAY,KAAO,QACK,KAC9C83C,GAAQ93C,KACM,YAAbA,GACFy3C,GAAcltD,OAAS,EACvBstD,GAAettD,OAAS,GACF,WAAbyV,EACT03C,GAAantD,OAAS,EACA,eAAbyV,IACT23C,GAAgBptD,OAAS,GAG/B,CAaEwuD,CAAa/4C,GACf,CAEA,SAASg5C,GAAkBn6C,GACzB,IAAK45C,GAAc,WACjB,OAEF,MAAM39C,EAAS+D,GAAO/D,QAAU,CAAC,EAEjC28C,GAAc3rD,KAAK,CACjB+hB,SAAU/S,EAAO+S,UAAY,UAC7B5b,EAAG6I,EAAO7I,GAAK+W,GAAS/W,EACxBgC,EAAG6G,EAAO7G,GAAK+U,GAAS/U,EACxBO,OAAQsG,EAAOtG,QAAUwU,GAASxU,QAAU,EAC5CkF,IANU,IAOVE,OAPU,KASd,CAEA,SAASq/C,GAAgBp6C,GACvB,IAAK45C,GAAc,WACjB,OAEF,MACM/+C,EAAM,GACNmU,GAFShP,GAAO/D,QAAU,CAAC,GAET+S,UAAY,UAC9BjD,EAAWitC,GAAepnC,KAAMrC,GAAUA,EAAMP,WAAaA,GACnE,GAAIjD,EAIF,OAHAA,EAASlR,IAAMA,EACfkR,EAAShR,OAASF,OAClBkR,EAAS0tC,IAAM,GAIjB,IADAT,GAAe/rD,KAAK,CAAE+hB,WAAUnU,MAAKE,OAAQF,EAAK4+C,IAAK,IAChDT,GAAettD,OAAS,GAC7BstD,GAAevoB,OAEnB,CAEA,SAAS4pB,GAAkBr6C,GACpB45C,GAAc,YAInBL,GAAW,aADMv5C,GAAO/D,QAAQ+S,UAAY,YAE9C,CAEA,SAASsrC,GAAmBt6C,GACrB45C,GAAc,YAInBL,GAAW,mBADMv5C,GAAO/D,QAAQ+S,UAAY,YACF,IAC5C,CAEA,SAASurC,GAAiBv6C,GACxB,IAAK45C,GAAc,WACjB,OAEF,MAAM39C,EAAS+D,GAAO/D,QAAU,CAAC,EAC3B+S,EAAW/S,EAAO+S,UAAY,UAC9BnM,EAAa5G,EAAO2G,QAAQC,YAAc,EAC1CC,EAAW7G,EAAO2G,QAAQE,UAAY,EACtC8D,EAAY7O,KAAKs3B,MAAMxsB,EAAYC,GACrC8D,GAAa,GAGjB2yC,GAAW,UAAUvqC,MAAapI,EAAUsS,QAAQ,KAAM,IAC5D,CAGA,SAASshC,GAAyBx6C,GAChC,MAAMy6C,EAAMz6C,GAAO/D,QAAQT,YACrBpD,EAAOqiD,GAAKriD,MAAQqiD,GAAKxuD,GAC1BmM,GAGLmhD,GAAW,sBAAsBnhD,IAAQ,IAC3C,CAEA,SAASsiD,GAAgB16C,GACvB,IAAK45C,GAAc,UACjB,OAEF,MAAM39C,EAAS+D,GAAO/D,QAAU,CAAC,EAE3BoxB,EAAS,CACbj6B,EAAG6I,EAAOoxB,QAAQj6B,GAAK+W,GAAS/W,EAChCgC,EAAG6G,EAAOoxB,QAAQj4B,GAAK+U,GAAS/U,GAElCyjD,GAAa5rD,KAAK,CAChBoI,KAAM,MACN0jC,OAAQ98B,EAAO88B,QAAU,EACzB1L,SACAxyB,IATU,IAUVE,OAVU,WAYUlM,IAAlBoN,EAAO88B,QACTwgB,GAAW,iBAAiBxhD,KAAKyC,MAAMyB,EAAO88B,UAAW,IAE7D,CAEA,SAAS4hB,GAAoB36C,GAC3B,IAAK45C,GAAc,UACjB,OAEF,MAAM39C,EAAS+D,GAAO/D,QAAU,CAAC,EAE3BoxB,EAAS,CACbj6B,EAAG6I,EAAOoxB,QAAQj6B,GAAK+W,GAAS/W,EAChCgC,EAAG6G,EAAOoxB,QAAQj4B,GAAK+U,GAAS/U,GAElCyjD,GAAa5rD,KAAK,CAChBoI,KAAM,UACNg4B,SACAxyB,IARU,IASVE,OATU,MAYZw+C,GAAW,UADIt9C,EAAOi0B,QAAU,YACD,IACjC,CAEA,SAAS0qB,GAAgB56C,GACvB,IAAK45C,GAAc,UACjB,OAEF,MAAM1pB,EAASlwB,GAAO/D,QAAQi0B,QAAU,QACzB,YAAXA,GAGJqpB,GAAW,UAAUrpB,IAAU,IACjC,CAEA,SAAS2qB,GAAsB76C,GACxB45C,GAAc,eAKnBL,GAAW,sBAFIv5C,GAAO/D,QAAU,CAAC,GACX0H,YAAc,aACO,IAC7C,CAEA,SAASm3C,GAAyB96C,GAChC,IAAK45C,GAAc,cACjB,OAEF,MAAM39C,EAAS+D,GAAO/D,QAAU,CAAC,EACjCy9C,GAAmB,YAAaz9C,EAAQ,UAClBpN,IAAlBoN,EAAO0F,OACT43C,GAAW,oBAAoBt9C,EAAO0F,SAAU,KAEhD43C,GAAW,sBAAuB,IAEtC,CAEA,SAASwB,GAA0B/6C,GACjC,IAAK45C,GAAc,cACjB,OAEF,MAAM39C,EAAS+D,GAAO/D,QAAU,CAAC,EACjCy9C,GAAmB,QAASz9C,EAAQ,KACpC,MAAM4H,EAAe5H,EAAO4H,cAAgB,EAE5C01C,GAAW,qBAD+B,iBAAjB11C,EAA4BA,EAAaqV,QAAQ,GAAK8hC,OAAOn3C,OACvC,IACjD,CAEA,SAASo3C,GAA6Bj7C,GACpC,IAAK45C,GAAc,cACjB,OAEF,MAAM39C,EAAS+D,GAAO/D,QAAU,CAAC,EAC3B09C,EAAQD,GAAmB,QAASz9C,EAAQ,IAClD09C,EAAMtrB,UAAYpyB,EAAO5H,QAAUslD,EAAMtlD,OAEzCklD,GAAW,mBADaxhD,KAAKyC,MAAkD,KAA1CyB,EAAOsI,UAAY,GAAKjK,OAAO4gD,UAAiB,OAClC,IACrD,CAEA,SAASC,GAA8Bn7C,GAChC45C,GAAc,gBAInBF,GAAmB,aADJ15C,GAAO/D,QAAU,CAAC,EACQ,IACzCs9C,GAAW,mBAAoB,KACjC,CAEA,IAAI6B,IAAsB,EAE1B,SAAS,KACHA,IAAyC,oBAAX/qD,SAGlCA,OAAOkwB,iBAAiB,sBAAuB45B,IAC/C9pD,OAAOkwB,iBAAiB,oBAAqB65B,IAC7C/pD,OAAOkwB,iBAAiB,sBAAuB85B,IAC/ChqD,OAAOkwB,iBAAiB,uBAAwB+5B,IAChDjqD,OAAOkwB,iBAAiB,qBAAsBg6B,IAC9ClqD,OAAOkwB,iBAAiB,aAAcm6B,IACtCrqD,OAAOkwB,iBAAiB,iBAAkBo6B,IAC1CtqD,OAAOkwB,iBAAiB,aAAcq6B,IACtCvqD,OAAOkwB,iBAAiB,mBAAoBs6B,IAC5CxqD,OAAOkwB,iBAAiB,sBAAuBu6B,IAC/CzqD,OAAOkwB,iBAAiB,wBAAyBw6B,IACjD1qD,OAAOkwB,iBAAiB,2BAA4B06B,IACpD5qD,OAAOkwB,iBAAiB,4BAA6B46B,IACrD9qD,OAAOkwB,iBAAiB,sBAAuBi6B,IAC/CnqD,OAAOkwB,iBAAiB,UAAWs5B,IACnCuB,IAAsB,EACxB,CAEA,SAASC,GAAWzvD,EAAM2nB,GACxB,IAAK,IAAI9nB,EAAIG,EAAKF,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CAC5C,MAAM8jB,EAAQ3jB,EAAKH,GACnB8jB,EAAM1U,KAAO0Y,EACbhE,EAAMkqC,KAAOlqC,EAAMkqC,KAAO,GAAKlmC,EAC3BhE,EAAM1U,KAAO,GACfjP,EAAKoB,OAAOvB,EAAG,EAEnB,CACF,CAWA,SAAS6vD,KAEP,OADA,KACO,CACL1C,iBACAC,gBACAC,mBACAC,WACAC,kBACAC,QAAS,IAAKA,IAElB,CC5TA,MAAMsC,GAAc,CAClBC,eAAgB,EAChBC,aAAc,EACd14C,MAAO,GACP24C,aAAc,GCJhB,SAASC,GAAuBhS,EAAQiS,EAAWhpD,GACjD,MAAMipD,EAAWD,EAAYhpD,EACvBiG,EAAY4C,KAClB,IAAK,MAAMtI,KAAY0F,EAAW,CAChC,GAAI8wC,EAAO/uC,GAAK,EACd,SAEF,MAAMkhD,EAAWnS,EAAOv0C,EAAIxC,EAC5B,GAAIipD,GAAY1oD,EAASiC,GAAK0mD,GAAY3oD,EAASiC,GAC7Cu0C,EAAOv2C,GAAKD,EAASC,GAAKu2C,EAAOv2C,GAAKD,EAASC,EAAID,EAASL,MAM9D,OALA62C,EAAOv0C,EAAIjC,EAASiC,EAAIxC,EACxB+2C,EAAO/uC,GAAK,EACR9I,OAAOK,UAAUC,eAAeC,KAAKs3C,EAAQ,cAC/CA,EAAO3hC,UAAW,IAEb,CAGb,CACA,OAAO,CACT,CAEA,MAAM+zC,GAAkB,CACtBC,OAAQ,CAAE5a,KAAM,UAAWqH,OAAQ,WACnCwT,MAAO,CAAE7a,KAAM,UAAWqH,OAAQ,WAClCyT,QAAS,CAAE9a,KAAM,UAAWqH,OAAQ,WACpC0T,UAAW,CAAE/a,KAAM,UAAWqH,OAAQ,WACtC2T,QAAS,CAAEhb,KAAM,UAAWqH,OAAQ,WACpC4T,QAAS,CAAEjb,KAAM,UAAWqH,OAAQ,WACpC6T,OAAQ,CAAElb,KAAM,UAAWqH,OAAQ,WACnC8T,YAAa,CAAEnb,KAAM,UAAWqH,OAAQ,WACxC1c,MAAO,CAAEqV,KAAM,UAAWqH,OAAQ,WAClC+T,OAAQ,CAAEpb,KAAM,UAAWqH,OAAQ,WACnCgU,OAAQ,CAAErb,KAAM,UAAWqH,OAAQ,WACnC3c,KAAM,CAAEsV,KAAM,UAAWqH,OAAQ,WACjCiU,MAAO,CAAEtb,KAAM,UAAWqH,OAAQ,WAClCkU,QAAS,CAAEvb,KAAM,UAAWqH,OAAQ,WACpCmU,KAAM,CAAExb,KAAM,UAAWqH,OAAQ,WACjCoU,QAAS,CAAEzb,KAAM,UAAWqH,OAAQ,WACpCqU,OAAQ,CAAE1b,KAAM,UAAWqH,OAAQ,WACnCsU,MAAO,CAAE3b,KAAM,UAAWqH,OAAQ,YA+BpC,SAASuU,GAAa7pD,GACpB,MAAMlD,EAAQ8rD,GAAgB5oD,EAASkC,OAAS0mD,GAAgBgB,MAChE,EAAQ9b,UAAYhxC,EAAMmxC,KAC1B,EAAQuH,SAASx1C,EAASC,EAAGD,EAASiC,EAAGjC,EAASL,MAAOK,EAASP,QAClE,EAAQ21C,YAAct4C,EAAMw4C,OAC5B,EAAQlc,UAAY,EACpB,EAAQqc,WAAWz1C,EAASC,EAAGD,EAASiC,EAAGjC,EAASL,MAAOK,EAASP,OACtE,CAEA,SAASqqD,GAAazpD,GACpB,EAAQ8tC,OACR,EAAQL,UAAY,UACpB,EAAQ0H,SAASn1C,EAAMJ,EAAGI,EAAM4B,EAAG5B,EAAMV,MAAOU,EAAMZ,QACtD,EAAQquC,UAAY,UACpB,MAAMic,EAASnlD,KAAKmC,IAAI,EAAGnC,KAAKoC,MAAM3G,EAAMZ,OAAS,KACrD,IAAK,IAAIuqD,EAAI,EAAGA,EAAID,EAAQC,GAAK,EAAG,CAClC,MAAM/nD,EAAI5B,EAAM4B,EAAI,GAAK+nD,GAAK3pD,EAAMZ,OAASsqD,GAC7C,EAAQvU,SAASn1C,EAAMJ,EAAI,GAAIgC,EAAG5B,EAAMV,MAAQ,GAAI,EACtD,CACA,EAAQ+uC,SACV,CAGA,SAASub,GAAS5pD,GAChB,MAAME,EAAQF,EAAME,OAASF,EAAMJ,GAAK,EAClCsC,EAAQlC,EAAMkC,OAASlC,EAAM4B,GAAKzC,EAClCC,EAASY,EAAMZ,QAAU,IAC/B,EAAQ0uC,OACR,EAAQC,UAAU7tC,EAAOgC,GACzB,EAAQ6yC,YAAc,UACtB,EAAQhc,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAO,EAAG,GAClB,EAAQ6G,OAAO,GAAI51C,GACnB,EAAQ61C,SACR,EAAQlc,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAO,GAAI/uC,GACnB,EAAQ01C,iBAAiB,GAAc,GAAT11C,EAAa,GAAc,GAATA,GAChD,EAAQ+uC,OAAO,GAAI/uC,GACnB,EAAQ01C,kBAAkB,GAAc,GAAT11C,GAAc,GAAc,GAATA,GAClD,EAAQ61C,SACR,EAAQxH,UAAY,UACpB,IAAK,IAAIx1C,GAAK,EAAGA,GAAK,EAAGA,GAAK,EAC5B,EAAQy1C,YACR,EAAQ2S,QAAY,GAAJpoD,EAAkB,GAATmH,EAAa,GAAI,GAAKmF,KAAKC,GAAK,EAAKvM,EAAG,EAAa,EAAVsM,KAAKC,IACzE,EAAQopC,OAEV,EAAQS,SACV,CAEA,SAASwb,GAAS7pD,GAChB,EAAQ8tC,OACR,EAAQL,UAAY,UACpB,EAAQ0H,SAASn1C,EAAMJ,EAAGI,EAAM4B,EAAG5B,EAAMV,MAAOU,EAAMZ,QACtD,EAAQquC,UAAY,UACpB,MAAMqc,EAASvlD,KAAKmC,IAAI,EAAGnC,KAAKoC,MAAM3G,EAAMZ,OAAS,KACrD,IAAK,IAAInH,EAAI,EAAGA,EAAI6xD,EAAQ7xD,GAAK,EAAG,CAClC,MAAM2J,EAAI5B,EAAM4B,EAAI3J,GAAK+H,EAAMZ,OAAS0qD,GACxC,EAAQ3U,SAASn1C,EAAMJ,EAAI,EAAGgC,EAAI,EAAG5B,EAAMV,MAAQ,EAAG,EACxD,CACA,EAAQy1C,YAAc,UACtB,EAAQhc,UAAY,EACpB,EAAQgxB,YAAY,CAAC,EAAG,KACxB,EAAQ3U,WAAWp1C,EAAMJ,EAAI,EAAGI,EAAM4B,EAAI,EAAG5B,EAAMV,MAAQ,GAAIU,EAAMZ,OAAS,IAC9E,EAAQ2qD,YAAY,IACpB,EAAQ1b,SACV,CAEA,SAAS2b,GAAahqD,GACpB,EAAQ8tC,OACR,EAAQiH,YAAc,UACtB,EAAQhc,UAAY,GACpB,MAAMn5B,EAAII,EAAMJ,EACVgC,EAAI5B,EAAM4B,EACVtC,EAAQU,EAAMV,OAAS,IACvBF,EAASY,EAAMZ,QAAU,IAC/B,EAAQsuC,YACR,EAAQC,IAAI/tC,EAAGgC,EAAGtC,EAAQ,EAAGiF,KAAKC,GAAI,GAAG,GACzC,EAAQywC,SACR,EAAQlc,UAAY,EACpB,EAAQgc,YAAc,UACtB,EAAQrH,YACR,EAAQC,IAAI/tC,EAAGgC,EAAGtC,EAAQ,EAAI,GAAIiF,KAAKC,GAAI,GAAG,GAC9C,EAAQywC,SACR,EAAQxH,UAAY,UACpB,IAAK,IAAIx1C,GAAK,EAAGA,GAAK,EAAGA,GAAK,EAC5B,EAAQy1C,YACR,EAAQ2S,QAAQzgD,EAAQ,GAAJ3H,EAAQ2J,EAAa,GAATxC,EAAc,GAAI,GAAImF,KAAKC,GAAK,EAAG,EAAa,EAAVD,KAAKC,IAC3E,EAAQopC,OAEV,EAAQS,SACV,CAEA,SAAS4b,GAAcjqD,GACrB,MAAMJ,EAAII,EAAMJ,EACVgC,EAAI5B,EAAM4B,EAChB,EAAQksC,OACR,MAAMR,EAAW,EAAQC,qBAAqB3tC,EAAGgC,EAAG,EAAGhC,EAAGgC,EAAG,IAC7D0rC,EAASE,aAAa,EAAG,4BACzBF,EAASE,aAAa,EAAG,0BACzB,EAAQC,UAAYH,EACpB,EAAQI,YACR,EAAQC,IAAI/tC,EAAGgC,EAAG,GAAI,EAAa,EAAV2C,KAAKC,IAC9B,EAAQopC,OACR,EAAQH,UAAY,UACpB,EAAQC,YACR,EAAQC,IAAI/tC,EAAGgC,EAAG,EAAG,EAAa,EAAV2C,KAAKC,IAC7B,EAAQopC,OACR,EAAQS,SACV,CAEA,SAAS6b,GAAclqD,GACrB,MAAMV,EAAQU,EAAMV,OAAS,GACvBF,EAASY,EAAMZ,QAAU,IACzBQ,EAAII,EAAMJ,EAAIN,EAAQ,EACtBsC,EAAI5B,EAAM4B,EAAIxC,EACdkuC,EAAW,EAAQ6c,qBAAqBvqD,EAAGgC,EAAGhC,EAAGgC,EAAIxC,GAC3DkuC,EAASE,aAAa,EAAG,4BACzBF,EAASE,aAAa,EAAG,4BACzB,EAAQC,UAAYH,EACpB,EAAQ6H,SAASv1C,EAAGgC,EAAGtC,EAAOF,GAC9B,EAAQ21C,YAAc,2BACtB,EAAQhc,UAAY,EACpB,IAAK,IAAI9gC,EAAI,EAAGA,EAAIqH,EAAOrH,GAAK,GAC9B,EAAQy1C,YACR,EAAQS,OAAOvuC,EAAI3H,EAAI,EAAG2J,GAC1B,EAAQozC,OAAOp1C,EAAI3H,EAAI,EAAG2J,EAAIxC,GAC9B,EAAQ61C,QAEZ,CAEA,SAASmV,GAASpqD,GAChB,MAAME,EAAQF,EAAME,OAASF,EAAMJ,GAAK,EAClCsC,EAAQlC,EAAMkC,OAASlC,EAAM4B,GAAKzC,EAClCG,EAAQU,EAAMV,OAAS,IACvBF,EAASY,EAAMZ,QAAU,IAC/B,EAAQ0uC,OACR,EAAQL,UAAYztC,EAAMuC,OAAS,UACnC,EAAQmrC,YACR,EAAQS,OAAOjuC,EAAQZ,EAAQ,EAAG4C,GAClC,EAAQ4yC,iBAAiB50C,EAAOgC,EAAQ9C,EAAQc,EAAQZ,EAAQ,EAAG4C,GACnE,EAAQksC,YACR,EAAQR,OACR,EAAQH,UAAY,4BACpB,EAAQC,YACR,EAAQS,OAAOjuC,EAAgB,GAARZ,EAAa4C,EAAiB,IAAT9C,GAC5C,EAAQ01C,iBAAiB50C,EAAOgC,EAAiB,IAAT9C,EAAec,EAAgB,IAARZ,EAAc4C,EAAiB,IAAT9C,GACrF,EAAQ41C,OAAO90C,EAAgB,GAARZ,EAAa4C,EAAiB,IAAT9C,GAC5C,EAAQwuC,OACR,EAAQS,SACV,CAEA,SAASgc,GAAcrqD,GACrB,MAAME,EAAQF,EAAME,OAASF,EAAMJ,GAAK,EAClCsC,EAAQlC,EAAMkC,OAASlC,EAAM4B,GAAKzC,EAClCC,EAASY,EAAMZ,QAAU,IAC/B,EAAQ0uC,OACR,EAAQL,UAAY,UACpB,EAAQC,YACR,EAAQS,OAAOjuC,EAAQ,GAAIgC,GAC3B,EAAQ8yC,OAAO90C,EAAQ,GAAIgC,GAC3B,EAAQ8yC,OAAO90C,EAAQ,EAAGgC,EAAQ9C,GAClC,EAAQ41C,OAAO90C,EAAQ,GAAIgC,EAAiB,IAAT9C,GACnC,EAAQgvC,YACR,EAAQR,OACR,EAAQmH,YAAc,UACtB,EAAQhc,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAOjuC,EAAQ,EAAGgC,EAAiB,GAAT9C,GAClC,EAAQ41C,OAAO90C,EAAQ,EAAGgC,EAAiB,GAAT9C,GAClC,EAAQ61C,SACR,EAAQ5G,SACV,CAEA,SAASic,GAAatqD,GACpB,MAAME,EAAQF,EAAME,OAASF,EAAMJ,GAAK,EAClCsC,EAAQlC,EAAMkC,OAASlC,EAAM4B,GAAKzC,EAAW,GACnD,EAAQ2uC,OACR,EAAQiH,YAAc,UACtB,EAAQhc,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAOjuC,EAAQ,GAAIgC,EAAQ,IACnC,EAAQ8yC,OAAO90C,EAAQ,GAAIgC,EAAQ,GACnC,EAAQisC,OAAOjuC,EAAQ,GAAIgC,EAAQ,IACnC,EAAQ8yC,OAAO90C,EAAQ,GAAIgC,EAAQ,GACnC,EAAQ+yC,SACR,MAAM3H,EAAW,EAAQC,qBAAqBrtC,EAAOgC,EAAQ,GAAI,EAAGhC,EAAOgC,EAAQ,GAAI,IACvForC,EAASE,aAAa,EAAG,4BACzBF,EAASE,aAAa,GAAK,2BAC3BF,EAASE,aAAa,EAAG,yBACzB,EAAQC,UAAYH,EACpB,EAAQI,YACR,EAAQC,IAAIztC,EAAOgC,EAAQ,GAAI,GAAI,EAAa,EAAVqC,KAAKC,IAC3C,EAAQopC,OACR,EAAQS,SACV,CAEA,SAASkc,GAAYvqD,GACnB,MAAMJ,EAAII,EAAMJ,EACVgC,EAAI5B,EAAM4B,EACVxC,EAASY,EAAMZ,QAAU,IAC/B,EAAQ0uC,OACR,EAAQiH,YAAc,UACtB,EAAQhc,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAOvuC,EAAGgC,EAAIxC,GACtB,EAAQ41C,OAAOp1C,EAAGgC,GAClB,EAAQqzC,SACR,EAAQF,YAAc,UACtB,EAAQhc,UAAY,EACpB,IAAK,IAAI9gC,EAAI,EAAGA,EAAI,EAAGA,GAAK,EAAG,CAC7B,MAAM+M,GAAU/M,EAAI,IAAMmH,EAAS,GACnC,EAAQsuC,YACR,EAAQS,OAAOvuC,EAAI,GAAIgC,EAAIoD,GAC3B,EAAQgwC,OAAOp1C,EAAI,GAAIgC,EAAIoD,EAAS,IACpC,EAAQiwC,QACV,CACA,EAAQxH,UAAY,UACpB,EAAQC,YACR,EAAQC,IAAI/tC,EAAGgC,EAAG,GAAI,EAAa,EAAV2C,KAAKC,IAC9B,EAAQopC,OACR,EAAQS,SACV,CAEA,SAASmc,GAAUxqD,GACjB,MAAME,EAAQF,EAAME,OAASF,EAAMJ,GAAK,EAClCsC,EAAQlC,EAAMkC,OAASlC,EAAM4B,GAAKzC,EAClCC,EAASY,EAAMZ,QAAU,IAC/B,EAAQ0uC,OACR,EAAQL,UAAY,UACpB,EAAQC,YACR,EAAQS,OAAOjuC,EAAQ,GAAIgC,GAC3B,EAAQ8yC,OAAO90C,EAAQ,GAAIgC,GAC3B,EAAQ8yC,OAAO90C,EAAQ,EAAGgC,EAAQ9C,GAClC,EAAQ41C,OAAO90C,EAAQ,GAAIgC,EAAiB,GAAT9C,GACnC,EAAQgvC,YACR,EAAQR,OACR,EAAQH,UAAY,4BACpB,EAAQC,YACR,EAAQS,OAAOjuC,EAAOgC,EAAiB,IAAT9C,GAC9B,EAAQ41C,OAAO90C,EAAQ,GAAIgC,EAAiB,GAAT9C,GACnC,EAAQ41C,OAAO90C,EAAQ,EAAGgC,EAAiB,IAAT9C,GAClC,EAAQgvC,YACR,EAAQR,OACR,EAAQS,SACV,CAEA,SAASoc,GAAkBzqD,GACzB,EAAQ8tC,OACR,MAAMluC,EAAII,EAAMJ,EAAII,EAAMV,MAAQ,EAC5BsC,EAAI5B,EAAM4B,EAAI5B,EAAMZ,OACpBkuC,EAAW,EAAQ6c,qBAAqBvqD,EAAGgC,EAAGhC,EAAII,EAAMV,MAAOsC,EAAI5B,EAAMZ,QAC/EkuC,EAASE,aAAa,EAAG,2BACzBF,EAASE,aAAa,EAAG,4BACzB,EAAQC,UAAYH,EACpB,EAAQ6H,SAASv1C,EAAGgC,EAAG5B,EAAMV,MAAOU,EAAMZ,QAC1C,EAAQ21C,YAAc,UACtB,EAAQhc,UAAY,EACpB,EAAQqc,WAAWx1C,EAAGgC,EAAG5B,EAAMV,MAAOU,EAAMZ,QAC5C,EAAQquC,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQC,UAAY,SACpB,EAAQC,SAASn/C,EAAMgC,MAAQ,OAAQhC,EAAMJ,EAAGI,EAAM4B,EAAI5B,EAAMZ,OAAS,GACzE,EAAQivC,SACV,CAEA,SAASqc,GAAe1qD,GACtB,MAAME,EAAQF,EAAME,OAASF,EAAMJ,GAAK,EAClCsC,EAAQlC,EAAMkC,OAASlC,EAAM4B,GAAKzC,EAAW,GAC7CC,EAASY,EAAMZ,QAAU,IAC/B,EAAQ0uC,OACR,EAAQiH,YAAc,UACtB,EAAQhc,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAOjuC,EAAQ,GAAIgC,GAC3B,EAAQ8yC,OAAO90C,EAAQ,GAAIgC,EAAQ9C,GACnC,EAAQ+uC,OAAOjuC,EAAQ,GAAIgC,GAC3B,EAAQ8yC,OAAO90C,EAAQ,GAAIgC,EAAQ9C,GACnC,EAAQ61C,SACR,EAAQF,YAAc,UACtB,EAAQhc,UAAY,EACpB,IAAK,IAAIn3B,EAAI,EAAGA,GAAKxC,EAAQwC,GAAK,GAChC,EAAQ8rC,YACR,EAAQS,OAAOjuC,EAAQ,GAAIgC,EAAQN,GACnC,EAAQkzC,iBAAiB50C,EAAOgC,EAAQN,EAAI,GAAI1B,EAAQ,GAAIgC,EAAQN,EAAI,GACxE,EAAQqzC,SAEV,EAAQxH,UAAY,UACpB,EAAQC,YACR,EAAQC,IAAIztC,EAAOgC,EAAQ9C,EAAS,GAAI,GAAI,EAAa,EAAVmF,KAAKC,IACpD,EAAQopC,OACR,EAAQS,SACV,CAEA,SAASsc,GAAa3qD,GACpB,EAAQ8tC,OACR,EAAQL,UAAY,UACpB,EAAQC,YACR,EAAQ2S,QAAQrgD,EAAMJ,EAAGI,EAAM4B,EAAG,GAAI,GAAI,EAAG,EAAa,EAAV2C,KAAKC,IACrD,EAAQopC,OACR,EAAQH,UAAY,UACpB,EAAQ0H,SAASn1C,EAAMJ,EAAI,GAAII,EAAM4B,EAAI,EAAG,GAAI,IAChD,EAAQysC,SACV,CClXA,SAASuc,KACP,OAAOn4C,GAAekE,GAASI,kBAAoBtE,GAAeva,SAAWua,GAAe,EAC9F,CAsBA,SAASo4C,GAAiBjrD,EAAGgC,GAC3B,IAAIkpD,EAAO,KACPzI,EAAWv7C,OAAOgV,kBACtB,IAAK,MAAM1C,KAAStT,GAAS,CAC3B,GAAIsT,EAAMrE,QAAU,EAClB,SAEF,MAAMwmB,EAAKniB,EAAMxZ,EAAIA,EACf47B,EAAMpiB,EAAMxX,EAAmB,GAAfwX,EAAMha,OAAgBwC,EACtCmpD,EAAOxmD,KAAKs3B,MAAMN,EAAIC,GACxBuvB,EAAO1I,IACTA,EAAW0I,EACXD,EAAO1xC,EAEX,CACA,OAAO0xC,CACT,CAqBA,SAASE,GAAa7U,EAAQltC,EAAS8W,EAAOkrC,EAAc,GAC1D,MAAM5rB,EAAUp2B,EAAUktC,EAAOv2C,EAGjC,GADAu2C,EAAOjvC,GAAK,EACR3C,KAAK0xC,IAAI5W,GAFK,GAEiB,CACjC,MAAMhG,EAAM90B,KAAKo3B,KAAK0D,GACtB8W,EAAOjvC,GAAKmyB,EAAMxnB,GAAQo5C,EAC1B9U,EAAOh0C,OAASk3B,CAClB,CACF,CAEA,SAAS6xB,GAAa/U,EAAQz5C,EAAQqjB,GAEpC,GADAo2B,EAAOhgC,aAAe5R,KAAKmC,IAAI,GAAIyvC,EAAOhgC,cAAgB,GAAK4J,GAC3Do2B,EAAOhgC,aAAe,EACxB,OAEFggC,EAAOhgC,a7DnDc,I6DqDrB,MAAMF,EAAMkgC,EAAOlgC,KAAO,KACpBwgC,EAASxgC,GAAOnP,OAAOC,SAASkP,EAAI5C,UAAYvM,OAAOC,SAASkP,EAAI3C,SACtE,CAAE1T,EAAGqW,EAAI5C,QAASzR,EAAGqU,EAAI3C,SACzB4iC,GAAkBC,EAAQ,GAAMpkC,UAC9B9I,EAAUvM,EAAOkD,EACjB2T,EAAU7W,EAAOkF,EAAoB,IAAhBlF,EAAO0C,OAC5B+rD,EAAUl1C,GAAOnP,OAAOC,SAASkP,EAAI/C,SAAW+C,EAAI/C,QAAUjK,EAAUwtC,EAAO72C,EAC/EwrD,EAAUn1C,GAAOnP,OAAOC,SAASkP,EAAI9C,SAAW8C,EAAI9C,QAAUI,EAAUkjC,EAAO70C,EAC/EypD,EAAO9mD,KAAKs3B,MAAMsvB,EAASC,IAAY,EACvCjP,EAAOgP,EAAUE,EACjBjP,EAAOgP,EAAUC,EACjBC,GAASlP,EACTmP,EAAQpP,EAGRqP,EAAgB,GAAKrV,EAAO3/B,WAAa,GAAK,EAM9CtP,E7DzEW,I6DyENi1C,EAELh6C,EAAS+E,GAAM,EAAI,GAAK,EAE9B40B,GAAgB,CACdl8B,EAVc62C,EAAO72C,EAFA,GAEIu8C,EAAwBmP,EAAQE,EAWzD5pD,EAVc60C,EAAO70C,EAHA,GAGIw6C,EAAwBmP,EAAQC,EAWzDtkD,KACAE,G7DjFe,I6D0ENg1C,EAFW,GAUpBv7C,OAAQ,EACRiO,SAAU,GACVvM,MAAOJ,EAAS,EAAI,UAAY,UAChCgM,O7DpFgB,G6DqFhBC,UAAW,IACXjM,WAEFg0C,EAAO3gC,WAAa,GACtB,CAEA,SAASi2C,GAAgBC,EAAW3rC,GAClC,MAAM4rC,EAAUf,KACVn0C,EAAiBhD,GAAe,GAAM1B,UAQ5C,OAPc25C,EAAU9pD,EAAI6U,GACftX,EAAW,GAAKoF,KAAK0xC,IAAIyV,EAAUtkD,IAAM,IACpDskD,EAAUl3C,UAAW,GAGvBk3C,EAAUr1C,cAAgB,KAElBs1C,GAASlzD,IACf,IAAK,SAAU,CACb,MAAMiE,EAASmuD,GAAiBa,EAAU9rD,EAAG8rD,EAAU9pD,GACnDlF,GAAU6H,KAAK0xC,IAAIv5C,EAAOkD,EAAI+W,GAAS/W,I7D/GjC,K6DgHRorD,GAAaU,EAAWhvD,EAAOkD,EAAI,GAAImgB,EAAO,KAC9CmrC,GAAaQ,EAAWhvD,EAAQqjB,GAChC2rC,EAAUr1C,cAAgB3Z,EAAOjE,IAEjCuyD,GAAaU,EAAW/0C,GAAS/W,EAAI,GAAImgB,EAAO,IAElD,KACF,CACA,IAAK,SAAU,CACb,MAAM/a,EAAsC,IAA5B0mD,EAAUl1C,WAAa,GAAU,GACjDw0C,GAAaU,EAAW/0C,GAAS/W,EAAIoF,EAAQ+a,EAAO,IACpD,MAAMrjB,EAASmuD,GAAiBa,EAAU9rD,EAAG8rD,EAAU9pD,GACnDlF,GAAU6H,KAAK0xC,IAAIv5C,EAAOkD,EAAI+W,GAAS/W,I7D1HjC,M6D2HRsrD,GAAaQ,EAAWhvD,EAAQqjB,GAChC2rC,EAAUr1C,cAAgB3Z,EAAOjE,IAEnC,KACF,CACA,IAAK,QAAS,CACZ,MACMuM,E7DjIG,M6DgIU0mD,EAAUl1C,WAAa,GAAK,GAAM,GAAK,EAAI,GAE9Dw0C,GAAaU,EAAW/0C,GAAS/W,EAAIoF,EAAQ+a,EAAO,IACpD,MAAMrjB,EAASmuD,GAAiBa,EAAU9rD,EAAG8rD,EAAU9pD,GACnDlF,IACFwuD,GAAaQ,EAAWhvD,EAAQqjB,GAChC2rC,EAAUr1C,cAAgB3Z,EAAOjE,IAEnC,KACF,CAEA,QAAS,CACP,MAAMuM,EAAsC,IAA5B0mD,EAAUl1C,WAAa,GAAU,GACjDw0C,GAAaU,EAAW/0C,GAAS/W,EAAIoF,EAAQ+a,EAAO,IACpD,KACF,GA7HJ,SAAwBo2B,EAAQp2B,GAC9Bo2B,EAAO/uC,IAAM0K,GAAUiO,EACvB,MAAMqoC,EAAYjS,EAAOv0C,EACzBu0C,EAAOv2C,GAAKu2C,EAAOjvC,GAAK6Y,EACxBo2B,EAAOv0C,GAAKu0C,EAAO/uC,GAAK2Y,EACxBo2B,EAAO3hC,UAAW,EAClB,MAAMiC,EAAiBhD,GAAe,GAAM1B,UAC7Bo2C,GAAuBhS,EAAQiS,EAAW3xC,IAEzC0/B,EAAOv0C,EAAI6U,GACZtX,IACXg3C,EAAOv0C,EAAIzC,EAAWsX,EACtB0/B,EAAO/uC,GAAK,EACZ+uC,EAAO3hC,UAAW,GAGtB2hC,EAAOjvC,GAAK3C,KAAKmC,KAAI,IAAQnC,KAAK+E,IAAIuI,GAAOskC,EAAOjvC,IACtD,CA+GE0kD,CAAeF,EAAW3rC,GAC1B2rC,EAAUl2C,WAAajR,KAAKmC,IAAI,GAAIglD,EAAUl2C,YAAc,GAAKuK,EACnE,CC3KA,MAAM8rC,GAAmB,kBAEzB,SAASC,KACP,OAAOn1C,GAASE,W7CyZMpe,E6CzZqBke,GAASE,U7C0Z7Cwe,GAASjX,KAAMsW,GAAYA,EAAQj8B,KAAOA,IAAO,M6C1ZS,K7CyZnE,IAAwBA,C6CxZxB,CAEA,SAASszD,GAAcr3B,EAASs3B,EAAYjsC,GAC1C,GAAIisC,GAAc,EAChB,OAEF,MAAMC,EAAOD,EAAajsC,EACtB2U,EAAQxtB,GAAK,EACfwtB,EAAQxtB,GAAK3C,KAAKmC,IAAI,EAAGguB,EAAQxtB,GAAK+kD,GAC7Bv3B,EAAQxtB,GAAK,IACtBwtB,EAAQxtB,GAAK3C,KAAK+E,IAAI,EAAGorB,EAAQxtB,GAAK+kD,GAE1C,CAqCA,SAASC,GAAwBx3B,EAASv2B,GACxC,MAAMguD,EAAOhuD,EAAWwyB,YAAc,CAAE/wB,EAAG,EAAGgC,EAAGzD,EAAWiB,QACtD09B,EAAarpB,GAAe,GAAM1B,UAClCq6C,EAAa13B,EAAQ90B,EAAIusD,EAAKvsD,EAC9BysD,EAAa33B,EAAQ9yB,EAAIuqD,EAAKvqD,EAE9B6H,EAAW,GAAM2iD,EAAY,GADlB,KACiC,IAClDz1C,GAAS/W,EAAI6J,EACbkN,GAAS/U,EAAIyqD,EAAavvB,EAC1BnmB,GAASzP,GAAKwtB,EAAQxtB,GACtByP,GAASvP,GAAKstB,EAAQttB,GACtB,MAAMopB,EAAeryB,EAAWqyB,cAAgB,SAE9C7Z,GAASnC,SADU,QAAjBgc,IAEwB,UAAjBA,GAGWkE,EAAQlgB,UAE9BmC,GAASxU,OAASuyB,EAAQvyB,QAAUwU,GAASxU,MAC/C,CA2BA,SAASmqD,GAAY53B,EAASr8B,EAAU,CAAC,GACvC,MAAM8F,EAAamyB,GAAoBoE,EAAQ7yB,MAC/C,IAAK1D,EAGH,OAFAwY,GAASE,UAAY,UACrBF,GAASC,YAAc,UAIzB8d,EAAQE,SAAW,KACdv8B,EAAQk0D,eACX73B,EAAQG,cAAgBtwB,KAAKmC,IAAIguB,EAAQG,cAAex8B,EAAQqwB,UAAY,MAG9E,MAAMoU,EAAarpB,GAAe,GAAM1B,UAClCy6C,EAAcn0D,EAAQo0D,kBAAoB/3B,EAAQvyB,QAAU,EAAI,GAAK,GACrEyuB,EAAczyB,EAAWyyB,aAAe,GACxC87B,EAAiBF,GAAe,EAAI,CAAE5sD,EAAsB,GAAnBzB,EAAWmB,MAAasC,EAAG,GAAM,CAAEhC,EAAuB,IAAnBzB,EAAWmB,MAAasC,EAAG,GAC3G+qD,EAAeH,GAAe,EAAI57B,EAAY,IAAM87B,EAAiB97B,EAAY,IAAM87B,EAE7F/1C,GAASE,UAAY,KACrBF,GAASC,YAAc,SACvBD,GAASG,mBAAqB,KAC9B,MAAMzN,EAAW,KACjBsN,GAAS/W,EAAI,GAAM80B,EAAQ90B,EAAI+sD,EAAa/sD,EAAG,GAAIyJ,EAAW,IAC9DsN,GAAS/U,EAAIzC,EAAW29B,GACQ,IAA5BzkC,EAAQu0D,iBACVj2C,GAASzP,GAAK,EACdyP,GAASvP,GAAK,IAEduP,GAASzP,GAAkB,GAAbwtB,EAAQxtB,GACtByP,GAASvP,GAAK7C,KAAK+E,IAAIorB,EAAQttB,GAAI,IAErCuP,GAASnC,UAAW,EACpBmC,GAASxU,OAASqqD,GAAe,EAAI,GAAK,CAC5C,CA+EA,SAASK,GAAoBn4B,EAASv2B,EAAY4hB,EAAO+sC,GACnDA,EApMN,SAAgCp4B,EAASv2B,EAAY4hB,GACnD,MAAMgtC,EAAkBjjD,GAAMF,QAAUE,GAAMJ,KACxCsjD,EAAiBljD,GAAMJ,OAASI,GAAMF,MACtCvF,EAAY0oD,EAAkB,EAAIC,GAAkB,EAAI,EACxDl8B,EAAe3yB,EAAW2yB,cAAgB,EAC1CC,EAAU5yB,EAAW4yB,SAAW,IAChCC,EAAW7yB,EAAW6yB,UAAY,IAClCC,EAAW9yB,EAAW8yB,UAAY,EAMxC,GAJkB,IAAd5sB,GAAmBysB,EAAe,IACpC4D,EAAQxtB,IAAM7C,EAAYysB,EAAe/Q,GAGvCjW,GAAMG,MAAQyqB,EAAQlgB,UAAYuc,EAAU,EAAG,CACjD,MAAMk8B,EAAQl8B,EAAUhR,EACpB2U,EAAQxtB,GAAK,EACfwtB,EAAQxtB,GAAK3C,KAAKmC,IAAI,EAAGguB,EAAQxtB,GAAK+lD,GAC7Bv4B,EAAQxtB,GAAK,IACtBwtB,EAAQxtB,GAAK3C,KAAK+E,IAAI,EAAGorB,EAAQxtB,GAAK+lD,GAE1C,MAAyB,IAAd5oD,GACT0nD,GAAcr3B,EAASzD,EAAUlR,GAG/BiR,EAAW,IACb0D,EAAQxtB,GAAK,GAAMwtB,EAAQxtB,IAAK8pB,EAAUA,IAG1B,IAAd3sB,EACFqwB,EAAQvyB,OAASkC,EACRE,KAAK0xC,IAAIvhB,EAAQxtB,IAAM,IAChCwtB,EAAQvyB,OAASuyB,EAAQxtB,GAAK,EAAI,GAAK,EAE3C,CAoKIgmD,CAAuBx4B,EAASv2B,EAAY4hB,GAE5CgsC,GAAcr3B,EAASv2B,EAAW8yB,UAAY,EAAGlR,GAGnD,MAAMmR,EAAU/yB,EAAW+yB,SAAW,GACjCwD,EAAQlgB,UAAY0c,EAAU,GAAKA,EAAU,IAChDwD,EAAQxtB,IAAM3C,KAAK4oD,IAAIj8B,EAAS3sB,KAAKmC,IAAI,EAAW,GAARqZ,KAG9C2U,EAAQttB,IAAM0K,GAAUiO,EACxB2U,EAAQ90B,GAAK80B,EAAQxtB,GAAK6Y,EAC1B2U,EAAQ9yB,GAAK8yB,EAAQttB,GAAK2Y,EAE1B,MAAMqtC,EAAYjuD,EAAWhB,EAAWiB,OACpCs1B,EAAQ9yB,GAAKwrD,GACf14B,EAAQ9yB,EAAIwrD,EACZ14B,EAAQttB,GAAK,EACbstB,EAAQlgB,UAAW,GAEnBkgB,EAAQlgB,UAAW,EAGrB,MAAM7K,EAA+B,GAAnBxL,EAAWmB,MACvBmB,EAAOkJ,EAAY,GAEnBjJ,EADW,KACOiJ,EAAY,GACpC+qB,EAAQ90B,EAAI,GAAM80B,EAAQ90B,EAAGa,EAAMC,GAC/Bg0B,EAAQ90B,IAAMa,GAAQi0B,EAAQ90B,IAAMc,IACtCg0B,EAAQxtB,GAAK,GAGf,MAAMmmD,EAAa,GAAM34B,EAAQxtB,GAAK3C,KAAKmC,IAAI,EAAGvI,EAAW6yB,UAAY,KAAO,KAAO,IAAM,KAC7F0D,EAAQC,OAAS04B,EAAa34B,EAAQC,MAAQpwB,KAAK+E,IAAI,EAAW,GAARyW,EAC5D,CAEA,SAASutC,GAAmB54B,EAASv2B,EAAY4hB,EAAO+sC,GACtD,MAAMh8B,EAAe3yB,EAAWi1B,mBAAqBj1B,EAAW2yB,cAAgB,IAC1EE,EAAW7yB,EAAWk1B,eAAiBl1B,EAAW6yB,UAAY,IAC9Du8B,EAAepvD,EAAWm1B,mBAAqB/uB,KAAKmC,IAAI,GAAe,GAAXsqB,GAC5DC,EAAW9yB,EAAWo1B,eAAiBp1B,EAAW8yB,UAAY,IAC9Du8B,EAAiBrvD,EAAWq1B,UAAY,IACxCC,EAAet1B,EAAWs1B,cAAgB,EAC1CC,EAAWv1B,EAAWu1B,UAAY,IAClCE,EAAkBz1B,EAAWy1B,iBAAmB,GAChD65B,EAAe/4B,EAAQN,YAAej1B,GAAYhB,EAAWg1B,oBAAsB,IACnFQ,EAAgBx1B,EAAWw1B,eAAiB,IAC5CI,EAAkB51B,EAAW41B,iBAAmB,EAEhD25B,EAAaZ,GAAgBhjD,GAAMF,QAAUE,GAAMJ,KACnDikD,EAAYb,GAAgBhjD,GAAMJ,OAASI,GAAMF,MACjDvF,EAAYqpD,EAAa,EAAIC,GAAa,EAAI,EAQpD,GANkB,IAAdtpD,GAAmBysB,EAAe,EACpC4D,EAAQxtB,IAAM7C,EAAYysB,EAAe/Q,EAEzCgsC,GAAcr3B,EAASzD,EAAUlR,GAG/B+sC,GAAgBhjD,GAAMG,KAAM,CAC9B,MAAMgjD,EAAQO,EAAgBztC,EAC1B2U,EAAQxtB,GAAK,EACfwtB,EAAQxtB,GAAK3C,KAAKmC,IAAIguB,EAAQxtB,GAAK+lD,GAAQM,GAClC74B,EAAQxtB,GAAK,EACtBwtB,EAAQxtB,GAAK3C,KAAK+E,IAAIorB,EAAQxtB,GAAK+lD,EAAOM,GACjCN,EAAQ,IACjBv4B,EAAQxtB,GAAK,GAAMwtB,EAAQxtB,GAAKwtB,EAAQvyB,OAAS8qD,EAAQ,KAAOM,EAAcA,GAElF,CAEA74B,EAAQxtB,GAAK,GAAMwtB,EAAQxtB,IAAKqmD,EAAcv8B,GAE5B,IAAd3sB,EACFqwB,EAAQvyB,OAASkC,EACRE,KAAK0xC,IAAIvhB,EAAQxtB,IAAM,IAChCwtB,EAAQvyB,OAASuyB,EAAQxtB,GAAK,EAAI,GAAK,GAGzCwtB,EAAQ90B,GAAK80B,EAAQxtB,GAAK6Y,EAC1B,MAAMpW,EAA+B,GAAnBxL,EAAWmB,MACvBmB,EAAOkJ,EAAY,GAEnBjJ,EADW,KACOiJ,EAAY,GACpC+qB,EAAQ90B,EAAI,GAAM80B,EAAQ90B,EAAGa,EAAMC,GAC/Bg0B,EAAQ90B,IAAMa,GAAQi0B,EAAQ90B,IAAMc,IACtCg0B,EAAQxtB,GAAK,GAGfwtB,EAAQttB,GAAK,EAEbstB,EAAQK,UAAYL,EAAQK,UAAY,GAAKhV,GAAS2T,GAAYo5B,EAAe,IAAM,MACvF,MAAMc,EAAYrpD,KAAKwO,IAAI2hB,EAAQK,UAAYtB,EACzCo6B,EAActpD,KAAKwO,IAAuB,GAAnB2hB,EAAQK,SAA6B,IAAZL,EAAQ90B,GAAYg0B,EAAkB,EACtFrgB,EAAUk6C,EAAetvD,EAAWiB,OAASu0B,EAAgBI,EAAkB65B,EAAYC,EACjGn5B,EAAQ9yB,IAAM2R,EAAUmhB,EAAQ9yB,GAAK2C,KAAK+E,IAAI,EAAW,IAARyW,GAEjD2U,EAAQlgB,UAAW,EAEnB,MAAMs5C,EAAa,GAAMp5B,EAAQxtB,GAAK3C,KAAKmC,IAAI,EAAGsqB,GAAY,IAA2D,IAApDzsB,KAAKwO,IAAI2hB,EAAQK,SAA4B,GAAjBL,EAAQvyB,SAAuB,IAAM,KACtIuyB,EAAQC,OAASm5B,EAAap5B,EAAQC,MAAQpwB,KAAK+E,IAAI,EAAW,EAARyW,EAC5D,CAEA,SAASguC,GAAiBr5B,EAASv2B,EAAY4hB,EAAO+sC,GACpD,MAAM76B,EAAyB9zB,EAAW8zB,wBAA0B9zB,EAAW2yB,cAAgB,EACzFoB,EAAqB/zB,EAAW+zB,oBAAsB/zB,EAAW6yB,UAAY,IAC7EmB,EAAiBh0B,EAAWg0B,gBAAkBh0B,EAAW8yB,UAAY,IACrEC,EAAU/yB,EAAW+yB,SAAW,IAChCqD,EAAcp2B,EAAWs0B,kBAAoB,EAC7Cu7B,EAAczpD,KAAKmC,IAAI6tB,EAAap2B,EAAWu0B,kBAAoB6B,GACnE05B,EAAe9vD,EAAW8vD,cAAgB,IAC1Cr7B,EAAoBz0B,EAAWy0B,mBAAqB,EACpDJ,EAAkBr0B,EAAWq0B,iBAAmB,GAChDD,EAAmBp0B,EAAWo0B,kBAAoB,IAClDH,EAAYj0B,EAAWi0B,WAAa,EACpCC,EAAel0B,EAAWk0B,cAAgBD,EAE1C26B,EAAkBD,GAAgBhjD,GAAMF,QAAUE,GAAMJ,KACxDsjD,EAAiBF,GAAgBhjD,GAAMJ,OAASI,GAAMF,MACtDvF,EAAY0oD,EAAkB,EAAIC,GAAkB,EAAI,EAE5C,IAAd3oD,GAAmB4tB,EAAyB,EAC9CyC,EAAQxtB,IAAM7C,EAAY4tB,EAAyBlS,EAEnDgsC,GAAcr3B,EAASvC,EAAgBpS,GAGrCmS,EAAqB,IACvBwC,EAAQxtB,GAAK,GAAMwtB,EAAQxtB,IAAKgrB,EAAoBA,IAGpC,IAAd7tB,EACFqwB,EAAQvyB,OAASkC,EACRE,KAAK0xC,IAAIvhB,EAAQxtB,IAAM,IAChCwtB,EAAQvyB,OAASuyB,EAAQxtB,GAAK,EAAI,GAAK,GAGzCwtB,EAAQxtB,IAAM3C,KAAK4oD,IAAIj8B,EAAiB,GAARnR,GAEhC,MAAMoZ,EAAUrnB,IAAW3T,EAAWm0B,cAAgB,KAOtD,GANAoC,EAAQttB,IAAM+xB,EAAUpZ,EAEnBjZ,OAAOC,SAAS2tB,EAAQL,qBAC3BK,EAAQL,kBAAoBl2B,EAAWw0B,YAAc4B,GAGnDu4B,EACEhjD,GAAME,OACR0qB,EAAQL,mBAAqB45B,EAAeluC,GAE1CjW,GAAMG,OACRyqB,EAAQL,mBAAqB45B,EAAeluC,OAEzC,CACL,MAAMyU,EAAWr1B,GAAYu1B,EAAQ9yB,EAAIzD,EAAWiB,QACpDs1B,EAAQL,oBAAsBG,EAAWE,EAAQL,mBAAqB9vB,KAAK+E,IAAI,EAAW,GAARyW,EACpF,CAEA2U,EAAQL,kBAAoB,GAAMK,EAAQL,kBAAmBE,EAAay5B,GAE1E,MAAMx5B,EAAW,GAAMr1B,GAAYu1B,EAAQ9yB,EAAIzD,EAAWiB,QAASm1B,EAAay5B,GAC1EE,EAAgBx5B,EAAQL,kBAAoBG,EAClDE,EAAQttB,IAAM8mD,EAAgBt7B,EAAoB7S,EAE9C+sC,GAAgB16B,EAAY,IAC1BtoB,GAAME,OACR0qB,EAAQttB,IAAkB,IAAZgrB,EAAmBrS,GAE/BjW,GAAMG,OACRyqB,EAAQttB,IAAqB,IAAfirB,EAAsBtS,IAIxC2U,EAAQttB,IAAM7C,KAAK4oD,IAAI36B,EAAyB,GAARzS,GACpCwS,EAAmB,IACrBmC,EAAQttB,GAAK,GAAMstB,EAAQttB,IAAKmrB,EAAkBA,IAGpDmC,EAAQ90B,GAAK80B,EAAQxtB,GAAK6Y,EAC1B2U,EAAQ9yB,GAAK8yB,EAAQttB,GAAK2Y,EAE1B,MAAMpW,EAA+B,GAAnBxL,EAAWmB,MACvBmB,EAAOkJ,EAAY,GAEnBjJ,EADW,KACOiJ,EAAY,GACpC+qB,EAAQ90B,EAAI,GAAM80B,EAAQ90B,EAAGa,EAAMC,GAC/Bg0B,EAAQ90B,IAAMa,GAAQi0B,EAAQ90B,IAAMc,IACtCg0B,EAAQxtB,GAAK,GAGf,MAAMinD,EAAc,GAAMhvD,GAAYu1B,EAAQ9yB,EAAIzD,EAAWiB,QAASm1B,EAAay5B,GACnFt5B,EAAQ9yB,EAAIzC,EAAWhB,EAAWiB,OAAS+uD,GACtCA,IAAgB55B,GAAeG,EAAQttB,GAAK,GAAO+mD,IAAgBH,GAAet5B,EAAQttB,GAAK,KAClGstB,EAAQttB,GAAK,GAGfstB,EAAQlgB,UAAW,EAEnB,MAAM64C,EAAa,GAAM34B,EAAQxtB,GAAK3C,KAAKmC,IAAI,EAAGwrB,GAAsB,IAAuB,IAAhBg8B,GAAuB,GAAK,IAC3Gx5B,EAAQC,OAAS04B,EAAa34B,EAAQC,MAAQpwB,KAAK+E,IAAI,EAAW,EAARyW,EAC5D,CAEA,SAASquC,GAA4B15B,EAASO,EAAU4iB,GACtD,MAAM5hC,EAAM4hC,EAAW5hC,KAAO,KACxBpD,EAAYoD,GAAOnP,OAAOC,SAASkP,EAAIjD,OAASiD,EAAIjD,MAAQzO,KAAK6yC,MAAMnhC,GAAK9C,SAAW,EAAG8C,GAAK/C,SAAY+hB,EAAS9yB,QAAU,GAC9H2Q,EAAMvO,KAAKuO,IAAID,GACfE,EAAMxO,KAAKwO,IAAIF,GACf7N,EAASiwB,EAASjwB,QAAU,CAAEpF,EAAG,EAAGgC,EAAG,GACvCyR,EAAUvM,OAAOC,SAASkP,GAAK5C,SAAW4C,EAAI5C,QAAUqhB,EAAQ90B,EAAIoF,EAAOpF,EAC3E0T,EAAUxM,OAAOC,SAASkP,GAAK3C,SAAW2C,EAAI3C,QAAUohB,EAAQ9yB,EAAIoD,EAAOpD,EAC3E8vB,EAAUuD,EAASvD,SAAWuD,EAASvD,QAAQx5B,OAAS,EAAI+8B,EAASvD,QAAU,CAAC,CAAE9xB,EAAGq1B,EAASrO,QAAQhnB,GAAK,EAAGgC,EAAGqzB,EAASrO,QAAQhlB,GAAK,IACvIszB,EAAc2iB,EAAW3iB,aAAe,EACxCtO,EAAS8K,EAAQwD,EAAcxD,EAAQx5B,QAC7C2/C,EAAW3iB,aAAeA,EAAc,GAAKxD,EAAQx5B,OACrD,MAAMyU,EAASia,GAAQhnB,GAAK,EACtBiN,EAAS+Z,GAAQhlB,GAAK,EACtBysD,EAAUh7C,EAAU1G,EAASmG,EAAMjG,EAASkG,EAC5CuvC,EAAUhvC,EAAU3G,EAASoG,EAAMlG,EAASiG,EAE5Cw7C,EAAgBr5B,EAASrmB,YAAc,CAAC,EACxCC,EAAQy/C,EAAcz/C,OAAS,IAC/B0/C,GAAkBt5B,EAAStD,SAAW,IAAMptB,KAAKC,GAAK,KAEtDgqD,EAAa37C,GADE07C,EAAiB,GAAKhqD,KAAK4C,SAAW,IAAOonD,EAAiB,GAE7ErnD,EAAK3C,KAAKuO,IAAI07C,GAAc3/C,EAE5B1M,EAAS+E,GAAM,EAAI,GAAK,EAE9B40B,GAAgB,CACdl8B,EAAGyuD,EACHzsD,EAAG0gD,EACHp7C,KACAE,GAPS7C,KAAKwO,IAAIy7C,GAAc3/C,GAASy/C,EAAcG,eAAiB,GAQxE5tD,OAAQytD,EAAcztD,QAAU,EAChCiO,SAAUw/C,EAAcx/C,UAAY,IACpCvM,MAAO+rD,EAAc/rD,OAAS,UAC9B4L,OAAQmgD,EAAcngD,QAAU,GAChCC,UAAWkgD,EAAclgD,WAAa,GACtCjM,SACA4M,cAAeu/C,EAAcv/C,eAAiB,MAGhD8oC,EAAWriC,WAAayf,EAASrD,eAAiB,GAClDimB,EAAW1iB,YAAck5B,EACzBxW,EAAWziB,YAAcktB,CAC3B,CAEA,SAASoM,GAA+Bh6B,EAASv2B,EAAY4hB,EAAO+sC,GAClE,MAAMlV,EAAYz5C,EAAWqzB,gBAAkB,GACzCwD,EAASN,EAAQM,QAAU,GACjC,GAAyB,IAArB4iB,EAAU1/C,QAAkC,IAAlB88B,EAAO98B,OACnC,OAGF,MAAMy2D,EAAe7B,GAAgBhjD,GAAMS,WACrCqkD,EAAiB9B,GAAgBhjD,GAAMU,UAE7C,IAAK,IAAIvQ,EAAQ,EAAGA,EAAQ29C,EAAU1/C,OAAQ+B,GAAS,EAAG,CACxD,MAAMg7B,EAAW2iB,EAAU39C,GACrB49C,EAAa7iB,EAAO/6B,GAC1B,IAAKg7B,IAAa4iB,EAChB,SAGFA,EAAWnvB,SAAWnkB,KAAKmC,IAAI,GAAImxC,EAAWnvB,UAAY,GAAK3I,GAC/D83B,EAAWriC,WAAajR,KAAKmC,IAAI,GAAImxC,EAAWriC,YAAc,GAAKuK,GAEnE,IAAI8uC,GAAa,EACjB,MAAMp9B,EAAUwD,EAASxD,SAAW,UAChCq7B,EACc,YAAZr7B,EACFo9B,EAAaF,EACQ,cAAZl9B,IACTo9B,EAAaD,GAEN35B,EAAS65B,WAClBD,GAAa,IAGVA,GAAchX,EAAWnvB,SAAW,IAIzC0lC,GAA4B15B,EAASO,EAAU4iB,GAC/CA,EAAWnvB,SAAWuM,EAASzmB,cAAgB,GACjD,CACF,CC1dA,MAAMugD,GAAwB,CAAEt2D,GAAI,eAAgBmM,KAAM,kBAAmB+I,SAAU,cAGjFqhD,GAAgB,0DAChBC,GAAe,qCACfC,GAAgB,qCAEtB,SAAS,GAAoBppC,EAAKlmB,EAAGgC,EAAGtC,EAAOF,EAAQyB,EAAS,GAC9D,MAAMurC,EAAI7nC,KAAK+E,IAAIzI,EAAgB,GAARvB,EAAsB,GAATF,GACxC0mB,EAAI4nB,YACJ5nB,EAAIqoB,OAAOvuC,EAAIwsC,EAAGxqC,GAClBkkB,EAAIkvB,OAAOp1C,EAAIN,EAAQ8sC,EAAGxqC,GAC1BkkB,EAAIqpC,MAAMvvD,EAAIN,EAAOsC,EAAGhC,EAAIN,EAAOsC,EAAIwqC,EAAGA,GAC1CtmB,EAAIkvB,OAAOp1C,EAAIN,EAAOsC,EAAIxC,EAASgtC,GACnCtmB,EAAIqpC,MAAMvvD,EAAIN,EAAOsC,EAAIxC,EAAQQ,EAAIN,EAAQ8sC,EAAGxqC,EAAIxC,EAAQgtC,GAC5DtmB,EAAIkvB,OAAOp1C,EAAIwsC,EAAGxqC,EAAIxC,GACtB0mB,EAAIqpC,MAAMvvD,EAAGgC,EAAIxC,EAAQQ,EAAGgC,EAAIxC,EAASgtC,EAAGA,GAC5CtmB,EAAIkvB,OAAOp1C,EAAGgC,EAAIwqC,GAClBtmB,EAAIqpC,MAAMvvD,EAAGgC,EAAGhC,EAAIwsC,EAAGxqC,EAAGwqC,GAC1BtmB,EAAIsoB,WACN,CAEA,SAASghB,GAAYxvD,EAAGgC,EAAGtC,EAAOF,EAAQ/G,EAAU,CAAC,GACnD,MAAMytB,EAAM,EACZA,EAAIgoB,OAEJ,GAAoBhoB,EAAKlmB,EAAGgC,EAAGtC,EAAOF,EADvB/G,EAAQwI,QAAU,IAEjCilB,EAAI2nB,UAAYp1C,EAAQu1C,MAAQ,yBAChC9nB,EAAI8nB,QACmB,IAAnBv1C,EAAQ48C,SACVnvB,EAAIivB,YAAc18C,EAAQ48C,QAAU,4BACpCnvB,EAAIiT,UAAY1gC,EAAQg3D,aAAe,IACvCvpC,EAAImvB,UAEF58C,EAAQ0sD,SACVj/B,EAAI2nB,UAAYp1C,EAAQ0sD,OACxBj/B,EAAIqvB,SAASv1C,EAAGgC,EAAGtC,EAAOjH,EAAQi3D,cAAgB,IAEpDxpC,EAAIuoB,SACN,CAEA,SAASkhB,GAAkB3vD,EAAGgC,EAAGtC,EAAOF,EAAQ0hC,EAAUzoC,EAAU,CAAC,GACnE,MAAMytB,EAAM,EACNjlB,EAASxI,EAAQwI,QAAmB,GAATzB,EAC3BowD,EAAkB,GAAM1uB,GAAY,EAAG,EAAG,GAChDhb,EAAIgoB,OACJ,GAAoBhoB,EAAKlmB,EAAGgC,EAAGtC,EAAOF,EAAQyB,GAC9CilB,EAAI2nB,UAAYp1C,EAAQyM,YAAc,4BACtCghB,EAAI8nB,OACJ9nB,EAAI2pC,OACJ3pC,EAAI2nB,UAAYp1C,EAAQu1C,MAAQ,UAChC9nB,EAAIqvB,SAASv1C,EAAGgC,EAAGtC,EAAQkwD,EAAiBpwD,GAC5C0mB,EAAIuoB,WACmB,IAAnBh2C,EAAQq3D,SACV5pC,EAAIgoB,OACJ,GAAoBhoB,EAAKlmB,EAAGgC,EAAGtC,EAAOF,EAAQyB,GAC9CilB,EAAIivB,YAAc18C,EAAQq3D,QAAU,4BACpC5pC,EAAIiT,UAAY1gC,EAAQs3D,aAAe,EACvC7pC,EAAImvB,SACJnvB,EAAIuoB,UAER,CAEA,SAASuhB,GAAU5tD,EAAMpC,EAAGgC,EAAGvJ,EAAU,CAAC,GACxC,MAAMytB,EAAM,EACZA,EAAIgoB,OACJhoB,EAAIm5B,KAAOiQ,GACXppC,EAAIo5B,UAAY,OAChBp5B,EAAI+pC,aAAe,SACnB,MAAMC,EAAWz3D,EAAQy3D,UAAY,GAC/B1wD,EAAS/G,EAAQ+G,QAAU,GAC3BE,EAAQiF,KAAKwrD,KAAKjqC,EAAIkqC,YAAYhuD,GAAM1C,OAAoB,EAAXwwD,EAWvD,OAVA,GAAoBhqC,EAAKlmB,EAAGgC,EAAGtC,EAAOF,EAAiB,GAATA,GAC9C0mB,EAAI2nB,UAAYp1C,EAAQyM,YAAc,4BACtCghB,EAAI8nB,OACAv1C,EAAQq3D,SACV5pC,EAAIivB,YAAc18C,EAAQq3D,OAC1B5pC,EAAImvB,UAENnvB,EAAI2nB,UAAYp1C,EAAQkK,OAAS,UACjCujB,EAAIq5B,SAASn9C,EAAMpC,EAAIkwD,EAAUluD,EAAa,GAATxC,GAAgB/G,EAAQiU,SAAW,IACxEwZ,EAAIuoB,UACG/uC,CACT,CAEA,SAAS2wD,GAAkBtiD,GACzB,OAAKA,EAGDA,EAAS4+B,WAAW,SACf,4BAEL5+B,EAAS4+B,WAAW,UACf,4BAEQ,cAAb5+B,EACK,4BAEQ,WAAbA,EACK,4BAEF,4BAdE,2BAeX,CA+EA,SAASuiD,GAAcC,GACrB,MAAM1wD,EAAQ8E,KAAKmC,IAAI,EAAGypD,GAAW,GACrC,OAAO1wD,GAAS,GAAK,GAAG8E,KAAKyC,MAAMvH,MAAY,GAAGA,EAAMimB,QAAQ,KAClE,CA4ZA,SAAS0qC,KACP,MAAMC,EAAc,EAAQrxD,OAAOM,MAC7BgxD,EAAe,EAAQtxD,OAAOI,OAE9BmxD,EAAgB9zC,KAChB+zC,E3D3iBC51C,KAAqB7f,IAAKtC,GAAO,GAAmBA,IAAO,CAAEA,KAAImM,KAAM,Y2D4iBxEiY,EAAa0zC,EAAgBr0C,GAAcq0C,EAAc93D,IAAM,KAC/Dg4D,EnCtkBR,WACE,MAAM3lB,EDsGC,CACL5+B,OAAQkwB,GAAYlwB,OACpByF,SAAUyqB,GAAYzqB,SACtB0qB,YAAaD,GAAYC,YACzBtrB,SAAUqrB,GAAYrrB,SACtBurB,YAAaF,GAAYE,aC1G3B,MAAO,CACLo0B,YHoGK51B,GAAQ5iC,OGnGby4D,cFgEK30B,GAAa9vB,OE/DlB0kD,aAAc9lB,EAAO5+B,OACrB2kD,eAAgB/lB,EAAOn5B,SACvBm/C,kBAAmBhmB,EAAOzO,YAC1BrkB,eAAgBrB,GAASqB,gBAAkB,EAE/C,CmC4jBuB+4C,GACfC,EJrmBQjJ,GAAYC,eIqmBpBgJ,EJpmBMjJ,GAAYE,aIqmBlBgJ,EV3QR,WACE,MAAMx8C,EAAQ,KACRgjB,EAAY,GAAoBhjB,EAAM82B,gBAC5C,MAAO,CACLr/B,OAAQuI,EAAMvI,OACdglD,UAAW3qD,KACX4qD,cAAe15B,GAAW7yB,MAAQ,OAClC6lC,KAAMhT,GAAWgT,MAAQ,EACzBgB,MAAOh3B,EAAM+2B,YAAYC,MAE7B,CUiQsB2lB,GACdhrD,EAAY7B,KAAKmC,IAAI,EAAGuqD,GAAaC,WAAa,GAExD,IAAKv6C,GAASuB,iBAAmB,GAAK,EAAG,CACvC,MAAMm5C,EAAe9sD,KAAK+E,IAAI,KAAOqN,GAASuB,iBAAmB,GAAK,KACtE,EAAQu1B,UAAY,uBAAuB4jB,KAC3C,EAAQlc,SAAS,EAAG,EAAGkb,EAAaC,EACtC,CAEA,EAAQxiB,OACR,EAAQoR,UAAY,OACpB,EAAQ2Q,aAAe,aAEvB,MAAM76C,EAAYzQ,KAAKmC,IAAI,EAAGiQ,GAAS3B,WAAa,KAC9C4lC,EAAc,GAAMjkC,GAAS5B,OAASC,EAAW,EAAG,GACpDs8C,EAAYb,GAAcK,mBAAqB,EAC/CD,EAAiBJ,GAAcI,gBAAkB,EACjDU,EAAcD,EAAY,EAAI,GAAMT,EAAiBS,EAAW,EAAG,GAAK,EACxEV,GAAgBH,GAAcG,eAAgB,IAAUC,EAAiB,EAGzEW,EAAeZ,EAAe,IAAM,IAEpCa,EAAUnB,EAAekB,EAAe,GAE9CpC,GAHgB,GAGKqC,EALD,IAKuBD,EAAc,CAAEzM,OAAQ,YAEnE,EAAQ9F,KAAO+P,GACf,EAAQvhB,UAAY,UACpB,EAAQ0R,SAAS,gBAAiBuS,GAAcD,EAAU,IAE1D,EAAQxS,KAAOgQ,GACf,EAAQxhB,UAAY,UACpB,EAAQ0R,SAAS,UAAU56C,KAAKyC,MAAM2P,GAAS5B,aAAaxQ,KAAKyC,MAAMgO,KAAc08C,GAAcD,EAAU,IAC7GlC,GAAkBmC,GAAcD,EAAU,GAAIE,IAAkB,GAAI/W,EAAa,CAAEhN,KAAM,YAEzF,IAAIgkB,EAAcH,EAAU,GAExBb,IACF,EAAQnjB,UAAY,UACpB,EAAQ0R,SAAS,UAAU56C,KAAKyC,MAAM6pD,QAAqBtsD,KAAKyC,MAAMsqD,KAAcI,GAAcE,GAClGrC,GAAkBmC,GAAcE,EAAc,EAAGD,IAAkB,GAAIJ,EAAa,CAAE3jB,KAAM,YAC5FgkB,GAAe,IAGjB,EAAQnkB,UAAY,UACpB,EAAQ0R,SAAS,aAAa/4C,IAAasrD,GAAcE,GACzDA,GAAe,GAEf,MAAMliD,EAAY8gD,EAAYpyC,KAAMjB,GAA2B,cAAlBA,EAAKxP,UAC5CkkD,EAAarB,EAAYpyC,KAAMjB,GAA2B,WAAlBA,EAAKxP,UAC7CoK,EAAgBxT,KAAKmC,IAAI,EAAGiQ,GAASoB,eAAiB,GACtDC,EAAiBzT,KAAKmC,IAAI,EAAG+pD,GAAcz4C,gBAAkB,GAC7D85C,EAAmBvtD,KAAKmC,IAAIgJ,GAAWA,WAAWK,iBAAmB,EAAGgI,GACxEg6C,EAAoBxtD,KAAKmC,IAAImrD,GAAY/gD,QAAQf,iBAAmB,EAAGiI,GAEvEg6C,EAAa,GAgCnB,GA9BIr7C,GAASc,iBACXu6C,EAAWv4D,KAAK,CAAEuI,KAAM,oBAAqB8C,WAAY,4BAA6BvC,MAAO,YAE3FmN,IACEqI,EAAgB,IAClBi6C,EAAWv4D,KAAK,CAAEuI,KAAM,SAASkuD,GAAcn4C,KAAkBjT,WAAY,4BAA6BvC,MAAO,YAEjHyvD,EAAWv4D,KAAK,CAAEuI,KAAM,cAAe8C,WAAY,4BAA6BvC,MAAO,aAGvFsvD,IACE75C,EAAiB,IACnBg6C,EAAWv4D,KAAK,CAAEuI,KAAM,UAAUkuD,GAAcl4C,KAAmBlT,WAAY,4BAA6BvC,MAAO,YAEnHyvD,EAAWv4D,KAAK,CAAEuI,KAAM,eAAgB8C,WAAY,2BAA4BvC,MAAO,cAGtFoU,GAASd,WAAa,GAAK,GAC9Bm8C,EAAWv4D,KAAK,CAAEuI,KAAM,WAAWkuD,GAAcv5C,GAASd,aAAc/Q,WAAY,4BAA6BvC,MAAO,aAErHoU,GAASuB,iBAAmB,GAAK,GACpC85C,EAAWv4D,KAAK,CAAEuI,KAAM,WAAWkuD,GAAcv5C,GAASuB,mBAAoBpT,WAAY,4BAA6BvC,MAAO,aAE3HoU,GAASb,gBAAkB,GAAK,GACnCk8C,EAAWv4D,KAAK,CAAEuI,KAAM,cAAckuD,GAAcv5C,GAASb,kBAAmBhR,WAAY,4BAA6BvC,MAAO,YAE9HoU,GAAS5B,QAAU,GACrBi9C,EAAWv4D,KAAK,CAAEuI,KAAM,SAAU8C,WAAY,4BAA6BvC,MAAO,YAGhFyvD,EAAW95D,OAAS,EAAG,CACzB,IAAI+5D,EAAOP,GACPQ,EAAON,EACX,IAAK,MAAMO,KAAOH,EAAY,CAC5B,MAAM1yD,EAAQswD,GAAUuC,EAAInwD,KAAMiwD,EAAMC,EAAMC,GAC9CF,GAAQ3yD,EAAQ,EACZ2yD,EAAO3yD,EAAQoyD,MACjBO,EAAOP,GACPQ,GAAQ,GAEZ,CACAN,EAAcM,EAAO,EACvB,CAEA,MAAME,EAAmB,IAEnBC,EAAehC,EAAc+B,EAAmB,GAEtDhD,GAAYiD,EADS,GACmBD,EAHd,IAGmD,CAAErN,OAAQkL,GAAkBM,GAAe5iD,UAAY,MAEpI,EAAQsxC,KAAO+P,GACf,EAAQvhB,UAAY,UACpB,EAAQ0R,SAAS,SAAUkT,EAAe,GAAIC,IAE9C,EAAQrT,KAAOgQ,GACf,EAAQxhB,UAAY,UACpB,EAAQ0R,SAASoR,GAAe3rD,MAAQ,UAAWytD,EAAe,GAAIC,IAElE/B,GAAe5iD,WACjB,EAAQsxC,KAAOiQ,GACf,EAAQzhB,UAAY,UACpB,EAAQ0R,SAASoR,EAAc5iD,SAAS4kD,QAAQ,KAAM,KAAK9L,cAAe4L,EAAe,GAAIC,KAG/F,IAAIE,EAAcF,IAElB,GAAIz1C,EAAY,CACd,MAAM41C,EAAa51C,EAAWhB,WAAa/U,OAAOgV,kBAC5C42C,EAAkBD,EAAa,MAAQ,GAAGluD,KAAKmC,IAAI,EAAGmW,EAAW5N,YACjE0jD,EAAiBF,EAAa,MAAQ,GAAGluD,KAAKmC,IAAI,EAAGmW,EAAW3N,WACtE,EAAQ+vC,KAAOgQ,GACf,EAAQxhB,UAAY,UACpB,EAAQ0R,SAAS,YAAYuT,eAA6BC,IAAkBN,EAAe,GAAIG,GAC/FA,GAAe,IACVC,GAAc51C,EAAWhB,SAAW,IACvC0zC,GAAkB8C,EAAe,GAAIG,EAAaJ,IAAuB,EAAG,GAAMv1C,EAAW5N,SAAW4N,EAAWhB,SAAU,EAAG,GAAI,CAAE+xB,KAAM,YAC5I4kB,GAAe,IAEb31C,EAAW5E,WAAa4E,EAAW1N,cAAgB,IAErDogD,GAAkB8C,EAAe,GAAIG,EAAaJ,IAAuB,EADlD,EAAI,GAAMv1C,EAAWZ,YAAcY,EAAW1N,cAAe,EAAG,GACK,CAAEy+B,KAAM,YACpG4kB,GAAe,GACf,EAAQvT,KAAOiQ,GACf,EAAQzhB,UAAY,UACpB,EAAQ0R,SAAS,aAAa+Q,GAAcrzC,EAAWZ,eAAgBo2C,EAAe,GAAIG,EAAc,GACxGA,GAAe,GAEnB,MACE,EAAQvT,KAAOgQ,GACf,EAAQxhB,UAAY,UACpB,EAAQ0R,SAAS,yBAA0BkT,EAAe,GAAIG,GAC9DA,GAAe,GAGjB,GAAI9iD,EAAW,CACb,MAAMkjD,EAAQ76C,GAAiB,IAC/B,EAAQknC,KAAOiQ,GACf,EAAQzhB,UAAYmlB,EAAQ,UAAY,UACxC,EAAQzT,SAAS,SAASyT,EAAQ,QAAU1C,GAAcn4C,KAAkBs6C,EAAe,GAAIG,GAC/FA,GAAe,GACXV,EAAmB,IAErBvC,GAAkB8C,EAAe,GAAIG,EAAaJ,IAAuB,EADnDQ,EAAQ,EAAI,EAAI,GAAM76C,EAAgB+5C,EAAkB,EAAG,GACU,CAAElkB,KAAM,YACnG4kB,GAAe,GAEnB,CAEA,GAAIX,EAAY,CACd,MAAMe,EAAQ56C,GAAkB,IAChC,EAAQinC,KAAOiQ,GACf,EAAQzhB,UAAYmlB,EAAQ,UAAY,UACxC,EAAQzT,SAAS,UAAUyT,EAAQ,QAAU1C,GAAcl4C,KAAmBq6C,EAAe,GAAIG,GACjGA,GAAe,GACXT,EAAoB,IAEtBxC,GAAkB8C,EAAe,GAAIG,EAAaJ,IAAuB,EADlDQ,EAAQ,EAAI,EAAI,GAAM56C,EAAiB+5C,EAAmB,EAAG,GACQ,CAAEnkB,KAAM,YACpG4kB,GAAe,GAEnB,CAEwBjuD,KAAKs3B,MAAMm1B,GAA4B,EAAGA,GAA0B,GACtE,MACpB,EAAQ/R,KAAOiQ,GACf,EAAQzhB,UAAY,UACpB,EAAQ0R,SAAS,oBAAoB6R,GAA2B,GAAGtrC,QAAQ,UAAUsrC,GAAyB,GAAGtrC,QAAQ,KAAM2sC,EAAe,GAAIG,GAClJA,GAAe,IAGjB,MAAMK,EAAe,GAOrB,IANKpC,GAAcC,aAAe,GAAK,GACrCmC,EAAap5D,KAAK,CAAEuI,KAAM,WAAWyuD,EAAaC,cAAe5rD,WAAY,4BAA6BvC,MAAO,YAE/GkuD,GAAcE,eAChBkC,EAAap5D,KAAK,CAAEuI,KAAM,iBAAkB8C,WAAY,4BAA6BvC,MAAO,YAE1FswD,EAAa36D,OAAS,EAAG,CAC3B,IAAI46D,EAAST,EAAe,GAC5B,MAAMU,EAAST,IACf,IAAK,MAAMU,KAASH,EAElBC,GADclD,GAAUoD,EAAMhxD,KAAM8wD,EAAQC,EAAQC,GAClC,CAEtB,CAEA,MAAMC,EAAY,CAChB,kDACA,oDACA,gDACA,mDAGF7D,GAAY,GAAI,GAAI,IADD,GAAwB,GAAnB6D,EAAU/6D,OACG,CAAE6sD,OAAQ,8BAC/C,EAAQ9F,KAAO+P,GACf,EAAQvhB,UAAY,UACpB,EAAQ0R,SAAS,gBAAiB,GAAI,IACtC,EAAQF,KAAOgQ,GACf,EAAQxhB,UAAY,UACpB,IAAIylB,EAAQ,GACZ,IAAK,MAAMC,KAAQF,EACjB,EAAQ9T,SAASgU,EAAM,GAAID,GAC3BA,GAAS,GAGX,MAAME,EAAQ,GACRC,E7BpiBR,WACE,MAAM5+C,EAAQusB,KACRmB,EAAUlB,KAChB,MAAO,CACL/0B,OAAQuI,EAAMvI,QAA0B,aAAhBuI,EAAMohB,MAC9BA,MAAOphB,EAAMohB,MACbzW,QAAS3K,EAAM2K,QACfqhB,aAAchsB,EAAMgsB,aACpB6yB,YAAanxB,GAASv9B,MAAQ,GAC9B2uD,mBAAoBpxB,GAASz0B,aAAe,GAC5CizB,kBAAmBlsB,EAAMksB,kBACzBC,cAAensB,EAAMmsB,cACrBzK,YAAa1hB,EAAM0hB,YACnB+J,UAAW,CACTr+B,KAAM4S,EAAMyrB,UAAUr+B,KACtB6Q,MAAO+B,EAAMyrB,UAAUxtB,MACvBhW,OAAQ+X,EAAMyrB,UAAUxjC,OACxBokC,SAAUrsB,EAAMyrB,UAAUY,SAC1BC,UAAWtsB,EAAMyrB,UAAUa,UAC3BhwB,SAAU0D,EAAMyrB,UAAUnvB,UAGhC,C6B8gBsByiD,GACpB,GAAIH,EACF,GAAIA,EAAYx9B,OAA+B,aAAtBw9B,EAAYx9B,MAAsB,CACzD,MAAM49B,EAAQ,GACRH,EAAcD,EAAYC,aAAe,gBACzC1yB,EAAgBr8B,KAAKmC,IAAI,EAAG2sD,EAAYzyB,eAAiB,GACzDH,EAAe4yB,EAAY5yB,eAAiB,EAClD,IAAIizB,EAAeJ,EACf1yB,EAAgB,GAAKH,GAAgB,IACvCizB,GAAgB,KAAKjzB,EAAe,KAAKG,MAE3C6yB,EAAMh6D,KAAK,CAAEuI,KAAM0xD,EAAcnxD,MAAO,YACxC,MAAM29B,EAAYmzB,EAAYnzB,WAAa,CAAC,EAC5C,GAAuB,cAAnBA,EAAUr+B,MAAwBq+B,EAAUxjC,OAAS,EAAG,CAC1D,MAAMokC,EAAWv8B,KAAK+E,IAAI42B,EAAUxjC,OAAQ6H,KAAKyC,MAAMk5B,EAAUY,UAAY,IAC7E2yB,EAAMh6D,KAAK,GAAGymC,EAAUxtB,OAAS,gBAAgBouB,KAAYZ,EAAUxjC,SACzE,KAA8B,YAAnBwjC,EAAUr+B,OAAuBq+B,EAAUa,WAAa,GAAK,EACtE0yB,EAAMh6D,KAAK,GAAGymC,EAAUxtB,OAAS,eAAew9C,GAAchwB,EAAUa,cAC/Db,EAAUxtB,OACnB+gD,EAAMh6D,KAAKymC,EAAUxtB,OAEnB2gD,EAAYj0C,SACdq0C,EAAMh6D,KAAK,CAAEuI,KAAMqxD,EAAYj0C,QAAS7c,MAAO,YAEjD6wD,EAAM35D,KAAK,CAAEk6D,MAAO,WAAY5O,OAAQ,UAAW0O,QAAOG,OAAQ,wBACpE,MACER,EAAM35D,KAAK,CAAEk6D,MAAO,WAAY5O,OAAQ,4BAA6B0O,MAAO,CAAC,gCAIjF,MAAMI,EhCvrBR,WACE,MAAMp/C,EAAQuiB,KACd,MAAO,CACL9qB,OAAQuI,EAAMvI,OACd2pB,MAAOphB,EAAMohB,MACbC,MAAOrhB,EAAMqhB,MACbjO,KAAMpT,EAAMoT,KACZkO,aAActhB,EAAMshB,aACpBC,WAAYvhB,EAAMuhB,WAClBC,MAAOxhB,EAAMwhB,MACbC,UAAWzhB,EAAMyhB,UACjBT,SAAUhhB,EAAMghB,SAChBC,UAAWjhB,EAAMihB,UACjBC,WAAYlhB,EAAMkhB,WAClBQ,YAAa1hB,EAAM0hB,YAEvB,CgCuqBsB29B,GACpB,GAAID,EAAa,CACf,MAAMJ,EAAQ,GACRvnD,EAASuf,QAAQooC,EAAY3nD,QAC7B6nD,EAAYxvD,KAAKmC,IAAI,EAAGmtD,EAAYhsC,MAAQgsC,EAAYp+B,UAAY,GAC1Eg+B,EAAMh6D,KAAKyS,EAAS,QAAQ3H,KAAKmC,IAAI,EAAGmtD,EAAYhsC,MAAQ,KAAO,aAAatjB,KAAKmC,IAAI,EAAGmtD,EAAYp+B,UAAYs+B,MAChH7nD,GACwB,SAAtB2nD,EAAYh+B,MACd49B,EAAMh6D,KAAK,YAAYy2D,GAAc2D,EAAY/9B,OAAS,MAC3B,cAAtB+9B,EAAYh+B,MACrB49B,EAAMh6D,KAAK,aAAay2D,GAAc2D,EAAY/9B,OAAS,MAE3D29B,EAAMh6D,KAAK,WAAWo6D,EAAY99B,gBAEpC09B,EAAMh6D,KAAK,SAASo6D,EAAY59B,OAAS,MACJ,WAA5B49B,EAAY19B,aACrBs9B,EAAMh6D,KAAK,qBACXg6D,EAAMh6D,KAAK,SAASo6D,EAAY59B,OAAS,iBAAiB49B,EAAY39B,WAAa,OAEnFu9B,EAAMh6D,KAAK,6BACNo6D,EAAYn+B,WAAa,GAAK,GACjC+9B,EAAMh6D,KAAK,cAAco6D,EAAYn+B,cAGzC09B,EAAM35D,KAAK,CACTk6D,MAAO,WACP5O,OAAQ74C,EAAS,UAAY,4BAC7BunD,QACAG,OAAQ1nD,EAAS,2BAA6B,6BAElD,CAEA,MAAM8nD,E5BxpBC,CACL9nD,OAAQk3B,GAAal3B,OACrB2b,KAAMub,GAAavb,KACnBkO,aAAcqN,GAAarN,aAC3BE,MAAOmN,GAAanN,MACpBR,SAAU2N,GAAa3N,SACvBC,UAAW0N,GAAa1N,UACxB6N,UAAWH,GAAaE,OAASF,GAAaG,UAAY,EAC1DD,OAAQF,GAAaE,OACrBE,iBAAkBJ,GAAaI,iBAC/BrN,YAAaiN,GAAajN,YAC1B89B,cAnQa,M4Bi5Bf,GAAID,EAAY,CACd,MAAMP,EAAQ,GACRvnD,EAASuf,QAAQuoC,EAAW9nD,QAC9BA,GACFunD,EAAMh6D,KAAK,QAAQ8K,KAAKmC,IAAI,EAAGstD,EAAWnsC,MAAQ,MAC9CmsC,EAAW1wB,SAAW0wB,EAAWzwB,WAAa,GAAK,EACrDkwB,EAAMh6D,KAAK,aAAay2D,GAAc8D,EAAWzwB,WAAa,MAE9DkwB,EAAMh6D,KAAK,WAAWu6D,EAAWj+B,gBAEnC09B,EAAMh6D,KAAK,SAASu6D,EAAW/9B,OAAS,OAExCw9B,EAAMh6D,KAAK,6CACNu6D,EAAWv+B,UAAY,GAAK,IAAMu+B,EAAWt+B,WAAa,GAAK,IAClE+9B,EAAMh6D,KAAK,aAAa8K,KAAKmC,IAAI,EAAGstD,EAAWv+B,UAAY,cAAcu+B,EAAWt+B,WAAa,MAGrG09B,EAAM35D,KAAK,CACTk6D,MAAO,UACP5O,OAAQ74C,EAAS,UAAY,2BAC7BunD,QACAG,OAAQ1nD,EAAS,mCAAqC,6BAE1D,CAEA,MAAMgoD,EAAUtQ,KAChB,GAAIsQ,EAAS,CACX,MAAMT,EAAQ,GACRvnD,EAASuf,QAAQyoC,EAAQhoD,QAC/B,GAAIA,EAAQ,CACV,MAAM23C,EAAet/C,KAAKmC,IAAI,EAAGwtD,EAAQrQ,cAAgB,GACnDL,EAAkBj/C,KAAKmC,IAAIm9C,EAAcqQ,EAAQ1Q,iBAAmBK,GAC1E4P,EAAMh6D,KAAK,GAAGoqD,KAAgBL,eAC9BiQ,EAAMh6D,KAAK,WAAW8K,KAAKmC,IAAI,EAAGwtD,EAAQxQ,gBAAkB,GAAGh+B,QAAQ,SACvE+tC,EAAMh6D,KAAK,cAAc8K,KAAKmC,IAAI,EAAGwtD,EAAQzQ,kBAAoB,GAAG/9B,QAAQ,WAC9E,MACE+tC,EAAMh6D,KAAK,mCACPy6D,EAAQ/9B,aAAuC,aAAxB+9B,EAAQ/9B,aACjCs9B,EAAMh6D,KAAK,iBAAiBy6D,EAAQ/9B,eAGxCi9B,EAAM35D,KAAK,CACTk6D,MAAO,gBACP5O,OAAQ74C,EAAS,UAAY,4BAC7BunD,QACAG,OAAQ1nD,EAAS,yBAA2B,uBAEhD,CAEA,MAAMioD,EftuBC,CACLC,cAAe7vD,KAAKmC,IAAI,EAAG0rC,GAAQC,eACnCgiB,cAAexiB,GAAkBO,GAAQE,iBAAiB5/B,OAAS,KACnE8/B,gBAAiBJ,GAAQK,cAAgB,EAAIL,GAAQI,gBAAkB,KACvE8hB,cAAeliB,GAAQK,cAAgB,EAAIL,GAAQK,cAAgBL,GAAQM,iBAAmB,EAC9FC,cAAeP,GAAQQ,YAAc,EAAIR,GAAQO,cAAgB,KACjE4hB,YAAaniB,GAAQQ,YAAc,EAAIR,GAAQQ,YAAcR,GAAQS,eAAiB,EACtF2hB,YAAariB,GAAYj6C,QeguB3B,GAAIi8D,IAAiBA,EAAa3hB,iBAAmB2hB,EAAaxhB,gBAAkBwhB,EAAaK,aAAe,GAAK,GAAI,CACvH,MAAMf,EAAQ,GACVU,EAAa3hB,iBACfihB,EAAMh6D,KAAK,CAAEuI,KAAMmyD,EAAa3hB,gBAAiBjwC,MAAO,aAErD4xD,EAAaC,eAAiB,GAAK,IAAOD,EAAaE,eAC1DZ,EAAMh6D,KAAK,aAAa06D,EAAaE,kBAAkBnE,GAAciE,EAAaC,eAAiB,OAEhGD,EAAaK,aAAe,GAAK,GACpCf,EAAMh6D,KAAK,kBAAkB06D,EAAaK,eAExCL,EAAaxhB,eACf8gB,EAAMh6D,KAAK,CAAEuI,KAAM,UAAUmyD,EAAaxhB,gBAAiBpwC,MAAO,YAEpE6wD,EAAM35D,KAAK,CAAEk6D,MAAO,eAAgB5O,OAAQ,UAAW0O,SACzD,CAEA,MAAMgB,EAAYxnC,OAClB,GAAIwnC,GAAaA,EAAUvnC,QAA+B,aAArBunC,EAAUvnC,OAAuB,CACpE,MAAMumC,EAAQ,GACdA,EAAMh6D,KAAK,WAAWg7D,EAAUvnC,UACP,cAArBunC,EAAUvnC,OACZumC,EAAMh6D,KAAK,2CAEXg6D,EAAMh6D,KAAK,gBAAgBif,KAAmBxgB,UAEhDk7D,EAAM35D,KAAK,CAAEk6D,MAAO,cAAe5O,OAAQ,4BAA6B0O,SAC1E,CAEA,MACMiB,EAvzBR,SAAyBtB,EAAOxzD,GAC9B,IAAIgC,EAqzBgB0wD,IApzBpB,IAAK,MAAMqC,KAAQvB,EAAO,CACxB,MAAMK,EAAQkB,EAAKlB,OAAS,GAGtB32B,EAAa,GAAiB,GAFlB22B,EAAMv7D,OAE0B,IADnCy8D,EAAKf,OAAS,EAAI,GAE3Bx0D,EAASmF,KAAKmC,IAAIiuD,EAAKC,WAAa,GAAI93B,GAC9CsyB,GAAYxvD,EAAGgC,EA+yBqDwwD,IA/yB3ChzD,EAAQ,CAAE2lD,OAAQ4P,EAAK5P,QAAU,4BAA6BnX,KAAM+mB,EAAK/mB,OAClG,EAAQE,OACR,EAAQoR,UAAY,OACpB,EAAQD,KAAO+P,GACf,EAAQvhB,UAAYknB,EAAKE,YAAc,UACvC,EAAQ1V,SAASwV,EAAKhB,MAAO/zD,EAAI,GAAIgC,EAAI,IACzC,EAAQq9C,KAAOgQ,GACf,IAAI6F,EAAQlzD,EAAI,GAChB,IAAK,MAAMuxD,KAAQM,EAAO,CACxB,MAAMzxD,EAAuB,iBAATmxD,EAAoBA,EAAOA,EAAKnxD,KAC9CO,EAAwB,iBAAT4wD,EAAoB,UAAaA,EAAK5wD,OAAS,UACpE,EAAQkrC,UAAYlrC,EACpB,EAAQ48C,SAASn9C,EAAMpC,EAAI,GAAIk1D,GAC/BA,GAAS,EACX,CACIH,EAAKf,SACP,EAAQ3U,KAAOiQ,GACf,EAAQzhB,UAAYknB,EAAKI,aAAe,UACxC,EAAQ5V,SAASwV,EAAKf,OAAQh0D,EAAI,GAAIgC,EAAIxC,EAAS,KAErD,EAAQivC,UACRzsC,GAAKxC,EAAS,EAChB,CACA,OAAOwC,CACT,CAuxBsBozD,CAAgB5B,EAAOf,IAl2B7C,SAA0B9yC,EAAOgxC,EAAe1zC,EAAYwzC,EAAaC,GACvE,IAAK/wC,GAA0B,IAAjBA,EAAMrnB,OAClB,OAEF,MACM+8D,EAAW11C,EAAMrnB,OACjBg9D,EAAiB3wD,KAAK+E,IAAkB,GAAd+mD,EAAmB,KAC7C8E,EAAY5wD,KAAK+E,IAAI,IAAK/E,KAAKmC,IAAI,IAAKwuD,EAH9B,IAG0DD,EAAW,IAAMA,IACrFG,EAAyB,GAAZD,EAEb1U,GAAU4P,GADG8E,EAAYF,EALf,IAKqCA,EAAW,KACpB,EACtCrzD,EAAI0uD,EAAe8E,EAAa,GAEtC71C,EAAM1F,QAAQ,CAACsD,EAAMljB,KACnB,MAAM2F,EAAI6gD,EAASxmD,GAASk7D,EAVd,IAWRE,EAAWl4C,EAAK1kB,KAAO83D,GAAe93D,GAC5C22D,GAAYxvD,EAAGgC,EAAGuzD,EAAWC,EAAY,CACvCrQ,OAAQsQ,EAAWpF,GAAkB9yC,EAAKxP,UAAY,IAAM,4BAC5DigC,KAAMynB,EAAW,yBAA2B,yBAC5Cx0D,OAAQ,GACRo0C,OAAQ,8BAEV,EAAQnH,OACR,EAAQoR,UAAY,OACpB,EAAQD,KAAOiQ,GACf,EAAQzhB,UAAY4nB,EAAW,UAAY,UAC3C,EAAQlW,SAAS,GAAGllD,EAAQ,IAAK2F,EAAI,GAAIgC,EAAI,IAC7C,EAAQq9C,KAAOgQ,GACf,EAAQxhB,UAAY4nB,EAAW,UAAY,UAC3C,MAAM3iD,EAAQyK,EAAKvY,KAAK1M,OAAS,GAAK,GAAGilB,EAAKvY,KAAK2P,MAAM,EAAG,SAAW4I,EAAKvY,KAE5E,GADA,EAAQu6C,SAASzsC,EAAO9S,EAAI,GAAIgC,EAAI,IAChCyzD,GAAYx4C,EAAY,CAC1B,MAAM41C,EAAa51C,EAAWhB,WAAa/U,OAAOgV,kBAC5C42C,EAAkBD,EAAa,MAAQ,GAAGluD,KAAKmC,IAAI,EAAGmW,EAAW5N,YACjE0jD,EAAiBF,EAAa,MAAQ,GAAGluD,KAAKmC,IAAI,EAAGmW,EAAW3N,WACtE,EAAQ+vC,KAAOiQ,GACf,EAAQzhB,UAAY,UACpB,EAAQ0R,SAAS,GAAGuT,KAAmBC,IAAkB/yD,EAAI,GAAIgC,EAAIwzD,EAAa,GACpF,CACA,EAAQ/mB,WAEZ,CA2zBEinB,CAAiB9E,EAAaD,EAAe1zC,EAAYwzC,EAAaC,GAEtE,MAAMiF,EAAc,CAClB,CAAC,KAAM,WACP,CAAC,KAAM,SACP,CAAC,MAAO,WACR,CAAC,MAAO,UACR,CAAC,MAAO,gBACR,CAAC,MAAO,YACR,CAAC,MAAO,gBACR,CAAC,MAAO,aAEJC,EAAqB,GAC3B,IAAK,MAAO9iD,EAAOtU,KAAQm3D,EAAa,CACtC,MACM3jB,EAAY,GAAGxzC,UACfqhB,EAAQ8wB,GAFG,GAAGnyC,WAEwB,EAC5C,GAAIqhB,GAAS,EACX,SAEF,MAAMR,EAAU1a,KAAKmC,IAAI,EAAG+Y,GAAS8wB,GAAiBqB,IAAc,IACpE4jB,EAAmB/7D,KAAK,GAAGiZ,KAASuM,KAAWQ,IACjD,CAEA,IAAIg2C,EAAenF,EAAe,GAClC,GAAIkF,EAAmBt9D,OAAS,EAAG,CACjC,EAAQ+mD,KAAOiQ,GACf,MAAMwG,EAAWF,EAAmBt6D,KAAK,OACnCy6D,EAAYpxD,KAAKmC,IAAI,IAAKnC,KAAKwrD,KAAK,EAAQC,YAAY0F,GAAUp2D,OAAS,IAC3Es2D,EAAa,GACbC,EAAQxF,EAAcsF,EAAY,GAClCG,EAAQxF,EAAesF,EAAa,GAC1CxG,GAAYyG,EAAOC,EAAOH,EAAWC,EAAY,CAAE7Q,OAAQ,4BAA6BlkD,OAAQ,KAChG,EAAQitC,OACR,EAAQmR,KAAOiQ,GACf,EAAQzhB,UAAY,UACpB,EAAQ0R,SAAS,cAAe0W,EAAQ,GAAIC,EAAQ,IACpD,EAAQroB,UAAY,UACpB,EAAQ0R,SAASuW,EAAUG,EAAQ,GAAIC,EAAQF,EAAa,IAC5D,EAAQvnB,UACRonB,EAAeK,CACjB,CAEA,MAAMC,EAAajO,KACbvC,EAAUwQ,GAAYxQ,SAAShxC,OAAO,GAAGyhD,WAAa,GACtDxQ,EAAiBuQ,GAAYvQ,gBAAkB,GAC/CyQ,EAAa,GACnB,IAAK,MAAMC,KAAU3Q,EAAS,CAC5B,MAAM5tB,EAAOu+B,EAAO3uD,OAAS,EAAI,GAAM2uD,EAAO7uD,IAAM6uD,EAAO3uD,OAAQ,EAAG,GAAK,EAC3E0uD,EAAWx8D,KAAK,CAAEuI,KAAMk0D,EAAO92C,QAAS+sB,MAAOxU,GACjD,CACA,IAAK,MAAMw+B,KAAa3Q,EAAgB,CACtC,MAAM7tB,EAAOw+B,EAAU5uD,OAAS,EAAI,GAAM4uD,EAAU9uD,IAAM8uD,EAAU5uD,OAAQ,EAAG,GAAK,EACpF0uD,EAAWx8D,KAAK,CAAEuI,KAAM,SAASm0D,EAAU36C,WAAY2wB,MAAOxU,GAChE,CACA,MAAMy+B,EAAgB93D,OAAOy0C,QAAQgjB,GAAYtQ,SAAW,CAAC,GAAGtsC,OAAO,EAAE,CAAE1Z,KAAWA,GAItF,GAHI22D,EAAcl+D,OAAS,GACzB+9D,EAAWx8D,KAAK,CAAEuI,KAAM,WAAWo0D,EAAcr7D,IAAI,EAAEqD,KAASA,GAAKlD,KAAK,QAASixC,MAAO,IAAM5pC,MAAO,YAErG0zD,EAAW/9D,OAAS,EAAG,CACzB,MAAMm+D,EAAc,GAAyB,GAApBJ,EAAW/9D,OACpC,IAAIo+D,EAAS5B,EAAc,GAC3B,MAAM6B,EAAYd,EAAeY,EAAc,GAC3CC,EAASC,IACXD,EAASC,GAEXnH,GAAYiD,EAAciE,EAAQlE,EAAkBiE,EAAa,CAAEtR,OAAQ,4BAA6BlkD,OAAQ,GAAI+sC,KAAM,2BAC1H,EAAQE,OACR,EAAQmR,KAAOiQ,GACf,EAAQzhB,UAAY,UACpB,EAAQ0R,SAAS,aAAckT,EAAe,GAAIiE,EAAS,IAC3D,IAAIE,EAAaF,EAAS,GAC1B,IAAK,MAAMv6C,KAASk6C,EAClB,EAAQthB,YAAc54B,EAAMowB,OAAS,EACrC,EAAQsB,UAAY1xB,EAAMxZ,OAAS,UACnC,EAAQ48C,SAASpjC,EAAM/Z,KAAMqwD,EAAe,GAAImE,GAChDA,GAAc,GAEhB,EAAQnoB,SACV,CAEA,EAAQA,SACV,CAiEA,SAASooB,MnB5/BT,WACE,GAA2B,IAAvBnoB,GAAYp2C,OAAhB,CAGA,EAAQ41C,OACR,EAAQ/U,UAAY,EACpB,IAAK,MAAMnqB,KAAc0/B,GAAa,CACpC,MAAMnC,EAAQ5nC,KAAKmC,IAAI,EAAGkI,EAAW+oB,KAAO/oB,EAAWgpB,SACvD,EAAQ6V,UAAY,uBAAuBtB,KAC3C,EAAQuB,YACR,EAAQC,IAAI/+B,EAAWhP,EAAGgP,EAAWhN,EAAGgN,EAAW/N,OAAQ,EAAa,EAAV0D,KAAKC,IACnE,EAAQopC,MACV,CACA,EAAQS,SAVR,CAWF,CmB++BEqoB,GlB3wBF,WACE,MAAMphC,EAAUC,KAChB,EAAQuY,OAER,IAAK,MAAMsB,KAAWJ,GACpB,GAAKI,EAAQC,UAoBN,CACL,MAAMt+B,EAAWxM,KAAKmC,IAAI0oC,EAAQp/B,kBAAmB,MAC/C8wB,EAAW,GAAM,EAAIsO,EAAQE,eAAiBv+B,EAAU,EAAG,GAC3Do7B,EAAQ,GAAM,EAAIrL,EAAU,EAAG,GAErC,GAA2B,UAAvBsO,EAAQj/B,WAAwB,CAClC,MAAM0hB,EAAcud,EAAQx/B,iBAAmB,GAAiB,GAAXkxB,GAC/C61B,EAAapyD,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI,EAAG,IAAO6iC,EAAQ,MAC1D,EAAQsB,UAAY,uBAAuBkpB,EAAWjxC,QAAQ,MAC9D,EAAQgoB,YACR,EAAQC,IAAIyB,EAAQxvC,EAAGwvC,EAAQxtC,EAAGiwB,EAAa,EAAa,EAAVttB,KAAKC,IACvD,EAAQopC,MACV,MAAO,GAA2B,UAAvBwB,EAAQj/B,WAAwB,CACzC,MAAMymD,EAAaxnB,EAAQx/B,iBAAmB,GAAiB,GAAXkxB,GAC9C+1B,EAAYtyD,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI,IAAM,GAAM6iC,EAAQ,KAC3D,EAAQsB,UAAY,uBAAuBopB,EAAUnxC,QAAQ,MAC7D,EAAQgoB,YACR,EAAQC,IAAIyB,EAAQxvC,EAAGwvC,EAAQxtC,EAAGg1D,EAAY,EAAa,EAAVryD,KAAKC,IACtD,EAAQopC,MACV,KAAO,CACL,MAAMkpB,EAAc1nB,EAAQx/B,iBAAmB,IAAkB,GAAXkxB,GAChDi2B,EAAYxyD,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI,EAAG,GAAM6iC,IAChD,EAAQ4I,YAAc,uBAAuBgiB,EAAUrxC,QAAQ,MAC/D,EAAQqT,UAAY,GAAK,EAAe,GAAX+H,GAC7B,EAAQ4M,YACR,EAAQC,IAAIyB,EAAQxvC,EAAGwvC,EAAQxtC,EAAGk1D,EAAa,EAAa,EAAVvyD,KAAKC,IACvD,EAAQywC,SAER,MAAM+hB,EAAYzyD,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI,EAAG,IAAO6iC,IACjD,EAAQsB,UAAY,sBAAsBupB,EAAUtxC,QAAQ,MAC5D,EAAQgoB,YACR,EAAQC,IAAIyB,EAAQxvC,EAAGwvC,EAAQxtC,EAAiB,GAAdk1D,EAAmB,EAAa,EAAVvyD,KAAKC,IAC7D,EAAQopC,MACV,CACF,KAtDwB,CACtB,EAAQ+G,YAAc,EACtB,EAAQlH,UAAY2B,EAAQ7sC,MAC5B,EAAQmrC,YACR,EAAQC,IAAIyB,EAAQxvC,EAAGwvC,EAAQxtC,EAAGwtC,EAAQvuC,OAAQ,EAAa,EAAV0D,KAAKC,IAC1D,EAAQopC,OAER,MAAMqpB,EAAY7nB,EAAQ8nB,QAAU,EAAI,GAAM9nB,EAAQG,KAAOH,EAAQ8nB,QAAS,EAAG,GAAK,EACtF,EAAQniB,YAAc,4BACtB,EAAQhc,UAAY,EACpB,EAAQ2U,YACR,EAAQC,IAAIyB,EAAQxvC,EAAGwvC,EAAQxtC,EAAoB,IAAjBwtC,EAAQvuC,QAAgB0D,KAAKC,GAAK,GAAID,KAAKC,GAAK,EAAc,EAAVD,KAAKC,GAASyyD,GACpG,EAAQhiB,SAER,MAAMkiB,EAAe5yD,KAAKuO,IAAc,GAAVwiB,GAAgB8Z,EAAQvuC,OAAS,GACzDu2D,EAAe7yD,KAAKwO,IAAc,GAAVuiB,GAAgB8Z,EAAQvuC,OAAS,GAAuB,GAAjBuuC,EAAQvuC,OAC7E,EAAQ4sC,UAAY,2BACpB,EAAQC,YACR,EAAQC,IAAIyB,EAAQxvC,EAAIu3D,EAAc/nB,EAAQxtC,EAAIw1D,EAAc,IAAK,EAAa,EAAV7yD,KAAKC,IAC7E,EAAQopC,MACV,CAqCF,EAAQS,UAnFV,WACE,GAA2B,IAAvBY,GAAY/2C,OAAhB,CAIA,EAAQ41C,OACR,IAAK,MAAM4B,KAAST,GAAa,CAC/B,MAAM+R,EAAY,GAAMtR,EAAM/X,KAAO+X,EAAM3+B,SAAU,EAAG,GAClDlQ,EAAS6uC,EAAM7uC,OACfysC,EAAW,EAAQC,qBAAqBmC,EAAM9vC,EAAG8vC,EAAM9tC,EAAY,IAATf,EAAe6uC,EAAM9vC,EAAG8vC,EAAM9tC,EAAGf,GACjGysC,EAASE,aAAa,EAAG,6BACzBF,EAASE,aAAa,EAAG,uBACzB,EAAQmH,YAAcqM,EACtB,EAAQvT,UAAYH,EACpB,EAAQI,YACR,EAAQC,IAAI+B,EAAM9vC,EAAG8vC,EAAM9tC,EAAGf,EAAQ,EAAa,EAAV0D,KAAKC,IAC9C,EAAQopC,MACV,CACA,EAAQS,SAfR,CAgBF,CAiEEgpB,EACF,CkB4sBEC,GvCvpBF,WAEE,GADAv9B,KACyB,IAArBhC,GAAU7/B,QAAiC,IAAjB8/B,GAAM9/B,OAApC,CAIA,EAAQ41C,OACR,IAAK,MAAMlV,KAAQZ,GAAO,CACxB,MAAML,EAAO,GAAMiB,EAAKvxB,IAAMuxB,EAAKrxB,OAAQ,EAAG,GACxCu5B,EAAW,EAAInJ,EACf92B,EAAS+3B,EAAKC,aAAeD,EAAKE,UAAYF,EAAKC,aAAeiI,EACxE,EAAQ6T,YAAkC,GAApB,GAAMhd,EAAM,EAAG,GACrC,EAAQoB,UAAYH,EAAKG,UACzB,EAAQgc,YAAcnc,EAAKr2B,MAC3B,EAAQmrC,YACR,EAAQC,IAAI/U,EAAKh5B,EAAGg5B,EAAKh3B,EAAGf,EAAQ,EAAa,EAAV0D,KAAKC,IAC5C,EAAQywC,QACV,CAEA,IAAK,MAAMsiB,KAAYx/B,GAAW,CAChC,MAAMJ,EAAO,GAAM4/B,EAASlwD,IAAMkwD,EAAShwD,OAAQ,EAAG,GACtD,IAAI4kC,EAAQ,GAAMxU,EAAM,EAAG,GACL,UAAlB4/B,EAAS11D,KACXsqC,GAAS,IACkB,UAAlBorB,EAAS11D,KAClBsqC,EAAQ,IAAe,IAARA,EACY,cAAlBorB,EAAS11D,KAClBsqC,EAAQ,IAAe,GAARA,EACY,UAAlBorB,EAAS11D,KAClBsqC,EAAQ,IAAe,IAARA,EACY,UAAlBorB,EAAS11D,KAClBsqC,EAAQ,IAAe,IAARA,EACY,SAAlBorB,EAAS11D,KAClBsqC,EAAQ,GAAc,GAARA,EACa,WAAlBorB,EAAS11D,OAClBsqC,EAAQ,GAAc,GAARA,GAEhB,EAAQwI,YAAcxI,EACtB,EAAQsB,UAAY8pB,EAASh1D,MAC7B,IAAIi1D,EAAa7/B,EACK,UAAlB4/B,EAAS11D,KACX21D,EAAa,EACc,UAAlBD,EAAS11D,KAClB21D,EAAa,GAAa,GAAP7/B,EACQ,cAAlB4/B,EAAS11D,KAClB21D,EAAa,EACc,UAAlBD,EAAS11D,KAClB21D,EAAa,GAAa,GAAP7/B,EACQ,SAAlB4/B,EAAS11D,KAClB21D,EAAa,GAAa,GAAP7/B,EACQ,WAAlB4/B,EAAS11D,OAClB21D,EAAa,GAAa,GAAP7/B,GAErB,MAAM92B,EAAS0D,KAAKmC,IAAI,IAAK6wD,EAAS12D,OAAS22D,GAC/C,EAAQ9pB,YACR,EAAQC,IAAI4pB,EAAS33D,EAAG23D,EAAS31D,EAAGf,EAAQ,EAAa,EAAV0D,KAAKC,IACpD,EAAQopC,MACV,CACA,EAAQS,SAtDR,CAuDF,CuC6lBEopB,GA9DF,WACE,MAAM,cAAErS,EAAa,aAAEC,EAAY,gBAAEC,GAAoBwC,KACzD,GAA6B,IAAzB1C,EAAcltD,QAAwC,IAAxBmtD,EAAantD,QAA2C,IAA3BotD,EAAgBptD,OAA/E,CAIA,EAAQ41C,OAER,IAAK,MAAMpmB,KAAS09B,EAAe,CACjC,MAAMztB,EAAO,GAAMjQ,EAAMrgB,IAAMqgB,EAAMngB,OAAQ,EAAG,GAC1C4kC,EAAQ,IAAc,GAAPxU,EACf92B,EAAS,GAAkB,IAAZ,EAAI82B,GACnB3yB,GAAU0iB,EAAMvlB,QAAU,IAAM,GAAkB,GAAZ,EAAIw1B,IAChD,EAAQgd,YAAcxI,EACtB,EAAQsB,UAAY,UACpB,EAAQC,YACR,EAAQC,IAAIjmB,EAAM9nB,EAAIoF,EAAQ0iB,EAAM9lB,EAAGf,EAAQ,EAAa,EAAV0D,KAAKC,IACvD,EAAQopC,MACV,CAEA,IAAK,MAAMuY,KAASd,EAAc,CAChC,MAAM1tB,EAAO,GAAMwuB,EAAM9+C,IAAM8+C,EAAM5+C,OAAQ,EAAG,GAC1C4kC,GAAwB,YAAfga,EAAMtkD,KAAqB,IAAO,KAAQ81B,EACzD,GAAIwU,GAAS,EACX,SAEF,MACMtrC,GAD4B,YAAfslD,EAAMtkD,KAAqB,IAAM,KACvB,EAAW,IAAP81B,GACjC,EAAQgd,YAAcxI,EACtB,EAAQpT,UAA2B,YAAfotB,EAAMtkD,KAAqB,EAAI,EACnD,EAAQkzC,YAA6B,YAAfoR,EAAMtkD,KAAqB,UAAY,UAC7D,EAAQ6rC,YACR,EAAQC,IAAIwY,EAAMtsB,OAAOj6B,EAAGumD,EAAMtsB,OAAOj4B,EAAGf,EAAQ,EAAa,EAAV0D,KAAKC,IAC5D,EAAQywC,QACV,CAEA,IAAK,MAAMkR,KAASb,EAAiB,CACnC,MAAM3tB,EAAO,GAAMwuB,EAAM9+C,IAAM8+C,EAAM5+C,OAAQ,EAAG,GAChD,GAAIowB,GAAQ,EACV,SAEF,IAAIsd,EAAS,UACM,UAAfkR,EAAMtkD,KACRozC,EAAS,UACe,UAAfkR,EAAMtkD,MAAmC,eAAfskD,EAAMtkD,OACzCozC,EAAS,WAEX,MAAMp0C,EAASslD,EAAMtlD,QAAU,EAAiB,KAAZ,EAAI82B,IACxC,EAAQgd,aAA8B,eAAfwR,EAAMtkD,KAAwB,GAAM,KAAQ81B,EACnE,EAAQoB,UAA2B,UAAfotB,EAAMtkD,KAAmB,EAAI,EACjD,EAAQkzC,YAAcE,EACtB,EAAQvH,YACR,EAAQC,IAAIwY,EAAMvmD,EAAGumD,EAAMvkD,EAAGf,EAAQ,EAAa,EAAV0D,KAAKC,IAC9C,EAAQywC,QACV,CAEA,EAAQ5G,SApDR,CAqDF,CAMEqpB,EACF,CCjlCA,SAASC,GAAcl4D,GACrB,MAAO,GAAG8E,KAAKyC,MAAqB,KAAdvH,GAAS,MACjC,CCrBA,SAASm4D,GAAY39D,GACnB,MAAMojB,EAASZ,KAETo7C,GADcx6C,GAAQzP,aAAe,IAChB3T,GACtB49D,IAILlhD,GAASS,WAAY,EACrBT,GAASU,YAAcpd,EACvB0c,GAASW,cAAgBugD,EACzBlhD,GAASY,cAAgB,EACzBZ,GAASc,iBAAkB,EAC3Bd,GAASe,iBAAmB,EAC5Bf,GAASgB,kBAAmB,EAC5BhB,GAASiB,eAAgB,EACzBjB,GAASa,kBAAoB,EAC/B,CC5BA,SAASsgD,GAAgBpV,EAAOrqD,EAAU,CAAC,GACzC,IAAKqqD,EACH,OAAO,KAET,MAAMhvC,EAAOrb,EAAQqb,OAASgvC,IAAU/rC,GAAWA,GAASQ,aAAe,GAAMpF,SAAW,GAAMA,UAC5F3S,EAAS/G,EAAQ+G,QAAWsjD,EAAMtjD,QAAUqU,GAAeC,GAC3D/J,EAAYtR,EAAQsR,WAAc+4C,EAAM7hD,QApBtB,GAqBlBqG,EAAK7O,EAAQ6O,IAAMw7C,EAAMx7C,IAAM,EAC/BsN,EAAWnc,EAAQmc,UAAYkuC,EAAMluC,WAAY,EACvD,MAAO,CACL0mB,IAAKwnB,EACL9iD,EAAG8iD,EAAM9iD,EACTgC,EAAG8gD,EAAM9gD,EACTsF,KACAsN,WACArS,OAAQugD,EAAMvgD,QAAU,EACxB/C,SACAuK,YAEJ,CAEA,SAASouD,GAAmBxT,EAAcxd,EAAUixB,EAAcj4C,GAChE,IAAKi4C,GAAuC,YAAtBjxB,EAASp5B,UAAgD,YAAtBo5B,EAASp5B,SAChE,OAGF,MAAMsqD,EAAYD,EAAap2D,EAAIo2D,EAAa54D,OAGhD,GAFoBmF,KAAK0xC,IAAIgiB,EAAY1T,EAAa3iD,GACN,GAAtB2iD,EAAanlD,OAAqC,IAAtB44D,EAAa54D,OAAgB,GAEjF,OAGF,MAAM84D,EAAe3T,EAAajlD,MAAQilD,EAAajlD,MAAQ,EAAIilD,EAAa1jD,OAC1E06B,EAAKy8B,EAAap4D,EAAI2kD,EAAa3kD,EAEzC,GADgBo4D,EAAaruD,UAAYuuD,EAAe3zD,KAAK0xC,IAAI1a,IAClD,EACb,OAGF,MAAMl3B,EAAYk3B,GAAM,EAAI,GAAK,EAC3B48B,EAAcpxB,EAASod,aAAe,IACtCiU,EAAWJ,EAAa98B,MAAQvkB,GAEhC0hD,GAAkBF,EADE5zD,KAAK0xC,IAAI+hB,EAAa9wD,KAAOkxD,EAAW,GAAM,MACbr4C,EAE3DwkC,EAAar9C,IAAM7C,EAAYg0D,EAC/B,MAAMrnC,EAAW+V,EAAS/V,UAAYuzB,EAAavzB,UAAY,IAC/DuzB,EAAar9C,GAAK,GAAMq9C,EAAar9C,IAAK8pB,EAAUA,GAEpD,MAAMsnC,EAAe/T,EAAa3kD,EAAIyE,GAAa6zD,EAAeF,EAAaruD,UAAY,IAO3F,GALEquD,EAAa98B,IAAIt7B,EADfyE,EAAY,EACOE,KAAK+E,IAAI0uD,EAAa98B,IAAIt7B,EAAG04D,GAE7B/zD,KAAKmC,IAAIsxD,EAAa98B,IAAIt7B,EAAG04D,GAGhDN,EAAa98B,MAAQvkB,GAAU,CACjC,MAAMtN,EAAW,KACjBsN,GAAS/W,EAAI,GAAM+W,GAAS/W,EAAG,GAAIyJ,EAAW,GAChD,CAEAk7C,EAAa/uC,WAAajR,KAAKmC,IAAI69C,EAAa/uC,WAAY,KAC5D+uC,EAAa9vC,MAA8B,YAAtBsyB,EAASp5B,SAAyB,UAAY,QACrE,CA+FA,SAAS4qD,GAAmBhU,EAAcxkC,GACxC,MAAMgnB,EAAWwd,EAAaxd,UAAY,CAAC,EAE3Cwd,EAAa/uC,WAAajR,KAAKmC,IAAI,GAAI69C,EAAa/uC,YAAc,GAAKuK,GACvEwkC,EAAazuB,MAAQvxB,KAAKmC,IAAI,GAAI69C,EAAazuB,OAAS,GAAK/V,GAE7D,MAAM4oB,EAAel1B,GAAekD,GAASQ,aAAe,GAAMpF,UAC5DymD,EAAa7hD,GAAS/U,EAAI+mC,EAC1B8vB,EAAcl0D,KAAK0xC,IAAIuiB,EAAajU,EAAa3iD,GACjD82D,EAAWn0D,KAAK0xC,IAAIt/B,GAAS/W,EAAI2kD,EAAa3kD,GAE9C+4D,EADOF,EAAclU,EAAanlD,OAAwB,IAAfupC,EAAsB,IAAM+vB,GAAYnU,EAAajlD,MAAQilD,EAAajlD,MAA8B,EAAtBilD,EAAa1jD,QAAc,IAC/H,EAAI,EAInC,GAHA0jD,EAAaljD,YAAcs3D,EAAkBpU,EAAaljD,WAAa,GAAc,EAAR0e,EAAW,EAAG,GAC3FwkC,EAAaljD,UAAY,GAAMkjD,EAAaljD,UAAW,EAAG,GAEhC,SAAtB0lC,EAASp5B,SAEX,YA9GJ,SAAoB42C,EAAcxd,EAAUhnB,GAE1C,GADAwkC,EAAa77B,SAAWnkB,KAAKmC,IAAI,GAAI69C,EAAa77B,UAAY,GAAK3I,GAC/DwkC,EAAa77B,SAAW,EAC1B,OAGF,MAAMkwC,EAAgBrU,EAAajlD,MAAQilD,EAAajlD,MAAQ,EAAIilD,EAAa1jD,OAC3Eg4D,EAAkBD,EAAgB,GAClCzqD,EAAS44B,EAAS54B,QAAU,EAC5BC,EAAY24B,EAAS34B,WAAa,GAClCC,EAAS04B,EAAS14B,SAAW,IAC7B+8B,EAAOrE,EAAS12B,cAAgB,GAEtC,IAAIuyC,GAAY,EAEhB,MAAMH,EAAS,GACfA,EAAOhpD,KAAKq+D,GAAgBnhD,GAAU,CAAEhN,UAhGhB,GAgG8CzC,GAAIyP,GAASzP,MACnF,IAAK,MAAMkS,KAAStT,GACdsT,EAAMrE,OAAS,GACjB0tC,EAAOhpD,KAAKq+D,GAAgB1+C,EAAO,CAAEzP,UAjGlB,MAqGvB,IAAK,MAAMmvD,KAAWrW,EAAQ,CAC5B,IAAKqW,EACH,SAEF,MAAMC,EAAOD,EAAQl3D,EAAIk3D,EAAQ15D,OAEjC,GADoBmF,KAAK0xC,IAAI8iB,EAAOxU,EAAa3iD,GACT,GAAtB2iD,EAAanlD,OAAgC,IAAjB05D,EAAQ15D,OACpD,SAEF,MAAMm8B,EAAKu9B,EAAQl5D,EAAI2kD,EAAa3kD,EAEpC,GADiB2E,KAAK0xC,IAAI1a,GACXs9B,EAAkBC,EAAQnvD,UACvC,SAGF,MAAMxH,EAASo5B,GAAM,EAAI,GAAK,EAC9BqnB,GAAY,EACRkW,EAAQ59B,MAAQvkB,IAClBwuB,GACE,CAAE/vB,aAAcjH,EAAQkH,gBAAiBjH,EAAWkH,aAAcjH,EAAQlM,UAC1E,CAAEgM,SAAQC,YAAWC,SAAQlM,WAE/BwU,GAASd,UAAYtR,KAAKmC,IAAIiQ,GAASd,WAAa,EAAGu1B,KAEvDzG,GAAmBm0B,EAAQ59B,IAAK,CAC9B/sB,SACAC,YACAC,OAAQ9J,KAAK0xC,IAAI5nC,GACjBlM,WAEF22D,EAAQ59B,IAAIrlB,UAAYtR,KAAKmC,IAAIoyD,EAAQ59B,IAAIrlB,WAAa,EAAU,GAAPu1B,GAEjE,CAEIwX,IACF2B,EAAa77B,SAAWqe,EAASre,UAAY,IAC7C67B,EAAa/uC,WAAa,IAC1B+uC,EAAa9vC,MAAQ,YACrB8vC,EAAazuB,MAAQiR,EAASre,UAAY,IAE1CiQ,GAAe,CACb/4B,EAAG2kD,EAAa3kD,EAChBgC,EAAG2iD,EAAa3iD,EAA0B,GAAtB2iD,EAAanlD,OACjCy5B,YAA6B,GAAhB+/B,EACb9/B,UAA2B,IAAhB8/B,EACXr2D,MAAOwkC,EAASxjC,WAAa,UAC7B8D,IAAK,IACL0xB,UAAW,IAEbqB,GAAgB,CACdx6B,EAAG2kD,EAAa3kD,EAChBgC,EAAG2iD,EAAa3iD,EAA0B,GAAtB2iD,EAAanlD,OACjCyB,OAAwB,IAAhB+3D,EACR/9B,UAA2B,IAAhB+9B,EACXvxD,IAAK,KAEP8lC,GAAkB,CAChBtrC,KAAM,QACNjC,EAAG2kD,EAAa3kD,EAChBgC,EAAG2iD,EAAa3iD,EAChBf,OAAwB,EAAhB+3D,EACRt2D,UAAW,IACXC,MAAOwkC,EAASxjC,WAAa,UAC7B8D,IAAK,IACL5E,QAAS,GACT8M,MAAO,KAGb,CAkBI,CAAWg1C,EAAcxd,EAAUhnB,GAIrC,MAAMi5C,GAAoBzU,EAAaL,UAAY,IAA4B,YAAtBnd,EAASp5B,SAAyB,GAAK,IA7LlG,IAAsBlO,EAAOw5D,EA8L3B1U,EAAar9C,IA9Lc+xD,EA8LqBD,EAAmBj5C,GA9L/CtgB,EA8LW8kD,EAAar9C,IA7LhC,EACH3C,KAAKmC,IAAI,EAAGjH,EAAQw5D,GAEzBx5D,EAAQ,EACH8E,KAAK+E,IAAI,EAAG7J,EAAQw5D,GAEtB,GAwLH10D,KAAK0xC,IAAIsO,EAAar9C,IAAM,IAC9Bq9C,EAAar9C,GAAK,GAGpBq9C,EAAa3kD,GAAK2kD,EAAar9C,GAAK6Y,EAEpC,MAAMm4C,EAAe3T,EAAajlD,MAAQilD,EAAajlD,MAAQ,EAAIilD,EAAa1jD,OAE1Eq4D,EAAiB,KACvB,IAAIz4D,EAAO8jD,EAAa9jD,MAAQy3D,EAFhB,GAGZx3D,EAAO6jD,EAAa7jD,MAAQw4D,EAAiBhB,EAHjC,GAIhB,GAAIz3D,EAAOC,EAAM,CACf,MAAMy4D,GAAO14D,EAAOC,GAAQ,EAC5BD,EAAO04D,EACPz4D,EAAOy4D,CACT,CACI5U,EAAa3kD,GAAKa,IACpB8jD,EAAa3kD,EAAIa,EACjB8jD,EAAar9C,GAAK3C,KAAKmC,IAAI,EAAG69C,EAAar9C,KAEzCq9C,EAAa3kD,GAAKc,IACpB6jD,EAAa3kD,EAAIc,EACjB6jD,EAAar9C,GAAK3C,KAAK+E,IAAI,EAAGi7C,EAAar9C,KAI7C6wD,GAAmBxT,EAAcxd,EADX+wB,GAAgBnhD,GAAU,CAAEhN,UA5N1B,GA4NwDzC,GAAIyP,GAASzP,KACnC6Y,GAE1D,IAAK,MAAM7F,KAAQ9B,GACZ8B,GAAuB,aAAfA,EAAKzF,OAGlBsjD,GAAmBxT,EAAcxd,EAAU+wB,GAAgB59C,EAAM,CAAEvQ,UAlO/C,KAkO8EoW,EAEtG,CAWA,SAASq5C,GAAkCjvB,GACzC,IAAI/e,GAAM,EACV,IAAK,MAAMm5B,KAAgB/+C,GAAe,CACxC,MAAMuhC,EAAWwd,EAAaxd,UAAY,CAAC,EAC3C,GAA0B,YAAtBA,EAASp5B,UAAgD,YAAtBo5B,EAASp5B,SAC9C,SAEF,GAAIw8B,EAAOC,WAAW5wB,IAAI+qC,EAAa9rD,IACrC,SAEF,MAAMy/D,EAAe3T,EAAa1jD,SAAW0jD,EAAajlD,MAAQilD,EAAajlD,MAAQ,EAAI,IACrFiqC,EAAUgb,EAAa3iD,GAAK2iD,EAAanlD,QAAU84D,GACnD38B,EAAK4O,EAAOvqC,EAAI2kD,EAAa3kD,EAC7B47B,EAAK2O,EAAOvoC,EAAI2nC,EAEtB,GADiBhlC,KAAKs3B,MAAMN,EAAIC,GACjB2O,EAAOtpC,OAASq3D,EAC7B,SAGF/tB,EAAOC,WAAWvhC,IAAI07C,EAAa9rD,IACnC,MAAM4L,EAAYk3B,GAAM,EAAI,GAAK,EAC3B89B,EAAUtyB,EAASqd,YAAcG,EAAaH,YAAc,IAClEG,EAAar9C,IAAM7C,EAAYg1D,EAC/B,MAAMroC,EAAW+V,EAAS/V,UAAYuzB,EAAavzB,UAAY,IAC/DuzB,EAAar9C,GAAK,GAAMq9C,EAAar9C,IAAK8pB,EAAUA,GACpDuzB,EAAa/uC,WAAajR,KAAKmC,IAAI69C,EAAa/uC,WAAY,KAC5D+uC,EAAa9vC,MAA8B,YAAtBsyB,EAASp5B,SAAyB,UAAY,SACnEyd,GAAM,CACR,CACA,OAAOA,CACT,CC/QA,SAASkuC,GAAYzB,GACnBlhD,GAASkB,eAAepe,KAAK,CAC3BhB,GAAIke,GAASa,iBACbH,YAAaV,GAASU,YACtB0pB,UAAW82B,EAAO3rD,OAClB6E,SAAU8mD,EAAO3rD,OACjBrC,QAASguD,EAAO5pD,MAChBC,aAAc2pD,EAAO3pD,aACrBrN,OAAQg3D,EAAOh3D,OACfsN,OAAQ0pD,EAAO1pD,OACfC,UAAWypD,EAAOzpD,UAClBC,OAAQwpD,EAAOxpD,OACfkrD,YAAa5iD,GAASxU,OACtBioC,WAAY,IAAIxiC,IAChBhI,EAAG,EACHgC,EAAG,GAEP,CAoDA,SAAS43D,KACP,MAAMn8C,EAASZ,KACf,IAAKY,IAAWA,EAAO1P,UAAU4+B,WAAW,UAC1C,OAAO,EAGT,IhEXF,SAAqB/wB,GACnB,MAAMO,EAAQR,GAAgBC,GAC9B,QAAKO,GAGDA,EAAMF,WAAa/U,OAAOgV,oBAG1BC,EAAM9D,WAGN8D,EAAM9M,UAAY,IAGtB8M,EAAM9M,UAAY,EACX,IACT,CgELOwqD,CAAYp8C,EAAO5kB,IASpB,OARE0jB,GAAYkB,EAAO5kB,MACrBke,GAASS,WAAY,EACrBT,GAASW,cAAgB,KACzBX,GAASU,aAAe,EACF,oBAAXxa,QACTA,OAAO0L,cAAc,IAAIC,YAAY,sBAAuB,CAAEC,OAAQ,CAAE+S,SAAU6B,EAAO5kB,SAGpF,EAGX,MAAMihE,EAAmBr8C,EAAOzO,YAAc,CAAC,EACzCC,EAAQ6qD,EAAiB7qD,OAAS,IAElCoH,EAAMU,GAASV,KAAO,KACtBk1C,EAAUrkD,OAAOC,SAASkP,GAAK/C,SAAW+C,EAAI/C,QAAWyD,GAASxU,QAAU,EAC5EipD,EAAUtkD,OAAOC,SAASkP,GAAK9C,SAAW8C,EAAI9C,QAAU,EACxDwmD,EAAap1D,KAAKs3B,MAAMsvB,EAASC,IAAY,EAC7CjP,EAAOgP,EAAUwO,EACjBvd,EAAOgP,EAAUuO,EAEjBtmD,EAAUvM,OAAOC,SAASkP,GAAK5C,SAAW4C,EAAI5C,QAAUsD,GAAS/W,EACjE0T,EAAUxM,OAAOC,SAASkP,GAAK3C,SAAW2C,EAAI3C,QAAUqD,GAAS/U,EAAI,GAErEg4D,EAAiBF,EAAiBE,gBAAkB,GACpDC,EAAaH,EAAiBI,kBAAoB,EAMlDzL,EAAUh7C,EAAU8oC,EAAOyd,GAHlBxd,EAG2Cyd,EACpDvX,EAAUhvC,EAAU8oC,EAAOwd,EAHnBzd,EAG4C0d,GANnCH,EAAiBK,sBAAwB,GAU1DvL,EAFYjqD,KAAK6yC,MAAMgF,EAAMD,GhESrC,SAAsB3gC,GACpB,MAAMO,EAAQR,GAAgBC,GACxBC,EAAMM,GAAOJ,UACnB,IAAKI,IAAUN,EACb,OAAO,EAGJM,EAAMrN,SACTqN,EAAMrN,OAAS,CAAEsN,QAASP,EAAI/iB,MAAQ,IAExC,MAAMshE,EAAcj+C,EAAMrN,OACpBhW,EAAO+iB,EAAI/iB,MAAQ,EACnBsjB,EAAUzX,KAAKmC,IAAIhO,EAAMshE,EAAYh+C,SAAWtjB,GAChDgO,EAAM+U,EAAI/U,KAAOsV,EACjBi+C,EAAmB11D,KAAK+E,IAAI5C,EAAKsV,GACjCk+C,EAAUD,GAAoB11D,KAAKC,GAAK,KACxCwO,EAAQknD,EAAU,GAAqB,EAAhB31D,KAAK4C,SAAe,GAAK+yD,EAAU,EAE1DvrD,EAAU8M,EAAI9M,SAAW,EAG/B,OAFAqrD,EAAYh+C,QAAUzX,KAAK+E,IAAI5C,EAAKuzD,EAAmBtrD,GAEhDqE,CACT,CgE9BsBmnD,CAAa98C,EAAO5kB,IAElCyO,EAAK3C,KAAKuO,IAAI07C,GAAc3/C,GAAS6qD,EAAiBU,WAAa,GACnEhzD,EAAK7C,KAAKwO,IAAIy7C,GAAc3/C,GAAS6qD,EAAiBW,WAAa,GAEnEl4D,EAAS+E,GAAM,EAAI,GAAK,ERnHhC,IAAqBozD,EQ4JnB,OAvCIj9C,EAAOjO,SRrHQkrD,EQsHLj9C,EAAOjO,ORrHrB24C,GAAYC,gBAAkBsS,GAAMjrD,YAAc,EAClD04C,GAAYE,cAAgBqS,GAAMhrD,UAAY,EAC9Cy4C,GAAYx4C,MAAQ+qD,GAAM/qD,OAASw4C,GAAYx4C,MAC/Cw4C,GAAYG,aAAe3yB,KQmHH,oBAAX14B,QACTA,OAAO0L,cAAc,IAAIC,YAAY,qBAAsB,CAAEC,OAAQ,CAAE+S,SAAU6B,EAAO5kB,GAAI2W,OAAQiO,EAAOjO,YAIzF,oBAAXvS,QACTA,OAAO0L,cACL,IAAIC,YAAY,sBAAuB,CACrCC,OAAQ,CACN+S,SAAU6B,EAAO5kB,GACjBmH,EAAGyuD,EACHzsD,EAAG0gD,EACHngD,SACAkC,UAAW,CAAEzE,EAAGu8C,EAAMv6C,EAAGw6C,OAMjCtgB,GAAgB,CACdl8B,EAAGyuD,EACHzsD,EAAG0gD,EACHp7C,KACAE,KACAvG,OAAQ64D,EAAiB74D,QAAU,EACnCiO,SAAU4qD,EAAiB5qD,UAAY,GACvCvM,MAAOm3D,EAAiBn3D,OAAS,UACjC4L,OAAQurD,EAAiBvrD,QAAU,GACnCC,UAAWsrD,EAAiBtrD,WAAa,GACzCjM,SACA4M,cAAe2qD,EAAiB3qD,eAAiB,KAG7B,oBAAXlS,QACTA,OAAO0L,cAAc,IAAIC,YAAY,oBAAqB,CAAEC,OAAQ,CAAE+S,SAAU6B,EAAO5kB,QAGlF,CACT,CC9JA,MAWM8hE,GAAwB,IAAIliD,IAClC,IAAImiD,GAAa,EACbC,GAAa,EACbC,GAAgB,EAEpB,MAAM,GAAiBjnD,GAAe,GAAM1B,UACtC7P,GAAQ/C,EAAW,GAEzB,SAASw7D,GAA2B1gE,GAClC,MAAMxB,EAAK,QAAQwB,KAASsK,KAAK4C,SAAStM,SAAS,IAAI0Z,MAAM,EAAG,KAC1D1T,EAjBO,IACE,IAgB4B0D,KAAK4C,SAC1C6L,EAAQzO,KAAK4C,SAAW5C,KAAKC,GAAK,EAClCqK,EAhBI,GAgB6BtK,KAAK4C,UAflC,IADA,IAiBJyzD,EAAU,GAAqB,IAAhBr2D,KAAK4C,SAC1B,MAAO,CACL1O,KACAmM,KAAM,SAAS3K,EAAQ,IACvB+Y,QACAnS,SACAgO,QACA+rD,UACAC,cAAeD,EACfE,aAAc,EAAoB,EAAhBv2D,KAAK4C,SACvBvH,EAAG+W,GAAS/W,EAAI2E,KAAKuO,IAAIE,GAASnS,EAClCe,EAAGM,GACHiyC,OAAQ5vC,KAAK4C,SAAW5C,KAAKC,GAAK,EAEtC,CAoBA,SAASu2D,GAAkBC,EAAaj7C,EAAOzgB,GAC7C07D,EAAYhoD,OAASgoD,EAAYhoD,MAAQgoD,EAAYnsD,MAAQkR,IAAoB,EAAVxb,KAAKC,IAC5E,MAAMy2D,EAAStkD,GAAS/W,EAAI2E,KAAKuO,IAAIkoD,EAAYhoD,OAASgoD,EAAYn6D,OAGhEH,EAAO6D,KAAKmC,IAFE,IAEepH,EAFf,KAGpB07D,EAAYp7D,EAAI2E,KAAK+E,IAAI5I,EAAM6D,KAAKmC,IAHhB,IAG0Bu0D,IAC9C,MAAMrN,EA3DK,GA2DOrpD,KAAKwO,IAAwB,EAApBioD,EAAYhoD,MAAYgoD,EAAY7mB,QAC/D6mB,EAAYp5D,EAAIM,GAAQ0rD,EAExBoN,EAAYF,cAAgB/6C,EACxBi7C,EAAYF,cAAgB,IAC9BE,EAAYH,cAAgB,GAAqB,IAAhBt2D,KAAK4C,SACtC6zD,EAAYF,aAAe,IAAsB,IAAhBv2D,KAAK4C,UAExC,MAAM+zD,EAAeF,EAAYH,cAAgBG,EAAYJ,QAC7DI,EAAYJ,SAAWM,EAAe32D,KAAK+E,IAAI,EAAW,GAARyW,GAElD,MAAM5d,EAAS64D,EAAYp7D,GAAK+W,GAAS/W,EAAI,GAAK,EAUlD,OATA0Y,GAAmB,CACjB7f,GAAIuiE,EAAYviE,GAChBmM,KAAMo2D,EAAYp2D,KAClBhF,EAAGo7D,EAAYp7D,EACfgC,EAAGo5D,EAAYp5D,EACfO,SACAsW,UAAW,YAEbiiD,IAAiB,EACVM,EAAYJ,OACrB,CAEA,SAASO,KACP,IAAK,MAAM1iE,KAAM8hE,GAAsB7yD,OACrC,GAAcqB,OAAOtQ,GAEvB8hE,GAAsBh+C,OACxB,CAqBA,SAAS6+C,GAAkBr7C,GACzB,GAAIjW,GAAM6B,mBAAoB,CAC5B7B,GAAM6B,oBAAqB,EAC3B,MAAM0vD,EAAMzX,KACRyX,GAAKnvD,OAZb,SAA+B6qB,EAAU,adnGzC,SAAwBA,EAAU,YAChCssB,GAAUn3C,QAAS,EACnBm3C,GAAUC,UAAY,EACtBD,GAAUI,iBAAmB,EAC7BJ,GAAUK,eAAiB,EAC3BL,GAAUltB,YAAcY,GAAW,UACrC,Cc8FEukC,CAAevkC,GACfokC,KACAX,GAAa,EACbC,GAAa,EACbC,GAAgB,CAClB,CAOMa,CAAsB,YdtH5B,SAAsB/X,EAAkBH,GAAUG,iBAChDH,GAAUn3C,QAAS,EACnBm3C,GAAUltB,YAAc,SACxBktB,GAAUG,gBAAkBj/C,KAAKmC,IAAI,EAAGnC,KAAKoC,MAAM68C,GAAmBH,GAAUG,iBAClF,Cc2FEgY,CAhGiB,KdkCM,iBADDzkC,EcgEP,Wd/DoBA,EAAQ5S,SACzCk/B,GAAUltB,YAAcY,EAAQ5S,Qc+DlCq2C,GAAa,EACbC,GAAa,EACbC,GAAgB,EAChBS,KACA17B,KACA4E,GAA0B,QAoB1B,CA5BF,Id9DwBtN,Ec4FtB,MAAMskC,EAAMzX,KACZ,IAAKyX,GAAKnvD,OACR,QAxFJ,SAAqC6T,GAEnC,GAAIw6C,GAAsBkB,MAzCT,IA0Cf,OAGF,GADAjB,IAAcz6C,EACVy6C,GA5CW,IA6Cb,OAEFA,GAAa,EACb,MAAMkB,EAAQn3D,KAAK+E,IA/CH,GAFC,IAiDsDixD,GAAsBkB,MAC7F,IAAK,IAAIxjE,EAAI,EAAGA,EAAIyjE,EAAOzjE,GAAK,EAAG,CACjC,MACM+iE,EAAcL,GADNJ,GAAsBkB,MAEpClB,GAAsB/hD,IAAIwiD,EAAYviE,GAAIuiE,EAC5C,CACF,CA2EEW,CAA4B57C,GAE5B,MAAM1W,EAAW,KACjB,IAAIuyD,EAAa,EACbC,EAAe,EACnB,IAAK,MAAMb,KAAeT,GAAsB3hD,SAC9CgjD,GAAcb,GAAkBC,EAAaj7C,EAAO1W,GACpDwyD,GAAgB,Gd1HpB,SAA6BljE,EAAO6qD,EAAkBH,GAAUG,iBAC9D,MAAM/jD,EAAQ8E,KAAKmC,IAAI,EAAGnC,KAAKoC,MAAMhO,GAAS,IAC9C0qD,GAAUC,UAAY7jD,EACtB4jD,GAAUE,cAAgBh/C,KAAKmC,IAAI28C,GAAUE,cAAe9jD,GAC7B,iBAApB+jD,GAAgC18C,OAAOC,SAASy8C,KACzDH,GAAUG,gBAAkBj/C,KAAKmC,IAAIjH,EAAO8E,KAAKoC,MAAM68C,IAE3D,EcsHEsY,CAAoBvB,GAAsBkB,KAAO,EA5IhC,KA8IjBhB,IAAc16C,EACV06C,IAAc,KdvHpB,UAAwB,iBAAEhX,EAAgB,eAAEC,GAAmB,CAAC,GAC9B,iBAArBD,GAAiC38C,OAAOC,SAAS08C,KAC1DJ,GAAUI,iBAAmBl/C,KAAKmC,IAAI,EAAG+8C,IAEb,iBAAnBC,GAA+B58C,OAAOC,SAAS28C,KACxDL,GAAUK,eAAiBn/C,KAAKmC,IAAI,EAAGg9C,GAE3C,CcmHIqY,CAAe,CAAEtY,iBAFQiX,GAAgBD,GAEN/W,eADZmY,EAAe,EAAID,EAAaC,EAAe,IAEtEnB,GAAgB,EAChBD,GAAa,EAEjB,CCzJA,SAASuB,GAAc5iD,EAAO2G,GAmB5B,GAlBA3G,EAAMzD,gBAAkBpR,KAAKmC,IAAI,EAAG0S,EAAMzD,gBAAkBoK,GAC5D3G,EAAMnE,eAAiB1Q,KAAKmC,IAAI,EAAG0S,EAAMnE,eAAiB8K,GAC1D3G,EAAMvD,UAAYtR,KAAKmC,IAAI,GAAI0S,EAAMvD,WAAa,GAAKkK,GACvD3G,EAAMtD,eAAiBvR,KAAKmC,IAAI,GAAI0S,EAAMtD,gBAAkB,GAAKiK,GAC7D3G,EAAMtD,gBAAkB,IAC1BsD,EAAMrD,kBAAoB,GAGxBqD,EAAM5D,WAAa,IACrB4D,EAAM5D,WAAajR,KAAKmC,IAAI,EAAG0S,EAAM5D,WAAauK,IAGhD3G,EAAM3D,WAAa,IACrB2D,EAAM3D,WAAalR,KAAKmC,IAAI,EAAG0S,EAAM3D,WAAasK,IAGpD3G,EAAM1D,eAAiBnR,KAAKmC,IAAI,EAAG0S,EAAM1D,eAAyB,GAARqK,GAEtD3G,EAAMrE,QAAU,EAgBlB,OAfAqE,EAAMxD,aAAerR,KAAKmC,IAAI,EAAG0S,EAAMxD,aAAemK,QAC3B,IAAvB3G,EAAMxD,eACRwD,EAAMrE,OAASqE,EAAMpE,UACrBoE,EAAMxZ,EAAIwZ,EAAMxF,OAChBwF,EAAMxX,EAAIwX,EAAMpF,OAChBoF,EAAMlS,GAAK,EACXkS,EAAMhS,GAAK,EACXgS,EAAM3E,MAAQ,SACd2E,EAAM1E,WAAa,EAAInQ,KAAK4C,SAC5BiS,EAAMnE,eAAiB,GACvBmE,EAAM5E,UAAW,EACjB4E,EAAMvD,UAAY,EAClBuD,EAAMtD,eAAiB,EACvBsD,EAAMrD,kBAAoB,IAK9B,MACMkmD,EADUtlD,GAAS/W,EACGwZ,EAAMxZ,EAC5Bs8D,EAAc33D,KAAK0xC,IAAIgmB,GAC7B7iD,EAAMjX,OAAS85D,GAAa,EAAI,GAAK,EAErC,MAAME,EAAU/iD,EAAMvD,UAAY,EAC5B+5B,EAAiBx2B,EAAMtD,eAAiB,EAAIvR,KAAKmC,IAAI,GAAKnC,KAAK+E,IAAI,EAAG8P,EAAMrD,mBAAqB,IAAM,EACvGjB,EAAYsE,EAAMtE,UAAY86B,EAC9BwsB,EAAsBhjD,EAAMxE,iBAAmBwE,EAAMtD,eAAiB,EAAI,IAAO,GAEjFumD,GAAeF,GAAWD,EAAcE,EAE9C,GAAIF,EAH4C,IAAtBE,EAMxB,OAFAhjD,EAAMlS,GAAK,OACXkS,EAAM3E,MAAQ,QAgBhB,GAZI0nD,GACF/iD,EAAM3E,MAAQ,UACd2E,EAAMlS,GAAK,EACXkS,EAAMlE,aAAe,EACrBkE,EAAMjE,aAAe,EACrBiE,EAAM1E,WAAanQ,KAAKmC,IAAI0S,EAAM1E,WAAY0E,EAAMvD,WACpDuD,EAAMnE,eAAiB1Q,KAAKmC,IAAI0S,EAAMnE,eAAgBmE,EAAMvD,UAAY,KAC/C,YAAhBuD,EAAM3E,QACf2E,EAAM3E,MAAQ,OACd2E,EAAM1E,WAAa,KAGhBynD,EACL,OAAQ/iD,EAAM3E,OACZ,IAAK,OACH2E,EAAMlS,GAAK,EACXkS,EAAM1E,YAAcqL,EAChB3G,EAAM1E,YAAc,IACtB0E,EAAM3E,MAAQ,SACd2E,EAAM1E,WAAa,IAAMnQ,KAAK4C,SAC9BiS,EAAMjX,OAASoC,KAAK4C,SAAW,IAAO,EAAI,GAExCk1D,IACFjjD,EAAM3E,MAAQ,SAEhB,MACF,IAAK,SACH2E,EAAMlS,GAAK4N,EAAYsE,EAAMjX,OACzBiX,EAAMxZ,GAAKwZ,EAAMzE,YAAYrL,IAC/B8P,EAAMjX,OAAS,EACNiX,EAAMxZ,GAAKwZ,EAAMzE,YAAYjO,MACtC0S,EAAMjX,QAAU,GAElBiX,EAAM1E,YAAcqL,EAChB3G,EAAM1E,YAAc,IACtB0E,EAAM3E,MAAQ,OACd2E,EAAM1E,WAAa,EAAInQ,KAAK4C,SAC5BiS,EAAMlS,GAAK,GAETm1D,IACFjjD,EAAM3E,MAAQ,SAEhB,MACF,IAAK,QACH,IAAK4nD,EAAa,CAChBjjD,EAAM3E,MAAQ,SACd,KACF,CACA,MAAM6nD,EAAWL,GAAa,EAAI,GAAK,EACvC7iD,EAAMlS,GAAK4N,EAAYwnD,EACnBJ,GAAe9iD,EAAMvE,aAAeuE,EAAMnE,gBAAkB,IAC9DmE,EAAM3E,MAAQ,gBACd2E,EAAMlE,aAAe,IACrBkE,EAAMjE,aAAe,IACrBiE,EAAMlS,GAAK,GAEb,MACF,IAAK,gBACHkS,EAAMlS,GAAK,EACXkS,EAAMlE,cAAgB6K,EAClB3G,EAAMlE,cAAgB,IACxBkE,EAAM3E,MAAQ,gBACd2E,EAAMjE,aAAe,KAEvB,MACF,IAAK,gBACHiE,EAAMlS,GAAiB,IAAZ4N,EAAmBsE,EAAMjX,OACpCiX,EAAMjE,cAAgB4K,EAClB3G,EAAMjE,cAAgB,IACxBiE,EAAM3E,MAAQ,UACd2E,EAAM1E,WAAa,GACnB0E,EAAMnE,eAAiB,KAEzB,MACF,IAAK,UACHmE,EAAMlS,GAAK,EACXkS,EAAM1E,YAAcqL,EAChB3G,EAAM1E,YAAc,IACtB0E,EAAM3E,MAAQ4nD,EAAc,QAAU,OACtCjjD,EAAM1E,WAAa,GAAsB,GAAhBnQ,KAAK4C,UAEhC,MACF,QACEiS,EAAMlS,GAAK,EAKf,MAAMkhD,EAAYhvC,EAAMxX,EACxBwX,EAAMhS,IAAM0K,GAAUiO,EACtB3G,EAAMxZ,GAAKwZ,EAAMlS,GAAK6Y,EACtB3G,EAAMxX,GAAKwX,EAAMhS,GAAK2Y,EACtB3G,EAAM5E,UAAW,GAEF2zC,GAAuB/uC,EAAOgvC,EAAWhvC,EAAMha,SAC/Cga,EAAMxX,EAAIwX,EAAMha,QAAUD,IACvCia,EAAMxX,EAAIzC,EAAWia,EAAMha,OAC3Bga,EAAMhS,GAAK,EACXgS,EAAM5E,UAAW,GAGnB,MAAMnL,EAAW,KACjB+P,EAAMxZ,EAAI2E,KAAKmC,IAAI,GAAInC,KAAK+E,IAAID,EAAW,GAAI+P,EAAMxZ,GACvD,CAEA,SAAS28D,GAAmBnjD,GAC1B,GAAIA,EAAMrE,QAAU,EAClB,OAEF,GAAoB,kBAAhBqE,EAAM3E,MACR,OAGF,MAAM+nD,EAAcpjD,EAAMvE,YAAcuE,EAAMvY,OACxC06B,EAAK5kB,GAAS/W,EAAIwZ,EAAMxZ,EACxB47B,EAAK7kB,GAAS/U,EAAIwX,EAAMxX,EACX25B,EAAKA,EAAKC,EAAKA,GAChBghC,EAAcA,GAC9Br3B,GAAoB/rB,EAExB,CC1JA,IAAIqjD,GAA0B,EAC1BC,GAA0B,EAC1BC,GAAyB,GACzBC,GAAyB,GACzBC,GAA8B,KAC9BC,GAA8B,KAC9BC,GAA8B,KAGlC,SAASC,KACP,MvDtCe,gDuDsC6BzK,QAAQ,MAAO,GAC7D,CAMA,SAAS0K,KACP,MAAsB,oBAAXC,QAA0BA,OAAOC,WACnCD,OAAOC,aAET,WAAW54D,KAAK4C,SAAStM,SAAS,IAAI0Z,MAAM,EAAG,KACxD,CAEA,SAAS6oD,GAAe94C,GACtB,MAAmB,iBAARA,EACF,GAEFA,EAAIH,MACb,CAEAk5C,eAAeC,GAAgBt7D,GAC7B,IAAKA,GAA6B,oBAAdu7D,YAA8BA,UAAUC,WAAWC,UACrE,OAAO,EAET,IAEE,aADMF,UAAUC,UAAUC,UAAUz7D,IAC7B,CACT,CAAE,MAAOqG,GAEP,OADAC,QAAQsW,KAAK,yBAA0BvW,IAChC,CACT,CACF,CAgBA,SAASq1D,GAAuBtlE,GAC9B,OAAK+H,MAAMC,QAAQhI,GAGZA,EACJ2C,IAAK6iB,GAnBV,SAA4BA,GAC1B,GAAyB,iBAAdA,EACT,OAAOw/C,GAAex/C,GAExB,GAAIA,GAAkC,iBAAdA,EACtB,IACE,OAAOw/C,GAAethE,KAAKC,UAAU6hB,GACvC,CAAE,MACA,MAAO,EACT,CAEF,MAAO,EACT,CAOwB+/C,CAAmB//C,IACtCzE,OAAQyE,GAAcA,EAAU1lB,OAAS,GAJnC,EAKX,CAEA,SAAS0lE,GAAY1/D,EAAI,GAAIqf,EAAI,IAC/B,GAAIrf,EAAEhG,SAAWqlB,EAAErlB,OACjB,OAAO,EAET,IAAK,IAAI+B,EAAQ,EAAGA,EAAQiE,EAAEhG,OAAQ+B,GAAS,EAC7C,GAAIiE,EAAEjE,KAAWsjB,EAAEtjB,GACjB,OAAO,EAGX,OAAO,CACT,CAEA,SAAS4jE,GAAe9uC,GACtB,IAAKA,GAA4B,iBAAXA,EACpB,OAAO,KAET,MAAM+uC,EAAW/uC,EAAO+uC,UAAY,CAAC,EACrC,MAAO,CACLrlE,GAAIs2B,EAAOt2B,GACXmM,KAAMmqB,EAAOnqB,MAAQmqB,EAAOt2B,GAC5BsC,IAAKg0B,EAAOh0B,KAAO+iE,EAAS/iE,KAAO,UACnCgjE,QAASD,EAAS7vC,aAAec,EAAOd,aAAec,EAAOgvC,SAAW,EACzEC,WAAYjvC,EAAOivC,YAAcF,EAASE,YAAc,EACxDC,OAAQlvC,EAAOkvC,QAAUH,EAASG,QAAU,KAC5CC,KAAMnvC,EAAOmvC,MAAQJ,EAASI,MAAQ,GACtC/6C,WAAY26C,EAAS36C,YAAc,KACnC+K,YAAa4vC,EAAS5vC,aAAe,KACrCiwC,UAAWpvC,EAAOovC,WAAa,KAC/BC,OAAQ,CACNC,UAAWtvC,EAAOqvC,QAAQC,WAAa,KACvCC,eAAgBn+D,MAAMC,QAAQ2uB,EAAOqvC,QAAQE,gBAAkBvvC,EAAOqvC,OAAOE,eAAe/pD,QAAU,GACtGgqD,WAAYxvC,EAAOqvC,QAAQG,YAAc,KACzCC,eAAgBr+D,MAAMC,QAAQ2uB,EAAOqvC,QAAQI,gBAAkBzvC,EAAOqvC,OAAOI,eAAejqD,QAAU,IAG5G,CAEA,SAASkqD,GAAoB1vC,GAC3B,MAAM2vC,EAASb,GAAe9uC,GAC9B,IAAK2vC,EACH,OAEF,MAAMjqD,EAAQia,KACRz0B,EAAQwa,EAAM4Y,QAAQpP,UAAWlC,GAAUA,EAAMtjB,KAAOimE,EAAOjmE,IACjEwB,GAAS,EACXwa,EAAM4Y,QAAQpzB,GAASykE,EAEvBjqD,EAAM4Y,QAAQ5zB,KAAKilE,EAEvB,CAEA,SAASC,KACPhC,GAAyB,GACzBC,GAAyB,GACzBH,GAA0B,EAC1BC,GAA0B,EACtBG,KACF+B,aAAa/B,IACbA,GAA8B,MAE5BC,KACF8B,aAAa9B,IACbA,GAA8B,MAEhCC,GAA8B,IAChC,CAqBA,SAAS8B,KACP,MAAMpqD,EAAQia,KACTja,EAAMiZ,SAAYjZ,EAAMkZ,mBAG7B8uC,GAA0BvvD,KAAKD,MAC/B6xD,KAAmBhzC,MAAOzjB,GAAUC,QAAQsW,KAAK,0CAA2CvW,IAC9F,CAwBA,SAAS02D,GAAwB9uC,GAC/B,MAAMxb,EAAQia,KACTja,EAAM4a,iBAAoBlvB,MAAMC,QAAQ6vB,IAAqC,IAAtBA,EAAW/3B,SAGvEwkE,GAA0BxvD,KAAKD,MAwZjCowD,eAAgC2B,EAAWtgD,EAAU,CAAC,GACpD,MAAMugD,EAAUjC,KAChB,GAAKiC,GAAYD,GAGZtgD,GAA2C,IAAhCpgB,OAAOoJ,KAAKgX,GAASxmB,OAGrC,IACE,MAAMgnE,QAAiBC,MAAM,GAAGF,cAAoBD,SAAkB,CACpEI,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElB/4C,KAAMxqB,KAAKC,UAAU2iB,KAEvB,IAAKwgD,EAASI,GACZ,MAAM,IAAIniE,MAAM,QAAQ+hE,EAAShyC,UAEnC,MAAMl1B,QAAeknE,EAASK,OAC1BvnE,GAAQwnE,UACVf,GAAoBzmE,EAAOwnE,SACvBr/D,MAAMC,QAAQpI,EAAOwnE,QAAQpB,QAAQE,iBAAmBtmE,EAAOwnE,QAAQpB,OAAOE,eAAepmE,OAAS,GACxGunE,GAAsBznE,EAAOwnE,QAAQpB,OAAOE,gBAGlD,CAAE,MAAOj2D,GACPC,QAAQsW,KAAK,4CAA4CogD,IAAa32D,EACxE,CACF,CApbEq3D,CAAiBjrD,EAAM4a,gBAAiB,CAAEswC,iBAAkB1vC,IAAcnE,MAAOzjB,IAC/EC,QAAQsW,KAAK,sDAAuDvW,KAExE,CAEA,SAASu3D,GAA2B3vC,GAClC,MAAMxb,EAAQia,KACTja,EAAMiZ,UACTivC,GAAyB,IAEtBloD,EAAM4a,kBACTutC,GAAyB,IAEtBz8D,MAAMC,QAAQ6vB,IAAqC,IAAtBA,EAAW/3B,QAOzCuc,EAAMiZ,SAAWjZ,EAAMkZ,mBAAqBiwC,GAAYjB,GAAwB1sC,KAClF0sC,GAAyB1sC,EAAW1b,QA7ExC,WACE,MAAME,EAAQia,KACd,IAAKja,EAAMiZ,UAAYjZ,EAAMkZ,iBAC3B,OAEF,MAAM1gB,EAAMC,KAAKD,MACX80B,EAAQx9B,KAAKmC,IAAI,EA9Ic,KA8IuBuG,EAAMwvD,KAC9D16B,EAAQ,EACL86B,KACHA,GAA8BgD,WAAW,KACvChD,GAA8B,KAC9BgC,MACC98B,IAIP88B,IACF,CA6DIiB,IAEErrD,EAAM4a,kBAAoBuuC,GAAYhB,GAAwB3sC,KAChE2sC,GAAyB3sC,EAAW1b,QArDxC,SAAqC0b,GAEnC,IADcvB,KACHW,kBAAoBlvB,MAAMC,QAAQ6vB,IAAqC,IAAtBA,EAAW/3B,OACrE,OAEF,MAAM+U,EAAMC,KAAKD,MACX80B,EAAQx9B,KAAKmC,IAAI,EA1Kc,KA0KuBuG,EAAMyvD,KAClE,GAAI36B,EAAQ,EAUV,OATAg7B,GAA8B9sC,EAAW1b,aACpCuoD,KACHA,GAA8B+C,WAAW,KACvC,MAAMnhD,EAAUq+C,GAChBD,GAA8B,KAC9BC,GAA8B,KAC9BgC,GAAwBrgD,IACvBqjB,KAIPg9B,GAAwB9uC,EAC1B,CAkCI8vC,CAA4B9vC,EAAW1b,WAZlCE,EAAMiZ,SAAYjZ,EAAM4a,kBAC3BsvC,KACAvvC,GAAmB,MAYzB,CAsBA,SAAS4wC,KACP,MAAMvrD,EAAQia,KACd,IAAIP,EACJ,IACEA,EAAMpC,IACR,CAAE,MAKA,OAJKtX,EAAM0Z,KAAK3B,iBAAmB,IAAIt0B,OAAS,IAC9C83B,GAAsB,IACtB4vC,GAA2B,KAEtB,EACT,CACA,IAAKzxC,GAAK8xC,mBAKR,OAJKxrD,EAAM0Z,KAAK3B,iBAAmB,IAAIt0B,OAAS,IAC9C83B,GAAsB,IACtB4vC,GAA2B,KAEtB,GAET,MAAMM,EAAW//D,MAAMC,QAAQqU,EAAM0Z,KAAK3B,iBAAmB/X,EAAM0Z,IAAI3B,gBAAgBjY,QAAU,GAC3FuO,EAAa46C,GAAuBvvC,EAAI8xC,sBAAwB,IAKtE,OAJKrC,GAAYsC,EAAUp9C,KACzBkN,GAAsBlN,GACtB88C,GAA2B98C,IAEtBA,CACT,CA6BAu6C,eAAe8C,IAAoB,OAAEC,GAAS,GAAU,CAAC,GACvD,IACE/vC,GAAc,CAAEJ,YAAY,IAC5B,MAAMA,EAAa+vC,KACnB,GAA0B,IAAtB/vC,EAAW/3B,OAIb,OAHKkoE,GACHnxC,GAAiB,uEAEZ,CAAEoxC,QAAQ,EAAO1nE,MAAO,GAEjC,MAAM+lB,EAAUuR,EAAW/0B,KAAK,MAC1BmlE,QAAe/C,GAAgB5+C,GAQrC,OAPK0hD,GAEDnxC,GADEoxC,EACe,UAAUpwC,EAAW/3B,uBAA6C,IAAtB+3B,EAAW/3B,OAAe,GAAK,OAE3E,mEAGd,CAAEmoE,SAAQ1nE,MAAOs3B,EAAW/3B,OAAQwmB,UAC7C,CAAE,MAAOrW,GAGP,MADA+nB,GADgB/nB,GAAO+W,SAAW,iCAE5B/W,CACR,CAAE,QACAgoB,GAAc,CAAEJ,YAAY,GAC9B,CACF,CAeAotC,eAAeiD,KACb,GAAsB,oBAAXzjE,QAAmD,mBAAlBA,OAAO0jE,OACjD,MAAM,IAAIpjE,MAAM,2CAElB,MAAMsX,EAAQia,KACRnW,GAAY9D,EAAM0Z,IAAIM,kBAAoB,IAAIvzB,KAAK,MACnD4O,EAAQjN,OAAO0jE,OAAO,gEAAiEhoD,GAC7F,GAAa,MAATzO,EAEF,OADAmlB,GAAiB,8BACV,KAET,MAAMgB,EA/ER,SAA6BuwC,GAC3B,MAAMC,EAAYrD,GAAeoD,GACjC,IAAKC,EACH,MAAO,GAET,IACE,MAAMj8C,EAAS1oB,KAAK2nB,MAAMg9C,GAC1B,GAAItgE,MAAMC,QAAQokB,GAChB,OAAOk5C,GAAuBl5C,GAEhC,GAAIA,GAA4B,iBAAXA,EACnB,OAAOk5C,GAAuB,CAACl5C,IAEjC,GAAsB,iBAAXA,EACT,OAAOk5C,GAAuB,CAACl5C,GAEnC,CAAE,MAEF,CAKA,OAAOk5C,GAJU+C,EACdh0B,MAAM,UACN1xC,IAAK2lE,GAAYA,EAAQv8C,QACzBhL,OAAQunD,GAAYA,EAAQxoE,OAAS,GAE1C,CAuDqByoE,CAAoB72D,GACvC,GAA0B,IAAtBmmB,EAAW/3B,OAEb,MADA+2B,GAAiB,qCACX,IAAI9xB,MAAM,8BAElB,MAAMgxB,EAAMyyC,KACZxwC,GAAY,MACZC,GAAc,CAAEJ,YAAY,IAC5B,IACE,IAAK,MAAMrS,KAAaqS,QAChB9B,EAAI0yC,mBAAmBjjD,GAE/B,MAAMkjD,EApCV,SAAyBvoD,EAAUwoD,GACjC,MAAMD,EAAS,IAAIvoD,KAAawoD,GAC1B5iD,EAAO,IAAIvW,IACXqT,EAAS,GACf,IAAK,MAAM2C,KAAakjD,EACjB3iD,EAAK3E,IAAIoE,KACZO,EAAKtV,IAAI+U,GACT3C,EAAOxhB,KAAKmkB,IAGhB,OAAO3C,CACT,CAyBmB+lD,CAAgBvsD,EAAM0Z,IAAIM,kBAAoB,GAAIwB,GAGjE,OAFAE,GAAuB2wC,GACvB7xC,GAAiB,WAAWgB,EAAW/3B,uBAA6C,IAAtB+3B,EAAW/3B,OAAe,GAAK,QACtF+3B,CACT,CAAE,MAAO5nB,GAGP,MADA+nB,GADgB/nB,GAAO+W,SAAW,kCAE5B/W,CACR,CAAE,QACAgoB,GAAc,CAAEJ,YAAY,GAC9B,CACF,CAAC,SAAS2wC,KACR,IACE,OAAO70C,IACT,CAAE,MAAO1jB,GAGP,MADA+nB,GADgB/nB,GAAO+W,SAAW,6BAE5B/W,CACR,CACF,CAEA,SAAS44D,GAAqBnxC,EAASoxC,GACrC,MAAMjzC,EAAc6B,GAAS7B,aAAeizC,EAC5C,MAAO,CACLjzC,cACA9K,WAAY2M,GAAS3M,YAAc,EACnC+K,YAAa4B,GAAS5B,aAAe3pB,KAAKmC,IAAI,EAAGunB,EAAc,GAEnE,CAEAovC,eAAe8D,IAAgB,OAAEf,GAAS,GAAU,CAAC,GACnD,MAAMnB,EAAUjC,KAChB,IAAKiC,EAGH,OAFAjwC,GAAS,uCACTJ,GAAW,IAGbY,IAAY,GACP4wC,GACHnxC,GAAiB,2BAEnB,IACE,MAAMiwC,QAAiBC,MAAM,GAAGF,aAAoB,CAClDI,QAAS,CAAE+B,OAAQ,sBAErB,IAAKlC,EAASI,GACZ,MAAM,IAAIniE,MAAM,QAAQ+hE,EAAShyC,UAEnC,MAAMlxB,QAAakjE,EAASK,OAEtB8B,GADUlhE,MAAMC,QAAQpE,GAAQA,EAAOmE,MAAMC,QAAQpE,GAAMqxB,SAAWrxB,EAAKqxB,QAAU,IAExFtyB,IAAKg0B,GAAW8uC,GAAe9uC,IAC/B5V,OAAOsS,SACJ61C,EAAmB/8D,KAAKmC,IAAI,IAAQnC,KAAKyC,MAAM,QAC/CiG,EAAMC,KAAKD,MACXs0D,EAAkBF,EAAcloD,OAAQ4V,IAC5C,IAAKA,EAAOovC,UACV,OAAO,EAET,MAAMqD,EAAct0D,KAAKuW,MAAMsL,EAAOovC,WACtC,QAAIr3D,OAAO+lC,MAAM20B,IAGVv0D,EAAMu0D,GAAeF,IAE9B1yC,GAAW2yC,GACXvyC,GAAS,MACJoxC,GACHnxC,GAA4C,IAA3BsyC,EAAgBrpE,OAAe,sBAAwB,wBAE5E,CAAE,MAAOmQ,GACPumB,GAAW,IACXI,GAAS,4BAA4B3mB,EAAM+W,WACtCghD,GACHnxC,GAAiB,mCAErB,CAAE,QACAO,IAAY,EACd,CACF,CAEA6tC,eAAeoE,IAAY,GACzBhpE,EAAKwkE,KAAc,KACnBr4D,EvDldU,iCuDkdwC,OAClDq5D,EvDlde,UuDkd8B,IAC7CljE,EAAM,eAAc,YACpBkzB,EAAc,EAAC,WACf+vC,EAAa,EAAC,KACdE,EAAO,WAAU,OACjBE,EAAS,MACP,CAAC,GACH,MAAMa,EAAUjC,KACV0E,EvD5dM,sCuD6dZ,IAAKzC,EACH,MAAM,IAAI9hE,MAAM,kCAKlB,MAAMsX,EAAQia,KACRoB,EAAUrb,EAAMuZ,gBAAkB,CAAC,EAEnC2zC,EAAsB7xC,EAAQ7B,aAAeA,EAC7C2zC,EAAkBxD,GAAU,CAChCC,UAAW5pD,EAAM0Z,IAAIC,OAAS,KAC9BkwC,eAAgB7pD,EAAM0Z,IAAI3B,iBAAmB,IAEzC0yC,QAAiBC,MAAM,GAAGF,aAAoB,CAClDG,OAAQ,OACRC,QAAS,CACP,eAAgB,mBAChB,mBAAoBqC,GAEtBp7C,KAAMxqB,KAAKC,UAAU,CACnBtD,KACAmM,OACAq5D,SACAljE,MACAmjE,OACAjwC,YAAa0zC,EACb3D,aACA6D,WvD1fY,IuD2fZ/D,SAAUmD,GAAqBnxC,EAAS6xC,GACxCvD,OAAQ,CACNC,UAAWuD,EAAgBvD,WAAa,KACxCC,eAAgBn+D,MAAMC,QAAQwhE,EAAgBtD,gBAAkBsD,EAAgBtD,eAAiB,QAIvG,IAAKY,EAASI,GACZ,MAAM,IAAIniE,MAAM,gCAAgC+hE,EAAShyC,WAE3D,MAAMxO,QAAgBwgD,EAASK,OAI/B,OAHAvvC,GAAsB7vB,MAAMC,QAAQwhE,EAAgBtD,gBAAkBsD,EAAgBtD,eAAiB,IACvG7uC,GAAkB,CAAEh3B,KAAIi3B,UAAWxiB,KAAKD,MAA8C,KAArCyR,GAASmjD,YvDvgB1C,OuDwgBhB5yC,GAAiB,WAAWrqB,KACrB,CAAEnM,KAAIopE,WAAYnjD,GAASmjD,YvDzgBlB,IuD0gBlB,CAEAxE,eAAeyB,KACb,MAAMG,EAAUjC,KACV0E,EvD7gBM,sCuD8gBNjtD,EAAQia,KACd,KAAKja,EAAMiZ,SAAYjZ,EAAMkZ,kBAAqBsxC,GAAYyC,GAC5D,OAEF,MAAM5xC,EAAUrb,EAAMuZ,gBAAkB,CAAC,EACnC2zC,EAAsB7xC,EAAQ7B,aAAe,EACnD,IACE,MAAMixC,QAAiBC,MAAM,GAAGF,cAAoBxqD,EAAMkZ,6BAA8B,CACtFyxC,OAAQ,OACRC,QAAS,CACP,eAAgB,mBAChB,mBAAoBqC,GAEtBp7C,KAAMxqB,KAAKC,UAAU,CACnBkyB,YAAa0zC,EACbE,WvD9hBU,IuD+hBV/D,SAAUmD,GAAqBnxC,EAAS6xC,GACxCvD,OAAQ,CACNC,UAAW5pD,EAAM0Z,IAAIC,OAAS,KAC9BkwC,eAAgBn+D,MAAMC,QAAQqU,EAAM0Z,IAAI3B,iBAAmB/X,EAAM0Z,IAAI3B,gBAAkB,QAI7F,IAAK0yC,EAASI,GACZ,MAAM,IAAIniE,MAAM,QAAQ+hE,EAAShyC,UAEnC,MAAMxO,QAAgBwgD,EAASK,OtDpcMhwC,EsDqcLviB,YAAYC,MtDpc9CmgB,GAAmBQ,qBAAuB2B,EsDqcpC7Q,GAASmjD,YACXpyC,GAAkB,CAAEh3B,GAAIgc,EAAMkZ,iBAAkB+B,UAAWxiB,KAAKD,MAA6B,IAArByR,EAAQmjD,YAEpF,CAAE,MAAOx5D,GACPC,QAAQsW,KAAK,mBAAoBvW,GACjC4mB,GAAiB,qCACjBU,KACAgvC,IACF,CtD9cF,IAAyCpvC,CsD+czC,CAEA8tC,eAAeyE,KACb,MAAM7C,EAAUjC,KACV0E,EvDvjBM,sCuDwjBNjtD,EAAQia,KACd,KAAKja,EAAMiZ,SAAYjZ,EAAMkZ,kBAAqBsxC,GAAYyC,GAG5D,OAFA/xC,UACAgvC,KAGF,UACQQ,MAAM,GAAGF,cAAoBxqD,EAAMkZ,mBAAoB,CAC3DyxC,OAAQ,SACRC,QAAS,CACP,mBAAoBqC,IAG1B,CAAE,MAAOr5D,GACPC,QAAQsW,KAAK,yBAA0BvW,EACzC,CAAE,QACAsnB,KACAgvC,IACF,CACF,CAEAtB,eAAe0E,GAAWC,EAAUtjD,EAAU,CAAC,GAC7C,MAAMugD,EAAUjC,KAChB,IAAKiC,EACH,MAAM,IAAI9hE,MAAM,kCAElB+xB,GAAc,sBACdC,GAAa,MACb,MAAM8yC,EAAM,GAAGhD,cAAoB+C,SAC7B9C,QAAiBC,MAAM8C,EAAK,CAChC7C,OAAQ,OACRC,QAAS,CACP,eAAgB,oBAElB/4C,KAAMxqB,KAAKC,UAAU2iB,KAEvB,IAAKwgD,EAASI,GAAI,CAChB,MAAMlgD,EAAU,qBAAqB8/C,EAAShyC,UAG9C,MAFAgC,GAAc,MACdC,GAAa/P,GACP,IAAIjiB,MAAMiiB,EAClB,CACA,MAAMpnB,QAAeknE,EAASK,OACxB2C,EAAalqE,GAAQwnE,SAAS56D,MAAQo9D,EAM5C,OALApyC,KACA+uC,KACAF,GAAoBzmE,GAAQwnE,SAC5BtwC,GAAc,UAAUgzC,KACxBjzC,GAAiB,4CACVj3B,CACT,CA+EAqlE,eAAe8E,IAAgB,gBAAEC,GAAkB,GAAU,CAAC,GAC5D,MAAM3tD,EAAQia,KAEd,IADsB0zC,GAAoB3tD,EAAM0Z,IAAIC,MAGlD,OADA4xC,KACOvrD,EAAM0Z,IAAIC,MAEnB,MAAMD,EAAMyyC,KACZxwC,GAAY,MACZC,GAAc,CAAEjC,OAAO,IACvB,IACE,MAAMA,QAAcD,EAAIk0C,cAGxB,OtD5kBJ,SAAqBj0C,GACnBhB,GAAmBe,IAAIC,MAAQA,GAAS,IAC1C,CsDwkBIk0C,CAAYl0C,GACZ4xC,KACO5xC,CACT,CAAE,MAAO/lB,GAGP,MADA+nB,GADgB/nB,GAAO+W,SAAW,0BAE5B/W,CACR,CAAE,QACAgoB,GAAc,CAAEjC,OAAO,GACzB,CACF,CAEAivC,eAAekF,IAAc,gBAAEH,GAAkB,EAAK,OAAEhC,GAAS,GAAU,CAAC,GAC1E,MAAMhyC,QAAc+zC,GAAgB,CAAEC,oBAChC/B,QAAe/C,GAAgBlvC,GAQrC,OAPKgyC,GAEDnxC,GADEoxC,EACe,0CAEA,iEAGd,CAAEjyC,QAAOiyC,SAClB,CAEAhD,eAAemF,GAAgBC,GAAU,eAAEC,GAAiB,GAAS,CAAC,GACpE,MAAMC,EAAcvF,GAAeqF,GACnC,IAAKE,EACH,MAAM,IAAIxlE,MAAM,eAElB,IAAIylE,EACJ,IACEA,EAAkB9mE,KAAKC,UAAUD,KAAK2nB,MAAMk/C,GAC9C,CAAE,MAAOt6D,GAEP,MADA+nB,GAAY,4BACN/nB,CACR,CACA,MAAM8lB,EAAMyyC,KACZxwC,GAAY,MACZC,GAAc,CAAEhC,QAAQ,IACxB,IACE,MAAMA,QAAeF,EAAI00C,aAAaD,GAatC,OAZA7yC,GAAa1B,GACb2xC,KAII/wC,GAHAyzC,QACmBpF,GAAgBjvC,GAElB,2CAEA,+CAGF,yCAEZA,CACT,CAAE,MAAOhmB,GAGP,MADA+nB,GADgB/nB,GAAO+W,SAAW,0BAE5B/W,CACR,CAAE,QACAgoB,GAAc,CAAEhC,QAAQ,GAC1B,CACF,CAEAgvC,eAAeyF,GAAkBC,GAC/B,MAAMC,EAAe5F,GAAe2F,GACpC,IAAKC,EACH,MAAM,IAAI7lE,MAAM,gBAElB,IAAI8lE,EACJ,IACEA,EAAmBnnE,KAAKC,UAAUD,KAAK2nB,MAAMu/C,GAC/C,CAAE,MAAO36D,GAEP,MADA+nB,GAAY,6BACN/nB,CACR,CACA,MAAM8lB,EAAMyyC,KACZxwC,GAAY,MACZ,UACQjC,EAAI+0C,wBAAwBD,GAClClzC,GAAakzC,GACbh0C,GAAiB,4CACnB,CAAE,MAAO5mB,GAGP,MADA+nB,GADgB/nB,GAAO+W,SAAW,2BAE5B/W,CACR,CACF,CAGA,SAASo3D,GAAsBxvC,GAC7B,IAAK9vB,MAAMC,QAAQ6vB,IAAqC,IAAtBA,EAAW/3B,OAC3C,OAEF,MAAM4qB,EAAa46C,GAAuBztC,GAC1C,GAA0B,IAAtBnN,EAAW5qB,OACb,OAEF,IAAIi2B,EACJ,IACEA,EAAMyyC,IACR,CAAE,MAAOv4D,GAEP,YADAC,QAAQsW,KAAK,4CAA6CvW,EAE5D,CACA,MAAMoM,EAAQia,KACR1S,EAAU7b,MAAMC,QAAQqU,EAAM0Z,IAAIM,kBAAoBha,EAAM0Z,IAAIM,iBAAmB,GACnFtQ,EAAO,IAAIvW,IAAIoU,GACfmnD,EAAUnnD,EAAQzH,QACxB,IAAK,MAAMqJ,KAAakF,EACtB,IAAI3E,EAAK3E,IAAIoE,GAGb,IACEuQ,EAAI0yC,mBAAmBjjD,GACvBulD,EAAQ1pE,KAAKmkB,GACbO,EAAKtV,IAAI+U,EACX,CAAE,MAAOvV,GACPC,QAAQsW,KAAK,8BAA+BvW,EAC9C,CAEF8nB,GAAuBgzC,EACzB,CAEA,SAASC,KACP,MAAM3uD,EAAQia,KACd,GAAIja,EAAMiZ,SAAWjZ,EAAMkZ,iBAAkB,CAC3C,MAAM8zC,EAAchtD,EAAM4Y,QAAQjP,KAAMrC,GAAUA,EAAMtjB,KAAOgc,EAAMkZ,kBAC/DywC,EAASqD,GAAarD,QAAU,KAClCA,IACEA,EAAOG,YAAc9pD,EAAM0Z,IAAIE,SAAW+vC,EAAOG,YACnDuE,GAAkB1E,EAAOG,YAAYzyC,MAAOzjB,IAC1CC,QAAQsW,KAAK,gCAAiCvW,KAG9ClI,MAAMC,QAAQg+D,EAAOI,iBAAmBJ,EAAOI,eAAetmE,OAAS,GACzEunE,GAAsBrB,EAAOI,gBAE3BJ,EAAOG,aAAe9pD,EAAMuZ,gBAAgBC,aAAe,GAAK,IAClE4B,GAAkB,CAAE5B,YAAa1pB,KAAKmC,IAAI,EAAG+N,EAAMuZ,gBAAgBC,aAAe,KAClF6wC,KAAmBhzC,MAAOzjB,GAAUC,QAAQsW,KAAK,0BAA2BvW,KAGlF,CACA,GAAIoM,EAAM4a,gBAAiB,CACzB,MAAMg0C,EAAgB5uD,EAAM4Y,QAAQjP,KAAMrC,GAAUA,EAAMtjB,KAAOgc,EAAM4a,iBACjE+uC,EAASiF,GAAejF,QAAU,KACpCA,GAAUj+D,MAAMC,QAAQg+D,EAAOE,iBAAmBF,EAAOE,eAAepmE,OAAS,EACnFunE,GAAsBrB,EAAOE,gBACnB+E,GACVj0C,GAAmB,KAEvB,CACF,CAEAiuC,eAAeiG,KACb,GAAsB,oBAAXzmE,QAAmD,mBAAlBA,OAAO0jE,OACjD,MAAM,IAAIpjE,MAAM,2CAElB,MAAM2M,EAAQjN,OAAO0jE,OAAO,4BAA6B,IACzD,GAAa,MAATz2D,EAEF,OADAmlB,GAAiB,0BACV,KAET,IACE,aAAauzC,GAAgB14D,EAAO,CAAE44D,gBAAgB,GACxD,CAAE,MAAOr6D,GAEP,MADA4mB,GAAiB,oCACX5mB,CACR,CACF,CAEAg1D,eAAekG,KACb,GAAsB,oBAAX1mE,QAAmD,mBAAlBA,OAAO0jE,OACjD,MAAM,IAAIpjE,MAAM,2CAElB,MAAM2M,EAAQjN,OAAO0jE,OAAO,iCAAkC,IAC9D,GAAa,MAATz2D,EAEF,OADAmlB,GAAiB,2BACV,KAET,IAEE,aADM6zC,GAAkBh5D,GACjBA,CACT,CAAE,MAAOzB,GAEP,MADA4mB,GAAiB,gDACX5mB,CACR,CACF,CAEA,SAASm7D,KACP,MAAM/uD,EAAQia,KACd,OAAIja,EAAMiZ,SACRuB,GAAiB,oBACVw0C,QAAQC,QAAQ,CAAEC,gBAAgB,MAE3C/zC,KACA+uC,KACAvvC,GAAmB,MACnBH,GAAiB,2BACjBD,GAAS,MACFmzC,GAAgB,CAAEC,iBAAiB,IACvCwB,KAAMx1C,GAEEqzC,GAAY,CACjBrD,OAAQ,CACNC,UAAWjwC,EACXkwC,eAJe0B,QAMhB4D,KAAM5rE,IACPi3B,GAAiB,WAAWxa,EAAMkZ,kBAAoB31B,EAAOS,MACtDT,KAGV8zB,MAAOzjB,IAIN,MAFA2mB,GAD0C,iBAAnB3mB,GAAO+W,QAAuB/W,EAAM+W,QAAU,eAErE6P,GAAiB,MACX5mB,IAEZ,CAEA,SAASw7D,KAEP,OADcn1C,KACHhB,SAIXuB,GAAiB,uBACjBD,GAAS,MACF8yC,KACJ8B,KAAK,KACJ30C,GAAiB,oBACjBG,GAAmB,QAEpBtD,MAAOzjB,IAGN,MADA2mB,GAD0C,iBAAnB3mB,GAAO+W,QAAuB/W,EAAM+W,QAAU,eAE/D/W,MAbR4mB,GAAiB,4BACVw0C,QAAQC,QAAQ,CAAEI,gBAAgB,IAc7C,CAEA,SAASC,GAAmBh1C,GAC1B,OAAKA,EAIiB,MACpB,MAAMi1C,EAAej1C,EAAOqvC,QAAU,CAAC,EACvC,OAAI4F,EAAa3F,WACf/1D,QAAQ27D,MAAM,2CAA2Cl1C,EAAOt2B,MACzDgrE,QAAQC,QAAQ,CAAE30C,SAAQqvC,OAAQ4F,MAE3C17D,QAAQ27D,MAAM,6CAA6Cl1C,EAAOt2B,uBAClEw2B,GAAiB,0BA/sBrBouC,eAAkC2E,GAChC,MAAM/C,EAAUjC,KAChB,IAAKiC,EACH,MAAM,IAAI9hE,MAAM,kCAElBmL,QAAQ27D,MAAM,+CAA+CjC,KAC7D,MAAM9C,QAAiBC,MAAM,GAAGF,cAAoB+C,KACpD,GAAwB,MAApB9C,EAAShyC,OAEX,OADA5kB,QAAQsW,KAAK,2BAA2BojD,4BACjC,CAAEkC,UAAU,GAErB,IAAKhF,EAASI,GAEZ,MADAh3D,QAAQsW,KAAK,iDAAiDsgD,EAAShyC,cAAc80C,KAC/E,IAAI7kE,MAAM,+BAA+B+hE,EAAShyC,WAE1D,MAAMxO,QAAgBwgD,EAASK,OAE/B,OADAj3D,QAAQ27D,MAAM,+CAA+CjC,KACtDtjD,CACT,CA8rBWylD,CAAmBp1C,EAAOt2B,IAAImrE,KAAM5rE,IACzC,GAAIA,GAAQksE,SAAU,CACpB57D,QAAQsW,KAAK,2BAA2BmQ,EAAOt2B,2BAC/C,MAAMgc,EAAQia,KACRz0B,EAAQwa,EAAM4Y,QAAQpP,UAAWlC,GAAUA,EAAMtjB,KAAOs2B,EAAOt2B,IAKrE,MAJIwB,GAAS,GACXwa,EAAM4Y,QAAQ7zB,OAAOS,EAAO,GAE9Bm1B,GAAmB,MACb,IAAIjyB,MAAM,8BAClB,CACA,MAAMinE,EAAYpsE,GAAQwnE,QACpB6E,EAAkBD,GAAWhG,QAAU,CAAC,EAC9C,IAAKiG,EAAgBhG,UACnB,MAAM,IAAIlhE,MAAM,oDAElB,MAAMsX,EAAQia,KACR41C,EAAe,IAChBv1C,EACHqvC,OAAQ,CACNC,UAAWgG,EAAgBhG,WAAa,KACxCC,eAAgBn+D,MAAMC,QAAQikE,EAAgB/F,gBAAkB+F,EAAgB/F,eAAe/pD,QAAU,GACzGgqD,WAAY8F,EAAgB9F,YAAc,KAC1CC,eAAgBr+D,MAAMC,QAAQikE,EAAgB7F,gBAAkB6F,EAAgB7F,eAAejqD,QAAU,IAE3G4pD,UAAWiG,GAAWjG,WAAapvC,EAAOovC,WAEtClkE,EAAQwa,EAAM4Y,QAAQpP,UAAWlC,GAAUA,EAAMtjB,KAAOs2B,EAAOt2B,IAKrE,OAJIwB,GAAS,IACXwa,EAAM4Y,QAAQpzB,GAASqqE,GAEzBh8D,QAAQ27D,MAAM,wCAAwCl1C,EAAOt2B,MACtD,CAAEs2B,OAAQu1C,EAAclG,OAAQkG,EAAalG,YAIjDmG,GACJX,KAAK,EAAG70C,OAAQy1C,EAAgBpG,aAC/BxuC,KACA+uC,KACAxvC,GAAa,MACb7mB,QAAQ27D,MAAM,2CAA2CO,EAAe/rE,MACxEw2B,GAAiB,iBAAiBu1C,EAAe5/D,MAAQ4/D,EAAe/rE,SACxEu2B,GAAS,MACFwzC,GAAgBpE,EAAOC,UAAW,CAAEqE,gBAAgB,IACxDkB,KAAMv1C,IACL,MAAM4B,EAAa+vC,KAEnB,OADA13D,QAAQ27D,MAAM,4CAA4CO,EAAe/rE,MAClEspE,GAAWyC,EAAe/rE,GAAI,CACnCgsE,aAAcp2C,EACdsxC,iBAAkB1vC,IACjB2zC,KAAM5rE,IACPo3B,GAAmBo1C,EAAe/rE,IAC9B0H,MAAMC,QAAQpI,GAAQwnE,SAASpB,QAAQE,iBACzCmB,GAAsBznE,EAAOwnE,QAAQpB,OAAOE,gBAE9CrvC,GAAiB,UAAUj3B,GAAQwnE,SAAS56D,MAAQ4/D,EAAe5/D,MAAQ4/D,EAAe/rE,MACnFT,QAId8zB,MAAOzjB,IACN,MAAM+W,EAAoC,iBAAnB/W,GAAO+W,QAAuB/W,EAAM+W,QAAU,cAIrE,MAHA9W,QAAQsW,KAAK,mCAAmCmQ,EAAOt2B,OAAO2mB,KAC9D+P,GAAa/P,GACb6P,GAAiB,MACX5mB,KA7ER8mB,GAAa,uBACNs0C,QAAQiB,OAAO,IAAIvnE,MAAM,uBA8EpC,CCj+BA,SAASwnE,KACP,MAAMt7D,EAAW,KAEX3I,EAAO6D,KAAKmC,IADH,GACe2C,EADf,IAEfsN,GAAS/W,EAAI2E,KAAKmC,IAFH,GAEenC,KAAK+E,IAAI5I,EAAMiW,GAAS/W,GACxD,CAEA,SAASglE,GAAanlE,EAAO+xC,EAAQnoC,GACnC,MAAM/J,EAAQiF,KAAKmC,IAAI,EAAG2C,GAAY,MACtC,OAAO9E,KAAKmC,IAAI8qC,EAAQjtC,KAAK+E,IAAIhK,EAAQkyC,EAAQ/xC,GACnD,CA0MA,SAASolE,GAAW9kD,IpD9PpB,SAAqBA,GACnBuV,IAAWvV,CACb,CoD6PE+kD,CAAY/kD,GACZijC,GAAqBjjC,GC1PvB,SAA8BA,GAC5B,MAAMtL,E9EDCtO,G8EEP,IAAK,IAAIlO,EAAIwc,EAAMpO,QAAQnO,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CACrD,MAAMqP,EAASmN,EAAMpO,QAAQpO,GAC7B,IAAKqP,EAAQ,CACXmN,EAAMpO,QAAQ7M,OAAOvB,EAAG,GACxB,QACF,CAEA,GADAqP,EAAOD,KAAO0Y,EACVzY,EAAOD,KAAO,EAAG,CACnBoN,EAAMpO,QAAQ7M,OAAOvB,EAAG,GACxB,QACF,CACAqP,EAAOF,IAAME,EAAOF,KAAO,IAfP,IAe+B2Y,EACnDzY,EAAO1H,IAAM0H,EAAOJ,IAAM,GAAK6Y,EAC/BzY,EAAO1F,GAAK0F,EAAOF,GAAK2Y,EACpBzY,EAAO1F,GAAKzC,EAAW,KACzBmI,EAAO1F,EAAIzC,EAAW,GACtBmI,EAAOJ,GAAwB,KAAlBI,EAAOJ,IAAM,GAC1BI,EAAOF,KAAO,KAEhB,MAAMm0B,EAAKj0B,EAAO1H,EAAI+W,GAAS/W,EACzB47B,EAAKl0B,EAAO1F,GAAK+U,GAAS/U,EAAI+U,GAASQ,aAAanF,YAAc,IACvDzN,KAAKs3B,MAAMN,EAAIC,GACjB,KACb50B,GAAaU,EAAOb,QAAU,GAC9BkyB,GAAe,CACb/4B,EAAG0H,EAAO1H,EACVgC,EAAG0F,EAAO1F,EACVi3B,YAAa,GACbC,UAAW,GACXv2B,MAAO,UACP8E,IAAK,MAEPoN,EAAMpO,QAAQ7M,OAAOvB,EAAG,GAE5B,CACF,CDsNE8sE,CAAqBhlD,GACrBgf,GAAehf,GACfq7C,GAAkBr7C,GpClDpB,SAA+BA,GACzBjW,GAAM4B,wBACR5B,GAAM4B,uBAAwB,EAC1B03B,GAAal3B,OACfm4B,GAA0B,WApD1BjB,GAAal3B,SAGjBk3B,GAAaO,kBAAoB/oB,KACjCwoB,GAAaQ,mBAAqBjtB,GAASwB,iBAC3CirB,GAAaS,kBAAoBt9B,KACjC68B,GAAal3B,QAAS,EACtBk3B,GAAaE,QAAS,EACtBF,GAAaG,UA9JD,GA+JZH,GAAavb,KAAO,EACpBub,GAAanN,MAAQ,EACrBmN,GAAaK,QAAU,EACvBL,GAAaM,cAAgB,KAC7BN,GAAaI,iBAAmB,EAChCJ,GAAajN,YAAc,QAC3BiN,GAAarN,aAAe,EAE5BkO,KACAF,IAAoB,GACpBpqB,KACAmqB,KACArE,OAqCA2D,GAAarN,aA7Ef,WACE,IAAIoJ,EAAQ,EACZ,IAAK,IAAIlnC,EAAI6N,GAAQ5N,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CAC/C,MAAMmhB,EAAQtT,GAAQ7N,GAClBmhB,EAAMpD,eAAiBmtB,KAGvB/pB,EAAMrE,QAAU,IAA2B,IAAtBqE,EAAMhF,YAC7BtO,GAAQtM,OAAOvB,EAAG,GAGhBmhB,EAAMrE,OAAS,IACjBoqB,GAAS,GAEb,CACA,OAAOA,CACT,CA6D8B6lC,GAEvB5hC,GAAal3B,SAIlBk3B,GAAaK,SAAW1jB,EACxBgkB,KAEKX,GAAaE,QAAwC,IAA9BF,GAAarN,eACL,MAA9BqN,GAAaM,gBACfN,GAAaI,iBAAmBj/B,KAAKmC,IAAI,EAAG08B,GAAaK,QAAUL,GAAaM,gBAElFN,GAAaM,cAAgB,KAC7BN,GAAaE,QAAS,EACtBF,GAAaG,UA9ND,EA+NZH,GAAajN,YAAc,QAGzBiN,GAAaE,SACfF,GAAaG,UAAYh/B,KAAKmC,IAAI,EAAG08B,GAAaG,UAAYxjB,GAC1DqjB,GAAaG,WAAa,GApIlC,WACE,MAAMW,EAAa5lC,OAAOoJ,KAAK,KAC1B07B,GAAaC,gBAAkBa,EAAWhsC,OAAS,GACtD+rC,KAGF,MAAMpc,EAAOub,GAAavb,KAAO,EAI3Bo9C,EAAW1gE,KAAKmC,IAAI,EAvGX,GAwGT24B,EAAU96B,KAAK+E,IA1GT,EA0GoB/E,KAAKoC,MAzGxB,GAyG+BkhB,EAAO,IAvGvC,IAwGNq9C,EAAeD,EAAW,EAAI1gE,KAAKoC,MAAOpC,KAAK4C,UAAuB,EAAX89D,EAAe,GAAMA,GAAY,EAC5FtsE,EAAQ4L,KAAKmC,IAAI,EAAGnC,KAAK+E,IAzGnB,GAyGmC+1B,EAAU6lC,IAEnDC,EAAc,IAAIv9D,IACtB9B,GAAQqT,OAAQC,GAAUA,EAAMpD,eAAiBmtB,IAAiBpoC,IAAKqe,GAAUA,EAAM3gB,KAGzFglC,GAAa9kC,EAAO,CAAEwb,QAASgvB,GAAiB/uB,aAAa,IAE7D,IAAK,MAAMgF,KAAStT,GACdsT,EAAMpD,eAAiBmtB,IAAoBgiC,EAAY3rD,IAAIJ,EAAM3gB,KACnE2rC,GAAqBhrB,EAAOyO,GAIhCub,GAAavb,KAAOA,EACpBub,GAAa3N,SAAWlxB,KAAKmC,IAAI08B,GAAa3N,SAAU2N,GAAavb,MACrEub,GAAaE,QAAS,EACtBF,GAAaM,cAAgBN,GAAaK,QAC1CL,GAAajN,YAAc,MAC7B,CAqGMivC,IAGN,CoCgBEC,CAAsBtlD,GrCJxB,SAAwBA,ID3KxB,SAAqCA,GACnCygB,GAAcK,WAAat8B,KAAKmC,IAAI,EAAG85B,GAAcK,WAAa9gB,EACpE,CC0KEulD,CAA4BvlD,GDlG9B,SAAwCA,GACtCygB,GAAc96B,MAAMgjB,SAAWnkB,KAAKmC,IAAI,EAAG85B,GAAc96B,MAAMgjB,SAAW3I,EAC5E,CCiGEwlD,CAA+BxlD,GAC/B+iB,KAEA,MAAMruB,EAAQusB,KACd,GAAKvsB,EAAMvI,QAA0B,aAAhBuI,EAAMohB,MAI3B,GAAoB,aAAhBphB,EAAMohB,MAAV,CAOA,GAAoB,WAAhBphB,EAAMohB,MAAoB,CAC5B,GAA6B,YAAzBphB,EAAMyrB,UAAUr+B,KAAoB,ED/H5C,SAAoCke,GAClCygB,GAAcN,UAAUa,UAAYx8B,KAAKmC,IAAI,EAAG85B,GAAcN,UAAUa,UAAYhhB,EACtF,CC8HMylD,CAA2BzlD,GAC3B,MAAMhP,EAAW0D,EAAMyrB,UAAUnvB,UAAY,EAG7C,GADAuwB,GADgB/8B,KAAKmC,IAAI,EAAGqK,EAAW0D,EAAMyrB,UAAUa,YAEnDtsB,EAAMyrB,UAAUa,WAAa,EAE/B,YADA0B,IAGJ,CACA,MAA6B,cAAzBhuB,EAAMyrB,UAAUr+B,MAAwB4S,EAAMyrB,UAAUxjC,OAAS,GAAK+X,EAAMyrB,UAAUY,UAAYrsB,EAAMyrB,UAAUxjC,YACpH+lC,MA1LN,WAEE,GAAoB,WADNzB,KACJnL,MAGV,IAAK,IAAI59B,EAAI6N,GAAQ5N,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CAC/C,MAAMmhB,EAAQtT,GAAQ7N,GAClBmhB,EAAMpD,eAAiB0rB,IAAoBtoB,EAAMrE,QAAU,IAA2B,IAAtBqE,EAAMhF,aACxEtO,GAAQtM,OAAOvB,EAAG,EAEtB,CACF,CAkLIwtE,GACA7jC,KACIjrB,GAAS5B,QAAU,OAlF3B,SAA8B2nB,EAAS,IACrC,MAAMjoB,EAAQusB,KACd,GAAoB,WAAhBvsB,EAAMohB,MACR,OAEF,MAAMsM,EAAUlB,KACVqB,EAAWb,KACjBE,KAGAN,GAAmB,GAFC5sB,EAAM8rB,gBAAkB,oBAC9B7D,EAAS,MAAMA,IAAW,yBAGxC0E,GAAiB,UADAe,GAAStC,qBAAuByC,EAASzC,qBAAuB,GAEjF2B,GAAuB,WACvB5nB,IACF,CAoEM8rD,CAAqB,uBAGvB,EACF,CAEoB,YAAhBjxD,EAAMohB,MAOU,YAAhBphB,EAAMohB,OACJphB,EAAMosB,WAPNpsB,EAAMosB,YAAc,GACtB0B,IA5BJ,MAJM9tB,EAAMosB,YAAc,GACtBmB,IA0CN,CqCjDE2jC,CAAe5lD,GACfpJ,GAAShB,gBAAkBpR,KAAKmC,IAAI,EAAGiQ,GAAShB,gBAAkBoK,GAClEpJ,GAASL,qBAAuB/R,KAAKmC,IAAI,GAAIiQ,GAASL,sBAAwB,GAAKyJ,GAC/EpJ,GAASL,sBAAwB,IACnCK,GAASJ,wBAA0B,GAErCI,GAASoB,cAAgBxT,KAAKmC,IAAI,EAAGiQ,GAASoB,cAAgBgI,GAC9DpJ,GAASqB,eAAiBzT,KAAKmC,IAAI,GAAIiQ,GAASqB,gBAAkB,GAAK+H,GACvEpJ,GAASd,UAAYtR,KAAKmC,IAAI,GAAIiQ,GAASd,WAAa,GAAKkK,GAC7DpJ,GAASuB,gBAAkB3T,KAAKmC,IAAI,GAAIiQ,GAASuB,iBAAmB,GAAK6H,GACzEpJ,GAASb,eAAiBvR,KAAKmC,IAAI,GAAIiQ,GAASb,gBAAkB,GAAKiK,GACnEpJ,GAASb,gBAAkB,IAC7Ba,GAASZ,kBAAoB,GhEpFjC,SAA6BgK,EAAQ,GAC/Bf,GAAQK,aAAe,IACzBL,GAAQK,aAAe9a,KAAKmC,IAAI,EAAGsY,GAAQK,aAAeU,GAC7B,IAAzBf,GAAQK,eACVL,GAAQI,QAAU,MAGxB,CgEgFEwmD,CAAoB7lD,G7D5EtB,SAA8BA,EAAQ,GAChC,GAAQV,aAAe,IACzB,GAAQA,aAAe9a,KAAKmC,IAAI,EAAG,GAAQ2Y,aAAeU,GAC7B,IAAzB,GAAQV,eACV,GAAQD,QAAU,MAGxB,C6DsEEymD,CAAqB9lD,G3DzBvB,SAA8BA,EAAQ,GAChC,GAAQV,aAAe,IACzB,GAAQA,aAAe9a,KAAKmC,IAAI,EAAG,GAAQ2Y,aAAeU,GAC7B,IAAzB,GAAQV,eACV,GAAQD,QAAU,MAGxB,C2DmBE0mD,CAAqB/lD,GACrB,MAAMgmD,EhEhFC/mD,GAAQC,QgEiFT+mD,E7DtEC,GAAQ/mD,Q6DuETgnD,E3DnBC,GAAQhnD,Q2DoBTinD,EAAkBH,GAAmBC,GAAoBC,EAEzDE,E3DHR,WACE,MAAMC,EAAUthD,GAAaC,mBAE7B,OADAD,GAAaC,mBAAqB,KAC3BqhD,CACT,C2DD0BC,GACpBF,GAvON,SAAoCG,GAClC,MAAM9iD,EAAW8iD,GAAS9iD,SAC1B,IAAKA,EACH,OAGF9a,GAAe8a,EAAS7a,eACxB,MAAMU,EAAW,KACXoN,EAAiBhD,GAAe,GAAM1B,UACtCgH,EAAU6rD,GAAav7D,GAAYma,EAASJ,kBAAoB,IAAM,GAAI/Z,GAEhFsN,GAAS/W,EAAImZ,EACbpC,GAAS/U,EAAIzC,EAAWsX,EACxBE,GAASzP,GAAK,EACdyP,GAASvP,GAAK,EACduP,GAASnC,UAAW,EACpBmC,GAASC,YAAc,SACvBD,GAASE,UAAY,KACrBF,GAASG,mBAAqB,KAC9BH,GAASO,UAAY,EACrBP,GAASpE,WAAY,EACrBoE,GAASS,WAAY,EACrBT,GAASU,aAAe,EACxBV,GAASW,cAAgB,KACzBX,GAASY,cAAgB,EACzBZ,GAASc,iBAAkB,EAC3Bd,GAASe,iBAAmB,EAC5Bf,GAASiB,eAAgB,EACzBjB,GAASkB,eAAe3f,OAAS,EACjCye,GAASoB,cAAgB,EACzBpB,GAASqB,eAAiB,EAC1BrB,GAASsB,WAAY,EACrBtB,GAASuB,gBAAkB,EAC3BvB,GAASb,eAAiB,EAC1Ba,GAASZ,kBAAoB,EAC7BY,GAAS5B,OAAS4B,GAAS3B,UAC3B2B,GAAShB,gBAAkB,EAE3B,MAAM4yB,EAASq8B,GAAav7D,GAAYma,EAASH,iBAAmB,IAAM,GAAIha,GAC9EzD,GAAchG,EAAI2oC,EAClB3iC,GAAchE,EAAIzC,EAAWyG,GAAcxG,OAC3CwG,GAAcmP,OAASnP,GAAcoP,UACrCpP,GAAc4P,WAAa,EAC3B5P,GAAc6P,WAAa,EAC3B7P,GAAc8P,eAAiB,EAC/B9P,GAAcgQ,aAAe,EAE7BwC,GAAWyB,QAAQ,CAACK,EAAMjgB,KACxB,MAAM+K,EAAwB,GAAR/K,EAAN,IAChBigB,EAAKta,EAAIglE,GAAa7rD,EAAU/T,EAAQ,GAAIqE,GAC5C6Q,EAAKtY,EAAIzC,EAAWsU,GAAe,GAAM1B,UACzCmI,EAAKhT,GAAK,EACVgT,EAAK9S,GAAK,EACV8S,EAAK1F,UAAW,EAChB0F,EAAKzF,MAAQ,SACbyF,EAAK7D,cAAgB,KACrB6D,EAAK/D,aAAe,IAGtBrQ,GAAQ5N,OAAS,EAEjB,MAEMylC,EAAc,CAFFinC,GAAav7D,GAAYma,EAASF,mBAAmB,IAAM,KAAO,GAAIja,GACrEu7D,GAAav7D,GAAYma,EAASF,mBAAmB,IAAM,KAAO,GAAIja,IAGzF7C,GAAiBjC,KAAKmC,IAAI,EAAG8c,EAASN,mBAAqB,I3DwK7D,UAAmC,WAAEqjD,EAAU,cAAEthD,IAC/CH,GAAaE,kBAAoBuhD,GAAc,KAC/CzhD,GAAaG,cAAgBA,GAAiB,IAChD,C2D1KEuhD,CAA0B,CAAED,WAAY/iD,EAAS/qB,GAAIwsB,cAAe,CAAE9Q,QAAS,WAAY9T,OAAQs9B,KAEnG,MAAMhlC,EAAQ4L,KAAKmC,IAAI,EAAGnC,KAAKyC,MAAMwc,EAASL,YAAc,IACxDxqB,EAAQ,GACV8kC,GAAa9kC,EAAO,CAAEwb,QAAS,WAAYC,aAAa,GAE5D,CAgKIqyD,CAA2BN,GAG7B,MAAMO,GAAoBR,GAA0Bp8D,GAAMQ,iBAC1DR,GAAMQ,kBAAmB,EACzB,MAAMq8D,GAAsBT,GAA0Bp8D,GAAMW,0BACtDm8D,EAAuBV,EAAkB,KAAOp8D,GAAMY,mBACtDm8D,GAA+BX,GAA0Bp8D,GAAMa,4BAC/DC,EAAwBs7D,EAAkB,EAAIp8D,GAAMc,sBACpDk8D,GAA6BZ,GAA0Bp8D,GAAMe,0BAC7Dk8D,GAA6Bb,GAA0Bp8D,GAAMgB,0BAC7Dk8D,GAA6Bd,GAA0Bp8D,GAAMiB,8BAC7Dk8D,GAAkCf,GAA0Bp8D,GAAMkB,+BAClEk8D,GAAmChB,GAA0Bp8D,GAAMmB,gCACnEk8D,GAAqCjB,GAA0Bp8D,GAAMoB,kCACrEk8D,GAAuClB,GAA0Bp8D,GAAMqB,oCACvEk8D,GAAwCnB,GAA0Bp8D,GAAMsB,qCAC9EtB,GAAMW,2BAA4B,EAClCX,GAAMY,mBAAqB,KAC3BZ,GAAMa,6BAA8B,EACpCb,GAAMc,sBAAwB,EAC9Bd,GAAMe,2BAA4B,EAClCf,GAAMgB,2BAA4B,EAClChB,GAAMiB,+BAAgC,EACtCjB,GAAMkB,gCAAiC,EACvClB,GAAMmB,iCAAkC,EACxCnB,GAAMoB,mCAAoC,EAC1CpB,GAAMqB,qCAAsC,EAC5CrB,GAAMsB,sCAAuC,EAE7C,MAAMk8D,GAAsBpB,GAAmBvvD,GAAS5B,OAAS,GAAIjL,GAAMK,eACrEo9D,GAAqBrB,GAAmBvvD,GAAS5B,OAAS,GAAIjL,GAAMM,cACpEo9D,GAAsBtB,GAAmBvvD,GAAS5B,OAAS,GAAIjL,GAAMO,eAE3EP,GAAMK,gBAAiB,EACvBL,GAAMM,eAAgB,EACtBN,GAAMO,gBAAiB,EAEvB,MAAMo9D,GAAgBvB,GAA0Bp8D,GAAMI,KAwBtD,GAvBAJ,GAAMI,MAAO,ET5Kf,SAAkCw8D,GAChC,GAAI/vD,GAASE,UAAW,CACtBF,GAASG,mBAAqB,KAC9B,MAAM4d,EAAUo3B,KAIhB,YAHI4a,GAAqBhyC,GAAWA,EAAQG,eAAiB,KAC3Dy3B,GAAY53B,EAAS,CAAE+3B,gBAAiB/3B,EAAQvyB,SAGpD,CAEA,GAAIwU,GAAS5B,QAAU,EAErB,YADA4B,GAASG,mBAAqB,MAIhC,IAAI4wD,EAAc,KACdC,EAAY7gE,OAAOgV,kBACvB,MAAM6sB,EAAel1B,GAAe,GAAM1B,UACpC+hC,EAAcn9B,GAAS/U,EAAI+mC,EAEjC,IAAK,MAAMjU,KAAWW,GAAU,CAC9B,MAAMl3B,EAAamyB,GAAoBoE,EAAQ7yB,MAC/C,IAAK1D,EACH,SAEF,GAAIu2B,EAAQE,SACV,SAEF,GAAIF,EAAQG,cAAgB,EAC1B,SAGF,MAAMxlB,EAAa9K,KAAK0xC,IAAIt/B,GAAS/W,EAAI80B,EAAQ90B,GAEjD,GAAIyP,GADkBlR,EAAW0yB,aAAe,IAE9C,SAGF,MAAM+2C,EAAclzC,EAAQ9yB,EAAIzD,EAAWiB,OACrCkQ,EAAW/K,KAAK0xC,IAAInC,EAAc8zB,GAClCp3C,EAAeryB,EAAWqyB,cAAgB,SAChD,IAAIq3C,EAQJ,GANEA,EADmB,QAAjBr3C,EACkBjsB,KAAKmC,IAAI,KAAMvI,EAAWs0B,kBAAoB,GAAK,IAC7C,UAAjBjC,EACWjsB,KAAKmC,IAAI,IAAKvI,EAAWg1B,oBAAsB,IAAM,IAErD,GAElB7jB,EAAWu4D,EACb,SAGF,MAAMC,EAAQz4D,EAAwB,GAAXC,EACvBw4D,EAAQH,IACVA,EAAYG,EACZJ,EAAchzC,EAElB,CAEA/d,GAASG,mBAAqB4wD,GAAajvE,IAAM,KAE7CiuE,GAAqBgB,GArI3B,SAAsBhzC,GACpB,MAAMv2B,EAAamyB,GAAoBoE,EAAQ7yB,MAC1C1D,IAILu2B,EAAQE,SAAWi3B,GACnBn3B,EAAQG,cAAgB,IACxBle,GAASE,UAAY6d,EAAQj8B,GAC7Bke,GAASC,YAAc,UACvBD,GAASG,mBAAqB,KAC9BH,GAASS,WAAY,EACrBT,GAASW,cAAgB,KACzBX,GAASU,aAAe,EACxBV,GAASY,cAAgB,EACzBZ,GAASc,iBAAkB,EAC3Bd,GAASe,iBAAmB,EAC5Bf,GAASgB,kBAAmB,EAC5BhB,GAASiB,eAAgB,EACzBjB,GAASkB,eAAe3f,OAAS,EACjCye,GAASpE,WAAY,EACrBoE,GAASnE,SAAU,EACnB05C,GAAwBx3B,EAASv2B,GACnC,CA+GI4pE,CAAaL,EAEjB,CS6GEM,CAAyBtB,GACrBC,GV9TN,WACE,GAAIhwD,GAASM,qBAAuB,EAClC,OAAO2zC,KAETj0C,GAASI,mBAAqBJ,GAASI,kBAAoB,GAAKtE,GAAeva,OAC/E,MAAMyzD,EAAUf,KAChBj0C,GAASK,eAAiB20C,GAASlzD,IAAMke,GAASK,eAClDL,GAASM,qB7DcQ,G6DZnB,CUsTIgxD,GAEErB,GVtTN,SAA6BnuD,GAC3B,MAAMxe,EAAQwY,GAAewL,UAAW0tC,GAAYA,EAAQlzD,KAAOggB,GAC/Dxe,GAAS,IACX0c,GAASI,kBAAoB9c,EAC7B0c,GAASK,eAAiByB,EAC1B9B,GAASM,qB7DKM,I6DHnB,CUgTIixD,CAAoBtB,GAElBC,IACYn4C,KACJzP,QDuUZ0P,IAAW,IANXA,IAAW,GACXW,GAAqB,GACrB6xC,OC7T8B,IAA1Bv2D,GACY8jB,KACJzP,SvDvQd,SAAoBc,GACwB,IAAtCqN,GAAmBC,QAAQn1B,SAG/Bk1B,GAAmBE,eAAiBF,GAAmBE,cAAgBvN,EAAQqN,GAAmBC,QAAQn1B,QAAUk1B,GAAmBC,QAAQn1B,OACjJ,CuDmQM,CAAoB0S,GAGpBk8D,EAA4B,CAC9B,MAAMryD,EAAQia,KACRy5C,EAAiB1zD,EAAMwK,QAAUxK,EAAM4Y,QAAQ5Y,EAAM6Y,eAAiB,KACxE66C,GACFpE,GAAmBoE,GAAgBr8C,MAAOzjB,GAAUC,QAAQsW,KAAK,cAAevW,GAEpF,CAaA,GAZI0+D,GACYr4C,KACJzP,SACRukD,KAAqB13C,MAAOzjB,GAAUC,QAAQsW,KAAK,cAAevW,IAGlE2+D,GACYt4C,KACJzP,SACR4kD,KAAqB/3C,MAAOzjB,GAAUC,QAAQsW,KAAK,sBAAuBvW,IAG1E4+D,EAAiC,CACnC,MAAMxyD,EAAQia,KACVja,EAAMwK,SAAWxK,EAAMiZ,SACzB60C,GAAc,CAAEH,iBAAiB,EAAOhC,QAAQ,IAASt0C,MAAOzjB,GAAUC,QAAQsW,KAAK,oBAAqBvW,GAEhH,CAOA,GANI6+D,GACYx4C,KACJzP,SACRqkD,KAAqBx3C,MAAOzjB,GAAUC,QAAQsW,KAAK,sBAAuBvW,IAG1E8+D,EAAoC,CACtC,MAAM1yD,EAAQia,KACVja,EAAMwK,SAAWxK,EAAMiZ,SACzB61C,KAAwBz3C,MAAOzjB,GAAUC,QAAQsW,KAAK,sBAAuBvW,GAEjF,CACA,GAAI++D,EAAsC,CACxC,MAAM3yD,EAAQia,KACVja,EAAMwK,SAAWxK,EAAMiZ,SACzByyC,GAAoB,CAAEC,QAAQ,IAASt0C,MAAOzjB,GAAUC,QAAQsW,KAAK,wBAAyBvW,GAElG,CACIg/D,GACY34C,KACJzP,SACRqhD,KAA4Bx0C,MAAOzjB,GAAUC,QAAQsW,KAAK,yBAA0BvW,IAGxF,IAAI+/D,EAAgBtc,KAChBuc,EAAY58C,QAAQ28C,GAEpBzxD,GAAS5B,QAAU,GAAKszD,ITjQ9B,SAAgChwE,EAAU,CAAC,GACzC,MAAMq8B,EAAUo3B,KAChB,IAAKp3B,EAGH,OAFA/d,GAASE,UAAY,UACrBF,GAASC,YAAc,UAGzB01C,GAAY53B,EAAS,CAAE63B,cAAc,EAAMK,iBAAiB,KAAUv0D,GACxE,CS0PIiwE,CAAuB,CAAE7b,gBAAiB2b,GAAejmE,SACzDimE,EAAgB,KAChBC,GAAY,GAGVZ,GAAiB9wD,GAAS5B,OAAS,IAAMszD,GN1Y/C,SAAmBhkE,GACjB,GAAIsS,GAASE,UACX,OAEF,IAAKF,GAASnC,UAAYmC,GAASnE,SAAWmE,GAASS,WAAaT,GAAS5B,QAAU,IAAM4B,GAASd,WAAa,GAAK,EACtH,OAGF,MAAM,KAAEnM,EAAI,MAAEE,GAAUvF,EACpBqF,IAASE,EACX+M,GAASxU,QAAU,EACVyH,IAAUF,IACnBiN,GAASxU,OAAS,GAGpBwU,GAASnE,SAAU,EACnBmE,GAASO,UlE3BW,IkE4BpBP,GAASpE,WAAY,EACrBoE,GAASvP,GAAK,CAChB,CMwXImhE,CAAU,CAAE7+D,KAAMI,GAAMJ,KAAME,MAAOE,GAAMF,QAGxCy+D,GAAsC,YAAzB1xD,GAASC,cACzBD,GAASC,YAAc,UAGzB,MAAM4xD,GAAUtC,IAAoBmC,GAAa1xD,GAASd,WAAa,IAAMc,GAASsB,UAEhFwwD,IAAkBD,GAASlB,EAC3BoB,IAAiBF,GAASjB,EAC1BoB,IAAkBH,GAAShB,EAE7B7wD,GAAS5B,OAAS,EAChBszD,EA7NR,WACE,MAAM3zC,EAAUo3B,KAChB,IAAKp3B,EAGH,OAFA/d,GAASE,UAAY,UACrBF,GAASC,YAAc,UAGzBD,GAASC,YAAc,UACvBD,GAASpE,WAAY,EACrBoE,GAASnE,SAAU,EACnBmE,GAASnC,SAAWkgB,EAAQlgB,UAAkC,MAAtBkgB,EAAQN,UAClD,CAmNMw0C,GAtSN,SAA2B7oD,GACzB,GAAIpJ,GAASE,UACX,OAKF,GAFAF,GAASpE,UAAYzI,GAAMG,MAAQ0M,GAASnC,WAAamC,GAASnE,UAAYmE,GAASS,UAEnFT,GAASnE,QACXmE,GAASzP,GxExIM,IwEwIDyP,GAASxU,OACvBwU,GAASvP,GAAK,EACduP,GAASO,WAAa6I,EAClBpJ,GAASO,WAAa,IACxBP,GAASnE,SAAU,OAEhB,CACL,IAAIsC,EAAYjD,GAUhB,GATI8E,GAASpE,YACXuC,GAAa,KAEX6B,GAASS,YACXtC,GAAa,IAEX6B,GAASsB,YACXnD,GAAa,IAEX6B,GAASb,eAAiB,EAAG,CAC/B,MAAM+yD,EAAalyD,GAASZ,mBAAqB,GACjDjB,GAAavQ,KAAKmC,IAAI,GAAKnC,KAAK+E,IAAI,EAAGu/D,GACzC,CACIlyD,GAASd,UAAY,IACvBf,GAAa,KAGf6B,GAASzP,GAAK,EACV4C,GAAMJ,OACRiN,GAASzP,IAAM4N,EACf6B,GAASxU,QAAU,GAEjB2H,GAAMF,QACR+M,GAASzP,IAAM4N,EACf6B,GAASxU,OAAS,GAGpB,MAAM2mE,EAAUnyD,GAASd,WAAa,EAClCc,GAASnC,UAAYs0D,GAAWh/D,GAAME,OAAS2M,GAASpE,YAAcoE,GAASS,YACjFT,GAASvP,IxE9KI,IwE+KbuP,GAASnC,UAAW,GAGtBmC,GAASvP,IAAM0K,GAAUiO,CAC3B,CAEA,MAAMqoC,EAAYzxC,GAAS/U,EAC3B+U,GAAS/W,GAAK+W,GAASzP,GAAK6Y,EAC5BpJ,GAAS/U,GAAK+U,GAASvP,GAAK2Y,EAC5BpJ,GAASnC,UAAW,EAEpB,MAAMiC,EAAiBhD,GAAe,GAAM1B,UACrBo2C,GAAuBxxC,GAAUyxC,EAAW3xC,IAGnDE,GAAS/U,EAAI6U,GACdtX,IACXwX,GAAS/U,EAAIzC,EAAWsX,EACxBE,GAASvP,GAAK,EACduP,GAASnC,UAAW,GAIxBmwD,IACF,CAkOMoE,CAAkBhpD,GAlNxB,SAA0BA,GACxB,MAAMtJ,EAAiBhD,GAAe,GAAM1B,UAmB5C,GAlBA4E,GAASE,UAAY,KACrBF,GAASC,YAAc,SACvBD,GAASG,mBAAqB,KAC9BH,GAASmB,UAAYvT,KAAKmC,IAAI,EAAGiQ,GAASmB,UAAYiI,GACtDpJ,GAASzP,IAAM,GACfyP,GAASvP,IAAM0K,GAAUiO,EACzBpJ,GAAS/W,GAAK+W,GAASzP,GAAK6Y,EAC5BpJ,GAAS/U,GAAK+U,GAASvP,GAAK2Y,EAEdpJ,GAAS/U,EAAI6U,GACdtX,IACXwX,GAAS/U,EAAIzC,EAAWsX,EACxBE,GAASvP,GAAK,EACduP,GAASnC,UAAW,GAGtBmwD,KAE2B,IAAvBhuD,GAASmB,UAAiB,CAC5BnB,GAAS5B,OAAS4B,GAAS3B,UAC3B2B,GAAShB,gBAAkB,IAC3BgB,GAASoB,cAAgB,EACzBpB,GAASqB,eAAiB,EAC1BrB,GAASsB,WAAY,EACrBtB,GAASd,UAAY,EACrBc,GAASuB,gBAAkB,EAC3BvB,GAASb,eAAiB,EAC1Ba,GAASZ,kBAAoB,E9C1F/B+kB,GAAQ5iC,OAAS,EEAjBukC,GAAiB,WD3DjBN,K6CuJE,MAAM9yB,EAAW,KACjBsN,GAAS/W,EAAe,GAAXyJ,EACbsN,GAAS/U,EAAIzC,EAAWsX,EACxBE,GAASzP,GAAK,EACdyP,GAASvP,GAAK,EACduP,GAASnC,UAAW,CACtB,CACF,CA+KIw0D,CAAiBjpD,GAGnBpJ,GAASQ,YN3aLR,GAASnE,QACJ,GAAMA,QAEXmE,GAASpE,UACJ,GAAMA,UAER,GAAMR,SMsab,MAAM+qB,EAAarpB,GAAekD,GAASQ,aAK3C0Y,GAAkB,CAChB5B,YAAa,EAJWvV,KAAmBxgB,OAK3CirB,WAJmBrd,GAAQwb,OAAO,CAAC3oB,EAAOygB,IAAUzgB,GAASygB,EAAMrE,OAAS,EAAI,EAAI,GAAI,GAKxFmZ,YAJmB9V,GAAWkJ,OAAO,CAAC3oB,EAAOuhB,IAASvhB,GAASuhB,GAAuB,aAAfA,EAAKzF,MAAuB,EAAI,GAAI,KAO7G,MAAMw0D,EAAsC,oBAAhBj8D,YAA8BA,YAAYC,MAAQC,KAAKD,OTmErF,SAAwB8S,GACtB,IAAK,MAAM2U,KAAWW,GAAU,CAC9B,MAAMl3B,EAAamyB,GAAoBoE,EAAQ7yB,MAC/C,IAAK1D,EACH,SAGFu2B,EAAQG,cAAgBtwB,KAAKmC,IAAI,EAAGguB,EAAQG,cAAgB9U,GAC5D2U,EAAQI,YAAcvwB,KAAKmC,IAAI,EAAGguB,EAAQI,YAAc/U,GAExD,MAAM+sC,EAAep4B,EAAQE,WAAai3B,GACpCr7B,EAAeryB,EAAWqyB,cAAgB,SAE3B,QAAjBA,EACFu9B,GAAiBr5B,EAASv2B,EAAY4hB,EAAO+sC,GACnB,UAAjBt8B,EACT88B,GAAmB54B,EAASv2B,EAAY4hB,EAAO+sC,GAE/CD,GAAoBn4B,EAASv2B,EAAY4hB,EAAO+sC,GAGlD4B,GAA+Bh6B,EAASv2B,EAAY4hB,EAAO+sC,GAEvDA,EACFZ,GAAwBx3B,EAASv2B,GACP,WAAjBqyB,IACTkE,EAAQC,OAAS,EAAID,EAAQC,MAAQpwB,KAAK+E,IAAI,EAAW,GAARyW,GAErD,CACF,CS/FEmpD,CAAenpD,GACfq0B,GAAkBr0B,G/BvNpB,SAA6BA,GAC3B,IAAK,MAAMinB,KAAgBzhC,GACzByhC,EAAaxxB,WAAajR,KAAKmC,IAAI,GAAIsgC,EAAaxxB,YAAc,GAAKuK,GACvEinB,EAAavxB,WAAalR,KAAKmC,IAAI,GAAIsgC,EAAavxB,YAAc,GAAKsK,GACvEinB,EAAaE,WAAa3iC,KAAKmC,IAAI,GAAIsgC,EAAaE,YAAc,GAAKnnB,GACvEinB,EAAatxB,gBAAkBsxB,EAAavxB,WAAa,EAAI,IAAO,GAChEuxB,EAAaC,UACfD,EAAaG,YAAc5iC,KAAK+E,IAAI,GAAI09B,EAAaG,aAAe,GAAa,IAARpnB,GAEzEinB,EAAaG,YAAc5iC,KAAKmC,IAAI,GAAIsgC,EAAaG,aAAe,GAAa,GAARpnB,EAG/E,C+B4MEopD,CAAoBppD,GL9MtB,SAA6BA,GAC3B,KAAIA,GAAS,GAGb,IAAK,MAAMwkC,KAAgB/+C,GACzB+yD,GAAmBhU,EAAcxkC,EAErC,CKwMEqpD,CAAoBrpD,GD4NtB,SAA6BA,EAAOwP,GAClC,MAAM9a,EAAQia,KACd00C,KACApD,KAEA,MACMqJ,EAAqB9kE,KAAK+E,IvDhqBb,KuDgqB+B,KAC5CggE,EAAkB70D,EAAMwK,QvDjqBX,KuDiqBoCoqD,EAOvD,IANmB50D,EAAMwK,SAAWxK,EAAMiZ,SAAWjC,QAAQhX,EAAM4a,mBACjDE,EAAY9a,EAAM8Y,WAAa+7C,IAAoB70D,EAAM+Y,WACzE8B,GAAqBC,GACrB4xC,GAAgB,CAAEf,QAAS3rD,EAAMwK,WAG9BxK,EAAMwK,QAAX,CAUA,GAAIxK,EAAMiZ,QAAS,CACjB,MAAM67C,EvDlrBa,KuDmrBfh6C,EAAY9a,EAAMmZ,sBAAwB27C,GAC5CzK,IAEJ,CACAsE,IARA,MAPE,GAAI3uD,EAAMiZ,QAAS,CACjB,MAAM67C,EvDzqBW,KuD0qBbh6C,EAAY9a,EAAMmZ,sBAAwB27C,GAC5CzK,IAEJ,CAWJ,CCzPE0K,CAAoBzpD,EAAOkpD,GzD5T7B,WAGE,Gb8DF,SAA4BQ,EAAW,KACrC,MAAMx8D,EAA6B,oBAAhBD,YAA8BA,YAAYC,MAAQC,KAAKD,MAC1E,IAAK,MAAOxU,EAAIkN,KAAW,GAAcotC,UACnC9lC,GAAOtH,EAAOwG,YAAcc,GAAOw8D,GACrC,GAAc1gE,OAAOtQ,EAG3B,CavEEixE,GACAj9C,MACKN,IAAkD,SAA/BA,GAAgBw9C,WACtC,OAEF,MAAM18D,EAA8B,oBAAhBD,YAA8BA,YAAYC,MAAQC,KAAKD,MAC3E,GAAIA,EAAMof,GAAe,GACvB,OAEFA,GAAepf,EACf,MAAMyR,EAAU,CACd7c,KAAM,cACNpJ,GAAIwzB,GACJrnB,KAAM,SACNhF,EAAG+W,GAAS/W,EACZgC,EAAG+U,GAAS/U,EACZO,OAAQwU,GAASxU,OACjBsW,UAAW9B,GAASK,gBAEtB,IACEmV,GAAgBy9C,KAAK9tE,KAAKC,UAAU2iB,GACtC,CAAE,MAEF,CACF,CyDoSEmrD,GV7QF,SAA0B9pD,GACxBpJ,GAASM,qBAAuB1S,KAAKmC,IAAI,EAAGiQ,GAASM,qBAAuB8I,GAC5E,IAAIvJ,EAAY,EAChB,IAAK,MAAMk1C,KAAatzC,GACtBszC,EAAUl1C,UAAYA,EACtBA,GAAa,EACbi1C,GAAgBC,EAAW3rC,EAE/B,CUsQE+pD,CAAiB/pD,GACjB,IAAK,MAAM7F,KAAQ9B,GACZ8B,IAGLA,EAAK5D,qBAAuB/R,KAAKmC,IAAI,GAAIwT,EAAK5D,sBAAwB,GAAKyJ,GACvE7F,EAAK5D,sBAAwB,IAC/B4D,EAAK3D,wBAA0B,IAGnC6xD,EAAgBtc,KAChBuc,EAAY58C,QAAQ28C,GAChBC,IACF1xD,GAASC,YAAc,WAGzB4/B,GAAgBz2B,GAEXyoD,IACH7xD,GAASS,WAAY,EACrBT,GAASW,cAAgB,KACzBX,GAASY,cAAgB,EACzBZ,GAASc,iBAAkB,EAC3Bd,GAASe,iBAAmB,EAC5Bf,GAASgB,kBAAmB,EAC5BhB,GAASiB,eAAgB,EACzBjB,GAASU,aAAe,EACxBV,GAASkB,eAAe3f,OAAS,GAGnCye,GAASR,aAAe5R,KAAKmC,IAAI,GAAIiQ,GAASR,cAAgB,GAAK4J,GAEnE,MAAM1C,EAASZ,KACTstD,EAAiB1sD,GAAQ1P,UAAY,GAErCq8D,GADc3sD,GAAQzP,aAAe,IACT1V,OAAS,EACrC+xE,EAAiBF,EAAex9B,WAAW,UAC3C29B,EAAuC,cAAnBH,EAG1B,GAF0C,WAAnBA,GAGjBtB,GAAmBC,IACrB9rC,GAAavf,GAEf1G,GAASkB,eAAe3f,OAAS,OAC5B,GAAIgyE,GACLzB,GAAmBC,I1B5d3B,WACE,MAAMrrD,EAASZ,KACf,IAAK9F,GAASd,WAAa,GAAK,EAC9B,OAAO,EAET,IAAKwH,GAA8B,cAApBA,EAAO1P,SACpB,OAAO,EAET,GAAIgJ,GAASoB,cAAgB,GAAKpB,GAAS5B,QAAU,GAAK4B,GAASnE,QACjE,OAAO,EAGT,MAAMgX,EAASnM,EAAO3N,WAAa,CAAC,EAC9BuG,EAAMU,GAASV,KAAO,KACtBk1C,EAAUrkD,OAAOC,SAASkP,GAAK/C,SAAW+C,EAAI/C,QAAWyD,GAASxU,QAAU,EAC5EipD,EAAUtkD,OAAOC,SAASkP,GAAK9C,SAAW8C,EAAI9C,QAAU,EACxDwmD,EAAap1D,KAAKs3B,MAAMsvB,EAASC,IAAY,EAC7CjP,EAAOgP,EAAUwO,EACjBvd,EAAOgP,EAAUuO,EACjBrO,GAASlP,EACTmP,EAAQpP,EAER9oC,EAAUvM,OAAOC,SAASkP,GAAK5C,SAAW4C,EAAI5C,QAAUsD,GAAS/W,EACjE0T,EAAUxM,OAAOC,SAASkP,GAAK3C,SAAW2C,EAAI3C,QAAUqD,GAAS/U,EAAI,GACrEqP,EAAcuY,EAAOvY,aAAe,CAAErR,EAAG,GAAIgC,EAAG,IAChDuoE,EAAgBl5D,EAAYrR,GAAK,GACjCwqE,EAAiBn5D,EAAYrP,GAAK,GAClC4pD,EAAgBv6C,EAAYsI,MAAQ,EAGpC3F,EAAS,GAAMP,EAAU8oC,EAAOguB,EAAgB7e,EAAQE,EAAe,GAD5D,KAC2E,IACtFx3C,EAASV,EAAU8oC,EAAO+tB,EAAgB5e,EAAQC,EAAgB4e,EAElEz8B,EAAMnkB,EAAO3Z,aAAe,CAAE3I,GAAI,IAAKE,IAAK,KAC5CijE,EAAe18B,EAAIzmC,IAAM,IACzBojE,EAAgB38B,EAAIvmC,KAAO,IAC3BF,EAAKi1C,EAAOkuB,EAAe/e,GAAS3d,EAAIp0B,MAAQ,GAChDnS,EAAKg1C,EAAOiuB,EAAe9e,GAAS5d,EAAIp0B,MAAQ,GAAK+wD,EAE3D3zD,GAASoB,cAAgByR,EAAOzZ,iBAAmB,GAEnD,MAAMq/B,EAAU,CACd32C,GAAI,WAAWyU,KAAKD,SAAS1I,KAAK4C,SAAStM,SAAS,IAAI0Z,MAAM,EAAG,KACjE3U,EAAGgU,EACHhS,EACAsF,KACAE,KACAvG,OAAQ2oB,EAAO3oB,QAAU,GACzB0uC,KAAM/lB,EAAO7Z,aAAe,IAC5BunD,QAAS1tC,EAAO7Z,aAAe,IAC/BC,gBAAiB4Z,EAAO5Z,iBAAmB,IAC3CzB,OAAQqb,EAAOrb,QAAU,GACzBC,UAAWob,EAAOpb,WAAa,IAC/BW,cAAeya,EAAOza,eAAiB,GACvCe,WAAY,GAAM0Z,EAAO1Z,YAAc,IAAM,EAAG,KAChDvN,MAAOinB,EAAOjnB,OAAS,UACvByN,kBAAmBwZ,EAAOxZ,mBAAqB,IAC/CC,gBAAiB,GAAMuZ,EAAOvZ,iBAAmB,IAAM,EAAG,GAC1DC,mBAAoB,GAAMsZ,EAAOtZ,oBAAsB,GAAK,EAAG,GAC/DC,WAAYqZ,EAAOrZ,YAAc,YACjCE,aAAcmZ,EAAOnZ,cAAgB,EACrCC,mBAAoBkZ,EAAOlZ,oBAAsB,EACjDE,cAAegZ,EAAOhZ,eAAiB,EACvCC,YAAa+Y,EAAO/Y,aAAgB+Y,EAAO5Z,iBAAmB,IAC9Dc,eAAgB8Y,EAAO9Y,gBAAkB,IACzCC,oBAAqB,GAAM6Y,EAAO7Y,qBAAuB,IAAM,GAAK,GACpEC,kBAAmB4Y,EAAO5Y,mBAAqB,GAC/Cy+B,WAAW,EACXC,eAAgB,GAGlBN,GAAWv1C,KAAK21C,GAChBF,GAAuB,mBAAoB,CACzCz2C,GAAI22C,EAAQ32C,GACZ0X,WAAYi/B,EAAQj/B,WACpBvQ,EAAGwvC,EAAQxvC,EACXgC,EAAGwtC,EAAQxtC,EACXf,OAAQuuC,EAAQx/B,gBAChB2/B,KAAMH,EAAQG,MAIlB,C0B2YMg7B,GAEF5zD,GAASkB,eAAe3f,OAAS,OAC5B,GAAI+xE,IAAmBD,GAE5B,GADArzD,GAASkB,eAAe3f,OAAS,EAC7BmlB,EAAQ,CACV,MAAMR,EAAaX,GAAcmB,EAAO5kB,IAClC+V,EAAejK,KAAKmC,IAAI2W,EAAO7O,cAAgB,IAAM,KAErDg8D,GAD6B,IAAhBntD,EAAO5O,MACK3E,GAAMS,YAAci+D,EAC/CG,GACE,GAActrD,EAAO5kB,MACvBke,GAASS,WAAY,EACrBT,GAASW,cAAgB,KACzBX,GAASU,aAAe,IAGDoxD,GAAmB+B,IAAa7zD,GAASR,cAAgB,GAEpEqjD,OAEZ7iD,GAASR,aAAe3H,GAGxBqO,GAAcA,EAAW5N,UAAY,GAAK4N,EAAW3N,QAAU,IAAM2N,EAAW5E,WAClF,GAAcoF,EAAO5kB,GAEzB,OACK,GAAIuxE,EACLvB,GN1dR,WACE,GAAI9xD,GAASE,UACX,OAEF,GAAIF,GAASnE,SAAWmE,GAAS5B,QAAU,IAAM4B,GAASd,WAAa,GAAK,GAAKc,GAASsB,UACxF,OAGF,MAAMoF,EAASZ,KACT7O,EAAcyP,GAAQzP,aAAe,GAChB,IAAvBA,EAAY1V,SAIXye,GAASS,UAKVT,GAASc,iBAAmBd,GAASU,YAAc,EAAIzJ,EAAY1V,SACrEye,GAASgB,kBAAmB,GAL5BigD,GAAY,GAOhB,CMqcM6S,GAGE9zD,GAASS,WNtcjB,SAAuB2I,EAAO2qD,GAC5B,GAAI/zD,GAASE,UAQX,OAPAF,GAASS,WAAY,EACrBT,GAASW,cAAgB,KACzBX,GAASY,cAAgB,EACzBZ,GAASc,iBAAkB,EAC3Bd,GAASe,iBAAmB,EAC5Bf,GAASiB,eAAgB,OACzBjB,GAASU,aAAe,GAG1B,MAAMwgD,EAASlhD,GAASW,cACxB,IAAKugD,EACH,OAEF,IAAKlhD,GAASd,WAAa,GAAK,GAAKc,GAASsB,UAO5C,OANAtB,GAASS,WAAY,EACrBT,GAASW,cAAgB,KACzBX,GAASY,cAAgB,EACzBZ,GAASc,iBAAkB,EAC3Bd,GAASe,iBAAmB,OAC5Bf,GAASiB,eAAgB,GAI3BjB,GAASY,eAAiBwI,GAErBpJ,GAASiB,eAAiBjB,GAASY,eAAiBsgD,EAAOhqD,SAC9D68D,EAAc7S,GACdlhD,GAASiB,eAAgB,IAGtBjB,GAASc,iBAAmBd,GAASY,eAAiBsgD,EAAO9pD,aAChE4I,GAASc,iBAAkB,EAC3Bd,GAASe,iBAAmBmgD,EAAO7pD,aAGjC2I,GAASc,kBACXd,GAASe,kBAAoBqI,EACzBpJ,GAASe,kBAAoB,IAC/Bf,GAASc,iBAAkB,IAI/B,MAAM4F,EAASZ,KACT7O,EAAcyP,GAAQzP,aAAe,GAE3C,GAAI+I,GAASY,eAAiBsgD,EAAOhqD,OAASgqD,EAAO3rD,OAAS2rD,EAAO/pD,SAAU,CAC7E,MAAMwX,EAAY3O,GAASU,YAAc,EACnCszD,EAAch0D,GAASgB,kBAAoB2N,EAAY1X,EAAY1V,OAEzEye,GAASS,WAAY,EACrBT,GAASW,cAAgB,KACzBX,GAASY,cAAgB,EACzBZ,GAASc,iBAAkB,EAC3Bd,GAASe,iBAAmB,EAC5Bf,GAASiB,eAAgB,EACzBjB,GAASgB,kBAAmB,EAExBgzD,EACF/S,GAAYtyC,GAEZ3O,GAASU,aAAe,CAE5B,CACF,CMsYMuzD,CAAc7qD,EAAOu5C,IJzf3B,SAAwBv5C,EAAO+c,GAC7BnmB,GAASkB,eAAiBlB,GAASkB,eAAesB,OAAQgxB,IACxDA,EAAOpJ,WAAahhB,EACpBoqB,EAAOovB,YAAc5iD,GAASxU,OAC9BgoC,EAAOvqC,EAAI+W,GAAS/W,EAAI+W,GAASxU,OAASgoC,EAAOtgC,QACjDsgC,EAAOvoC,EAAI+U,GAAS/U,EAAIk7B,EAAaqN,EAAOj8B,aACrCi8B,EAAOpJ,UAAY,GAE9B,CIofI8pC,CAAe9qD,EAAO+c,GJlf1B,WACE,IAAK,MAAMqN,KAAUxzB,GAASkB,eAAgB,CAC5C,GAAIjS,GAAcmP,OAAS,IAAMo1B,EAAOC,WAAW5wB,IAAI5T,GAAcnN,IAAK,CACxE,MAAM8iC,EAAK4O,EAAOvqC,EAAIgG,GAAchG,EAC9B47B,EAAK2O,EAAOvoC,GAAKgE,GAAchE,EAA2B,IAAvBgE,GAAcxG,QACtCmF,KAAKs3B,MAAMN,EAAIC,IAChB2O,EAAOtpC,OAAS+E,GAAc/E,SAC5CspC,EAAOC,WAAWvhC,IAAIjD,GAAcnN,IACpC+rC,GAAmB,CACjBr2B,OAAQg8B,EAAOh8B,OACfC,UAAW+7B,EAAO/7B,UAClBC,OAAQ87B,EAAO97B,OACflM,OAAQgoC,EAAOovB,cAGrB,CAEA,IAAK,MAAMngD,KAAStT,GAAS,CAC3B,GAAIsT,EAAMrE,QAAU,GAAKo1B,EAAOC,WAAW5wB,IAAIJ,EAAM3gB,IACnD,SAEF,MAAM8iC,EAAK4O,EAAOvqC,EAAIwZ,EAAMxZ,EACtB47B,EAAK2O,EAAOvoC,GAAKwX,EAAMxX,EAAmB,GAAfwX,EAAMha,QACtBmF,KAAKs3B,MAAMN,EAAIC,IAChB2O,EAAOtpC,OAASuY,EAAMvY,SACpCspC,EAAOC,WAAWvhC,IAAIuQ,EAAM3gB,IAC5BksC,GAAmBvrB,EAAO,CACxBjL,OAAQg8B,EAAOh8B,OACfC,UAAW+7B,EAAO/7B,UAClBC,OAAQ87B,EAAO97B,OACflM,OAAQgoC,EAAOovB,cAGrB,CAEArvB,GAAsBC,GACtBivB,GAAkCjvB,EACpC,CACF,CI6cI2gC,QAGA,GADAn0D,GAASkB,eAAe3f,OAAS,EAC7B+xE,EAAgB,CAClB,MAAMz7D,EAAejK,KAAKmC,IAAI2W,GAAQ7O,cAAgB,IAAM,KAEtDg8D,GAD8B,IAAjBntD,GAAQ5O,MACI3E,GAAMS,YAAci+D,GACxBC,GAAmB+B,IAAa7zD,GAASR,cAAgB,GAEpEqjD,OAEZ7iD,GAASR,aAAe3H,EAG9B,C3ElhBJ,IAA0B5O,I2EqhBP+W,GAAS/W,E3EphB1BoJ,GAAYC,QAAUE,GAAavJ,GAarC,SAAsBmgB,GACpB,MAAMrjB,EAASyM,GAAaH,GAAYC,SAElCkd,EAAI5hB,KAAK+E,IAAI,EADD,EACIyW,GACtB/W,GAAYpJ,IAAMlD,EAASsM,GAAYpJ,GAAKumB,EAC5Cnd,GAAYpJ,EAAIuJ,GAAaH,GAAYpJ,EAC3C,C2EkgBEmrE,CAAahrD,GEziBf,SAA6BA,GACvBna,GAAc4P,WAAa,IAC7B5P,GAAc4P,WAAajR,KAAKmC,IAAI,EAAGd,GAAc4P,WAAauK,IAGhEna,GAAc6P,WAAa,IAC7B7P,GAAc6P,WAAalR,KAAKmC,IAAI,EAAGd,GAAc6P,WAAasK,IAGpEna,GAAc8P,eAAiBnR,KAAKmC,IAAI,EAAGd,GAAc8P,eAAyB,GAARqK,GAEtEna,GAAcmP,QAAU,IAC1BnP,GAAcgQ,aAAerR,KAAKmC,IAAI,EAAGd,GAAcgQ,aAAemK,GACnC,IAA/Bna,GAAcgQ,eAChBhQ,GAAcmP,OAASnP,GAAcoP,UACrCpP,GAAc4P,WAAa,EAC3B5P,GAAc6P,WAAa,EAC3B7P,GAAc8P,eAAiB,GAGrC,CFuhBEs1D,CAAoBjrD,G1BrPtB,SAA0BA,GACxB,MAAM1W,EAAW,KAEjB,IAAK,MAAM+lC,KAAWJ,GACfI,EAAQC,UA0BXD,EAAQE,gBAAkBvvB,GAzB1BqvB,EAAQG,MAAQxvB,EAChBqvB,EAAQhoC,IAAM0K,GAAUs9B,EAAQrgC,cAAgBgR,EAChDqvB,EAAQxvC,GAAKwvC,EAAQloC,GAAK6Y,EAC1BqvB,EAAQxtC,GAAKwtC,EAAQhoC,GAAK2Y,EAEtBqvB,EAAQxtC,EAAIwtC,EAAQvuC,QAAU1B,IAChCiwC,EAAQxtC,EAAIzC,EAAWiwC,EAAQvuC,OAC3BuuC,EAAQhoC,GAAK,IACfgoC,EAAQhoC,IAAMgoC,EAAQhoC,GAAKgoC,EAAQt/B,YAErCs/B,EAAQloC,IAAM,GACV3C,KAAK0xC,IAAI7G,EAAQhoC,IAAM,KACzBgoC,EAAQhoC,GAAK,KAIbgoC,EAAQxvC,EAAIwvC,EAAQvuC,QAAU,GAAKuuC,EAAQxvC,EAAIwvC,EAAQvuC,QAAUwI,KACnE+lC,EAAQxvC,EAAI,GAAMwvC,EAAQxvC,EAAGwvC,EAAQvuC,OAAQwI,EAAW+lC,EAAQvuC,QAChEuuC,EAAQloC,GAAmB,KAAbkoC,EAAQloC,IAGpBkoC,EAAQG,MAAQ,GAClBJ,GAASC,IAOf,IAAK,IAAIn3C,EAAI+2C,GAAW92C,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAC3C+2C,GAAW/2C,GAAGo3C,WAAaL,GAAW/2C,GAAGq3C,gBAAkB,GAC7DN,GAAWx1C,OAAOvB,EAAG,IAjF3B,SAA2B8nB,GACzB,IAAK,MAAM2vB,KAAST,GAAa,CAC/BS,EAAM/X,KAAOpzB,KAAKmC,IAAI,EAAGgpC,EAAM/X,KAAO5X,GACtC,MAAM+gB,EAAW,EAAI4O,EAAM/X,KAAO+X,EAAM3+B,SAGxC,GAFA2+B,EAAM7uC,OAAS,GAAM6uC,EAAMC,YAAcD,EAAM7U,UAAY6U,EAAMC,YAAc,GAAM7O,EAAU,EAAG,GAAI4O,EAAMC,WAAYD,EAAM7U,WAC9H6U,EAAMI,WAAa/vB,EACf2vB,EAAMI,WAAa,EAAG,CACxBJ,EAAMI,UAAYJ,EAAMG,KACxB,MAAMo7B,EAAkBv7B,EAAM7uC,OAC9B,IAAK,MAAMuY,KAAStT,GAAS,CAC3B,GAAIsT,EAAMrE,QAAU,EAClB,SAEF,MAAMwmB,EAAKniB,EAAMxZ,EAAI8vC,EAAM9vC,EACrB47B,EAAMpiB,EAAMxX,EAAmB,GAAfwX,EAAMha,OAAgBswC,EAAM9tC,EAC9C2C,KAAKs3B,MAAMN,EAAIC,IAAOyvC,IACxB7xD,EAAMtD,eAAiBvR,KAAKmC,IAAI0S,EAAMtD,gBAAkB,EAAG45B,EAAMG,KAAO,IACxEz2B,EAAMrD,kBAAoBxR,KAAK+E,IAAI8P,EAAMrD,mBAAqB,EAAG25B,EAAME,gBAE3E,CACA,MACMjH,EAAel1B,GADRkD,GAASQ,aAAe,CAAEnF,WAAY,GAAIC,WAAY,GAAIC,UAAW,KAE5E02B,EAAgBjyB,GAAS/U,EAAmB,GAAf+mC,EAC7BuiC,EAAMv0D,GAAS/W,EAAI8vC,EAAM9vC,EACzBurE,EAAMviC,EAAgB8G,EAAM9tC,EAC9B2C,KAAKs3B,MAAMqvC,EAAKC,IAAQF,IAC1Bt0D,GAASb,eAAiBvR,KAAKmC,IAAIiQ,GAASb,gBAAkB,EAAG45B,EAAMG,KAAO,IAC9El5B,GAASZ,kBAAoBxR,KAAK+E,IAAIqN,GAASZ,mBAAqB,EAAG25B,EAAME,eAAiB,IAElG,CACF,CAEA,IAAK,IAAI33C,EAAIg3C,GAAY/2C,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAChD,GAAIg3C,GAAYh3C,GAAG0/B,MAAQ,EAAG,CAC5B,MAAMyzC,EAAan8B,GAAYz1C,OAAOvB,EAAG,GAAG,GAC5Ci3C,GAAuB,4BAA6B,CAClDz2C,GAAI2yE,EAAW3yE,GACfmH,EAAGwrE,EAAWxrE,EACdgC,EAAGwpE,EAAWxpE,EACdf,OAAQuqE,EAAWvwC,WAAauwC,EAAWvqE,QAE/C,CAEJ,CA0CEwqE,CAAkBtrD,EACpB,C0B6MEurD,CAAiBvrD,G3C3gBnB,SAAuBA,IHiFvB,SAAuBA,GACrB,IAAK,MAAMib,KAAUF,GAAS,CAC5BE,EAAOjqB,UAAYgP,EACnBib,EAAOe,WAAahc,EACpB,MAAMrjB,EAASq+B,GAAcC,GACzBt+B,GAAUs+B,EAAOe,WAAa,GAChCL,GAAWV,EAAQt+B,EAEvB,CACA,IAAK,IAAIzE,EAAI6iC,GAAQ5iC,OAAS,EAAGD,GAAK,EAAGA,GAAK,EACxC6iC,GAAQ7iC,GAAG8Y,UAAY,GACzB+pB,GAAQthC,OAAOvB,EAAG,EAGxB,CG9FEszE,CAAcxrD,GDWhB,SAAsBA,GACfqc,GAAYlwB,SAGjBkwB,GAAYrrB,UAAYgP,EACxBqc,GAAY5mB,WAAajR,KAAKmC,IAAI,EAAG01B,GAAY5mB,WAAauK,GAC1Dqc,GAAYrrB,UAAY,EAC1B0rB,GAAiB,WACRL,GAAYzqB,UAAY,IAEjC6qB,GAAoB,iBAAkB,CACpCE,OAAQ,UACR7C,OAHa0C,KAIbF,YAAaD,GAAYC,YACzBx7B,OAAQu7B,GAAYv7B,SAEtB47B,GAAiB,YAErB,CC5BE+uC,CAAazrD,EACf,C2CygBE0rD,CAAc1rD,G3CvgBhB,SAA8BA,IF2D9B,SAA4BA,GACtBic,GAAatT,SAAW,IAC1BsT,GAAatT,SAAWnkB,KAAKmC,IAAI,EAAGs1B,GAAatT,SAAW3I,IAjDhE,SAAuBA,GACrB,IAAKic,GAAa9vB,OAChB,OAGF,MAAMqF,EAAcyqB,GAAazqB,aAAe,IAC1CC,EAAYwqB,GAAaxqB,WAAa,IACtCk6D,GAAiB1vC,GAAaE,WAAa1qB,EAAYD,GAAewO,EAE5E,GAAKic,GAAaE,WAMX,CACLF,GAAajrB,UAAYgP,EACzB,MAAMwb,EAAKS,GAAa/yB,QAAU0N,GAAS/W,EACrC47B,EAAKQ,GAAazoB,QAAUoD,GAAS/U,EACrCg6B,EAAWr3B,KAAKs3B,MAAMN,EAAIC,GAEhC,GAAII,EAAW,GAAI,CACjB,MAAMvX,EAAO9f,KAAK+E,IAAIsyB,EAAUpqB,EAAYuO,GAC5CpJ,GAASzP,GAAMq0B,EAAKK,EAAYvX,EAAOtE,EACvCpJ,GAASvP,GAAMo0B,EAAKI,EAAYvX,EAAOtE,EACvCpJ,GAAS/W,GAAM27B,EAAKK,EAAYvX,EAChC1N,GAAS/U,GAAM45B,EAAKI,EAAYvX,CAClC,CAEA2X,GAAaC,aAAe13B,KAAKmC,IAAI,EAAGs1B,GAAaC,aAAeyvC,IAChE1vC,GAAajrB,UAAY,GAAKirB,GAAaC,cAAgB,IAC7DE,IAEJ,MAvBEH,GAAaC,cAAgByvC,EACzB1vC,GAAaC,cAAgBD,GAAa3qB,YAC5C2qB,GAAaC,aAAeD,GAAa3qB,UACzC2qB,GAAaE,YAAa,EAqBhC,CAiBEyvC,CAAc5rD,EAChB,CE/DE6rD,CAAmB7rD,EACrB,C2CsgBE8rD,CAAqB9rD,GpExZvB,SAA0BA,EAAO+rD,GAC/B,MAAMC,EAAmB,GACzB,IAAK,MAAOvwD,EAAUO,KAAUT,GAAUy3B,UAExC,GADY,GAAmBv3B,GAC/B,CAKA,GAAIO,EAAM9D,YACR8D,EAAME,YAAc1X,KAAKmC,IAAI,EAAGqV,EAAME,YAAc8D,GAChDhE,EAAME,aAAe,GAAG,CAC1B,GAAIF,EAAMF,WAAa/U,OAAOgV,kBAAmB,CAC/C,MAAMkwD,EAASjwD,EAAMF,SAAWE,EAAM9M,SACtC,GAAI+8D,EAAS,EAAG,CACd,MAAMC,EAAS1nE,KAAK+E,IAAI0iE,EAAQjwD,EAAM7M,SACtC6M,EAAM9M,UAAYg9D,EAClBlwD,EAAM7M,SAAW+8D,CACnB,CACF,CACAlwD,EAAM9D,WAAY,EAClB8D,EAAME,YAAc,EACpB8vD,EAAiBtyE,KAAK+hB,EACxB,CAGF,GAAIO,EAAMrN,QAAUqN,EAAMJ,UAAW,CACnC,MAAMjjB,EAAOqjB,EAAMJ,UAAUjjB,MAAQ,EAC/BoV,EAAWiO,EAAMJ,UAAU7N,UAAY,EAE3CiO,EAAMrN,OAAOsN,QADXlO,EAAW,EACUvJ,KAAKmC,IAAIhO,EAAMqjB,EAAMrN,OAAOsN,QAAUlO,EAAWiS,GAEjDxb,KAAKmC,IAAIhO,EAAMqjB,EAAMrN,OAAOsN,SAAWtjB,EAElE,CA3BA,MAFE4iB,GAAUvS,OAAOyS,GAgCrB,GAAIswD,EAAgB,CAClB,MAAM/vD,EAAQT,GAAU7c,IAAIqtE,GAC5Bn1D,GAASsB,UAAY8D,GAAO9D,YAAa,CAC3C,MACEtB,GAASsB,WAAY,EAGvB,GAAsB,oBAAXpb,OACT,IAAK,MAAM2e,KAAYuwD,EACrBlvE,OAAO0L,cAAc,IAAIC,YAAY,uBAAwB,CAAEC,OAAQ,CAAE+S,cAG/E,CoEwWE0wD,CAAiBnsD,EAAO1C,GAAQ5kB,IAAM,MZhiBxC,SAAsBsnB,GACpB,MAAMosD,EAAYpkB,GAAYx4C,OAAS,GACjC68D,EAAc7nE,KAAKmC,IAAI,EAAG,EAAIylE,EAAYpsD,GAChDgoC,GAAYC,gBAAkBokB,EAC9BrkB,GAAYE,cAAgBmkB,CAC9B,CY4hBEC,CAAatsD,GhDjiBf,SAA4BA,GAC1B,IAAK,MAAMusD,KAASz0C,GAClBy0C,EAAM30C,MAAQ5X,EACdusD,EAAM1sE,GAAK0sE,EAAMplE,GAAK6Y,EACtBusD,EAAM1qE,GAAK0qE,EAAMllE,GAAK2Y,EACtBusD,EAAMllE,IAAM,GAAK2Y,EAGnB,IAAK,IAAI9nB,EAAI4/B,GAAa3/B,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAC7C4/B,GAAa5/B,GAAG0/B,MAAQ,GAC1BE,GAAar+B,OAAOvB,EAAG,EAG7B,CgDqhBEs0E,CAAmBxsD,G/CtIrB,SAAyBA,GACvBga,KACA,IAAK,IAAI9hC,EAAI8/B,GAAU7/B,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CACjD,MAAMu0E,EAAIz0C,GAAU9/B,GAEpB,GADAu0E,EAAEnlE,KAAO0Y,EACLysD,EAAEnlE,KAAO,EAAG,CACd0wB,GAAUv+B,OAAOvB,EAAG,GACpB,QACF,CACA,MAAM0/B,EAAO,GAAM60C,EAAEnlE,IAAMmlE,EAAEjlE,OAAQ,EAAG,GACxCilE,EAAE5sE,GAAK4sE,EAAEtlE,GAAK6Y,EACdysD,EAAE5qE,GAAK4qE,EAAEplE,GAAK2Y,EACC,UAAXysD,EAAE3qE,MACJ2qE,EAAEplE,KAAOolE,EAAErzC,SAAW,KAAOpZ,EAC7BysD,EAAEtlE,IAAM,IACRslE,EAAEplE,IAAM,GACRolE,EAAE3rE,QAAU,KACQ,cAAX2rE,EAAE3qE,MACX2qE,EAAEtlE,IAAM,GACRslE,EAAEplE,IAAM,IACRolE,EAAE3rE,QAAU,MACQ,WAAX2rE,EAAE3qE,MACX2qE,EAAEtlE,IAAM,IACRslE,EAAEplE,IAAM,IACRolE,EAAE3rE,QAAU,IAAc,IAAP82B,GACC,UAAX60C,EAAE3qE,MACX2qE,EAAEtlE,IAAM,GACRslE,EAAEplE,GAAmB,IAAbolE,EAAEplE,IAAM,GAAW,GAAK2Y,EAChCysD,EAAE3rE,QAAU,KAAe,IAAP82B,GACA,UAAX60C,EAAE3qE,MACX2qE,EAAEtlE,IAAM,IACRslE,EAAEplE,IAAM,KACY,UAAXolE,EAAE3qE,MACX2qE,EAAEtlE,IAAM,IACRslE,EAAEplE,GAAmB,IAAbolE,EAAEplE,IAAM,GAAW,IAAM2Y,EACjCysD,EAAE3rE,QAAU,KACQ,WAAX2rE,EAAE3qE,MACX2qE,EAAEplE,IAAM,IAAM2Y,EACdysD,EAAEtlE,IAAM,IACRslE,EAAEplE,IAAM,GACRolE,EAAE3rE,QAAU,KACQ,SAAX2rE,EAAE3qE,MACX2qE,EAAEtlE,IAAM,IACRslE,EAAEplE,GAAmB,IAAbolE,EAAEplE,IAAM,GAAW,IAAM2Y,EACjCysD,EAAE3rE,QAAU,KACQ,UAAX2rE,EAAE3qE,MACX2qE,EAAEtlE,IAAM,GACRslE,EAAEplE,IAAM,GACRolE,EAAE3rE,QAAU,GAAa,IAAP82B,IAElB60C,EAAEtlE,IAAM,IACRslE,EAAEplE,IAAM,IAEZ,CAEA,IAAK,IAAInP,EAAI+/B,GAAM9/B,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CAC7C,MAAM2gC,EAAOZ,GAAM//B,GACnB2gC,EAAKvxB,KAAO0Y,EACR6Y,EAAKvxB,KAAO,GACd2wB,GAAMx+B,OAAOvB,EAAG,EAGpB,CACF,C+CwEEw0E,CAAgB1sD,G5BzPlB,SAAwBA,GACtB,KAEA,IAAK,MAAMnf,KAASirC,GAAiBjzB,SACnChY,EAAMsL,QAAS,GAxGnB,WACE,MAAMwgE,EAAUvsE,MAAMC,QAAQ2rC,IAA4BA,GAA2B,GACrF,IAAK,IAAI9zC,EAAI,EAAGA,EAAIy0E,EAAQx0E,OAAQD,GAAK,EAAG,CAC1C,MAAMw+C,EAASi2B,EAAQz0E,IAAM,CAAC,EAE9B+0C,GADWyJ,EAAOh+C,IAAM,aAAeR,EAChBw+C,EACzB,CACF,CAoGEk2B,GAlGF,WACE,MAAMC,EAAej2D,GAASxU,QAAU,EAClCg9B,EAAQxoB,GAASmB,WAAa,EAC9BuwD,EAAqC,YAAzB1xD,GAASC,YACrBi2D,EAAgB1tC,EAASkpC,EAAY,IAAO,GAAO,EAEzDr7B,GAAmB,oBAAqB,CACtCnrC,KAAM,OACNjC,EAAG+W,GAAS/W,EAAmB,GAAfgtE,EAChBhrE,EAAG+U,GAAS/U,EAAI,GAChBf,OAAQwnE,EAAY,IAAM,IAC1B/lE,UAAWuqE,EACXtqE,MAAO,UACP8B,UAAWuoE,GAAgB,EAAI,EAAIroE,KAAKC,GACxCF,IAAe,GAAVC,KAAKC,GACVC,QAAS,IACTjC,UAAW,GACXC,QAAS,KAGX2V,GAAWyB,QAAQ,CAACK,EAAMjgB,KACxB,IAAKigB,GAAuB,aAAfA,EAAKzF,MAChB,OAEF,MAAMtS,EAAS+X,EAAK/X,QAAU,EAC9B6qC,GAAmB,qBAAuB9yB,EAAKzhB,IAAMwB,GAAQ,CAC3D4H,KAAM,OACNjC,EAAGsa,EAAKta,EAAa,GAATuC,EACZP,EAAGsY,EAAKtY,EAAI,GACZf,OAAQ,IACRyB,UAAW,GACXC,MAAO,UACP8B,UAAWlC,GAAU,EAAI,EAAIoC,KAAKC,GAClCF,IAAe,IAAVC,KAAKC,GACVC,QAAS,IACTjC,UAAW,GACXC,QAAS,OAGf,CA4DEqqE,GACA,MAAMC,EAAkB,KACxB,IAAK,IAAI90E,EAAI,EAAGA,EAAI80E,EAAgB70E,OAAQD,GAAK,EAAG,CAClD,MAAM0pD,EAAYorB,EAAgB90E,GAC5BgzC,EAAU0W,GAAW1W,QACtBA,GAGL+B,GAAmB,aAAa2U,EAAUlpD,KAAM,CAC9CoJ,KAAMopC,EAAQppC,MAAQ,QACtBjC,EAAG+hD,EAAU/hD,GAAKqrC,EAAQphC,SAAW,GACrCjI,EAAG+/C,EAAU//C,GAAK+/C,EAAUviD,QAAU,MAAQ6rC,EAAQ3+B,UAAY,IAClEzL,OAAQoqC,EAAQpqC,QAAU,IAC1ByB,UAAW2oC,EAAQ3oC,WAAa,GAChCC,MAAO0oC,EAAQ1oC,OAAS,UACxBC,UAAWyoC,EAAQzoC,WAAa,GAChCC,QAASwoC,EAAQxoC,SAAW,IAC5B6B,IAAK2mC,EAAQ3mC,IACbD,UAAW4mC,EAAQ5mC,UACnBI,QAASwmC,EAAQxmC,SAAW,IAEhC,CAEA,IAAK,MAAOhM,EAAImI,KAAUirC,GAAiBkH,UAAW,CACpD,IAAKnyC,EAAMsL,OAAQ,CACjB2/B,GAAiB9iC,OAAOtQ,GACxB,QACF,CACA,MAAM+J,EAAY,GAAM5B,EAAM4B,WAAa,GAAI,EAAG,IAC5CwqE,EAAO,GAAMjtD,EAAQvd,EAAW,EAAG,GACzC5B,EAAM0B,YAAc1B,EAAMssC,gBAAkBtsC,EAAM0B,WAAa0qE,EAC/DpsE,EAAM0B,UAAY2pC,GAAerrC,EAAM0B,WACnC1B,EAAM6B,QAAU,IAClB7B,EAAM0B,UAAY2pC,GAAerrC,EAAM0B,WAAaiC,KAAK4C,SAAW,IAAOvG,EAAM6B,SAErF,CAEA,IAAK,IAAIxK,EAAI6zC,GAAgB5zC,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAAG,CACvD,MAAM2I,EAAQkrC,GAAgB7zC,GAC9B2I,EAAMyG,KAAO0Y,EACTnf,EAAMyG,KAAO,GACfykC,GAAgBtyC,OAAOvB,EAAG,EAE9B,CACF,C4BsMEg1E,CAAeltD,GbzQjB,SAA2BA,GACzB,KACA8nC,GAAWzC,GAAerlC,GAC1B8nC,GAAWxC,GAActlC,GACzB8nC,GAAWvC,GAAiBvlC,GAC5B8nC,GAAWtC,GAASxlC,GACpB8nC,GAAWrC,GAAgBzlC,EAC7B,CamQEmtD,CAAkBntD,G3BtgBpB,SAA2BA,GACzB,IAAK,MAAMnR,KAAc0/B,GAAa,CAMpC,GALA1/B,EAAW+oB,MAAQ5X,EACnBnR,EAAWxH,IAAM0K,GAAUiO,EAAQnR,EAAWG,cAC9CH,EAAWhP,GAAKgP,EAAW1H,GAAK6Y,EAChCnR,EAAWhN,GAAKgN,EAAWxH,GAAK2Y,EAChCnR,EAAW2/B,cAAgBhqC,KAAKmC,IAAI,GAAIkI,EAAW2/B,eAAiB,GAAKxuB,GACrEnR,EAAW2/B,eAAiB,GAAK3/B,EAAW+oB,KAAO,EAAG,CACxD,MAAMw1C,EAAe5oE,KAAKmC,IAAI,GAAwB,GAApBkI,EAAW/N,QAC7CssC,GAAkB,CAChBtrC,KAAM,QACNjC,EAAGgP,EAAWhP,EACdgC,EAAGgN,EAAWhN,EACdf,OAAQssE,EACR7qE,UAAW,GAAsB,GAAhBiC,KAAK4C,SACtB5E,MAAOqM,EAAWrM,OAAS,UAC3B8E,IAAK,IACL5E,QAAS,IACT8M,MAAO,MAETX,EAAW2/B,cAAgB,GAC7B,CAEA,GAAI3/B,EAAWhN,EAAIgN,EAAW/N,QAAU1B,EACtCw6B,GAAgB,CACd/5B,EAAGgP,EAAWhP,EACdgC,EAAGzC,EAAW,EACdsH,OAAQlC,KAAKyC,MAAM,EAAwB,GAApB4H,EAAW/N,QAClCgO,MAAO,IAAgC,GAA1BtK,KAAK0xC,IAAIrnC,EAAW1H,MAEnC0H,EAAW+oB,KAAO,OAIpB,GAAI/xB,GAAcmP,OAAS,IAAMnG,EAAWw7B,WAAW5wB,IAAI5T,GAAcnN,KACnE+1C,GAAc5/B,EAAWhP,EAAGgP,EAAWhN,EAAGgN,EAAW/N,OAAQ+E,GAAchG,EAAGgG,GAAchE,EAA2B,IAAvBgE,GAAcxG,OAAewG,GAAc/E,QAC7I+N,EAAWw7B,WAAWvhC,IAAIjD,GAAcnN,IACxC+rC,GAAmB,CACjBr2B,OAAQS,EAAWT,OACnBC,UAAWQ,EAAWR,UACtBjM,OAAQyM,EAAWzM,SAErByM,EAAW+oB,KAAO,MARtB,CAaA,IAAK,MAAMve,KAAStT,GAClB,KAAIsT,EAAMrE,QAAU,GAAKnG,EAAWw7B,WAAW5wB,IAAIJ,EAAM3gB,MAGrD+1C,GAAc5/B,EAAWhP,EAAGgP,EAAWhN,EAAGgN,EAAW/N,OAAQuY,EAAMxZ,EAAGwZ,EAAMxX,EAAmB,GAAfwX,EAAMha,OAAcga,EAAMvY,QAAS,CACrH+N,EAAWw7B,WAAWvhC,IAAIuQ,EAAM3gB,IAChCksC,GAAmBvrB,EAAO,CACxBjL,OAAQS,EAAWT,OACnBC,UAAWQ,EAAWR,UACtBC,OAAQ,EACRlM,OAAQyM,EAAWzM,SAErByM,EAAW+oB,KAAO,EAClB,KACF,CAEE/oB,EAAW+oB,KAAO,GAChBsS,GAA0Br7B,KAC5B0qB,GAAkB,CAChB15B,EAAGgP,EAAWhP,EACdgC,EAAGgN,EAAWhN,EACd6E,OAAQlC,KAAKyC,MAAM,EAAoB,EAAhBzC,KAAK4C,UAC5B0H,MAAO,IAAgC,GAA1BtK,KAAK0xC,IAAIrnC,EAAW1H,IACjCwH,OAAkB,GAAVnK,KAAKC,GACbwO,MAAOzO,KAAK6yC,MAAMxoC,EAAWxH,GAAIwH,EAAW1H,IAAM3C,KAAKC,KAEzDoK,EAAW+oB,KAAO,EA5BtB,CAgCF,CAEA,IAAK,IAAI1/B,EAAIq2C,GAAYp2C,OAAS,EAAGD,GAAK,EAAGA,GAAK,EAC5Cq2C,GAAYr2C,GAAG0/B,MAAQ,GACzB2W,GAAY90C,OAAOvB,EAAG,EAG5B,C2BmbEm1E,CAAkBrtD,GjD1gBpB,SAAwBA,EAAOohC,GAC7B,IAAK,MAAMksB,KAASn2C,GAClBm2C,EAAM11C,MAAQ5X,EACdstD,EAAMjmE,IAAM0K,GAAUiO,EAAQ,GAC9BstD,EAAMztE,GAAKytE,EAAMnmE,GAAK6Y,EACtBstD,EAAMzrE,GAAKyrE,EAAMjmE,GAAK2Y,EACtBstD,EAAMnmE,IAAM,IAERmmE,EAAMzrE,EAAIyrE,EAAMxsE,QAAUsgD,IAC5BksB,EAAMzrE,EAAIu/C,EAAUksB,EAAMxsE,OAC1BwsE,EAAMjmE,GAAiB,KAAXimE,EAAMjmE,GAClBimE,EAAMnmE,IAAM,GACR3C,KAAK0xC,IAAIo3B,EAAMjmE,IAAM,KACvBimE,EAAMjmE,GAAK,IAKjB,IAAK,IAAInP,EAAIi/B,GAASh/B,OAAS,EAAGD,GAAK,EAAGA,GAAK,EACzCi/B,GAASj/B,GAAG0/B,MAAQ,KACtBT,GAAS19B,OAAOvB,EAAG,EAGzB,CiDofEq1E,CAAevtD,EAAO5gB,GF/XxB,SAAuB4gB,GACrB,IAAK,MAAM3G,KAAStT,GAClBk2D,GAAc5iD,EAAO2G,GAEvB,IAAK,MAAM3G,KAAStT,GAClBy2D,GAAmBnjD,EAEvB,CEyXEm0D,CAAcxtD,EAChB,CDkfsB,oBAAXljB,SACTA,OAAO2wE,cAAgB,CACrBrO,MAAOgC,GACPsM,KAAMhM,GACNvmE,KAAM6mE,GACN2L,KAAM5L,GACN6L,YAAanK,GACboK,YAAa/J,GACbgK,YAAa9J,GACb+J,UAAWvL,GACXwL,gBAAiB,IAAMxL,GAAc,CAAEH,iBAAiB,EAAMhC,QAAQ,IACtE4N,YAAa1K,GACb2K,aAAc1K,GACd2K,eAAgB/N,GAChBgO,iBAAkB7N,GAClB8N,eAAgBpO,GAChBvrD,MAAOia,KzE9tBLvhB,KAGJtQ,OAAOkwB,iBAAiB,UAAYvgB,GAAUY,IAAU,EAAMZ,IAC9D3P,OAAOkwB,iBAAiB,QAAUvgB,GAAUY,IAAU,EAAOZ,IAC7D3P,OAAOkwB,iBAAiB,YAzD1B,SAAyBvgB,GACvBD,GAAsBC,GACD,IAAjBA,EAAM6hE,QACRvkE,GAAMK,gBAAiB,EACvBL,GAAMS,YAAa,EACnBiC,EAAMe,kBACoB,IAAjBf,EAAM6hE,SACfvkE,GAAMM,eAAgB,EACtBN,GAAMU,WAAY,EAClBgC,EAAMe,iBAEV,GA+CE1Q,OAAOkwB,iBAAiB,UA7C1B,SAAuBvgB,GACrBD,GAAsBC,GACD,IAAjBA,EAAM6hE,QACRvkE,GAAMS,YAAa,EACnBiC,EAAMe,kBACoB,IAAjBf,EAAM6hE,SACfvkE,GAAMU,WAAY,EAClBgC,EAAMe,iBAEV,GAqCE1Q,OAAOkwB,iBAAiB,YA9R1B,SAA2BvgB,GACzBD,GAAsBC,EACxB,GA6RE3P,OAAOkwB,iBAAiB,aA3R1B,WACElhB,GAAQK,QAAS,CACnB,GA0RErP,OAAOkwB,iBAAiB,cAAgBvgB,GAAUA,EAAMe,kBACxD1Q,OAAOkwB,iBAAiB,OAAQvf,IAChCpB,KACAe,IAAc,GOjSV,KAGJtQ,OAAOkwB,iBAAiB,UAZ1B,SAAyBvgB,GACvB,MAAM2Q,GAXiB7P,EAWMd,EAAMc,MAV1Bi/B,WAAW,SACXzlC,OAAO8lC,SAASt/B,EAAKiH,MAAM,GAAI,IAEpCjH,EAAKi/B,WAAW,UACXzlC,OAAO8lC,SAASt/B,EAAKiH,MAAM,GAAI,IAEjCzN,OAAOwnE,IAPhB,IAAyBhhE,GAYlBxG,OAAO+lC,MAAM1vB,IAASA,GAAQ,IAfnCT,GAgBoBS,EAjBO,GAkBzB3Q,EAAMe,iBAEV,GAOE,IAAsB,GGqGlB,KDPN,WACE,GAA4B,oBAAjBkR,aAET,OADAP,MACO,EAET,IACE,MAAMoG,EAAM7F,aAAa8F,QAAQtH,IACjC,IAAKqH,EAEH,OADApG,MACO,EAET,MAAMsG,EAAS1oB,KAAK2nB,MAAMa,GAC1B,IAAKnkB,MAAMC,QAAQokB,GAEjB,OADAtG,MACO,EAET,MAAMuiD,EAAYj8C,EACfzpB,IAAKghB,IACJ,IAAKA,GAA0B,iBAAVA,EACnB,OAAO,KAET,MAAM+B,EAAS/B,EAAM+B,QAAU,KACzBtC,EAAqC,iBAAnBO,EAAMP,SAAwBO,EAAMP,SAAW,KACvE,OAAKsC,GAAWtC,EAGT,CAAEsC,SAAQtC,YAFR,OAIVrC,OAAOsS,SAGV,OApIsB8iD,EAkIL9N,EAjInB1iD,GAAcjB,GAAc/hB,IAAI,CAACoiB,EAAMljB,KACrC,MAAM8mE,EAAWwN,EAAenwD,KAAMrC,GAAUA,EAAM+B,SAAWX,EAAK1kB,IACtE,IAAI+iB,EAAWulD,GAAUvlD,UAAY,KACrC,MAAMkC,EAAUR,GAAyBC,GAIzC,OAHK3B,GAAakC,EAAQvC,SAASK,KACjCA,EAAWiC,GAAqBN,EAAMljB,IAEjC,CAAE6jB,OAAQX,EAAK1kB,GAAI+iB,cAE5B0C,KAyHEA,MACO,CACT,CAAE,MAAO7V,GAGP,OAFAC,QAAQsW,KAAK,+BAAgCvW,GAC7C6V,MACO,CACT,CAzIF,IAA0BqwD,CA0I1B,CC3BEC,GACAnwD,GAAa,CAAEC,kBAAkB,IACjCgB,KACAziB,OAAOkwB,iBAAiB,UAjE1B,SAAuBvgB,GACrB,GAAIA,EAAMiiE,iBACR,OAEF,MAAMnhE,EAAOd,EAAMc,KACnB,GAAK0R,GAAQC,QAAb,CASA,OAAQ3R,GACN,IAAK,SAGL,IAAK,OACL,IAAK,QA9DF0R,GAAQC,UAGbD,GAAQC,SAAU,EAClBzR,KACAqS,GAAW,OA2DP,MACF,IAAK,UACHC,IAAU,GACVD,GAAW,MACX,MACF,IAAK,YACHC,GAAS,GACTD,GAAW,MACX,MACF,IAAK,MACHC,GAAStT,EAAMkiE,UAAY,EAAI,GAC/B7uD,GAAW,MACX,MACF,IAAK,YACHG,IAAa,GACb,MACF,IAAK,aACHA,GAAY,GACZ,MACF,IAAK,OACHO,KACA,MACF,QACE,OAEJ/T,EAAMe,iBACNf,EAAMkU,iBAnCN,KANe,SAATpT,IA3DF0R,GAAQC,UAGZD,GAAQC,SAAU,EAClBK,KACAO,GAAW,MACXrS,MAuDIhB,EAAMe,iBACNf,EAAMkU,kBAuCZ,GAiBoD,GAClD7jB,OAAOkwB,iBAAiB,YAAatM,IAAoB,GACzD5jB,OAAOkwB,iBAAiB,UAAWtM,IAAoB,GACvD5jB,OAAOkwB,iBAAiB,cAAetM,IAAoB,GAC3D,IAAc,GGEV,KD9EN,WACE,GAA4B,oBAAjBhC,aAET,OADA0D,MACO,EAET,IACE,MAAMmC,EAAM7F,aAAa8F,QAAQ3C,IACjC,IAAK0C,EAEH,OADAnC,MACO,EAET,MAAMqC,EAAS1oB,KAAK2nB,MAAMa,GAC1B,IAAKE,GAA4B,iBAAXA,EAEpB,OADArC,MACO,EAET,MAAML,EAAa,IAAKN,IAKxB,OAJA,GAAoB3H,QAASlM,IAC3BmU,EAAWnU,EAASlV,IAAMwpB,GAAmBtU,EAASlV,GAAI+rB,EAAO7W,EAASlV,OAE5EopB,GAAcC,WAAaA,GACpB,CACT,CAAE,MAAOzZ,GAGP,OAFAC,QAAQsW,KAAK,2BAA4BvW,GACzC8Z,MACO,CACT,CACF,CCsDEwsD,GACA,KACA9xE,OAAOkwB,iBAAiB,UA3D1B,SAAuBvgB,GACrB,GAAIA,EAAMiiE,iBACR,OAEF,MAAMnhE,EAAOd,EAAMc,KACnB,GAAK,GAAQ2R,QAAb,CASA,OAAQ3R,GACN,IAAK,SACL,IAAK,QACL,IAAK,KAhEF,GAAQ2R,UAGb,GAAQA,SAAU,EAClBzR,KACA,GAAW,OA6DP,MACF,IAAK,UACHqV,IAAc,GACd,MACF,IAAK,YACHA,GAAa,GACb,MACF,IAAK,MACHA,GAAarW,EAAMkiE,UAAY,EAAI,GACnC,MACF,IAAK,YACH,IAAa,GACb,MACF,IAAK,aACH,GAAY,GACZ,MACF,IAAK,QA9CT,WD9BE7sD,GAAcC,WAAa,IAAKN,IACzBa,KC+BP,KACA,KACA,MACMM,EADaH,KACe,GAAQD,eACpCT,EAAaO,KACbd,EAASoB,EAAiBL,GAAkBR,EAAWa,EAAelqB,KAAO,KACnF,GAAW8oB,EAAS,GAAGoB,EAAejQ,kBAAkB6O,EAAO3c,OAAS,kBAC1E,CAsCM,GACA,MACF,QACE,OAEJ4H,EAAMe,iBACNf,EAAMkU,iBA9BN,KANe,OAATpT,IA/DF,GAAQ2R,UAGZ,GAAQA,SAAU,EAClB,KACA,GAAW,MACXzR,MA2DIhB,EAAMe,iBACNf,EAAMkU,kBAkCZ,GAgBoD,GAClD7jB,OAAOkwB,iBAAiB,YAAa,IAAoB,GACzDlwB,OAAOkwB,iBAAiB,UAAW,IAAoB,GACvDlwB,OAAOkwB,iBAAiB,cAAe,IAAoB,GAC3D,IAAc,GE6CV,IAAiC,oBAAXlwB,SAG1BA,OAAOkwB,iBAAiB,UAlE1B,SAAuBvgB,GACrB,GAAIA,EAAMiiE,iBACR,OAEF,MAAMnhE,EAAOd,EAAMc,KACnB,GAAK,GAAQ2R,QAAb,CASA,OAAQ3R,GACN,IAAK,SACL,IAAK,KACH,KACA,MACF,IAAK,UACH6X,IAAY,GACZ,MACF,IAAK,YACHA,GAAW,GACX,MACF,IAAK,MACHA,GAAW3Y,EAAMkiE,UAAY,EAAI,GACjC,MACF,IAAK,YACHrpD,IAAa,GACb,MACF,IAAK,aACHA,GAAY,GACZ,MACF,IAAK,OAAQ,CACX,MAAMnB,EAAQS,GAAO,GAAQE,YACzBX,GAAOU,UApIjB,SAAyBgqD,GACvB,MACMprD,EADYO,KACS,GAAQ7E,WACnC,GAAKsE,EAGL,GAAgB,SAAZorD,EAAoB,CACtB,MAAMC,EAA6B,oBAAXhyE,OAAyBA,OAAO0jE,OAAO,gBAAiB/8C,EAAS5e,MAAQ,KAC7FiqE,GAAYA,EAAS1qD,SACvBF,GAAiB,GAAQ/E,UAAW,OAAQ2vD,EAAS1qD,QACrD,GAAW,cAAc0qD,EAAS1qD,UAEtC,MAAO,GAAgB,gBAAZyqD,EAA2B,CACpC,MAAME,EAAoC,oBAAXjyE,OAAyBA,OAAO0jE,OAAO,gBAAiB/8C,EAAS9V,aAAe,IAAM,KAC9F,MAAnBohE,IACF7qD,GAAiB,GAAQ/E,UAAW,cAAe4vD,GACnD,GAAW,iBAEf,CACF,CAkHQC,CAAgB7qD,EAAMzrB,IAExB,KACF,CACA,IAAK,OA5CP,GAAW,mBDsCb,SAAuBwB,GACrB,MAAMilB,EAAY8E,GAAoB/pB,GAChCwf,EAAWwJ,GAAkB/D,EAAY+D,GAAkB/qB,SAAW+qB,GAAkB,GAG9F,OAFAS,GAAaC,UAAUzE,GAAaqE,GAAc9J,GAClDqK,KACOJ,GAAaC,UAAUzE,EAChC,CC7CgB8vD,CAAc,GAAQ9vD,WACAta,QA8ChC,MACF,IAAK,SAhET,WACE,MACM4e,EADYO,KACS,GAAQ7E,WAC9BsE,GAILsB,GAAaC,mBAAqB,CAChCvB,WACAtE,UAAW,GAAQA,WAErB,GAAW,mBAAmBsE,EAAS5e,QACvC,MARE,GAAW,uBASf,CAoDMqqE,GACA,MACF,QACE,OAEJziE,EAAMe,iBACNf,EAAMkU,iBAvCN,KANe,OAATpT,IAnJF,GAAQ2R,UAGZ,GAAQA,SAAU,EAClB,GAAW,OAiJPzS,EAAMe,iBACNf,EAAMkU,kBA2CZ,GAcoD,GAClD7jB,OAAOkwB,iBAAiB,YAAa,IAAoB,GACzDlwB,OAAOkwB,iBAAiB,UAAW,IAAoB,GACvDlwB,OAAOkwB,iBAAiB,cAAe,IAAoB,GAC3D,IAAc,GCzMV,IAAiC,oBAAXlwB,SAG1B,IAAc,EAYhB,WACE,GAAI8rB,IAAkC,oBAAX9rB,OACzB,OAEF,MAAMqyE,EAAYryE,OAAOsyE,cAAgBtyE,OAAOuyE,mBAC3CF,IAGLvmD,GAAe,IAAIumD,EACrB,CApBEG,GACK1mD,KAsBAA,KAGLC,GAAaD,GAAasB,aAC1BrB,GAAWlC,KAAKjnB,MAAQ,GACxBopB,GAAUF,GAAasB,aACvBpB,GAAQnC,KAAKjnB,MAAQ,IACrBqpB,GAAYH,GAAasB,aACzBnB,GAAUpC,KAAKjnB,MAAQ,EACvBopB,GAAQ2B,QAAQ5B,IAChBE,GAAU0B,QAAQ5B,IAClBA,GAAW4B,QAAQ7B,GAAayB,cAGlC,WACE,GAAKzB,GAAL,CAGAQ,GAAa5M,QACb,IAAK,MAAOne,EAAKD,KAAeG,OAAOy0C,QAAQptB,IAC7C,IACE,MAAMK,EAAS7nB,EAAW0nB,UAAU8C,IACpCQ,GAAa3Q,IAAIpa,EAAK4nB,EACxB,CAAE,MAAO3d,GACPC,QAAQsW,KAAK,uCAAuCxgB,IAAOiK,EAC7D,CARF,CAUF,CA7CEinE,GA+CF,WACE,GAAsB,oBAAXzyE,OAGX,IAAK,MAAM0sB,KAAajrB,OAAOoJ,KAAK8gB,IAClC3rB,OAAOkwB,iBAAiBxD,EAAY/c,IAClC8c,GAAiBC,IAGvB,CAvDEgmD,GA0DsB,oBAAX1yE,SAGPmsB,IACFnsB,OAAO2yE,cAAcxmD,IAEvBA,GAAiBnsB,OAAO4yE,YAAY,KAClC,IAAK9mD,KAAiBG,GACpB,OAEFG,GAAmB1kB,KAAKmC,IAAI,IAAMuiB,GAAmB,MACrDC,IAA8D,IAAxCD,GAAmBC,IACzC,MAAM23B,EAAU12B,GAAYjB,IAC5BJ,GAAUpC,KAAKgpD,sBAAsB/mD,GAAaiD,aAClD9C,GAAUpC,KAAKipD,wBAAwB9uB,EAASl4B,GAAaiD,YAAc,MAC1E,MAGL,WACE,GAAsB,oBAAX/uB,OACT,OAEF,MAAM+yE,EAAQ,KACZjmD,KACAe,KACA7tB,OAAOgzE,oBAAoB,cAAeD,GAC1C/yE,OAAOgzE,oBAAoB,UAAWD,IAExC/yE,OAAOkwB,iBAAiB,cAAe6iD,GACvC/yE,OAAOkwB,iBAAiB,UAAW6iD,EACrC,CAtFEE,KCoGArjD,KACsB,oBAAX5vB,SACTA,OAAOmvB,IAAM,CACXq2C,YA5ENhF,iBACE5wC,KACA,MAAM2B,QAAclC,GAAem2C,cAGnC,aAFMn2C,GAAe6jD,oBAAoB3hD,GACzC7B,GAAyBzwB,KAAKC,UAAUqyB,GACjC7B,EACT,EAuEMs2C,aArENxF,eAA4B2S,GAC1BvjD,KACA,MAAM/e,EAAc5R,KAAK2nB,MAAMusD,SACzB9jD,GAAe+jD,qBAAqB,IAAIC,sBAAsBxiE,IACpE,MAAM2gB,QAAenC,GAAe22C,eAGpC,aAFM32C,GAAe6jD,oBAAoB1hD,GACzC9B,GAAyBzwB,KAAKC,UAAUsyB,GACjC9B,EACT,EA8DM22C,wBA5DN7F,eAAuC2S,GACrCvjD,KACA,MAAM/e,EAAc5R,KAAK2nB,MAAMusD,SACzB9jD,GAAe+jD,qBAAqB,IAAIC,sBAAsBxiE,GACtE,EAyDMmzD,mBAvDNxD,eAAkC8S,GAChC,IAAKA,EACH,OAEF1jD,KACA,MAAM7O,EAAY,IAAIwyD,gBAAgBt0E,KAAK2nB,MAAM0sD,UAC3CjkD,GAAemkD,gBAAgBzyD,EACvC,EAiDM0yD,oBA/CN,WACE,OAAO/jD,EACT,EA8CM0zC,mBA5CN,WACE,MAAO,IAAIzzC,GACb,EA2CM+jD,UAAWtjD,GACXujD,MAKN,WACMrkD,KACFA,GAAgBqkD,QAChBrkD,GAAkB,MAEhBC,KACFA,GAAeokD,QACfpkD,GAAiB,MAEfF,KACFA,GAAeskD,QACftkD,GAAiB,MAEnBI,GAAmB,cACrB,InB3DMzkB,IAAyC,oBAAXhL,SAGlCA,OAAOkwB,iBAAiB,UAjB1B,SAAkCvgB,GAChC,GAAKA,EAAM85C,SAAU95C,EAAM+5C,SAGR,WAAf/5C,EAAMc,MAAoC,WAAfd,EAAMc,MAAmB,EA3B1D,SAA0BjJ,EAAY,GACpC,IAAKlE,MAAMC,QAAQ8F,KAAyD,IAAhCA,GAAqBhO,OAC/D,OAAO,EAET,MAAM+B,EAAQiM,GAAqBoT,QAAQ7R,IAErC6d,IADkBrrB,GAAS,EAAIA,EAAQ,GACRoK,EAAY6B,GAAqBhO,QAAUgO,GAAqBhO,OACrG,OAAOwQ,GAAexC,GAAqBof,GAC7C,EAqBoBmrD,CADiB,WAAfjkE,EAAMc,MAAqB,EAAI,IAEF,mBAAzBd,EAAMe,gBAC1Bf,EAAMe,gBAEV,CACF,GAOE1F,IAAsB,G+EzGxB,IAAI6oE,GAAW1jE,YAAYC,MAyC3BpQ,OAAO8zE,sBAvCP,SAASjlD,EAAK6D,GACZ,MAAMxP,EAAQxb,KAAK+E,KAAKimB,EAAYmhD,IAAY,IAAM,IACtDA,GAAWnhD,EAEXs1C,GAAW9kD,GAEX,MAAM1T,EAAS7C,MXqLjB,SAAwB6C,IjBvMxB,WACE,IAAK,MAAMjO,KAAOE,OAAOoJ,KAAK6oC,IAC5BA,GAAiBnyC,GAAO,CAE5B,CiBoMEwyE,GjBlMF,SAAyBvkE,GACvBikC,GAAejkC,GAAU,IAC3B,CiBiMEwkE,CAAgBxkE,GAChB,MAAMrE,EAAcF,KACdhD,EAAakD,GAAalD,YAAc,CAAC,EACzC+E,EAAUwC,GAAQxC,SAAW,EAC7B9E,EAAgB5E,MAAMC,QAAQ0E,EAAWC,gBAAkBD,EAAWC,cAAc7M,OAAS,EAC/F4M,EAAWC,cACX,CACE,CAAEC,OAAQ,EAAGzC,MAAO,WACpB,CAAEyC,OAAQ,GAAKzC,MAAO,WACtB,CAAEyC,OAAQ,IAAMzC,MAAO,WACvB,CAAEyC,OAAQ,EAAGzC,MAAO,YAEpBuuE,EAAc,EAAQ3mB,qBAAqB,EAAG,EAAG,EAAG,EAAQnrD,OAAOI,QACzE,IAAK,MAAMsuE,KAAQ3oE,EAAe,CAChC,MAAMC,EAAgC,iBAAhB0oE,EAAK1oE,OAAsBT,KAAK+E,IAAI/E,KAAKmC,IAAIgnE,EAAK1oE,OAAQ,GAAI,GAAK,EACnFzC,EAAQmrE,EAAKnrE,OAAS,UAC5BuuE,EAAYtjC,aAAaxoC,EAAQzC,EACnC,CACA,EAAQkrC,UAAYqjC,EACpB,EAAQ37B,SAAS,EAAG,EAAG,EAAQn2C,OAAOM,MAAO,EAAQN,OAAOI,QAE5D,MAAMgG,EAAcjF,MAAMC,QAAQ0E,EAAWM,aAAeN,EAAWM,YAAc,GACrF,IAAK,MAAM2rE,KAAc3rE,EAAa,CACpC,MAAM/E,EAASF,MAAMC,QAAQ2wE,EAAW1wE,QAAU0wE,EAAW1wE,OAAS,GACtE,KAAIA,EAAOnI,OAAS,GAApB,CAGA,EAAQu1C,UAAYsjC,EAAWxuE,OAAS,sBACxC,EAAQmrC,YACR,EAAQS,OAAO9tC,EAAO,GAAGT,EAAIiK,EAASxJ,EAAO,GAAGuB,GAChD,IAAK,IAAI3J,EAAI,EAAGA,EAAIoI,EAAOnI,OAAQD,GAAK,EACtC,EAAQ+8C,OAAO30C,EAAOpI,GAAG2H,EAAIiK,EAASxJ,EAAOpI,GAAG2J,GAElD,EAAQwsC,YACR,EAAQR,MARR,CASF,CAEA,MAAMojC,EAAUlsE,EAAWG,YAC3B,GAAI+rE,EAAS,CACX,MAAM5xE,EAAS4xE,EAAQ5xE,QAAU,IAC3B8F,EAAQ8rE,EAAQ9rE,OAAS/F,EAAWC,EAAS,GAC7C6xE,EAAO,EAAQ9mB,qBAAqB,EAAGjlD,EAAO,EAAGA,EAAQ9F,GAC/D6xE,EAAKzjC,aAAa,EAAGwjC,EAAQzvE,UAAY,2BACzC0vE,EAAKzjC,aAAa,EAAGwjC,EAAQvvE,aAAe,uBAC5C,EAAQgsC,UAAYwjC,EACpB,EAAQ97B,SAAS,EAAGjwC,EAAO,EAAQlG,OAAOM,MAAOF,EACnD,CAEA,GAA2B,WAAvB4I,GAAanD,MAAoB,CACnC,MAAMqsE,EAAOpsE,EAAWqsE,KAAKvxE,GAA4B,IAAvB,EAAQZ,OAAOM,MAC3C8xE,EAAOtsE,EAAWqsE,KAAKvvE,GAA6B,IAAxB,EAAQ5C,OAAOI,OAC3CiyE,EAAYvsE,EAAWqsE,KAAKtwE,QAAU,GACtCywE,EAAc,EAAQ/jC,qBAAqB2jC,EAAME,EAAM,EAAGF,EAAME,EAAMC,GAC5EC,EAAY9jC,aAAa,EAAG,4BAC5B8jC,EAAY9jC,aAAa,EAAG,0BAC5B,EAAQC,UAAY6jC,EACpB,EAAQ5jC,YACR,EAAQC,IAAIujC,EAAME,EAAMC,EAAW,EAAa,EAAV9sE,KAAKC,IAC3C,EAAQopC,MACV,MAAO,GAA2B,WAAvB5lC,GAAanD,MAAoB,CAC1C,MAAMwf,EAAO,IACb,EAAQopB,UAAY,UACpB,EAAQkH,YAAc,IACtB,IAAK,IAAI/0C,EAAI,EAAGA,EAAI,EAAQZ,OAAOM,MAAOM,GAAKykB,EAC7C,IAAK,IAAIziB,EAAI,EAAGA,EAAIzC,EAAW,GAAIyC,GAAKyiB,EAAM,CAC5C,MAAMktD,EAAqC,EAA1BhtE,KAAKwO,IAAQ,MAAJnT,EAAYgC,GAAU,GAC1C4vE,EAAoC,EAAzBjtE,KAAKuO,IAAQ,KAAJlR,EAAWhC,GAAU,GAC/C,EAAQu1C,SAASv1C,EAAI2xE,EAAS3vE,EAAI4vE,EAAS,EAAG,EAChD,CAEF,EAAQ78B,YAAc,CACxB,CAEA,GAA2B,WAAvB3sC,GAAanD,MAAoB,CACnC,MAAM4sE,EAAYtyE,EAAW,IACvBuyE,EAAe,EAAQvnB,qBAAqB,EAAGsnB,EAAW,EAAGtyE,GACnEuyE,EAAalkC,aAAa,EAAG,2BAC7BkkC,EAAalkC,aAAa,EAAG,uBAC7B,EAAQC,UAAYikC,EACpB,EAAQv8B,SAAS,EAAGs8B,EAAW,EAAQzyE,OAAOM,MAAOH,EAAWsyE,EAClE,CAEA,EAAQhkC,UAAY3oC,EAAWK,aAAe,UAC9C,EAAQgwC,SAAS,EAAGh2C,EAAU,EAAQH,OAAOM,MAAO,EAAQN,OAAOI,OAASD,EAC9E,EW1QEwyE,CAAetlE,GAEf,EAAQyhC,OACR,EAAQC,WAAW1hC,EAAOxC,QAAS,GdgarC,YA7ZA,WACE,MAAM9I,EjEfR,WACE,MAAMiH,EAAcF,KACpB,OAAO3H,MAAMC,QAAQ4H,GAAa1C,YAAc0C,EAAY1C,WAAa,EAC3E,CiEYgBssE,GACd,IAAK,MAAM9xE,KAAQiB,EAAO,CACxB,MAAMusC,EAAW,EAAQ6c,qBAAqBrqD,EAAKF,EAAGE,EAAKsB,IAAKtB,EAAKF,EAAGE,EAAKsB,IAAMtB,EAAKqB,OACxFmsC,EAASE,aAAa,EAAG1tC,EAAKyB,UAAY,2BAC1C+rC,EAASE,aAAa,GAAK1tC,EAAK0B,UAAY,0BAC5C8rC,EAASE,aAAa,EAAG1tC,EAAK2B,aAAe,0BAC7C,EAAQgsC,UAAYH,EACpB,EAAQ6H,SAASr1C,EAAKF,EAAGE,EAAKsB,IAAKtB,EAAKR,MAAOQ,EAAKqB,QAE7B,IAAnBrB,EAAKuB,YACP,EAAQosC,UAAY3tC,EAAKwB,gBAAkB,4BAC3C,EAAQ6zC,SAASr1C,EAAKF,EAAI,GAAIE,EAAKsB,IAAM,EAAGtB,EAAKR,MAAQ,GAAI,IAG/D,MAAMoC,EAAc5B,EAAK4B,aAAe,4BACxC,EAAQqzC,YAAcrzC,EACtB,EAAQq3B,UAAY,IACpB,IAAK,IAAI9gC,EAAI,EAAGA,EAAI6H,EAAKR,MAAOrH,GAAK,GAAI,CACvC,MAAM45E,EAAQ/xE,EAAKsB,IAAM,EAAsC,EAAlCmD,KAAKwO,IAAqB,KAAhB9a,EAAI6H,EAAKsB,MAChD,EAAQssC,YACR,EAAQS,OAAOruC,EAAKF,EAAI3H,EAAG45E,GAC3B,EAAQ/8B,iBAAiBh1C,EAAKF,EAAI3H,EAAI,GAAI45E,EAAQ,EAAG/xE,EAAKF,EAAI3H,EAAI,GAAI45E,GACtE,EAAQ58B,QACV,CACF,CACF,CAoYE68B,GACA,MAAMzsE,EAAY4C,KAClB,IAAK,MAAMtI,KAAY0F,EACrBmkD,GAAa7pD,IAnFjB,WACE,MAAMoyE,EjExVR,WACE,MAAM/pE,EAAcF,KACpB,OAAO3H,MAAMC,QAAQ4H,GAAahI,OAASgI,EAAYhI,MAAQ,EACjE,CiEqVqBgyE,GACnB,IAAK,MAAMhyE,KAAS+xE,EAClB,OAAQ/xE,EAAM6B,MACZ,IAAK,WACH4nD,GAAazpD,GACb,MACF,IAAK,YACH,EAAQ8tC,OACR,EAAQL,UAAY,UACpB,EAAQ0H,SAASn1C,EAAMJ,EAAII,EAAMV,MAAQ,EAAGU,EAAM4B,EAAI5B,EAAMZ,OAAQY,EAAMV,MAAOU,EAAMZ,QACvF,EAAQquC,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQC,UAAY,SACpB,EAAQC,SAASn/C,EAAMgC,MAAQ,KAAMhC,EAAMJ,EAAGI,EAAM4B,EAAI5B,EAAMZ,OAAS,GACvE,EAAQ21C,YAAc,UACtB,EAAQhc,UAAY,EACpB,EAAQqc,WAAWp1C,EAAMJ,EAAII,EAAMV,MAAQ,EAAGU,EAAM4B,EAAI5B,EAAMZ,OAAQY,EAAMV,MAAOU,EAAMZ,QACzF,EAAQivC,UACR,MACF,IAAK,cACH,EAAQP,OACR,EAAQiH,YAAc,UACtB,EAAQhc,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAOnuC,EAAMJ,EAAGI,EAAM4B,EAAI,KAClC,EAAQozC,OAAOh1C,EAAMJ,EAAGI,EAAM4B,EAAI,IAClC,EAAQqzC,SACR,EAAQxH,UAAY,UACpB,EAAQC,YACR,EAAQC,IAAI3tC,EAAMJ,EAAGI,EAAM4B,EAAI,GAAI,GAAI,EAAa,EAAV2C,KAAKC,IAC/C,EAAQopC,OACR,EAAQS,UACR,MACF,IAAK,WACHsc,GAAa3qD,GACb,MACF,IAAK,OACH4pD,GAAS5pD,GACT,MACF,IAAK,OACH6pD,GAAS7pD,GACT,MACF,IAAK,WACHgqD,GAAahqD,GACb,MACF,IAAK,YACHiqD,GAAcjqD,GACd,MACF,IAAK,YACHkqD,GAAclqD,GACd,MACF,IAAK,OACHoqD,GAASpqD,GACT,MACF,IAAK,YACHqqD,GAAcrqD,GACd,MACF,IAAK,WACHsqD,GAAatqD,GACb,MACF,IAAK,UACHuqD,GAAYvqD,GACZ,MACF,IAAK,QACHwqD,GAAUxqD,GACV,MACF,IAAK,gBACHyqD,GAAkBzqD,GAClB,MACF,IAAK,aACH0qD,GAAe1qD,GAMvB,CAQEiyE,EACF,CcraEC,GtBoNF,WACE,MAAM58C,EAAUC,KACV48C,EdvMC5sE,GcwMP,GAAK4sE,GAA0B,IAAjBA,EAAMj6E,OAApB,CAIA,EAAQ41C,OACR,IAAK,MAAM9G,KAAgBmrC,EAAO,CAChC,MAAMxoE,EAA2C,IAA7Bq9B,EAAa1nC,OAAS,KAAc,GAClDoyC,GAAU,GAAa1K,EAAapnC,EAAG+J,EAAW,KACxD,GAAiB,eAAgB+nC,GAC7BA,GAGJ0N,GAAiBpY,EAAc1R,EACjC,CACA,EAAQ+Y,SAZR,CAaF,CsBrOE+jC,GjBoGF,WACE,MAAMD,EDlFC3sE,GCmFP,IAAK2sE,GAA0B,IAAjBA,EAAMj6E,OAClB,OAEF,MAAMo9B,EAAUC,KAChB,EAAQuY,OACR,IAAK,MAAMyW,KAAgB4tB,EAAO,CAChC,MAAMxoE,EAA0C,IAA5B46C,EAAajlD,OAAS,IAAa,GACjDoyC,GAAU,GAAa6S,EAAa3kD,EAAG+J,EAAW,KACxD,GAAiB,eAAgB+nC,GAC7BA,GAGJgT,GAAiBH,EAAcjvB,EACjC,CACA,EAAQ+Y,SACV,CiBpHEgkC,GXqQF,WACE,MAAMjK,EAAgBtc,KAChBwmB,EAAc37D,GAASG,mBAE7B,IAAK,MAAM4d,KAAWW,GAAU,CAC9B,MAAMl3B,EAAamyB,GAAoBoE,EAAQ7yB,MAC/C,IAAK1D,EACH,SAGF,MAAMwL,EAAwC,IAA3BxL,EAAWmB,OAAS,KAAa,GAC9CoyC,GAAU,GAAahd,EAAQ90B,EAAG+J,EAAW,KAEnD,GADA,GAAiB,UAAW+nC,GACxBA,EACF,SAGF,IAAKvzC,EACH,SAGF,MAAMo0E,EAAkBnK,GAAe3vE,KAAOi8B,EAAQj8B,GAChD+5E,GAAeD,GAAmBD,IAAgB59C,EAAQj8B,GAC1Dg6E,EAAYt0E,EAAWmB,OAAS,IAChCozE,EAAav0E,EAAWiB,QAAU,GAClC2D,EAAY5E,EAAWizB,WAAa,UACpCpuB,EAAc7E,EAAWkzB,aAAe,UAE9C,EAAQyc,OACR,EAAQC,UAAUrZ,EAAQ90B,EAAG80B,EAAQ9yB,GACrC,EAAQosC,QAAStZ,EAAQC,MAAQ,GAAKpwB,KAAKC,GAAM,KAEjD,EAAQipC,UAAY1qC,EACpB,EAAQoyC,UAAUs9B,EAAY,GAAIC,EAAa,EAAGD,EAAWC,GAE7D,EAAQjlC,UAAYzqC,EACpB,EAAQmyC,UAAUs9B,EAAY,GAAIC,EAAa,EAAI,EAAe,GAAZD,EAAiB,GAEvE,EAAQpkC,WAEJkkC,GAAmBC,KACrB,EAAQ1kC,OACR,EAAQ/U,UAAYw5C,EAAkB,EAAI,EAC1C,EAAQx9B,YAAcw9B,EAAkB,UAAY,UACpD,EAAQxoB,YAAYwoB,EAAkB,GAAK,CAAC,EAAG,IAC/C,EAAQn9B,WACN1gB,EAAQ90B,EAAI6yE,EAAY,EAAI,GAC5B/9C,EAAQ9yB,EAAI8wE,EAAa,EAAI,GAC7BD,EAAY,GACZC,EAAa,IAEf,EAAQrkC,UAEZ,CACF,CW1TEskC,GzBQF,WACE,MAAMC,ED2KCzgC,GC1KP,GAAqB,IAAjBygC,EAAM16E,OAAV,CAIA,EAAQ41C,OACR,EAAQoR,UAAY,SACpB,EAAQD,KAAO,qCAEf,IAAK,MAAMrL,KAAQg/B,EAAO,CACxB,MAAMlhC,GAAU,GAAakC,EAAKh0C,EAAG,GAAI,KAEzC,GADA,GAAiB,WAAY8xC,GACzBA,EACF,SAEF+C,GAAUb,GACV,MAAMi/B,EAAUhhC,GAAkB+B,EAAKT,QACpB,eAAfS,EAAKn/B,QACP,EAAQg5B,UAAYmG,EAAKrwC,UACzB,EAAQoxC,YAAc,GACtB,EAAQwK,SAAS0zB,GAASngE,OAASkhC,EAAKlhC,OAAS,cAAekhC,EAAKh0C,EAAGg0C,EAAKhyC,EAAI,IAErF,CAEA,EAAQysC,SArBR,CAsBF,CyBjCEykC,GX2TF,WACE,MAAM/U,EAAUrlD,KAChB,IAAK,MAAMq6D,KAAUhV,EAAS,CAC5B,MAAMrsB,GAAU,GAAaqhC,EAAOnzE,EAAG,GAAI,KAC3C,GAAiB,SAAU8xC,GACvBA,GAGJwI,GAAkB,CAChB/D,OAAQ48B,EACRr/D,KAAM,GAAM3B,SACZkE,IAAK88D,EAAO98D,KAAO,KACnBoH,OAAQ,KACRm9B,aAAc,UACdC,aAAc,UACd1hB,UAAW,IACXrmB,MAAOqgE,EAAOnuE,MAAQmuE,EAAOt6E,IAAM,OACnCiiD,WAAY,WAEhB,CACF,CW9UEs4B,GXgVF,WACE,MAAMC,EFjMKroB,KEyMLsoB,GFxMMv8D,GAASM,qBEkMC,CACpBk8D,KAAM,UACNC,OAAQ,UACRvb,OAAQ,UACRwb,MAAO,WALSJ,GAAsBx6E,IAAM,SAOF,WACtC4hD,EAAeT,GAAgBmV,IAErC,IAAK,MAAM70C,KAAQ9B,GAAY,CAC7B,MAAMzO,EAAY,GACZ+nC,GAAU,GAAax3B,EAAKta,EAAG+J,EAAW,KAEhD,GADA,GAAiB,QAAS+nC,GACtBA,EACF,SAEF,MAAMl8B,EAAa0E,EAAK1E,YAAc,EAChCulC,EAAc,GAAMvlC,EAAa,IAAM,EAAG,GAC1CnU,EAAY6Y,EAAK7Y,WAAa,EAC9BiyE,EAAkC,MAArBp5D,EAAK/D,cAAuB+D,EAAK/D,aAAe,IAEnE+jC,GAAkB,CAChB/D,OAAQj8B,EACRxG,KAAM,GAAM3B,SACZkE,IAAKiE,EAAKjE,IACVoH,OAAQ0xC,GACR1U,eACAG,aAAc04B,EACdz4B,aAAcy4B,EACdn6C,UAAW,IACXiiB,WAAY9gC,EAAK7D,eAAiBi9D,EAC9B,CAAEpnE,QAAQ,EAAM40B,SAAUwyC,EAAa,GAAM,GAAKzxE,KAAM,cACxD,KACJ6Q,MAAOwH,EAAKtV,MAAQ,OACpB81C,WAAY,UACZI,WAAYtlC,EAAa,EAAI,4BAA8B,KAC3DulC,cACAz5C,eAAgBD,EAAY,EAAI,4BAA8B,MAElE,CACF,CW1XEkyE,GXieF,WACE,MAAMC,EAAQ5tE,GACR0vB,EAAUC,KAEVwoB,EAAOy1B,EAAM5xE,EACb6xE,EAAQD,EAAM/9D,WAAa,EAAIlR,KAAKwO,IAAc,GAAVuiB,GAAgBk+C,EAAM99D,eAAiB,GAAM89D,EAAM/9D,WAAa,GAAK,EAAG,GAAK,EACrH5L,EAAU2pE,EAAMz+D,OAAS,EAAI0+D,EAAQ,EACrC1wE,EAAYywE,EAAMz+D,OAAS,EAAKy+D,EAAMh+D,WAAa,EAAI,UAAY,UAAa,UAEtF,EAAQujB,UAAY,EACpB,EAAQgc,YAAchyC,EACtB,EAAQw2C,QAAU,QAElB,MAAMplB,EAAUq/C,EAAM5zE,EAAIiK,EAC1B,EAAQ6jC,YACR,EAAQC,IAAIxZ,EAAS4pB,EAZF,MAYiC,EAAa,EAAVx5C,KAAKC,IAC5D,EAAQywC,SAER,EAAQvH,YACR,EAAQS,OAAOha,EAAS4pB,EAAO/rC,IAC/B,EAAQgjC,OAAO7gB,EAASh1B,EAjBL,IAkBnB,EAAQ81C,SAER,EAAQvH,YACR,EAAQS,OAAOha,EAASh1B,EArBL,IAsBnB,EAAQ61C,OAAO7gB,EAAU,GAAIh1B,GAC7B,EAAQgvC,OAAOha,EAASh1B,EAvBL,IAwBnB,EAAQ61C,OAAO7gB,EAAU,GAAIh1B,GAC7B,EAAQ81C,SAER,MAAMy+B,EAAO31B,EAAO/rC,GACpB,EAAQ07B,YACR,EAAQS,OAAOha,EAASu/C,GACxB,EAAQ1+B,OAAO7gB,EAAU,GAAIu/C,EAAO,IACpC,EAAQvlC,OAAOha,EAASu/C,GACxB,EAAQ1+B,OAAO7gB,EAAU,GAAIu/C,EAAO,IACpC,EAAQz+B,SAER,MAEM8J,EAAO5qB,EAAU2sB,GACjB9B,EAAOjB,EAAO,GACpB,EAAQtQ,UAAY,UACpB,EAAQ0H,SAAS4J,EAAMC,EALN,IACC,IAKlB,MAAMpE,EAAc44B,EAAMz+D,OAASy+D,EAAMx+D,UACzC,EAAQy4B,UAAY+lC,EAAMz+D,OAAS,EAAI,UAAY,UACnD,EAAQogC,SAAS4J,EAAMC,EARN,IAQuB,GAAMpE,EAAa,EAAG,GAP5C,IAQlB,EAAQ7F,YAAc,UACtB,EAAQK,WAAW2J,EAAMC,EAVR,IACC,IAWlB,EAAQvR,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQC,UAAY,SACpB,MAAMxsC,EAAQ8gE,EAAMz+D,OAAS,EAAI,kBAAkBxQ,KAAKyC,MAAMwsE,EAAMz+D,WAAWy+D,EAAMx+D,YAAc,gBACnG,EAAQmqC,SAASzsC,EAAOyhB,EAAS6qB,EAAO,GACxC,EAAQE,UAAY,MACtB,CWxhBEy0B,GX0hBF,WACE,IAAK,MAAMv6D,KAAStT,GAAS,CAC3B,GAAIsT,EAAMrE,QAAU,EAClB,SAGF,MAAMpL,GAAayP,EAAMvY,QAAU,IAAM,GACnC6wC,GAAU,GAAat4B,EAAMxZ,EAAG+J,EAAW,KAEjD,GADA,GAAiB,UAAW+nC,GACxBA,EACF,SAGF,MAAM1/B,EAAa,GAEb4hE,EAAY,CAAE5hE,aAAYC,WADb1N,KAAKmC,IAAI,IAAK0S,EAAMha,QAAU,KAAoB,EAAb4S,EAAiB,IAC7BE,UAAW,GAAIC,UAAW,IAChEpP,EAAYqW,EAAMvD,UAAY,EAAI,UAAauD,EAAM5D,WAAa,EAAI,UAAY,UAClFA,EAAa4D,EAAM5D,YAAc,EACjCulC,EAAc,GAAMvlC,EAAa,IAAM,EAAG,GAC1ClU,EAAiB8X,EAAM3D,WAAa,EAAI,4BAA8B,KAE5EykC,GAAkB,CAChB/D,OAAQ/8B,EACR1F,KAAMkgE,EACN39D,IAAKmD,EAAMnD,IACXoH,OAAQ,KACRm9B,aAAcz3C,EACd03C,aAAc,UACd1hB,UAAW,IACX4hB,eAAe,EACfC,YAAaxhC,EAAMrE,OAASqE,EAAMpE,UAClC6lC,YAAa,UACbC,WAAYtlC,EAAa,EAAI,4BAA8B,KAC3DulC,cACAz5C,iBACA05C,WAA4B,kBAAhB5hC,EAAM3E,MAA4B,CAAEvI,QAAQ,EAAM40B,SAAU,GAAKj/B,KAAM,aAAgB,MAEvG,CACF,CW/jBEgyE,G/CgFF,WACE,IAAKz3C,GAAYlwB,OACf,OAEF,EAAQ4hC,OACR,MAAM3B,EAAQ,GAAM/P,GAAY5mB,WAAa,EAAI,IAAO,IAAO4mB,GAAYzqB,SAAWpN,KAAKmC,IAAI,EAAG01B,GAAYC,aAAe,IAAM,IAAM,IACzI,EAAQ0Y,YAAc3Y,GAAY75B,MAClC,EAAQw2B,UAAY,EACpB,EAAQ4b,YAAcxI,EACtB,EAAQuB,YACR,MAAM7T,EAAS0C,KACf,EAAQoR,IAAI9T,EAAOj6B,EAAGi6B,EAAOj4B,EAAGw6B,GAAYv7B,OAAQ,EAAa,EAAV0D,KAAKC,IAC5D,EAAQywC,SACR,EAAQN,YAAsB,GAARxI,EACtB,EAAQsB,UAAYrR,GAAY75B,MAChC,EAAQmrC,YACR,EAAQC,IAAI9T,EAAOj6B,EAAGi6B,EAAOj4B,EAAwB,GAArBw6B,GAAYv7B,OAAc,EAAa,EAAV0D,KAAKC,IAClE,EAAQopC,OACR,EAAQS,SACV,CC3GEylC,GHuFF,WACE,GAAuB,IAAnBh5C,GAAQ5iC,OAAZ,CAGA,EAAQ41C,OACR,IAAK,MAAM9S,KAAUF,GAAS,CAC5B,MAAMi5C,EAAY,GACZj3C,EAA6B,GAAhB9B,EAAO57B,OACpB40E,EAAiB,GAAMh5C,EAAOjqB,UAAYiqB,EAAOsB,aAAe,GAAI,EAAG,GAC7E,EAAQmR,UAAYzS,EAAO9pB,UAC3B,EAAQikC,SAASna,EAAOp7B,EAAgB,GAAZm0E,EAAiB/4C,EAAOp5B,EAAIo5B,EAAO57B,OAAS09B,EAAYi3C,EAAWj3C,GAE/F,MAAMm3C,EAA6B,GAAhBj5C,EAAO57B,OAC1B,EAAQquC,UAAYzS,EAAO7pB,UAC3B,EAAQgkC,SAASna,EAAOp7B,EAAgB,GAAZm0E,EAAiB/4C,EAAOp5B,EAAe,GAAZmyE,EAAiBE,GAExE,EAAQxmC,UAAY,UACpB,EAAQ0H,SAASna,EAAOp7B,EAAgB,GAAZm0E,EAAiB/4C,EAAOp5B,EAAI,EAAe,GAAZmyE,EAAkBC,EAAgB,EAC/F,CACA,EAAQ3lC,SAhBR,CAiBF,CG1GE6lC,GF4DF,WACE,IAAKl4C,GAAa9vB,OAChB,OAEF,EAAQ4hC,OACR,EAAQiH,YAAc/Y,GAAaz5B,MACnC,EAAQw2B,UAAY,EACpB,EAAQ2U,YACR,EAAQS,OAAOx3B,GAAS/W,EAAG+W,GAAS/U,GACpC,MAAM6mC,EAAQzM,GAAaC,cAAgBD,GAAa3qB,WAAa,GAC/D8iE,EAAWx9D,GAAS/W,GAAKo8B,GAAa/yB,QAAU0N,GAAS/W,GAAK6oC,EAC9D2rC,EAAWz9D,GAAS/U,GAAKo6B,GAAazoB,QAAUoD,GAAS/U,GAAK6mC,EACpE,EAAQuM,OAAOm/B,EAAUC,GACzB,EAAQn/B,SACR,EAAQ5G,SACV,CE1EEgmC,GNuBF,WACE,EAAQvmC,OACR,IAAK,MAAMu/B,KAASn2C,GAAU,CAC5B,MAAMiV,EAAQ,GAAMkhC,EAAM11C,KAAO01C,EAAMz1C,QAAS,EAAG,GACnD,EAAQ+c,YAAsB,IAARxI,EACtB,EAAQsB,UAAY4/B,EAAM9qE,MAC1B,EAAQmrC,YACR,EAAQC,IAAI0/B,EAAMztE,EAAGytE,EAAMzrE,EAAGyrE,EAAMxsE,OAAQ,EAAa,EAAV0D,KAAKC,IACpD,EAAQopC,MACV,CACA,EAAQS,SACV,CoD1BEimC,GXwXF,WACE,GAAI39D,GAAS5B,QAAU,GAAK4B,GAASE,UACnC,OAGF,MAAMnD,EAAOiD,GAASQ,aAAe,GAAMpF,SACrCsL,EAASZ,KACTo7C,EAASlhD,GAASW,cAClBi9D,EAAiB1c,EAASA,EAAOhqD,OAASgqD,EAAO3rD,OAAS2rD,EAAO/pD,SAAW,EAC5EktC,EAAa6c,EACf,CACE3rD,OAAQyK,GAASS,UACjB0pB,SAAUyzC,EAAiB,EAAI,GAAM59D,GAASY,cAAgBg9D,EAAgB,EAAG,GAAK,EACtF1yE,KAAMwb,GAAQ1P,UAAY,IAE5B,KAEE6mE,EAAqBnyD,KACrBoyD,EAAoB,CACxBhzD,OAAQa,GAAkBkyD,EAAmB/yD,SAAW,KACxDC,MAAOY,GAAkBkyD,EAAmB9yD,QAAU,KACtDC,QAASW,GAAkBkyD,EAAmB7yD,UAAY,MAG5Du4B,GAAkB,CAChB/D,OAAQx/B,GACRjD,OACAuC,IAAKU,GAASV,IACdoH,SACAk9B,UAAWk6B,EACXj6B,aAAc,UACdC,aAAc,UACd1hB,UAAW,EACXxmB,UAAWoE,GAASpE,UACpBC,QAASmE,GAASnE,QAClBwoC,aACAF,WAAYnkC,GAASuB,gBAAkB,EAAI,2BAA6B,KACxE6iC,YAAa,IAAOpkC,GAASuB,iBAAmB,GAAK,IAAK,EAAG,GAC7D5W,eAAgBqV,GAASJ,wBAA0B,EAAI,4BAA8B,OAMzF,WACE,MAAMN,EAAMU,GAASV,IACrB,IAAKA,EACH,OAGF,MAAMwgC,Eb5LR,WACE,MAAM/iC,EAAOiD,GAASnE,QAAU,GAAMA,QAAWmE,GAASpE,UAAY,GAAMA,UAAY,GAAMR,SAC9F,OAAOmkC,GAAkBv/B,GAAUjD,EACrC,CayLiBghE,GACTC,EAAY1+D,EAAI/J,QAAUpF,OAAOC,SAASkP,EAAIhN,UAAYnC,OAAOC,SAASkP,EAAI1C,SAC9E+jC,EAAQq9B,EAAYpwE,KAAKmC,IAAI,GAAInC,KAAK+E,IAAI,IAAK2M,EAAI7C,WAAa,MAAQ,IACxEwhE,EAAa9tE,OAAOC,SAASkP,EAAI/C,SAAW+C,EAAI/C,QAAWyD,GAASxU,QAAU,EAAI,GAAK,EACvF0yE,EAAa/tE,OAAOC,SAASkP,EAAI9C,SAAW8C,EAAI9C,QAAU,EAC1Dk4C,EAAO9mD,KAAKs3B,MAAM+4C,EAAYC,IAAe,EAC7C14B,EAAOy4B,EAAavpB,EACpBjP,EAAOy4B,EAAaxpB,EACpBpiD,EAAU0rE,EAAY1+D,EAAIhN,QAAUwtC,EAAO72C,EAAIu8C,EAAO7E,EACtD/jC,EAAUohE,EAAY1+D,EAAI1C,QAAUkjC,EAAO70C,EAAIw6C,EAAO9E,EAE5D,EAAQxJ,OACR,EAAQ/U,UAAY,EACpB,EAAQgxB,YAAY,CAAC,EAAG,IACxB,EAAQhV,YAAc4/B,EAAY,4BAA8B,2BAChE,EAAQjnC,YACR,EAAQS,OAAOsI,EAAO72C,EAAG62C,EAAO70C,GAChC,EAAQozC,OAAO/rC,EAASsK,GACxB,EAAQ0hC,SACR,EAAQ8U,YAAY,IAEpB,EAAQtc,UAAYknC,EAAY,2BAA6B,2BAC7D,EAAQjnC,YACR,EAAQC,IAAI1kC,EAASsK,EAAS,EAAG,EAAa,EAAVhP,KAAKC,IACzC,EAAQopC,OAER,EAAQH,UAAYknC,EAAY,yBAA2B,yBAC3D,EAAQhgC,YAAc,IACtB,EAAQjH,YACR,EAAQC,IAAI8I,EAAO72C,EAAG62C,EAAO70C,EAAG,EAAG,EAAa,EAAV2C,KAAKC,IAC3C,EAAQopC,OACR,EAAQ+G,YAAc,EACtB,EAAQtG,SACV,CA1CEymC,EACF,CWjaEC,GX4cF,WACE,IAAK,MAAM5qC,KAAUxzB,GAASkB,eAAgB,CAC5C,MAAMs0B,EAAQ,GAAMhC,EAAOpJ,UAAYoJ,EAAOp5B,SAAU,EAAG,GAC3D,EAAQ08B,UAAY,uBAAuB,GAAMtB,KACjD,EAAQuB,YACR,EAAQC,IAAIxD,EAAOvqC,EAAGuqC,EAAOvoC,EAAGuoC,EAAOtpC,OAAQ,EAAa,EAAV0D,KAAKC,IACvD,EAAQopC,OAER,EAAQmH,YAAc,uBAAuB5I,KAC7C,EAAQpT,UAAY,EACpB,EAAQ2U,YACR,EAAQC,IAAIxD,EAAOvqC,EAAGuqC,EAAOvoC,EAAGuoC,EAAOtpC,OAAQ,EAAa,EAAV0D,KAAKC,IACvD,EAAQywC,QACV,CACF,CWzdE+/B,GACAve,K/BuTF,WACE,GAA8B,IAA1B5qB,GAAiB4vB,MAAyC,IAA3B3vB,GAAgB5zC,OAAnD,CAGA,EAAQ41C,OACR,EAAQmnC,yBAA2B,UACnC,EAAQtgC,YAAc,EAEtB,IAAK,MAAM/zC,KAASirC,GAAiBjzB,SAAU,CAC7C,MAAMjH,EAAWs6B,GAAerrC,EAAM0B,WAClCqP,GAAY,MAGG,SAAf/Q,EAAMiB,KACRgsC,GAAcjtC,EAAO+Q,GAErB07B,GAAezsC,EAAO+Q,GAE1B,CAEA,IAAK,MAAM/Q,KAASkrC,GAAiB,CACnC,MAAMrD,EAAQ,GAAM7nC,EAAMyG,IAAMzG,EAAM2G,OAAQ,EAAG,GACjD,IAAIoK,EAAWs6B,GAAerrC,EAAM0B,UAAYiC,KAAK4oD,IAAI1kB,EAAO7nC,EAAM2O,OAAS,IAC3E3O,EAAM6B,QAAU,IAClBkP,EAAWs6B,GAAet6B,GAAYpN,KAAK4C,SAAW,IAAOvG,EAAM6B,UAEjEkP,GAAY,MAGG,SAAf/Q,EAAMiB,KACRgsC,GAAcjtC,EAAO+Q,GAErB07B,GAAezsC,EAAO+Q,GAE1B,CAEA,EAAQ08B,SAjCR,CAkCF,C+B3VE6mC,GnD3BF,WACE,EAAQpnC,OACR,EAAQmR,KAAO,qCACf,EAAQC,UAAY,SACpB,IAAK,MAAMotB,KAASz0C,GAAc,CAChC,MAAMs9C,EAAU,GAAM7I,EAAM30C,KAAO20C,EAAM10C,QAAS,EAAG,GACrD,EAAQ6V,UAAY,uBAAuB0nC,KAC3C,EAAQh2B,SAAS,IAAI56C,KAAKyC,MAAMslE,EAAM7sE,SAAU6sE,EAAM1sE,EAAG0sE,EAAM1qE,EACjE,CACA,EAAQysC,SACV,CmDkBE+mC,GACA,EAAQ/mC,UAER+hB,KX0kCF,WACE,MAAM37C,EAAQia,KACd,IAAKja,EAAMwK,QACT,OAGF,MACMo2D,EAAc,IACdz1E,EAA2B,GAAvB,EAAQZ,OAAOM,MAAcg2E,IACjC1zE,EAA4B,GAAxB,EAAQ5C,OAAOI,OAAei2E,IAExC,EAAQvnC,OACR,EAAQL,UAAY,yBACpB,EAAQ0H,SAASv1C,EAAGgC,EAPD,IAOgByzE,GACnC,EAAQtgC,YAAc,UACtB,EAAQhc,UAAY,EACpB,EAAQqc,WAAWx1C,EAAGgC,EAVH,IAUkByzE,GAErC,EAAQ5nC,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQC,UAAY,OACpB,EAAQC,SAAS,iBAAkBv/C,EAAI,GAAIgC,EAAI,IAE/C,EAAQq9C,KAAO,qCACf,EAAQxR,UAAY,UACpB,EAAQ0R,SAAS,+CAAgDv/C,EAAI,GAAIgC,EAAI,IAC7E,EAAQu9C,SAAS,iFAAkFv/C,EAAI,GAAIgC,EAAI,IAE/G,IAAI2zE,EAAU3zE,EAAI,GACd6S,EAAMpM,QACR,EAAQolC,UAAY,UACpB,EAAQ0R,SAAS1qC,EAAMpM,MAAOzI,EAAI,GAAI21E,GACtCA,GAAW,IAET9gE,EAAMgZ,gBACR,EAAQggB,UAAY,UACpB,EAAQ0R,SAAS1qC,EAAMgZ,cAAe7tB,EAAI,GAAI21E,GAC9CA,GAAW,IAET9gE,EAAMsZ,YACR,EAAQ0f,UAAY,UACpB,EAAQ0R,SAAS1qC,EAAMsZ,UAAWnuB,EAAI,GAAI21E,GAC1CA,GAAW,IAET9gE,EAAMqZ,aACR,EAAQ2f,UAAY,UACpB,EAAQ0R,SAAS1qC,EAAMqZ,WAAYluB,EAAI,GAAI21E,GAC3CA,GAAW,IAGb,MAAMC,EAAUD,EAAU,GAEpBE,EAAa7zE,EAAIyzE,EAAc,IAC/BhoD,EAAU5Y,EAAM4Y,SAAW,GAC3BqoD,EAAUnxE,KAAKmC,IAAI,EAAGnC,KAAKoC,OAAO8uE,EAAaD,GAHnC,KAIZG,EAAapxE,KAAK+E,IAAI+jB,EAAQn1B,OAAQqM,KAAK+E,IAAIosE,EAAS,IAE9D,EAAQz2B,KAAO,qCACf,IAAK,IAAIhnD,EAAI,EAAGA,EAAI09E,EAAY19E,GAAK,EAAG,CACtC,MAAM82B,EAAS1B,EAAQp1B,GACjB29E,EAAOJ,EATG,GASOv9E,EACJA,IAAMwc,EAAM6Y,gBAE7B,EAAQmgB,UAAY,2BACpB,EAAQ0H,SAASv1C,EAAI,GAAIg2E,EAAO,EAAGN,IAAiBO,KAEtD,EAAQpoC,UAAY,UACpB,EAAQ0R,SAASpwB,EAAOnqB,MAAQmqB,EAAOt2B,IAAM,SAAUmH,EAAI,GAAIg2E,EAAO,GACtE,EAAQnoC,UAAY,UACpB,MAAMqoC,EAAU,GAAG/mD,EAAOh0B,KAAO,eAAeg0B,EAAOgvC,SAAW,OAAOhvC,EAAOivC,YAAc,SAASjvC,EAAOkvC,QAAU,OACxH,EAAQ9e,SAAS22B,EAASl2E,EAAI,GAAIg2E,EAAO,GAC3C,CAEuB,IAAnBvoD,EAAQn1B,SACV,EAAQu1C,UAAY,UACpB,EAAQ0R,SAAS,wBAAyBv/C,EAAI,GAAI41E,EAAU,KAG9D,MAAMO,EAAU,CAACt2E,EAAOu2E,EAAQ,KACT,iBAAVv2E,EACF,GAEFA,EAAMvH,OAAS89E,EAAQ,GAAGv2E,EAAM8U,MAAM,EAAGyhE,QAAcv2E,EAG1D0uB,EAAM1Z,EAAM0Z,KAAO,CAAC,EAC1B,IAAI8nD,EAAOr0E,EAAIyzE,EAAc,IAC7B,EAAQp2B,KAAO,qCACf,EAAQxR,UAAY,UACpB,EAAQ0R,SAAS,gBAAiBv/C,EAAI,GAAIq2E,GAC1CA,GAAQ,GAEJ9nD,EAAI9lB,QACN,EAAQolC,UAAY,UACpB,EAAQ0R,SAAShxB,EAAI9lB,MAAOzI,EAAI,GAAIq2E,GACpCA,GAAQ,IAGNxhE,EAAMiZ,SACJS,EAAIG,cACN,EAAQmf,UAAY,UACpB,EAAQ0R,SAAS,sBAAuBv/C,EAAI,GAAIq2E,GAChDA,GAAQ,IACC9nD,EAAIC,OACb,EAAQqf,UAAY,UACpB,EAAQ0R,SAAS,uCAAwCv/C,EAAI,GAAIq2E,GACjEA,GAAQ,GACR,EAAQxoC,UAAY,UACpB,EAAQ0R,SAAS42B,EAAQ5nD,EAAIC,OAAQxuB,EAAI,GAAIq2E,GAC7CA,GAAQ,KAER,EAAQxoC,UAAY,UACpB,EAAQ0R,SAAS,0BAA2Bv/C,EAAI,GAAIq2E,GACpDA,GAAQ,IAGN9nD,EAAII,gBACN,EAAQkf,UAAY,UACpB,EAAQ0R,SAAS,iCAAkCv/C,EAAI,GAAIq2E,GAC3DA,GAAQ,KAGN9nD,EAAII,eACN,EAAQkf,UAAY,UACpB,EAAQ0R,SAAS,uBAAwBv/C,EAAI,GAAIq2E,GACjDA,GAAQ,IACC9nD,EAAIE,QACb,EAAQof,UAAY,UACpB,EAAQ0R,SAAS,8CAA+Cv/C,EAAI,GAAIq2E,GACxEA,GAAQ,GACR,EAAQxoC,UAAY,UACpB,EAAQ0R,SAAS42B,EAAQ5nD,EAAIE,QAASzuB,EAAI,GAAIq2E,GAC9CA,GAAQ,KAER,EAAQxoC,UAAY,UACpB,EAAQ0R,SAAS,4BAA6Bv/C,EAAI,GAAIq2E,GACtDA,GAAQ,IAIZ,MAAMzpD,EAAkBrsB,MAAMC,QAAQ+tB,EAAI3B,iBAAmB2B,EAAI3B,gBAAkB,GAC7EiC,EAAmBtuB,MAAMC,QAAQ+tB,EAAIM,kBAAoBN,EAAIM,iBAAmB,GAElFN,EAAIK,oBACN,EAAQif,UAAY,UACpB,EAAQ0R,SAAS,+BAAgCv/C,EAAI,GAAIq2E,GACzDA,GAAQ,IAGV,MAAMC,EACJ,oBAAsB1pD,EAAgBt0B,OAAS,wBAA0Bu2B,EAAiBv2B,OAK5F,GAJA,EAAQu1C,UAAY,UACpB,EAAQ0R,SAAS+2B,EAAkBt2E,EAAI,GAAIq2E,GAC3CA,GAAQ,GAEJzpD,EAAgBt0B,OAAS,EAAG,CAC9B,MAAMi+E,EAAiB,eAAiBJ,EAAQvpD,EAAgBA,EAAgBt0B,OAAS,GAAI,IAC7F,EAAQu1C,UAAY,UACpB,EAAQ0R,SAASg3B,EAAgBv2E,EAAI,GAAIq2E,GACzCA,GAAQ,EACV,MAAY9nD,EAAIK,oBACd,EAAQif,UAAY,UACpB,EAAQ0R,SAAS,oDAAqDv/C,EAAI,GAAIq2E,GAC9EA,GAAQ,IAGV,GAAIxnD,EAAiBv2B,OAAS,EAAG,CAC/B,MAAMk+E,EAAkB,gBAAkBL,EAAQtnD,EAAiBA,EAAiBv2B,OAAS,GAAI,IACjG,EAAQu1C,UAAY,UACpB,EAAQ0R,SAASi3B,EAAiBx2E,EAAI,GAAIq2E,GAC1CA,GAAQ,EACV,MAAY9nD,EAAIK,oBACd,EAAQif,UAAY,UAChBh5B,EAAMiZ,QACR,EAAQyxB,SAAS,4CAA6Cv/C,EAAI,GAAIq2E,GAEtE,EAAQ92B,SAAS,oDAAqDv/C,EAAI,GAAIq2E,GAEhFA,GAAQ,IAGV,EAAQ5nC,SACV,CW/vCEgoC,GCaF,WACE,MAAM5hE,EpE8HR,WACE,MAAM8K,EAAQD,KACd,MAAO,CACLL,QAASD,GAAQC,QACjBC,UAAWF,GAAQE,UACnBC,YAAaH,GAAQG,YACrBI,QACAH,QAASJ,GAAQI,QACjBC,aAAcL,GAAQK,aAE1B,CoExIgBi3D,IACR,QAAEr3D,EAAO,MAAEM,EAAK,UAAEL,EAAS,YAAEC,EAAW,QAAEC,EAAO,aAAEC,GAAiB5K,EACpE8hE,EAAc9qD,QAAQrM,IAAYC,EAAe,IACvD,IAAKJ,IAAYs3D,EACf,OAGF,MAAMj3E,EAAQ,EAAQN,OAAOM,MACvBF,EAAS,EAAQJ,OAAOI,OAI9B,GAFA,EAAQ0uC,OAEJ7uB,EAAS,CACX,EAAQwuB,UAAY,wBACpB,EAAQ0H,SAAS,EAAG,EAAG71C,EAAOF,GAE9B,MAAMk2E,EAAa/wE,KAAK+E,IAAIhK,EAAQ,IAAK,KACnCk3E,EAAiB,GACjBC,EAAe,GACfC,EAAe,IACfC,EAAe,GACftB,EAAc9wE,KAAK+E,IAAIlK,EAAS,IAAKq3E,EAAel3D,EAAMrnB,OAASs+E,EAAiBE,EAAeC,GACnGC,EAAgC,IAAtBt3E,EAAQg2E,GAClBuB,EAAkC,IAAxBz3E,EAASi2E,GAEzB,EAAQ5nC,UAAY,yBACpB,EAAQ0H,SAASyhC,EAAQC,EAAQvB,EAAYD,GAC7C,EAAQtgC,YAAc,2BACtB,EAAQhc,UAAY,EACpB,EAAQqc,WAAWwhC,EAAS,GAAKC,EAAS,GAAKvB,EAAa,EAAGD,EAAc,GAE7E,MAAMyB,EAAU,GAChB,IAAIC,EAAUF,EAASC,EAAU,EACjC,MAAME,EAAQJ,EAASE,EAEvB,EAAQrpC,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQE,SAAS,iBAAkB63B,EAAOD,GAC1CA,GAAW,GAEX,EAAQtpC,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQE,SAAS,kEAAmE63B,EAAOD,GAC3FA,GAAW,GAEX,EAAQ93B,KAAO,qCACf,MAAMg4B,EAAeD,EACfE,EAAgBN,EAAStB,EAAawB,EACtCK,EAAc,2BACdC,EAAgB,UAChBC,EAAc,UACdC,EAAc,UACdC,EAAgB,UAEtBh4D,EAAM1F,QAAQ,CAACsD,EAAMq6D,KACnB,MAAM5B,EAAOmB,EAAUS,EAAMhB,EACzBgB,IAAQt4D,IACV,EAAQuuB,UAAY0pC,EACpB,EAAQhiC,SAAS8hC,EAAe,GAAIrB,EAAO,GAAIN,EAAuB,EAAVwB,EAAc,GAAIN,IAEhF,MAAM97B,EAAa88B,IAAQt4D,EAAYm4D,EAAcD,EAC/CK,EAAaD,IAAQt4D,EAAYo4D,EAAcC,EAC/CG,EAAYv6D,EAAKzK,OAASyK,EAAKW,OAC/BwC,EAAanD,EAAKE,QAAQzY,MAAQ,QACxC,EAAQ6oC,UAAYiN,EACpB,EAAQyE,SAASu4B,EAAWT,EAAcrB,GAC1C,EAAQnoC,UAAYgqC,EACpB,EAAQt4B,SAAS7+B,EAAY42D,EAAgB,EAAQlnB,YAAY1vC,GAAYhhB,MAAOs2E,KAGtFmB,GAAWx3D,EAAMrnB,OAASs+E,EAAiB,GAC3C,MAAM72D,EAAaJ,EAAML,IAAc,KAEvC,EAAQ+/B,KAAO,qCACf,EAAQxR,UAAY,UACpB,EAAQ0R,SAAS,oBAAqB63B,EAAOD,GAC7CA,GAAW,GAEX,MAAMY,EAvGV,SAA4Bh4D,EAAYR,EAAakY,EAASC,GAC5D,IAAK3X,EACH,OAAO2X,EAET,MAAMj/B,EAAU8H,MAAMC,QAAQuf,EAAWZ,kBAAoBY,EAAWZ,iBAAmB,GAC3F,GAAuB,IAAnB1mB,EAAQH,OAIV,OAHA,EAAQu1C,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQE,SAAS,qCAAsC9nB,EAASC,GACzDA,EAAU,GAEnB,EAAQ2nB,KAAO,qCAEf,IAAI83B,EAAUz/C,EAQd,OAPAj/B,EAAQwhB,QAAQ,CAAC2B,EAAUg8D,KACzB,MAAMn6D,EAAS,GAAmB7B,GAC5B9I,EAAQ2K,GAAQzY,MAAQ4W,EAC9B,EAAQiyB,UAAY+pC,IAAQr4D,EAAc,UAAY,UACtD,EAAQggC,SAASzsC,EAAO2kB,EAAS0/C,GACjCA,GAPiB,KASZA,CACT,CAiF0Ba,CAAmBj4D,EAAYR,EAAa63D,EAAOD,GAGzE,GAFAA,EAAUxyE,KAAKmC,IAAIqwE,EAAU,GAAIY,EAAgB,GAE7Ch4D,GAAYtC,OAAQ,CACtB,MAAMA,EAASsC,EAAWtC,OAS1B,GARA,EAAQ4hC,KAAO,qCACf,EAAQxR,UAAY,UACpB,EAAQ0R,SAAS,aAAa9hC,EAAOzY,OAAQoyE,EAAOD,GACpDA,GAAW,GACX,EAAQtpC,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQE,SAAS,aAAa9hC,EAAO1P,UAAY,YAAaqpE,EAAOD,GACrEA,GAAW,GACP15D,EAAO3P,YAAa,CACtB,MAAMmqE,EAAWvC,EAAuB,EAAVwB,EAC9BC,GAA+E,GAvKvF,SAAyB/0E,EAAMpC,EAAGgC,EAAGi2E,GACnC,IAAK71E,EACH,OAAO,EAET,MAAM81E,EAAQtwB,OAAOxlD,GAAMyqC,MAAM,OACjC,IAAI0mB,EAAO,GACPM,EAAQ,EACZ,IAAK,MAAMskB,KAAQD,EAAO,CACxB,MAAMl6D,EAAYu1C,EAAKj7D,OAAS,EAAI,GAAGi7D,KAAQ4kB,IAASA,EACpD,EAAQ/nB,YAAYpyC,GAAWte,MAAQu4E,GAAY1kB,GACrD,EAAQhU,SAASgU,EAAMvzD,EAAGgC,GAC1BuxD,EAAO4kB,EACPn2E,GA2J2E,GA1J3E6xD,GAAS,GAETN,EAAOv1C,CAEX,CAKA,OAJIu1C,IACF,EAAQhU,SAASgU,EAAMvzD,EAAGgC,GAC1B6xD,GAAS,GAEJA,CACT,CAgJmBukB,CAAgB36D,EAAO3P,YAAaspE,EAAOD,EAASc,EACjE,CACF,CAEA,MAAMI,EAAUpB,EAASxB,EAAcyB,EACvC,EAAQ73B,KAAO,qCACf,EAAQxR,UAAY,UACpB,EAAQ0R,SAAS,+CAAgD63B,EAAOiB,EAC1E,CAEI1B,IAAgBt3D,GAxJtB,SAA4BG,EAAS+sB,EAAQ,GAC3C,MAAMnqC,EAAOwlD,OAAOpoC,GAAW,IAAI+E,OACnC,IAAKniB,EACH,OAEF,EAAQ8rC,OACR,EAAQ6G,YAAcxI,EACtB,EAAQ8S,KAAO,qCACf,MACMi5B,EAAY,EAAQloB,YAAYhuD,GAAM1C,MACtC64E,EAAW5zE,KAAK+E,IAAI,EAAQtK,OAAOM,MAAQ,GAAI44E,EAAYpB,IAIjE,EAAQrpC,UAAY,yBACpB,EAAQ0H,SAHE,GACA,GAEagjC,EAJL,IAKlB,EAAQpjC,YAAc,4BACtB,EAAQhc,UAAY,EACpB,EAAQqc,WAAWx1C,KAASgC,KAASu2E,EAAW,EAAGC,IACnD,EAAQ3qC,UAAY,UACpB,EAAQ0R,SAASn9C,EAAMpC,GAAagC,IACpC,EAAQysC,SACV,CAoIIgqC,CAAmBj5D,EADN7a,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI,EAAG+V,EAAe,MAItD,EAAQgvB,SACV,CD1HEiqC,GEZF,WACE,MAAM7jE,ElEiKR,WACE,MAAM,WAAE2I,GAAe,KACjB0E,EAAaO,KACbM,EAAiBvF,EAAW,GAAQmF,eAEpCg2D,GADUp4E,MAAMC,QAAQuiB,GAAgBtqB,SAAWsqB,EAAetqB,QAAU,IAClD0C,IAAI,CAACwmB,EAAQtnB,KAAU,IAClDsnB,EACHi3D,SAAU12D,EAAWa,GAAgBlqB,MAAQ8oB,EAAO9oB,GACpDwB,WAEF,MAAO,CACLglB,QAAS,GAAQA,QACjBsD,cAAe,GAAQA,cACvBpD,YAAa,GAAQA,YACrB/B,aACA0E,aACAzpB,QAASkgF,EACT51D,iBACAvD,QAAS,GAAQA,QACjBC,aAAc,GAAQA,aAE1B,CkEtLgBo5D,IACR,QACJx5D,EAAO,WACP7B,EAAa,GAAE,cACfmF,EAAgB,EAAC,YACjBpD,EAAc,EAAC,QACf9mB,EAAU,GAAE,eACZsqB,EAAiB,KAAI,WACrBb,EAAa,CAAC,EAAC,QACf1C,EAAU,KAAI,aACdC,EAAe,GACb5K,EACE8hE,EAAc9qD,QAAQrM,IAAYC,EAAe,IAEvD,IAAKJ,IAAYs3D,EACf,OAGF,MAAMj3E,EAAQ,EAAQN,OAAOM,MACvBF,EAAS,EAAQJ,OAAOI,OAE9B,GAAI6f,EAAS,CACX,EAAQ6uB,OACR,EAAQL,UAAY,wBACpB,EAAQ0H,SAAS,EAAG,EAAG71C,EAAOF,GAE9B,MAAMk2E,EAAa/wE,KAAK+E,IAAIhK,EAAQ,IAAK,KACnC+1E,EAAc9wE,KAAK+E,IAAIlK,EAAS,IAAK,KACrCw3E,EAAgC,IAAtBt3E,EAAQg2E,GAClBuB,EAAkC,IAAxBz3E,EAASi2E,GAEzB,EAAQ5nC,UAAY,yBACpB,EAAQ0H,SAASyhC,EAAQC,EAAQvB,EAAYD,GAC7C,EAAQtgC,YAAc,4BACtB,EAAQhc,UAAY,EACpB,EAAQqc,WAAWwhC,EAAS,GAAKC,EAAS,GAAKvB,EAAa,EAAGD,EAAc,GAE7E,MAAMyB,EAAU,GAChB,IAAIC,EAAUF,EAASC,EAAU,EACjC,MAAME,EAAQJ,EAASE,EAEvB,EAAQrpC,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQE,SAAS,yBAA0B63B,EAAOD,GAClDA,GAAW,GAEX,EAAQtpC,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQE,SAAS,2DAA4D63B,EAAOD,GACpFA,GAAW,GAEX,MAAM2B,EAAsB,IACtBC,EAAoB,GACpBC,EAAgB5B,EAAQ0B,EAAsB,GAC9CG,EAAiBjC,EAAStB,EAAawB,EAAU8B,EAEvD,EAAQ35B,KAAO,qCACf7hC,EAAWvD,QAAQ,CAAClM,EAAU1T,KAC5B,MAAM27E,EAAOmB,EAAU98E,EAAQ0+E,EACzBtjB,EAAWp7D,IAAUsoB,EACvB8yC,IACF,EAAQ5nB,UAAY,2BACpB,EAAQ0H,SAAS6hC,EAAQ,GAAIpB,EAAO,GAAI8C,EAAsB,GAAIC,IAEpE,EAAQlrC,UAAY4nB,EAAW,UAAY,UAC3C,EAAQlW,SAASxxC,EAAS+E,MAAOskE,EAAOpB,GACxC,MAAMhzD,EAAad,IAAanU,EAASlV,IACnCqgF,EAAiBnrE,EAAStV,SAAS+lB,KAAMmD,GAAWA,EAAO9oB,KAAOmqB,IAAe,KACnFk2D,IACF,EAAQrrC,UAAY4nB,EAAW,UAAY,UAC3C,EAAQpW,KAAO,qCACf,EAAQE,SAAS25B,EAAel0E,KAAMoyE,EAAOpB,EAAO,IACpD,EAAQ32B,KAAO,wCAInB,IAAI85B,EAAWhC,EACf,EAAQ93B,KAAO,qCACf,EAAQxR,UAAY,UACpB,EAAQ0R,SAASx8B,GAAgBjQ,OAAS,WAAYkmE,EAAeG,GACrEA,GAAY,GAEW,IAAnB1gF,EAAQH,QACV,EAAQu1C,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQE,SAAS,4CAA6Cy5B,EAAeG,GAC7EA,GAAY,IAEZ1gF,EAAQwhB,QAAQ,CAAC0H,EAAQi2D,KACvB,MAAMwB,EAAgBxB,IAAQr4D,EACxB85D,EAAa13D,EAAOi3D,SAC1B,EAAQv5B,KAAO,qCACf,EAAQxR,UAAYurC,EAAgB,UAAaC,EAAa,UAAY,UAC1E,MAAMxnC,EAASwnC,EAAa,KAAO,GACnC,EAAQ95B,SAAS,GAAG1N,IAASlwB,EAAO3c,OAAQg0E,EAAeG,GAC3DA,GAAY,KAIhB,MAAMG,EAAeH,EAAW,GAC1BD,EAAiBzgF,EAAQ8mB,IAAgB,KAC/C,GAAI25D,GAAgBprE,YAAa,CAC/B,EAAQ+/B,UAAY,UACpB,EAAQwR,KAAO,qCACf,MAAMwU,EA3JZ,SAAyBzxD,EAAMpC,EAAGgC,EAAGi2E,GACnC,MAAMC,EAAQtwB,OAAOxlD,GAAQ,IAAIyqC,MAAM,OAAOtzB,OAAOsS,SACrD,GAAqB,IAAjBqsD,EAAM5/E,OACR,OAAO,EAET,IAAIi7D,EAAO,GACP4jB,EAAUn1E,EACV6xD,EAAQ,EACZ,IAAK,MAAMskB,KAAQD,EAAO,CACxB,MAAMl6D,EAAYu1C,EAAKj7D,OAAS,EAAI,GAAGi7D,KAAQ4kB,IAASA,EACpD,EAAQ/nB,YAAYpyC,GAAWte,MAAQu4E,GAAY1kB,GACrD,EAAQhU,SAASgU,EAAMvzD,EAAGm3E,GAC1B5jB,EAAO4kB,EACPhB,GA8IuG,GA7IvGtjB,GAAS,GAETN,EAAOv1C,CAEX,CAKA,OAJIu1C,IACF,EAAQhU,SAASgU,EAAMvzD,EAAGm3E,GAC1BtjB,GAAS,GAEJA,CACT,CAmIoB,CAAgBqlB,EAAeprE,YAAakrE,EAAeM,EAAcL,GACvFE,EAAWG,EAAuB,GAARzlB,EAAa,EACzC,CAEA,MAAMwkB,EAAUpB,EAASxB,EAAcyB,EAAU,EACjD,EAAQrpC,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQE,SAAS,+CAAgD63B,EAAOiB,GAExE,EAAQ5pC,SACV,CAEIkoC,IAAgBt3D,GA7ItB,SAA2BG,EAAS+sB,EAAQ,GAC1C,MAAMnqC,EAAOwlD,OAAOpoC,GAAW,IAAI+E,OACnC,IAAKniB,EACH,OAEF,EAAQ8rC,OACR,EAAQ6G,YAAcpwC,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI,EAAG6iC,IAC9C,EAAQ8S,KAAO,qCACf,MACMi5B,EAAY,EAAQloB,YAAYhuD,GAAM1C,MACtC64E,EAAW5zE,KAAK+E,IAAI,EAAQtK,OAAOM,MAAQ,GAAI44E,EAAYpB,IAG3Dl1E,EAAI,EAAQ5C,OAAOI,OAFP,GAE4B,GAC9C,EAAQquC,UAAY,wBACpB,EAAQ0H,SAHE,GAGUvzC,EAAGu2E,EAJL,IAKlB,EAAQpjC,YAAc,4BACtB,EAAQhc,UAAY,EACpB,EAAQqc,WAAWx1C,KAASgC,EAAI,GAAKu2E,EAAW,EAAGC,IACnD,EAAQ3qC,UAAY,UACpB,EAAQ0R,SAASn9C,EAAMpC,GAAagC,EAAI,IACxC,EAAQysC,SACV,CAwHI8qC,CAAkB/5D,EAAS7a,KAAK+E,IAAI,EAAG+V,EAAe,IAE1D,CF3GE+5D,GVRF,WACE,MAAM3kE,EpDgNR,WACE,MAAMkP,EAAYI,KACZP,EAAWG,EAAU,GAAQzE,YAAc,KACjD,MAAO,CACLD,QAAS,GAAQA,QACjBC,UAAW,GAAQA,UACnB2F,WAAY,GAAQA,WACpBw0D,OAAQ10D,GACRnB,WACAG,YACA21D,gBAAiB91D,EAAW0B,GAAoB1B,EAAS7a,eAAiB,KAC1EyW,QAAS,GAAQA,QACjBC,aAAc,GAAQA,aAE1B,CoD9NgBk6D,IACR,QACJt6D,EAAO,WACP4F,EAAa,EAAC,OACdw0D,EAAS,GAAE,SACX71D,EAAQ,gBACR81D,EAAe,QACfl6D,EAAO,aACPC,EAAe,EAAC,UAChBH,EAAY,GACVzK,EAEE8hE,EAAc9qD,QAAQrM,IAAYC,EAAe,IACvD,IAAKJ,IAAYs3D,EACf,OAGF,MAAMj3E,EAAQ,EAAQN,OAAOM,MACvBF,EAAS,EAAQJ,OAAOI,OAE9B,GAAI6f,EAAS,CACX,EAAQ6uB,OACR,EAAQL,UAAY,wBACpB,EAAQ0H,SAAS,EAAG,EAAG71C,EAAOF,GAE9B,MAAMk2E,EAAa/wE,KAAK+E,IAAIhK,EAAQ,IAAK,KACnC+1E,EAAc9wE,KAAK+E,IAAIlK,EAAS,IAAK,KACrCw3E,EAAgC,IAAtBt3E,EAAQg2E,GAClBuB,EAAkC,IAAxBz3E,EAASi2E,GAEzB,EAAQ5nC,UAAY,yBACpB,EAAQ0H,SAASyhC,EAAQC,EAAQvB,EAAYD,GAC7C,EAAQtgC,YAAc,4BACtB,EAAQhc,UAAY,EACpB,EAAQqc,WAAWwhC,EAAS,GAAKC,EAAS,GAAKvB,EAAa,EAAGD,EAAc,GAE7E,MAAMyB,EAAU,GAChB,IAAIC,EAAUF,EAASC,EACvB,MAAME,EAAQJ,EAASE,EACjB0C,EAAS5C,EAAStB,EAAawB,EAErC,EAAQrpC,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQE,SAAS,kBAAmB63B,EAAOD,GAC3CA,GAAW,GAEX,EAAQtpC,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQE,SAAS,2EAA4E63B,EAAOD,GACpGA,GAAW,GAEX,EAAQ93B,KAAO,qCACf,EAAQxR,UAAY,UACpB,MAAMgsC,EAAgBj2D,EAAW,GAAGtE,EAAY,MAAMsE,EAAS5e,OAAS,QAAQsa,EAAY,IAC5F,EAAQigC,SAASs6B,EAAezC,EAAOD,GACvCA,GAAW,GAEX,MAAM2C,EAAa31D,KAAmB7rB,OAEtC,EAAQ+mD,KAAO,qCACfo6B,EAAOx/D,QAAQ,CAACqK,EAAOjqB,KACrB,IAAI0/E,EAAY,KAChB,GAAKn2D,EAGH,OAAQU,EAAMzrB,IACZ,IAAK,eACHkhF,EAAY,GAAGz6D,EAAY,OAAOw6D,IAClC,MACF,IAAK,OACHC,EAAYn2D,EAAS5e,KACrB,MACF,IAAK,gBACH+0E,EAAYL,EACZ,MACF,IAAK,oBACHK,EAAY,GAAGn2D,EAASN,oBACxB,MACF,IAAK,aACHy2D,EAAY,GAAGn2D,EAASL,aACxB,MACF,IAAK,mBACHw2D,EAAYhiB,GAAcn0C,EAASJ,kBACnC,MACF,IAAK,kBACHu2D,EAAYhiB,GAAcn0C,EAASH,iBACnC,MACF,IAAK,iBACHs2D,EAAYhiB,GAAcn0C,EAASF,mBAAmB,IACtD,MACF,IAAK,kBACHq2D,EAAYhiB,GAAcn0C,EAASF,mBAAmB,IACtD,MACF,IAAK,cACHq2D,EAAYn2D,EAAS9V,aAAe,GACpC,MACF,QACEisE,EAAY,QAlChBA,EAAY,MAuCd,MAAM/D,EAAOmB,EAAkB,GAAR98E,EACjBo7D,EAAWp7D,IAAU4qB,EACvBwwC,IACF,EAAQ5nB,UAAY,0BACpB,EAAQ0H,SAAS6hC,EAAQ,GAAIpB,EAAO,GAAIN,EAAuB,EAAVwB,EAAc,GAAI,KAGzE,EAAQrpC,UAAY4nB,EAAW,UAAY,UAC3C,EAAQlW,SAASj7B,EAAMxR,MAAOskE,EAAOpB,GAErC,EAAQnoC,UAAY4nB,EAAW,UAAY,UAC3C,EAAQpW,KAAoB,gBAAb/6B,EAAMzrB,GAAuB,qCAAuC,qCACnF,MAAMy/E,EAAY,EAAQloB,YAAY2pB,GAAWr6E,MACjD,EAAQ6/C,SAASw6B,EAAWp1E,KAAKmC,IAAIswE,EAAOwC,EAAStB,GAAYtC,GACjE,EAAQ32B,KAAO,uCAGjB,IAAI26B,EAAiB7C,EAA0B,GAAhBsC,EAAOnhF,OAAc,GACpD,GAAIsrB,GAAU9V,YAAa,CACzB,EAAQ+/B,UAAY,UACpB,EAAQwR,KAAO,qCACf,MAAM44B,EAAWvC,EAAuB,EAAVwB,EACxBrjB,EAnLZ,SAAyBzxD,EAAMpC,EAAGgC,EAAGi2E,GACnC,MAAMC,EAAQtwB,OAAOxlD,GAAQ,IAAIyqC,MAAM,OAAOtzB,OAAOsS,SACrD,GAAqB,IAAjBqsD,EAAM5/E,OACR,OAAO,EAET,IAAIi7D,EAAO,GACP4jB,EAAUn1E,EACV6xD,EAAQ,EACZ,IAAK,MAAMskB,KAAQD,EAAO,CACxB,MAAMl6D,EAAYu1C,EAAKj7D,OAAS,EAAI,GAAGi7D,KAAQ4kB,IAASA,EACpD,EAAQ/nB,YAAYpyC,GAAWte,MAAQu4E,GAAY1kB,GACrD,EAAQhU,SAASgU,EAAMvzD,EAAGm3E,GAC1B5jB,EAAO4kB,EACPhB,GAsKqF,GArKrFtjB,GAAS,GAETN,EAAOv1C,CAEX,CAKA,OAJIu1C,IACF,EAAQhU,SAASgU,EAAMvzD,EAAGm3E,GAC1BtjB,GAAS,GAEJA,CACT,CA2JoB,CAAgBjwC,EAAS9V,YAAaspE,EAAO4C,EAAgB/B,GAC3E+B,GAA0B,GAARnmB,EAAa,CACjC,CAEA,MAAMwkB,EAAUpB,EAASxB,EAAcyB,EAAU,EACjD,EAAQrpC,UAAY,UACpB,EAAQwR,KAAO,qCACf,EAAQE,SAAS,4DAA6D63B,EAAOiB,GAErF,EAAQ5pC,SACV,CAEIkoC,IAAgBt3D,GArKtB,SAA2BG,EAAS+sB,EAAQ,GAC1C,MAAMnqC,EAAOwlD,OAAOpoC,GAAW,IAAI+E,OACnC,IAAKniB,EACH,OAEF,EAAQ8rC,OACR,EAAQ6G,YAAcpwC,KAAKmC,IAAI,EAAGnC,KAAK+E,IAAI,EAAG6iC,IAC9C,EAAQ8S,KAAO,qCACf,MACMi5B,EAAY,EAAQloB,YAAYhuD,GAAM1C,MACtC64E,EAAW5zE,KAAK+E,IAAI,EAAQtK,OAAOM,MAAQ,GAAI44E,EAAYpB,IAE3Dl3E,EAAI,EAAQZ,OAAOM,MAAQ64E,EAAW,GACtCv2E,EAAI,EAAQ5C,OAAOI,OAFP,GAE4B,GAC9C,EAAQquC,UAAY,yBACpB,EAAQ0H,SAASv1C,EAAGgC,EAAGu2E,EAJL,IAKlB,EAAQpjC,YAAc,4BACtB,EAAQhc,UAAY,EACpB,EAAQqc,WAAWx1C,EAAI,GAAKgC,EAAI,GAAKu2E,EAAW,EAAGC,IACnD,EAAQ3qC,UAAY,UACpB,EAAQ0R,SAASn9C,EAAMpC,EAZP,GAYoBgC,EAAI,IACxC,EAAQysC,SACV,CAgJIwrC,CAAkBz6D,EAAS7a,KAAK+E,IAAI,EAAG+V,EAAe,IAE1D,CUnIEy6D,GAEAj9E,OAAO8zE,sBAAsBjlD,EAC/B,E","sources":["webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/styleTagTransform.js","webpack://project-stickfigure/./node_modules/css-loader/dist/runtime/api.js","webpack://project-stickfigure/./node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://project-stickfigure/./src/styles.css","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/insertStyleElement.js","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/insertBySelector.js","webpack://project-stickfigure/./node_modules/style-loader/dist/runtime/styleDomAPI.js","webpack://project-stickfigure/webpack/bootstrap","webpack://project-stickfigure/webpack/runtime/compat get default export","webpack://project-stickfigure/webpack/runtime/define property getters","webpack://project-stickfigure/webpack/runtime/hasOwnProperty shorthand","webpack://project-stickfigure/webpack/runtime/nonce","webpack://project-stickfigure/./src/styles.css?44b2","webpack://project-stickfigure/./src/environment/canvas.js","webpack://project-stickfigure/./src/config/environments.js","webpack://project-stickfigure/./src/state/resources.js","webpack://project-stickfigure/./src/state/environment.js","webpack://project-stickfigure/./src/state/camera.js","webpack://project-stickfigure/./src/core/input/index.js","webpack://project-stickfigure/./src/config/weapons.js","webpack://project-stickfigure/./src/config/constants.js","webpack://project-stickfigure/./src/config/squad.js","webpack://project-stickfigure/./src/state/entities.js","webpack://project-stickfigure/./src/state/weapons.js","webpack://project-stickfigure/./src/state/ammo.js","webpack://project-stickfigure/./src/core/combat/weapons.js","webpack://project-stickfigure/./src/config/loadouts.js","webpack://project-stickfigure/./src/state/loadout.js","webpack://project-stickfigure/./src/core/loadout/index.js","webpack://project-stickfigure/./src/config/cosmetics.js","webpack://project-stickfigure/./src/state/cosmetics.js","webpack://project-stickfigure/./src/core/cosmetics/index.js","webpack://project-stickfigure/./src/state/scenarios.js","webpack://project-stickfigure/./src/core/scenario/index.js","webpack://project-stickfigure/./src/core/audio/index.js","webpack://project-stickfigure/./src/core/network/p2p.js","webpack://project-stickfigure/./src/config/network.js","webpack://project-stickfigure/./src/state/serverBrowser.js","webpack://project-stickfigure/./src/state/vehicles.js","webpack://project-stickfigure/./src/core/utils/math.js","webpack://project-stickfigure/./src/core/utils/time.js","webpack://project-stickfigure/./src/config/survival.js","webpack://project-stickfigure/./src/state/survival.js","webpack://project-stickfigure/./src/core/effects/ragdoll.js","webpack://project-stickfigure/./src/core/effects/damage.js","webpack://project-stickfigure/./src/core/effects/particles.js","webpack://project-stickfigure/./src/core/gadgets/turret.js","webpack://project-stickfigure/./src/core/gadgets/grapple.js","webpack://project-stickfigure/./src/core/gadgets/shield.js","webpack://project-stickfigure/./src/core/gadgets/index.js","webpack://project-stickfigure/./src/core/world/enemySpawner.js","webpack://project-stickfigure/./src/config/spawn.js","webpack://project-stickfigure/./src/core/survival/index.js","webpack://project-stickfigure/./src/config/campaign.js","webpack://project-stickfigure/./src/state/campaign.js","webpack://project-stickfigure/./src/core/campaign/index.js","webpack://project-stickfigure/./src/core/sandbox/index.js","webpack://project-stickfigure/./src/core/combat/damageHandlers.js","webpack://project-stickfigure/./src/config/destructibles.js","webpack://project-stickfigure/./src/state/destructibles.js","webpack://project-stickfigure/./src/core/combat/explosions.js","webpack://project-stickfigure/./src/core/world/destructibles.js","webpack://project-stickfigure/./src/config/buildings.js","webpack://project-stickfigure/./src/state/buildings.js","webpack://project-stickfigure/./src/core/effects/lighting.js","webpack://project-stickfigure/./src/core/combat/projectiles.js","webpack://project-stickfigure/./src/core/combat/throwables.js","webpack://project-stickfigure/./src/core/render/culling.js","webpack://project-stickfigure/./src/config/supplyDrops.js","webpack://project-stickfigure/./src/core/world/supplyDrops.js","webpack://project-stickfigure/./src/core/render/supplyDrops.js","webpack://project-stickfigure/./src/core/aim/index.js","webpack://project-stickfigure/./src/core/render/stickFigure.js","webpack://project-stickfigure/./src/core/render/destructibles.js","webpack://project-stickfigure/./src/core/building/index.js","webpack://project-stickfigure/./src/state/coop.js","webpack://project-stickfigure/./src/config/interactables.js","webpack://project-stickfigure/./src/state/interactables.js","webpack://project-stickfigure/./src/core/render/interactables.js","webpack://project-stickfigure/./src/core/events/polishDebug.js","webpack://project-stickfigure/./src/state/recoil.js","webpack://project-stickfigure/./src/core/world/arena.js","webpack://project-stickfigure/./src/core/squad/index.js","webpack://project-stickfigure/./src/core/vehicles/index.js","webpack://project-stickfigure/./src/core/render/index.js","webpack://project-stickfigure/./src/core/render/scenario.js","webpack://project-stickfigure/./src/core/combat/playerActions.js","webpack://project-stickfigure/./src/core/world/interactables.js","webpack://project-stickfigure/./src/core/combat/melee.js","webpack://project-stickfigure/./src/core/coop/index.js","webpack://project-stickfigure/./src/core/world/enemyAI.js","webpack://project-stickfigure/./src/core/network/serverBrowser.js","webpack://project-stickfigure/./src/core/world/update.js","webpack://project-stickfigure/./src/core/resources/index.js","webpack://project-stickfigure/./src/core/world/trainingDummy.js","webpack://project-stickfigure/./src/main.js","webpack://project-stickfigure/./src/core/render/loadout.js","webpack://project-stickfigure/./src/core/render/cosmetics.js"],"sourcesContent":["\"use strict\";\n\n/* istanbul ignore next  */\nfunction setAttributesWithoutAttributes(styleElement) {\n  var nonce = typeof __webpack_nonce__ !== \"undefined\" ? __webpack_nonce__ : null;\n  if (nonce) {\n    styleElement.setAttribute(\"nonce\", nonce);\n  }\n}\nmodule.exports = setAttributesWithoutAttributes;","\"use strict\";\n\nvar stylesInDOM = [];\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n  for (var i = 0; i < stylesInDOM.length; i++) {\n    if (stylesInDOM[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n}\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var indexByIdentifier = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3],\n      supports: item[4],\n      layer: item[5]\n    };\n    if (indexByIdentifier !== -1) {\n      stylesInDOM[indexByIdentifier].references++;\n      stylesInDOM[indexByIdentifier].updater(obj);\n    } else {\n      var updater = addElementStyle(obj, options);\n      options.byIndex = i;\n      stylesInDOM.splice(i, 0, {\n        identifier: identifier,\n        updater: updater,\n        references: 1\n      });\n    }\n    identifiers.push(identifier);\n  }\n  return identifiers;\n}\nfunction addElementStyle(obj, options) {\n  var api = options.domAPI(options);\n  api.update(obj);\n  var updater = function updater(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap && newObj.supports === obj.supports && newObj.layer === obj.layer) {\n        return;\n      }\n      api.update(obj = newObj);\n    } else {\n      api.remove();\n    }\n  };\n  return updater;\n}\nmodule.exports = function (list, options) {\n  options = options || {};\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDOM[index].references--;\n    }\n    var newLastIdentifiers = modulesToDom(newList, options);\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n      var _index = getIndexByIdentifier(_identifier);\n      if (stylesInDOM[_index].references === 0) {\n        stylesInDOM[_index].updater();\n        stylesInDOM.splice(_index, 1);\n      }\n    }\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","\"use strict\";\n\n/* istanbul ignore next  */\nfunction styleTagTransform(css, styleElement) {\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css;\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild);\n    }\n    styleElement.appendChild(document.createTextNode(css));\n  }\n}\nmodule.exports = styleTagTransform;","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `* {\r\n  box-sizing: border-box;\r\n}\r\n\r\nbody {\r\n  margin: 0;\r\n  background-color: #0f1115;\r\n  color: #f0f3f7;\r\n  font-family: \"Segoe UI\", Arial, sans-serif;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  min-height: 100vh;\r\n}\r\n\r\ncanvas {\r\n  border: 2px solid #2a2d34;\r\n  background: linear-gradient(180deg, #1d2129 0%, #14161c 100%);\r\n  width: min(90vw, 960px);\r\n  max-width: 100%;\r\n  height: auto;\r\n}\r\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/styles.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,sBAAsB;AACxB;;AAEA;EACE,SAAS;EACT,yBAAyB;EACzB,cAAc;EACd,0CAA0C;EAC1C,aAAa;EACb,mBAAmB;EACnB,uBAAuB;EACvB,iBAAiB;AACnB;;AAEA;EACE,yBAAyB;EACzB,6DAA6D;EAC7D,uBAAuB;EACvB,eAAe;EACf,YAAY;AACd\",\"sourcesContent\":[\"* {\\r\\n  box-sizing: border-box;\\r\\n}\\r\\n\\r\\nbody {\\r\\n  margin: 0;\\r\\n  background-color: #0f1115;\\r\\n  color: #f0f3f7;\\r\\n  font-family: \\\"Segoe UI\\\", Arial, sans-serif;\\r\\n  display: flex;\\r\\n  align-items: center;\\r\\n  justify-content: center;\\r\\n  min-height: 100vh;\\r\\n}\\r\\n\\r\\ncanvas {\\r\\n  border: 2px solid #2a2d34;\\r\\n  background: linear-gradient(180deg, #1d2129 0%, #14161c 100%);\\r\\n  width: min(90vw, 960px);\\r\\n  max-width: 100%;\\r\\n  height: auto;\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/* istanbul ignore next  */\nfunction insertStyleElement(options) {\n  var element = document.createElement(\"style\");\n  options.setAttributes(element, options.attributes);\n  options.insert(element, options.options);\n  return element;\n}\nmodule.exports = insertStyleElement;","\"use strict\";\n\nvar memo = {};\n\n/* istanbul ignore next  */\nfunction getTarget(target) {\n  if (typeof memo[target] === \"undefined\") {\n    var styleTarget = document.querySelector(target);\n\n    // Special case to return head of iframe instead of iframe itself\n    if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n      try {\n        // This will throw an exception if access to iframe is blocked\n        // due to cross-origin restrictions\n        styleTarget = styleTarget.contentDocument.head;\n      } catch (e) {\n        // istanbul ignore next\n        styleTarget = null;\n      }\n    }\n    memo[target] = styleTarget;\n  }\n  return memo[target];\n}\n\n/* istanbul ignore next  */\nfunction insertBySelector(insert, style) {\n  var target = getTarget(insert);\n  if (!target) {\n    throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n  }\n  target.appendChild(style);\n}\nmodule.exports = insertBySelector;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction apply(styleElement, options, obj) {\n  var css = \"\";\n  if (obj.supports) {\n    css += \"@supports (\".concat(obj.supports, \") {\");\n  }\n  if (obj.media) {\n    css += \"@media \".concat(obj.media, \" {\");\n  }\n  var needLayer = typeof obj.layer !== \"undefined\";\n  if (needLayer) {\n    css += \"@layer\".concat(obj.layer.length > 0 ? \" \".concat(obj.layer) : \"\", \" {\");\n  }\n  css += obj.css;\n  if (needLayer) {\n    css += \"}\";\n  }\n  if (obj.media) {\n    css += \"}\";\n  }\n  if (obj.supports) {\n    css += \"}\";\n  }\n  var sourceMap = obj.sourceMap;\n  if (sourceMap && typeof btoa !== \"undefined\") {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  }\n\n  // For old IE\n  /* istanbul ignore if  */\n  options.styleTagTransform(css, styleElement, options.options);\n}\nfunction removeStyleElement(styleElement) {\n  // istanbul ignore if\n  if (styleElement.parentNode === null) {\n    return false;\n  }\n  styleElement.parentNode.removeChild(styleElement);\n}\n\n/* istanbul ignore next  */\nfunction domAPI(options) {\n  if (typeof document === \"undefined\") {\n    return {\n      update: function update() {},\n      remove: function remove() {}\n    };\n  }\n  var styleElement = options.insertStyleElement(options);\n  return {\n    update: function update(obj) {\n      apply(styleElement, options, obj);\n    },\n    remove: function remove() {\n      removeStyleElement(styleElement);\n    }\n  };\n}\nmodule.exports = domAPI;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","__webpack_require__.nc = undefined;","\n      import API from \"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../node_modules/css-loader/dist/cjs.js!./styles.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../node_modules/css-loader/dist/cjs.js!./styles.css\";\n       export default content && content.locals ? content.locals : undefined;\n","const canvas = document.getElementById(\"game-canvas\");\nconst context = canvas.getContext(\"2d\");\n\nif (!context) {\n  throw new Error(\"Canvas 2D context not available.\");\n}\n\nconst GROUND_Y = canvas.height - 60;\n\nexport { canvas, context, GROUND_Y };\r\n","import { canvas, GROUND_Y } from \"../environment/canvas.js\";\r\n\r\nconst LEVEL_SCALE = 4;\r\nconst baseLevelWidth = canvas.width;\r\nconst levelWidth = baseLevelWidth * LEVEL_SCALE;\r\nconst baseGround = GROUND_Y;\r\n\r\nfunction scaleX(value) {\r\n  return typeof value === \"number\" ? value * LEVEL_SCALE : value;\r\n}\r\n\r\nfunction scalePlatforms(list) {\r\n  return list.map((platform) => ({\r\n    ...platform,\r\n    x: scaleX(platform.x),\r\n    width: scaleX(platform.width)\r\n  }));\r\n}\r\n\r\nfunction scaleWaterZones(list) {\r\n  return list.map((zone) => ({\r\n    ...zone,\r\n    x: scaleX(zone.x),\r\n    width: scaleX(zone.width)\r\n  }));\r\n}\r\n\r\nfunction scaleDecor(list) {\r\n  return list.map((decor) => {\r\n    const scaled = { ...decor };\r\n    if (typeof scaled.x === \"number\") {\r\n      scaled.x = scaleX(scaled.x);\r\n    }\r\n    if (typeof scaled.baseX === \"number\") {\r\n      scaled.baseX = scaleX(scaled.baseX);\r\n    }\r\n    if (typeof scaled.width === \"number\") {\r\n      scaled.width = scaleX(scaled.width);\r\n    }\r\n    if (Array.isArray(scaled.points)) {\r\n      scaled.points = scaled.points.map((point) => ({\r\n        ...point,\r\n        x: scaleX(point.x)\r\n      }));\r\n    }\r\n    return scaled;\r\n  });\r\n}\r\n\r\nfunction scaleDestructibles(list) {\r\n  return list.map((item) => ({\r\n    ...item,\r\n    x: scaleX(item.x)\r\n  }));\r\n}\r\n\r\nfunction scaleInteractables(list) {\r\n  return list.map((item) => ({\r\n    ...item,\r\n    x: scaleX(item.x),\r\n    minX: scaleX(item.minX),\r\n    maxX: scaleX(item.maxX)\r\n  }));\r\n}\r\n\r\nfunction scaleAmbientLights(list) {\r\n  return list.map((light) => ({\r\n    ...light,\r\n    x: scaleX(light.x),\r\n    radius: typeof light.radius === \"number\" ? light.radius * LEVEL_SCALE : light.radius\r\n  }));\r\n}\r\n\r\nfunction addCentralWater(zones, overrides = {}) {\r\n  const widthRatio = overrides.widthRatio ?? 0.05;\r\n  const width = levelWidth * widthRatio;\r\n  const x = levelWidth * 0.5 - width / 2;\r\n  const topOffset = overrides.topOffset ?? 18;\r\n  const depth = overrides.depth ?? 26;\r\n  const centralZone = {\r\n    x,\r\n    width,\r\n    top: baseGround - topOffset,\r\n    depth,\r\n    highlight: overrides.highlight,\r\n    highlightColor: overrides.highlightColor,\r\n    topColor: overrides.topColor,\r\n    midColor: overrides.midColor,\r\n    bottomColor: overrides.bottomColor,\r\n    rippleColor: overrides.rippleColor\r\n  };\r\n  return [...zones, centralZone];\r\n}\r\n\r\nconst neoPlatforms = scalePlatforms([\r\n  { x: -240, y: baseGround - 26, width: 520, height: 26, type: \"street\" },\r\n  { x: 320, y: baseGround - 26, width: 420, height: 26, type: \"street\" },\r\n  { x: 820, y: baseGround - 26, width: 380, height: 26, type: \"street\" },\r\n  { x: 1220, y: baseGround - 26, width: 520, height: 26, type: \"street\" },\r\n  { x: 40, y: baseGround - 120, width: 260, height: 18, type: \"metro\" },\r\n  { x: 360, y: baseGround - 180, width: 280, height: 16, type: \"rooftop\" },\r\n  { x: 680, y: baseGround - 240, width: 220, height: 16, type: \"skybridge\" },\r\n  { x: 960, y: baseGround - 180, width: 320, height: 18, type: \"rooftop\" },\r\n  { x: 1240, y: baseGround - 140, width: 280, height: 16, type: \"terrace\" },\r\n  { x: 1460, y: baseGround - 220, width: 200, height: 14, type: \"balcony\" },\r\n  { x: 600, y: baseGround - 88, width: 260, height: 14, type: \"median\" },\r\n  { x: 980, y: baseGround - 96, width: 320, height: 14, type: \"median\" }\r\n]);\r\n\r\nconst neoWaterZones = addCentralWater(\r\n  scaleWaterZones([\r\n    { x: 580, width: 220, top: baseGround - 16, depth: 18 }\r\n  ]),\r\n  {\r\n    topOffset: 20,\r\n    depth: 28,\r\n    topColor: \"rgba(60, 112, 168, 0.88)\",\r\n    midColor: \"rgba(36, 76, 128, 0.92)\",\r\n    bottomColor: \"rgba(20, 48, 92, 0.95)\",\r\n    rippleColor: \"rgba(190, 220, 255, 0.2)\",\r\n    highlightColor: \"rgba(255, 236, 180, 0.25)\"\r\n  }\r\n);\r\n\r\nconst neoDecor = scaleDecor([\r\n  { type: \"building\", x: -120, y: baseGround - 360, width: 220, height: 360 },\r\n  { type: \"building\", x: 220, y: baseGround - 420, width: 180, height: 420 },\r\n  { type: \"building\", x: 520, y: baseGround - 360, width: 260, height: 360 },\r\n  { type: \"building\", x: 860, y: baseGround - 440, width: 220, height: 440 },\r\n  { type: \"building\", x: 1120, y: baseGround - 400, width: 260, height: 400 },\r\n  { type: \"building\", x: 1400, y: baseGround - 360, width: 200, height: 360 },\r\n  { type: \"billboard\", x: 320, y: baseGround - 210, width: 180, height: 90, text: \"Neo District\" },\r\n  { type: \"billboard\", x: 1040, y: baseGround - 230, width: 200, height: 96, text: \"Rail 7\" },\r\n  { type: \"streetlight\", x: 180, y: baseGround - 160 },\r\n  { type: \"streetlight\", x: 760, y: baseGround - 160 },\r\n  { type: \"streetlight\", x: 1280, y: baseGround - 160 },\r\n  { type: \"hovercar\", x: 560, y: baseGround - 120 },\r\n  { type: \"hovercar\", x: 1180, y: baseGround - 150 }\r\n]);\r\n\r\nconst neoDestructibles = scaleDestructibles([\r\n  { id: \"neo-barrier-west\", type: \"concreteBarrier\", x: 260, baseY: baseGround },\r\n  { id: \"neo-barrier-east\", type: \"concreteBarrier\", x: 1140, baseY: baseGround },\r\n  { id: \"neo-car-market\", type: \"streetCar\", x: 620, baseY: baseGround, facing: -1 },\r\n  { id: \"neo-car-docks\", type: \"streetCar\", x: 1340, baseY: baseGround, facing: 1 },\r\n  { id: \"neo-barrels-market\", type: \"fuelBarrelCluster\", x: 440, baseY: baseGround - 26 },\r\n  { id: \"neo-barrels-rail\", type: \"fuelBarrelCluster\", x: 920, baseY: baseGround - 26 }\r\n]);\r\n\r\nconst neoInteractables = scaleInteractables([\r\n  { id: \"neo-crate-market\", type: \"pushCrate\", x: 480, baseY: baseGround - 26, minX: 200, maxX: 860 },\r\n  { id: \"neo-crate-rooftop\", type: \"pushCrate\", x: 520, baseY: baseGround - 180, minX: 380, maxX: 620 },\r\n  { id: \"neo-barrel-metro\", type: \"kickBarrel\", x: 180, baseY: baseGround - 120, minX: 60, maxX: 280 },\r\n  { id: \"neo-barrel-skybridge\", type: \"kickBarrel\", x: 780, baseY: baseGround - 240, minX: 700, maxX: 880 },\r\n  { id: \"neo-trap-median\", type: \"shockTrap\", x: 680, baseY: baseGround - 88 },\r\n  { id: \"neo-trap-gate\", type: \"shockTrap\", x: 1260, baseY: baseGround - 26 }\r\n]);\r\n\r\nconst neoAmbientLights = scaleAmbientLights([\r\n  { id: \"neo-street-0\", type: \"point\", x: 180, y: baseGround - 160, radius: 220, intensity: 0.55, color: \"#8faaff\", smoothing: 6, flicker: 0.12 },\r\n  { id: \"neo-street-1\", type: \"point\", x: 760, y: baseGround - 160, radius: 220, intensity: 0.55, color: \"#8faaff\", smoothing: 6, flicker: 0.12 },\r\n  { id: \"neo-street-2\", type: \"point\", x: 1280, y: baseGround - 160, radius: 220, intensity: 0.55, color: \"#8faaff\", smoothing: 6, flicker: 0.12 }\r\n]);\r\n\r\nconst verdantPlatforms = scalePlatforms([\r\n  { x: -280, y: baseGround - 24, width: 520, height: 24, type: \"jungleFloor\" },\r\n  { x: 320, y: baseGround - 24, width: 420, height: 24, type: \"jungleFloor\" },\r\n  { x: 820, y: baseGround - 30, width: 380, height: 24, type: \"jungleFloor\" },\r\n  { x: 1220, y: baseGround - 36, width: 420, height: 26, type: \"jungleFloor\" },\r\n  { x: 120, y: baseGround - 150, width: 260, height: 18, type: \"stone\" },\r\n  { x: 460, y: baseGround - 210, width: 280, height: 16, type: \"canopy\" },\r\n  { x: 780, y: baseGround - 190, width: 240, height: 16, type: \"branch\" },\r\n  { x: 1120, y: baseGround - 250, width: 220, height: 14, type: \"branch\" }\r\n]);\r\n\r\nconst verdantWater = addCentralWater(\r\n  scaleWaterZones([\r\n    { x: 240, width: 280, top: baseGround - 16, depth: 14 },\r\n    { x: 940, width: 210, top: baseGround - 12, depth: 12 }\r\n  ]),\r\n  {\r\n    topOffset: 18,\r\n    depth: 24,\r\n    topColor: \"rgba(56, 128, 92, 0.85)\",\r\n    midColor: \"rgba(40, 96, 72, 0.88)\",\r\n    bottomColor: \"rgba(24, 64, 52, 0.93)\",\r\n    rippleColor: \"rgba(200, 255, 214, 0.22)\",\r\n    highlightColor: \"rgba(144, 255, 200, 0.22)\"\r\n  }\r\n);\r\n\r\nconst verdantDecor = scaleDecor([\r\n  { type: \"palm\", baseX: -60, baseY: baseGround, height: 220 },\r\n  { type: \"palm\", baseX: 220, baseY: baseGround - 8, height: 210 },\r\n  { type: \"palm\", baseX: 520, baseY: baseGround - 12, height: 240 },\r\n  { type: \"palm\", baseX: 960, baseY: baseGround - 10, height: 220 },\r\n  { type: \"ruin\", x: 440, y: baseGround - 220, width: 160, height: 190 },\r\n  { type: \"ruin\", x: 1080, y: baseGround - 240, width: 180, height: 210 },\r\n  { type: \"vineArch\", x: 760, y: baseGround - 170, width: 200, height: 140 },\r\n  { type: \"glowPlant\", x: 320, y: baseGround - 60 },\r\n  { type: \"glowPlant\", x: 980, y: baseGround - 58 },\r\n  { type: \"waterfall\", x: 1180, y: baseGround - 60, width: 90, height: 220 }\r\n]);\r\n\r\nconst verdantDestructibles = scaleDestructibles([\r\n  { id: \"wilds-timber-west\", type: \"timberWall\", x: 260, baseY: baseGround },\r\n  { id: \"wilds-timber-east\", type: \"timberWall\", x: 1220, baseY: baseGround },\r\n  {\r\n    id: \"wilds-spore-cell\",\r\n    type: \"plasmaCell\",\r\n    x: 520,\r\n    baseY: baseGround - 120,\r\n    templateOverrides: {\r\n      bodyColor: \"#2e9a63\",\r\n      accentColor: \"#8cffc1\",\r\n      stripeColor: \"#6bffad\",\r\n      damageHighlight: \"#b6ffd6\",\r\n      debrisColor: \"#1c5e3a\"\r\n    }\r\n  },\r\n  {\r\n    id: \"wilds-cache\",\r\n    type: \"sandbagLine\",\r\n    x: 880,\r\n    baseY: baseGround - 24,\r\n    templateOverrides: {\r\n      bodyColor: \"#4b6036\",\r\n      accentColor: \"#92b56a\",\r\n      damageHighlight: \"#c8e8a4\",\r\n      debrisColor: \"#2e4125\"\r\n    }\r\n  }\r\n]);\r\n\r\nconst verdantInteractables = scaleInteractables([\r\n  {\r\n    id: \"wilds-crate-lower\",\r\n    type: \"pushCrate\",\r\n    x: 360,\r\n    baseY: baseGround - 24,\r\n    minX: 160,\r\n    maxX: 560,\r\n    templateOverrides: {\r\n      bodyColor: \"#5f7a45\",\r\n      edgeColor: \"#2f4022\",\r\n      braceColor: \"#9fbd67\",\r\n      highlightColor: \"#d9ff8a\"\r\n    }\r\n  },\r\n  {\r\n    id: \"wilds-crate-canopy\",\r\n    type: \"pushCrate\",\r\n    x: 540,\r\n    baseY: baseGround - 210,\r\n    minX: 420,\r\n    maxX: 640,\r\n    templateOverrides: {\r\n      bodyColor: \"#4e6d3a\",\r\n      edgeColor: \"#283b1c\",\r\n      braceColor: \"#8fb76a\",\r\n      highlightColor: \"#c8ff99\"\r\n    }\r\n  },\r\n  {\r\n    id: \"wilds-barrel\",\r\n    type: \"kickBarrel\",\r\n    x: 200,\r\n    baseY: baseGround - 24,\r\n    minX: 80,\r\n    maxX: 360,\r\n    templateOverrides: {\r\n      bodyColor: \"#2f8f5d\",\r\n      stripeColor: \"#7dff9e\",\r\n      edgeColor: \"#174027\",\r\n      topColor: \"#44b574\"\r\n    }\r\n  },\r\n  {\r\n    id: \"wilds-trap\",\r\n    type: \"shockTrap\",\r\n    x: 700,\r\n    baseY: baseGround - 24,\r\n    templateOverrides: {\r\n      bodyColor: \"#1d3b2c\",\r\n      accentColor: \"#59ffbd\",\r\n      glowColor: \"#86ffd7\"\r\n    }\r\n  }\r\n]);\r\n\r\nconst verdantAmbientLights = scaleAmbientLights([\r\n  { id: \"wilds-glow-0\", type: \"point\", x: 320, y: baseGround - 80, radius: 220, intensity: 0.85, color: \"#78ffbf\", smoothing: 6, flicker: 0.35 },\r\n  { id: \"wilds-glow-1\", type: \"point\", x: 980, y: baseGround - 76, radius: 210, intensity: 0.82, color: \"#78ffbf\", smoothing: 6, flicker: 0.32 },\r\n  { id: \"wilds-falls\", type: \"point\", x: 1180, y: baseGround - 120, radius: 260, intensity: 0.9, color: \"#6ed8ff\", smoothing: 8, flicker: 0.25 }\r\n]);\r\n\r\nconst dunePlatforms = [\r\n  { x: -260, y: baseGround - 20, width: 540, height: 20, type: \"sand\" },\r\n  { x: 360, y: baseGround - 24, width: 340, height: 18, type: \"sand\" },\r\n  { x: 760, y: baseGround - 28, width: 380, height: 20, type: \"sand\" },\r\n  { x: 1180, y: baseGround - 26, width: 480, height: 22, type: \"sand\" },\r\n  { x: 120, y: baseGround - 140, width: 260, height: 16, type: \"cliff\" },\r\n  { x: 520, y: baseGround - 200, width: 260, height: 14, type: \"plateau\" },\r\n  { x: 900, y: baseGround - 180, width: 310, height: 14, type: \"plateau\" },\r\n  { x: 1280, y: baseGround - 240, width: 240, height: 12, type: \"plateau\" }\r\n];\r\n\r\nconst duneWater = addCentralWater(\r\n  scaleWaterZones([\r\n    { x: 520, width: 180, top: baseGround - 18, depth: 12 }\r\n  ]),\r\n  {\r\n    topOffset: 22,\r\n    depth: 24,\r\n    topColor: \"rgba(68, 156, 188, 0.85)\",\r\n    midColor: \"rgba(40, 124, 168, 0.9)\",\r\n    bottomColor: \"rgba(24, 74, 120, 0.95)\",\r\n    rippleColor: \"rgba(240, 255, 214, 0.18)\",\r\n    highlightColor: \"rgba(255, 204, 128, 0.26)\"\r\n  }\r\n);\r\n\r\nconst duneDecor = scaleDecor([\r\n  { type: \"dune\", baseX: 120, baseY: baseGround, width: 320, height: 120 },\r\n  { type: \"dune\", baseX: 620, baseY: baseGround, width: 280, height: 100 },\r\n  { type: \"dune\", baseX: 1080, baseY: baseGround, width: 340, height: 110 },\r\n  { type: \"rockSpire\", baseX: 420, baseY: baseGround, height: 260 },\r\n  { type: \"rockSpire\", baseX: 1160, baseY: baseGround, height: 230 },\r\n  { type: \"campfire\", baseX: 660, baseY: baseGround - 20 },\r\n  { type: \"antenna\", x: 920, y: baseGround - 300, height: 320 }\r\n]);\r\n\r\nconst duneDestructibles = scaleDestructibles([\r\n  {\r\n    id: \"dune-sandbag-west\",\r\n    type: \"sandbagLine\",\r\n    x: 280,\r\n    baseY: baseGround,\r\n    templateOverrides: {\r\n      bodyColor: \"#c8a070\",\r\n      accentColor: \"#edd0a0\",\r\n      damageHighlight: \"#ffe8b2\",\r\n      debrisColor: \"#8f6d45\"\r\n    }\r\n  },\r\n  {\r\n    id: \"dune-sandbag-east\",\r\n    type: \"sandbagLine\",\r\n    x: 1180,\r\n    baseY: baseGround,\r\n    templateOverrides: {\r\n      bodyColor: \"#c8a070\",\r\n      accentColor: \"#edd0a0\",\r\n      damageHighlight: \"#ffe8b2\",\r\n      debrisColor: \"#8f6d45\"\r\n    }\r\n  },\r\n  {\r\n    id: \"dune-rover\",\r\n    type: \"roverWreck\",\r\n    x: 760,\r\n    baseY: baseGround - 24,\r\n    facing: -1,\r\n    templateOverrides: {\r\n      bodyColor: \"#d1c296\",\r\n      accentColor: \"#fdf4c7\",\r\n      glassColor: \"#ffe8a1\",\r\n      damageHighlight: \"#fff0c1\",\r\n      debrisColor: \"#8f7b4a\"\r\n    }\r\n  },\r\n  {\r\n    id: \"dune-cell\",\r\n    type: \"plasmaCell\",\r\n    x: 540,\r\n    baseY: baseGround - 200,\r\n    templateOverrides: {\r\n      bodyColor: \"#f07f1f\",\r\n      accentColor: \"#ffd9a1\",\r\n      stripeColor: \"#ffeab9\",\r\n      damageHighlight: \"#fff1cb\",\r\n      debrisColor: \"#a95312\"\r\n    }\r\n  }\r\n]);\r\n\r\nconst duneInteractables = scaleInteractables([\r\n  {\r\n    id: \"dune-crate\",\r\n    type: \"pushCrate\",\r\n    x: 360,\r\n    baseY: baseGround - 24,\r\n    minX: 180,\r\n    maxX: 520,\r\n    templateOverrides: {\r\n      bodyColor: \"#bf9a62\",\r\n      edgeColor: \"#6f4f2f\",\r\n      braceColor: \"#dcb678\",\r\n      highlightColor: \"#ffe0a8\"\r\n    }\r\n  },\r\n  {\r\n    id: \"dune-barrel\",\r\n    type: \"kickBarrel\",\r\n    x: 820,\r\n    baseY: baseGround - 28,\r\n    minX: 720,\r\n    maxX: 960,\r\n    templateOverrides: {\r\n      bodyColor: \"#c7672d\",\r\n      stripeColor: \"#ffe49a\",\r\n      edgeColor: \"#531f05\",\r\n      topColor: \"#e4883d\"\r\n    }\r\n  },\r\n  {\r\n    id: \"dune-trap\",\r\n    type: \"shockTrap\",\r\n    x: 1020,\r\n    baseY: baseGround - 26,\r\n    templateOverrides: {\r\n      bodyColor: \"#3a2a14\",\r\n      accentColor: \"#ffcc6e\",\r\n      glowColor: \"#ffe9a6\"\r\n    }\r\n  }\r\n]);\r\n\r\nconst duneAmbientLights = scaleAmbientLights([\r\n  { id: \"dune-fire\", type: \"point\", x: 660, y: baseGround - 36, radius: 240, intensity: 1.2, color: \"#ffb36d\", smoothing: 6, flicker: 0.55 },\r\n  { id: \"dune-beacon\", type: \"point\", x: 920, y: baseGround - 200, radius: 260, intensity: 0.9, color: \"#8cc9ff\", smoothing: 8, flicker: 0.35 }\r\n]);\r\n\r\nconst orbitalPlatforms = scalePlatforms([\r\n  { x: -200, y: baseGround - 40, width: 540, height: 18, type: \"deck\" },\r\n  { x: 340, y: baseGround - 40, width: 360, height: 18, type: \"deck\" },\r\n  { x: 720, y: baseGround - 40, width: 400, height: 18, type: \"deck\" },\r\n  { x: 1200, y: baseGround - 40, width: 420, height: 18, type: \"deck\" },\r\n  { x: 160, y: baseGround - 160, width: 260, height: 14, type: \"catwalk\" },\r\n  { x: 520, y: baseGround - 220, width: 320, height: 14, type: \"catwalk\" },\r\n  { x: 920, y: baseGround - 200, width: 300, height: 14, type: \"maglev\" },\r\n  { x: 1280, y: baseGround - 260, width: 260, height: 12, type: \"maglev\" }\r\n]);\r\n\r\nconst orbitalWater = addCentralWater(\r\n  scaleWaterZones([]),\r\n  {\r\n    topOffset: 24,\r\n    depth: 30,\r\n    topColor: \"rgba(86, 128, 220, 0.82)\",\r\n    midColor: \"rgba(70, 104, 210, 0.88)\",\r\n    bottomColor: \"rgba(48, 72, 180, 0.94)\",\r\n    rippleColor: \"rgba(148, 208, 255, 0.28)\",\r\n    highlightColor: \"rgba(160, 220, 255, 0.3)\"\r\n  }\r\n);\r\n\r\nconst orbitalDecor = scaleDecor([\r\n  { type: \"spire\", baseX: 260, baseY: baseGround, height: 300 },\r\n  { type: \"spire\", baseX: 640, baseY: baseGround, height: 340 },\r\n  { type: \"spire\", baseX: 1100, baseY: baseGround, height: 320 },\r\n  { type: \"holoBillboard\", x: 820, y: baseGround - 220, width: 200, height: 100, text: \"SYN-42\" },\r\n  { type: \"energyCoil\", baseX: 520, baseY: baseGround - 20, height: 180 },\r\n  { type: \"energyCoil\", baseX: 1260, baseY: baseGround - 20, height: 200 },\r\n  { type: \"hovercar\", x: 420, y: baseGround - 160 },\r\n  { type: \"hovercar\", x: 1180, y: baseGround - 150 }\r\n]);\r\n\r\nconst orbitalDestructibles = scaleDestructibles([\r\n  {\r\n    id: \"orbital-barrier-west\",\r\n    type: \"sandbagLine\",\r\n    x: 320,\r\n    baseY: baseGround,\r\n    templateOverrides: {\r\n      bodyColor: \"#3b4b63\",\r\n      accentColor: \"#6c82b8\",\r\n      damageHighlight: \"#a9c4ff\",\r\n      debrisColor: \"#243145\"\r\n    }\r\n  },\r\n  {\r\n    id: \"orbital-barrier-east\",\r\n    type: \"sandbagLine\",\r\n    x: 1260,\r\n    baseY: baseGround,\r\n    templateOverrides: {\r\n      bodyColor: \"#3b4b63\",\r\n      accentColor: \"#6c82b8\",\r\n      damageHighlight: \"#a9c4ff\",\r\n      debrisColor: \"#243145\"\r\n    }\r\n  },\r\n  {\r\n    id: \"orbital-reactor\",\r\n    type: \"plasmaCell\",\r\n    x: 760,\r\n    baseY: baseGround - 40,\r\n    templateOverrides: {\r\n      bodyColor: \"#4a9fff\",\r\n      accentColor: \"#c4f5ff\",\r\n      stripeColor: \"#9ef7ff\",\r\n      damageHighlight: \"#d4fcff\"\r\n    }\r\n  },\r\n  {\r\n    id: \"orbital-rover\",\r\n    type: \"roverWreck\",\r\n    x: 540,\r\n    baseY: baseGround - 220,\r\n    facing: 1,\r\n    templateOverrides: {\r\n      bodyColor: \"#6f86ff\",\r\n      accentColor: \"#dfe6ff\",\r\n      glassColor: \"#9ffbff\",\r\n      damageHighlight: \"#bcd3ff\",\r\n      debrisColor: \"#3e4f9a\"\r\n    }\r\n  }\r\n]);\r\n\r\nconst orbitalInteractables = scaleInteractables([\r\n  {\r\n    id: \"orbital-crate-lower\",\r\n    type: \"pushCrate\",\r\n    x: 360,\r\n    baseY: baseGround - 40,\r\n    minX: 200,\r\n    maxX: 520,\r\n    templateOverrides: {\r\n      bodyColor: \"#4b5b87\",\r\n      edgeColor: \"#1b233a\",\r\n      braceColor: \"#7f96e8\",\r\n      highlightColor: \"#a8c2ff\"\r\n    }\r\n  },\r\n  {\r\n    id: \"orbital-crate-upper\",\r\n    type: \"pushCrate\",\r\n    x: 1080,\r\n    baseY: baseGround - 200,\r\n    minX: 960,\r\n    maxX: 1180,\r\n    templateOverrides: {\r\n      bodyColor: \"#566dac\",\r\n      edgeColor: \"#243154\",\r\n      braceColor: \"#8da4ff\",\r\n      highlightColor: \"#c3d1ff\"\r\n    }\r\n  },\r\n  {\r\n    id: \"orbital-barrel\",\r\n    type: \"kickBarrel\",\r\n    x: 680,\r\n    baseY: baseGround - 40,\r\n    minX: 620,\r\n    maxX: 880,\r\n    templateOverrides: {\r\n      bodyColor: \"#3d7cff\",\r\n      stripeColor: \"#8df5ff\",\r\n      edgeColor: \"#1c2550\",\r\n      topColor: \"#64a1ff\"\r\n    }\r\n  },\r\n  {\r\n    id: \"orbital-trap\",\r\n    type: \"shockTrap\",\r\n    x: 920,\r\n    baseY: baseGround - 40,\r\n    templateOverrides: {\r\n      bodyColor: \"#1f2850\",\r\n      accentColor: \"#86a6ff\",\r\n      glowColor: \"#b4ceff\"\r\n    }\r\n  }\r\n]);\r\n\r\nconst orbitalAmbientLights = scaleAmbientLights([\r\n  { id: \"orbital-coil-0\", type: \"point\", x: 520, y: baseGround - 120, radius: 280, intensity: 1.3, color: \"#7ce7ff\", smoothing: 10, flicker: 0.35 },\r\n  { id: \"orbital-coil-1\", type: \"point\", x: 1260, y: baseGround - 120, radius: 280, intensity: 1.3, color: \"#7ce7ff\", smoothing: 10, flicker: 0.35 },\r\n  { id: \"orbital-spire\", type: \"cone\", x: 260, y: baseGround - 320, radius: 320, intensity: 0.9, color: \"#55d9ff\", direction: 0, fov: Math.PI * 0.4, stretch: 0.6, smoothing: 14 }\r\n]);\r\n\r\nconst ENVIRONMENT_DEFINITIONS = {\r\n  neoDistrict: {\r\n    id: \"neoDistrict\",\r\n    name: \"Neo District\",\r\n    theme: \"urban\",\r\n    width: levelWidth,\r\n    background: {\r\n      gradientStops: [\r\n        { offset: 0, color: \"#111a2c\" },\r\n        { offset: 0.4, color: \"#182439\" },\r\n        { offset: 0.75, color: \"#1f2d44\" },\r\n        { offset: 1, color: \"#232f49\" }\r\n      ],\r\n      horizonBand: {\r\n        start: baseGround - 140,\r\n        height: 120,\r\n        topColor: \"rgba(46, 86, 126, 0.25)\",\r\n        bottomColor: \"rgba(28, 52, 84, 0)\"\r\n      },\r\n      groundColor: \"#1b2231\",\r\n      silhouettes: [\r\n        {\r\n          color: \"#1a2437\",\r\n          points: [\r\n            { x: 0, y: baseGround - 220 },\r\n            { x: scaleX(220), y: baseGround - 260 },\r\n            { x: scaleX(420), y: baseGround - 210 },\r\n            { x: scaleX(640), y: baseGround - 280 },\r\n            { x: scaleX(820), y: baseGround - 230 },\r\n            { x: scaleX(1040), y: baseGround - 260 },\r\n            { x: scaleX(1220), y: baseGround - 210 },\r\n            { x: scaleX(1380), y: baseGround - 260 },\r\n            { x: levelWidth, y: baseGround - 200 },\r\n            { x: levelWidth, y: baseGround },\r\n            { x: 0, y: baseGround }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    platforms: neoPlatforms,\r\n    waterZones: neoWaterZones,\r\n    decor: neoDecor,\r\n    destructibles: neoDestructibles,\r\n    interactables: neoInteractables,\r\n    ambientLights: neoAmbientLights,\r\n    spawn: {\r\n      player: { x: levelWidth * 0.5 },\r\n      trainingDummy: { x: levelWidth * 0.75 },\r\n      squadOffsets: [-120, 40, 120],\r\n      enemies: [levelWidth * 0.24, levelWidth * 0.68]\r\n    }\r\n  },\r\n  verdantWilds: {\r\n    id: \"verdantWilds\",\r\n    name: \"Verdant Wilds\",\r\n    theme: \"jungle\",\r\n    width: levelWidth,\r\n    background: {\r\n      gradientStops: [\r\n        { offset: 0, color: \"#0b1613\" },\r\n        { offset: 0.45, color: \"#123020\" },\r\n        { offset: 0.8, color: \"#1d4a37\" },\r\n        { offset: 1, color: \"#1c2d1f\" }\r\n      ],\r\n      horizonBand: {\r\n        start: baseGround - 160,\r\n        height: 140,\r\n        topColor: \"rgba(34, 84, 58, 0.32)\",\r\n        bottomColor: \"rgba(18, 42, 31, 0)\"\r\n      },\r\n      groundColor: \"#1c2519\",\r\n      silhouettes: [\r\n        {\r\n          color: \"#152718\",\r\n          points: [\r\n            { x: 0, y: baseGround - 200 },\r\n            { x: scaleX(160), y: baseGround - 230 },\r\n            { x: scaleX(360), y: baseGround - 210 },\r\n            { x: scaleX(540), y: baseGround - 250 },\r\n            { x: scaleX(760), y: baseGround - 220 },\r\n            { x: scaleX(980), y: baseGround - 240 },\r\n            { x: levelWidth, y: baseGround - 210 },\r\n            { x: levelWidth, y: baseGround },\r\n            { x: 0, y: baseGround }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    platforms: verdantPlatforms,\r\n    waterZones: verdantWater,\r\n    decor: verdantDecor,\r\n    destructibles: verdantDestructibles,\r\n    interactables: verdantInteractables,\r\n    ambientLights: verdantAmbientLights,\r\n    spawn: {\r\n      player: { x: levelWidth * 0.45 },\r\n      trainingDummy: { x: levelWidth * 0.8 },\r\n      squadOffsets: [-140, -10, 120],\r\n      enemies: [levelWidth * 0.2, levelWidth * 0.7]\r\n    }\r\n  },\r\n  sunsetDunes: {\r\n    id: \"sunsetDunes\",\r\n    name: \"Sunset Dunes\",\r\n    theme: \"desert\",\r\n    width: levelWidth,\r\n    background: {\r\n      gradientStops: [\r\n        { offset: 0, color: \"#32140c\" },\r\n        { offset: 0.45, color: \"#5c2814\" },\r\n        { offset: 0.78, color: \"#b35a1c\" },\r\n        { offset: 1, color: \"#d08b3e\" }\r\n      ],\r\n      horizonBand: {\r\n        start: baseGround - 150,\r\n        height: 120,\r\n        topColor: \"rgba(206, 124, 50, 0.28)\",\r\n        bottomColor: \"rgba(128, 68, 24, 0)\"\r\n      },\r\n      groundColor: \"#3c2717\",\r\n      silhouettes: [\r\n        {\r\n          color: \"#2a1b10\",\r\n          points: [\r\n            { x: 0, y: baseGround - 180 },\r\n            { x: scaleX(220), y: baseGround - 200 },\r\n            { x: scaleX(480), y: baseGround - 190 },\r\n            { x: scaleX(720), y: baseGround - 210 },\r\n            { x: scaleX(980), y: baseGround - 200 },\r\n            { x: levelWidth, y: baseGround - 190 },\r\n            { x: levelWidth, y: baseGround },\r\n            { x: 0, y: baseGround }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    platforms: dunePlatforms,\r\n    waterZones: duneWater,\r\n    decor: duneDecor,\r\n    destructibles: duneDestructibles,\r\n    interactables: duneInteractables,\r\n    ambientLights: duneAmbientLights,\r\n    spawn: {\r\n      player: { x: levelWidth * 0.46 },\r\n      trainingDummy: { x: levelWidth * 0.78 },\r\n      squadOffsets: [-140, -30, 110],\r\n      enemies: [levelWidth * 0.22, levelWidth * 0.68]\r\n    }\r\n  },\r\n  orbitalSpire: {\r\n    id: \"orbitalSpire\",\r\n    name: \"Orbital Spire\",\r\n    theme: \"sci-fi\",\r\n    width: levelWidth,\r\n    background: {\r\n      gradientStops: [\r\n        { offset: 0, color: \"#0d0f2a\" },\r\n        { offset: 0.5, color: \"#141a3d\" },\r\n        { offset: 0.82, color: \"#1c2856\" },\r\n        { offset: 1, color: \"#1e1f2c\" }\r\n      ],\r\n      horizonBand: {\r\n        start: baseGround - 160,\r\n        height: 140,\r\n        topColor: \"rgba(70, 120, 220, 0.22)\",\r\n        bottomColor: \"rgba(30, 40, 90, 0)\"\r\n      },\r\n      groundColor: \"#151726\",\r\n      silhouettes: [\r\n        {\r\n          color: \"#1a2650\",\r\n          points: [\r\n            { x: 0, y: baseGround - 240 },\r\n            { x: scaleX(200), y: baseGround - 320 },\r\n            { x: scaleX(280), y: baseGround - 200 },\r\n            { x: scaleX(520), y: baseGround - 340 },\r\n            { x: scaleX(720), y: baseGround - 260 },\r\n            { x: scaleX(900), y: baseGround - 320 },\r\n            { x: scaleX(1080), y: baseGround - 220 },\r\n            { x: scaleX(1280), y: baseGround - 340 },\r\n            { x: levelWidth, y: baseGround - 240 },\r\n            { x: levelWidth, y: baseGround },\r\n            { x: 0, y: baseGround }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    platforms: orbitalPlatforms,\r\n    waterZones: [],\r\n    decor: orbitalDecor,\r\n    destructibles: orbitalDestructibles,\r\n    interactables: orbitalInteractables,\r\n    ambientLights: orbitalAmbientLights,\r\n    spawn: {\r\n      player: { x: levelWidth * 0.5 },\r\n      trainingDummy: { x: levelWidth * 0.82 },\r\n      squadOffsets: [-130, -20, 120],\r\n      enemies: [levelWidth * 0.3, levelWidth * 0.7]\r\n    }\r\n  }\r\n};\r\n\r\nconst ENVIRONMENT_SEQUENCE = [\"neoDistrict\", \"verdantWilds\", \"sunsetDunes\", \"orbitalSpire\"];\r\n\r\nexport { ENVIRONMENT_DEFINITIONS, ENVIRONMENT_SEQUENCE };\r\n","const resourceState = {\r\n  materials: 120,\r\n  pickups: []\r\n};\r\n\r\nlet nextPickupId = 1;\r\n\r\nfunction getResourceState() {\r\n  return resourceState;\r\n}\r\n\r\nfunction getMaterialCount() {\r\n  return resourceState.materials;\r\n}\r\n\r\nfunction setMaterialCount(amount) {\r\n  resourceState.materials = Math.max(0, Math.floor(amount ?? 0));\r\n}\r\n\r\nfunction addMaterials(amount, source = \"\") {\r\n  if (!Number.isFinite(amount) || amount === 0) {\r\n    return;\r\n  }\r\n  resourceState.materials = Math.max(0, resourceState.materials + Math.round(amount));\r\n}\r\n\r\nfunction canAfford(cost) {\r\n  return resourceState.materials >= (cost ?? 0);\r\n}\r\n\r\nfunction spendMaterials(cost) {\r\n  const amount = Math.round(cost ?? 0);\r\n  if (amount <= 0) {\r\n    return true;\r\n  }\r\n  if (!canAfford(amount)) {\r\n    return false;\r\n  }\r\n  resourceState.materials -= amount;\r\n  return true;\r\n}\r\n\r\nfunction spawnSalvagePickup({ x = 0, y = 0, amount = 10, vx = (Math.random() - 0.5) * 80, vy = -120, ttl = 6 } = {}) {\r\n  const pickup = {\r\n    id: `salvage-${nextPickupId++}`,\r\n    x,\r\n    y,\r\n    vx,\r\n    vy,\r\n    amount: Math.max(1, Math.round(amount ?? 1)),\r\n    ttl,\r\n    maxTtl: ttl,\r\n    collected: false\r\n  };\r\n  resourceState.pickups.push(pickup);\r\n  return pickup;\r\n}\r\n\r\nfunction clearResourcePickups() {\r\n  resourceState.pickups.length = 0;\r\n}\r\n\r\nexport {\r\n  getResourceState,\r\n  getMaterialCount,\r\n  setMaterialCount,\r\n  addMaterials,\r\n  canAfford,\r\n  spendMaterials,\r\n  spawnSalvagePickup,\r\n  clearResourcePickups\r\n};\r\n","import { ENVIRONMENT_DEFINITIONS, ENVIRONMENT_SEQUENCE } from \"../config/environments.js\";\r\nimport { canvas } from \"../environment/canvas.js\";\r\nimport { clearResourcePickups } from \"./resources.js\";\r\n\r\nlet currentEnvironmentId = ENVIRONMENT_SEQUENCE[0] ?? Object.keys(ENVIRONMENT_DEFINITIONS)[0];\r\nconst listeners = new Set();\r\nlet controlsInitialized = false;\r\n\r\nfunction getEnvironmentDefinition(id = currentEnvironmentId) {\r\n  const definition = ENVIRONMENT_DEFINITIONS[id];\r\n  if (definition) {\r\n    return definition;\r\n  }\r\n  const fallbackId = ENVIRONMENT_SEQUENCE[0] ?? Object.keys(ENVIRONMENT_DEFINITIONS)[0];\r\n  currentEnvironmentId = fallbackId;\r\n  return ENVIRONMENT_DEFINITIONS[fallbackId];\r\n}\r\n\r\nfunction getEnvironmentWidth() {\r\n  const environment = getEnvironmentDefinition();\r\n  return typeof environment?.width === \"number\" ? environment.width : canvas.width;\r\n}\r\n\r\nfunction getEnvironmentId() {\r\n  return currentEnvironmentId;\r\n}\r\n\r\nfunction getEnvironmentPlatforms() {\r\n  const environment = getEnvironmentDefinition();\r\n  return Array.isArray(environment?.platforms) ? environment.platforms : [];\r\n}\r\n\r\nfunction getEnvironmentWaterZones() {\r\n  const environment = getEnvironmentDefinition();\r\n  return Array.isArray(environment?.waterZones) ? environment.waterZones : [];\r\n}\r\n\r\nfunction getEnvironmentDecor() {\r\n  const environment = getEnvironmentDefinition();\r\n  return Array.isArray(environment?.decor) ? environment.decor : [];\r\n}\r\n\r\nfunction getEnvironmentDestructibleSpawns() {\r\n  const environment = getEnvironmentDefinition();\r\n  return Array.isArray(environment?.destructibles) ? environment.destructibles : [];\r\n}\r\n\r\nfunction getEnvironmentInteractableSpawns() {\r\n  const environment = getEnvironmentDefinition();\r\n  return Array.isArray(environment?.interactables) ? environment.interactables : [];\r\n}\r\n\r\nfunction getEnvironmentAmbientLights() {\r\n  const environment = getEnvironmentDefinition();\r\n  return Array.isArray(environment?.ambientLights) ? environment.ambientLights : [];\r\n}\r\n\r\nfunction getEnvironmentSpawnSettings() {\r\n  const environment = getEnvironmentDefinition();\r\n  return environment?.spawn ?? {};\r\n}\r\n\r\nfunction notifyListeners() {\r\n  const definition = getEnvironmentDefinition();\r\n  for (const listener of listeners) {\r\n    try {\r\n      listener(definition);\r\n    } catch (error) {\r\n      if (typeof console !== \"undefined\" && console.error) {\r\n        console.error(\"Environment listener error\", error);\r\n      }\r\n    }\r\n  }\r\n  if (typeof window !== \"undefined\" && typeof window.dispatchEvent === \"function\") {\r\n    window.dispatchEvent(\r\n      new CustomEvent(\"environment:changed\", {\r\n        detail: { environment: definition, id: definition?.id ?? currentEnvironmentId }\r\n      })\r\n    );\r\n  }\r\n}\r\n\r\nfunction setEnvironment(environmentId) {\r\n  if (!environmentId || !ENVIRONMENT_DEFINITIONS[environmentId]) {\r\n    return false;\r\n  }\r\n  if (environmentId === currentEnvironmentId) {\r\n    return false;\r\n  }\r\n  currentEnvironmentId = environmentId;\r\n  clearResourcePickups();\r\n  notifyListeners();\r\n  return true;\r\n}\r\n\r\nfunction cycleEnvironment(direction = 1) {\r\n  if (!Array.isArray(ENVIRONMENT_SEQUENCE) || ENVIRONMENT_SEQUENCE.length === 0) {\r\n    return false;\r\n  }\r\n  const index = ENVIRONMENT_SEQUENCE.indexOf(currentEnvironmentId);\r\n  const normalizedIndex = index >= 0 ? index : 0;\r\n  const nextIndex = (normalizedIndex + direction + ENVIRONMENT_SEQUENCE.length) % ENVIRONMENT_SEQUENCE.length;\r\n  return setEnvironment(ENVIRONMENT_SEQUENCE[nextIndex]);\r\n}\r\n\r\nfunction onEnvironmentChange(listener, options = {}) {\r\n  if (typeof listener !== \"function\") {\r\n    return () => {};\r\n  }\r\n  listeners.add(listener);\r\n  if (options.immediate !== false) {\r\n    listener(getEnvironmentDefinition());\r\n  }\r\n  return () => {\r\n    listeners.delete(listener);\r\n  };\r\n}\r\n\r\nfunction handleEnvironmentHotkeys(event) {\r\n  if (!event.altKey || event.repeat) {\r\n    return;\r\n  }\r\n  if (event.code === \"Digit9\" || event.code === \"Digit0\") {\r\n    const direction = event.code === \"Digit9\" ? -1 : 1;\r\n    const changed = cycleEnvironment(direction);\r\n    if (changed && typeof event.preventDefault === \"function\") {\r\n      event.preventDefault();\r\n    }\r\n  }\r\n}\r\n\r\nfunction initializeEnvironmentControls() {\r\n  if (controlsInitialized || typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.addEventListener(\"keydown\", handleEnvironmentHotkeys);\r\n  controlsInitialized = true;\r\n}\r\n\r\n\r\nfunction refreshEnvironment() {\r\n  notifyListeners();\r\n}\r\n\r\nexport {\r\n  getEnvironmentDefinition,\r\n  getEnvironmentId,\r\n  getEnvironmentWidth,\r\n  getEnvironmentPlatforms,\r\n  getEnvironmentWaterZones,\r\n  getEnvironmentDecor,\r\n  getEnvironmentDestructibleSpawns,\r\n  getEnvironmentInteractableSpawns,\r\n  getEnvironmentAmbientLights,\r\n  getEnvironmentSpawnSettings,\r\n  setEnvironment,\r\n  cycleEnvironment,\r\n  onEnvironmentChange,\r\n  initializeEnvironmentControls,\r\n  refreshEnvironment\r\n};\r\n","import { canvas } from \"../environment/canvas.js\";\r\nimport { getEnvironmentWidth, onEnvironmentChange } from \"./environment.js\";\r\n\r\nconst cameraState = {\r\n  x: canvas.width * 0.5,\r\n  targetX: canvas.width * 0.5\r\n};\r\n\r\nfunction getHalfViewWidth() {\r\n  return canvas.width * 0.5;\r\n}\r\n\r\nfunction clampCameraX(value) {\r\n  const half = getHalfViewWidth();\r\n  const envWidth = getEnvironmentWidth();\r\n  if (envWidth <= canvas.width) {\r\n    return canvas.width * 0.5;\r\n  }\r\n  return Math.min(Math.max(value, half), envWidth - half);\r\n}\r\n\r\nfunction setCameraTargetX(x) {\r\n  cameraState.targetX = clampCameraX(x);\r\n}\r\n\r\nfunction snapCameraTo(x) {\r\n  cameraState.x = clampCameraX(x);\r\n  cameraState.targetX = cameraState.x;\r\n}\r\n\r\nfunction resetCamera() {\r\n  const envWidth = getEnvironmentWidth();\r\n  snapCameraTo(envWidth * 0.5);\r\n}\r\n\r\nfunction updateCamera(delta) {\r\n  const target = clampCameraX(cameraState.targetX);\r\n  const lerpSpeed = 6;\r\n  const t = Math.min(1, delta * lerpSpeed);\r\n  cameraState.x += (target - cameraState.x) * t;\r\n  cameraState.x = clampCameraX(cameraState.x);\r\n}\r\n\r\nfunction getCamera() {\r\n  const half = getHalfViewWidth();\r\n  const envWidth = getEnvironmentWidth();\r\n  const clampedX = clampCameraX(cameraState.x);\r\n  let left = clampedX - half;\r\n  if (envWidth <= canvas.width) {\r\n    left = Math.max(0, (envWidth * 0.5) - half);\r\n  } else {\r\n    left = Math.min(Math.max(0, left), envWidth - canvas.width);\r\n  }\r\n  const right = left + canvas.width;\r\n  return {\r\n    x: clampedX,\r\n    y: 0,\r\n    halfWidth: half,\r\n    left,\r\n    right,\r\n    offsetX: left\r\n  };\r\n}\r\n\r\nonEnvironmentChange(() => {\r\n  resetCamera();\r\n});\r\n\r\nresetCamera();\r\n\r\nexport { getCamera, setCameraTargetX, updateCamera, resetCamera };\r\n","import { canvas } from \"../../environment/canvas.js\";\r\nimport { getCamera } from \"../../state/camera.js\";\r\n\r\nconst input = Object.seal({\r\n  left: false,\r\n  right: false,\r\n  jump: false,\r\n  down: false,\r\n  roll: false,\r\n  attackBuffered: false,\r\n  throwBuffered: false,\r\n  reloadBuffered: false,\r\n  interactBuffered: false,\r\n  attackDown: false,\r\n  throwDown: false,\r\n  squadCommandCycleBuffered: false,\r\n  squadCommandSelect: null,\r\n  serverBrowserToggleBuffered: false,\r\n  serverBrowserNavigate: 0,\r\n  serverBrowserJoinBuffered: false,\r\n  serverBrowserHostBuffered: false,\r\n  serverBrowserStopHostBuffered: false,\r\n  serverBrowserCopyOfferBuffered: false,\r\n  serverBrowserPasteOfferBuffered: false,\r\n  serverBrowserAcceptAnswerBuffered: false,\r\n  serverBrowserCopyCandidatesBuffered: false,\r\n  serverBrowserPasteCandidatesBuffered: false,\r\n  buildToggleBuffered: false,\r\n  buildCycleBuffered: 0,\r\n  buildConfirmBuffered: false,\r\n  buildCancelBuffered: false,\r\n  survivalToggleBuffered: false,\r\n  sandboxToggleBuffered: false,\n  coopToggleBuffered: false,\r\n  campaignStartBuffered: false,\r\n});\r\n\r\nconst pointer = Object.seal({\r\n  screenX: canvas.width * 0.5,\r\n  screenY: canvas.height * 0.5,\r\n  worldX: canvas.width * 0.5,\r\n  worldY: canvas.height * 0.5,\r\n  active: false,\r\n  lastUpdate: 0\r\n});\r\n\r\nfunction refreshPointerWorld() {\r\n  const camera = getCamera();\r\n  const offsetX = camera?.offsetX ?? 0;\r\n  const offsetY = camera?.y ?? 0;\r\n  pointer.worldX = pointer.screenX + offsetX;\r\n  pointer.worldY = pointer.screenY + offsetY;\r\n}\r\n\r\nfunction updatePointerPosition(event) {\r\n  if (!canvas || !event) {\r\n    refreshPointerWorld();\r\n    return;\r\n  }\r\n  const rect = canvas.getBoundingClientRect();\r\n  const localX = event.clientX - rect.left;\r\n  const localY = event.clientY - rect.top;\r\n  const scaleX = rect.width > 0 ? canvas.width / rect.width : 1;\r\n  const scaleY = rect.height > 0 ? canvas.height / rect.height : 1;\r\n  pointer.screenX = localX * scaleX;\r\n  pointer.screenY = localY * scaleY;\r\n  pointer.active = localX >= 0 && localX <= rect.width && localY >= 0 && localY <= rect.height;\r\n  pointer.lastUpdate = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n  refreshPointerWorld();\r\n}\r\n\r\nfunction handlePointerMove(event) {\r\n  updatePointerPosition(event);\r\n}\r\n\r\nfunction handlePointerLeave() {\r\n  pointer.active = false;\r\n}\r\n\r\nlet initialized = false;\r\n\r\nfunction handleKey(isDown, event) {\r\n  switch (event.code) {\r\n    case \"ArrowLeft\":\r\n    case \"KeyA\":\r\n      input.left = isDown;\r\n      event.preventDefault();\r\n      break;\r\n    case \"ArrowRight\":\r\n    case \"KeyD\":\r\n      input.right = isDown;\r\n      event.preventDefault();\r\n      break;\r\n    case \"ArrowUp\":\r\n    case \"KeyW\":\r\n    case \"Space\":\r\n      input.jump = isDown;\r\n      event.preventDefault();\r\n      break;\r\n    case \"ArrowDown\":\r\n    case \"KeyS\":\r\n      input.down = isDown;\r\n      event.preventDefault();\r\n      break;\r\n    case \"Comma\":\r\n      if (isDown) {\r\n        input.buildCycleBuffered = -1;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"Period\":\r\n      if (isDown) {\r\n        input.buildCycleBuffered = 1;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"Escape\":\r\n      if (isDown) {\r\n        input.buildCancelBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n    case \"ShiftLeft\":\r\n    case \"ShiftRight\":\r\n      if (isDown) {\r\n        input.roll = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyB\":\r\n      if (isDown) {\r\n        input.buildToggleBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyY\":\n      if (isDown) {\n        input.survivalToggleBuffered = true;\n        event.preventDefault();\n      }\n      break;\n    case \"KeyK\":\n      if (isDown) {\n        input.sandboxToggleBuffered = true;\n        event.preventDefault();\n      }\n      break;\n    case \"F9\":\n      if (isDown) {\n        input.coopToggleBuffered = true;\n        event.preventDefault();\n      }\n      break;\r\n    case \"KeyJ\":\r\n    case \"KeyF\":\r\n      if (isDown) {\r\n        input.attackBuffered = true;\r\n        input.attackDown = true;\r\n        event.preventDefault();\r\n      } else {\r\n        input.attackDown = false;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyG\":\r\n      if (isDown) {\r\n        input.throwBuffered = true;\r\n        input.throwDown = true;\r\n        event.preventDefault();\r\n      } else {\r\n        input.throwDown = false;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyR\":\r\n      if (isDown) {\r\n        input.reloadBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyE\":\r\n      if (isDown) {\r\n        input.interactBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyT\":\r\n      if (isDown) {\r\n        input.squadCommandCycleBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyQ\":\r\n      if (isDown) {\r\n        input.campaignStartBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyZ\":\r\n      if (isDown) {\r\n        input.squadCommandSelect = \"hold\";\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyX\":\r\n      if (isDown) {\r\n        input.squadCommandSelect = \"defend\";\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyC\":\r\n      if (isDown) {\r\n        input.squadCommandSelect = \"attack\";\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyV\":\r\n      if (isDown) {\r\n        input.squadCommandSelect = \"flank\";\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyL\":\r\n      if (isDown) {\r\n        input.serverBrowserToggleBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"BracketLeft\":\r\n      if (isDown) {\r\n        input.serverBrowserNavigate = -1;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"BracketRight\":\r\n      if (isDown) {\r\n        input.serverBrowserNavigate = 1;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"Slash\":\r\n      if (isDown) {\r\n        input.serverBrowserNavigate = 1;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"Enter\":\r\n      if (isDown) {\r\n        input.serverBrowserJoinBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyH\":\r\n      if (isDown) {\r\n        input.serverBrowserHostBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyU\":\r\n      if (isDown) {\r\n        input.serverBrowserStopHostBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyO\":\r\n      if (isDown) {\r\n        input.serverBrowserCopyOfferBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyP\":\r\n      if (isDown) {\r\n        input.serverBrowserPasteOfferBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyI\":\r\n      if (isDown) {\r\n        input.serverBrowserAcceptAnswerBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyM\":\r\n      if (isDown) {\r\n        input.serverBrowserCopyCandidatesBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    case \"KeyN\":\r\n      if (isDown) {\r\n        input.serverBrowserPasteCandidatesBuffered = true;\r\n        event.preventDefault();\r\n      }\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n}\r\n\r\nfunction handleMouseDown(event) {\r\n  updatePointerPosition(event);\r\n  if (event.button === 0) {\r\n    input.attackBuffered = true;\r\n    input.attackDown = true;\r\n    event.preventDefault();\r\n  } else if (event.button === 2) {\r\n    input.throwBuffered = true;\r\n    input.throwDown = true;\r\n    event.preventDefault();\r\n  }\r\n}\r\n\r\nfunction handleMouseUp(event) {\r\n  updatePointerPosition(event);\r\n  if (event.button === 0) {\r\n    input.attackDown = false;\r\n    event.preventDefault();\r\n  } else if (event.button === 2) {\r\n    input.throwDown = false;\r\n    event.preventDefault();\r\n  }\r\n}\r\n\r\nfunction resetInputs() {\r\n  input.left = false;\r\n  input.right = false;\r\n  input.jump = false;\r\n  input.down = false;\r\n  input.roll = false;\r\n  input.attackBuffered = false;\r\n  input.throwBuffered = false;\r\n  input.reloadBuffered = false;\r\n  input.interactBuffered = false;\r\n  input.attackDown = false;\r\n  input.throwDown = false;\r\n  input.squadCommandCycleBuffered = false;\r\n  input.squadCommandSelect = null;\r\n  input.serverBrowserToggleBuffered = false;\r\n  input.serverBrowserNavigate = 0;\r\n  input.serverBrowserJoinBuffered = false;\r\n  input.serverBrowserHostBuffered = false;\r\n  input.serverBrowserStopHostBuffered = false;\r\n  input.serverBrowserCopyOfferBuffered = false;\r\n  input.serverBrowserPasteOfferBuffered = false;\r\n  input.serverBrowserAcceptAnswerBuffered = false;\r\n  input.serverBrowserCopyCandidatesBuffered = false;\r\n  input.serverBrowserPasteCandidatesBuffered = false;\r\n  input.campaignStartBuffered = false;\r\n}\r\n\r\nfunction initializeInput() {\r\n  if (initialized) {\r\n    return;\r\n  }\r\n  window.addEventListener(\"keydown\", (event) => handleKey(true, event));\r\n  window.addEventListener(\"keyup\", (event) => handleKey(false, event));\r\n  window.addEventListener(\"mousedown\", handleMouseDown);\r\n  window.addEventListener(\"mouseup\", handleMouseUp);\r\n  window.addEventListener(\"mousemove\", handlePointerMove);\r\n  window.addEventListener(\"mouseleave\", handlePointerLeave);\r\n  window.addEventListener(\"contextmenu\", (event) => event.preventDefault());\r\n  window.addEventListener(\"blur\", resetInputs);\r\n  refreshPointerWorld();\r\n  initialized = true;\r\n}\r\n\r\n\r\nexport { input, pointer, initializeInput, resetInputs, refreshPointerWorld };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","const WEAPON_DEFINITIONS = {\r\n  combatFists: {\r\n    id: \"combatFists\",\r\n    name: \"Combat Fists\",\r\n    description: \"Baseline martial arts combo with balanced speed and control.\",\r\n    category: \"melee-short\",\r\n    attackChain: [\r\n      {\r\n        name: \"Quick Jab\",\r\n        windup: 0.05,\r\n        active: 0.1,\r\n        recovery: 0.12,\r\n        comboStart: 0.1,\r\n        comboWindow: 0.16,\r\n        range: 74,\r\n        heightOffset: -46,\r\n        radius: 26,\r\n        damage: 9,\r\n        knockback: 130,\r\n        launch: 0\r\n      },\r\n      {\r\n        name: \"Cross Strike\",\r\n        windup: 0.08,\r\n        active: 0.12,\r\n        recovery: 0.16,\r\n        comboStart: 0.16,\r\n        comboWindow: 0.18,\r\n        range: 82,\r\n        heightOffset: -40,\r\n        radius: 28,\r\n        damage: 14,\r\n        knockback: 190,\r\n        launch: 0\r\n      },\r\n      {\r\n        name: \"Rising Kick\",\r\n        windup: 0.11,\r\n        active: 0.15,\r\n        recovery: 0.22,\r\n        comboStart: 0.22,\r\n        comboWindow: 0.22,\r\n        range: 68,\r\n        heightOffset: -64,\r\n        radius: 30,\r\n        damage: 20,\r\n        knockback: 240,\r\n        launch: 200\r\n      }\r\n    ]\r\n  },\r\n  shockBaton: {\r\n    id: \"shockBaton\",\r\n    name: \"Shock Baton\",\r\n    description: \"Electrified staff built for crowd control and guard breaks.\",\r\n    category: \"melee-mid\",\r\n    attackChain: [\r\n      {\r\n        name: \"Jab Feint\",\r\n        windup: 0.06,\r\n        active: 0.08,\r\n        recovery: 0.14,\r\n        comboStart: 0.14,\r\n        comboWindow: 0.16,\r\n        range: 68,\r\n        heightOffset: -30,\r\n        radius: 26,\r\n        damage: 11,\r\n        knockback: 110,\r\n        launch: 0\r\n      },\r\n      {\r\n        name: \"Slide Sweep\",\r\n        windup: 0.1,\r\n        active: 0.12,\r\n        recovery: 0.2,\r\n        comboStart: 0.2,\r\n        comboWindow: 0.18,\r\n        range: 86,\r\n        heightOffset: -12,\r\n        radius: 34,\r\n        damage: 18,\r\n        knockback: 210,\r\n        launch: 40\r\n      },\r\n      {\r\n        name: \"Arc Burst\",\r\n        windup: 0.15,\r\n        active: 0.2,\r\n        recovery: 0.3,\r\n        comboStart: 0.28,\r\n        comboWindow: 0.22,\r\n        range: 94,\r\n        heightOffset: -28,\r\n        radius: 42,\r\n        damage: 30,\r\n        knockback: 340,\r\n        launch: 210\r\n      }\r\n    ]\r\n  },\r\n  strikerPistol: {\r\n    id: \"strikerPistol\",\r\n    name: \"Striker Pistol\",\r\n    description: \"Semi-auto sidearm. Tap fire for consistent ranged pressure.\",\r\n    category: \"ranged-short\",\r\n    attackChain: [],\r\n    fireInterval: 0.25,\r\n    auto: false,\r\n    spread: {\r\n      base: 0.5,\r\n      perShot: 0.35,\r\n      max: 3,\r\n      recovery: 6\r\n    },\r\n    projectile: {\r\n      radius: 6,\r\n      speed: 560,\r\n      damage: 16,\r\n      knockback: 95,\r\n      lifetime: 1.05,\r\n      gravityFactor: 0.18,\r\n      color: \"#ffca7a\"\r\n    },\r\n    ammo: {\r\n      magazine: 14,\r\n      reserve: 84,\r\n      reloadSeconds: 1.2\r\n    },\r\n    recoil: {\r\n      horizontal: 0.35,\r\n      vertical: 1.6,\r\n      decay: 10\r\n    }\r\n  },\r\n  vectorSmg: {\r\n    id: \"vectorSmg\",\r\n    name: \"Vector SMG\",\r\n    description: \"Rapid PDW prototype tuned for controllable spray.\",\r\n    category: \"ranged-mid\",\r\n    attackChain: [],\r\n    fireInterval: 0.08,\r\n    auto: true,\r\n    projectile: {\r\n      radius: 5,\r\n      speed: 660,\r\n      damage: 11,\r\n      knockback: 75,\r\n      lifetime: 0.9,\r\n      gravityFactor: 0.14,\r\n      color: \"#98d8ff\"\r\n    },\r\n    ammo: {\r\n      magazine: 38,\r\n      reserve: 190,\r\n      reloadSeconds: 2.2\r\n    },\r\n    recoil: {\r\n      horizontal: 1.1,\r\n      vertical: 1.8,\r\n      decay: 14\r\n    },\r\n    spread: {\r\n      base: 1.2,\r\n      perShot: 0.55,\r\n      max: 7.5,\r\n      recovery: 4\r\n    }\r\n  },\r\n  fragGrenade: {\r\n    id: \"fragGrenade\",\r\n    name: \"Frag Grenade\",\r\n    description: \"Timed explosive. Toss, bounce, and detonate in a wide area.\",\r\n    category: \"throwable\",\r\n    attackChain: [],\r\n    throwable: {\r\n      fuseSeconds: 1.6,\r\n      explosionRadius: 125,\r\n      damage: 50,\r\n      knockback: 300,\r\n      arcVelocity: { vx: 280, vy: -420 },\r\n      gravityFactor: 0.5,\r\n      bounciness: 0.45,\r\n      color: \"#ffb347\",\r\n      radius: 16,\r\n      cooldownSeconds: 1.3,\r\n      explosionDuration: 0.34,\r\n      selfDamageScale: 0.45,\r\n      selfKnockbackScale: 0.45,\r\n      effectType: \"explosive\"\r\n    }\r\n  },\r\n  flashBang: {\r\n    id: \"flashBang\",\r\n    name: \"Flashbang\",\r\n    description: \"Blinding charge that staggers enemies caught in the burst.\",\r\n    category: \"throwable\",\r\n    attackChain: [],\r\n    throwable: {\r\n      fuseSeconds: 1.15,\r\n      explosionRadius: 170,\r\n      damage: 0,\r\n      knockback: 0,\r\n      arcVelocity: { vx: 260, vy: -420 },\r\n      gravityFactor: 0.45,\r\n      bounciness: 0.4,\r\n      color: \"#f9f2c7\",\r\n      radius: 14,\r\n      cooldownSeconds: 1.6,\r\n      explosionDuration: 0.24,\r\n      effectType: \"flash\",\r\n      stunDuration: 2.2,\r\n      playerStunDuration: 1.1\r\n    }\r\n  },\r\n  smokeCanister: {\r\n    id: \"smokeCanister\",\r\n    name: \"Smoke Canister\",\r\n    description: \"Rapid-deploy screen that slows foes and softens line of sight.\",\r\n    category: \"throwable\",\r\n    attackChain: [],\r\n    throwable: {\r\n      fuseSeconds: 0.9,\r\n      explosionRadius: 80,\r\n      damage: 0,\r\n      knockback: 0,\r\n      arcVelocity: { vx: 220, vy: -360 },\r\n      gravityFactor: 0.52,\r\n      bounciness: 0.35,\r\n      color: \"#aeb9c6\",\r\n      radius: 18,\r\n      cooldownSeconds: 2.2,\r\n      explosionDuration: 0.2,\r\n      effectType: \"smoke\",\r\n      smokeDuration: 6,\r\n      smokeRadius: 160,\r\n      smokeExpansion: 1.4,\r\n      smokeSlowMultiplier: 0.5,\r\n      smokeTickDuration: 0.45\r\n    }\r\n  },\r\n  turretDrone: {\r\n    id: \"turretDrone\",\r\n    name: \"Deployable Turret\",\r\n    description: \"Drops an auto-targeting sentry that covers a lane with suppressive fire.\",\r\n    category: \"gadget\",\r\n    attackChain: [],\r\n    gadget: {\r\n      type: \"turret\",\r\n      cooldownSeconds: 3.8,\r\n      duration: 10,\r\n      range: 280,\r\n      fireInterval: 0.48,\r\n      maxActive: 2,\r\n      height: 54,\r\n      spawnOffset: { x: 70, y: 0 },\r\n      baseColor: \"#6f7bff\",\r\n      headColor: \"#d6dcff\",\r\n      projectile: {\r\n        speed: 560,\r\n        radius: 4,\r\n        damage: 11,\r\n        knockback: 90,\r\n        lifetime: 1.25,\r\n        color: \"#9ae9ff\"\r\n      }\r\n    }\r\n  },\r\n  grappleRig: {\r\n    id: \"grappleRig\",\r\n    name: \"Grapple Rig\",\r\n    description: \"Launch, latch, and zip to an overhead anchor for quick repositioning.\",\r\n    category: \"gadget\",\r\n    attackChain: [],\r\n    gadget: {\r\n      type: \"grapple\",\r\n      cooldownSeconds: 1.5,\r\n      duration: 0.65,\r\n      maxLength: 340,\r\n      maxRise: 280,\r\n      travelSpeed: 940,\r\n      pullSpeed: 820,\r\n      color: \"#8cf1ff\",\r\n    }\r\n  },\r\n  thunderCannon: {\r\n    id: \"thunderCannon\",\r\n    name: \"Thunder Cannon\",\r\n    description: \"Supply drop-exclusive launcher that fires high-impact bolts.\",\r\n    category: \"ranged-heavy\",\r\n    attackChain: [],\r\n    fireInterval: 0.6,\r\n    auto: false,\r\n    projectile: {\r\n      radius: 10,\r\n      speed: 640,\r\n      damage: 56,\r\n      knockback: 320,\r\n      lifetime: 1.3,\r\n      gravityFactor: 0.15,\r\n      color: \"#ffd76a\"\r\n    },\r\n    ammo: {\r\n      magazine: 3,\r\n      reserve: 9,\r\n      reloadSeconds: 3.4\r\n    },\r\n    recoil: {\r\n      horizontal: 2.4,\r\n      vertical: 5.8,\r\n      decay: 6.5\r\n    },\r\n    spread: {\r\n      base: 1.1,\r\n      perShot: 0.65,\r\n      max: 5.5,\r\n      recovery: 2.9\r\n    }\r\n  },\r\n  shieldBubble: {\r\n    id: \"shieldBubble\",\r\n    name: \"Shield Bubble\",\r\n    description: \"Pop a temporary energy shell that soaks damage and keeps you grounded.\",\r\n    category: \"gadget\",\r\n    attackChain: [],\r\n    gadget: {\r\n      type: \"shield\",\r\n      cooldownSeconds: 6,\r\n      duration: 6.5,\r\n      strength: 130,\r\n      radius: 100,\r\n      color: \"#7cd6ff\"\r\n    }\r\n  }\r\n};\r\n\r\nconst DEFAULT_LOADOUT = [\"combatFists\", \"shockBaton\", \"strikerPistol\", \"fragGrenade\", \"flashBang\", \"smokeCanister\", \"turretDrone\", \"grappleRig\", \"shieldBubble\"];\r\n\r\nexport { WEAPON_DEFINITIONS, DEFAULT_LOADOUT };\r\n\r\n","const SPEED = 240;\nconst JUMP_SPEED = 460;\nconst ROLL_SPEED = 420;\nconst ROLL_DURATION = 0.32;\nconst GRAVITY = 1400;\n\nconst POSES = {\n  standing: {\n    headRadius: 16,\n    bodyLength: 34,\n    legLength: 36,\n    armLength: 28,\n    strideMultiplier: 1,\n    armSwingAmplitude: 12,\n    legSwingAmplitude: 12\n  },\n  crouching: {\n    headRadius: 16,\n    bodyLength: 24,\n    legLength: 24,\n    armLength: 22,\n    strideMultiplier: 0.6,\n    armSwingAmplitude: 6,\n    legSwingAmplitude: 6\n  },\n  rolling: {\n    headRadius: 16,\n    bodyLength: 18,\n    legLength: 18,\n    armLength: 18,\n    strideMultiplier: 0,\n    armSwingAmplitude: 0,\n    legSwingAmplitude: 0\n  }\n};\n\nexport {\n  SPEED,\n  JUMP_SPEED,\n  ROLL_SPEED,\n  ROLL_DURATION,\n  GRAVITY,\n  POSES\n};\r\n","const SQUAD_COMMANDS = [\n  {\n    id: \"hold\",\n    label: \"Hold\",\n    description: \"Regroup on you and stay close.\",\n    order: 0\n  },\n  {\n    id: \"defend\",\n    label: \"Defend\",\n    description: \"Form a defensive ring and cover your position.\",\n    order: 1\n  },\n  {\n    id: \"attack\",\n    label: \"Attack\",\n    description: \"Press the nearest enemy with ranged fire.\",\n    order: 2\n  },\n  {\n    id: \"flank\",\n    label: \"Flank\",\n    description: \"Split wide and pressure the enemy from the side.\",\n    order: 3\n  }\n];\n\nconst SQUAD_SETTINGS = {\n  maxSquadSize: 3,\n  commandRange: 640,\n  followRadius: 120,\n  defendRadius: 180,\n  flankOffset: 220,\n  commandCooldown: 1.4,\n  supportFireCooldown: 0.45,\n  projectileSpeed: 520,\n  projectileDamage: 12\n};\n\nexport { SQUAD_COMMANDS, SQUAD_SETTINGS };\r\n","import { canvas, GROUND_Y } from \"../environment/canvas.js\";\r\nimport { POSES } from \"../config/constants.js\";\r\nimport { SQUAD_COMMANDS } from \"../config/squad.js\";\r\nimport { getEnvironmentSpawnSettings, onEnvironmentChange, getEnvironmentWidth } from \"./environment.js\";\r\n\r\nfunction createAimState(facing = 1, smoothing = 12) {\r\n  const baseAngle = facing >= 0 ? 0 : Math.PI;\r\n  const vx = Math.cos(baseAngle);\r\n  const vy = Math.sin(baseAngle);\r\n  return {\r\n    angle: baseAngle,\r\n    targetAngle: baseAngle,\r\n    vectorX: vx,\r\n    vectorY: vy,\r\n    magnitude: 1,\r\n    anchorX: 0,\r\n    anchorY: 0,\r\n    targetX: vx,\r\n    targetY: vy,\r\n    smoothing,\r\n    active: false,\r\n    lastUpdated: 0\r\n  };\r\n}\r\n\r\nfunction getTotalHeight(pose) {\r\n  return pose.headRadius * 2 + pose.bodyLength + pose.legLength;\r\n}\r\n\r\nfunction createGruntEnemy(spawnX, options = {}) {\r\n  const spawnSettings = getEnvironmentSpawnSettings();\r\n  const predefined = Array.isArray(spawnSettings?.enemies) ? spawnSettings.enemies : [];\r\n  const resolvedX = typeof spawnX === \"number\" ? spawnX : predefined[0] ?? getEnvironmentWidth() * 0.25;\r\n  const baseMaxHealth = 120;\r\n  const baseAttackDamage = 12;\r\n  const baseMoveSpeed = 160;\r\n  const enemyHeight = 118;\r\n  const spawnY = spawnSettings?.enemyY ?? GROUND_Y - enemyHeight;\r\n  const contextTag = options.context ?? \"sandbox\";\r\n  const autoRespawn = options.autoRespawn ?? contextTag !== \"survival\";\r\n  const spawnSide = options.spawnSide ?? null;\r\n  const initialFacing = options.facing ?? 1;\r\n  const id = `grunt-${Math.random().toString(36).slice(2, 8)}`;\r\n\r\n  return {\r\n    id,\r\n    spawnX: resolvedX,\r\n    spawnY,\r\n    x: resolvedX,\r\n    y: spawnY,\r\n    vx: 0,\r\n    vy: 0,\r\n    radius: 22,\r\n    height: enemyHeight,\r\n    facing: initialFacing,\r\n    onGround: true,\r\n    state: \"patrol\",\r\n    stateTimer: 1 + Math.random(),\r\n    patrolRange: { min: resolvedX - 100, max: resolvedX + 220 },\r\n    aggressionRange: 360,\r\n    attackRange: 86,\r\n    moveSpeed: baseMoveSpeed,\r\n    health: baseMaxHealth,\r\n    maxHealth: baseMaxHealth,\r\n    attackCooldown: 0,\r\n    attackWindup: 0,\r\n    attackActive: 0,\r\n    attackDamage: baseAttackDamage,\r\n    attackKnockback: 120,\r\n    attackLaunch: -80,\r\n    baseStats: {\r\n      maxHealth: baseMaxHealth,\r\n      attackDamage: baseAttackDamage,\r\n      moveSpeed: baseMoveSpeed\r\n    },\r\n    flashTimer: 0,\r\n    shakeTimer: 0,\r\n    shakeMagnitude: 0,\r\n    invulnerability: 0,\r\n    respawnTimer: 0,\r\n    stunTimer: 0,\r\n    smokeSlowTimer: 0,\r\n    smokeSlowStrength: 1,\r\n    spawnContext: contextTag,\r\n    autoRespawn,\r\n    spawnSide,\r\n    aim: createAimState(initialFacing, 12),\r\n    active: true\r\n  };\r\n}\r\n\r\nfunction createSquadmate(offsetX = 0, name = \"Ally\", baseX = getEnvironmentWidth() * 0.5) {\r\n  const spawnX = baseX + offsetX;\r\n  const spawnY = GROUND_Y - getTotalHeight(POSES.standing);\r\n  return {\r\n    id: `squad-${Math.random().toString(36).slice(2, 8)}`,\r\n    name,\r\n    x: spawnX,\r\n    y: spawnY,\r\n    vx: 0,\r\n    vy: 0,\r\n    facing: 1,\r\n    onGround: true,\r\n    state: \"follow\",\r\n    fireCooldown: 0,\r\n    commandTimer: 0,\r\n    targetEnemyId: null,\r\n    flashTimer: 0,\r\n    highlight: 0,\r\n    structureShieldTimer: 0,\r\n    structureShieldStrength: 0,\r\n    aim: createAimState(1, 18),\r\n    roleIndex: 0\r\n  };\r\n}\r\n\r\nconst spawnSettings = getEnvironmentSpawnSettings();\r\nconst standingHeight = getTotalHeight(POSES.standing);\r\nconst playerSpawnX = spawnSettings?.player?.x ?? getEnvironmentWidth() * 0.5;\r\nconst playerSpawnY = spawnSettings?.player?.y ?? GROUND_Y - standingHeight;\r\n\r\nconst stickman = {\r\n  x: playerSpawnX,\r\n  y: playerSpawnY,\r\n  vx: 0,\r\n  vy: 0,\r\n  facing: 1,\r\n  onGround: true,\r\n  controlMode: \"onFoot\",\r\n  vehicleId: null,\r\n  vehicleCandidateId: null,\r\n  squadCommandIndex: 0,\r\n  squadCommandId: SQUAD_COMMANDS[0]?.id ?? \"hold\",\r\n  squadCommandCooldown: 0,\r\n  rolling: false,\r\n  rollTimer: 0,\r\n  crouching: false,\r\n  currentPose: POSES.standing,\r\n  attacking: false,\r\n  attackIndex: -1,\r\n  currentAttack: null,\r\n  attackElapsed: 0,\r\n  attackInstanceId: 0,\r\n  comboWindowOpen: false,\r\n  comboWindowTimer: 0,\r\n  nextAttackQueued: false,\r\n  hitboxSpawned: false,\r\n  activeHitboxes: [],\r\n  health: 100,\r\n  maxHealth: 100,\r\n  invulnerability: 0,\r\n  deadTimer: 0,\r\n  throwCooldown: 0,\r\n  fireCooldown: 0,\r\n  gadgetCooldown: 0,\r\n  reloading: false,\r\n  stunTimer: 0,\r\n  flashBlindTimer: 0,\r\n  smokeSlowTimer: 0,\r\n  smokeSlowStrength: 1,\r\n  structureShieldTimer: 0,\r\n  structureShieldStrength: 0,\r\n  aim: createAimState(1, 22),\r\n  equippedWeaponId: \"combatFists\"\r\n};\r\n\r\nconst squadOffsets = Array.isArray(spawnSettings?.squadOffsets)\r\n  ? spawnSettings.squadOffsets\r\n  : [-120, 40, 120];\r\n\r\nconst squadmates = [\r\n  createSquadmate(squadOffsets[0] ?? -120, \"Sparrow\", playerSpawnX),\r\n  createSquadmate(squadOffsets[1] ?? 40, \"Rook\", playerSpawnX),\r\n  createSquadmate(squadOffsets[2] ?? 120, \"Viper\", playerSpawnX)\r\n];\r\n\r\nconst remotePlayers = new Map();\r\n\r\nfunction upsertRemotePlayer(state) {\r\n  if (!state || !state.id) {\r\n    return;\r\n  }\r\n  const now = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n  const existing = remotePlayers.get(state.id) ?? {};\r\n  remotePlayers.set(state.id, {\r\n    id: state.id,\r\n    name: state.name ?? existing.name ?? \"Remote\",\r\n    x: state.x ?? existing.x ?? 0,\r\n    y: state.y ?? existing.y ?? GROUND_Y - standingHeight,\r\n    facing: state.facing ?? existing.facing ?? 1,\r\n    commandId: state.commandId ?? existing.commandId ?? \"hold\",\r\n    lastUpdate: now\r\n  });\r\n}\r\n\r\nfunction getRemotePlayers() {\r\n  return Array.from(remotePlayers.values());\r\n}\r\n\r\nfunction pruneRemotePlayers(maxAgeMs = 6000) {\r\n  const now = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n  for (const [id, player] of remotePlayers.entries()) {\r\n    if (now - (player.lastUpdate ?? now) > maxAgeMs) {\r\n      remotePlayers.delete(id);\r\n    }\r\n  }\r\n}\r\n\r\nconst trainingDummy = {\r\n  id: \"training-dummy\",\r\n  x: spawnSettings?.trainingDummy?.x ?? getEnvironmentWidth() * 0.75,\r\n  y: spawnSettings?.trainingDummy?.y ?? GROUND_Y - 120,\r\n  height: 120,\r\n  radius: 26,\r\n  maxHealth: 150,\r\n  health: 150,\r\n  flashTimer: 0,\r\n  shakeTimer: 0,\r\n  shakeMagnitude: 0,\r\n  respawnTimer: 0\r\n};\r\n\r\nconst enemySpawnXs = Array.isArray(spawnSettings?.enemies)\r\n  ? spawnSettings.enemies\r\n  : [getEnvironmentWidth() * 0.24, getEnvironmentWidth() * 0.68];\r\n\r\nconst enemies = [\r\n  createGruntEnemy(enemySpawnXs[0], { context: \"sandbox\", autoRespawn: true, spawnSide: 0, facing: 1 }),\r\n  createGruntEnemy(enemySpawnXs[1], { context: \"sandbox\", autoRespawn: true, spawnSide: 1, facing: -1 })\r\n];\r\n\r\nfunction initializeSandboxEnemy(enemy, index) {\r\n  enemy.spawnSide = index;\r\n  enemy.spawnContext = enemy.spawnContext ?? \"sandbox\";\r\n  enemy.autoRespawn = enemy.autoRespawn ?? true;\r\n  enemy.facing = index === 0 ? 1 : -1;\r\n}\r\n\r\nenemies.forEach((enemy, index) => {\r\n  initializeSandboxEnemy(enemy, index);\r\n});\r\n\r\nfunction ensureSandboxEnemies(spawn, playerX) {\r\n  const enemyXs = Array.isArray(spawn.enemies) ? spawn.enemies : [];\r\n  const requiredSandbox = Math.max(2, enemyXs.length || 0);\r\n  const sandboxEnemies = enemies.filter((enemy) => enemy.spawnContext === \"sandbox\");\r\n  const existingSides = new Set(sandboxEnemies.map((enemy) => enemy.spawnSide ?? sandboxEnemies.indexOf(enemy)));\r\n\r\n  for (let side = 0; side < requiredSandbox; side += 1) {\r\n    if (!existingSides.has(side)) {\r\n      const fallback = playerX + (side === 0 ? -320 : 320);\r\n      const spawnX = typeof enemyXs[side] === \"number\" ? enemyXs[side] : fallback;\r\n      const newEnemy = createGruntEnemy(spawnX, { context: \"sandbox\", autoRespawn: true, spawnSide: side, facing: side === 0 ? 1 : -1 });\r\n      enemies.push(newEnemy);\r\n      sandboxEnemies.push(newEnemy);\r\n      existingSides.add(side);\r\n    }\r\n  }\r\n\r\n  for (const enemy of sandboxEnemies) {\r\n    const side = enemy.spawnSide ?? 0;\r\n    const fallback = playerX + (side === 0 ? -320 : 320);\r\n    const spawnX = typeof enemyXs[side] === \"number\" ? enemyXs[side] : fallback;\r\n    const spawnY = spawn.enemyY ?? GROUND_Y - enemy.height;\r\n    enemy.spawnSide = side;\r\n    enemy.spawnContext = \"sandbox\";\r\n    enemy.autoRespawn = true;\r\n    enemy.spawnX = spawnX;\r\n    enemy.spawnY = spawnY;\r\n    enemy.x = spawnX;\r\n    enemy.y = spawnY;\r\n    enemy.vx = 0;\r\n    enemy.vy = 0;\r\n    enemy.health = enemy.maxHealth;\r\n    enemy.invulnerability = 0;\r\n    enemy.flashTimer = 0;\r\n    enemy.shakeTimer = 0;\r\n    enemy.shakeMagnitude = 0;\r\n    enemy.respawnTimer = 0;\r\n    enemy.state = \"patrol\";\r\n    enemy.stateTimer = 1 + Math.random();\r\n    enemy.patrolRange = { min: spawnX - 100, max: spawnX + 220 };\r\n    enemy.onGround = true;\r\n    enemy.facing = side === 0 ? 1 : -1;\r\n  }\r\n}\r\n\r\nfunction applyEnvironmentSpawn(environment) {\r\n  const spawn = environment?.spawn ?? {};\r\n  const playerX = spawn.player?.x ?? getEnvironmentWidth() * 0.5;\r\n  const poseHeight = getTotalHeight(stickman.currentPose ?? POSES.standing);\r\n  const playerY = spawn.player?.y ?? GROUND_Y - poseHeight;\r\n\r\n  stickman.x = playerX;\r\n  stickman.y = playerY;\r\n  stickman.vx = 0;\r\n  stickman.vy = 0;\r\n  stickman.onGround = true;\r\n  stickman.controlMode = \"onFoot\";\r\n  stickman.vehicleId = null;\r\n  stickman.vehicleCandidateId = null;\r\n  stickman.rollTimer = 0;\r\n  stickman.crouching = false;\r\n  stickman.attacking = false;\r\n  stickman.attackIndex = -1;\r\n  stickman.currentAttack = null;\r\n  stickman.attackElapsed = 0;\r\n  stickman.comboWindowOpen = false;\r\n  stickman.comboWindowTimer = 0;\r\n  stickman.nextAttackQueued = false;\r\n  stickman.hitboxSpawned = false;\r\n  stickman.activeHitboxes.length = 0;\r\n  stickman.deadTimer = 0;\r\n  stickman.health = stickman.maxHealth;\r\n  stickman.structureShieldTimer = 0;\r\n  stickman.structureShieldStrength = 0;\r\n  stickman.invulnerability = 0;\r\n\r\n  const offsets = Array.isArray(spawn.squadOffsets) ? spawn.squadOffsets : squadOffsets;\r\n  squadmates.forEach((ally, index) => {\r\n    const offset = offsets[index] ?? (index - 1) * 80;\r\n    const allyX = playerX + offset;\r\n    const allyY = GROUND_Y - getTotalHeight(POSES.standing);\r\n    ally.x = allyX;\r\n    ally.y = allyY;\r\n    ally.vx = 0;\r\n    ally.vy = 0;\r\n    ally.onGround = true;\r\n    ally.state = \"follow\";\r\n    ally.flashTimer = 0;\r\n    ally.highlight = 0;\r\n    ally.structureShieldTimer = 0;\r\n    ally.structureShieldStrength = 0;\r\n  });\r\n\r\n  trainingDummy.x = spawn.trainingDummy?.x ?? getEnvironmentWidth() * 0.75;\r\n  trainingDummy.y = spawn.trainingDummy?.y ?? GROUND_Y - trainingDummy.height;\r\n  trainingDummy.health = trainingDummy.maxHealth;\r\n  trainingDummy.flashTimer = 0;\r\n  trainingDummy.shakeTimer = 0;\r\n  trainingDummy.shakeMagnitude = 0;\r\n  trainingDummy.respawnTimer = 0;\r\n\r\n  ensureSandboxEnemies(spawn, playerX);\r\n}\r\n\r\nfunction removeSandboxEnemies() {\r\n  for (let i = enemies.length - 1; i >= 0; i -= 1) {\r\n    if (enemies[i].spawnContext === \"sandbox\") {\r\n      enemies.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction restoreSandboxEnemies() {\r\n  const spawn = getEnvironmentSpawnSettings();\r\n  const playerX = spawn.player?.x ?? getEnvironmentWidth() * 0.5;\r\n  ensureSandboxEnemies(spawn, playerX);\r\n}\r\n\r\n\r\nonEnvironmentChange((environment) => {\r\n  applyEnvironmentSpawn(environment);\r\n});\r\n\r\nexport {\r\n  stickman,\r\n  trainingDummy,\r\n  enemies,\r\n  squadmates,\r\n  remotePlayers,\r\n  createGruntEnemy,\r\n  createSquadmate,\r\n  upsertRemotePlayer,\r\n  getRemotePlayers,\r\n  pruneRemotePlayers,\r\n  getTotalHeight,\r\n  removeSandboxEnemies,\r\n  restoreSandboxEnemies\r\n};\r\n\r\n\r\n\r\n\r\n","import { DEFAULT_LOADOUT, WEAPON_DEFINITIONS } from \"../config/weapons.js\";\r\nimport { stickman } from \"./entities.js\";\r\n\r\nconst weaponState = {\r\n  inventory: [...DEFAULT_LOADOUT],\r\n  activeIndex: 0\r\n};\r\n\r\nfunction isValidIndex(index) {\r\n  return index >= 0 && index < weaponState.inventory.length;\r\n}\r\n\r\nfunction getCurrentWeaponId() {\r\n  return weaponState.inventory[weaponState.activeIndex];\r\n}\r\n\r\nfunction setActiveWeaponByIndex(index) {\r\n  if (!isValidIndex(index)) {\r\n    return false;\r\n  }\r\n  weaponState.activeIndex = index;\r\n  stickman.equippedWeaponId = weaponState.inventory[index];\r\n  return true;\r\n}\r\n\r\nfunction getWeaponInventory() {\r\n  return weaponState.inventory.slice();\r\n}\r\n\r\nfunction addWeaponToInventory(weaponId, { autoEquip = false } = {}) {\r\n  if (!weaponId || !WEAPON_DEFINITIONS[weaponId]) {\r\n    return false;\r\n  }\r\n  let index = weaponState.inventory.indexOf(weaponId);\r\n  if (index === -1) {\r\n    weaponState.inventory.push(weaponId);\r\n    index = weaponState.inventory.length - 1;\r\n  }\r\n  if (autoEquip) {\r\n    setActiveWeaponByIndex(index);\r\n  } else {\r\n    ensureEquippedWeaponValid();\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction getThrowableCount() {\r\n  return weaponState.inventory\r\n    .map((id) => WEAPON_DEFINITIONS?.[id]?.category)\r\n    .filter((category) => category === \"throwable\")\r\n    .length;\r\n}\r\n\r\nfunction setWeaponInventory(newInventory = [], { equipId } = {}) {\n  const provided = Array.isArray(newInventory) ? newInventory : [];\n  const unique = Array.from(new Set(provided.filter((id) => WEAPON_DEFINITIONS[id])));\n  const inventory = unique.length > 0 ? unique : [...DEFAULT_LOADOUT];\n  weaponState.inventory = inventory;\n  let desiredId = equipId && inventory.includes(equipId) ? equipId : stickman.equippedWeaponId;\n  if (!desiredId || !inventory.includes(desiredId)) {\n    desiredId = inventory[0];\n  }\n  stickman.equippedWeaponId = desiredId;\n  weaponState.activeIndex = inventory.indexOf(desiredId);\n  ensureEquippedWeaponValid();\n}\n\nfunction resetWeaponInventory() {\n  setWeaponInventory(DEFAULT_LOADOUT, { equipId: DEFAULT_LOADOUT[0] });\n}\n\nfunction ensureEquippedWeaponValid() {\r\n  const existingIndex = weaponState.inventory.indexOf(stickman.equippedWeaponId);\r\n  if (existingIndex >= 0) {\r\n    weaponState.activeIndex = existingIndex;\r\n    return;\r\n  }\r\n\r\n  weaponState.inventory[0] = weaponState.inventory[0] ?? DEFAULT_LOADOUT[0];\r\n  weaponState.activeIndex = 0;\r\n  stickman.equippedWeaponId = weaponState.inventory[0];\r\n}\r\n\r\nensureEquippedWeaponValid();\r\n\r\nexport { weaponState, getCurrentWeaponId, setActiveWeaponByIndex, getWeaponInventory, getThrowableCount, addWeaponToInventory, setWeaponInventory, resetWeaponInventory };\r\n\r\n\r\n","import { WEAPON_DEFINITIONS } from \"../config/weapons.js\";\nimport { stickman } from \"./entities.js\";\n\nconst ammoState = new Map();\n\nfunction ensureAmmoEntry(weaponId) {\n  if (!weaponId) {\n    return null;\n  }\n  const def = WEAPON_DEFINITIONS[weaponId];\n  if (!def) {\n    ammoState.delete(weaponId);\n    return null;\n  }\n\n  const ammoDef = def.ammo;\n  const spreadDef = def.spread;\n\n  const hasAmmo = ammoDef !== undefined;\n  const capacity = hasAmmo ? Math.max(0, ammoDef.magazine ?? 0) : Number.POSITIVE_INFINITY;\n  const reserve = hasAmmo ? Math.max(0, ammoDef.reserve ?? 0) : Number.POSITIVE_INFINITY;\n  const reloadSeconds = hasAmmo ? Math.max(0.1, ammoDef.reloadSeconds ?? 1.2) : 0;\n\n  let entry = ammoState.get(weaponId);\n  if (!entry) {\n    entry = {\n      capacity,\n      magazine: capacity === Number.POSITIVE_INFINITY ? Number.POSITIVE_INFINITY : capacity,\n      reserve,\n      reloadSeconds,\n      reloadTimer: 0,\n      reloading: false,\n      spreadDef: spreadDef ?? null,\n      spread: spreadDef ? { current: spreadDef.base ?? 0 } : null\n    };\n    ammoState.set(weaponId, entry);\n  } else {\n    entry.capacity = capacity;\n    if (capacity === Number.POSITIVE_INFINITY) {\n      entry.magazine = Number.POSITIVE_INFINITY;\n    } else if (!hasAmmo) {\n      entry.magazine = capacity;\n    } else {\n      entry.magazine = Math.min(entry.magazine, capacity);\n    }\n    entry.reserve = reserve;\n    entry.reloadSeconds = reloadSeconds;\n    entry.spreadDef = spreadDef ?? null;\n    if (!entry.spread && spreadDef) {\n      entry.spread = { current: spreadDef.base ?? 0 };\n    }\n    if (!spreadDef) {\n      entry.spread = null;\n    }\n  }\n  return entry;\n}\n\nfunction getAmmoStatus(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry) {\n    return null;\n  }\n  return {\n    magazine: entry.magazine,\n    reserve: entry.reserve,\n    capacity: entry.capacity,\n    reloading: entry.reloading,\n    reloadTimer: entry.reloadTimer,\n    reloadSeconds: entry.reloadSeconds\n  };\n}\n\nfunction consumeAmmo(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry) {\n    return true;\n  }\n  if (entry.capacity === Number.POSITIVE_INFINITY) {\n    return true;\n  }\n  if (entry.reloading) {\n    return false;\n  }\n  if (entry.magazine <= 0) {\n    return false;\n  }\n  entry.magazine -= 1;\n  return true;\n}\n\nfunction startReload(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry) {\n    return false;\n  }\n  if (entry.capacity === Number.POSITIVE_INFINITY) {\n    return false;\n  }\n  if (entry.reloading) {\n    return false;\n  }\n  if (entry.magazine >= entry.capacity) {\n    return false;\n  }\n  if (entry.reserve <= 0) {\n    return false;\n  }\n  entry.reloading = true;\n  entry.reloadTimer = entry.reloadSeconds;\n  if (stickman.equippedWeaponId === weaponId) {\n    stickman.reloading = true;\n  }\n  return true;\n}\n\nfunction cancelReload(weaponId) {\n  const entry = ammoState.get(weaponId);\n  if (!entry) {\n    return;\n  }\n  entry.reloading = false;\n  entry.reloadTimer = 0;\n  if (stickman.equippedWeaponId === weaponId) {\n    stickman.reloading = false;\n  }\n}\n\nfunction registerShot(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  const def = entry?.spreadDef;\n  if (!entry || !def) {\n    return 0;\n  }\n\n  if (!entry.spread) {\n    entry.spread = { current: def.base ?? 0 };\n  }\n  const spreadState = entry.spread;\n  const base = def.base ?? 0;\n  const current = Math.max(base, spreadState.current ?? base);\n  const max = def.max ?? current;\n  const effectiveDegrees = Math.min(max, current);\n  const radians = effectiveDegrees * (Math.PI / 180);\n  const angle = radians > 0 ? (Math.random() * 2 - 1) * radians : 0;\n\n  const perShot = def.perShot ?? 0;\n  spreadState.current = Math.min(max, effectiveDegrees + perShot);\n\n  return angle;\n}\n\nfunction updateAmmoTimers(delta, activeWeaponId) {\n  const completedReloads = [];\n  for (const [weaponId, entry] of ammoState.entries()) {\n    const def = WEAPON_DEFINITIONS[weaponId];\n    if (!def) {\n      ammoState.delete(weaponId);\n      continue;\n    }\n\n    if (entry.reloading) {\n      entry.reloadTimer = Math.max(0, entry.reloadTimer - delta);\n      if (entry.reloadTimer <= 0) {\n        if (entry.capacity !== Number.POSITIVE_INFINITY) {\n          const needed = entry.capacity - entry.magazine;\n          if (needed > 0) {\n            const loaded = Math.min(needed, entry.reserve);\n            entry.magazine += loaded;\n            entry.reserve -= loaded;\n          }\n        }\n        entry.reloading = false;\n        entry.reloadTimer = 0;\n        completedReloads.push(weaponId);\n      }\n    }\n\n    if (entry.spread && entry.spreadDef) {\n      const base = entry.spreadDef.base ?? 0;\n      const recovery = entry.spreadDef.recovery ?? 0;\n      if (recovery > 0) {\n        entry.spread.current = Math.max(base, entry.spread.current - recovery * delta);\n      } else {\n        entry.spread.current = Math.max(base, entry.spread.current ?? base);\n      }\n    }\n  }\n\n  if (activeWeaponId) {\n    const entry = ammoState.get(activeWeaponId);\n    stickman.reloading = entry?.reloading ?? false;\n  } else {\n    stickman.reloading = false;\n  }\n\n  if (typeof window !== \"undefined\") {\n    for (const weaponId of completedReloads) {\n      window.dispatchEvent(new CustomEvent(\"weapon:reload-finish\", { detail: { weaponId } }));\n    }\n  }\n}\n\nfunction refillWeaponAmmo(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry || entry.capacity === Number.POSITIVE_INFINITY) {\n    return;\n  }\n  entry.magazine = entry.capacity;\n  entry.reserve = WEAPON_DEFINITIONS[weaponId]?.ammo?.reserve ?? entry.reserve;\n  entry.reloading = false;\n  entry.reloadTimer = 0;\n}\nfunction setWeaponInfiniteAmmo(weaponId) {\n  const entry = ensureAmmoEntry(weaponId);\n  if (!entry) {\n    return;\n  }\n  entry.capacity = Number.POSITIVE_INFINITY;\n  entry.magazine = Number.POSITIVE_INFINITY;\n  entry.reserve = Number.POSITIVE_INFINITY;\n  entry.reloading = false;\n  entry.reloadTimer = 0;\n  if (stickman.equippedWeaponId === weaponId) {\n    stickman.reloading = false;\n  }\n}\n\nfunction resetWeaponAmmo(weaponId) {\n  if (!weaponId) {\n    return;\n  }\n  ammoState.delete(weaponId);\n  ensureAmmoEntry(weaponId);\n}\n\nfunction resetAllWeaponAmmo() {\n  ammoState.clear();\n  if (stickman.equippedWeaponId) {\n    ensureAmmoEntry(stickman.equippedWeaponId);\n  }\n}\n\nexport {\n  ensureAmmoEntry,\n  getAmmoStatus,\n  consumeAmmo,\n  startReload,\n  cancelReload,\n  registerShot,\n  updateAmmoTimers,\n  refillWeaponAmmo,\n  setWeaponInfiniteAmmo,\n  resetWeaponAmmo,\n  resetAllWeaponAmmo\n};\r\n\r\n\r\n\r\n\r\n","import { WEAPON_DEFINITIONS } from \"../../config/weapons.js\";\nimport { stickman } from \"../../state/entities.js\";\nimport { weaponState, getCurrentWeaponId, setActiveWeaponByIndex, getWeaponInventory } from \"../../state/weapons.js\";\nimport { getAmmoStatus, ensureAmmoEntry, cancelReload } from \"../../state/ammo.js\";\n\nlet controlsInitialized = false;\n\nconst previousWeaponState = {\n  id: stickman.equippedWeaponId\n};\n\nequipWeaponIndex(weaponState.activeIndex);\n\nfunction getWeaponDefinitionById(id) {\n  return WEAPON_DEFINITIONS[id];\n}\n\nfunction getCurrentWeapon() {\n  const weaponId = getCurrentWeaponId();\n  return getWeaponDefinitionById(weaponId) ?? null;\n}\n\nfunction equipWeaponIndex(index) {\n  const previousId = stickman.equippedWeaponId;\n  if (!setActiveWeaponByIndex(index)) {\n    return false;\n  }\n  if (previousId && previousId !== stickman.equippedWeaponId) {\n    cancelReload(previousId);\n  }\n\n  ensureAmmoEntry(stickman.equippedWeaponId);\n\n  stickman.attacking = false;\n  stickman.currentAttack = null;\n  stickman.attackElapsed = 0;\n  stickman.comboWindowOpen = false;\n  stickman.comboWindowTimer = 0;\n  stickman.attackIndex = -1;\n  stickman.hitboxSpawned = false;\n\n  const ammoStatus = getAmmoStatus(stickman.equippedWeaponId);\n  stickman.reloading = ammoStatus?.reloading ?? false;\r\n  stickman.fireCooldown = 0;\n\n  previousWeaponState.id = stickman.equippedWeaponId;\n  return true;\n}\n\nfunction equipWeaponBySlot(slotNumber) {\n  const index = slotNumber - 1;\n  equipWeaponIndex(index);\n}\n\nfunction getSlotFromCode(code) {\n  if (code.startsWith(\"Digit\")) {\n    return Number.parseInt(code.slice(5), 10);\n  }\n  if (code.startsWith(\"Numpad\")) {\n    return Number.parseInt(code.slice(6), 10);\n  }\n  return Number.NaN;\n}\n\nfunction handleWeaponKey(event) {\n  const slot = getSlotFromCode(event.code);\n  if (!Number.isNaN(slot) && slot >= 1) {\n    equipWeaponBySlot(slot);\n    event.preventDefault();\n  }\n}\n\nfunction initializeWeaponControls() {\n  if (controlsInitialized) {\n    return;\n  }\n  window.addEventListener(\"keydown\", handleWeaponKey);\n  controlsInitialized = true;\n}\n\nfunction getWeaponSlots() {\n  return getWeaponInventory().map((id) => WEAPON_DEFINITIONS[id] ?? { id, name: \"Unknown\" });\n}\n\nexport {\n  getCurrentWeapon,\n  getWeaponDefinitionById,\n  equipWeaponBySlot,\n  initializeWeaponControls,\n  getWeaponSlots\n};\r\n\r\n","const LOADOUT_SLOTS = [\n  {\n    id: \"meleePrimary\",\n    label: \"Melee I\",\n    allowedCategories: [\"melee-short\", \"melee-mid\"],\n    defaultWeaponId: \"combatFists\"\n  },\n  {\n    id: \"meleeSecondary\",\n    label: \"Melee II\",\n    allowedCategories: [\"melee-short\", \"melee-mid\"],\n    defaultWeaponId: \"shockBaton\"\n  },\n  {\n    id: \"rangedPrimary\",\n    label: \"Ranged\",\n    allowedCategories: [\"ranged-short\", \"ranged-mid\", \"ranged-heavy\"],\n    defaultWeaponId: \"strikerPistol\"\n  },\n  {\n    id: \"throwableAlpha\",\n    label: \"Throwable I\",\n    allowedCategories: [\"throwable\"],\n    defaultWeaponId: \"fragGrenade\"\n  },\n  {\n    id: \"throwableBeta\",\n    label: \"Throwable II\",\n    allowedCategories: [\"throwable\"],\n    defaultWeaponId: \"flashBang\"\n  },\n  {\n    id: \"throwableGamma\",\n    label: \"Throwable III\",\n    allowedCategories: [\"throwable\"],\n    defaultWeaponId: \"smokeCanister\"\n  },\n  {\n    id: \"gadgetAlpha\",\n    label: \"Gadget I\",\n    allowedCategories: [\"gadget\"],\n    defaultWeaponId: \"turretDrone\"\n  },\n  {\n    id: \"gadgetBeta\",\n    label: \"Gadget II\",\n    allowedCategories: [\"gadget\"],\n    defaultWeaponId: \"grappleRig\"\n  },\n  {\n    id: \"gadgetGamma\",\n    label: \"Gadget III\",\n    allowedCategories: [\"gadget\"],\n    defaultWeaponId: \"shieldBubble\"\n  }\n];\n\nconst LOADOUT_STORAGE_KEY = \"stickman-warfare-loadout.v1\";\n\nexport { LOADOUT_SLOTS, LOADOUT_STORAGE_KEY };\r\n","import { LOADOUT_SLOTS, LOADOUT_STORAGE_KEY } from \"../config/loadouts.js\";\nimport { WEAPON_DEFINITIONS, DEFAULT_LOADOUT } from \"../config/weapons.js\";\nimport { setWeaponInventory, getCurrentWeaponId } from \"./weapons.js\";\nimport { resetAllWeaponAmmo } from \"./ammo.js\";\n\nfunction getAllowedWeaponsForSlot(slot) {\n  const categories = Array.isArray(slot?.allowedCategories) ? slot.allowedCategories : [];\n  if (categories.length === 0) {\n    return [];\n  }\n  return Object.values(WEAPON_DEFINITIONS)\n    .filter((weapon) => categories.includes(weapon.category))\n    .sort((a, b) => a.name.localeCompare(b.name))\n    .map((weapon) => weapon.id);\n}\n\nfunction resolveDefaultWeapon(slot, index) {\n  const allowed = getAllowedWeaponsForSlot(slot);\n  if (allowed.length === 0) {\n    return null;\n  }\n  const preferred = [\n    DEFAULT_LOADOUT[index],\n    slot.defaultWeaponId\n  ];\n  for (const candidate of preferred) {\n    if (candidate && allowed.includes(candidate)) {\n      return candidate;\n    }\n  }\n  return allowed[0];\n}\n\nfunction createAssignments() {\n  return LOADOUT_SLOTS.map((slot, index) => ({\n    slotId: slot.id,\n    weaponId: resolveDefaultWeapon(slot, index)\n  }));\n}\n\nlet assignments = createAssignments();\n\nfunction cloneAssignments() {\n  return assignments.map((entry) => ({ ...entry }));\n}\n\nfunction getAssignmentIndex(slotId) {\n  return assignments.findIndex((entry) => entry.slotId === slotId);\n}\n\nfunction ensureAssignmentsUnique() {\n  const seen = new Set();\n  for (let index = 0; index < assignments.length; index += 1) {\n    const slot = LOADOUT_SLOTS[index];\n    if (!slot) {\n      continue;\n    }\n    const allowed = getAllowedWeaponsForSlot(slot);\n    const entry = assignments[index];\n    let weaponId = entry.weaponId;\n    if (!weaponId || !allowed.includes(weaponId) || seen.has(weaponId)) {\n      weaponId = allowed.find((id) => !seen.has(id)) ?? allowed[0] ?? null;\n    }\n    entry.weaponId = weaponId ?? null;\n    if (weaponId) {\n      seen.add(weaponId);\n    }\n  }\n}\n\nfunction applyAssignments(newAssignments) {\n  assignments = LOADOUT_SLOTS.map((slot, index) => {\n    const incoming = newAssignments.find((entry) => entry.slotId === slot.id);\n    let weaponId = incoming?.weaponId ?? null;\n    const allowed = getAllowedWeaponsForSlot(slot);\n    if (!weaponId || !allowed.includes(weaponId)) {\n      weaponId = resolveDefaultWeapon(slot, index);\n    }\n    return { slotId: slot.id, weaponId };\n  });\n  ensureAssignmentsUnique();\n}\n\nfunction getLoadoutAssignments() {\n  return cloneAssignments();\n}\n\nfunction getLoadoutWeaponList() {\n  return assignments\n    .map((entry) => entry.weaponId)\n    .filter((weaponId) => typeof weaponId === \"string\" && weaponId.length > 0);\n}\n\nfunction setSlotWeapon(slotId, weaponId) {\n  const slotIndex = getAssignmentIndex(slotId);\n  if (slotIndex === -1) {\n    return false;\n  }\n  const slot = LOADOUT_SLOTS[slotIndex];\n  const allowed = getAllowedWeaponsForSlot(slot);\n  if (!allowed.includes(weaponId)) {\n    return false;\n  }\n  const current = assignments[slotIndex].weaponId;\n  if (current === weaponId) {\n    return false;\n  }\n  const conflictIndex = assignments.findIndex((entry, index) => index !== slotIndex && entry.weaponId === weaponId);\n  if (conflictIndex >= 0) {\n    assignments[conflictIndex].weaponId = current;\n  }\n  assignments[slotIndex].weaponId = weaponId;\n  ensureAssignmentsUnique();\n  return true;\n}\n\nfunction cycleSlotWeapon(slotId, direction = 1) {\n  const slotIndex = getAssignmentIndex(slotId);\n  if (slotIndex === -1) {\n    return null;\n  }\n  const slot = LOADOUT_SLOTS[slotIndex];\n  const allowed = getAllowedWeaponsForSlot(slot);\n  if (allowed.length === 0) {\n    return null;\n  }\n  const current = assignments[slotIndex].weaponId;\n  let currentIndex = allowed.indexOf(current);\n  if (currentIndex === -1) {\n    currentIndex = 0;\n  }\n  const nextIndex = (currentIndex + direction + allowed.length) % allowed.length;\n  const nextId = allowed[nextIndex];\n  const changed = setSlotWeapon(slotId, nextId);\n  return {\n    slotIndex,\n    weaponId: assignments[slotIndex].weaponId,\n    changed\n  };\n}\n\nfunction resetLoadout() {\n  assignments = createAssignments();\n  ensureAssignmentsUnique();\n  return getLoadoutAssignments();\n}\n\nfunction applyLoadout({ preserveEquipped = true } = {}) {\n  ensureAssignmentsUnique();\n  const weaponList = getLoadoutWeaponList();\n  const inventory = weaponList.length > 0 ? weaponList : DEFAULT_LOADOUT.slice();\n  const equipId = preserveEquipped ? getCurrentWeaponId() : inventory[0];\n  setWeaponInventory(inventory, { equipId });\n  resetAllWeaponAmmo();\n  return inventory;\n}\n\nfunction saveLoadout() {\n  if (typeof localStorage === \"undefined\") {\n    return false;\n  }\n  try {\n    const payload = assignments.map((entry) => ({ ...entry }));\n    localStorage.setItem(LOADOUT_STORAGE_KEY, JSON.stringify(payload));\n    return true;\n  } catch (error) {\n    console.warn(\"Failed to save loadout\", error);\n    return false;\n  }\n}\n\nfunction loadLoadout() {\n  if (typeof localStorage === \"undefined\") {\n    ensureAssignmentsUnique();\n    return false;\n  }\n  try {\n    const raw = localStorage.getItem(LOADOUT_STORAGE_KEY);\n    if (!raw) {\n      ensureAssignmentsUnique();\n      return false;\n    }\n    const parsed = JSON.parse(raw);\n    if (!Array.isArray(parsed)) {\n      ensureAssignmentsUnique();\n      return false;\n    }\n    const sanitized = parsed\n      .map((entry) => {\n        if (!entry || typeof entry !== \"object\") {\n          return null;\n        }\n        const slotId = entry.slotId ?? null;\n        const weaponId = typeof entry.weaponId === \"string\" ? entry.weaponId : null;\n        if (!slotId || !weaponId) {\n          return null;\n        }\n        return { slotId, weaponId };\n      })\n      .filter(Boolean);\n    applyAssignments(sanitized);\n    ensureAssignmentsUnique();\n    return true;\n  } catch (error) {\n    console.warn(\"Failed to load saved loadout\", error);\n    ensureAssignmentsUnique();\n    return false;\n  }\n}\n\nfunction getResolvedLoadoutSlots() {\n  return LOADOUT_SLOTS.map((slot, index) => {\n    const assignment = assignments[index];\n    const weaponId = assignment?.weaponId ?? null;\n    const weapon = weaponId ? WEAPON_DEFINITIONS[weaponId] ?? null : null;\n    return {\n      index,\n      slotId: slot.id,\n      label: slot.label,\n      allowedCategories: Array.isArray(slot.allowedCategories) ? slot.allowedCategories.slice() : [],\n      allowedWeaponIds: getAllowedWeaponsForSlot(slot),\n      weaponId,\n      weapon\n    };\n  });\n}\n\nexport {\n  getLoadoutAssignments,\n  getLoadoutWeaponList,\n  getResolvedLoadoutSlots,\n  setSlotWeapon,\n  cycleSlotWeapon,\n  resetLoadout,\n  applyLoadout,\n  saveLoadout,\n  loadLoadout\n};\r\n","import {\n  getResolvedLoadoutSlots,\n  cycleSlotWeapon,\n  resetLoadout,\n  applyLoadout,\n  saveLoadout,\n  loadLoadout\n} from \"../../state/loadout.js\";\nimport { resetInputs } from \"../input/index.js\";\n\nconst MESSAGE_DURATION = 2.6;\n\nconst uiState = {\n  visible: false,\n  slotIndex: 0,\n  optionIndex: 0,\n  message: null,\n  messageTimer: 0\n};\n\nlet initialized = false;\n\nfunction clampSlotIndex(total) {\n  if (total <= 0) {\n    uiState.slotIndex = 0;\n    uiState.optionIndex = 0;\n    return;\n  }\n  if (uiState.slotIndex >= total) {\n    uiState.slotIndex = total - 1;\n  }\n  if (uiState.slotIndex < 0) {\n    uiState.slotIndex = 0;\n  }\n}\n\nfunction syncOptionIndex(slots) {\n  const resolvedSlots = Array.isArray(slots) ? slots : getResolvedLoadoutSlots();\n  clampSlotIndex(resolvedSlots.length);\n  const activeSlot = resolvedSlots[uiState.slotIndex];\n  if (!activeSlot) {\n    uiState.optionIndex = 0;\n    return resolvedSlots;\n  }\n  const allowed = activeSlot.allowedWeaponIds;\n  if (!Array.isArray(allowed) || allowed.length === 0) {\n    uiState.optionIndex = 0;\n    return resolvedSlots;\n  }\n  const currentIndex = allowed.indexOf(activeSlot.weaponId);\n  uiState.optionIndex = currentIndex >= 0 ? currentIndex : 0;\n  return resolvedSlots;\n}\n\nfunction setMessage(message) {\n  uiState.message = message ?? null;\n  uiState.messageTimer = message ? MESSAGE_DURATION : 0;\n}\n\nfunction applyAndPersist(message) {\n  applyLoadout({ preserveEquipped: true });\n  saveLoadout();\n  setMessage(message);\n}\n\nfunction openEditor() {\n  if (uiState.visible) {\n    return;\n  }\n  uiState.visible = true;\n  syncOptionIndex();\n  setMessage(null);\n  resetInputs();\n}\n\nfunction closeEditor() {\n  if (!uiState.visible) {\n    return;\n  }\n  uiState.visible = false;\n  resetInputs();\n  setMessage(null);\n}\n\nfunction moveSlot(delta) {\n  const slots = getResolvedLoadoutSlots();\n  if (slots.length === 0) {\n    return;\n  }\n  uiState.slotIndex = (uiState.slotIndex + delta + slots.length) % slots.length;\n  syncOptionIndex(slots);\n}\n\nfunction cycleOption(delta) {\n  const slots = getResolvedLoadoutSlots();\n  const activeSlot = slots[uiState.slotIndex];\n  if (!activeSlot) {\n    return;\n  }\n  const result = cycleSlotWeapon(activeSlot.slotId, delta);\n  if (!result || result.changed === false) {\n    syncOptionIndex();\n    return;\n  }\n  const updatedSlots = syncOptionIndex();\n  const updatedSlot = updatedSlots[uiState.slotIndex];\n  const weaponName = updatedSlot?.weapon?.name ?? \"Updated\";\n  applyAndPersist(`${updatedSlot?.label ?? \"Slot\"} ? ${weaponName}`);\n}\n\nfunction handleReset() {\n  resetLoadout();\n  applyLoadout({ preserveEquipped: false });\n  saveLoadout();\n  const slots = syncOptionIndex();\n  const firstWeapon = slots[0]?.weapon?.name;\n  setMessage(firstWeapon ? `Defaults restored (${firstWeapon} equipped)` : \"Defaults restored\");\n}\n\nfunction handleKeyDown(event) {\n  if (event.defaultPrevented) {\n    return;\n  }\n  const code = event.code;\n  if (!uiState.visible) {\n    if (code === \"KeyL\") {\n      openEditor();\n      event.preventDefault();\n      event.stopPropagation();\n    }\n    return;\n  }\n\n  switch (code) {\n    case \"Escape\":\n      closeEditor();\n      break;\n    case \"KeyL\":\n    case \"Enter\":\n      closeEditor();\n      break;\n    case \"ArrowUp\":\n      moveSlot(-1);\n      setMessage(null);\n      break;\n    case \"ArrowDown\":\n      moveSlot(1);\n      setMessage(null);\n      break;\n    case \"Tab\":\n      moveSlot(event.shiftKey ? -1 : 1);\n      setMessage(null);\n      break;\n    case \"ArrowLeft\":\n      cycleOption(-1);\n      break;\n    case \"ArrowRight\":\n      cycleOption(1);\n      break;\n    case \"KeyR\":\n      handleReset();\n      break;\n    default:\n      return;\n  }\n  event.preventDefault();\n  event.stopPropagation();\n}\n\nfunction handlePointerEvent(event) {\n  if (!uiState.visible) {\n    return;\n  }\n  event.preventDefault();\n  event.stopPropagation();\n}\n\nfunction initializeLoadoutSystem() {\n  if (initialized) {\n    return;\n  }\n  loadLoadout();\n  applyLoadout({ preserveEquipped: true });\n  syncOptionIndex();\n  window.addEventListener(\"keydown\", handleKeyDown, true);\n  window.addEventListener(\"mousedown\", handlePointerEvent, true);\n  window.addEventListener(\"mouseup\", handlePointerEvent, true);\n  window.addEventListener(\"contextmenu\", handlePointerEvent, true);\n  initialized = true;\n}\n\nfunction updateLoadoutSystem(delta = 0) {\n  if (uiState.messageTimer > 0) {\n    uiState.messageTimer = Math.max(0, uiState.messageTimer - delta);\n    if (uiState.messageTimer === 0) {\n      uiState.message = null;\n    }\n  }\n}\n\nfunction isLoadoutEditorVisible() {\n  return uiState.visible;\n}\n\nfunction getLoadoutEditorState() {\n  const slots = syncOptionIndex();\n  return {\n    visible: uiState.visible,\n    slotIndex: uiState.slotIndex,\n    optionIndex: uiState.optionIndex,\n    slots,\n    message: uiState.message,\n    messageTimer: uiState.messageTimer\n  };\n}\n\nexport {\n  initializeLoadoutSystem,\n  updateLoadoutSystem,\n  isLoadoutEditorVisible,\n  getLoadoutEditorState\n};\r\n","const COSMETIC_CATEGORIES = [\n  {\n    id: \"helmet\",\n    label: \"Helmet\",\n    description: \"Headgear and visors for the operative.\",\n    options: [\n      {\n        id: \"helmet-none\",\n        name: \"No Helmet\",\n        description: \"Keeps the classic stickman silhouette.\",\n        style: { type: \"none\" }\n      },\n      {\n        id: \"helmet-strike\",\n        name: \"Strike Visor\",\n        description: \"Angled carbon shell with cyan visor glow.\",\n        style: {\n          type: \"visor\",\n          shellColor: \"#1a2233\",\n          accentColor: \"#2f3b55\",\n          visorColor: \"#68e7ff\",\n          visorAlpha: 0.7\n        }\n      },\n      {\n        id: \"helmet-vanguard\",\n        name: \"Vanguard Helm\",\n        description: \"Tactical helmet with reinforced cheek plates.\",\n        style: {\n          type: \"plated\",\n          shellColor: \"#2f2a3f\",\n          accentColor: \"#5f4c7d\",\n          trimColor: \"#ffb36a\"\n        }\n      }\n    ]\n  },\n  {\n    id: \"armor\",\n    label: \"Armor\",\n    description: \"Chest harness and shoulder plating.\",\n    options: [\n      {\n        id: \"armor-lite\",\n        name: \"Light Harness\",\n        description: \"Minimal straps with subdued accents.\",\n        style: {\n          type: \"harness\",\n          strapColor: \"#444b63\",\n          accentColor: \"#8ca3ff\"\n        }\n      },\n      {\n        id: \"armor-carbon\",\n        name: \"Carbon Plating\",\n        description: \"Segmented chest plates with copper trim.\",\n        style: {\n          type: \"plating\",\n          plateColor: \"#212733\",\n          trimColor: \"#ffad66\",\n          glowColor: \"#ffa24b\"\n        }\n      },\n      {\n        id: \"armor-scout\",\n        name: \"Recon Webbing\",\n        description: \"Layered harness with utility pouches.\",\n        style: {\n          type: \"webbing\",\n          strapColor: \"#2f3a44\",\n          pouchColor: \"#556668\",\n          accentColor: \"#9ad6ff\"\n        }\n      }\n    ]\n  },\n  {\n    id: \"jetpack\",\n    label: \"Jetpack\",\n    description: \"Back-mounted rigs for aerial flair.\",\n    options: [\n      {\n        id: \"jetpack-none\",\n        name: \"No Jetpack\",\n        description: \"Travel light and nimble.\",\n        style: { type: \"none\" }\n      },\n      {\n        id: \"jetpack-sprint\",\n        name: \"Sprint Thrusters\",\n        description: \"Compact dual thrusters with teal exhaust glow.\",\n        style: {\n          type: \"dual\",\n          bodyColor: \"#1f2d44\",\n          exhaustColor: \"#76e6ff\",\n          exhaustAlpha: 0.75\n        }\n      },\n      {\n        id: \"jetpack-bastion\",\n        name: \"Bastion Pack\",\n        description: \"Armored flight rig with amber burn.\",\n        style: {\n          type: \"shielded\",\n          bodyColor: \"#3a2f2f\",\n          panelColor: \"#5e4a3a\",\n          exhaustColor: \"#ffb96a\",\n          exhaustAlpha: 0.8\n        }\n      }\n    ]\n  }\n];\n\nconst COSMETIC_ITEMS = COSMETIC_CATEGORIES.reduce((map, category) => {\n  category.options.forEach((option) => {\n    map[option.id] = { ...option, category: category.id };\n  });\n  return map;\n}, {});\n\nconst DEFAULT_COSMETICS = {\n  helmet: \"helmet-strike\",\n  armor: \"armor-carbon\",\n  jetpack: \"jetpack-none\"\n};\n\nconst COSMETIC_STORAGE_KEY = \"stickman-warfare-cosmetics.v1\";\n\nexport { COSMETIC_CATEGORIES, COSMETIC_ITEMS, DEFAULT_COSMETICS, COSMETIC_STORAGE_KEY };\r\n","import { COSMETIC_CATEGORIES, COSMETIC_ITEMS, DEFAULT_COSMETICS, COSMETIC_STORAGE_KEY } from \"../config/cosmetics.js\";\n\nconst cosmeticState = {\n  selections: { ...DEFAULT_COSMETICS }\n};\n\nfunction cloneSelections() {\n  return { ...cosmeticState.selections };\n}\n\nfunction getOptionsForCategory(categoryId) {\n  const category = COSMETIC_CATEGORIES.find((entry) => entry.id === categoryId);\n  return Array.isArray(category?.options) ? category.options.map((option) => option.id) : [];\n}\n\nfunction normalizeSelection(categoryId, optionId) {\n  const options = getOptionsForCategory(categoryId);\n  if (options.length === 0) {\n    return null;\n  }\n  if (optionId && options.includes(optionId)) {\n    return optionId;\n  }\n  const fallback = DEFAULT_COSMETICS[categoryId];\n  if (fallback && options.includes(fallback)) {\n    return fallback;\n  }\n  return options[0];\n}\n\nfunction ensureSelectionsValid() {\n  const next = {};\n  COSMETIC_CATEGORIES.forEach((category) => {\n    next[category.id] = normalizeSelection(category.id, cosmeticState.selections[category.id]);\n  });\n  cosmeticState.selections = next;\n}\n\nfunction setCosmeticSelection(categoryId, optionId) {\n  if (!categoryId) {\n    return false;\n  }\n  const normalized = normalizeSelection(categoryId, optionId);\n  if (!normalized) {\n    return false;\n  }\n  if (cosmeticState.selections[categoryId] === normalized) {\n    return false;\n  }\n  cosmeticState.selections = {\n    ...cosmeticState.selections,\n    [categoryId]: normalized\n  };\n  return true;\n}\n\nfunction cycleCosmeticSelection(categoryId, direction = 1) {\n  const options = getOptionsForCategory(categoryId);\n  if (options.length === 0) {\n    return null;\n  }\n  const current = cosmeticState.selections[categoryId] ?? options[0];\n  const index = options.indexOf(current);\n  const nextIndex = (index + direction + options.length) % options.length;\n  const optionId = options[nextIndex];\n  const changed = setCosmeticSelection(categoryId, optionId);\n  return {\n    optionId,\n    changed\n  };\n}\n\nfunction getCosmeticSelections() {\n  return cloneSelections();\n}\n\nfunction getCosmeticOption(optionId) {\n  return COSMETIC_ITEMS[optionId] ?? null;\n}\n\nfunction getResolvedCosmetics() {\n  ensureSelectionsValid();\n  return COSMETIC_CATEGORIES.map((category) => {\n    const selectionId = cosmeticState.selections[category.id];\n    const option = getCosmeticOption(selectionId);\n    return {\n      categoryId: category.id,\n      label: category.label,\n      selectionId,\n      option\n    };\n  });\n}\n\nfunction resetCosmetics() {\n  cosmeticState.selections = { ...DEFAULT_COSMETICS };\n  return getCosmeticSelections();\n}\n\nfunction saveCosmetics() {\n  if (typeof localStorage === \"undefined\") {\n    return false;\n  }\n  try {\n    localStorage.setItem(COSMETIC_STORAGE_KEY, JSON.stringify(cosmeticState.selections));\n    return true;\n  } catch (error) {\n    console.warn(\"Failed to save cosmetics\", error);\n    return false;\n  }\n}\n\nfunction loadCosmetics() {\n  if (typeof localStorage === \"undefined\") {\n    ensureSelectionsValid();\n    return false;\n  }\n  try {\n    const raw = localStorage.getItem(COSMETIC_STORAGE_KEY);\n    if (!raw) {\n      ensureSelectionsValid();\n      return false;\n    }\n    const parsed = JSON.parse(raw);\n    if (!parsed || typeof parsed !== \"object\") {\n      ensureSelectionsValid();\n      return false;\n    }\n    const selections = { ...DEFAULT_COSMETICS };\n    COSMETIC_CATEGORIES.forEach((category) => {\n      selections[category.id] = normalizeSelection(category.id, parsed[category.id]);\n    });\n    cosmeticState.selections = selections;\n    return true;\n  } catch (error) {\n    console.warn(\"Failed to load cosmetics\", error);\n    ensureSelectionsValid();\n    return false;\n  }\n}\n\nfunction getCosmeticCategories() {\n  return COSMETIC_CATEGORIES.map((category) => ({\n    id: category.id,\n    label: category.label,\n    description: category.description,\n    options: category.options.map((option) => ({\n      ...option,\n      category: category.id\n    }))\n  }));\n}\n\nensureSelectionsValid();\n\nexport {\n  getCosmeticSelections,\n  getResolvedCosmetics,\n  getCosmeticOption,\n  getCosmeticCategories,\n  setCosmeticSelection,\n  cycleCosmeticSelection,\n  resetCosmetics,\n  saveCosmetics,\n  loadCosmetics\n};\r\n","import {\n  getCosmeticCategories,\n  getCosmeticSelections,\n  getCosmeticOption,\n  cycleCosmeticSelection,\n  setCosmeticSelection,\n  resetCosmetics,\n  saveCosmetics,\n  loadCosmetics\n} from \"../../state/cosmetics.js\";\nimport { resetInputs } from \"../input/index.js\";\n\nconst MESSAGE_DURATION = 2.6;\n\nconst uiState = {\n  visible: false,\n  categoryIndex: 0,\n  optionIndex: 0,\n  message: null,\n  messageTimer: 0\n};\n\nlet initialized = false;\n\nfunction getCategories() {\n  return getCosmeticCategories();\n}\n\nfunction clampCategoryIndex(total) {\n  if (total <= 0) {\n    uiState.categoryIndex = 0;\n    uiState.optionIndex = 0;\n    return;\n  }\n  if (uiState.categoryIndex >= total) {\n    uiState.categoryIndex = total - 1;\n  }\n  if (uiState.categoryIndex < 0) {\n    uiState.categoryIndex = 0;\n  }\n}\n\nfunction syncOptionIndex(categories) {\n  const resolvedCategories = Array.isArray(categories) ? categories : getCategories();\n  clampCategoryIndex(resolvedCategories.length);\n  const activeCategory = resolvedCategories[uiState.categoryIndex];\n  const selections = getCosmeticSelections();\n  if (!activeCategory) {\n    uiState.optionIndex = 0;\n    return { categories: resolvedCategories, selections };\n  }\n  const options = Array.isArray(activeCategory.options) ? activeCategory.options : [];\n  if (options.length === 0) {\n    uiState.optionIndex = 0;\n    return { categories: resolvedCategories, selections };\n  }\n  const selectedId = selections[activeCategory.id];\n  const currentIndex = options.findIndex((option) => option.id === selectedId);\n  uiState.optionIndex = currentIndex >= 0 ? currentIndex : 0;\n  return { categories: resolvedCategories, selections };\n}\n\nfunction setMessage(message) {\n  uiState.message = message ?? null;\n  uiState.messageTimer = message ? MESSAGE_DURATION : 0;\n}\n\nfunction applySelection(categoryId, optionId) {\n  if (!categoryId || !optionId) {\n    return false;\n  }\n  const changed = setCosmeticSelection(categoryId, optionId);\n  if (changed) {\n    saveCosmetics();\n  }\n  return changed;\n}\n\nfunction openEditor() {\n  if (uiState.visible) {\n    return;\n  }\n  uiState.visible = true;\n  syncOptionIndex();\n  setMessage(null);\n  resetInputs();\n}\n\nfunction closeEditor() {\n  if (!uiState.visible) {\n    return;\n  }\n  uiState.visible = false;\n  resetInputs();\n  setMessage(null);\n}\n\nfunction moveCategory(delta) {\n  const categories = getCategories();\n  if (categories.length === 0) {\n    return;\n  }\n  uiState.categoryIndex = (uiState.categoryIndex + delta + categories.length) % categories.length;\n  syncOptionIndex(categories);\n  setMessage(null);\n}\n\nfunction cycleOption(delta) {\n  const categories = getCategories();\n  const activeCategory = categories[uiState.categoryIndex];\n  if (!activeCategory) {\n    return;\n  }\n  const result = cycleCosmeticSelection(activeCategory.id, delta);\n  if (!result) {\n    return;\n  }\n  syncOptionIndex(categories);\n  const option = getCosmeticOption(result.optionId);\n  if (result.changed && option) {\n    setMessage(`${activeCategory.label}: ${option.name}`);\n  }\n  saveCosmetics();\n}\n\nfunction handleReset() {\n  resetCosmetics();\n  saveCosmetics();\n  syncOptionIndex();\n  const categories = getCategories();\n  const activeCategory = categories[uiState.categoryIndex];\n  const selections = getCosmeticSelections();\n  const option = activeCategory ? getCosmeticOption(selections[activeCategory.id]) : null;\n  setMessage(option ? `${activeCategory.label} reset to ${option.name}` : \"Cosmetics reset\");\n}\n\nfunction handleKeyDown(event) {\n  if (event.defaultPrevented) {\n    return;\n  }\n  const code = event.code;\n  if (!uiState.visible) {\n    if (code === \"F7\") {\n      openEditor();\n      event.preventDefault();\n      event.stopPropagation();\n    }\n    return;\n  }\n\n  switch (code) {\n    case \"Escape\":\n    case \"Enter\":\n    case \"F7\":\n      closeEditor();\n      break;\n    case \"ArrowUp\":\n      moveCategory(-1);\n      break;\n    case \"ArrowDown\":\n      moveCategory(1);\n      break;\n    case \"Tab\":\n      moveCategory(event.shiftKey ? -1 : 1);\n      break;\n    case \"ArrowLeft\":\n      cycleOption(-1);\n      break;\n    case \"ArrowRight\":\n      cycleOption(1);\n      break;\n    case \"KeyR\":\n      handleReset();\n      break;\n    default:\n      return;\n  }\n  event.preventDefault();\n  event.stopPropagation();\n}\n\nfunction handlePointerEvent(event) {\n  if (!uiState.visible) {\n    return;\n  }\n  event.preventDefault();\n  event.stopPropagation();\n}\n\nfunction initializeCosmeticSystem() {\n  if (initialized) {\n    return;\n  }\n  loadCosmetics();\n  syncOptionIndex();\n  window.addEventListener(\"keydown\", handleKeyDown, true);\n  window.addEventListener(\"mousedown\", handlePointerEvent, true);\n  window.addEventListener(\"mouseup\", handlePointerEvent, true);\n  window.addEventListener(\"contextmenu\", handlePointerEvent, true);\n  initialized = true;\n}\n\nfunction updateCosmeticSystem(delta = 0) {\n  if (uiState.messageTimer > 0) {\n    uiState.messageTimer = Math.max(0, uiState.messageTimer - delta);\n    if (uiState.messageTimer === 0) {\n      uiState.message = null;\n    }\n  }\n}\n\nfunction isCosmeticEditorVisible() {\n  return uiState.visible;\n}\n\nfunction getCosmeticEditorState() {\n  const { categories } = syncOptionIndex();\n  const selections = getCosmeticSelections();\n  const activeCategory = categories[uiState.categoryIndex];\n  const options = Array.isArray(activeCategory?.options) ? activeCategory.options : [];\n  const resolvedOptions = options.map((option, index) => ({\n    ...option,\n    selected: selections[activeCategory?.id] === option.id,\n    index\n  }));\n  return {\n    visible: uiState.visible,\n    categoryIndex: uiState.categoryIndex,\n    optionIndex: uiState.optionIndex,\n    categories,\n    selections,\n    options: resolvedOptions,\n    activeCategory,\n    message: uiState.message,\n    messageTimer: uiState.messageTimer\n  };\n}\n\nexport {\n  initializeCosmeticSystem,\n  updateCosmeticSystem,\n  isCosmeticEditorVisible,\n  getCosmeticEditorState,\n  openEditor,\n  closeEditor,\n  applySelection\n};\r\n","import { ENVIRONMENT_DEFINITIONS, ENVIRONMENT_SEQUENCE } from \"../config/environments.js\";\n\nconst SCENARIO_STORAGE_KEY = \"stickman-warfare-scenarios.v1\";\n\nconst DEFAULT_SCENARIOS = [\n  {\n    id: \"urban-gauntlet\",\n    name: \"Urban Gauntlet\",\n    environmentId: ENVIRONMENT_SEQUENCE?.[0] ?? Object.keys(ENVIRONMENT_DEFINITIONS)[0],\n    description: \"Dual-lane rush with staggered reinforcements.\",\n    startingMaterials: 1800,\n    enemyCount: 6,\n    playerSpawnRatio: 0.42,\n    dummySpawnRatio: 0.78,\n    enemySpawnRatios: [0.16, 0.78]\n  },\n  {\n    id: \"verdant-encirclement\",\n    name: \"Verdant Encirclement\",\n    environmentId: ENVIRONMENT_SEQUENCE?.[1] ?? Object.keys(ENVIRONMENT_DEFINITIONS)[0],\n    description: \"Flank threats among elevated jungle walkways.\",\n    startingMaterials: 2200,\n    enemyCount: 8,\n    playerSpawnRatio: 0.48,\n    dummySpawnRatio: 0.72,\n    enemySpawnRatios: [0.24, 0.68]\n  },\n  {\n    id: \"spire-overwatch\",\n    name: \"Spire Overwatch\",\n    environmentId: ENVIRONMENT_SEQUENCE?.[3] ?? Object.keys(ENVIRONMENT_DEFINITIONS)[0],\n    description: \"Skylanes with vertical sightlines and tight AI patrols.\",\n    startingMaterials: 2600,\n    enemyCount: 10,\n    playerSpawnRatio: 0.5,\n    dummySpawnRatio: 0.82,\n    enemySpawnRatios: [0.3, 0.74]\n  }\n];\n\nfunction cloneScenario(scenario) {\n  return JSON.parse(JSON.stringify(scenario));\n}\n\nconst scenarioData = {\n  scenarios: DEFAULT_SCENARIOS.map(cloneScenario)\n};\n\nfunction validateEnvironmentId(environmentId) {\n  if (environmentId && ENVIRONMENT_DEFINITIONS[environmentId]) {\n    return environmentId;\n  }\n  return ENVIRONMENT_SEQUENCE?.[0] ?? Object.keys(ENVIRONMENT_DEFINITIONS)[0];\n}\n\nfunction normalizeRatio(value, fallback = 0.5) {\n  if (!Number.isFinite(value)) {\n    return fallback;\n  }\n  return Math.min(0.98, Math.max(0.02, value));\n}\n\nfunction normalizeScenario(data, fallback = DEFAULT_SCENARIOS[0]) {\n  const base = data && typeof data === \"object\" ? data : fallback;\n  return {\n    id: typeof base.id === \"string\" ? base.id : fallback.id,\n    name: typeof base.name === \"string\" ? base.name : fallback.name,\n    environmentId: validateEnvironmentId(base.environmentId ?? fallback.environmentId),\n    description: typeof base.description === \"string\" ? base.description : fallback.description,\n    startingMaterials: Number.isFinite(base.startingMaterials) ? Math.max(0, Math.round(base.startingMaterials)) : fallback.startingMaterials,\n    enemyCount: Number.isFinite(base.enemyCount) ? Math.max(0, Math.round(base.enemyCount)) : fallback.enemyCount,\n    playerSpawnRatio: normalizeRatio(base.playerSpawnRatio, fallback.playerSpawnRatio),\n    dummySpawnRatio: normalizeRatio(base.dummySpawnRatio, fallback.dummySpawnRatio),\n    enemySpawnRatios: Array.isArray(base.enemySpawnRatios) && base.enemySpawnRatios.length >= 2\n      ? [normalizeRatio(base.enemySpawnRatios[0], fallback.enemySpawnRatios[0]), normalizeRatio(base.enemySpawnRatios[1], fallback.enemySpawnRatios[1])]\n      : fallback.enemySpawnRatios.slice()\n  };\n}\n\nfunction loadScenarios() {\n  if (typeof localStorage === \"undefined\") {\n    return scenarioData.scenarios;\n  }\n  try {\n    const raw = localStorage.getItem(SCENARIO_STORAGE_KEY);\n    if (!raw) {\n      return scenarioData.scenarios;\n    }\n    const parsed = JSON.parse(raw);\n    if (!Array.isArray(parsed)) {\n      return scenarioData.scenarios;\n    }\n    const next = parsed.map((entry, index) => normalizeScenario(entry, DEFAULT_SCENARIOS[index % DEFAULT_SCENARIOS.length]));\n    scenarioData.scenarios = next;\n  } catch (error) {\n    console.warn(\"Failed to load scenarios\", error);\n    scenarioData.scenarios = DEFAULT_SCENARIOS.map(cloneScenario);\n  }\n  return scenarioData.scenarios;\n}\n\nfunction saveScenarios() {\n  if (typeof localStorage === \"undefined\") {\n    return false;\n  }\n  try {\n    localStorage.setItem(SCENARIO_STORAGE_KEY, JSON.stringify(scenarioData.scenarios));\n    return true;\n  } catch (error) {\n    console.warn(\"Failed to save scenarios\", error);\n    return false;\n  }\n}\n\nfunction getScenarioSlots() {\n  return scenarioData.scenarios.map(cloneScenario);\n}\n\nfunction getScenarioByIndex(index = 0) {\n  const scenarios = scenarioData.scenarios;\n  if (scenarios.length === 0) {\n    return null;\n  }\n  const normalizedIndex = ((index % scenarios.length) + scenarios.length) % scenarios.length;\n  return scenarios[normalizedIndex];\n}\n\nfunction ensureScenarioIndex(index) {\n  const scenarios = scenarioData.scenarios;\n  if (scenarios.length === 0) {\n    return 0;\n  }\n  return ((index % scenarios.length) + scenarios.length) % scenarios.length;\n}\n\nfunction setScenarioField(index, field, value) {\n  const slotIndex = ensureScenarioIndex(index);\n  const current = scenarioData.scenarios[slotIndex];\n  if (!current) {\n    return current;\n  }\n  const next = { ...current };\n  switch (field) {\n    case \"name\":\n      next.name = typeof value === \"string\" && value.trim().length > 0 ? value.trim() : current.name;\n      break;\n    case \"description\":\n      next.description = typeof value === \"string\" ? value.trim() : current.description;\n      break;\n    case \"environmentId\":\n      next.environmentId = validateEnvironmentId(value) ?? current.environmentId;\n      break;\n    case \"startingMaterials\":\n      next.startingMaterials = Math.max(0, Math.round(Number(value) || 0));\n      break;\n    case \"enemyCount\":\n      next.enemyCount = Math.max(0, Math.round(Number(value) || 0));\n      break;\n    case \"playerSpawnRatio\":\n      next.playerSpawnRatio = normalizeRatio(Number(value), current.playerSpawnRatio);\n      break;\n    case \"dummySpawnRatio\":\n      next.dummySpawnRatio = normalizeRatio(Number(value), current.dummySpawnRatio);\n      break;\n    case \"enemySpawnRatios\":\n      if (Array.isArray(value) && value.length >= 2) {\n        next.enemySpawnRatios = [normalizeRatio(value[0], current.enemySpawnRatios[0]), normalizeRatio(value[1], current.enemySpawnRatios[1])];\n      }\n      break;\n    default:\n      break;\n  }\n  scenarioData.scenarios[slotIndex] = next;\n  saveScenarios();\n  return next;\n}\n\nfunction adjustScenarioNumber(index, field, delta, step = 1) {\n  const slotIndex = ensureScenarioIndex(index);\n  const current = scenarioData.scenarios[slotIndex];\n  if (!current) {\n    return current;\n  }\n  switch (field) {\n    case \"startingMaterials\":\n      return setScenarioField(slotIndex, field, current.startingMaterials + delta * step);\n    case \"enemyCount\":\n      return setScenarioField(slotIndex, field, current.enemyCount + delta * step);\n    case \"playerSpawnRatio\":\n      return setScenarioField(slotIndex, field, current.playerSpawnRatio + delta * step);\n    case \"dummySpawnRatio\":\n      return setScenarioField(slotIndex, field, current.dummySpawnRatio + delta * step);\n    case \"enemySpawnLeft\":\n      return setScenarioField(slotIndex, \"enemySpawnRatios\", [current.enemySpawnRatios[0] + delta * step, current.enemySpawnRatios[1]]);\n    case \"enemySpawnRight\":\n      return setScenarioField(slotIndex, \"enemySpawnRatios\", [current.enemySpawnRatios[0], current.enemySpawnRatios[1] + delta * step]);\n    default:\n      return current;\n  }\n}\n\nfunction cycleScenarioEnvironment(index, direction = 1) {\n  const slotIndex = ensureScenarioIndex(index);\n  const current = scenarioData.scenarios[slotIndex];\n  if (!current) {\n    return current;\n  }\n  const sequence = Array.isArray(ENVIRONMENT_SEQUENCE) && ENVIRONMENT_SEQUENCE.length > 0\n    ? ENVIRONMENT_SEQUENCE\n    : Object.keys(ENVIRONMENT_DEFINITIONS);\n  const currentIndex = sequence.indexOf(current.environmentId);\n  const normalized = currentIndex >= 0 ? currentIndex : 0;\n  const nextIndex = (normalized + direction + sequence.length) % sequence.length;\n  return setScenarioField(slotIndex, \"environmentId\", sequence[nextIndex]);\n}\n\nfunction resetScenario(index) {\n  const slotIndex = ensureScenarioIndex(index);\n  const fallback = DEFAULT_SCENARIOS[slotIndex % DEFAULT_SCENARIOS.length] ?? DEFAULT_SCENARIOS[0];\n  scenarioData.scenarios[slotIndex] = cloneScenario(fallback);\n  saveScenarios();\n  return scenarioData.scenarios[slotIndex];\n}\n\nloadScenarios();\n\nexport {\n  getScenarioSlots,\n  getScenarioByIndex,\n  setScenarioField,\n  adjustScenarioNumber,\n  cycleScenarioEnvironment,\n  resetScenario,\n  saveScenarios\n};\r\n","import { getScenarioSlots, setScenarioField, adjustScenarioNumber, cycleScenarioEnvironment, resetScenario } from \"../../state/scenarios.js\";\nimport { ENVIRONMENT_DEFINITIONS, ENVIRONMENT_SEQUENCE } from \"../../config/environments.js\";\n\nconst MESSAGE_DURATION = 2.6;\n\nconst FIELDS = [\n  { id: \"scenarioSlot\", label: \"Scenario Slot\" },\n  { id: \"name\", label: \"Scenario Name\", editable: true },\n  { id: \"environmentId\", label: \"Environment\" },\n  { id: \"startingMaterials\", label: \"Starting Materials\", step: 250 },\n  { id: \"enemyCount\", label: \"Enemy Count\", step: 1 },\n  { id: \"playerSpawnRatio\", label: \"Player Spawn %\", step: 0.02 },\n  { id: \"dummySpawnRatio\", label: \"Dummy Spawn %\", step: 0.02 },\n  { id: \"enemySpawnLeft\", label: \"Enemy Left %\", step: 0.02 },\n  { id: \"enemySpawnRight\", label: \"Enemy Right %\", step: 0.02 },\n  { id: \"description\", label: \"Mission Brief\", editable: true }\n];\n\nconst uiState = {\n  visible: false,\n  fieldIndex: 0,\n  slotIndex: 0,\n  message: null,\n  messageTimer: 0\n};\n\nconst runtimeState = {\n  pendingApplication: null,\n  appliedScenarioId: null,\n  spawnOverride: null\n};\n\nlet initialized = false;\n\nfunction setMessage(message) {\n  uiState.message = message ?? null;\n  uiState.messageTimer = message ? MESSAGE_DURATION : 0;\n}\n\nfunction openEditor() {\n  if (uiState.visible) {\n    return;\n  }\n  uiState.visible = true;\n  setMessage(null);\n}\n\nfunction closeEditor() {\n  if (!uiState.visible) {\n    return;\n  }\n  uiState.visible = false;\n}\n\nfunction getEnvironmentLabel(environmentId) {\n  const def = environmentId ? ENVIRONMENT_DEFINITIONS[environmentId] : null;\n  return def?.name ?? environmentId ?? \"Unknown\";\n}\n\nfunction clampFieldIndex(index) {\n  const total = FIELDS.length;\n  if (total === 0) {\n    uiState.fieldIndex = 0;\n    return;\n  }\n  uiState.fieldIndex = ((index % total) + total) % total;\n}\n\nfunction cycleField(delta) {\n  clampFieldIndex(uiState.fieldIndex + delta);\n  setMessage(null);\n}\n\nfunction cycleSlot(delta) {\n  const scenarios = getScenarioSlots();\n  if (scenarios.length === 0) {\n    return;\n  }\n  const nextIndex = ((uiState.slotIndex + delta) % scenarios.length + scenarios.length) % scenarios.length;\n  if (uiState.slotIndex !== nextIndex) {\n    uiState.slotIndex = nextIndex;\n    setMessage(`Scenario ${nextIndex + 1}: ${scenarios[nextIndex].name}`);\n  }\n}\n\nfunction editFieldPrompt(fieldId) {\n  const scenarios = getScenarioSlots();\n  const scenario = scenarios[uiState.slotIndex];\n  if (!scenario) {\n    return;\n  }\n  if (fieldId === \"name\") {\n    const nextName = typeof window !== \"undefined\" ? window.prompt(\"Scenario name\", scenario.name) : null;\n    if (nextName && nextName.trim()) {\n      setScenarioField(uiState.slotIndex, \"name\", nextName.trim());\n      setMessage(`Renamed to ${nextName.trim()}`);\n    }\n  } else if (fieldId === \"description\") {\n    const nextDescription = typeof window !== \"undefined\" ? window.prompt(\"Mission brief\", scenario.description ?? \"\") : null;\n    if (nextDescription != null) {\n      setScenarioField(uiState.slotIndex, \"description\", nextDescription);\n      setMessage(\"Updated brief\");\n    }\n  }\n}\n\nfunction adjustField(direction) {\n  const field = FIELDS[uiState.fieldIndex];\n  if (!field) {\n    return;\n  }\n  const scenarios = getScenarioSlots();\n  const scenario = scenarios[uiState.slotIndex];\n  if (!scenario) {\n    return;\n  }\n  const step = field.step ?? 1;\n  switch (field.id) {\n    case \"scenarioSlot\":\n      cycleSlot(direction);\n      break;\n    case \"environmentId\": {\n      const next = cycleScenarioEnvironment(uiState.slotIndex, direction);\n      setMessage(`Environment: ${getEnvironmentLabel(next.environmentId)}`);\n      break;\n    }\n    case \"startingMaterials\": {\n      const next = adjustScenarioNumber(uiState.slotIndex, \"startingMaterials\", direction, step);\n      setMessage(`Materials: ${next.startingMaterials}`);\n      break;\n    }\n    case \"enemyCount\": {\n      const next = adjustScenarioNumber(uiState.slotIndex, \"enemyCount\", direction, step);\n      setMessage(`Enemies: ${next.enemyCount}`);\n      break;\n    }\n    case \"playerSpawnRatio\": {\n      const next = adjustScenarioNumber(uiState.slotIndex, \"playerSpawnRatio\", direction, step);\n      setMessage(`Player Spawn: ${(next.playerSpawnRatio * 100).toFixed(0)}%`);\n      break;\n    }\n    case \"dummySpawnRatio\": {\n      const next = adjustScenarioNumber(uiState.slotIndex, \"dummySpawnRatio\", direction, step);\n      setMessage(`Dummy Spawn: ${(next.dummySpawnRatio * 100).toFixed(0)}%`);\n      break;\n    }\n    case \"enemySpawnLeft\": {\n      const next = adjustScenarioNumber(uiState.slotIndex, \"enemySpawnLeft\", direction, step);\n      setMessage(`Left Spawn: ${(next.enemySpawnRatios[0] * 100).toFixed(0)}%`);\n      break;\n    }\n    case \"enemySpawnRight\": {\n      const next = adjustScenarioNumber(uiState.slotIndex, \"enemySpawnRight\", direction, step);\n      setMessage(`Right Spawn: ${(next.enemySpawnRatios[1] * 100).toFixed(0)}%`);\n      break;\n    }\n    default:\n      break;\n  }\n}\n\nfunction queueScenarioApply() {\n  const scenarios = getScenarioSlots();\n  const scenario = scenarios[uiState.slotIndex];\n  if (!scenario) {\n    setMessage(\"No scenario to apply\");\n    return;\n  }\n  runtimeState.pendingApplication = {\n    scenario,\n    slotIndex: uiState.slotIndex\n  };\n  setMessage(`Scenario armed: ${scenario.name}`);\n  closeEditor();\n}\n\nfunction handleReset() {\n  const reset = resetScenario(uiState.slotIndex);\n  setMessage(`Scenario reset: ${reset.name}`);\n}\n\nfunction handleKeyDown(event) {\n  if (event.defaultPrevented) {\n    return;\n  }\n  const code = event.code;\n  if (!uiState.visible) {\n    if (code === \"F8\") {\n      openEditor();\n      event.preventDefault();\n      event.stopPropagation();\n    }\n    return;\n  }\n\n  switch (code) {\n    case \"Escape\":\n    case \"F8\":\n      closeEditor();\n      break;\n    case \"ArrowUp\":\n      cycleField(-1);\n      break;\n    case \"ArrowDown\":\n      cycleField(1);\n      break;\n    case \"Tab\":\n      cycleField(event.shiftKey ? -1 : 1);\n      break;\n    case \"ArrowLeft\":\n      adjustField(-1);\n      break;\n    case \"ArrowRight\":\n      adjustField(1);\n      break;\n    case \"KeyE\": {\n      const field = FIELDS[uiState.fieldIndex];\n      if (field?.editable) {\n        editFieldPrompt(field.id);\n      }\n      break;\n    }\n    case \"KeyR\":\n      handleReset();\n      break;\n    case \"Enter\":\n      queueScenarioApply();\n      break;\n    default:\n      return;\n  }\n  event.preventDefault();\n  event.stopPropagation();\n}\n\nfunction handlePointerEvent(event) {\n  if (!uiState.visible) {\n    return;\n  }\n  event.preventDefault();\n  event.stopPropagation();\n}\n\nfunction initializeScenarioSystem() {\n  if (initialized || typeof window === \"undefined\") {\n    return;\n  }\n  window.addEventListener(\"keydown\", handleKeyDown, true);\n  window.addEventListener(\"mousedown\", handlePointerEvent, true);\n  window.addEventListener(\"mouseup\", handlePointerEvent, true);\n  window.addEventListener(\"contextmenu\", handlePointerEvent, true);\n  initialized = true;\n}\n\nfunction updateScenarioSystem(delta = 0) {\n  if (uiState.messageTimer > 0) {\n    uiState.messageTimer = Math.max(0, uiState.messageTimer - delta);\n    if (uiState.messageTimer === 0) {\n      uiState.message = null;\n    }\n  }\n}\n\nfunction isScenarioEditorVisible() {\n  return uiState.visible;\n}\n\nfunction getScenarioEditorState() {\n  const scenarios = getScenarioSlots();\n  const scenario = scenarios[uiState.slotIndex] ?? null;\n  return {\n    visible: uiState.visible,\n    slotIndex: uiState.slotIndex,\n    fieldIndex: uiState.fieldIndex,\n    fields: FIELDS,\n    scenario,\n    scenarios,\n    environmentName: scenario ? getEnvironmentLabel(scenario.environmentId) : \"--\",\n    message: uiState.message,\n    messageTimer: uiState.messageTimer\n  };\n}\n\nfunction consumeScenarioApplication() {\n  const pending = runtimeState.pendingApplication;\n  runtimeState.pendingApplication = null;\n  return pending;\n}\n\nfunction setScenarioRuntimeApplied({ scenarioId, spawnOverride }) {\n  runtimeState.appliedScenarioId = scenarioId ?? null;\n  runtimeState.spawnOverride = spawnOverride ?? null;\n}\n\nfunction getScenarioSpawnOverride() {\n  return runtimeState.spawnOverride;\n}\n\nexport {\n  initializeScenarioSystem,\n  updateScenarioSystem,\n  isScenarioEditorVisible,\n  getScenarioEditorState,\n  consumeScenarioApplication,\n  setScenarioRuntimeApplied,\n  getScenarioSpawnOverride\n};\r\n","const SOUND_DEFINITIONS = {\n  shot: { generator: createShotBuffer, playbackRate: [0.94, 1.08], gain: 0.9, pan: 0.35 },\n  muzzle: { generator: createMuzzleBuffer, playbackRate: [1, 1.12], gain: 0.4, pan: 0.2 },\n  reloadStart: { generator: createReloadStartBuffer, playbackRate: [1, 1], gain: 0.45 },\n  reloadFinish: { generator: createReloadFinishBuffer, playbackRate: [1, 1], gain: 0.5 },\n  recoil: { generator: createRecoilBuffer, playbackRate: [0.92, 1.05], gain: 0.35 },\n  grenadeThrow: { generator: createThrowBuffer, playbackRate: [0.95, 1.05], gain: 0.3, pan: 0.25 },\n  explosion: { generator: createExplosionBuffer, playbackRate: [0.9, 1.02], gain: 1.1 },\n  flash: { generator: createFlashBuffer, playbackRate: [0.98, 1.05], gain: 0.7 },\n  smokePulse: { generator: createSmokeBuffer, playbackRate: [0.9, 1.03], gain: 0.45 },\n  shieldHit: { generator: createShieldHitBuffer, playbackRate: [0.95, 1.05], gain: 0.8 },\n  shieldShatter: { generator: createShieldShatterBuffer, playbackRate: [0.95, 1.02], gain: 1 },\n  shieldEnd: { generator: createShieldEndBuffer, playbackRate: [0.9, 1.02], gain: 0.5 },\n  debris: { generator: createDebrisBuffer, playbackRate: [0.92, 1.05], gain: 0.6, pan: 0.3 },\n  environmentChime: { generator: createChimeBuffer, playbackRate: [0.98, 1.04], gain: 0.4 }\n};\n\nconst EVENT_SOUND_MAP = {\n  \"weapon:shot-fired\": { sound: \"shot\", cooldown: 24, intensity: 0.06 },\n  \"weapon:muzzle-flash\": { sound: \"muzzle\", cooldown: 18, intensity: 0.01 },\n  \"weapon:reload-start\": { sound: \"reloadStart\", cooldown: 140 },\n  \"weapon:reload-finish\": { sound: \"reloadFinish\", cooldown: 140, intensity: 0.02 },\n  \"weapon:recoil-kick\": { sound: \"recoil\", cooldown: 32, intensity: 0.02 },\n  \"throwable:thrown\": { sound: \"grenadeThrow\", cooldown: 90 },\n  \"throwable:explosion\": { sound: \"explosion\", cooldown: 120, intensity: 0.09 },\n  \"throwable:flash-burst\": { sound: \"flash\", cooldown: 140, intensity: 0.08 },\n  \"throwable:smoke-detonate\": { sound: \"smokePulse\", cooldown: 220, intensity: 0.02 },\n  \"throwable:smoke-dissipate\": { sound: \"smokePulse\", cooldown: 260 },\n  \"shield:hit\": { sound: \"shieldHit\", cooldown: 45, intensity: 0.03 },\n  \"shield:shatter\": { sound: \"shieldShatter\", cooldown: 260, intensity: 0.08 },\n  \"shield:end\": { sound: \"shieldEnd\", cooldown: 200 },\n  \"destructible:hit\": { sound: \"debris\", cooldown: 26 },\n  \"destructible:explosion\": { sound: \"explosion\", cooldown: 160, intensity: 0.08 },\n  \"environment:changed\": { sound: \"environmentChime\", cooldown: 600, intensity: 0.05 }\n};\n\nlet audioContext = null;\nlet masterGain = null;\nlet sfxGain = null;\nlet musicGain = null;\nlet initialized = false;\nlet soundtrackStarted = false;\nlet intensityTimer = null;\nlet targetMusicLevel = 0.28;\nlet currentMusicLevel = 0;\nconst soundBuffers = new Map();\nconst lastEventTimes = new Map();\nconst soundtrackSources = [];\n\nfunction initializeAudioSystem() {\n  if (initialized || typeof window === \"undefined\") {\n    return;\n  }\n  initialized = true;\n  ensureContext();\n  if (!audioContext) {\n    return;\n  }\n  buildGainGraph();\n  loadSoundBuffers();\n  registerEventListeners();\n  scheduleIntensityLoop();\n  setupPrimeHandlers();\n}\n\nfunction ensureContext() {\n  if (audioContext || typeof window === \"undefined\") {\n    return;\n  }\n  const AudioCtor = window.AudioContext || window.webkitAudioContext;\n  if (!AudioCtor) {\n    return;\n  }\n  audioContext = new AudioCtor();\n}\n\nfunction buildGainGraph() {\n  if (!audioContext) {\n    return;\n  }\n  masterGain = audioContext.createGain();\n  masterGain.gain.value = 0.9;\n  sfxGain = audioContext.createGain();\n  sfxGain.gain.value = 0.95;\n  musicGain = audioContext.createGain();\n  musicGain.gain.value = 0;\n  sfxGain.connect(masterGain);\n  musicGain.connect(masterGain);\n  masterGain.connect(audioContext.destination);\n}\n\nfunction loadSoundBuffers() {\n  if (!audioContext) {\n    return;\n  }\n  soundBuffers.clear();\n  for (const [key, definition] of Object.entries(SOUND_DEFINITIONS)) {\n    try {\n      const buffer = definition.generator(audioContext);\n      soundBuffers.set(key, buffer);\n    } catch (error) {\n      console.warn(`Failed to generate sound buffer for ${key}`, error);\n    }\n  }\n}\n\nfunction registerEventListeners() {\n  if (typeof window === \"undefined\") {\n    return;\n  }\n  for (const eventName of Object.keys(EVENT_SOUND_MAP)) {\n    window.addEventListener(eventName, (event) => {\n      handleEventSound(eventName, event?.detail ?? {});\n    });\n  }\n}\n\nfunction scheduleIntensityLoop() {\n  if (typeof window === \"undefined\") {\n    return;\n  }\n  if (intensityTimer) {\n    window.clearInterval(intensityTimer);\n  }\n  intensityTimer = window.setInterval(() => {\n    if (!audioContext || !musicGain) {\n      return;\n    }\n    targetMusicLevel = Math.max(0.18, targetMusicLevel - 0.015);\n    currentMusicLevel += (targetMusicLevel - currentMusicLevel) * 0.2;\n    const clamped = clampVolume(currentMusicLevel);\n    musicGain.gain.cancelScheduledValues(audioContext.currentTime);\n    musicGain.gain.linearRampToValueAtTime(clamped, audioContext.currentTime + 0.12);\n  }, 220);\n}\n\nfunction setupPrimeHandlers() {\n  if (typeof window === \"undefined\") {\n    return;\n  }\n  const prime = () => {\n    resumeContext();\n    startSoundtrack();\n    window.removeEventListener(\"pointerdown\", prime);\n    window.removeEventListener(\"keydown\", prime);\n  };\n  window.addEventListener(\"pointerdown\", prime);\n  window.addEventListener(\"keydown\", prime);\n}\n\nfunction handleEventSound(eventName, detail) {\n  const config = EVENT_SOUND_MAP[eventName];\n  if (!config || !audioContext) {\n    return;\n  }\n  if (!shouldPlay(eventName, config.cooldown ?? 0)) {\n    return;\n  }\n  resumeContext();\n  playSound(config.sound, config);\n  if (config.intensity) {\n    bumpMusicIntensity(config.intensity);\n  }\n}\n\nfunction shouldPlay(key, cooldownMs) {\n  if (cooldownMs <= 0) {\n    return true;\n  }\n  const now = performance.now();\n  const last = lastEventTimes.get(key) ?? 0;\n  if (now - last < cooldownMs) {\n    return false;\n  }\n  lastEventTimes.set(key, now);\n  return true;\n}\n\nfunction playSound(soundId, config = {}) {\n  if (!audioContext || !sfxGain) {\n    return;\n  }\n  const buffer = soundBuffers.get(soundId);\n  if (!buffer) {\n    return;\n  }\n  const source = audioContext.createBufferSource();\n  source.buffer = buffer;\n  const rateRange = config.playbackRate ?? SOUND_DEFINITIONS[soundId]?.playbackRate ?? [1, 1];\n  source.playbackRate.value = randomBetween(rateRange[0], rateRange[1]);\n  const gainNode = audioContext.createGain();\n  const baseGain = config.gain ?? SOUND_DEFINITIONS[soundId]?.gain ?? 1;\n  gainNode.gain.value = clampVolume(baseGain);\n  let destination = gainNode;\n  const panRange = SOUND_DEFINITIONS[soundId]?.pan;\n  if (typeof panRange === \"number\" && audioContext.createStereoPanner) {\n    const panner = audioContext.createStereoPanner();\n    panner.pan.value = randomBetween(-panRange, panRange);\n    gainNode.connect(panner);\n    destination = panner;\n  }\n  destination.connect(sfxGain);\n  source.connect(gainNode);\n  source.start();\n}\n\nfunction startSoundtrack() {\n  if (soundtrackStarted || !audioContext || !musicGain) {\n    return;\n  }\n  soundtrackStarted = true;\n  const padSource = createLoopingSource(createPadBuffer(audioContext));\n  const pulseSource = createLoopingSource(createPulseBuffer(audioContext));\n  const bassSource = createLoopingSource(createBassBuffer(audioContext));\n  const activeSources = [padSource, pulseSource, bassSource].filter(Boolean);\n  soundtrackSources.push(...activeSources);\n  targetMusicLevel = 0.32;\n  currentMusicLevel = 0;\n}\n\nfunction createLoopingSource(buffer) {\n  if (!buffer || !audioContext || !musicGain) {\n    return null;\n  }\n  const source = audioContext.createBufferSource();\n  source.buffer = buffer;\n  source.loop = true;\n  const gain = audioContext.createGain();\n  if (buffer.duration >= 6) {\n    gain.gain.value = 0.55;\n  } else if (buffer.duration >= 3) {\n    gain.gain.value = 0.4;\n  } else {\n    gain.gain.value = 0.25;\n  }\n  source.connect(gain).connect(musicGain);\n  const startTime = audioContext.currentTime + 0.05;\n  source.start(startTime);\n  return source;\n}\n\nfunction bumpMusicIntensity(amount = 0.05) {\n  targetMusicLevel = Math.min(0.85, targetMusicLevel + amount);\n  startSoundtrack();\n}\n\nfunction resumeContext() {\n  if (!audioContext) {\n    return;\n  }\n  if (audioContext.state === \"suspended\" && typeof audioContext.resume === \"function\") {\n    audioContext.resume().catch(() => {});\n  }\n}\n\nfunction setMasterVolume(value) {\n  if (masterGain) {\n    masterGain.gain.value = clampVolume(value);\n  }\n}\n\nfunction setSfxVolume(value) {\n  if (sfxGain) {\n    sfxGain.gain.value = clampVolume(value);\n  }\n}\n\nfunction setMusicVolume(value) {\n  targetMusicLevel = clampVolume(value);\n  startSoundtrack();\n}\n\nfunction getAudioState() {\n  return {\n    supported: Boolean(audioContext),\n    contextState: audioContext?.state ?? \"unavailable\",\n    soundtrackActive: soundtrackStarted,\n    volumes: {\n      master: masterGain?.gain?.value ?? 0,\n      sfx: sfxGain?.gain?.value ?? 0,\n      music: musicGain?.gain?.value ?? 0\n    },\n    intensity: currentMusicLevel\n  };\n}\n\nfunction clampVolume(value) {\n  return Math.max(0, Math.min(1, Number.isFinite(value) ? value : 0));\n}\n\nfunction randomBetween(min, max) {\n  return min + Math.random() * (max - min);\n}\n\nfunction createShotBuffer(ctx) {\n  const duration = 0.32;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const envelope = Math.exp(-t * 13.5);\n    const body = Math.sin(2 * Math.PI * (680 + 40 * Math.sin(t * 110)) * t) * 0.55;\n    const click = Math.sin(2 * Math.PI * 1320 * t) * Math.exp(-t * 25) * 0.2;\n    const noise = (Math.random() * 2 - 1) * 0.45;\n    data[i] = (body + click + noise) * envelope;\n  }\n  return buffer;\n}\n\nfunction createMuzzleBuffer(ctx) {\n  const duration = 0.12;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const envelope = Math.exp(-t * 32);\n    const spark = Math.sin(2 * Math.PI * (1400 + 120 * Math.sin(t * 60)) * t) * 0.5;\n    const fizz = (Math.random() * 2 - 1) * 0.25;\n    data[i] = (spark + fizz) * envelope;\n  }\n  return buffer;\n}\n\nfunction createReloadStartBuffer(ctx) {\n  const duration = 0.24;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const tone = Math.sin(2 * Math.PI * 220 * t) * Math.exp(-t * 6);\n    const partial = Math.sin(2 * Math.PI * 440 * t) * Math.exp(-t * 8) * 0.3;\n    data[i] = (tone + partial) * 0.6;\n  }\n  return buffer;\n}\n\nfunction createReloadFinishBuffer(ctx) {\n  const duration = 0.22;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const tone = Math.sin(2 * Math.PI * 360 * t) * Math.exp(-t * 7);\n    const overtone = Math.sin(2 * Math.PI * 720 * t) * Math.exp(-t * 9) * 0.4;\n    data[i] = (tone + overtone) * 0.6;\n  }\n  return buffer;\n}\n\nfunction createRecoilBuffer(ctx) {\n  const duration = 0.28;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const thump = Math.sin(2 * Math.PI * 110 * t) * Math.exp(-t * 9);\n    const noise = (Math.random() * 2 - 1) * Math.exp(-t * 18) * 0.35;\n    data[i] = (thump + noise) * 0.7;\n  }\n  return buffer;\n}\n\nfunction createThrowBuffer(ctx) {\n  const duration = 0.3;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const swish = Math.sin(2 * Math.PI * (180 + 120 * t) * t) * Math.exp(-t * 6);\n    const noise = (Math.random() * 2 - 1) * Math.exp(-t * 10) * 0.25;\n    data[i] = (swish + noise) * 0.65;\n  }\n  return buffer;\n}\n\nfunction createExplosionBuffer(ctx) {\n  const duration = 0.9;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const envelope = Math.exp(-t * 4.5);\n    const boom = Math.sin(2 * Math.PI * (80 + 20 * Math.sin(t * 6)) * t) * Math.exp(-t * 2.2) * 0.6;\n    const roar = (Math.random() * 2 - 1) * Math.exp(-t * 3.5) * 0.5;\n    data[i] = (boom + roar) * envelope;\n  }\n  return buffer;\n}\n\nfunction createFlashBuffer(ctx) {\n  const duration = 0.35;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const envelope = Math.exp(-t * 18);\n    const tone = Math.sin(2 * Math.PI * (880 + 140 * t) * t) * 0.5;\n    const shimmer = Math.sin(2 * Math.PI * 1760 * t) * Math.exp(-t * 20) * 0.3;\n    data[i] = (tone + shimmer) * envelope;\n  }\n  return buffer;\n}\n\nfunction createSmokeBuffer(ctx) {\n  const duration = 0.7;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const envelope = Math.exp(-t * 3);\n    const noise = (Math.random() * 2 - 1) * 0.25;\n    const wave = Math.sin(2 * Math.PI * 90 * t) * Math.exp(-t * 4) * 0.3;\n    data[i] = (noise + wave) * envelope;\n  }\n  return buffer;\n}\n\nfunction createShieldHitBuffer(ctx) {\n  const duration = 0.4;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const shimmer = Math.sin(2 * Math.PI * (520 + 80 * Math.sin(t * 45)) * t) * Math.exp(-t * 8) * 0.6;\n    const noise = (Math.random() * 2 - 1) * Math.exp(-t * 10) * 0.2;\n    data[i] = shimmer + noise;\n  }\n  return buffer;\n}\n\nfunction createShieldShatterBuffer(ctx) {\n  const duration = 0.75;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const envelope = Math.exp(-t * 3.5);\n    const crystal = Math.sin(2 * Math.PI * (420 + 220 * Math.sin(t * 6)) * t) * 0.6;\n    const sparkle = Math.sin(2 * Math.PI * (980 + 260 * Math.sin(t * 12)) * t) * 0.4;\n    const shards = (Math.random() * 2 - 1) * 0.3;\n    data[i] = (crystal + sparkle + shards) * envelope;\n  }\n  return buffer;\n}\n\nfunction createShieldEndBuffer(ctx) {\n  const duration = 0.5;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const tone = Math.sin(2 * Math.PI * (320 - 90 * t) * t) * Math.exp(-t * 5);\n    data[i] = tone * 0.6;\n  }\n  return buffer;\n}\n\nfunction createDebrisBuffer(ctx) {\n  const duration = 0.32;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const fizz = (Math.random() * 2 - 1) * Math.exp(-t * 14) * 0.35;\n    const clink = Math.sin(2 * Math.PI * 640 * t) * Math.exp(-t * 18) * 0.2;\n    data[i] = fizz + clink;\n  }\n  return buffer;\n}\n\nfunction createChimeBuffer(ctx) {\n  const duration = 0.6;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const base = Math.sin(2 * Math.PI * 420 * t) * Math.exp(-t * 3.6) * 0.5;\n    const harmonic = Math.sin(2 * Math.PI * 630 * t) * Math.exp(-t * 4.2) * 0.3;\n    const sparkle = Math.sin(2 * Math.PI * 1260 * t) * Math.exp(-t * 8.5) * 0.2;\n    data[i] = base + harmonic + sparkle;\n  }\n  return buffer;\n}\n\nfunction createPadBuffer(ctx) {\n  const duration = 8;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(2, length, ctx.sampleRate);\n  for (let channel = 0; channel < 2; channel += 1) {\n    const data = buffer.getChannelData(channel);\n    const baseFreq = channel === 0 ? 220 : 330;\n    for (let i = 0; i < length; i += 1) {\n      const t = i / ctx.sampleRate;\n      const envelope = 0.4 + 0.4 * Math.sin(t * Math.PI * 0.25);\n      const wobble = Math.sin(2 * Math.PI * (baseFreq + 6 * Math.sin(t * 2)) * t);\n      const airy = (Math.random() * 2 - 1) * 0.05;\n      data[i] = (wobble * 0.6 + airy) * envelope;\n    }\n  }\n  return buffer;\n}\n\nfunction createPulseBuffer(ctx) {\n  const duration = 4;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const phase = t % 0.5;\n    const envelope = phase < 0.08 ? Math.exp(-phase * 80) : 0;\n    const hit = Math.sin(2 * Math.PI * 180 * phase) * envelope;\n    data[i] = hit * 0.8;\n  }\n  return buffer;\n}\n\nfunction createBassBuffer(ctx) {\n  const duration = 6;\n  const length = Math.floor(ctx.sampleRate * duration);\n  const buffer = ctx.createBuffer(1, length, ctx.sampleRate);\n  const data = buffer.getChannelData(0);\n  for (let i = 0; i < length; i += 1) {\n    const t = i / ctx.sampleRate;\n    const note = Math.sin(2 * Math.PI * 110 * t) * 0.4;\n    const sub = Math.sin(2 * Math.PI * 55 * t) * 0.2;\n    data[i] = (note + sub) * (0.5 + 0.5 * Math.sin(t * Math.PI * 0.5));\n  }\n  return buffer;\n}\n\nexport { initializeAudioSystem, setMasterVolume, setSfxVolume, setMusicVolume, getAudioState, bumpMusicIntensity };\r\n\r\n\r\n\r\n\r\n\r\n\r\n","\r\nfunction getP2P() {\r\n  if (typeof window === \"undefined\" || !window.P2P) {\r\n    const error = new Error(\"P2P module not loaded\");\r\n    error.code = \"P2P_NOT_AVAILABLE\";\r\n    throw error;\r\n  }\r\n  return window.P2P;\r\n}\r\nimport { GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { stickman, remotePlayers, upsertRemotePlayer, pruneRemotePlayers, getTotalHeight } from \"../../state/entities.js\";\r\n\r\nconst peerId = `peer-${Math.random().toString(36).slice(2, 8)}`;\r\nlet peerConnection = null;\r\nlet outboundChannel = null;\r\nlet inboundChannel = null;\r\nlet lastSendTime = 0;\r\nlet connectionStatus = \"disconnected\";\r\nlet localDescriptionString = null;\r\nconst localCandidates = [];\r\n\r\nfunction ensurePeerConnection() {\r\n  if (peerConnection || typeof window === \"undefined\" || !window.RTCPeerConnection) {\r\n    return peerConnection;\r\n  }\r\n  peerConnection = new RTCPeerConnection({ iceServers: [] });\r\n  connectionStatus = \"connecting\";\r\n\r\n  outboundChannel = peerConnection.createDataChannel(\"stickman\", { ordered: true });\r\n  setupDataChannel(outboundChannel);\r\n\r\n  peerConnection.addEventListener(\"icecandidate\", (event) => {\r\n    if (event.candidate) {\r\n      localCandidates.push(JSON.stringify(event.candidate));\r\n    }\r\n  });\r\n\r\n  peerConnection.addEventListener(\"connectionstatechange\", () => {\r\n    connectionStatus = peerConnection.connectionState ?? \"unknown\";\r\n  });\r\n\r\n  peerConnection.addEventListener(\"datachannel\", (event) => {\r\n    inboundChannel = event.channel;\r\n    setupDataChannel(inboundChannel);\r\n  });\r\n\r\n  return peerConnection;\r\n}\r\n\r\nfunction setupDataChannel(channel) {\r\n  if (!channel) {\r\n    return;\r\n  }\r\n  channel.addEventListener(\"open\", () => {\r\n    connectionStatus = \"connected\";\r\n  });\r\n  channel.addEventListener(\"close\", () => {\r\n    connectionStatus = \"disconnected\";\r\n  });\r\n  channel.addEventListener(\"message\", (event) => {\r\n    try {\r\n      const payload = JSON.parse(event.data);\r\n      handleIncomingMessage(payload);\r\n    } catch (error) {\r\n      console.warn(\"Failed to parse P2P payload\", error);\r\n    }\r\n  });\r\n}\r\n\r\nfunction handleIncomingMessage(payload) {\r\n  if (!payload || typeof payload !== \"object\") {\r\n    return;\r\n  }\r\n  switch (payload.type) {\r\n    case \"playerState\":\r\n      upsertRemotePlayer({\r\n        id: payload.id,\r\n        name: payload.name,\r\n        x: payload.x,\r\n        y: payload.y,\r\n        facing: payload.facing,\r\n        commandId: payload.commandId\r\n      });\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n}\r\n\r\nasync function createOffer() {\r\n  ensurePeerConnection();\r\n  const offer = await peerConnection.createOffer();\r\n  await peerConnection.setLocalDescription(offer);\r\n  localDescriptionString = JSON.stringify(offer);\r\n  return localDescriptionString;\r\n}\r\n\r\nasync function createAnswer(remoteDescriptionString) {\r\n  ensurePeerConnection();\r\n  const description = JSON.parse(remoteDescriptionString);\r\n  await peerConnection.setRemoteDescription(new RTCSessionDescription(description));\r\n  const answer = await peerConnection.createAnswer();\r\n  await peerConnection.setLocalDescription(answer);\r\n  localDescriptionString = JSON.stringify(answer);\r\n  return localDescriptionString;\r\n}\r\n\r\nasync function acceptRemoteDescription(remoteDescriptionString) {\r\n  ensurePeerConnection();\r\n  const description = JSON.parse(remoteDescriptionString);\r\n  await peerConnection.setRemoteDescription(new RTCSessionDescription(description));\r\n}\r\n\r\nasync function addRemoteCandidate(candidateString) {\r\n  if (!candidateString) {\r\n    return;\r\n  }\r\n  ensurePeerConnection();\r\n  const candidate = new RTCIceCandidate(JSON.parse(candidateString));\r\n  await peerConnection.addIceCandidate(candidate);\r\n}\r\n\r\nfunction getLocalDescription() {\r\n  return localDescriptionString;\r\n}\r\n\r\nfunction getLocalCandidates() {\r\n  return [...localCandidates];\r\n}\r\n\r\nfunction getConnectionStatus() {\r\n  return connectionStatus;\r\n}\r\n\r\nfunction updateP2P(delta) {\r\n  pruneRemotePlayers();\r\n  ensurePeerConnection();\r\n  if (!outboundChannel || outboundChannel.readyState !== \"open\") {\r\n    return;\r\n  }\r\n  const now = (typeof performance !== \"undefined\" ? performance.now() : Date.now());\r\n  if (now - lastSendTime < 60) {\r\n    return;\r\n  }\r\n  lastSendTime = now;\r\n  const payload = {\r\n    type: \"playerState\",\r\n    id: peerId,\r\n    name: \"Remote\",\r\n    x: stickman.x,\r\n    y: stickman.y,\r\n    facing: stickman.facing,\r\n    commandId: stickman.squadCommandId\r\n  };\r\n  try {\r\n    outboundChannel.send(JSON.stringify(payload));\r\n  } catch {\r\n    // ignore send errors\r\n  }\r\n}\r\n\r\nfunction initializeP2PNetworking() {\r\n  ensurePeerConnection();\r\n  if (typeof window !== \"undefined\") {\r\n    window.P2P = {\r\n      createOffer,\r\n      createAnswer,\r\n      acceptRemoteDescription,\r\n      addRemoteCandidate,\r\n      getLocalDescription,\r\n      getLocalCandidates,\r\n      getStatus: getP2PStatus,\r\n      close: closeConnection\r\n    };\r\n  }\r\n}\r\n\r\nfunction closeConnection() {\r\n  if (outboundChannel) {\r\n    outboundChannel.close();\r\n    outboundChannel = null;\r\n  }\r\n  if (inboundChannel) {\r\n    inboundChannel.close();\r\n    inboundChannel = null;\r\n  }\r\n  if (peerConnection) {\r\n    peerConnection.close();\r\n    peerConnection = null;\r\n  }\r\n  connectionStatus = \"disconnected\";\r\n}\r\n\r\nfunction getP2PStatus() {\r\n  return {\r\n    id: peerId,\r\n    status: connectionStatus,\r\n    localDescription: localDescriptionString,\r\n    localCandidates: [...localCandidates]\r\n  };\r\n}\r\n\r\nfunction getRemotePlayersList() {\r\n  return Array.from(remotePlayers.values());\r\n}\r\n\r\nexport { initializeP2PNetworking, updateP2P, getP2PStatus, getRemotePlayersList, getP2P };\r\n","const NETWORK_CONFIG = {\n  serverApiBase: \"https://projectstickfightinggame.onrender.com\",\n  refreshIntervalMs: 15000,\n  heartbeatIntervalMs: 45000,\n  hostTtlSeconds: 150,\n  hostSecret: \"sk-stickman-host-123456789987654321\", // set this to match SERVER_SECRET on Render\n  hostName: \"ProjectStickFightingGame Lobby\",\n  defaultRegion: \"na-west\"\n};\n\nexport { NETWORK_CONFIG };\n","import { NETWORK_CONFIG } from \"../config/network.js\";\r\n\r\nconst serverBrowserState = {\r\n  servers: [],\r\n  visible: false,\r\n  selectedIndex: 0,\r\n  lastFetch: 0,\r\n  fetching: false,\r\n  error: null,\r\n  statusMessage: null,\r\n  hosting: false,\r\n  hostingSessionId: null,\r\n  hostingLastHeartbeat: 0,\r\n  hostingExpiresAt: 0,\r\n  joinStatus: null,\r\n  joinError: null,\r\n  hostingMetrics: {\r\n    playerCount: 1,\r\n    enemyCount: 0,\r\n    alliesCount: 0\r\n  },\r\n  p2p: {\r\n    offer: null,\r\n    answer: null,\r\n    pendingOffer: false,\r\n    pendingAnswer: false,\r\n    pendingCandidates: false,\r\n    localCandidates: [],\r\n    remoteCandidates: [],\r\n    error: null\r\n  }\r\n};\r\n\r\nfunction getServerBrowserState() {\r\n  return serverBrowserState;\r\n}\r\n\r\nfunction setVisible(visible) {\r\n  serverBrowserState.visible = visible;\r\n  if (!visible) {\r\n    serverBrowserState.statusMessage = null;\r\n    serverBrowserState.error = null;\r\n  }\r\n}\r\n\r\nfunction toggleVisible() {\r\n  setVisible(!serverBrowserState.visible);\r\n}\r\n\r\nfunction setServers(list) {\r\n  const previousSelection = serverBrowserState.servers[serverBrowserState.selectedIndex]?.id;\r\n  serverBrowserState.servers = Array.isArray(list) ? list : [];\r\n  if (previousSelection) {\r\n    const matchedIndex = serverBrowserState.servers.findIndex((server) => server.id === previousSelection);\r\n    if (matchedIndex >= 0) {\r\n      serverBrowserState.selectedIndex = matchedIndex;\r\n    }\r\n  }\r\n  if (serverBrowserState.selectedIndex >= serverBrowserState.servers.length) {\r\n    serverBrowserState.selectedIndex = Math.max(0, serverBrowserState.servers.length - 1);\r\n  }\r\n}\r\n\r\nfunction setError(message) {\r\n  serverBrowserState.error = message;\r\n}\r\n\r\nfunction setStatusMessage(message) {\r\n  serverBrowserState.statusMessage = message;\r\n}\r\n\r\nfunction setJoinStatus(message) {\r\n  serverBrowserState.joinStatus = message;\r\n}\r\n\r\nfunction setJoinError(message) {\r\n  serverBrowserState.joinError = message;\r\n}\r\n\r\nfunction setJoinedSessionId(id) {\r\n  serverBrowserState.joinedSessionId = id ?? null;\r\n}\r\n\r\nfunction selectNext(delta) {\r\n  if (serverBrowserState.servers.length === 0) {\r\n    return;\r\n  }\r\n  serverBrowserState.selectedIndex = (serverBrowserState.selectedIndex + delta + serverBrowserState.servers.length) % serverBrowserState.servers.length;\r\n}\r\n\r\nfunction recordFetchTimestamp(timestamp) {\r\n  serverBrowserState.lastFetch = timestamp;\r\n}\r\n\r\nfunction setFetching(fetching) {\r\n  serverBrowserState.fetching = fetching;\r\n}\r\n\r\nfunction setHostingSession({ id, expiresAt }) {\r\n  serverBrowserState.hosting = Boolean(id);\r\n  serverBrowserState.hostingSessionId = id ?? null;\r\n  serverBrowserState.hostingLastHeartbeat = performance.now();\r\n  serverBrowserState.hostingExpiresAt = expiresAt ?? 0;\r\n}\r\n\r\nfunction updateHostingHeartbeatTimestamp(timestamp) {\r\n  serverBrowserState.hostingLastHeartbeat = timestamp;\r\n}\r\n \r\nfunction clearHosting() {\r\n  serverBrowserState.hosting = false;\r\n  serverBrowserState.hostingSessionId = null;\r\n  serverBrowserState.hostingExpiresAt = 0;\r\n  serverBrowserState.hostingLastHeartbeat = 0;\r\n  clearP2PState();\r\n}\r\nfunction setHostingMetrics(metrics = {}) {\r\n  if (Number.isFinite(metrics.playerCount)) {\r\n    serverBrowserState.hostingMetrics.playerCount = Math.max(1, Math.round(metrics.playerCount));\r\n  }\r\n  if (Number.isFinite(metrics.enemyCount)) {\r\n    serverBrowserState.hostingMetrics.enemyCount = Math.max(0, Math.round(metrics.enemyCount));\r\n  }\r\n  if (Number.isFinite(metrics.alliesCount)) {\r\n    serverBrowserState.hostingMetrics.alliesCount = Math.max(0, Math.round(metrics.alliesCount));\r\n  }\r\n}\r\n\r\nfunction setP2POffer(offer) {\r\n  serverBrowserState.p2p.offer = offer ?? null;\r\n}\r\n\r\nfunction setP2PAnswer(answer) {\r\n  serverBrowserState.p2p.answer = answer ?? null;\r\n}\r\n\r\nfunction setP2PLocalCandidates(candidates) {\r\n  if (!Array.isArray(candidates)) {\r\n    candidates = [];\r\n  }\r\n  const next = candidates.slice();\r\n  const current = serverBrowserState.p2p.localCandidates || [];\r\n  if (current.length === next.length && current.every((value, index) => value === next[index])) {\r\n    return;\r\n  }\r\n  serverBrowserState.p2p.localCandidates = next;\r\n}\r\n \r\nfunction setP2PRemoteCandidates(candidates) {\r\n  if (!Array.isArray(candidates)) {\r\n    candidates = [];\r\n  }\r\n  const next = candidates.slice();\r\n  const current = serverBrowserState.p2p.remoteCandidates || [];\r\n  if (current.length === next.length && current.every((value, index) => value === next[index])) {\r\n    return;\r\n  }\r\n  serverBrowserState.p2p.remoteCandidates = next;\r\n}\r\n\r\nfunction setP2PError(message) {\r\n  serverBrowserState.p2p.error = message ?? null;\r\n}\r\nfunction setP2PPending({ offer, answer, candidates }) {\r\n  if (typeof offer === \"boolean\") {\r\n    serverBrowserState.p2p.pendingOffer = offer;\r\n  }\r\n  if (typeof answer === \"boolean\") {\r\n    serverBrowserState.p2p.pendingAnswer = answer;\r\n  }\r\n  if (typeof candidates === \"boolean\") {\r\n    serverBrowserState.p2p.pendingCandidates = candidates;\r\n  }\r\n}\r\n\r\nfunction clearP2PState() {\r\n  serverBrowserState.p2p.offer = null;\r\n  serverBrowserState.p2p.answer = null;\r\n  serverBrowserState.p2p.pendingOffer = false;\r\n  serverBrowserState.p2p.pendingAnswer = false;\r\n  serverBrowserState.p2p.pendingCandidates = false;\r\n  serverBrowserState.p2p.localCandidates = [];\r\n  serverBrowserState.p2p.remoteCandidates = [];\r\n  serverBrowserState.p2p.error = null;\r\n}\r\n\r\nexport {\r\n  serverBrowserState,\r\n  getServerBrowserState,\r\n  setVisible,\r\n  toggleVisible,\r\n  setServers,\r\n  setError,\r\n  setStatusMessage,\r\n  setJoinStatus,\r\n  setJoinError,\r\n  setJoinedSessionId,\r\n  selectNext,\r\n  recordFetchTimestamp,\r\n  setFetching,\r\n  setHostingSession,\r\n  updateHostingHeartbeatTimestamp,\r\n  clearHosting,\r\n  setHostingMetrics,\r\n  setP2POffer,\r\n  setP2PAnswer,\r\n  setP2PLocalCandidates,\r\n  setP2PRemoteCandidates,\r\n  setP2PPending,\r\n  setP2PError,\r\n  clearP2PState\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { canvas, GROUND_Y } from \"../environment/canvas.js\";\r\nimport { getEnvironmentWidth } from \"./environment.js\";\r\n\r\nfunction clamp(value, min, max) {\r\n  return Math.max(min, Math.min(max, value));\r\n}\r\n\r\nconst VEHICLE_DEFINITIONS = {\r\n  buggy: {\r\n    label: \"Recon Buggy\",\r\n    movementType: \"ground\",\r\n    width: 132,\r\n    height: 48,\r\n    wheelRadius: 18,\r\n    wheelBase: 76,\r\n    driverSeat: { x: -6, y: 42 },\r\n    exitOffsets: [\r\n      { x: 72, y: 0 },\r\n      { x: -72, y: 0 }\r\n    ],\r\n    enterRadius: 96,\r\n    acceleration: 600,\r\n    braking: 920,\r\n    maxSpeed: 460,\r\n    idleDrag: 340,\r\n    airDrag: 0.92,\r\n    baseHealth: 320,\r\n    colorBody: \"#2e3147\",\r\n    colorAccent: \"#ffb84d\",\r\n    colorDetail: \"#f7f9ff\"\r\n  },\r\n  raptorHeli: {\r\n    label: \"Raptor Helicopter\",\r\n    movementType: \"air\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"raptorHeli.noseCannon\",\r\n        label: \"Nose Cannon\",\r\n        binding: \"primary\",\r\n        offset: { x: 32, y: 2 },\r\n        muzzles: [\r\n          { x: 46, y: -3 },\r\n          { x: 46, y: 3 }\r\n        ],\r\n        projectile: {\r\n          speed: 760,\r\n          damage: 16,\r\n          radius: 4,\r\n          color: \"#8cf4ff\",\r\n          gravityFactor: 0.04,\r\n          knockback: 80\r\n        },\r\n        scatter: 3.5,\r\n        fireInterval: 0.085,\r\n        flashDuration: 0.08,\r\n        flashRadius: 14,\r\n        barrelLength: 52,\r\n        barrelWidth: 5,\r\n        barrelColor: \"#8cf4ff\"\r\n      }\r\n    ],\r\n    width: 156,\r\n    height: 54,\r\n    driverSeat: { x: 6, y: 44 },\r\n    exitOffsets: [\r\n      { x: 88, y: 0 },\r\n      { x: -88, y: 0 }\r\n    ],\r\n    enterRadius: 128,\r\n    horizontalAcceleration: 360,\r\n    horizontalMaxSpeed: 320,\r\n    horizontalDrag: 180,\r\n    idleDrag: 140,\r\n    airDrag: 0.98,\r\n    liftPower: 940,\r\n    descendPower: 660,\r\n    gravityScale: 0.3,\r\n    maxVerticalSpeed: 240,\r\n    verticalDamping: 0.9,\r\n    hoverMinAltitude: 28,\r\n    hoverMaxAltitude: 260,\r\n    spawnHover: 60,\r\n    autopilotStrength: 5.5,\r\n    baseHealth: 460,\r\n    colorBody: \"#303952\",\r\n    colorAccent: \"#8cf4ff\",\r\n    colorDetail: \"#f4fbff\",\r\n    rotorSpan: 210,\r\n    rotorThickness: 7,\r\n    tailLength: 86\r\n  },\r\n  arrowJet: {\r\n    label: \"Arrow Fighter\",\r\n    movementType: \"air\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"arrowJet.rackRockets\",\r\n        label: \"Wing Rockets\",\r\n        binding: \"secondary\",\r\n        offset: { x: 12, y: -6 },\r\n        muzzles: [\r\n          { x: 52, y: -12 },\r\n          { x: 52, y: 12 }\r\n        ],\r\n        projectile: {\r\n          speed: 820,\r\n          damage: 28,\r\n          radius: 6,\r\n          color: \"#ff6b80\",\r\n          gravityFactor: 0.05,\r\n          knockback: 180\r\n        },\r\n        scatter: 4,\r\n        fireInterval: 0.24,\r\n        flashDuration: 0.09,\r\n        flashRadius: 15,\r\n        barrelLength: 54,\r\n        barrelWidth: 5,\r\n        barrelColor: \"#ff6b80\"\r\n      }\r\n    ],\r\n    width: 180,\r\n    height: 36,\r\n    driverSeat: { x: 0, y: 32 },\r\n    exitOffsets: [\r\n      { x: 96, y: -8 },\r\n      { x: -96, y: -8 }\r\n    ],\r\n    enterRadius: 132,\r\n    horizontalAcceleration: 400,\r\n    horizontalMaxSpeed: 360,\r\n    horizontalDrag: 160,\r\n    idleDrag: 130,\r\n    airDrag: 0.97,\r\n    liftPower: 920,\r\n    descendPower: 640,\r\n    gravityScale: 0.32,\r\n    maxVerticalSpeed: 280,\r\n    verticalDamping: 0.88,\r\n    hoverMinAltitude: 48,\r\n    hoverMaxAltitude: 360,\r\n    spawnHover: 120,\r\n    autopilotStrength: 4.2,\r\n    baseHealth: 400,\r\n    colorBody: \"#262c3e\",\r\n    colorAccent: \"#ff6b80\",\r\n    colorDetail: \"#f8f8ff\",\r\n    wingSpan: 230\r\n  },\r\n  tideSkiff: {\r\n    label: \"Tide Skiff\",\r\n    movementType: \"water\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"tideSkiff.prowCannon\",\r\n        label: \"Prow Cannon\",\r\n        binding: \"primary\",\r\n        offset: { x: 28, y: -18 },\r\n        muzzles: [\r\n          { x: 36, y: -4 }\r\n        ],\r\n        projectile: {\r\n          speed: 580,\r\n          damage: 22,\r\n          radius: 6,\r\n          color: \"#ffdd8a\",\r\n          gravityFactor: 0.08,\r\n          knockback: 140\r\n        },\r\n        scatter: 2.5,\r\n        fireInterval: 0.2,\r\n        flashDuration: 0.1,\r\n        flashRadius: 14,\r\n        barrelLength: 46,\r\n        barrelWidth: 6,\r\n        barrelColor: \"#5fd3ff\"\r\n      }\r\n    ],\r\n    width: 150,\r\n    height: 42,\r\n    driverSeat: { x: -10, y: 34 },\r\n    exitOffsets: [\r\n      { x: 92, y: -4 },\r\n      { x: -92, y: -4 }\r\n    ],\r\n    enterRadius: 120,\r\n    waterSurfaceOffset: 28,\r\n    waterAcceleration: 320,\r\n    waterMaxSpeed: 270,\r\n    waterReverseSpeed: 150,\r\n    waterIdleDrag: 180,\r\n    turnDrag: 240,\r\n    bobAmplitude: 6,\r\n    bobSpeed: 1.5,\r\n    buoyancyPoint: 0.58,\r\n    splashIntensity: 0.4,\r\n    baseHealth: 360,\r\n    colorBody: \"#1f2e3f\",\r\n    colorAccent: \"#5fd3ff\",\r\n    colorDetail: \"#f5fbff\"\r\n  },\r\n  stormBarge: {\r\n    label: \"Storm Barge\",\r\n    movementType: \"water\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"stormBarge.deckChaingun\",\r\n        label: \"Deck Chaingun\",\r\n        binding: \"primary\",\r\n        offset: { x: 18, y: -24 },\r\n        muzzles: [\r\n          { x: 58, y: -6 },\r\n          { x: 58, y: 6 }\r\n        ],\r\n        projectile: {\r\n          speed: 640,\r\n          damage: 18,\r\n          radius: 5,\r\n          color: \"#ffc86d\",\r\n          gravityFactor: 0.06,\r\n          knockback: 100\r\n        },\r\n        scatter: 5,\r\n        fireInterval: 0.1,\r\n        flashDuration: 0.08,\r\n        flashRadius: 16,\r\n        barrelLength: 58,\r\n        barrelWidth: 6,\r\n        barrelColor: \"#ffa94d\"\r\n      }\r\n    ],\r\n    width: 200,\r\n    height: 60,\r\n    driverSeat: { x: 14, y: 46 },\r\n    exitOffsets: [\r\n      { x: 110, y: -6 },\r\n      { x: -110, y: -6 }\r\n    ],\r\n    enterRadius: 132,\r\n    waterSurfaceOffset: 32,\r\n    waterAcceleration: 210,\r\n    waterMaxSpeed: 190,\r\n    waterReverseSpeed: 110,\r\n    waterIdleDrag: 280,\r\n    turnDrag: 320,\r\n    bobAmplitude: 4,\r\n    bobSpeed: 1.2,\r\n    buoyancyPoint: 0.62,\r\n    splashIntensity: 0.3,\r\n    baseHealth: 520,\r\n    colorBody: \"#232f3a\",\r\n    colorAccent: \"#ffa94d\",\r\n    colorDetail: \"#f0f4ff\"\r\n  },\r\n  abyssSub: {\r\n    label: \"Abyss Sub\",\r\n    movementType: \"water\",\r\n    mountedWeapons: [\r\n      {\r\n        id: \"abyssSub.torpedoLauncher\",\r\n        label: \"Twin Torpedoes\",\r\n        binding: \"secondary\",\r\n        offset: { x: 12, y: -10 },\r\n        muzzles: [\r\n          { x: 40, y: -6 },\r\n          { x: 40, y: 6 }\r\n        ],\r\n        projectile: {\r\n          speed: 520,\r\n          damage: 34,\r\n          radius: 7,\r\n          color: \"#8c9eff\",\r\n          gravityFactor: 0.02,\r\n          knockback: 200\r\n        },\r\n        scatter: 1.5,\r\n        fireInterval: 0.52,\r\n        flashDuration: 0.12,\r\n        flashRadius: 18,\r\n        barrelLength: 48,\r\n        barrelWidth: 7,\r\n        barrelColor: \"#8c9eff\"\r\n      }\r\n    ],\r\n    width: 132,\r\n    height: 48,\r\n    driverSeat: { x: 0, y: 36 },\r\n    exitOffsets: [\r\n      { x: 78, y: -10 },\r\n      { x: -78, y: -10 }\r\n    ],\r\n    enterRadius: 110,\r\n    waterSurfaceOffset: 36,\r\n    waterAcceleration: 300,\r\n    waterMaxSpeed: 260,\r\n    waterReverseSpeed: 160,\r\n    waterIdleDrag: 210,\r\n    turnDrag: 240,\r\n    bobAmplitude: 3,\r\n    bobSpeed: 1.1,\r\n    buoyancyPoint: 0.5,\r\n    submergedOffset: 18,\r\n    splashIntensity: 0.2,\r\n    baseHealth: 540,\r\n    colorBody: \"#182733\",\r\n    colorAccent: \"#8c9eff\",\r\n    colorDetail: \"#e9f1ff\"\r\n  },\r\n  scoutDrone: {\r\n    label: \"Scout Drone\",\r\n    movementType: \"air\",\r\n    width: 72,\r\n    height: 28,\r\n    driverSeat: { x: 0, y: 20 },\r\n    exitOffsets: [\r\n      { x: 48, y: 0 },\r\n      { x: -48, y: 0 }\r\n    ],\r\n    enterRadius: 90,\r\n    horizontalAcceleration: 320,\r\n    horizontalMaxSpeed: 300,\r\n    horizontalDrag: 200,\r\n    idleDrag: 190,\r\n    airDrag: 0.95,\r\n    liftPower: 720,\r\n    descendPower: 560,\r\n    gravityScale: 0.26,\r\n    maxVerticalSpeed: 200,\r\n    verticalDamping: 0.88,\r\n    hoverMinAltitude: 24,\r\n    hoverMaxAltitude: 220,\r\n    spawnHover: 48,\r\n    autopilotStrength: 6.8,\r\n    baseHealth: 210,\r\n    colorBody: \"#293444\",\r\n    colorAccent: \"#ffe066\",\r\n    colorDetail: \"#edf4ff\"\r\n  }\r\n};\r\n\r\nlet vehicleCounter = 0;\r\n\r\nfunction createVehicle(type, x, options = {}) {\r\n  const definition = VEHICLE_DEFINITIONS[type];\r\n  if (!definition) {\r\n    throw new Error(`Unknown vehicle type: ${type}`);\r\n  }\r\n\r\n  const movementType = definition.movementType ?? \"ground\";\r\n  const minX = definition.width * 0.5;\r\n  const envWidth = getEnvironmentWidth();\r\n  const maxX = Math.max(minX, envWidth - definition.width * 0.5);\r\n  const centerX = clamp(x ?? envWidth * 0.5, minX, maxX);\r\n\r\n  let top;\r\n  let onGround = true;\r\n  let waterLineY = null;\r\n  let preferredAltitude = options.hover ?? definition.spawnHover ?? 0;\r\n\r\n  if (movementType === \"air\") {\r\n    const minAltitude = definition.hoverMinAltitude ?? 0;\r\n    const maxAltitude = definition.hoverMaxAltitude ?? minAltitude;\r\n    const altitude = clamp(preferredAltitude, minAltitude, maxAltitude);\r\n    top = GROUND_Y - definition.height - altitude;\r\n    onGround = false;\r\n    preferredAltitude = altitude;\r\n  } else if (movementType === \"water\") {\r\n    const surfaceOffset = definition.waterSurfaceOffset ?? 24;\r\n    waterLineY = GROUND_Y - surfaceOffset;\r\n    const buoyancyPoint = clamp(definition.buoyancyPoint ?? 0.55, 0.2, 0.9);\r\n    const submergedOffset = definition.submergedOffset ?? 0;\r\n    top = waterLineY - definition.height * buoyancyPoint + submergedOffset;\r\n    onGround = false;\r\n    preferredAltitude = 0;\r\n  } else {\r\n    top = GROUND_Y - definition.height;\r\n  }\r\n\r\n  const vehicle = {\r\n    id: `vehicle-${type}-${vehicleCounter += 1}`,\r\n    type,\r\n    x: centerX,\r\n    y: top,\r\n    vx: 0,\r\n    vy: 0,\r\n    tilt: 0,\r\n    facing: 1,\r\n    driverId: null,\r\n    health: definition.baseHealth,\r\n    maxHealth: definition.baseHealth,\r\n    enterCooldown: 0,\r\n    damageFlash: 0,\r\n    onGround,\r\n    preferredAltitude: movementType === \"air\" ? preferredAltitude : 0,\r\n    waterLineY,\r\n    bobPhase: Math.random() * Math.PI * 2\r\n  };\r\n\r\n  vehicle.mounts = (definition.mountedWeapons ?? []).map((mountDef, index) => ({\r\n    id: mountDef.id ?? `${type}-mount-${index}`,\r\n    cooldown: 0,\r\n    flashTimer: 0,\r\n    muzzleIndex: 0,\r\n    lastMuzzleX: null,\r\n    lastMuzzleY: null\r\n  }));\r\n\r\n  return vehicle;\r\n}\r\n\r\nconst vehicles = [\r\n  createVehicle(\"buggy\", getEnvironmentWidth() * 0.14),\r\n  createVehicle(\"buggy\", getEnvironmentWidth() * 0.28),\r\n  createVehicle(\"tideSkiff\", getEnvironmentWidth() * 0.38),\r\n  createVehicle(\"raptorHeli\", getEnvironmentWidth() * 0.56, { hover: 140 }),\r\n  createVehicle(\"arrowJet\", getEnvironmentWidth() * 0.64, { hover: 200 }),\r\n  createVehicle(\"stormBarge\", getEnvironmentWidth() * 0.74),\r\n  createVehicle(\"abyssSub\", getEnvironmentWidth() * 0.78),\r\n  createVehicle(\"scoutDrone\", getEnvironmentWidth() * 0.9, { hover: 100 })\r\n];\r\n\r\nfunction getVehicleById(id) {\r\n  return vehicles.find((vehicle) => vehicle.id === id) ?? null;\r\n}\r\n\r\nexport { VEHICLE_DEFINITIONS, vehicles, createVehicle, getVehicleById };\r\n\r\n\r\n","function clamp(value, min, max) {\n  return Math.max(min, Math.min(max, value));\n}\n\nexport { clamp };\r\n","let elapsed = 0;\n\nfunction advanceTime(delta) {\n  elapsed += delta;\n}\n\nfunction getElapsedTime() {\n  return elapsed;\n}\n\nexport { advanceTime, getElapsedTime };\r\n","const SURVIVAL_SETTINGS = {\n  countdownDuration: 5,\n  restDuration: 10,\n  defeatCooldown: 6,\n  reviveHealthPercent: 0.7,\n  baseEnemies: 3,\n  enemiesPerWave: 1,\n  enemyCap: 8,\n  healthMultiplierPerWave: 0.2,\n  damageMultiplierPerWave: 0.18,\n  speedMultiplierPerWave: 0.12,\n  waveReward: 35,\n  rewardIncrement: 12,\n  bestWaveBonus: 50,\n  killReward: 3\n};\n\nexport { SURVIVAL_SETTINGS };\r\n","import { SURVIVAL_SETTINGS } from \"../config/survival.js\";\r\nimport { onEnvironmentChange } from \"./environment.js\";\r\n\r\nconst persistentSurvivalStats = {\r\n  bestWave: 0,\r\n  bestKills: 0,\r\n  bestReward: 0\r\n};\r\n\r\nconst survivalState = {\r\n  active: false,\r\n  stage: \"inactive\",\r\n  timer: 0,\r\n  wave: 0,\r\n  enemiesAlive: 0,\r\n  lastReward: 0,\r\n  kills: 0,\r\n  runReward: 0,\r\n  bestWave: 0,\r\n  bestKills: 0,\r\n  bestReward: 0,\r\n  lastOutcome: null\r\n};\r\n\r\nfunction syncPersistentStats(preserve = true) {\r\n  if (preserve) {\r\n    persistentSurvivalStats.bestWave = Math.max(persistentSurvivalStats.bestWave, survivalState.bestWave);\r\n    persistentSurvivalStats.bestKills = Math.max(persistentSurvivalStats.bestKills, survivalState.bestKills);\r\n    persistentSurvivalStats.bestReward = Math.max(persistentSurvivalStats.bestReward, survivalState.bestReward);\r\n  } else {\r\n    persistentSurvivalStats.bestWave = 0;\r\n    persistentSurvivalStats.bestKills = 0;\r\n    persistentSurvivalStats.bestReward = 0;\r\n  }\r\n}\r\n\r\nfunction applyPersistentStats() {\r\n  survivalState.bestWave = Math.max(survivalState.bestWave, persistentSurvivalStats.bestWave);\r\n  survivalState.bestKills = Math.max(survivalState.bestKills, persistentSurvivalStats.bestKills);\r\n  survivalState.bestReward = Math.max(survivalState.bestReward, persistentSurvivalStats.bestReward);\r\n}\r\n\r\nfunction resetSurvivalState({ preserveStats = true } = {}) {\r\n  if (preserveStats) {\r\n    syncPersistentStats(true);\r\n  } else {\r\n    syncPersistentStats(false);\r\n  }\r\n  survivalState.active = false;\r\n  survivalState.stage = \"inactive\";\r\n  survivalState.timer = 0;\r\n  survivalState.wave = 0;\r\n  survivalState.enemiesAlive = 0;\r\n  survivalState.lastReward = 0;\r\n  survivalState.kills = 0;\r\n  survivalState.runReward = 0;\r\n  survivalState.lastOutcome = null;\r\n  survivalState.bestWave = persistentSurvivalStats.bestWave;\r\n  survivalState.bestKills = persistentSurvivalStats.bestKills;\r\n  survivalState.bestReward = persistentSurvivalStats.bestReward;\r\n}\r\n\r\nfunction beginSurvivalCountdown() {\r\n  survivalState.active = true;\r\n  survivalState.wave = 0;\r\n  survivalState.lastReward = 0;\r\n  survivalState.kills = 0;\r\n  survivalState.runReward = 0;\r\n  survivalState.lastOutcome = null;\r\n  setSurvivalStage(\"countdown\", SURVIVAL_SETTINGS.countdownDuration);\r\n}\r\n\r\nfunction setSurvivalActive(value) {\r\n  survivalState.active = Boolean(value);\r\n}\r\n\r\nfunction setSurvivalStage(stage, timer = 0) {\r\n  survivalState.stage = stage;\r\n  survivalState.timer = Math.max(0, timer ?? 0);\r\n}\r\n\r\nfunction incrementSurvivalWave() {\r\n  survivalState.wave += 1;\r\n  const newBest = survivalState.wave > survivalState.bestWave;\r\n  if (newBest) {\r\n    survivalState.bestWave = survivalState.wave;\r\n    persistentSurvivalStats.bestWave = Math.max(persistentSurvivalStats.bestWave, survivalState.bestWave);\r\n  }\r\n  return newBest;\r\n}\r\nfunction setSurvivalWave(value) {\r\n  survivalState.wave = Math.max(0, Math.floor(value ?? 0));\r\n  survivalState.bestWave = Math.max(survivalState.bestWave, survivalState.wave);\r\n  persistentSurvivalStats.bestWave = Math.max(persistentSurvivalStats.bestWave, survivalState.bestWave);\r\n}\r\n\r\nfunction setSurvivalTimer(value) {\r\n  survivalState.timer = Math.max(0, value ?? 0);\r\n}\r\n\r\nfunction setSurvivalEnemiesAlive(count) {\r\n  survivalState.enemiesAlive = Math.max(0, Math.floor(count ?? 0));\r\n}\r\n\r\nfunction setSurvivalLastReward(amount) {\r\n  const reward = Math.max(0, Math.round(amount ?? 0));\r\n  survivalState.lastReward = reward;\r\n  if (reward > 0) {\r\n    survivalState.runReward += reward;\r\n    survivalState.bestReward = Math.max(survivalState.bestReward, survivalState.runReward);\r\n    persistentSurvivalStats.bestReward = Math.max(persistentSurvivalStats.bestReward, survivalState.bestReward);\r\n  }\r\n}\r\n\r\nfunction addSurvivalImmediateReward(amount) {\r\n  const reward = Math.max(0, Math.round(amount ?? 0));\r\n  if (reward <= 0) {\r\n    return;\r\n  }\r\n  survivalState.runReward += reward;\r\n  survivalState.bestReward = Math.max(survivalState.bestReward, survivalState.runReward);\r\n  persistentSurvivalStats.bestReward = Math.max(persistentSurvivalStats.bestReward, survivalState.bestReward);\r\n}\r\n\r\nfunction incrementSurvivalKills(amount = 1) {\r\n  if (!Number.isFinite(amount) || amount <= 0) {\r\n    return;\r\n  }\r\n  survivalState.kills += amount;\r\n  survivalState.bestKills = Math.max(survivalState.bestKills, survivalState.kills);\r\n  persistentSurvivalStats.bestKills = Math.max(persistentSurvivalStats.bestKills, survivalState.bestKills);\r\n}\r\n\r\nfunction setSurvivalKills(value) {\r\n  survivalState.kills = Math.max(0, Math.floor(value ?? 0));\r\n  survivalState.bestKills = Math.max(survivalState.bestKills, survivalState.kills);\r\n  persistentSurvivalStats.bestKills = Math.max(persistentSurvivalStats.bestKills, survivalState.bestKills);\r\n}\r\n\r\nfunction setSurvivalLastOutcome(outcome) {\r\n  survivalState.lastOutcome = outcome ?? null;\r\n}\r\n\r\nfunction getSurvivalState() {\r\n  return survivalState;\r\n}\r\n\r\nfunction isSurvivalActive() {\r\n  return survivalState.active;\r\n}\r\n\r\napplyPersistentStats();\r\n\r\nonEnvironmentChange(() => {\r\n  resetSurvivalState({ preserveStats: false });\r\n});\r\n\r\nexport {\r\n  getSurvivalState,\r\n  beginSurvivalCountdown,\r\n  setSurvivalActive,\r\n  setSurvivalStage,\r\n  incrementSurvivalWave,\r\n  setSurvivalWave,\r\n  setSurvivalTimer,\r\n  setSurvivalEnemiesAlive,\r\n  setSurvivalLastReward,\r\n  addSurvivalImmediateReward,\r\n  incrementSurvivalKills,\r\n  setSurvivalKills,\r\n  setSurvivalLastOutcome,\r\n  resetSurvivalState,\r\n  isSurvivalActive\r\n};\r\n\r\n\r\n\r\n\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { GRAVITY } from \"../../config/constants.js\";\r\n\r\nconst RAGDOLL_BLUEPRINTS = {\r\n  player: [\r\n    { radius: 16, offsetX: 0, offsetY: -42, color: \"#f4f7ff\" },\r\n    { radius: 12, offsetX: 0, offsetY: -14, color: \"#cfd3df\" },\r\n    { radius: 10, offsetX: -14, offsetY: 6, color: \"#f4f7ff\" },\r\n    { radius: 10, offsetX: 14, offsetY: 6, color: \"#f4f7ff\" },\r\n    { radius: 11, offsetX: -10, offsetY: 34, color: \"#cfd3df\" },\r\n    { radius: 11, offsetX: 10, offsetY: 34, color: \"#cfd3df\" }\r\n  ],\r\n  enemy: [\r\n    { radius: 16, offsetX: 0, offsetY: -40, color: \"#fa5b4a\" },\r\n    { radius: 12, offsetX: 0, offsetY: -12, color: \"#d94d3f\" },\r\n    { radius: 10, offsetX: -12, offsetY: 8, color: \"#ff9488\" },\r\n    { radius: 10, offsetX: 12, offsetY: 8, color: \"#ff9488\" },\r\n    { radius: 11, offsetX: -10, offsetY: 36, color: \"#d94d3f\" },\r\n    { radius: 11, offsetX: 10, offsetY: 36, color: \"#d94d3f\" }\r\n  ]\r\n};\r\n\r\nconst ragdolls = [];\r\n\r\nfunction spawnRagdoll(kind, originX, originY, facing = 1, baseVx = 0, baseVy = 0) {\r\n  const blueprint = RAGDOLL_BLUEPRINTS[kind];\r\n  if (!blueprint) {\r\n    return;\r\n  }\r\n\r\n  for (const part of blueprint) {\r\n    ragdolls.push({\r\n      x: originX + part.offsetX * facing,\r\n      y: originY + part.offsetY,\r\n      vx: baseVx + facing * (40 + Math.random() * 80) + (Math.random() - 0.5) * 60,\r\n      vy: baseVy - (80 + Math.random() * 140),\r\n      radius: part.radius,\r\n      color: part.color,\r\n      life: 1.6 + Math.random() * 0.8,\r\n      maxLife: 1.6 + Math.random() * 0.8\r\n    });\r\n  }\r\n}\r\n\r\nfunction updateRagdolls(delta, groundY) {\r\n  for (const piece of ragdolls) {\r\n    piece.life -= delta;\r\n    piece.vy += GRAVITY * delta * 0.9;\r\n    piece.x += piece.vx * delta;\r\n    piece.y += piece.vy * delta;\r\n    piece.vx *= 0.96;\r\n\r\n    if (piece.y + piece.radius >= groundY) {\r\n      piece.y = groundY - piece.radius;\r\n      piece.vy = -piece.vy * 0.35;\r\n      piece.vx *= 0.7;\r\n      if (Math.abs(piece.vy) < 20) {\r\n        piece.vy = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  for (let i = ragdolls.length - 1; i >= 0; i -= 1) {\r\n    if (ragdolls[i].life <= 0.05) {\r\n      ragdolls.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawRagdolls() {\r\n  context.save();\r\n  for (const piece of ragdolls) {\r\n    const alpha = clamp(piece.life / piece.maxLife, 0, 1);\r\n    context.globalAlpha = alpha * 0.85;\r\n    context.fillStyle = piece.color;\r\n    context.beginPath();\r\n    context.arc(piece.x, piece.y, piece.radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction getRagdolls() {\r\n  return ragdolls;\r\n}\r\n\r\nexport { spawnRagdoll, updateRagdolls, drawRagdolls, getRagdolls };\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst damagePopups = [];\r\n\r\nfunction spawnDamagePopup(x, y, value) {\r\n  damagePopups.push({\r\n    x,\r\n    y,\r\n    value,\r\n    life: 0.75,\r\n    maxLife: 0.75,\r\n    vx: (Math.random() - 0.5) * 24,\r\n    vy: -60 - Math.random() * 20\r\n  });\r\n}\r\n\r\nfunction updateDamagePopups(delta) {\r\n  for (const popup of damagePopups) {\r\n    popup.life -= delta;\r\n    popup.x += popup.vx * delta;\r\n    popup.y += popup.vy * delta;\r\n    popup.vy -= 40 * delta;\r\n  }\r\n\r\n  for (let i = damagePopups.length - 1; i >= 0; i -= 1) {\r\n    if (damagePopups[i].life <= 0) {\r\n      damagePopups.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawDamagePopups() {\r\n  context.save();\r\n  context.font = \"18px 'Segoe UI', Arial, sans-serif\";\r\n  context.textAlign = \"center\";\r\n  for (const popup of damagePopups) {\r\n    const opacity = clamp(popup.life / popup.maxLife, 0, 1);\r\n    context.fillStyle = `rgba(255, 214, 102, ${opacity})`;\r\n    context.fillText(`-${Math.round(popup.value)}`, popup.x, popup.y);\r\n  }\r\n  context.restore();\r\n}\r\n\r\nexport { spawnDamagePopup, updateDamagePopups, drawDamagePopups };\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst particles = [];\r\nconst rings = [];\r\nlet listenersAttached = false;\r\n\r\nconst BLOOD_COLORS = [\"#8b0f14\", \"#b11217\", \"#d92c32\", \"#f0483c\"];\r\nconst BLOOD_MIST_COLORS = [\"rgba(240, 72, 60, 0.55)\", \"rgba(217, 44, 50, 0.45)\"];\r\nconst SPARK_COLORS = [\"#ffd36b\", \"#ffeaa1\", \"#ff9b45\"];\r\nconst DUST_COLOR_MAP = {\r\n  sand: [\"#cbb188\", \"#a17b53\", \"#e4c9a2\"],\r\n  stone: [\"#d6d8df\", \"#adb4c1\", \"#8b929f\"],\r\n  steel: [\"#94aaff\", \"#c5d2ff\", \"#6f7ab0\"],\r\n  default: [\"#c8b7a1\", \"#9c8366\"]\r\n};\r\n\r\nfunction pickRandom(values) {\r\n  return values[Math.floor(Math.random() * values.length)] ?? values[0];\r\n}\r\n\r\nfunction resolvePalette(name, fallback = DUST_COLOR_MAP.default) {\r\n  if (!name) {\r\n    return fallback;\r\n  }\r\n  return DUST_COLOR_MAP[name] ?? fallback;\r\n}\r\n\r\nfunction spawnRingBurst(options = {}) {\r\n  const ttl = options.ttl ?? 0.4;\r\n  const ring = {\r\n    x: options.x ?? 0,\r\n    y: options.y ?? 0,\r\n    startRadius: options.startRadius ?? 70,\r\n    endRadius: options.endRadius ?? 140,\r\n    color: options.color ?? \"#ffffff\",\r\n    maxTtl: ttl,\r\n    ttl,\r\n    lineWidth: options.lineWidth ?? 5\r\n  };\r\n  rings.push(ring);\r\n  return ring;\r\n}\r\n\r\nfunction spawnBloodSpray(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const facing = detail.facing ?? 1;\r\n  const intensity = clamp(detail.intensity ?? ((detail.damage ?? 0) / Math.max(1, detail.maxDamage ?? 60)), 0, 1);\r\n  const amount = Math.max(4, Math.round(detail.amount ?? (8 + intensity * 10)));\r\n  const speedBase = detail.speed ?? (220 + intensity * 140);\r\n  const gravity = detail.gravity ?? 980;\r\n  for (let i = 0; i < amount; i += 1) {\r\n    const spread = detail.spread ?? Math.PI * 0.55;\r\n    const angle = (Math.random() * spread - spread * 0.5) + (facing >= 0 ? 0 : Math.PI);\r\n    const speed = speedBase * (0.55 + Math.random() * 0.9);\r\n    const vx = Math.cos(angle) * speed;\r\n    const vy = Math.sin(angle) * speed - (80 + intensity * 140);\r\n    const ttl = 0.45 + Math.random() * 0.25;\r\n    particles.push({\r\n      type: \"blood\",\r\n      x: baseX,\r\n      y: baseY,\r\n      vx,\r\n      vy,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 3 + Math.random() * 2.6,\r\n      color: pickRandom(BLOOD_COLORS),\r\n      gravity\r\n    });\r\n  }\r\n  const mistCount = Math.max(2, Math.round(amount * 0.35));\r\n  for (let i = 0; i < mistCount; i += 1) {\r\n    const dir = Math.random() * Math.PI * 2;\r\n    const speed = 60 + Math.random() * 110;\r\n    const ttl = 0.35 + Math.random() * 0.3;\r\n    particles.push({\r\n      type: \"bloodMist\",\r\n      x: baseX + Math.cos(dir) * 6,\r\n      y: baseY + Math.sin(dir) * 4,\r\n      vx: Math.cos(dir) * speed * 0.4,\r\n      vy: Math.sin(dir) * speed * 0.2 - 40,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 12 + Math.random() * 10,\r\n      color: pickRandom(BLOOD_MIST_COLORS)\r\n    });\r\n  }\r\n}\r\n\r\nfunction spawnImpactSparks(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const amount = Math.max(4, Math.round(detail.amount ?? 8));\r\n  const speedBase = detail.speed ?? 260;\r\n  const palette = Array.isArray(detail.palette) && detail.palette.length > 0 ? detail.palette : SPARK_COLORS;\r\n  for (let i = 0; i < amount; i += 1) {\r\n    const angle = (detail.angle ?? 0) + (Math.random() - 0.5) * (detail.spread ?? Math.PI * 0.9);\r\n    const speed = speedBase * (0.5 + Math.random() * 0.8);\r\n    const ttl = 0.18 + Math.random() * 0.18;\r\n    particles.push({\r\n      type: \"spark\",\r\n      x: baseX,\r\n      y: baseY,\r\n      vx: Math.cos(angle) * speed,\r\n      vy: Math.sin(angle) * speed,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 2 + Math.random() * 2,\r\n      color: pickRandom(palette)\r\n    });\r\n  }\r\n}\r\n\r\nfunction spawnImpactDust(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const amount = Math.max(4, Math.round(detail.amount ?? 9));\r\n  const palette = Array.isArray(detail.palette) && detail.palette.length > 0\r\n    ? detail.palette\r\n    : resolvePalette(detail.paletteName, DUST_COLOR_MAP.default);\r\n  const baseAngle = detail.angle ?? (Math.PI * 1.5);\r\n  const spread = detail.spread ?? Math.PI * 0.9;\r\n  const speedBase = detail.speed ?? 160;\r\n  for (let i = 0; i < amount; i += 1) {\r\n    const angle = baseAngle + (Math.random() - 0.5) * spread;\r\n    const speed = speedBase * (0.5 + Math.random() * 0.9);\r\n    const ttl = 0.6 + Math.random() * 0.3;\r\n    particles.push({\r\n      type: \"dust\",\r\n      x: baseX,\r\n      y: baseY,\r\n      vx: Math.cos(angle) * speed,\r\n      vy: Math.sin(angle) * speed - 40,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: (detail.radius ?? 12) * (0.5 + Math.random() * 0.6),\r\n      color: pickRandom(palette)\r\n    });\r\n  }\r\n}\r\n\r\nfunction spawnGroundDust(detail = {}) {\r\n  spawnImpactDust({\r\n    x: detail.x,\r\n    y: detail.y,\r\n    amount: detail.amount ?? 8,\r\n    paletteName: detail.paletteName ?? \"sand\",\r\n    speed: detail.speed ?? 140,\r\n    spread: detail.spread ?? Math.PI * 1.1,\r\n    angle: detail.angle ?? (Math.PI * 1.4),\r\n    radius: detail.radius ?? 14\r\n  });\r\n}\r\n\r\nfunction spawnMuzzleParticles(detail = {}) {\r\n  const count = 6;\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const facing = detail.facing ?? 1;\r\n  for (let i = 0; i < count; i += 1) {\r\n    const speed = 140 + Math.random() * 120;\r\n    const angle = (Math.random() * 0.6 - 0.3) + (facing > 0 ? 0 : Math.PI);\r\n    const vx = Math.cos(angle) * speed;\r\n    const vy = Math.sin(angle) * speed;\r\n    const ttl = 0.18 + Math.random() * 0.08;\r\n    particles.push({\r\n      type: \"spark\",\r\n      x: baseX,\r\n      y: baseY,\r\n      vx,\r\n      vy,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 4 + Math.random() * 3,\r\n      color: \"#ffdd9a\"\r\n    });\r\n  }\r\n}\r\n\r\nfunction spawnShieldRing(detail = {}, config = {}) {\r\n  const center = detail.center ?? { x: detail.x ?? 0, y: detail.y ?? 0 };\r\n  return spawnRingBurst({\r\n    x: center.x,\r\n    y: center.y,\r\n    ttl: config.ttl ?? 0.4,\r\n    startRadius: config.startRadius ?? (detail.radius ?? 70),\r\n    endRadius: config.endRadius ?? (detail.radius ?? 70) * 1.25,\r\n    color: config.color ?? \"#7cd6ff\",\r\n    lineWidth: config.lineWidth ?? 5\r\n  });\r\n}\r\n\r\nfunction spawnShieldHitParticles(detail = {}) {\r\n  const center = detail.center ?? { x: 0, y: 0 };\r\n  for (let i = 0; i < 9; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 90 + Math.random() * 150;\r\n    const vx = Math.cos(angle) * speed;\r\n    const vy = Math.sin(angle) * speed;\r\n    const ttl = 0.3 + Math.random() * 0.2;\r\n    particles.push({\r\n      type: \"shield\",\r\n      x: center.x,\r\n      y: center.y,\r\n      vx,\r\n      vy,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 6 + Math.random() * 6,\r\n      color: \"#9be9ff\"\r\n    });\r\n  }\r\n  spawnShieldRing(detail, {\r\n    ttl: 0.35,\r\n    startRadius: (detail.radius ?? 72) * 0.75,\r\n    endRadius: (detail.radius ?? 72) * 1.15,\r\n    lineWidth: 4,\r\n    color: \"#a9f0ff\"\r\n  });\r\n}\r\n\r\nfunction spawnShieldShatter(detail = {}) {\r\n  spawnShieldRing(detail, {\r\n    ttl: 0.55,\r\n    startRadius: (detail.radius ?? 96) * 0.9,\r\n    endRadius: (detail.radius ?? 96) * 1.6,\r\n    lineWidth: 7,\r\n    color: \"#7cd6ff\"\r\n  });\r\n  spawnShieldHitParticles({ center: detail.center, radius: detail.radius ?? 96 });\r\n}\r\n\r\nfunction spawnDestructibleHitParticles(detail = {}) {\r\n  const material = detail.material ?? \"generic\";\r\n  const paletteMap = {\r\n    concrete: [\"#dfe6f2\", \"#b9c3d0\", \"#6c7584\"],\r\n    vehicle: [\"#ffd6c8\", \"#ff9a82\", \"#3a1a1a\"],\r\n    volatile: [\"#ffd38a\", \"#ff9c3b\", \"#6e2c05\"],\r\n    generic: [\"#f2f5ff\", \"#c9d0de\"]\r\n  };\r\n  const palette = paletteMap[material] ?? paletteMap.generic;\r\n  const maxHealth = Math.max(1, detail.maxHealth ?? detail.health ?? 1);\r\n  const remaining = Math.max(0, Math.min(maxHealth, detail.health ?? maxHealth));\r\n  const intensity = clamp(1 - remaining / maxHealth, 0, 1);\r\n  const count = Math.max(6, Math.round(6 + intensity * 6));\r\n  const baseSpeed = 160 + intensity * 200;\r\n  for (let i = 0; i < count; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = baseSpeed * (0.45 + Math.random() * 0.65);\r\n    particles.push({\r\n      type: \"debris\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      vx: Math.cos(angle) * speed,\r\n      vy: Math.sin(angle) * speed * 0.7 - 50,\r\n      ttl: 0.45 + Math.random() * 0.3,\r\n      maxTtl: 0.45 + Math.random() * 0.3,\r\n      radius: 3 + Math.random() * 4,\r\n      color: palette[i % palette.length]\r\n    });\r\n  }\r\n}\r\n\r\nfunction ensureListeners() {\r\n  if (listenersAttached || typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.addEventListener(\"weapon:muzzle-flash\", (event) => {\r\n    spawnMuzzleParticles(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"shield:hit\", (event) => {\r\n    spawnShieldHitParticles(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"shield:shatter\", (event) => {\r\n    spawnShieldShatter(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"throwable:explosion\", (event) => {\r\n    spawnExplosionParticles(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"throwable:flash-burst\", (event) => {\r\n    spawnFlashBurst(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"throwable:smoke-spawn\", (event) => {\r\n    spawnSmokePuffs(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"throwable:smoke-dissipate\", (event) => {\r\n    spawnSmokeDissipateRing(event?.detail ?? {});\r\n  });\r\n  window.addEventListener(\"destructible:hit\", (event) => {\r\n    spawnDestructibleHitParticles(event?.detail ?? {});\r\n  });\r\n  listenersAttached = true;\r\n}\r\n\r\nfunction spawnExplosionParticles(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const radius = detail.radius ?? 110;\r\n  const count = 18;\r\n  for (let i = 0; i < count; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 220 + Math.random() * 220;\r\n    const ttl = 0.3 + Math.random() * 0.25;\r\n    particles.push({\r\n      type: \"ember\",\r\n      x: baseX,\r\n      y: baseY,\r\n      vx: Math.cos(angle) * speed,\r\n      vy: Math.sin(angle) * speed,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 5 + Math.random() * 4,\r\n      color: Math.random() > 0.55 ? \"#ff9c4a\" : \"#ffd56b\"\r\n    });\r\n  }\r\n  spawnRingBurst({\r\n    x: baseX,\r\n    y: baseY,\r\n    startRadius: radius * 0.45,\r\n    endRadius: radius * 1.05,\r\n    color: \"#ffb347\",\r\n    lineWidth: 6,\r\n    ttl: 0.45\r\n  });\r\n}\r\n\r\nfunction spawnExplosionDebris(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const count = detail.count ?? 14;\r\n  const radius = detail.radius ?? 120;\r\n  const speedBase = detail.speed ?? 260;\r\n  const palette = detail.palette ?? [\"#ffdd9a\", \"#f7a24a\", \"#b55628\", \"#5b4340\"];\r\n  for (let i = 0; i < count; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = speedBase * (0.45 + Math.random() * 0.65);\r\n    const tilt = (Math.random() - 0.5) * 0.6;\r\n    particles.push({\r\n      type: \"debris\",\r\n      x: baseX + Math.cos(angle) * (detail.offsetRadius ?? 0),\r\n      y: baseY + Math.sin(angle) * (detail.offsetRadius ?? 0),\r\n      vx: Math.cos(angle + tilt) * speed,\r\n      vy: Math.sin(angle + tilt) * speed * 0.7 - 60,\r\n      ttl: 0.4 + Math.random() * 0.3,\r\n      maxTtl: 0.4 + Math.random() * 0.3,\r\n      radius: 3 + Math.random() * 4,\r\n      color: palette[i % palette.length]\r\n    });\r\n  }\r\n}\r\nfunction spawnFlashBurst(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const radius = detail.radius ?? 140;\r\n  spawnRingBurst({\r\n    x: baseX,\r\n    y: baseY,\r\n    startRadius: radius * 0.6,\r\n    endRadius: radius * 1.35,\r\n    color: \"#fff6d0\",\r\n    lineWidth: 8,\r\n    ttl: 0.32\r\n  });\r\n  for (let i = 0; i < 12; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 160 + Math.random() * 140;\r\n    const ttl = 0.18 + Math.random() * 0.08;\r\n    particles.push({\r\n      type: \"flash\",\r\n      x: baseX,\r\n      y: baseY,\r\n      vx: Math.cos(angle) * speed,\r\n      vy: Math.sin(angle) * speed,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: 5 + Math.random() * 3,\r\n      color: \"#fffbe0\"\r\n    });\r\n  }\r\n}\r\n\r\nfunction spawnSmokePuffs(detail = {}) {\r\n  const baseX = detail.x ?? 0;\r\n  const baseY = detail.y ?? 0;\r\n  const radius = detail.radius ?? detail.maxRadius ?? 120;\r\n  const count = 14;\r\n  for (let i = 0; i < count; i += 1) {\r\n    const angle = Math.random() * Math.PI * 2;\r\n    const speed = 30 + Math.random() * 60;\r\n    const vx = Math.cos(angle) * speed * 0.4;\r\n    const vy = -40 - Math.random() * 50;\r\n    const ttl = 0.9 + Math.random() * 0.5;\r\n    particles.push({\r\n      type: \"smoke\",\r\n      x: baseX + Math.cos(angle) * radius * 0.2,\r\n      y: baseY + Math.sin(angle) * radius * 0.1,\r\n      vx,\r\n      vy,\r\n      ttl,\r\n      maxTtl: ttl,\r\n      radius: radius * (0.15 + Math.random() * 0.18),\r\n      color: \"#aec4d8\"\r\n    });\r\n  }\r\n  spawnRingBurst({\r\n    x: baseX,\r\n    y: baseY,\r\n    startRadius: radius * 0.5,\r\n    endRadius: radius * 1.2,\r\n    color: \"#9db8ca\",\r\n    lineWidth: 4,\r\n    ttl: 0.5\r\n  });\r\n}\r\n\r\nfunction spawnSmokeDissipateRing(detail = {}) {\r\n  spawnRingBurst({\r\n    x: detail.x ?? 0,\r\n    y: detail.y ?? 0,\r\n    startRadius: (detail.radius ?? 110) * 0.8,\r\n    endRadius: (detail.radius ?? 110) * 1.1,\r\n    color: \"#95a8b8\",\r\n    lineWidth: 3,\r\n    ttl: 0.4\r\n  });\r\n}\r\n\r\nfunction updateParticles(delta) {\r\n  ensureListeners();\r\n  for (let i = particles.length - 1; i >= 0; i -= 1) {\r\n    const p = particles[i];\r\n    p.ttl -= delta;\r\n    if (p.ttl <= 0) {\r\n      particles.splice(i, 1);\r\n      continue;\r\n    }\r\n    const life = clamp(p.ttl / p.maxTtl, 0, 1);\r\n    p.x += p.vx * delta;\r\n    p.y += p.vy * delta;\r\n    if (p.type === \"blood\") {\r\n      p.vy += (p.gravity ?? 980) * delta;\r\n      p.vx *= 0.82;\r\n      p.vy *= 0.9;\r\n      p.radius *= 0.94;\r\n    } else if (p.type === \"bloodMist\") {\r\n      p.vx *= 0.9;\r\n      p.vy *= 0.92;\r\n      p.radius *= 1.02;\r\n    } else if (p.type === \"shield\") {\r\n      p.vx *= 0.88;\r\n      p.vy *= 0.88;\r\n      p.radius *= 0.96 + life * 0.04;\r\n    } else if (p.type === \"smoke\") {\r\n      p.vx *= 0.9;\r\n      p.vy = (p.vy ?? 0) * 0.9 - 24 * delta;\r\n      p.radius *= 0.995 + life * 0.02;\r\n    } else if (p.type === \"ember\") {\r\n      p.vx *= 0.94;\r\n      p.vy *= 0.94;\r\n    } else if (p.type === \"spark\") {\r\n      p.vx *= 0.88;\r\n      p.vy = (p.vy ?? 0) * 0.9 + 160 * delta;\r\n      p.radius *= 0.86;\r\n    } else if (p.type === \"debris\") {\r\n      p.vy += 520 * delta;\r\n      p.vx *= 0.88;\r\n      p.vy *= 0.9;\r\n      p.radius *= 0.95;\r\n    } else if (p.type === \"dust\") {\r\n      p.vx *= 0.82;\r\n      p.vy = (p.vy ?? 0) * 0.9 + 240 * delta;\r\n      p.radius *= 0.96;\r\n    } else if (p.type === \"flash\") {\r\n      p.vx *= 0.8;\r\n      p.vy *= 0.8;\r\n      p.radius *= 0.9 + life * 0.08;\r\n    } else {\r\n      p.vx *= 0.86;\r\n      p.vy *= 0.86;\r\n    }\r\n  }\r\n\r\n  for (let i = rings.length - 1; i >= 0; i -= 1) {\r\n    const ring = rings[i];\r\n    ring.ttl -= delta;\r\n    if (ring.ttl <= 0) {\r\n      rings.splice(i, 1);\r\n      continue;\r\n    }\r\n  }\r\n}\r\nfunction drawParticles() {\r\n  ensureListeners();\r\n  if (particles.length === 0 && rings.length === 0) {\r\n    return;\r\n  }\r\n\r\n  context.save();\r\n  for (const ring of rings) {\r\n    const life = clamp(ring.ttl / ring.maxTtl, 0, 1);\r\n    const progress = 1 - life;\r\n    const radius = ring.startRadius + (ring.endRadius - ring.startRadius) * progress;\r\n    context.globalAlpha = clamp(life, 0, 1) * 0.6;\r\n    context.lineWidth = ring.lineWidth;\r\n    context.strokeStyle = ring.color;\r\n    context.beginPath();\r\n    context.arc(ring.x, ring.y, radius, 0, Math.PI * 2);\r\n    context.stroke();\r\n  }\r\n\r\n  for (const particle of particles) {\r\n    const life = clamp(particle.ttl / particle.maxTtl, 0, 1);\r\n    let alpha = clamp(life, 0, 1);\r\n    if (particle.type === \"smoke\") {\r\n      alpha *= 0.55;\r\n    } else if (particle.type === \"blood\") {\r\n      alpha = 0.45 + alpha * 0.45;\r\n    } else if (particle.type === \"bloodMist\") {\r\n      alpha = 0.25 + alpha * 0.4;\r\n    } else if (particle.type === \"flash\") {\r\n      alpha = 0.35 + alpha * 0.65;\r\n    } else if (particle.type === \"spark\") {\r\n      alpha = 0.35 + alpha * 0.55;\r\n    } else if (particle.type === \"dust\") {\r\n      alpha = 0.3 + alpha * 0.4;\r\n    } else if (particle.type === \"debris\") {\r\n      alpha = 0.5 + alpha * 0.5;\r\n    }\r\n    context.globalAlpha = alpha;\r\n    context.fillStyle = particle.color;\r\n    let sizeFactor = life;\r\n    if (particle.type === \"smoke\") {\r\n      sizeFactor = 1;\r\n    } else if (particle.type === \"blood\") {\r\n      sizeFactor = 0.7 + life * 0.4;\r\n    } else if (particle.type === \"bloodMist\") {\r\n      sizeFactor = 1;\r\n    } else if (particle.type === \"spark\") {\r\n      sizeFactor = 0.5 + life * 0.5;\r\n    } else if (particle.type === \"dust\") {\r\n      sizeFactor = 0.8 + life * 0.3;\r\n    } else if (particle.type === \"debris\") {\r\n      sizeFactor = 0.6 + life * 0.4;\r\n    }\r\n    const radius = Math.max(1.2, particle.radius * sizeFactor);\r\n    context.beginPath();\r\n    context.arc(particle.x, particle.y, radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport { spawnBloodSpray, spawnImpactSparks, spawnImpactDust, spawnGroundDust, spawnExplosionParticles, spawnExplosionDebris, spawnDestructibleHitParticles, spawnSmokePuffs, spawnSmokeDissipateRing, spawnRingBurst, updateParticles, drawParticles };\r\n\r\n\r\n","import { canvas, GROUND_Y, context } from \"../../environment/canvas.js\";\r\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { stickman, trainingDummy, enemies, getTotalHeight } from \"../../state/entities.js\";\r\nimport { spawnProjectile } from \"../combat/projectiles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst turrets = [];\r\n\r\nfunction createTurret(config, facing) {\r\n  const height = config.height ?? 54;\r\n  const spawnOffset = config.spawnOffset ?? { x: 64, y: 0 };\r\n  const baseHeight = getTotalHeight(stickman.currentPose ?? null) || 0;\r\n  const envWidth = getEnvironmentWidth();\r\n  const spawnX = clamp(stickman.x + facing * (spawnOffset.x ?? 64), 40, envWidth - 40);\r\n  const spawnYBase = stickman.y + baseHeight;\r\n  const spawnY = Math.min(spawnYBase + (spawnOffset.y ?? 0), GROUND_Y);\r\n  const y = Math.min(GROUND_Y - height, spawnY - height);\r\n\r\n  return {\r\n    id: `turret-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`,\r\n    x: spawnX,\r\n    y,\r\n    height,\r\n    facing,\r\n    range: config.range ?? 260,\r\n    fireInterval: Math.max(0.1, config.fireInterval ?? 0.6),\r\n    fireTimer: 0.1,\r\n    duration: config.duration ?? 8,\r\n    maxDuration: config.duration ?? 8,\r\n    projectile: {\r\n      speed: config.projectile?.speed ?? 520,\r\n      radius: config.projectile?.radius ?? 5,\r\n      damage: config.projectile?.damage ?? 10,\r\n      knockback: config.projectile?.knockback ?? 70,\r\n      lifetime: config.projectile?.lifetime ?? 1.1,\r\n      color: config.projectile?.color ?? \"#9ae9ff\"\r\n    },\r\n    baseColor: config.baseColor ?? \"#7a8bff\",\r\n    headColor: config.headColor ?? \"#cfd8ff\"\r\n  };\r\n}\r\n\r\nfunction deployTurret(config) {\r\n  const facing = stickman.facing || 1;\r\n  const turret = createTurret(config, facing);\r\n  const maxActive = Math.max(1, config.maxActive ?? 1);\r\n  if (turrets.length >= maxActive) {\r\n    turrets.shift();\r\n  }\r\n  turrets.push(turret);\r\n}\r\n\r\nfunction getTargets() {\r\n  const targets = [];\r\n  if (trainingDummy.health > 0) {\r\n    targets.push({\r\n      id: trainingDummy.id,\r\n      x: trainingDummy.x,\r\n      y: trainingDummy.y + trainingDummy.height * 0.5\r\n    });\r\n  }\r\n  for (const enemy of enemies) {\r\n    if (enemy.health > 0) {\r\n      targets.push({\r\n        id: enemy.id,\r\n        x: enemy.x,\r\n        y: enemy.y + enemy.height * 0.5,\r\n        ref: enemy\r\n      });\r\n    }\r\n  }\r\n  return targets;\r\n}\r\n\r\nfunction acquireTarget(turret) {\r\n  const targets = getTargets();\r\n  let closest = null;\r\n  let closestDistSq = Infinity;\r\n  for (const target of targets) {\r\n    const dx = target.x - turret.x;\r\n    const dy = target.y - (turret.y + turret.height * 0.4);\r\n    const distSq = dx * dx + dy * dy;\r\n    if (distSq <= turret.range * turret.range && distSq < closestDistSq) {\r\n      closest = target;\r\n      closestDistSq = distSq;\r\n    }\r\n  }\r\n  return closest;\r\n}\r\n\r\nfunction fireTurret(turret, target) {\r\n  const originX = turret.x;\r\n  const originY = turret.y + turret.height * 0.35;\r\n  const dx = target.x - originX;\r\n  const dy = target.y - originY;\r\n  turret.facing = Math.sign(dx) || turret.facing;\r\n  const distance = Math.hypot(dx, dy) || 1;\r\n  const speed = turret.projectile.speed;\r\n  const vx = (dx / distance) * speed;\r\n  const vy = (dy / distance) * speed;\r\n  spawnProjectile({\r\n    x: originX,\r\n    y: originY,\r\n    vx,\r\n    vy,\r\n    radius: turret.projectile.radius,\r\n    lifetime: turret.projectile.lifetime,\r\n    color: turret.projectile.color,\r\n    damage: turret.projectile.damage,\r\n    knockback: turret.projectile.knockback,\r\n    facing: Math.sign(vx) || 1,\r\n    gravityFactor: 0\r\n  });\r\n  turret.fireTimer = turret.fireInterval;\r\n}\r\n\r\nfunction updateTurrets(delta) {\r\n  for (const turret of turrets) {\r\n    turret.duration -= delta;\r\n    turret.fireTimer -= delta;\r\n    const target = acquireTarget(turret);\r\n    if (target && turret.fireTimer <= 0) {\r\n      fireTurret(turret, target);\r\n    }\r\n  }\r\n  for (let i = turrets.length - 1; i >= 0; i -= 1) {\r\n    if (turrets[i].duration <= 0) {\r\n      turrets.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawTurrets() {\r\n  if (turrets.length === 0) {\r\n    return;\r\n  }\r\n  context.save();\r\n  for (const turret of turrets) {\r\n    const baseWidth = 40;\r\n    const baseHeight = turret.height * 0.4;\r\n    const remainingRatio = clamp(turret.duration / (turret.maxDuration || 1), 0, 1);\r\n    context.fillStyle = turret.baseColor;\r\n    context.fillRect(turret.x - baseWidth * 0.5, turret.y + turret.height - baseHeight, baseWidth, baseHeight);\r\n\r\n    const headHeight = turret.height * 0.6;\r\n    context.fillStyle = turret.headColor;\r\n    context.fillRect(turret.x - baseWidth * 0.3, turret.y, baseWidth * 0.6, headHeight);\r\n\r\n    context.fillStyle = \"#ffd66d\";\r\n    context.fillRect(turret.x - baseWidth * 0.3, turret.y - 6, baseWidth * 0.6 * remainingRatio, 4);\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction clearTurrets() {\r\n  turrets.length = 0;\r\n}\r\n\r\nfunction getTurretCount() {\r\n  return turrets.length;\r\n}\r\n\r\nexport { turrets, deployTurret, updateTurrets, drawTurrets, clearTurrets, getTurretCount };\r\n\r\n","import { canvas, GROUND_Y, context } from \"../../environment/canvas.js\";\r\nimport { stickman } from \"../../state/entities.js\";\r\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst grappleState = {\r\n  active: false,\r\n  tetherLength: 0,\r\n  maxLength: 0,\r\n  targetX: 0,\r\n  targetY: 0,\r\n  duration: 0,\r\n  retracting: false,\r\n  cooldown: 0,\r\n  color: \"#8cf1ff\",\r\n  travelSpeed: 860,\r\n  pullSpeed: 740\r\n};\r\n\r\nfunction canGrapple(config) {\r\n  if (grappleState.active) {\r\n    return false;\r\n  }\r\n  if ((stickman.gadgetCooldown ?? 0) > 0) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction startGrapple(config) {\r\n  const envWidth = getEnvironmentWidth();\r\n  const clampRect = config.clamp ?? { left: 80, right: envWidth - 80 };\r\n  const apex = config.apex ?? { y: GROUND_Y - 280 };\r\n  const launchLength = config.maxLength ?? 320;\r\n  const facing = stickman.facing || 1;\r\n  const anchorX = clamp(stickman.x + facing * launchLength, clampRect.left, clampRect.right);\r\n  const anchorY = Math.min(apex.y ?? (GROUND_Y - 240), stickman.y - (config.maxRise ?? 260));\r\n\r\n  grappleState.active = true;\r\n  grappleState.retracting = false;\r\n  grappleState.tetherLength = 0;\r\n  grappleState.maxLength = Math.hypot(anchorX - stickman.x, anchorY - stickman.y);\r\n  grappleState.targetX = anchorX;\r\n  grappleState.targetY = anchorY;\r\n  grappleState.duration = config.duration ?? 0.65;\r\n  grappleState.cooldown = config.cooldownSeconds ?? 1.6;\r\n  grappleState.color = config.color ?? \"#8cf1ff\";\r\n  grappleState.travelSpeed = config.travelSpeed ?? 860;\r\n  grappleState.pullSpeed = config.pullSpeed ?? 740;\r\n  stickman.gadgetCooldown = grappleState.cooldown;\r\n}\r\n\r\nfunction updateGrapple(delta) {\r\n  if (!grappleState.active) {\r\n    return;\r\n  }\r\n\r\n  const travelSpeed = grappleState.travelSpeed ?? 860;\r\n  const pullSpeed = grappleState.pullSpeed ?? 740;\r\n  const progressSpeed = (grappleState.retracting ? pullSpeed : travelSpeed) * delta;\r\n\r\n  if (!grappleState.retracting) {\r\n    grappleState.tetherLength += progressSpeed;\r\n    if (grappleState.tetherLength >= grappleState.maxLength) {\r\n      grappleState.tetherLength = grappleState.maxLength;\r\n      grappleState.retracting = true;\r\n    }\r\n  } else {\r\n    grappleState.duration -= delta;\r\n    const dx = grappleState.targetX - stickman.x;\r\n    const dy = grappleState.targetY - stickman.y;\r\n    const distance = Math.hypot(dx, dy);\r\n\r\n    if (distance > 12) {\r\n      const step = Math.min(distance, pullSpeed * delta);\r\n      stickman.vx = (dx / distance) * step / delta;\r\n      stickman.vy = (dy / distance) * step / delta;\r\n      stickman.x += (dx / distance) * step;\r\n      stickman.y += (dy / distance) * step;\r\n    }\r\n\r\n    grappleState.tetherLength = Math.max(0, grappleState.tetherLength - progressSpeed);\r\n    if (grappleState.duration <= 0 || grappleState.tetherLength <= 0) {\r\n      endGrapple();\r\n    }\r\n  }\r\n}\r\n\r\nfunction endGrapple() {\r\n  grappleState.active = false;\r\n  grappleState.retracting = false;\r\n  grappleState.tetherLength = 0;\r\n  grappleState.maxLength = 0;\r\n}\r\n\r\nfunction clearGrapple() {\r\n  endGrapple();\r\n}\r\n\r\nfunction updateGrappleState(delta) {\r\n  if (grappleState.cooldown > 0) {\r\n    grappleState.cooldown = Math.max(0, grappleState.cooldown - delta);\r\n  }\r\n  updateGrapple(delta);\r\n}\r\n\r\nfunction drawGrapple() {\r\n  if (!grappleState.active) {\r\n    return;\r\n  }\r\n  context.save();\r\n  context.strokeStyle = grappleState.color;\r\n  context.lineWidth = 3;\r\n  context.beginPath();\r\n  context.moveTo(stickman.x, stickman.y);\r\n  const ratio = grappleState.tetherLength / (grappleState.maxLength || 1);\r\n  const currentX = stickman.x + (grappleState.targetX - stickman.x) * ratio;\r\n  const currentY = stickman.y + (grappleState.targetY - stickman.y) * ratio;\r\n  context.lineTo(currentX, currentY);\r\n  context.stroke();\r\n  context.restore();\r\n}\r\n\r\nfunction hasActiveGrapple() {\r\n  return grappleState.active;\r\n}\r\n\r\nexport { canGrapple, startGrapple, updateGrappleState, drawGrapple, hasActiveGrapple, clearGrapple };\r\n\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { stickman } from \"../../state/entities.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst shieldState = {\r\n  active: false,\r\n  strength: 0,\r\n  maxStrength: 0,\r\n  duration: 0,\r\n  maxDuration: 0,\r\n  radius: 90,\r\n  color: \"#7cd6ff\",\r\n  flashTimer: 0\r\n};\r\n\r\nfunction getShieldCenter() {\r\n  const poseHeight = (stickman.currentPose?.headRadius ?? 16) * 2 + (stickman.currentPose?.bodyLength ?? 34) + (stickman.currentPose?.legLength ?? 36);\r\n  return {\r\n    x: stickman.x,\r\n    y: stickman.y + poseHeight * 0.5\r\n  };\r\n}\r\n\r\nfunction dispatchShieldEvent(type, detail = {}) {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.dispatchEvent(new CustomEvent(type, { detail }));\r\n}\r\n\r\nfunction activateShield(config = {}) {\r\n  const strength = config.strength ?? 90;\r\n  if (shieldState.active) {\r\n    return false;\r\n  }\r\n  shieldState.active = true;\r\n  shieldState.strength = strength;\r\n  shieldState.maxStrength = strength;\r\n  shieldState.duration = config.duration ?? 6;\r\n  shieldState.maxDuration = shieldState.duration;\r\n  shieldState.radius = config.radius ?? 96;\r\n  shieldState.color = config.color ?? \"#7cd6ff\";\r\n  shieldState.flashTimer = 0;\r\n  stickman.gadgetCooldown = config.cooldownSeconds ?? 4.5;\r\n  return true;\r\n}\r\n\r\nfunction updateShield(delta) {\r\n  if (!shieldState.active) {\r\n    return;\r\n  }\r\n  shieldState.duration -= delta;\r\n  shieldState.flashTimer = Math.max(0, shieldState.flashTimer - delta);\r\n  if (shieldState.duration <= 0) {\r\n    deactivateShield(\"expired\");\r\n  } else if (shieldState.strength <= 0) {\r\n    const center = getShieldCenter();\r\n    dispatchShieldEvent(\"shield:shatter\", {\r\n      reason: \"decayed\",\r\n      center,\r\n      maxStrength: shieldState.maxStrength,\r\n      radius: shieldState.radius,\r\n    });\r\n    deactivateShield(\"shatter\");\r\n  }\r\n}\r\n\r\nfunction deactivateShield(reason = \"expired\") {\r\n  if (!shieldState.active) {\r\n    return;\r\n  }\r\n  const detail = {\r\n    reason,\r\n    remainingStrength: shieldState.strength,\r\n    maxStrength: shieldState.maxStrength,\r\n    duration: shieldState.duration,\r\n    maxDuration: shieldState.maxDuration,\r\n    center: getShieldCenter(),\r\n    radius: shieldState.radius\r\n  };\r\n  shieldState.active = false;\r\n  shieldState.strength = 0;\r\n  shieldState.duration = 0;\r\n  shieldState.flashTimer = 0;\r\n  dispatchShieldEvent(\"shield:end\", detail);\r\n}\r\n\r\nfunction absorbShieldHit(hit) {\r\n  if (!shieldState.active) {\r\n    return hit;\r\n  }\r\n  const damage = hit.damage ?? 0;\r\n  if (damage <= 0) {\r\n    return hit;\r\n  }\r\n  const absorb = Math.min(damage, shieldState.strength);\r\n  shieldState.strength -= absorb;\r\n  shieldState.flashTimer = Math.max(shieldState.flashTimer, 0.2);\r\n\r\n  const center = getShieldCenter();\r\n  dispatchShieldEvent(\"shield:hit\", {\r\n    absorb,\r\n    remainingStrength: Math.max(0, shieldState.strength),\r\n    maxStrength: shieldState.maxStrength,\r\n    duration: shieldState.duration,\r\n    maxDuration: shieldState.maxDuration,\r\n    center,\r\n    radius: shieldState.radius,\r\n  });\r\n\r\n  const residualDamage = damage - absorb;\r\n  const result = {\r\n    ...hit,\r\n    damage: residualDamage\r\n  };\r\n  if (residualDamage <= 0) {\r\n    result.damage = 0;\r\n    result.knockback = (hit.knockback ?? 0) * 0.25;\r\n    result.launch = (hit.launch ?? 0) * 0.25;\r\n  }\r\n  if (shieldState.strength <= 0) {\r\n    dispatchShieldEvent(\"shield:shatter\", {\r\n      reason: \"damage\",\r\n      absorb,\r\n      center,\r\n      maxStrength: shieldState.maxStrength,\r\n      radius: shieldState.radius\r\n    });\r\n    deactivateShield(\"shatter\");\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction drawShield() {\r\n  if (!shieldState.active) {\r\n    return;\r\n  }\r\n  context.save();\r\n  const alpha = clamp(shieldState.flashTimer > 0 ? 0.45 : 0.25 + shieldState.strength / Math.max(1, shieldState.maxStrength) * 0.35, 0.15, 0.6);\r\n  context.strokeStyle = shieldState.color;\r\n  context.lineWidth = 4;\r\n  context.globalAlpha = alpha;\r\n  context.beginPath();\r\n  const center = getShieldCenter();\r\n  context.arc(center.x, center.y, shieldState.radius, 0, Math.PI * 2);\r\n  context.stroke();\r\n  context.globalAlpha = alpha * 0.4;\r\n  context.fillStyle = shieldState.color;\r\n  context.beginPath();\r\n  context.arc(center.x, center.y, shieldState.radius * 0.9, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction clearShield() {\r\n  deactivateShield(\"cleared\");\r\n}\r\n\r\nfunction getShieldStatus() {\r\n  return {\r\n    active: shieldState.active,\r\n    strength: shieldState.strength,\r\n    maxStrength: shieldState.maxStrength,\r\n    duration: shieldState.duration,\r\n    maxDuration: shieldState.maxDuration\r\n  };\r\n}\r\n\r\nexport { activateShield, updateShield, drawShield, clearShield, absorbShieldHit, getShieldStatus };\r\n\r\n","import { stickman } from \"../../state/entities.js\";\r\nimport { deployTurret, updateTurrets, drawTurrets, clearTurrets, getTurretCount } from \"./turret.js\";\r\nimport { canGrapple, startGrapple, updateGrappleState, drawGrapple, hasActiveGrapple, clearGrapple } from \"./grapple.js\";\r\nimport { activateShield, updateShield, drawShield, clearShield, absorbShieldHit, getShieldStatus } from \"./shield.js\";\r\n\r\nfunction deployGadget(weapon) {\r\n  const gadgetConfig = weapon?.gadget;\r\n  if (!gadgetConfig) {\r\n    return false;\r\n  }\r\n  const cooldown = stickman.gadgetCooldown ?? 0;\r\n  if (cooldown > 0) {\r\n    return false;\r\n  }\r\n\r\n  const type = gadgetConfig.type ?? \"turret\";\r\n  switch (type) {\r\n    case \"turret\":\r\n      deployTurret(gadgetConfig);\r\n      stickman.gadgetCooldown = gadgetConfig.cooldownSeconds ?? 2.5;\r\n      return true;\r\n    case \"grapple\":\r\n      if (!canGrapple(gadgetConfig)) {\r\n        return false;\r\n      }\r\n      startGrapple(gadgetConfig);\r\n      return true;\r\n    case \"shield\":\r\n      activateShield(gadgetConfig);\r\n      return true;\r\n    default:\r\n      return false;\r\n  }\r\n}\r\n\r\nfunction updateGadgets(delta) {\r\n  updateTurrets(delta);\r\n  updateShield(delta);\r\n}\r\n\r\nfunction updateGadgetMovement(delta) {\r\n  updateGrappleState(delta);\r\n}\r\n\r\nfunction drawGadgets() {\r\n  drawShield();\r\n  drawTurrets();\r\n  drawGrapple();\r\n}\r\n\r\nfunction clearGadgets() {\r\n  clearTurrets();\r\n  clearShield();\r\n  clearGrapple();\r\n}\r\n\r\nfunction getGadgetStatus() {\r\n  const shield = getShieldStatus();\r\n  return {\r\n    turretCount: getTurretCount(),\r\n    grappleActive: hasActiveGrapple(),\r\n    shieldActive: shield.active,\r\n    shieldStrength: shield.strength,\r\n    shieldMaxStrength: shield.maxStrength,\r\n    gadgetCooldown: stickman.gadgetCooldown ?? 0\r\n  };\r\n}\r\n\r\nexport { deployGadget, updateGadgets, updateGadgetMovement, drawGadgets, clearGadgets, getGadgetStatus, absorbShieldHit };\r\n","import { enemies, createGruntEnemy } from \"../../state/entities.js\";\r\nimport { ENEMY_SPAWN_SETTINGS } from \"../../config/spawn.js\";\r\nimport { getEnvironmentWidth, getEnvironmentSpawnSettings } from \"../../state/environment.js\";\r\nimport { getScenarioSpawnOverride } from \"../scenario/index.js\";\r\n\r\nfunction resolveSpawnPoints() {\r\n  const envWidth = getEnvironmentWidth();\r\n  const spawnSettings = getEnvironmentSpawnSettings();\r\n  const points = Array.isArray(spawnSettings?.enemies) ? spawnSettings.enemies.slice(0, 2) : [];\r\n  if (points.length >= 2) {\r\n    return points;\r\n  }\r\n  const left = envWidth * 0.25;\r\n  const right = envWidth * 0.75;\r\n  return [left, right];\r\n}\r\n\r\nfunction spawnEnemies(count, options = {}) {\r\n  const contextTag = options.context ?? \"sandbox\";\r\n  const autoRespawn = options.autoRespawn ?? contextTag !== \"survival\";\r\n  const override = getScenarioSpawnOverride();\r\n  const overridePoints = override && Array.isArray(override.points) && override.points.length >= 2 && (!override.context || override.context === contextTag)\r\n    ? override.points\r\n    : null;\r\n  const spawnPoints = overridePoints ?? resolveSpawnPoints();\r\n  const maxActive = Math.min(spawnPoints.length, ENEMY_SPAWN_SETTINGS.maxCount);\r\n  let spawned = 0;\r\n\r\n  for (let sideIndex = 0; sideIndex < spawnPoints.length; sideIndex += 1) {\r\n    if (spawned >= count || enemies.length >= ENEMY_SPAWN_SETTINGS.maxCount) {\r\n      break;\r\n    }\r\n    if (contextTag === \"survival\") {\r\n      const hasAlive = enemies.some(\r\n        (enemy) => enemy.spawnContext === \"survival\" && enemy.spawnSide === sideIndex && enemy.health > 0\r\n      );\r\n      if (hasAlive) {\r\n        continue;\r\n      }\r\n    }\r\n    const spawnX = spawnPoints[sideIndex];\r\n    const enemy = createGruntEnemy(spawnX, {\r\n      context: contextTag,\r\n      autoRespawn,\r\n      spawnSide: sideIndex,\r\n      facing: sideIndex === 0 ? 1 : -1\r\n    });\r\n    enemy.spawnX = spawnX;\r\n    enemy.spawnY = enemy.y;\r\n    enemy.respawnTimer = 0;\r\n    enemies.push(enemy);\r\n    spawned += 1;\r\n    if (spawned >= maxActive) {\r\n      break;\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateEnemySpawner() {}\r\n\r\nexport { updateEnemySpawner, spawnEnemies };\r\n","const ENEMY_SPAWN_SETTINGS = {\n  minCount: 2,\n  maxCount: 2,\n  spawnBatch: 1,\n  spawnInterval: 2.2,\n  spawnPadding: 80\n};\n\nexport { ENEMY_SPAWN_SETTINGS };\r\n\r\n","import { SURVIVAL_SETTINGS } from \"../../config/survival.js\";\nimport {\n  getSurvivalState,\n  beginSurvivalCountdown,\n  setSurvivalActive,\n  setSurvivalStage,\n  incrementSurvivalWave,\n  setSurvivalTimer,\n  setSurvivalEnemiesAlive,\n  setSurvivalLastReward,\n  addSurvivalImmediateReward,\n  setSurvivalLastOutcome,\n  resetSurvivalState,\n  isSurvivalActive\n} from \"../../state/survival.js\";\nimport { spawnEnemies } from \"../world/enemySpawner.js\";\nimport { stickman, enemies, removeSandboxEnemies, restoreSandboxEnemies } from \"../../state/entities.js\";\nimport { addMaterials } from \"../../state/resources.js\";\nimport { input } from \"../input/index.js\";\n\nconst SURVIVAL_CONTEXT = \"survival\";\n\nfunction healStickmanForSurvival() {\n  const percent = Math.max(0, Math.min(1, SURVIVAL_SETTINGS.reviveHealthPercent ?? 1));\n  const targetHealth = Math.round(stickman.maxHealth * (percent || 1));\n  stickman.health = Math.max(stickman.health, targetHealth);\n  if (stickman.health <= 0) {\n    stickman.health = Math.max(1, targetHealth || stickman.maxHealth);\n  }\n  stickman.deadTimer = 0;\n  stickman.invulnerability = Math.max(stickman.invulnerability, 0.6);\n}\n\nfunction clearSurvivalEnemies() {\n  for (let i = enemies.length - 1; i >= 0; i -= 1) {\n    if (enemies[i].spawnContext === SURVIVAL_CONTEXT) {\n      enemies.splice(i, 1);\n    }\n  }\n}\n\nfunction startSurvival() {\n  removeSandboxEnemies();\n  clearSurvivalEnemies();\n  healStickmanForSurvival();\n  beginSurvivalCountdown();\n  setSurvivalLastOutcome(null);\n}\n\nfunction endSurvivalRun(outcome, { stage = \"inactive\", timer = 0 } = {}) {\n  setSurvivalActive(false);\n  setSurvivalStage(stage, timer);\n  setSurvivalLastOutcome(outcome);\n  setSurvivalEnemiesAlive(0);\n  clearSurvivalEnemies();\n  restoreSandboxEnemies();\n}\n\nfunction applySurvivalScaling(enemy, wave) {\n  const baseStats = enemy.baseStats ?? {};\n  const baseHealth = baseStats.maxHealth ?? enemy.maxHealth ?? 120;\n  const baseDamage = baseStats.attackDamage ?? enemy.attackDamage ?? 12;\n  const baseMove = baseStats.moveSpeed ?? enemy.moveSpeed ?? 160;\n\n  const waveIndex = Math.max(0, wave - 1);\n  const healthMultiplier = 1 + waveIndex * (SURVIVAL_SETTINGS.healthMultiplierPerWave ?? 0);\n  const damageMultiplier = 1 + waveIndex * (SURVIVAL_SETTINGS.damageMultiplierPerWave ?? 0);\n  const speedMultiplier = 1 + waveIndex * (SURVIVAL_SETTINGS.speedMultiplierPerWave ?? 0);\n\n  enemy.maxHealth = Math.round(baseHealth * healthMultiplier);\n  enemy.health = enemy.maxHealth;\n  enemy.attackDamage = Math.round(baseDamage * damageMultiplier);\n  enemy.moveSpeed = baseMove * speedMultiplier;\n  enemy.attackKnockback = Math.round(enemy.attackKnockback * (1 + waveIndex * 0.05));\n  enemy.survivalWave = wave;\n}\n\nfunction spawnSurvivalEnemies(requested, wave) {\n  if (requested <= 0) {\n    return;\n  }\n  const previousIds = new Set(\n    enemies.filter((enemy) => enemy.spawnContext === SURVIVAL_CONTEXT).map((enemy) => enemy.id)\n  );\n  spawnEnemies(requested, { context: SURVIVAL_CONTEXT, autoRespawn: false });\n  for (const enemy of enemies) {\n    if (enemy.spawnContext !== SURVIVAL_CONTEXT || previousIds.has(enemy.id)) {\n      continue;\n    }\n    applySurvivalScaling(enemy, wave);\n  }\n}\n\nfunction grantWaveRewards(wave, reward) {\n  if (reward > 0) {\n    addMaterials(reward);\n    setSurvivalLastReward(reward);\n  } else {\n    setSurvivalLastReward(0);\n  }\n  const bestWaveBonus = SURVIVAL_SETTINGS.bestWaveBonus ?? 0;\n  if (bestWaveBonus > 0) {\n    const state = getSurvivalState();\n    if (state.bestWave === wave) {\n      addMaterials(bestWaveBonus);\n      addSurvivalImmediateReward(bestWaveBonus);\n    }\n  }\n}\n\nfunction handleSurvivalDefeat() {\n  const hold = Math.max(0, SURVIVAL_SETTINGS.defeatCooldown ?? 0);\n  endSurvivalRun(\"defeat\", { stage: \"defeat\", timer: hold });\n}\n\nfunction updateSurvival(delta) {\n  const state = getSurvivalState();\n\n  if (input.survivalToggleBuffered) {\n    input.survivalToggleBuffered = false;\n    if (state.active) {\n      endSurvivalRun(\"aborted\");\n    } else {\n      startSurvival();\n    }\n  }\n\n  if (!state.active && state.stage === \"defeat\") {\n    setSurvivalTimer(Math.max(0, state.timer - delta));\n    if (state.timer <= 0) {\n      setSurvivalStage(\"inactive\", 0);\n    }\n    return;\n  }\n\n  if (!state.active) {\n    return;\n  }\n\n  setSurvivalTimer(Math.max(0, state.timer - delta));\n\n  for (let i = enemies.length - 1; i >= 0; i -= 1) {\n    const enemy = enemies[i];\n    if (enemy.spawnContext === SURVIVAL_CONTEXT && enemy.health <= 0 && enemy.autoRespawn === false) {\n      enemies.splice(i, 1);\n    }\n  }\n\n  const alive = enemies.reduce(\n    (count, enemy) => count + (enemy.spawnContext === SURVIVAL_CONTEXT && enemy.health > 0 ? 1 : 0),\n    0\n  );\n  setSurvivalEnemiesAlive(alive);\n\n  if (stickman.health <= 0) {\n    handleSurvivalDefeat();\n    return;\n  }\n\n  switch (state.stage) {\n    case \"countdown\": {\n      if (state.timer <= 0) {\n        incrementSurvivalWave();\n        const desired = SURVIVAL_SETTINGS.baseEnemies + (state.wave - 1) * (SURVIVAL_SETTINGS.enemiesPerWave ?? 0);\n        const cap = SURVIVAL_SETTINGS.enemyCap ?? desired;\n        const toSpawn = Math.max(0, Math.min(desired, cap));\n        spawnSurvivalEnemies(toSpawn, state.wave);\n        setSurvivalStage(\"wave\", 0);\n      }\n      break;\n    }\n    case \"wave\": {\n      if (alive === 0) {\n        const reward = SURVIVAL_SETTINGS.waveReward + (state.wave - 1) * (SURVIVAL_SETTINGS.rewardIncrement ?? 0);\n        grantWaveRewards(state.wave, reward);\n        setSurvivalStage(\"rest\", SURVIVAL_SETTINGS.restDuration ?? 8);\n      } else {\n        const desired = SURVIVAL_SETTINGS.baseEnemies + (state.wave - 1) * (SURVIVAL_SETTINGS.enemiesPerWave ?? 0);\n        const cap = SURVIVAL_SETTINGS.enemyCap ?? desired;\n        const missing = Math.max(0, Math.min(desired, cap) - alive);\n        if (missing > 0) {\n          spawnSurvivalEnemies(missing, state.wave);\n        }\n      }\n      break;\n    }\n    case \"rest\": {\n      if (state.timer <= 0) {\n        setSurvivalStage(\"countdown\", SURVIVAL_SETTINGS.countdownDuration ?? 4);\n      }\n      break;\n    }\n    default:\n      break;\n  }\n}\n\nfunction getSurvivalHudStatus() {\n  const state = getSurvivalState();\n  return {\n    active: state.active,\n    stage: state.stage,\n    timer: state.timer,\n    wave: state.wave,\n    enemiesAlive: state.enemiesAlive,\n    lastReward: state.lastReward,\n    kills: state.kills,\n    runReward: state.runReward,\n    bestWave: state.bestWave,\n    bestKills: state.bestKills,\n    bestReward: state.bestReward,\n    lastOutcome: state.lastOutcome\n  };\n}\n\nfunction resetSurvival() {\n  endSurvivalRun(\"reset\");\n  resetSurvivalState({ preserveStats: true });\n}\n\nexport { updateSurvival, getSurvivalHudStatus, isSurvivalActive, resetSurvival };\r\n","const CAMPAIGN_SETTINGS = {\n  briefingDuration: 4,\n  successHoldDuration: 6,\n  failureHoldDuration: 5,\n  betweenMissionsDelay: 4,\n  startKeyLabel: \"Q\"\n};\n\nconst CAMPAIGN_MISSIONS = [\n  {\n    id: \"neo-break-line\",\n    name: \"Break the Line\",\n    environmentId: \"neoDistrict\",\n    description: \"Push hostile raiders out of the plaza and secure the street.\",\n    briefing: \"Command wants the plaza cleared. Sweep through and eliminate the raiders.\",\n    objective: {\n      type: \"eliminate\",\n      label: \"Neutralize raider squads\",\n      target: 4\n    },\n    spawn: {\n      batchSize: 2,\n      replenishDelay: 3.2,\n      autoRespawn: false\n    },\n    rewards: {\n      materials: 60\n    },\n    successMessage: \"Plaza secured. Supply convoy rolling in.\",\n    failureMessage: \"Raiders regained ground; rally and try again.\"\n  },\n  {\n    id: \"verdant-holdout\",\n    name: \"Hold the Ridge\",\n    environmentId: \"verdantWilds\",\n    description: \"Hold the ridge until evac arrives and keep the squad alive.\",\n    briefing: \"Allied transports are inbound. Hold the ridge until they arrive.\",\n    objective: {\n      type: \"survive\",\n      label: \"Hold position until evac arrives\",\n      duration: 45\n    },\n    spawn: {\n      batchSize: 2,\n      replenishDelay: 2.4,\n      autoRespawn: true\n    },\n    rewards: {\n      materials: 90\n    },\n    successMessage: \"Evac transports secured the ridge. Nice hold.\",\n    failureMessage: \"The ridge fell before evac arrived. They need you back in the fight.\"\n  },\n  {\n    id: \"orbital-insertion\",\n    name: \"Orbital Insertion\",\n    environmentId: \"orbitalSpire\",\n    description: \"Clear the orbital spire landing pads and neutralize the security teams guarding them.\",\n    briefing: \"The spire lifts are jammed. Clear the pads so the boarding teams can land.\",\n    objective: {\n      type: \"eliminate\",\n      label: \"Disable spire security\",\n      target: 6\n    },\n    spawn: {\n      batchSize: 2,\n      replenishDelay: 2.8,\n      autoRespawn: false\n    },\n    rewards: {\n      materials: 120\n    },\n    successMessage: \"Landing pads clear. Boarding teams inbound.\",\n    failureMessage: \"Security sealed the spire. Regroup for another push.\"\n  }\n];\n\nexport { CAMPAIGN_MISSIONS, CAMPAIGN_SETTINGS };\r\n","import { CAMPAIGN_MISSIONS, CAMPAIGN_SETTINGS } from \"../config/campaign.js\";\n\nfunction createDefaultObjective() {\n  return {\n    type: \"none\",\n    label: \"\",\n    target: 0,\n    progress: 0,\n    duration: 0,\n    remaining: 0\n  };\n}\n\nfunction createDefaultSpawn() {\n  return {\n    batchSize: 0,\n    replenishDelay: 0,\n    autoRespawn: false,\n    cooldown: 0\n  };\n}\n\nconst campaignState = {\n  active: false,\n  stage: \"inactive\",\n  missionIndex: -1,\n  missionId: null,\n  completedMissions: 0,\n  totalMissions: CAMPAIGN_MISSIONS.length,\n  message: \"\",\n  stageTimer: 0,\n  objective: createDefaultObjective(),\n  spawn: createDefaultSpawn(),\n  rewards: {},\n  successMessage: \"Mission complete.\",\n  failureMessage: \"Mission failed.\",\n  briefing: \"\",\n  environmentId: null,\n  lastOutcome: null\n};\n\nfunction resetCampaignState() {\n  campaignState.active = false;\n  campaignState.stage = \"inactive\";\n  campaignState.missionIndex = -1;\n  campaignState.missionId = null;\n  campaignState.completedMissions = 0;\n  campaignState.message = \"\";\n  campaignState.stageTimer = 0;\n  campaignState.objective = createDefaultObjective();\n  campaignState.spawn = createDefaultSpawn();\n  campaignState.rewards = {};\n  campaignState.successMessage = \"Mission complete.\";\n  campaignState.failureMessage = \"Mission failed.\";\n  campaignState.briefing = \"\";\n  campaignState.environmentId = null;\n  campaignState.lastOutcome = null;\n}\n\nfunction getCampaignState() {\n  return campaignState;\n}\n\nfunction getCampaignMissionDefinition(index = campaignState.missionIndex) {\n  if (index < 0 || index >= CAMPAIGN_MISSIONS.length) {\n    return null;\n  }\n  return CAMPAIGN_MISSIONS[index];\n}\n\nfunction getCampaignMissions() {\n  return CAMPAIGN_MISSIONS;\n}\n\nfunction setCampaignActive(active) {\n  campaignState.active = Boolean(active);\n}\n\nfunction setCampaignStage(stage, timer = 0) {\n  campaignState.stage = stage;\n  campaignState.stageTimer = Math.max(0, timer ?? 0);\n}\n\nfunction setCampaignStageTimer(timer) {\n  campaignState.stageTimer = Math.max(0, timer ?? 0);\n}\n\nfunction decrementCampaignStageTimer(delta) {\n  campaignState.stageTimer = Math.max(0, campaignState.stageTimer - delta);\n}\n\nfunction configureCampaignMission(index) {\n  const mission = getCampaignMissionDefinition(index);\n  if (!mission) {\n    return null;\n  }\n  campaignState.missionIndex = index;\n  campaignState.missionId = mission.id;\n  campaignState.environmentId = mission.environmentId ?? null;\n  campaignState.objective = {\n    type: mission.objective?.type ?? \"none\",\n    label: mission.objective?.label ?? \"\",\n    target: Math.max(0, Math.floor(mission.objective?.target ?? mission.objective?.duration ?? 0)),\n    progress: 0,\n    duration: Math.max(0, mission.objective?.duration ?? 0),\n    remaining: Math.max(0, mission.objective?.duration ?? 0)\n  };\n  campaignState.spawn = {\n    batchSize: Math.max(0, Math.floor(mission.spawn?.batchSize ?? 0)),\n    replenishDelay: Math.max(0, mission.spawn?.replenishDelay ?? 0),\n    autoRespawn: Boolean(mission.spawn?.autoRespawn),\n    cooldown: 0\n  };\n  campaignState.rewards = mission.rewards ?? {};\n  campaignState.successMessage = mission.successMessage ?? \"Mission complete.\";\n  campaignState.failureMessage = mission.failureMessage ?? \"Mission failed.\";\n  campaignState.briefing = mission.briefing ?? mission.description ?? \"\";\n  campaignState.message = campaignState.briefing;\n  campaignState.lastOutcome = null;\n  return mission;\n}\n\nfunction setCampaignMessage(message) {\n  campaignState.message = message ?? \"\";\n}\n\nfunction setCampaignSuccessMessage(message) {\n  campaignState.successMessage = message ?? \"Mission complete.\";\n}\n\nfunction setCampaignFailureMessage(message) {\n  campaignState.failureMessage = message ?? \"Mission failed.\";\n}\n\nfunction incrementCampaignProgress(amount = 1) {\n  campaignState.objective.progress = Math.max(0, Math.min(\n    (campaignState.objective.target || campaignState.objective.duration || Number.POSITIVE_INFINITY),\n    campaignState.objective.progress + amount\n  ));\n}\n\nfunction setCampaignProgress(value) {\n  campaignState.objective.progress = Math.max(0, value ?? 0);\n}\n\nfunction setCampaignRemaining(value) {\n  campaignState.objective.remaining = Math.max(0, value ?? 0);\n}\n\nfunction decrementCampaignRemaining(delta) {\n  campaignState.objective.remaining = Math.max(0, campaignState.objective.remaining - delta);\n}\n\nfunction resetCampaignRemaining() {\n  campaignState.objective.remaining = Math.max(0, campaignState.objective.duration ?? 0);\n}\n\nfunction setCampaignSpawnCooldown(value) {\n  campaignState.spawn.cooldown = Math.max(0, value ?? 0);\n}\n\nfunction decrementCampaignSpawnCooldown(delta) {\n  campaignState.spawn.cooldown = Math.max(0, campaignState.spawn.cooldown - delta);\n}\n\nfunction setCampaignLastOutcome(outcome) {\n  campaignState.lastOutcome = outcome ?? null;\n}\n\nfunction setCompletedMissions(value) {\n  const nextValue = Math.max(0, Math.min(CAMPAIGN_MISSIONS.length, Math.floor(value ?? 0)));\n  campaignState.completedMissions = Math.max(campaignState.completedMissions, nextValue);\n}\n\nfunction getCampaignSettings() {\n  return CAMPAIGN_SETTINGS;\n}\n\nexport {\n  getCampaignState,\n  getCampaignMissionDefinition,\n  getCampaignMissions,\n  getCampaignSettings,\n  resetCampaignState,\n  setCampaignActive,\n  setCampaignStage,\n  setCampaignStageTimer,\n  decrementCampaignStageTimer,\n  configureCampaignMission,\n  setCampaignMessage,\n  setCampaignSuccessMessage,\n  setCampaignFailureMessage,\n  incrementCampaignProgress,\n  setCampaignProgress,\n  setCampaignRemaining,\n  decrementCampaignRemaining,\n  resetCampaignRemaining,\n  setCampaignSpawnCooldown,\n  decrementCampaignSpawnCooldown,\n  setCampaignLastOutcome,\n  setCompletedMissions\n};\r\n","import { spawnEnemies } from \"../world/enemySpawner.js\";\nimport { input } from \"../input/index.js\";\nimport { stickman, enemies, removeSandboxEnemies, restoreSandboxEnemies } from \"../../state/entities.js\";\nimport { setEnvironment, refreshEnvironment } from \"../../state/environment.js\";\nimport { addMaterials } from \"../../state/resources.js\";\nimport { resetSurvival } from \"../survival/index.js\";\nimport {\n  getCampaignState,\n  getCampaignMissionDefinition,\n  getCampaignMissions,\n  getCampaignSettings,\n  resetCampaignState,\n  setCampaignActive,\n  setCampaignStage,\n  decrementCampaignStageTimer,\n  configureCampaignMission,\n  setCampaignMessage,\n  incrementCampaignProgress,\n  setCampaignProgress,\n  setCampaignRemaining,\n  decrementCampaignRemaining,\n  resetCampaignRemaining,\n  setCampaignSpawnCooldown,\n  decrementCampaignSpawnCooldown,\n  setCampaignLastOutcome,\n  setCompletedMissions\n} from \"../../state/campaign.js\";\n\nconst CAMPAIGN_CONTEXT = \"campaign\";\n\nfunction clearCampaignEnemies() {\n  for (let i = enemies.length - 1; i >= 0; i -= 1) {\n    if (enemies[i].spawnContext === CAMPAIGN_CONTEXT) {\n      enemies.splice(i, 1);\n    }\n  }\n}\n\nfunction ensureEnvironmentLoaded(environmentId) {\n  if (environmentId) {\n    const changed = setEnvironment(environmentId);\n    if (!changed) {\n      refreshEnvironment();\n    }\n  } else {\n    refreshEnvironment();\n  }\n}\n\nfunction applyMissionRewards(rewards = {}) {\n  const materials = Math.max(0, Math.floor(rewards.materials ?? 0));\n  if (materials > 0) {\n    addMaterials(materials);\n  }\n}\n\nfunction spawnCampaignEnemies() {\n  const state = getCampaignState();\n  if (state.stage !== \"active\") {\n    return;\n  }\n  const mission = getCampaignMissionDefinition();\n  if (!mission) {\n    return;\n  }\n  const spawnSettings = state.spawn ?? {};\n  const batchSize = Math.max(0, spawnSettings.batchSize ?? 0);\n  if (batchSize <= 0) {\n    return;\n  }\n  if ((spawnSettings.cooldown ?? 0) > 0) {\n    return;\n  }\n  const alive = enemies.reduce((count, enemy) => {\n    if (enemy.spawnContext === CAMPAIGN_CONTEXT && enemy.health > 0) {\n      return count + 1;\n    }\n    return count;\n  }, 0);\n  if (alive >= batchSize) {\n    return;\n  }\n  let remainingQuota = batchSize - alive;\n  if (state.objective.type === \"eliminate\") {\n    const remainingKills = Math.max(0, state.objective.target - state.objective.progress);\n    if (remainingKills <= 0) {\n      return;\n    }\n    remainingQuota = Math.min(remainingQuota, remainingKills);\n  }\n  if (remainingQuota <= 0) {\n    return;\n  }\n  spawnEnemies(remainingQuota, {\n    context: CAMPAIGN_CONTEXT,\n    autoRespawn: Boolean(spawnSettings.autoRespawn)\n  });\n  const delay = spawnSettings.replenishDelay ?? 0;\n  setCampaignSpawnCooldown(delay > 0 ? delay : 0.75);\n}\n\nfunction removeDefeatedCampaignEnemies() {\n  const state = getCampaignState();\n  if (state.stage !== \"active\") {\n    return;\n  }\n  for (let i = enemies.length - 1; i >= 0; i -= 1) {\n    const enemy = enemies[i];\n    if (enemy.spawnContext === CAMPAIGN_CONTEXT && enemy.health <= 0 && enemy.autoRespawn === false) {\n      enemies.splice(i, 1);\n    }\n  }\n}\n\nfunction beginMissionActive(messageFallback = \"Objective in progress\") {\n  const state = getCampaignState();\n  setCampaignStage(\"active\", 0);\n  const label = state.objective.label || messageFallback;\n  setCampaignMessage(label);\n  resetCampaignRemaining();\n  setCampaignProgress(0);\n  setCampaignSpawnCooldown(0);\n  spawnCampaignEnemies();\n}\n\nfunction startMission(index) {\n  const mission = configureCampaignMission(index);\n  if (!mission) {\n    completeCampaign();\n    return false;\n  }\n  const settings = getCampaignSettings();\n  clearCampaignEnemies();\n  removeSandboxEnemies();\n  ensureEnvironmentLoaded(mission.environmentId);\n  removeSandboxEnemies();\n  const briefingDuration = mission.briefingDuration ?? settings.briefingDuration ?? 0;\n  if (briefingDuration > 0 && (mission.briefing ?? \"\").trim().length > 0) {\n    setCampaignStage(\"briefing\", briefingDuration);\n    setCampaignMessage(`${mission.briefing} (Press Q to deploy early)`);\n  } else {\n    beginMissionActive(mission.objective?.label ?? \"Objective started\");\n  }\n  setCampaignLastOutcome(null);\n  return true;\n}\n\nfunction startCampaign(startIndex = 0) {\n  resetSurvival();\n  resetCampaignState();\n  setCampaignActive(true);\n  const missions = getCampaignMissions();\n  const clampedIndex = Math.min(Math.max(0, startIndex), Math.max(0, missions.length - 1));\n  return startMission(clampedIndex);\n}\n\nfunction retryCurrentMission() {\n  const state = getCampaignState();\n  const index = state.missionIndex >= 0 ? state.missionIndex : 0;\n  setCampaignActive(true);\n  return startMission(index);\n}\n\nfunction continueToNextMission() {\n  const state = getCampaignState();\n  const nextIndex = state.missionIndex + 1;\n  const missions = getCampaignMissions();\n  if (nextIndex >= missions.length) {\n    completeCampaign(true);\n    return;\n  }\n  startMission(nextIndex);\n}\n\nfunction completeCampaign(success = true) {\n  const state = getCampaignState();\n  if (!state.active && state.stage === \"inactive\") {\n    restoreSandboxEnemies();\n    return;\n  }\n  clearCampaignEnemies();\n  restoreSandboxEnemies();\n  if (success) {\n    setCampaignLastOutcome(\"complete\");\n    setCampaignMessage(\"Campaign complete! Press Q to replay the story.\");\n  } else {\n    setCampaignLastOutcome(\"aborted\");\n    setCampaignMessage(\"Campaign closed. Press Q to restart missions.\");\n  }\n  setCampaignStage(\"complete\", 0);\n  setCampaignActive(false);\n}\n\nfunction handleMissionSuccess() {\n  const state = getCampaignState();\n  if (state.stage !== \"active\") {\n    return;\n  }\n  const mission = getCampaignMissionDefinition();\n  const settings = getCampaignSettings();\n  clearCampaignEnemies();\n  applyMissionRewards(state.rewards);\n  setCompletedMissions(state.missionIndex + 1);\n  const holdTime = mission?.successHoldDuration ?? settings.successHoldDuration ?? 4;\n  const successMessage = state.successMessage || \"Mission complete.\";\n  setCampaignMessage(`${successMessage} (Press Q to continue)`);\n  setCampaignStage(\"success\", holdTime);\n  setCampaignLastOutcome(\"success\");\n}\n\nfunction handleMissionFailure(reason = \"\") {\n  const state = getCampaignState();\n  if (state.stage !== \"active\") {\n    return;\n  }\n  const mission = getCampaignMissionDefinition();\n  const settings = getCampaignSettings();\n  clearCampaignEnemies();\n  const failureText = state.failureMessage || \"Mission failed.\";\n  const extra = reason ? ` � ${reason}` : \"\";\n  setCampaignMessage(`${failureText}${extra} (Press Q to retry)`);\n  const holdTime = mission?.failureHoldDuration ?? settings.failureHoldDuration ?? 4;\n  setCampaignStage(\"failure\", holdTime);\n  setCampaignLastOutcome(\"failure\");\n  restoreSandboxEnemies();\n}\n\nfunction handleCampaignInput() {\n  if (!input.campaignStartBuffered) {\n    return;\n  }\n  input.campaignStartBuffered = false;\n  const state = getCampaignState();\n  switch (state.stage) {\n    case \"inactive\":\n      startCampaign(0);\n      break;\n    case \"briefing\":\n      beginMissionActive();\n      break;\n    case \"active\":\n      // Ignore while mission running to avoid accidental aborts\n      break;\n    case \"success\":\n      continueToNextMission();\n      break;\n    case \"failure\":\n      retryCurrentMission();\n      break;\n    case \"complete\":\n      startCampaign(0);\n      break;\n    default:\n      startCampaign(0);\n      break;\n  }\n}\n\nfunction updateCampaign(delta) {\n  decrementCampaignStageTimer(delta);\n  decrementCampaignSpawnCooldown(delta);\n  handleCampaignInput();\n\n  const state = getCampaignState();\n  if (!state.active && state.stage === \"inactive\") {\n    return;\n  }\n\n  if (state.stage === \"briefing\") {\n    if (state.stageTimer <= 0) {\n      beginMissionActive();\n    }\n    return;\n  }\n\n  if (state.stage === \"active\") {\n    if (state.objective.type === \"survive\") {\n      decrementCampaignRemaining(delta);\n      const duration = state.objective.duration ?? 0;\n      const elapsed = Math.max(0, duration - state.objective.remaining);\n      setCampaignProgress(elapsed);\n      if (state.objective.remaining <= 0) {\n        handleMissionSuccess();\n        return;\n      }\n    }\n    if (state.objective.type === \"eliminate\" && state.objective.target > 0 && state.objective.progress >= state.objective.target) {\n      handleMissionSuccess();\n      return;\n    }\n    removeDefeatedCampaignEnemies();\n    spawnCampaignEnemies();\n    if (stickman.health <= 0) {\n      handleMissionFailure(\"Operative down\");\n      return;\n    }\n    return;\n  }\n\n  if (state.stage === \"success\") {\n    if (state.stageTimer <= 0) {\n      continueToNextMission();\n    }\n    return;\n  }\n\n  if (state.stage === \"failure\") {\n    if (state.stageTimer <= 0) {\n      // waiting for player to retry\n    }\n    return;\n  }\n}\n\nfunction getCampaignHudStatus() {\n  const state = getCampaignState();\n  const mission = getCampaignMissionDefinition();\n  return {\n    active: state.active || state.stage !== \"inactive\",\n    stage: state.stage,\n    message: state.message,\n    missionIndex: state.missionIndex,\n    missionName: mission?.name ?? \"\",\n    missionDescription: mission?.description ?? \"\",\n    completedMissions: state.completedMissions,\n    totalMissions: state.totalMissions,\n    lastOutcome: state.lastOutcome,\n    objective: {\n      type: state.objective.type,\n      label: state.objective.label,\n      target: state.objective.target,\n      progress: state.objective.progress,\n      remaining: state.objective.remaining,\n      duration: state.objective.duration\n    }\n  };\n}\n\nfunction recordCampaignEnemyDefeated(enemy) {\n  if (!enemy || enemy.spawnContext !== CAMPAIGN_CONTEXT) {\n    return;\n  }\n  const state = getCampaignState();\n  if (state.stage !== \"active\" || state.objective.type !== \"eliminate\") {\n    return;\n  }\n  incrementCampaignProgress(1);\n}\n\nexport { updateCampaign, getCampaignHudStatus, recordCampaignEnemyDefeated, startCampaign, retryCurrentMission, completeCampaign };\r\n","import { WEAPON_DEFINITIONS } from \"../../config/weapons.js\";\nimport { stickman, enemies, removeSandboxEnemies, restoreSandboxEnemies } from \"../../state/entities.js\";\nimport { getWeaponInventory, setWeaponInventory, resetWeaponInventory } from \"../../state/weapons.js\";\nimport { ensureAmmoEntry, setWeaponInfiniteAmmo, resetAllWeaponAmmo } from \"../../state/ammo.js\";\nimport { getMaterialCount, setMaterialCount } from \"../../state/resources.js\";\nimport { spawnEnemies } from \"../world/enemySpawner.js\";\nimport { input } from \"../input/index.js\";\nimport { resetSurvival } from \"../survival/index.js\";\n\nconst SANDBOX_CONTEXT = \"sandboxSkirmish\";\n\nconst SANDBOX_SETTINGS = {\n  materialFloor: 12000,\n  spawnDelay: 0.5,\n  restDuration: 4,\n  minEnemies: 3,\n  enemyGrowth: 1,\n  enemyVariance: 2,\n  maxEnemies: 16,\n  healthMultiplierPerWave: 0.14,\n  damageMultiplierPerWave: 0.12,\n  speedMultiplierPerWave: 0.08\n};\n\nconst sandboxState = {\n  active: false,\n  arsenalGranted: false,\n  inRest: true,\n  restTimer: 0,\n  wave: 0,\n  kills: 0,\n  bestWave: 0,\n  bestKills: 0,\n  lastWaveDuration: 0,\n  runTime: 0,\n  waveStartTime: null,\n  enemiesAlive: 0,\n  lastOutcome: null,\n  previousInventory: null,\n  previousEquippedId: null,\n  previousMaterials: null\n};\n\nfunction clearSkirmishEnemies() {\n  for (let i = enemies.length - 1; i >= 0; i -= 1) {\n    if (enemies[i].spawnContext === SANDBOX_CONTEXT) {\n      enemies.splice(i, 1);\n    }\n  }\n}\n\nfunction ensureMaterialFloor(force = false) {\n  const floor = SANDBOX_SETTINGS.materialFloor ?? 0;\n  if (floor <= 0) {\n    return;\n  }\n  const current = getMaterialCount();\n  if (force || current < floor) {\n    setMaterialCount(Math.max(current, floor));\n  }\n}\n\nfunction grantFullArsenal() {\n  if (sandboxState.arsenalGranted) {\n    return;\n  }\n  const allWeapons = Object.keys(WEAPON_DEFINITIONS);\n  const preferredId = allWeapons.includes(stickman.equippedWeaponId)\n    ? stickman.equippedWeaponId\n    : (allWeapons.includes(\"strikerPistol\") ? \"strikerPistol\" : allWeapons[0]);\n  setWeaponInventory(allWeapons, { equipId: preferredId });\n  for (const weaponId of allWeapons) {\n    setWeaponInfiniteAmmo(weaponId);\n  }\n  sandboxState.arsenalGranted = true;\n}\n\nfunction restorePreviousLoadout() {\n  const previousInventory = sandboxState.previousInventory;\n  const previousEquippedId = sandboxState.previousEquippedId;\n  if (previousInventory && previousInventory.length > 0) {\n    setWeaponInventory(previousInventory, { equipId: previousEquippedId });\n  } else {\n    resetWeaponInventory();\n  }\n  resetAllWeaponAmmo();\n  const currentInventory = getWeaponInventory();\n  for (const weaponId of currentInventory) {\n    ensureAmmoEntry(weaponId);\n  }\n  sandboxState.arsenalGranted = false;\n}\n\nfunction applySkirmishScaling(enemy, wave) {\n  const base = enemy.baseStats ?? {};\n  const baseHealth = base.maxHealth ?? enemy.maxHealth ?? 120;\n  const baseDamage = base.attackDamage ?? enemy.attackDamage ?? 12;\n  const baseSpeed = base.moveSpeed ?? enemy.moveSpeed ?? 160;\n  const waveIndex = Math.max(0, wave - 1);\n\n  const healthMultiplier = 1 + waveIndex * (SANDBOX_SETTINGS.healthMultiplierPerWave ?? 0);\n  const damageMultiplier = 1 + waveIndex * (SANDBOX_SETTINGS.damageMultiplierPerWave ?? 0);\n  const speedMultiplier = 1 + waveIndex * (SANDBOX_SETTINGS.speedMultiplierPerWave ?? 0);\n\n  enemy.maxHealth = Math.round(baseHealth * healthMultiplier);\n  enemy.health = enemy.maxHealth;\n  enemy.attackDamage = Math.round(baseDamage * damageMultiplier);\n  enemy.moveSpeed = baseSpeed * speedMultiplier;\n}\n\nfunction spawnNextSkirmishWave() {\n  const allWeapons = Object.keys(WEAPON_DEFINITIONS);\n  if (!sandboxState.arsenalGranted && allWeapons.length > 0) {\n    grantFullArsenal();\n  }\n\n  const wave = sandboxState.wave + 1;\n  const base = SANDBOX_SETTINGS.minEnemies ?? 3;\n  const growth = SANDBOX_SETTINGS.enemyGrowth ?? 1;\n  const maxEnemies = SANDBOX_SETTINGS.maxEnemies ?? 12;\n  const variance = Math.max(0, SANDBOX_SETTINGS.enemyVariance ?? 0);\n  const desired = Math.min(base + Math.floor((wave - 1) * growth), maxEnemies);\n  const randomOffset = variance > 0 ? Math.floor((Math.random() * (variance * 2 + 1)) - variance) : 0;\n  const count = Math.max(1, Math.min(maxEnemies, desired + randomOffset));\n\n  const existingIds = new Set(\n    enemies.filter((enemy) => enemy.spawnContext === SANDBOX_CONTEXT).map((enemy) => enemy.id)\n  );\n\n  spawnEnemies(count, { context: SANDBOX_CONTEXT, autoRespawn: false });\n\n  for (const enemy of enemies) {\n    if (enemy.spawnContext === SANDBOX_CONTEXT && !existingIds.has(enemy.id)) {\n      applySkirmishScaling(enemy, wave);\n    }\n  }\n\n  sandboxState.wave = wave;\n  sandboxState.bestWave = Math.max(sandboxState.bestWave, sandboxState.wave);\n  sandboxState.inRest = false;\n  sandboxState.waveStartTime = sandboxState.runTime;\n  sandboxState.lastOutcome = \"wave\";\n}\n\nfunction countSkirmishEnemies() {\n  let alive = 0;\n  for (let i = enemies.length - 1; i >= 0; i -= 1) {\n    const enemy = enemies[i];\n    if (enemy.spawnContext !== SANDBOX_CONTEXT) {\n      continue;\n    }\n    if (enemy.health <= 0 && enemy.autoRespawn === false) {\n      enemies.splice(i, 1);\n      continue;\n    }\n    if (enemy.health > 0) {\n      alive += 1;\n    }\n  }\n  return alive;\n}\n\nfunction activateSandboxSkirmish() {\n  if (sandboxState.active) {\n    return;\n  }\n  sandboxState.previousInventory = getWeaponInventory();\n  sandboxState.previousEquippedId = stickman.equippedWeaponId;\n  sandboxState.previousMaterials = getMaterialCount();\n  sandboxState.active = true;\n  sandboxState.inRest = true;\n  sandboxState.restTimer = SANDBOX_SETTINGS.spawnDelay ?? 0.5;\n  sandboxState.wave = 0;\n  sandboxState.kills = 0;\n  sandboxState.runTime = 0;\n  sandboxState.waveStartTime = null;\n  sandboxState.lastWaveDuration = 0;\n  sandboxState.lastOutcome = \"ready\";\n  sandboxState.enemiesAlive = 0;\n\n  grantFullArsenal();\n  ensureMaterialFloor(true);\n  removeSandboxEnemies();\n  clearSkirmishEnemies();\n  resetSurvival();\n}\n\nfunction deactivateSandboxSkirmish(outcome = \"inactive\") {\n  if (!sandboxState.active && !sandboxState.arsenalGranted) {\n    sandboxState.lastOutcome = outcome;\n    return;\n  }\n  sandboxState.bestWave = Math.max(sandboxState.bestWave, sandboxState.wave);\n  sandboxState.bestKills = Math.max(sandboxState.bestKills, sandboxState.kills);\n  sandboxState.active = false;\n  sandboxState.inRest = true;\n  sandboxState.restTimer = 0;\n  sandboxState.waveStartTime = null;\n  sandboxState.lastOutcome = outcome;\n\n  clearSkirmishEnemies();\n  restoreSandboxEnemies();\n  restorePreviousLoadout();\n  if (typeof sandboxState.previousMaterials === \"number\") {\n    setMaterialCount(sandboxState.previousMaterials);\n  }\n  sandboxState.previousInventory = null;\n  sandboxState.previousEquippedId = null;\n  sandboxState.previousMaterials = null;\n}\n\nfunction updateSandboxSkirmish(delta) {\n  if (input.sandboxToggleBuffered) {\n    input.sandboxToggleBuffered = false;\n    if (sandboxState.active) {\n      deactivateSandboxSkirmish(\"aborted\");\n    } else {\n      activateSandboxSkirmish();\n    }\n  }\n\n  sandboxState.enemiesAlive = countSkirmishEnemies();\n\n  if (!sandboxState.active) {\n    return;\n  }\n\n  sandboxState.runTime += delta;\n  ensureMaterialFloor();\n\n  if (!sandboxState.inRest && sandboxState.enemiesAlive === 0) {\n    if (sandboxState.waveStartTime != null) {\n      sandboxState.lastWaveDuration = Math.max(0, sandboxState.runTime - sandboxState.waveStartTime);\n    }\n    sandboxState.waveStartTime = null;\n    sandboxState.inRest = true;\n    sandboxState.restTimer = SANDBOX_SETTINGS.restDuration ?? 4;\n    sandboxState.lastOutcome = \"rest\";\n  }\n\n  if (sandboxState.inRest) {\n    sandboxState.restTimer = Math.max(0, sandboxState.restTimer - delta);\n    if (sandboxState.restTimer <= 0) {\n      spawnNextSkirmishWave();\n    }\n  }\n}\n\nfunction recordSandboxKill(enemy) {\n  if (!enemy || enemy.spawnContext !== SANDBOX_CONTEXT) {\n    return;\n  }\n  if (!sandboxState.active) {\n    return;\n  }\n  sandboxState.kills += 1;\n  sandboxState.bestKills = Math.max(sandboxState.bestKills, sandboxState.kills);\n}\n\nfunction getSandboxHudStatus() {\n  return {\n    active: sandboxState.active,\n    wave: sandboxState.wave,\n    enemiesAlive: sandboxState.enemiesAlive,\n    kills: sandboxState.kills,\n    bestWave: sandboxState.bestWave,\n    bestKills: sandboxState.bestKills,\n    restTimer: sandboxState.inRest ? sandboxState.restTimer : 0,\n    inRest: sandboxState.inRest,\n    lastWaveDuration: sandboxState.lastWaveDuration,\n    lastOutcome: sandboxState.lastOutcome,\n    materialFloor: SANDBOX_SETTINGS.materialFloor\n  };\n}\n\nexport { updateSandboxSkirmish, getSandboxHudStatus, recordSandboxKill, deactivateSandboxSkirmish };\r\n\r\n\r\n","import { stickman, trainingDummy } from \"../../state/entities.js\";\r\nimport { addMaterials } from \"../../state/resources.js\";\r\nimport { SURVIVAL_SETTINGS } from \"../../config/survival.js\";\r\nimport { isSurvivalActive, addSurvivalImmediateReward, incrementSurvivalKills } from \"../../state/survival.js\";\r\nimport { spawnRagdoll } from \"../effects/ragdoll.js\";\r\nimport { spawnDamagePopup } from \"../effects/damage.js\";\r\nimport { spawnBloodSpray, spawnImpactDust } from \"../effects/particles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { absorbShieldHit } from \"../gadgets/index.js\";\r\nimport { recordCampaignEnemyDefeated } from \"../campaign/index.js\";\r\nimport { recordSandboxKill } from \"../sandbox/index.js\";\r\n\r\nfunction applyDamageToDummy(hit) {\r\n  const damage = hit.damage ?? 0;\r\n  const knockback = hit.knockback ?? 0;\r\n\r\n  trainingDummy.health = Math.max(0, trainingDummy.health - damage);\r\n  trainingDummy.flashTimer = 0.18;\r\n  trainingDummy.shakeTimer = Math.min(0.4, trainingDummy.shakeTimer + 0.22);\r\n  trainingDummy.shakeMagnitude = Math.min(14, trainingDummy.shakeMagnitude + knockback / 60);\r\n\r\n  const popupY = trainingDummy.y + trainingDummy.height * 0.55 - trainingDummy.radius - 12;\r\n  spawnDamagePopup(trainingDummy.x, popupY, damage);\r\n\r\n  if (damage > 0) {\r\n    const burstY = trainingDummy.y + trainingDummy.height * 0.55;\r\n    spawnImpactDust({\r\n      x: trainingDummy.x,\r\n      y: burstY,\r\n      amount: Math.round(6 + damage * 0.3),\r\n      palette: [\"#f2dfc6\", \"#d1b18b\", \"#9f7f59\"],\r\n      speed: 150 + knockback * 0.4,\r\n      spread: Math.PI * 0.8,\r\n      angle: Math.PI * 1.5,\r\n      radius: 10\r\n    });\r\n  }\r\n\r\n  if (trainingDummy.health === 0 && trainingDummy.respawnTimer <= 0) {\r\n    trainingDummy.respawnTimer = 2.5;\r\n  }\r\n}\r\n\r\n\r\nfunction applyDamageToEnemy(enemy, hit) {\r\n  if (enemy.health <= 0 || enemy.invulnerability > 0) {\r\n    return;\r\n  }\r\n\r\n  const damage = hit.damage ?? 0;\r\n  const knockback = hit.knockback ?? 0;\r\n  const launch = hit.launch ?? 0;\r\n  const facing = hit.facing ?? stickman.facing;\r\n\r\n  enemy.health = Math.max(0, enemy.health - damage);\r\n  enemy.flashTimer = 0.18;\r\n  enemy.shakeTimer = Math.min(0.5, enemy.shakeTimer + 0.24);\r\n  enemy.shakeMagnitude = Math.min(18, enemy.shakeMagnitude + knockback / 55);\r\n  enemy.vx += knockback * facing * 0.35;\r\n  if (launch > 0) {\r\n    enemy.vy -= launch * 0.3;\r\n  }\r\n\r\n\r\nif (damage > 0) {\r\n  const impactX = enemy.x + (enemy.radius ?? 24) * 0.6 * facing;\r\n  const impactY = enemy.y + (enemy.height ?? 120) * 0.42;\r\n  const maxHealth = enemy.baseStats?.maxHealth ?? enemy.maxHealth ?? 100;\r\n  spawnBloodSpray({\r\n    x: impactX,\r\n    y: impactY,\r\n    facing,\r\n    damage,\r\n    maxDamage: maxHealth,\r\n    amount: Math.round(7 + Math.min(18, damage * 0.5)),\r\n    intensity: clamp(damage / Math.max(1, maxHealth))\r\n  });\r\n}\r\n\r\n  spawnDamagePopup(enemy.x + enemy.facing * 14, enemy.y - 14, damage);\r\n  enemy.invulnerability = 0.15;\r\n\r\nif (enemy.health === 0) {\r\n  spawnBloodSpray({\r\n    x: enemy.x,\r\n    y: enemy.y + (enemy.height ?? 120) * 0.4,\r\n    facing,\r\n    amount: Math.round(12 + Math.min(24, damage)),\r\n    intensity: 0.85,\r\n    damage: damage * 1.5,\r\n    maxDamage: enemy.baseStats?.maxHealth ?? enemy.maxHealth ?? 100\r\n  });\r\n    if (enemy.respawnTimer <= 0) {\r\n      spawnRagdoll(\"enemy\", enemy.x, enemy.y, facing, enemy.vx, enemy.vy);\r\n    }\r\n    enemy.state = \"defeated\";\r\n    enemy.attackCooldown = 1.2;\r\n    enemy.respawnTimer = 3;\r\n    recordCampaignEnemyDefeated(enemy);\r\n    recordSandboxKill(enemy);\r\n    if (isSurvivalActive()) {\r\n      const killReward = SURVIVAL_SETTINGS.killReward ?? 0;\r\n      incrementSurvivalKills(1);\r\n      if (killReward > 0) {\r\n        addSurvivalImmediateReward(killReward);\r\n        addMaterials(killReward);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction applyDamageToPlayer(enemy, hit) {\r\n  if (stickman.invulnerability > 0 || stickman.health <= 0) {\r\n    return;\r\n  }\r\n\r\n  const baseDamage = hit?.damage ?? enemy.attackDamage ?? 0;\r\n  const baseKnockback = hit?.knockback ?? enemy.attackKnockback ?? 0;\r\n  const baseLaunch = hit?.launch ?? enemy.attackLaunch ?? 0;\r\n  const facing = hit?.facing ?? enemy.facing ?? 1;\r\n\r\n  let adjustedHit = absorbShieldHit({\r\n    damage: baseDamage,\r\n    knockback: baseKnockback,\r\n    launch: baseLaunch,\r\n    facing\r\n  });\r\n\r\n  let finalDamage = adjustedHit?.damage ?? 0;\r\n  let finalKnockback = adjustedHit?.knockback ?? baseKnockback;\r\n  let finalLaunch = adjustedHit?.launch ?? baseLaunch;\r\n  const finalFacing = adjustedHit?.facing ?? facing;\r\n\r\n  const shieldReduction = Math.max(0, Math.min(0.9, stickman.structureShieldStrength ?? 0));\r\n  if (shieldReduction > 0) {\r\n    finalDamage *= 1 - shieldReduction;\r\n    finalKnockback *= 1 - shieldReduction * 0.5;\r\n    finalLaunch *= 1 - shieldReduction * 0.5;\r\n  }\r\n\r\n  if (finalDamage > 0) {\r\n    stickman.health = Math.max(0, stickman.health - finalDamage);\r\n    stickman.invulnerability = 0.6;\r\n  } else {\r\n    stickman.invulnerability = Math.max(stickman.invulnerability, 0.2);\r\n  }\r\n\r\n  stickman.vx += finalKnockback * finalFacing;\r\n  stickman.vy += finalLaunch;\r\nspawnDamagePopup(stickman.x, stickman.y + 10, Math.max(0, Math.round(finalDamage)));\r\n\r\nif (finalDamage > 0) {\r\n  const impactY = stickman.y + (stickman.currentPose?.bodyLength ?? 34);\r\n  spawnBloodSpray({\r\n    x: stickman.x + (stickman.currentPose?.headRadius ?? 16) * 0.4 * finalFacing,\r\n    y: impactY,\r\n    facing: finalFacing,\r\n    damage: finalDamage,\r\n    maxDamage: stickman.maxHealth ?? 100,\r\n    amount: Math.round(8 + Math.min(20, finalDamage * 0.8)),\r\n    intensity: clamp(finalDamage / Math.max(1, stickman.maxHealth ?? 100))\r\n  });\r\n}\r\n\r\n  if (finalDamage > 0 && stickman.health === 0 && stickman.deadTimer <= 0) {\r\n    stickman.deadTimer = 2.6;\r\n    stickman.attacking = false;\r\n    stickman.activeHitboxes = [];\r\n    stickman.comboWindowOpen = false;\r\n    stickman.attackIndex = -1;\r\n    stickman.rolling = false;\r\n    spawnRagdoll(\"player\", stickman.x, stickman.y, -finalFacing, stickman.vx, stickman.vy);\r\n  }\r\n}\r\n\r\nexport { applyDamageToDummy, applyDamageToEnemy, applyDamageToPlayer };\r\n\r\n\r\n\r\n\r\n\r\n\r\n","const DESTRUCTIBLE_TEMPLATES = {\r\n  concreteBarrier: {\r\n    maxHealth: 600,\r\n    width: 180,\r\n    height: 110,\r\n    rubbleHeight: 34,\r\n    material: \"concrete\",\r\n    bodyColor: \"#4c5564\",\r\n    edgeColor: \"#2a313c\",\r\n    accentColor: \"#9aa4b4\",\r\n    damageHighlight: \"#d5dde8\",\r\n    debrisColor: \"#3a424f\",\r\n    smokeDuration: 2.4,\r\n    shakeFactor: 16,\n    salvage: 12\r\n  },\r\n  streetCar: {\r\n    maxHealth: 420,\r\n    width: 168,\r\n    height: 90,\r\n    rubbleHeight: 38,\r\n    material: \"vehicle\",\r\n    bodyColor: \"#ba3c38\",\r\n    edgeColor: \"#1c1d25\",\r\n    accentColor: \"#f4f7fb\",\r\n    glassColor: \"#4ac3ff\",\r\n    damageHighlight: \"#ffe5dc\",\r\n    debrisColor: \"#5a1f1a\",\r\n    smokeDuration: 3.4,\r\n    shakeFactor: 22,\n    salvage: 18,\r\n    deathBlast: {\r\n      radius: 140,\r\n      maxDamage: 160,\r\n      knockback: 320,\r\n      minDamageRatio: 0.32\r\n    }\r\n  },\r\n  fuelBarrelCluster: {\r\n    maxHealth: 220,\r\n    width: 96,\r\n    height: 96,\r\n    rubbleHeight: 28,\r\n    material: \"volatile\",\r\n    bodyColor: \"#c0671c\",\r\n    edgeColor: \"#2f1a08\",\r\n    accentColor: \"#ffe7ba\",\r\n    stripeColor: \"#ffd45f\",\r\n    damageHighlight: \"#ffd4a1\",\r\n    debrisColor: \"#6e2c05\",\r\n    smokeDuration: 4.2,\r\n    shakeFactor: 26,\n    salvage: 22,\r\n    deathBlast: {\r\n      radius: 180,\r\n      maxDamage: 240,\r\n      knockback: 400,\r\n      minDamageRatio: 0.4\r\n    }\r\n  },\r\n  timberWall: {\r\n    maxHealth: 540,\r\n    width: 172,\r\n    height: 102,\r\n    rubbleHeight: 32,\r\n    material: \"concrete\",\r\n    bodyColor: \"#5c4b2d\",\r\n    edgeColor: \"#362a18\",\r\n    accentColor: \"#8b7344\",\r\n    damageHighlight: \"#f5d6a4\",\r\n    debrisColor: \"#3a2d1a\",\r\n    smokeDuration: 2.1,\r\n    shakeFactor: 18,\n    salvage: 16\r\n  },\r\n  sandbagLine: {\r\n    maxHealth: 520,\r\n    width: 200,\r\n    height: 88,\r\n    rubbleHeight: 30,\r\n    material: \"concrete\",\r\n    bodyColor: \"#c2a274\",\r\n    edgeColor: \"#7a6142\",\r\n    accentColor: \"#e3cc9b\",\r\n    damageHighlight: \"#ffe8b8\",\r\n    debrisColor: \"#8a6d48\",\r\n    smokeDuration: 1.9,\r\n    shakeFactor: 14,\n    salvage: 14\r\n  },\r\n  roverWreck: {\r\n    maxHealth: 380,\r\n    width: 176,\r\n    height: 96,\r\n    rubbleHeight: 36,\r\n    material: \"vehicle\",\r\n    bodyColor: \"#8d9fb4\",\r\n    edgeColor: \"#1f2a35\",\r\n    accentColor: \"#f5f9ff\",\r\n    glassColor: \"#9be9ff\",\r\n    damageHighlight: \"#d6e2ff\",\r\n    debrisColor: \"#46586a\",\r\n    smokeDuration: 3.1,\r\n    shakeFactor: 20,\n    salvage: 20,\r\n    deathBlast: {\r\n      radius: 120,\r\n      maxDamage: 120,\r\n      knockback: 240,\r\n      minDamageRatio: 0.28\r\n    }\r\n  },\r\n  plasmaCell: {\r\n    maxHealth: 260,\r\n    width: 102,\r\n    height: 102,\r\n    rubbleHeight: 26,\r\n    material: \"volatile\",\r\n    bodyColor: \"#3b89ff\",\r\n    edgeColor: \"#15213a\",\r\n    accentColor: \"#8bd4ff\",\r\n    stripeColor: \"#62f5ff\",\r\n    damageHighlight: \"#b0f0ff\",\r\n    debrisColor: \"#1c3c66\",\r\n    smokeDuration: 4.6,\r\n    shakeFactor: 30,\n    salvage: 26,\r\n    deathBlast: {\r\n      radius: 220,\r\n      maxDamage: 280,\r\n      knockback: 420,\r\n      minDamageRatio: 0.45\r\n    }\r\n  }\r\n};\r\n\r\nexport { DESTRUCTIBLE_TEMPLATES };\r\n","import { DESTRUCTIBLE_TEMPLATES } from \"../config/destructibles.js\";\nimport { getEnvironmentDestructibleSpawns, onEnvironmentChange } from \"./environment.js\";\n\nfunction createDestructibleFromSpawn(spawn) {\n  const baseTemplate = DESTRUCTIBLE_TEMPLATES[spawn.type];\n  if (!baseTemplate) {\n    throw new Error(`Unknown destructible template: ${spawn.type}`);\n  }\n\n  const templateOverrides = spawn.templateOverrides ?? {};\n  const template = { ...baseTemplate, ...templateOverrides };\n  const width = spawn.width ?? template.width ?? baseTemplate.width;\n  const height = spawn.height ?? template.height ?? baseTemplate.height;\n  const halfWidth = width / 2;\n  const maxHealth = template.maxHealth ?? baseTemplate.maxHealth ?? 100;\n\n  const destructible = {\n    id: spawn.id,\n    type: spawn.type,\n    template,\n    x: spawn.x,\n    y: spawn.baseY,\n    width,\n    height,\n    halfWidth,\n    health: maxHealth,\n    maxHealth,\n    destroyed: false,\n    flashTimer: 0,\n    shakeTimer: 0,\n    shakeMagnitude: 0,\n    smokeTimer: 0,\n    rubbleLevel: 0,\n    deathTriggered: false,\n    facing: spawn.facing ?? 1,\n    spawnConfig: { ...spawn }\n  };\n\n  if (spawn.overrides && typeof spawn.overrides === \"object\") {\n    Object.assign(destructible, spawn.overrides);\n  }\n\n  return destructible;\n}\n\nfunction createInitialState() {\n  return getEnvironmentDestructibleSpawns().map((spawn) => createDestructibleFromSpawn(spawn));\n}\n\nconst destructibles = createInitialState();\n\nfunction resetDestructibles() {\n  destructibles.length = 0;\n  const fresh = createInitialState();\n  for (const item of fresh) {\n    destructibles.push(item);\n  }\n}\n\nfunction getDestructibles() {\n  return destructibles;\n}\n\nfunction getDestructibleById(id) {\n  return destructibles.find((item) => item.id === id) ?? null;\n}\n\nonEnvironmentChange(() => {\n  resetDestructibles();\n});\n\nexport { destructibles, getDestructibles, getDestructibleById, resetDestructibles };\r\n","import { stickman, trainingDummy, enemies, getTotalHeight } from \"../../state/entities.js\";\nimport { applyDamageToDummy, applyDamageToEnemy, applyDamageToPlayer } from \"./damageHandlers.js\";\nimport { clamp } from \"../utils/math.js\";\n\nfunction computeExplosionFalloff(distance, radius, minRatio = 0.25) {\n  const clampedRadius = Math.max(1, radius);\n  const falloff = clamp(1 - distance / clampedRadius, 0, 1);\n  return clamp(minRatio + falloff * (1 - minRatio), 0, 1);\n}\n\nfunction applyExplosionImpulse({\n  x,\n  y,\n  radius,\n  maxDamage = 0,\n  maxKnockback = 0,\n  minDamageRatio = 0.25,\n  selfDamageScale = 1,\n  selfKnockbackScale = 1,\n  includeTrainingDummy = true,\n  includeEnemies = true,\n  includePlayer = true\n}) {\n  const summary = {\n    dummyHit: false,\n    enemiesHit: 0,\n    playerHit: false\n  };\n\n  const damageCap = Math.max(0, maxDamage);\n  const knockbackCap = Math.max(0, maxKnockback ?? damageCap * 1.2);\n  const radiusSafe = Math.max(1, radius);\n  const minRatio = clamp(minDamageRatio, 0, 1);\n\n  if (includeTrainingDummy && trainingDummy.health > 0) {\n    const dummyX = trainingDummy.x;\n    const dummyY = trainingDummy.y + trainingDummy.height * 0.55;\n    const distance = Math.hypot(dummyX - x, dummyY - y);\n    if (distance <= radiusSafe) {\n      const ratio = computeExplosionFalloff(distance, radiusSafe, minRatio);\n      const damage = damageCap * ratio;\n      const knockback = knockbackCap * ratio;\n      const facing = dummyX >= x ? 1 : -1;\n      applyDamageToDummy({\n        damage,\n        knockback,\n        launch: knockback * 0.18,\n        facing\n      });\n      summary.dummyHit = true;\n    }\n  }\n\n  if (includeEnemies) {\n    for (const enemy of enemies) {\n      if (enemy.health <= 0) {\n        continue;\n      }\n      const enemyX = enemy.x;\n      const enemyY = enemy.y + enemy.height * 0.5;\n      const distance = Math.hypot(enemyX - x, enemyY - y);\n      if (distance > radiusSafe) {\n        continue;\n      }\n      const ratio = computeExplosionFalloff(distance, radiusSafe, minRatio);\n      const damage = damageCap * ratio;\n      const knockback = knockbackCap * ratio;\n      const facing = enemyX >= x ? 1 : -1;\n      if (damage <= 0 && knockback <= 0) {\n        continue;\n      }\n      applyDamageToEnemy(enemy, {\n        damage,\n        knockback,\n        launch: knockback * 0.24,\n        facing\n      });\n      summary.enemiesHit += 1;\n    }\n  }\n\n  if (includePlayer && stickman.health > 0) {\n    const pose = stickman.currentPose ?? { headRadius: 16, bodyLength: 34, legLength: 36 };\n    const playerHeight = getTotalHeight(pose);\n    const playerCenterY = stickman.y + playerHeight * 0.6;\n    const distance = Math.hypot(stickman.x - x, playerCenterY - y);\n    if (distance <= radiusSafe) {\n      const ratio = computeExplosionFalloff(distance, radiusSafe, minRatio);\n      const damage = Math.max(0, damageCap * ratio * selfDamageScale);\n      const knockback = knockbackCap * ratio * selfKnockbackScale;\n      const facing = stickman.x >= x ? 1 : -1;\n      if (damage > 0 || knockback > 0) {\n        applyDamageToPlayer(null, {\n          damage,\n          knockback,\n          launch: knockback * 0.25,\n          facing\n        });\n        summary.playerHit = true;\n      }\n    }\n  }\n\n  return summary;\n}\n\nexport { computeExplosionFalloff, applyExplosionImpulse };\r\n","import { spawnSalvagePickup } from \"../../state/resources.js\";\r\nimport { destructibles, getDestructibles } from \"../../state/destructibles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { spawnExplosionParticles, spawnExplosionDebris, spawnSmokePuffs, spawnRingBurst } from \"../effects/particles.js\";\r\nimport { applyExplosionImpulse, computeExplosionFalloff } from \"../combat/explosions.js\";\r\n\r\nfunction getBounds(destructible) {\r\n  const halfWidth = destructible.halfWidth ?? destructible.width / 2;\r\n  const left = destructible.x - halfWidth;\r\n  const right = destructible.x + halfWidth;\r\n  const top = destructible.y - destructible.height;\r\n  const bottom = destructible.y;\r\n  return { left, right, top, bottom };\r\n}\r\n\r\nfunction circleIntersectsDestructible(x, y, radius, destructible) {\r\n  const { left, right, top, bottom } = getBounds(destructible);\r\n  const closestX = clamp(x, left, right);\r\n  const closestY = clamp(y, top, bottom);\r\n  const dx = x - closestX;\r\n  const dy = y - closestY;\r\n  return dx * dx + dy * dy <= radius * radius;\r\n}\r\n\r\nfunction distanceToDestructible(x, y, destructible) {\r\n  const { left, right, top, bottom } = getBounds(destructible);\r\n  const dx = Math.max(left - x, 0, x - right);\r\n  const dy = Math.max(top - y, 0, y - bottom);\r\n  return Math.hypot(dx, dy);\r\n}\r\n\r\nfunction spawnDamageEffects(destructible, hit = {}) {\r\n  if (typeof window !== \"undefined\") {\r\n    window.dispatchEvent(\r\n      new CustomEvent(\"destructible:hit\", {\r\n        detail: {\r\n          id: destructible.id,\r\n          type: destructible.type,\r\n          material: destructible.template?.material ?? \"generic\",\r\n          cause: hit.cause ?? \"impact\",\r\n          x: hit.impactX ?? destructible.x,\r\n          y: hit.impactY ?? destructible.y - destructible.height * 0.5,\r\n          health: destructible.health,\r\n          maxHealth: destructible.maxHealth\r\n        }\r\n      })\r\n    );\r\n  }\r\n}\r\n\r\nfunction triggerDestructibleDeath(destructible, hit = {}) {\r\n  const template = destructible.template;\r\n  if (!template || destructible.deathTriggered) {\r\n    return;\r\n  }\r\n  destructible.deathTriggered = true;\r\n  const centerX = hit.impactX ?? destructible.x;\r\n  const centerY = hit.impactY ?? (destructible.y - destructible.height * 0.35);\r\n\r\n  spawnExplosionParticles({\r\n    x: centerX,\r\n    y: centerY,\r\n    radius: Math.max(destructible.width, destructible.height) * 0.8\r\n  });\r\n  spawnSmokePuffs({\r\n    x: centerX,\r\n    y: centerY,\r\n    radius: Math.max(destructible.width, destructible.height),\r\n    maxRadius: (template.deathBlast?.radius ?? destructible.width * 1.2) * 0.6\r\n  });\r\n  spawnRingBurst({\r\n    x: centerX,\r\n    y: centerY,\r\n    startRadius: destructible.width * 0.35,\r\n    endRadius: destructible.width * 1.1,\r\n    color: \"#ffb347\",\r\n    ttl: 0.55,\r\n    lineWidth: 5\r\n  });\r\n\r\n  if (template.deathBlast) {\r\n    const blast = template.deathBlast;\r\n    if (typeof window !== \"undefined\") {\r\n      window.dispatchEvent(\r\n        new CustomEvent(\"destructible:explosion\", {\r\n          detail: {\r\n            id: destructible.id,\r\n            x: centerX,\r\n            y: centerY,\r\n            radius: blast.radius\r\n          }\r\n        })\r\n      );\r\n    }\r\n\r\n    applyExplosionImpulse({\r\n      x: centerX,\r\n      y: centerY,\r\n      radius: blast.radius,\r\n      maxDamage: blast.maxDamage,\r\n      maxKnockback: blast.knockback,\r\n      minDamageRatio: blast.minDamageRatio ?? 0.25\r\n    });\r\n\r\n    damageDestructiblesInRadius({\r\n      x: centerX,\r\n      y: centerY,\r\n      radius: blast.radius,\r\n      maxDamage: blast.maxDamage,\r\n      minDamageRatio: blast.minDamageRatio ?? 0.25,\r\n      sourceId: destructible.id,\r\n      cause: \"chain-explosion\"\r\n    });\r\n  }\r\n  const salvageAmount = template.salvage ?? Math.round((destructible.maxHealth ?? 200) / 25);\r\n  if (salvageAmount > 0) {\r\n    const chunks = Math.max(1, Math.round(salvageAmount / 10));\r\n    const amountPer = Math.max(1, Math.round(salvageAmount / chunks));\r\n    for (let i = 0; i < chunks; i += 1) {\r\n      const jitterX = (Math.random() - 0.5) * (destructible.width ?? 120) * 0.4;\r\n      spawnSalvagePickup({\r\n        x: centerX + jitterX,\r\n        y: centerY,\r\n        amount: amountPer,\r\n        vy: -120 - Math.random() * 60\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction damageDestructible(destructible, hit = {}) {\r\n  if (!destructible || destructible.destroyed) {\r\n    return { applied: false, destroyed: false };\r\n  }\r\n\r\n  const template = destructible.template;\r\n  const damage = Math.max(0, hit.damage ?? 0);\r\n  if (damage <= 0) {\r\n    return { applied: false, destroyed: false };\r\n  }\r\n\r\n  const appliedDamage = Math.min(damage, destructible.health);\r\n  destructible.health = Math.max(0, destructible.health - appliedDamage);\r\n  destructible.flashTimer = 0.2;\r\n  destructible.shakeTimer = Math.min(0.45, destructible.shakeTimer + 0.18 + (appliedDamage / destructible.maxHealth) * 0.3);\r\n  const baseShake = template?.shakeFactor ?? 14;\r\n  destructible.shakeMagnitude = Math.max(destructible.shakeMagnitude * 0.6, baseShake * (0.35 + (appliedDamage / destructible.maxHealth) * 1.2));\r\n  destructible.smokeTimer = Math.min(template?.smokeDuration ?? 0, (destructible.smokeTimer ?? 0) + 0.5);\r\n  spawnDamageEffects(destructible, hit);\r\n\r\n  let destroyed = false;\r\n  if (destructible.health <= 0) {\r\n    destructible.destroyed = true;\r\n    destructible.rubbleLevel = Math.max(destructible.rubbleLevel, 0.05);\r\n    destructible.smokeTimer = template?.smokeDuration ?? 0;\r\n    triggerDestructibleDeath(destructible, hit);\r\n    destroyed = true;\r\n  }\r\n\r\n  return { applied: true, destroyed };\r\n}\r\n\r\nfunction damageDestructiblesInRadius({ x, y, radius, maxDamage, minDamageRatio = 0.25, sourceId = null, cause = \"explosion\" }) {\r\n  const damageMax = Math.max(0, maxDamage ?? 0);\r\n  if (damageMax <= 0 || radius <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  const minRatio = clamp(minDamageRatio, 0, 1);\r\n  let hits = 0;\r\n  for (const destructible of destructibles) {\r\n    if (destructible.id === sourceId || (destructible.destroyed && destructible.deathTriggered)) {\r\n      continue;\r\n    }\r\n    const distance = distanceToDestructible(x, y, destructible);\r\n    if (distance > radius) {\r\n      continue;\r\n    }\r\n    const falloff = computeExplosionFalloff(distance, radius, minRatio);\r\n    const damage = damageMax * falloff;\r\n    if (damage <= 0) {\r\n      continue;\r\n    }\r\n    const impactX = clamp(x, destructible.x - destructible.halfWidth, destructible.x + destructible.halfWidth);\r\n    const impactY = clamp(y, destructible.y - destructible.height, destructible.y);\r\n    const result = damageDestructible(destructible, { damage, cause, impactX, impactY });\r\n    if (result.applied) {\r\n      hits += 1;\r\n    }\r\n  }\r\n  return hits;\r\n}\r\n\r\nfunction handleProjectileCollision(projectile) {\r\n  for (const destructible of destructibles) {\r\n    if (destructible.destroyed) {\r\n      continue;\r\n    }\r\n    if (circleIntersectsDestructible(projectile.x, projectile.y, projectile.radius, destructible)) {\r\n      damageDestructible(destructible, {\r\n        damage: projectile.damage ?? 0,\r\n        cause: \"projectile\",\r\n        impactX: projectile.x,\r\n        impactY: projectile.y\r\n      });\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction handleHitboxCollision(hitbox) {\r\n  let hit = false;\r\n  for (const destructible of destructibles) {\r\n    if (destructible.destroyed || hitbox.hitTargets.has(destructible.id)) {\r\n      continue;\r\n    }\r\n    if (circleIntersectsDestructible(hitbox.x, hitbox.y, hitbox.radius, destructible)) {\r\n      hitbox.hitTargets.add(destructible.id);\r\n      damageDestructible(destructible, {\r\n        damage: hitbox.damage ?? 0,\r\n        cause: \"melee\",\r\n        impactX: hitbox.x,\r\n        impactY: hitbox.y\r\n      });\r\n      hit = true;\r\n    }\r\n  }\r\n  return hit;\r\n}\r\n\r\nfunction updateDestructibles(delta) {\r\n  for (const destructible of destructibles) {\r\n    destructible.flashTimer = Math.max(0, (destructible.flashTimer ?? 0) - delta);\r\n    destructible.shakeTimer = Math.max(0, (destructible.shakeTimer ?? 0) - delta);\r\n    destructible.smokeTimer = Math.max(0, (destructible.smokeTimer ?? 0) - delta);\r\n    destructible.shakeMagnitude *= destructible.shakeTimer > 0 ? 0.92 : 0.6;\r\n    if (destructible.destroyed) {\r\n      destructible.rubbleLevel = Math.min(1, (destructible.rubbleLevel ?? 0) + delta * 2.2);\r\n    } else {\r\n      destructible.rubbleLevel = Math.max(0, (destructible.rubbleLevel ?? 0) - delta * 0.8);\r\n    }\r\n  }\r\n}\r\n\r\nexport {\r\n  getDestructibles,\r\n  updateDestructibles,\r\n  damageDestructible,\r\n  damageDestructiblesInRadius,\r\n  handleProjectileCollision,\r\n  handleHitboxCollision\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","const BUILDING_DEFINITIONS = {\n  barricade: {\n    id: \"barricade\",\n    name: \"Reinforced Barricade\",\n    width: 160,\n    height: 96,\n    maxHealth: 600,\n    cost: 40,\n    color: \"#4f5a6c\",\n    accentColor: \"#8ea0ba\",\n    strokeColor: \"#273041\",\n    blocking: true\n  },\n  watchtower: {\n    id: \"watchtower\",\n    name: \"Scout Tower\",\n    width: 120,\n    height: 200,\n    maxHealth: 520,\n    cost: 65,\n    color: \"#6c5b3f\",\n    accentColor: \"#a7824f\",\n    strokeColor: \"#2f2415\",\n    turret: {\n      range: 420,\n      cooldown: 1.25,\n      projectile: {\n        speed: 520,\n        damage: 18,\n        color: \"#ffd57a\"\n      }\n    }\n  },\n  shieldEmitter: {\n    id: \"shieldEmitter\",\n    name: \"Shield Emitter\",\n    width: 110,\n    height: 110,\n    maxHealth: 360,\n    cost: 55,\n    color: \"#2a3b58\",\n    accentColor: \"#6fb7ff\",\n    strokeColor: \"#152032\",\n    shield: {\n      radius: 220,\n      damageReduction: 0.4,\n      buffDuration: 0.6\n    },\n    ambient: {\n      radius: 260,\n      intensity: 0.9,\n      color: \"#7cd6ff\",\n      flicker: 0.35\n    }\n  },\n  shockTrap: {\n    id: \"shockTrap\",\n    name: \"Shock Trap\",\n    width: 100,\n    height: 28,\n    maxHealth: 280,\n    cost: 30,\n    color: \"#2b2f3c\",\n    accentColor: \"#9af0ff\",\n    strokeColor: \"#181b26\",\n    trap: {\n      radius: 140,\n      damage: 24,\n      stun: 0.8,\n      cooldown: 2.6\n    },\n    ambient: {\n      radius: 180,\n      intensity: 0.6,\n      color: \"#8cf2ff\",\n      flicker: 0.4\n    }\n  }\n};\n\nexport { BUILDING_DEFINITIONS };\r\n","import { BUILDING_DEFINITIONS } from \"../config/buildings.js\";\r\nimport { onEnvironmentChange } from \"./environment.js\";\r\n\r\nconst structures = [];\r\n\r\nconst buildState = {\r\n  active: false,\r\n  blueprintIndex: 0,\r\n  lastPreview: {\r\n    x: 0,\r\n    y: 0,\r\n    valid: false\r\n  }\r\n};\r\n\r\nfunction getBuildingDefinitions() {\r\n  return Object.values(BUILDING_DEFINITIONS);\r\n}\r\n\r\nfunction getBlueprintByIndex(index = 0) {\r\n  const defs = getBuildingDefinitions();\r\n  if (defs.length === 0) {\r\n    return null;\r\n  }\r\n  const safeIndex = ((index % defs.length) + defs.length) % defs.length;\r\n  return defs[safeIndex];\r\n}\r\n\r\nfunction addStructure(structure) {\r\n  structures.push(structure);\r\n}\r\n\r\nfunction resetStructures() {\r\n  structures.length = 0;\r\n}\r\n\r\nfunction getStructures() {\r\n  return structures;\r\n}\r\n\r\nfunction getBuildState() {\r\n  return buildState;\r\n}\r\n\r\nonEnvironmentChange(() => {\r\n  resetStructures();\r\n  buildState.active = false;\r\n  buildState.lastPreview = { ...buildState.lastPreview, valid: false };\r\n});\r\n\r\nexport {\r\n  getBuildingDefinitions,\r\n  getBlueprintByIndex,\r\n  getStructures,\r\n  addStructure,\r\n  resetStructures,\r\n  getBuildState\r\n};\r\n","import { context } from \"../../environment/canvas.js\";\r\nimport { stickman, squadmates } from \"../../state/entities.js\";\r\nimport { onEnvironmentChange, getEnvironmentAmbientLights } from \"../../state/environment.js\";\r\nimport { getStructures } from \"../../state/buildings.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst persistentLights = new Map();\r\nconst transientLights = [];\r\nlet listenersAttached = false;\r\nlet environmentAmbientLights = getEnvironmentAmbientLights();\r\n\r\nonEnvironmentChange((environment) => {\r\n  environmentAmbientLights = Array.isArray(environment?.ambientLights) ? environment.ambientLights : [];\r\n  persistentLights.clear();\r\n});\r\n\r\nfunction clampIntensity(value) {\r\n  return clamp(value, 0, 3);\r\n}\r\n\r\nfunction parseColor(color) {\r\n  if (typeof color !== \"string\") {\r\n    return { r: 255, g: 255, b: 255 };\r\n  }\r\n  const trimmed = color.trim();\r\n  if (trimmed.startsWith(\"#\")) {\r\n    let hex = trimmed.slice(1);\r\n    if (hex.length === 3) {\r\n      hex = hex\r\n        .split(\"\")\r\n        .map((char) => char + char)\r\n        .join(\"\");\r\n    }\r\n    if (hex.length === 6) {\r\n      const numeric = Number.parseInt(hex, 16);\r\n      if (!Number.isNaN(numeric)) {\r\n        return {\r\n          r: (numeric >> 16) & 0xff,\r\n          g: (numeric >> 8) & 0xff,\r\n          b: numeric & 0xff\r\n        };\r\n      }\r\n    }\r\n  }\r\n  const match = trimmed.match(/rgba?\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)/i);\r\n  if (match) {\r\n    return {\r\n      r: Number.parseInt(match[1], 10),\r\n      g: Number.parseInt(match[2], 10),\r\n      b: Number.parseInt(match[3], 10)\r\n    };\r\n  }\r\n  return { r: 255, g: 255, b: 255 };\r\n}\r\n\r\nfunction rgba(color, alpha) {\r\n  const { r, g, b } = parseColor(color);\r\n  const clampedAlpha = clamp(alpha, 0, 1.2);\r\n  return `rgba(${r}, ${g}, ${b}, ${clampedAlpha})`;\r\n}\r\n\r\nfunction setPersistentLight(id, props) {\r\n  let light = persistentLights.get(id);\r\n  if (!light) {\r\n    light = {\r\n      id,\r\n      intensity: 0,\r\n      targetIntensity: clampIntensity(props.intensity ?? 1),\r\n      type: props.type ?? \"point\",\r\n      smoothing: props.smoothing ?? 10\r\n    };\r\n    persistentLights.set(id, light);\r\n  }\r\n  light.type = props.type ?? light.type ?? \"point\";\r\n  light.x = props.x ?? light.x ?? 0;\r\n  light.y = props.y ?? light.y ?? 0;\r\n  light.radius = props.radius ?? light.radius ?? 180;\r\n  light.fov = props.fov ?? light.fov ?? Math.PI / 2;\r\n  light.direction = props.direction ?? light.direction ?? 0;\r\n  light.color = props.color ?? light.color ?? \"#ffffff\";\r\n  light.stretch = props.stretch ?? light.stretch ?? 1;\r\n  light.flicker = props.flicker ?? light.flicker ?? 0;\r\n  light.smoothing = props.smoothing ?? light.smoothing ?? 10;\r\n  light.targetIntensity = clampIntensity(props.intensity ?? light.targetIntensity ?? 1);\r\n  light.active = true;\r\n}\r\n\r\nfunction spawnDynamicLight(options = {}) {\r\n  ensureListeners();\r\n  const ttl = Math.max(0.016, options.ttl ?? 0.3);\r\n  transientLights.push({\r\n    type: options.type ?? \"point\",\r\n    x: options.x ?? 0,\r\n    y: options.y ?? 0,\r\n    radius: options.radius ?? 160,\r\n    intensity: clampIntensity(options.intensity ?? 1),\r\n    color: options.color ?? \"#ffffff\",\r\n    direction: options.direction ?? 0,\r\n    fov: options.fov ?? Math.PI / 2,\r\n    stretch: options.stretch ?? 1,\r\n    flicker: options.flicker ?? 0,\r\n    decay: clamp(options.decay ?? 1, 0.3, 4),\r\n    ttl,\r\n    maxTtl: ttl\r\n  });\r\n}\r\n\r\nfunction ensureListeners() {\r\n  if (listenersAttached || typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.addEventListener(\"weapon:muzzle-flash\", (event) => {\r\n    const detail = event?.detail ?? {};\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      radius: detail.radius ? detail.radius * 1.2 : 140,\r\n      intensity: 1.2,\r\n      color: \"#ffe4b0\",\r\n      ttl: 0.12,\r\n      flicker: 0.35,\r\n      decay: 0.7\r\n    });\r\n    if (typeof detail.facing === \"number\" && detail.facing !== 0) {\r\n      spawnDynamicLight({\r\n        type: \"cone\",\r\n        x: detail.x ?? 0,\r\n        y: detail.y ?? 0,\r\n        radius: 200,\r\n        intensity: 0.9,\r\n        color: \"#fff7d4\",\r\n        direction: detail.facing > 0 ? 0 : Math.PI,\r\n        fov: Math.PI / 5,\r\n        stretch: 0.4,\r\n        ttl: 0.12,\r\n        flicker: 0.25,\r\n        decay: 0.8\r\n      });\r\n    }\r\n  });\r\n  window.addEventListener(\"throwable:explosion\", (event) => {\r\n    const detail = event?.detail ?? {};\r\n    const radius = detail.radius ? detail.radius * 1.6 : 240;\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      radius,\r\n      intensity: 1.7,\r\n      color: \"#ffbf6b\",\r\n      ttl: 0.45,\r\n      flicker: 0.45,\r\n      decay: 0.7\r\n    });\r\n  });\r\n  window.addEventListener(\"throwable:flash-burst\", (event) => {\r\n    const detail = event?.detail ?? {};\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      radius: (detail.radius ?? 220) * 1.4,\r\n      intensity: 2,\r\n      color: \"#ffffff\",\r\n      ttl: 0.35,\r\n      flicker: 0.6,\r\n      decay: 0.6\r\n    });\r\n  });\r\n  window.addEventListener(\"throwable:smoke-spawn\", (event) => {\r\n    const detail = event?.detail ?? {};\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      radius: (detail.radius ?? 160) * 1.1,\r\n      intensity: 0.5,\r\n      color: \"#7ad4ff\",\r\n      ttl: 0.5,\r\n      flicker: 0.2,\r\n      decay: 1.4\r\n    });\r\n  });\r\n  window.addEventListener(\"throwable:smoke-dissipate\", (event) => {\r\n    const detail = event?.detail ?? {};\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: detail.x ?? 0,\r\n      y: detail.y ?? 0,\r\n      radius: (detail.radius ?? 160) * 1.3,\r\n      intensity: 0.35,\r\n      color: \"#a4f1ff\",\r\n      ttl: 0.4,\r\n      flicker: 0.18,\r\n      decay: 1.6\r\n    });\r\n  });\r\n  window.addEventListener(\"destructible:hit\", (event) => {\r\n    const detail = event?.detail ?? {};\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: detail.impactX ?? detail.x ?? 0,\r\n      y: detail.impactY ?? detail.y ?? 0,\r\n      radius: 140,\r\n      intensity: 0.55,\r\n      color: \"#ffe1a4\",\r\n      ttl: 0.18,\r\n      flicker: 0.3,\r\n      decay: 1.1\r\n    });\r\n  });\r\n  listenersAttached = true;\r\n}\r\n\r\nfunction updateEnvironmentLights() {\r\n  const anchors = Array.isArray(environmentAmbientLights) ? environmentAmbientLights : [];\r\n  for (let i = 0; i < anchors.length; i += 1) {\r\n    const anchor = anchors[i] ?? {};\r\n    const id = anchor.id ?? \"env-light-\" + i;\r\n    setPersistentLight(id, anchor);\r\n  }\r\n}\r\n\r\nfunction updateFlashlights() {\r\n  const playerFacing = stickman.facing ?? 1;\r\n  const alive = stickman.deadTimer <= 0;\r\n  const inVehicle = stickman.controlMode === \"vehicle\";\r\n  const baseIntensity = alive ? (inVehicle ? 0.65 : 0.9) : 0;\r\n\r\n  setPersistentLight(\"player-flashlight\", {\r\n    type: \"cone\",\r\n    x: stickman.x + playerFacing * 34,\r\n    y: stickman.y + 28,\r\n    radius: inVehicle ? 280 : 240,\r\n    intensity: baseIntensity,\r\n    color: \"#ffd591\",\r\n    direction: playerFacing >= 0 ? 0 : Math.PI,\r\n    fov: Math.PI * 0.5,\r\n    stretch: 0.42,\r\n    smoothing: 18,\r\n    flicker: 0.2\r\n  });\r\n\r\n  squadmates.forEach((ally, index) => {\r\n    if (!ally || ally.state === \"defeated\") {\r\n      return;\r\n    }\r\n    const facing = ally.facing ?? 1;\r\n    setPersistentLight(\"squad-flashlight-\" + (ally.id ?? index), {\r\n      type: \"cone\",\r\n      x: ally.x + facing * 30,\r\n      y: ally.y + 26,\r\n      radius: 210,\r\n      intensity: 0.6,\r\n      color: \"#fff0c4\",\r\n      direction: facing >= 0 ? 0 : Math.PI,\r\n      fov: Math.PI * 0.45,\r\n      stretch: 0.38,\r\n      smoothing: 20,\r\n      flicker: 0.24\r\n    });\r\n  });\r\n}\r\n\r\nfunction isLightVisible(light) {\r\n  const radius = light.radius ?? 0;\r\n  if (radius <= 0) {\r\n    return false;\r\n  }\r\n  const width = context.canvas.width;\r\n  const height = context.canvas.height;\r\n  return light.x + radius >= 0 && light.x - radius <= width && light.y + radius >= 0 && light.y - radius <= height;\r\n}\r\n\r\nfunction drawPointLight(light, strength) {\r\n  if (!isLightVisible(light)) {\r\n    return;\r\n  }\r\n  const radius = light.radius ?? 160;\r\n  const gradient = context.createRadialGradient(light.x, light.y, 0, light.x, light.y, radius);\r\n  gradient.addColorStop(0, rgba(light.color, clamp(strength * 1.05, 0, 1.1)));\r\n  gradient.addColorStop(0.4, rgba(light.color, clamp(strength * 0.6, 0, 0.9)));\r\n  gradient.addColorStop(1, rgba(light.color, 0));\r\n  context.fillStyle = gradient;\r\n  context.beginPath();\r\n  context.arc(light.x, light.y, radius, 0, Math.PI * 2);\r\n  context.fill();\r\n}\r\n\r\nfunction drawConeLight(light, strength) {\r\n  if (!isLightVisible(light)) {\r\n    return;\r\n  }\r\n  const radius = light.radius ?? 200;\r\n  const fov = clamp(light.fov ?? Math.PI / 3, Math.PI / 12, Math.PI);\r\n  const stretch = clamp(light.stretch ?? 0.5, 0.2, 1.2);\r\n  context.save();\r\n  context.translate(light.x, light.y);\r\n  context.rotate(light.direction ?? 0);\r\n  context.scale(1, stretch);\r\n  const gradient = context.createRadialGradient(0, 0, 0, 0, 0, radius);\r\n  gradient.addColorStop(0, rgba(light.color, clamp(strength, 0, 1)));\r\n  gradient.addColorStop(0.45, rgba(light.color, clamp(strength * 0.6, 0, 0.8)));\r\n  gradient.addColorStop(1, rgba(light.color, 0));\r\n  context.fillStyle = gradient;\r\n  context.beginPath();\r\n  const halfFov = fov / 2;\r\n  context.moveTo(0, 0);\r\n  context.arc(0, 0, radius, -halfFov, halfFov);\r\n  context.closePath();\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction updateLighting(delta) {\r\n  ensureListeners();\r\n\r\n  for (const light of persistentLights.values()) {\r\n    light.active = false;\r\n  }\r\n\r\n  updateEnvironmentLights();\r\n  updateFlashlights();\r\n  const structureLights = getStructures();\r\n  for (let i = 0; i < structureLights.length; i += 1) {\r\n    const structure = structureLights[i];\r\n    const ambient = structure?.ambient;\r\n    if (!ambient) {\r\n      continue;\r\n    }\r\n    setPersistentLight(`structure-${structure.id}`, {\r\n      type: ambient.type ?? \"point\",\r\n      x: structure.x + (ambient.offsetX ?? 0),\r\n      y: structure.y - (structure.height ?? 120) + (ambient.offsetY ?? -40),\r\n      radius: ambient.radius ?? 220,\r\n      intensity: ambient.intensity ?? 0.8,\r\n      color: ambient.color ?? \"#8cffd4\",\r\n      smoothing: ambient.smoothing ?? 10,\r\n      flicker: ambient.flicker ?? 0.25,\r\n      fov: ambient.fov,\r\n      direction: ambient.direction,\r\n      stretch: ambient.stretch ?? 0.5\r\n    });\r\n  }\r\n\r\n  for (const [id, light] of persistentLights.entries()) {\r\n    if (!light.active) {\r\n      persistentLights.delete(id);\r\n      continue;\r\n    }\r\n    const smoothing = clamp(light.smoothing ?? 12, 1, 60);\r\n    const lerp = clamp(delta * smoothing, 0, 1);\r\n    light.intensity += (light.targetIntensity - light.intensity) * lerp;\r\n    light.intensity = clampIntensity(light.intensity);\r\n    if (light.flicker > 0) {\r\n      light.intensity = clampIntensity(light.intensity + (Math.random() - 0.5) * light.flicker);\r\n    }\r\n  }\r\n\r\n  for (let i = transientLights.length - 1; i >= 0; i -= 1) {\r\n    const light = transientLights[i];\r\n    light.ttl -= delta;\r\n    if (light.ttl <= 0) {\r\n      transientLights.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawLighting() {\r\n  if (persistentLights.size === 0 && transientLights.length === 0) {\r\n    return;\r\n  }\r\n  context.save();\r\n  context.globalCompositeOperation = \"lighter\";\r\n  context.globalAlpha = 1;\r\n\r\n  for (const light of persistentLights.values()) {\r\n    const strength = clampIntensity(light.intensity);\r\n    if (strength <= 0.01) {\r\n      continue;\r\n    }\r\n    if (light.type === \"cone\") {\r\n      drawConeLight(light, strength);\r\n    } else {\r\n      drawPointLight(light, strength);\r\n    }\r\n  }\r\n\r\n  for (const light of transientLights) {\r\n    const ratio = clamp(light.ttl / light.maxTtl, 0, 1);\r\n    let strength = clampIntensity(light.intensity * Math.pow(ratio, light.decay ?? 1));\r\n    if (light.flicker > 0) {\r\n      strength = clampIntensity(strength + (Math.random() - 0.5) * light.flicker);\r\n    }\r\n    if (strength <= 0.01) {\r\n      continue;\r\n    }\r\n    if (light.type === \"cone\") {\r\n      drawConeLight(light, strength);\r\n    } else {\r\n      drawPointLight(light, strength);\r\n    }\r\n  }\r\n\r\n  context.restore();\r\n}\r\n\r\nexport { updateLighting, drawLighting, spawnDynamicLight };\r\n","import { context, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { GRAVITY } from \"../../config/constants.js\";\r\nimport { trainingDummy, enemies } from \"../../state/entities.js\";\r\nimport { applyDamageToDummy, applyDamageToEnemy } from \"./damageHandlers.js\";\r\nimport { handleProjectileCollision } from \"../world/destructibles.js\";\r\nimport { spawnDynamicLight } from \"../effects/lighting.js\";\r\nimport { spawnGroundDust, spawnImpactSparks } from \"../effects/particles.js\";\r\n\r\nconst projectiles = [];\r\n\r\nfunction spawnProjectile({\r\n  x,\r\n  y,\r\n  vx,\r\n  vy,\r\n  radius = 6,\r\n  lifetime = 1.4,\r\n  color = \"#ffcf7a\",\r\n  damage = 0,\r\n  knockback = 0,\r\n  facing = 1,\r\n  gravityFactor = 0.2\r\n}) {\r\n  projectiles.push({\r\n    x,\r\n    y,\r\n    vx,\r\n    vy,\r\n    radius,\r\n    life: lifetime,\r\n    maxLife: lifetime,\r\n    color,\r\n    damage,\r\n    knockback,\r\n    facing,\r\n    gravityFactor,\r\n    lightCooldown: 0,\r\n    hitTargets: new Set()\r\n  });\r\n}\r\n\r\nfunction circleOverlap(ax, ay, ar, bx, by, br) {\r\n  const dx = ax - bx;\r\n  const dy = ay - by;\r\n  const radii = ar + br;\r\n  return dx * dx + dy * dy <= radii * radii;\r\n}\r\n\r\nfunction updateProjectiles(delta) {\r\n  for (const projectile of projectiles) {\r\n    projectile.life -= delta;\r\n    projectile.vy += GRAVITY * delta * projectile.gravityFactor;\r\n    projectile.x += projectile.vx * delta;\r\n    projectile.y += projectile.vy * delta;\r\n    projectile.lightCooldown = Math.max(0, (projectile.lightCooldown ?? 0) - delta);\r\n    if (projectile.lightCooldown <= 0 && projectile.life > 0) {\r\n      const tracerRadius = Math.max(90, projectile.radius * 16);\r\n      spawnDynamicLight({\r\n        type: \"point\",\r\n        x: projectile.x,\r\n        y: projectile.y,\r\n        radius: tracerRadius,\r\n        intensity: 0.4 + Math.random() * 0.2,\r\n        color: projectile.color ?? \"#ffcf7a\",\r\n        ttl: 0.08,\r\n        flicker: 0.25,\r\n        decay: 1.3\r\n      });\r\n      projectile.lightCooldown = 0.05;\r\n    }\r\n\r\n    if (projectile.y + projectile.radius >= GROUND_Y) {\r\n      spawnGroundDust({\r\n        x: projectile.x,\r\n        y: GROUND_Y - 6,\r\n        amount: Math.round(5 + projectile.radius * 0.8),\r\n        speed: 120 + Math.abs(projectile.vx) * 0.3\r\n      });\r\n      projectile.life = 0;\r\n      continue;\r\n    }\r\n\r\n    if (trainingDummy.health > 0 && !projectile.hitTargets.has(trainingDummy.id)) {\r\n      if (circleOverlap(projectile.x, projectile.y, projectile.radius, trainingDummy.x, trainingDummy.y + trainingDummy.height * 0.55, trainingDummy.radius)) {\r\n        projectile.hitTargets.add(trainingDummy.id);\r\n        applyDamageToDummy({\r\n          damage: projectile.damage,\r\n          knockback: projectile.knockback,\r\n          facing: projectile.facing\r\n        });\r\n        projectile.life = 0;\r\n        continue;\r\n      }\r\n    }\r\n\r\n    for (const enemy of enemies) {\r\n      if (enemy.health <= 0 || projectile.hitTargets.has(enemy.id)) {\r\n        continue;\r\n      }\r\n      if (circleOverlap(projectile.x, projectile.y, projectile.radius, enemy.x, enemy.y + enemy.height * 0.5, enemy.radius)) {\r\n        projectile.hitTargets.add(enemy.id);\r\n        applyDamageToEnemy(enemy, {\r\n          damage: projectile.damage,\r\n          knockback: projectile.knockback,\r\n          launch: 0,\r\n          facing: projectile.facing\r\n        });\r\n        projectile.life = 0;\r\n        break;\r\n      }\r\n    }\r\n    if (projectile.life > 0) {\r\n      if (handleProjectileCollision(projectile)) {\r\n        spawnImpactSparks({\r\n          x: projectile.x,\r\n          y: projectile.y,\r\n          amount: Math.round(6 + Math.random() * 4),\r\n          speed: 220 + Math.abs(projectile.vx) * 0.4,\r\n          spread: Math.PI * 0.9,\r\n          angle: Math.atan2(projectile.vy, projectile.vx) + Math.PI\r\n        });\r\n        projectile.life = 0;\r\n        continue;\r\n      }\r\n    }\r\n  }\r\n\r\n  for (let i = projectiles.length - 1; i >= 0; i -= 1) {\r\n    if (projectiles[i].life <= 0) {\r\n      projectiles.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawProjectiles() {\r\n  if (projectiles.length === 0) {\r\n    return;\r\n  }\r\n  context.save();\r\n  context.lineWidth = 2;\r\n  for (const projectile of projectiles) {\r\n    const alpha = Math.max(0, projectile.life / projectile.maxLife);\r\n    context.fillStyle = `rgba(255, 200, 120, ${alpha})`;\r\n    context.beginPath();\r\n    context.arc(projectile.x, projectile.y, projectile.radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction clearProjectiles() {\r\n  projectiles.length = 0;\r\n}\r\n\r\nexport { spawnProjectile, updateProjectiles, drawProjectiles, clearProjectiles };\r\n\r\n","\r\nimport { context, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { GRAVITY } from \"../../config/constants.js\";\r\nimport { stickman, trainingDummy, enemies, getTotalHeight } from \"../../state/entities.js\";\r\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { getCurrentWeapon } from \"./weapons.js\";\r\nimport { damageDestructiblesInRadius } from \"../world/destructibles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { getElapsedTime } from \"../utils/time.js\";\r\nimport { applyExplosionImpulse } from \"./explosions.js\";\r\nimport { spawnExplosionDebris } from \"../effects/particles.js\";\r\n\r\nconst throwables = [];\r\nconst smokeClouds = [];\r\n\r\nfunction dispatchThrowableEvent(type, detail = {}) {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.dispatchEvent(new CustomEvent(type, { detail }));\r\n}\r\n\r\nfunction throwEquippedWeapon() {\r\n  const weapon = getCurrentWeapon();\r\n  if ((stickman.stunTimer ?? 0) > 0) {\r\n    return false;\r\n  }\r\n  if (!weapon || weapon.category !== \"throwable\") {\r\n    return false;\r\n  }\r\n  if (stickman.throwCooldown > 0 || stickman.health <= 0 || stickman.rolling) {\r\n    return false;\r\n  }\r\n\r\n  const config = weapon.throwable ?? {};\r\n  const aim = stickman.aim ?? null;\r\n  const rawDirX = Number.isFinite(aim?.vectorX) ? aim.vectorX : (stickman.facing || 1);\r\n  const rawDirY = Number.isFinite(aim?.vectorY) ? aim.vectorY : 0;\r\n  const normLength = Math.hypot(rawDirX, rawDirY) || 1;\r\n  const dirX = rawDirX / normLength;\r\n  const dirY = rawDirY / normLength;\r\n  const perpX = -dirY;\r\n  const perpY = dirX;\r\n\r\n  const anchorX = Number.isFinite(aim?.anchorX) ? aim.anchorX : stickman.x;\r\n  const anchorY = Number.isFinite(aim?.anchorY) ? aim.anchorY : stickman.y + 24;\r\n  const spawnOffset = config.spawnOffset ?? { x: 22, y: 12 };\r\n  const forwardOffset = spawnOffset.x ?? 22;\r\n  const verticalOffset = spawnOffset.y ?? 12;\r\n  const lateralOffset = spawnOffset.side ?? 0;\r\n\r\n  const envWidth = getEnvironmentWidth();\r\n  const spawnX = clamp(anchorX + dirX * forwardOffset + perpX * lateralOffset, 40, envWidth - 40);\r\n  const spawnY = anchorY + dirY * forwardOffset + perpY * lateralOffset + verticalOffset;\r\n\r\n  const arc = config.arcVelocity ?? { vx: 260, vy: -420 };\r\n  const forwardSpeed = arc.vx ?? 260;\r\n  const verticalBoost = arc.vy ?? -420;\r\n  const vx = dirX * forwardSpeed + perpX * (arc.side ?? 0);\r\n  const vy = dirY * forwardSpeed + perpY * (arc.side ?? 0) + verticalBoost;\r\n\r\n  stickman.throwCooldown = config.cooldownSeconds ?? 0.9;\r\n\r\n  const grenade = {\r\n    id: `grenade-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`,\r\n    x: spawnX,\r\n    y: spawnY,\r\n    vx,\r\n    vy,\r\n    radius: config.radius ?? 16,\r\n    fuse: config.fuseSeconds ?? 1.5,\r\n    maxFuse: config.fuseSeconds ?? 1.5,\r\n    explosionRadius: config.explosionRadius ?? 120,\r\n    damage: config.damage ?? 45,\r\n    knockback: config.knockback ?? 260,\r\n    gravityFactor: config.gravityFactor ?? 0.5,\r\n    bounciness: clamp(config.bounciness ?? 0.45, 0, 0.95),\r\n    color: config.color ?? \"#ffb347\",\r\n    explosionDuration: config.explosionDuration ?? 0.32,\r\n    selfDamageScale: clamp(config.selfDamageScale ?? 0.65, 0, 1),\r\n    selfKnockbackScale: clamp(config.selfKnockbackScale ?? 0.6, 0, 1),\r\n    effectType: config.effectType ?? \"explosive\",\r\n    stunDuration: config.stunDuration ?? 0,\r\n    playerStunDuration: config.playerStunDuration ?? 0,\r\n    smokeDuration: config.smokeDuration ?? 0,\r\n    smokeRadius: config.smokeRadius ?? (config.explosionRadius ?? 120),\r\n    smokeExpansion: config.smokeExpansion ?? 1.1,\r\n    smokeSlowMultiplier: clamp(config.smokeSlowMultiplier ?? 0.55, 0.1, 1),\r\n    smokeTickDuration: config.smokeTickDuration ?? 0.5,\r\n    detonated: false,\r\n    explosionTimer: 0\r\n  };\r\n\r\n  throwables.push(grenade);\r\n  dispatchThrowableEvent(\"throwable:thrown\", {\r\n    id: grenade.id,\r\n    effectType: grenade.effectType,\r\n    x: grenade.x,\r\n    y: grenade.y,\r\n    radius: grenade.explosionRadius,\r\n    fuse: grenade.fuse\r\n  });\r\n\r\n  return true;\r\n}\r\n\r\nfunction applyExplosiveDamage(grenade) {\r\n  const { x, y, explosionRadius, damage, knockback } = grenade;\r\n  applyExplosionImpulse({\r\n    x,\r\n    y,\r\n    radius: explosionRadius,\r\n    maxDamage: damage,\r\n    maxKnockback: knockback,\r\n    minDamageRatio: grenade.damageFalloff ?? 0.3,\r\n    selfDamageScale: grenade.selfDamageScale ?? 1,\r\n    selfKnockbackScale: grenade.selfKnockbackScale ?? 1\r\n  });\r\n\r\n  if (damage > 0) {\r\n    damageDestructiblesInRadius({\r\n      x,\r\n      y,\r\n      radius: explosionRadius,\r\n      maxDamage: damage,\r\n      minDamageRatio: grenade.destructibleFalloff ?? 0.35,\r\n      cause: grenade.effectType ?? \"explosion\"\r\n    });\r\n  }\r\n\r\n  spawnExplosionDebris({\r\n    x,\r\n    y,\r\n    radius: explosionRadius,\r\n    count: Math.max(10, Math.round(explosionRadius / 10)),\r\n    speed: 220 + Math.max(0, knockback ?? 0) * 0.5\r\n  });\r\n}\r\n\r\nfunction applyFlashEffect(grenade) {\r\n  const { x, y, explosionRadius, stunDuration, playerStunDuration } = grenade;\r\n  const duration = Math.max(0.1, stunDuration);\r\n\r\n  if (trainingDummy.health > 0) {\r\n    const dx = trainingDummy.x - x;\r\n    const dy = (trainingDummy.y + trainingDummy.height * 0.55) - y;\r\n    if (Math.hypot(dx, dy) <= explosionRadius) {\r\n      trainingDummy.flashTimer = Math.max(trainingDummy.flashTimer, duration * 0.6);\r\n      trainingDummy.shakeTimer = Math.max(trainingDummy.shakeTimer, duration * 0.5);\r\n      trainingDummy.shakeMagnitude = Math.max(trainingDummy.shakeMagnitude, 14);\r\n    }\r\n  }\r\n\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const dx = enemy.x - x;\r\n    const dy = (enemy.y + enemy.height * 0.5) - y;\r\n    if (Math.hypot(dx, dy) <= explosionRadius) {\r\n      enemy.stunTimer = Math.max(enemy.stunTimer ?? 0, duration);\r\n      enemy.flashTimer = Math.max(enemy.flashTimer, duration * 0.7);\r\n      enemy.shakeTimer = Math.max(enemy.shakeTimer, duration * 0.4);\r\n      enemy.shakeMagnitude = Math.max(enemy.shakeMagnitude, 12);\r\n    }\r\n  }\r\n\r\n  if (playerStunDuration > 0 && stickman.health > 0) {\r\n    const pose = stickman.currentPose ?? { headRadius: 16, bodyLength: 34, legLength: 36 };\r\n    const playerHeight = getTotalHeight(pose);\r\n    const playerCenterY = stickman.y + playerHeight * 0.6;\r\n    const dx = stickman.x - x;\r\n    const dy = playerCenterY - y;\r\n    if (Math.hypot(dx, dy) <= explosionRadius) {\r\n      stickman.flashBlindTimer = Math.max(stickman.flashBlindTimer ?? 0, playerStunDuration);\r\n      stickman.stunTimer = Math.max(stickman.stunTimer ?? 0, playerStunDuration * 0.6);\r\n    }\r\n  }\r\n}\r\n\r\nfunction spawnSmokeCloud(grenade) {\r\n  const duration = Math.max(0.5, grenade.smokeDuration);\r\n  const radius = Math.max(40, grenade.smokeRadius);\r\n  const cloud = {\r\n    id: `smoke-${Date.now()}-${Math.random().toString(36).slice(2, 5)}`,\r\n    x: grenade.x,\r\n    y: grenade.y,\r\n    radius,\r\n    baseRadius: radius,\r\n    maxRadius: radius * (grenade.smokeExpansion ?? 1.1),\r\n    duration,\r\n    life: duration,\r\n    slowMultiplier: clamp(grenade.smokeSlowMultiplier ?? 0.55, 0.1, 1),\r\n    tick: grenade.smokeTickDuration ?? 0.5,\r\n    tickTimer: 0\r\n  };\r\n  smokeClouds.push(cloud);\r\n  dispatchThrowableEvent(\"throwable:smoke-spawn\", {\r\n    id: cloud.id,\r\n    x: cloud.x,\r\n    y: cloud.y,\r\n    radius: cloud.radius,\r\n    maxRadius: cloud.maxRadius,\r\n    duration: cloud.duration\r\n  });\r\n  return cloud;\r\n}\r\n\r\nfunction detonate(grenade) {\r\n  if (grenade.detonated) {\r\n    return;\r\n  }\r\n\r\n  grenade.detonated = true;\r\n  grenade.explosionTimer = Math.max(grenade.explosionDuration, 0.08);\r\n  grenade.fuse = 0;\r\n\r\n  const baseDetail = {\r\n    id: grenade.id,\r\n    effectType: grenade.effectType,\r\n    x: grenade.x,\r\n    y: grenade.y,\r\n    radius: grenade.explosionRadius\r\n  };\r\n\r\n  switch (grenade.effectType) {\r\n    case \"flash\": {\r\n      applyFlashEffect(grenade);\r\n      baseDetail.radius = grenade.explosionRadius;\r\n      baseDetail.stunDuration = grenade.stunDuration;\r\n      baseDetail.playerStunDuration = grenade.playerStunDuration;\r\n      dispatchThrowableEvent(\"throwable:flash-burst\", {\r\n        ...baseDetail,\r\n        stunDuration: grenade.stunDuration,\r\n        playerStunDuration: grenade.playerStunDuration\r\n      });\r\n      break;\r\n    }\r\n    case \"smoke\": {\r\n      const cloud = spawnSmokeCloud(grenade);\r\n      baseDetail.radius = cloud.maxRadius;\r\n      baseDetail.duration = cloud.duration;\r\n      baseDetail.cloudId = cloud.id;\r\n      dispatchThrowableEvent(\"throwable:smoke-detonate\", {\r\n        ...baseDetail,\r\n        radius: cloud.maxRadius,\r\n        duration: cloud.duration,\r\n        cloudId: cloud.id\r\n      });\r\n      break;\r\n    }\r\n    default: {\r\n      applyExplosiveDamage(grenade);\r\n      baseDetail.damage = grenade.damage;\r\n      baseDetail.knockback = grenade.knockback;\r\n      dispatchThrowableEvent(\"throwable:explosion\", {\r\n        ...baseDetail,\r\n        damage: grenade.damage,\r\n        knockback: grenade.knockback\r\n      });\r\n      break;\r\n    }\r\n  }\r\n\r\n  dispatchThrowableEvent(\"throwable:detonate\", baseDetail);\r\n}\r\n\r\nfunction updateSmokeClouds(delta) {\r\n  for (const cloud of smokeClouds) {\r\n    cloud.life = Math.max(0, cloud.life - delta);\r\n    const progress = 1 - cloud.life / cloud.duration;\r\n    cloud.radius = clamp(cloud.baseRadius + (cloud.maxRadius - cloud.baseRadius) * clamp(progress, 0, 1), cloud.baseRadius, cloud.maxRadius);\r\n    cloud.tickTimer -= delta;\r\n    if (cloud.tickTimer <= 0) {\r\n      cloud.tickTimer = cloud.tick;\r\n      const effectiveRadius = cloud.radius;\r\n      for (const enemy of enemies) {\r\n        if (enemy.health <= 0) {\r\n          continue;\r\n        }\r\n        const dx = enemy.x - cloud.x;\r\n        const dy = (enemy.y + enemy.height * 0.5) - cloud.y;\r\n        if (Math.hypot(dx, dy) <= effectiveRadius) {\r\n          enemy.smokeSlowTimer = Math.max(enemy.smokeSlowTimer ?? 0, cloud.tick + 0.4);\r\n          enemy.smokeSlowStrength = Math.min(enemy.smokeSlowStrength ?? 1, cloud.slowMultiplier);\r\n        }\r\n      }\r\n      const pose = stickman.currentPose ?? { headRadius: 16, bodyLength: 34, legLength: 36 };\r\n      const playerHeight = getTotalHeight(pose);\r\n      const playerCenterY = stickman.y + playerHeight * 0.6;\r\n      const pdx = stickman.x - cloud.x;\r\n      const pdy = playerCenterY - cloud.y;\r\n      if (Math.hypot(pdx, pdy) <= effectiveRadius) {\r\n        stickman.smokeSlowTimer = Math.max(stickman.smokeSlowTimer ?? 0, cloud.tick + 0.4);\r\n        stickman.smokeSlowStrength = Math.min(stickman.smokeSlowStrength ?? 1, cloud.slowMultiplier + 0.1);\r\n      }\r\n    }\r\n  }\r\n\r\n  for (let i = smokeClouds.length - 1; i >= 0; i -= 1) {\r\n    if (smokeClouds[i].life <= 0) {\r\n      const dissipated = smokeClouds.splice(i, 1)[0];\r\n      dispatchThrowableEvent(\"throwable:smoke-dissipate\", {\r\n        id: dissipated.id,\r\n        x: dissipated.x,\r\n        y: dissipated.y,\r\n        radius: dissipated.maxRadius ?? dissipated.radius\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateThrowables(delta) {\r\n  const envWidth = getEnvironmentWidth();\r\n\r\n  for (const grenade of throwables) {\r\n    if (!grenade.detonated) {\r\n      grenade.fuse -= delta;\r\n      grenade.vy += GRAVITY * grenade.gravityFactor * delta;\r\n      grenade.x += grenade.vx * delta;\r\n      grenade.y += grenade.vy * delta;\r\n\r\n      if (grenade.y + grenade.radius >= GROUND_Y) {\r\n        grenade.y = GROUND_Y - grenade.radius;\r\n        if (grenade.vy > 0) {\r\n          grenade.vy = -grenade.vy * grenade.bounciness;\r\n        }\r\n        grenade.vx *= 0.7;\r\n        if (Math.abs(grenade.vy) < 36) {\r\n          grenade.vy = 0;\r\n        }\r\n      }\r\n\r\n      if (grenade.x - grenade.radius <= 0 || grenade.x + grenade.radius >= envWidth) {\r\n        grenade.x = clamp(grenade.x, grenade.radius, envWidth - grenade.radius);\r\n        grenade.vx = -grenade.vx * 0.45;\r\n      }\r\n\r\n      if (grenade.fuse <= 0) {\r\n        detonate(grenade);\r\n      }\r\n    } else {\r\n      grenade.explosionTimer -= delta;\r\n    }\r\n  }\r\n\r\n  for (let i = throwables.length - 1; i >= 0; i -= 1) {\r\n    if (throwables[i].detonated && throwables[i].explosionTimer <= 0) {\r\n      throwables.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  updateSmokeClouds(delta);\r\n}\r\n\r\nfunction drawSmokeClouds() {\r\n  if (smokeClouds.length === 0) {\r\n    return;\r\n  }\r\n\r\n  context.save();\r\n  for (const cloud of smokeClouds) {\r\n    const lifeRatio = clamp(cloud.life / cloud.duration, 0, 1);\r\n    const radius = cloud.radius;\r\n    const gradient = context.createRadialGradient(cloud.x, cloud.y, radius * 0.15, cloud.x, cloud.y, radius);\r\n    gradient.addColorStop(0, \"rgba(172, 196, 216, 0.35)\");\r\n    gradient.addColorStop(1, \"rgba(40, 52, 64, 0)\");\r\n    context.globalAlpha = lifeRatio;\r\n    context.fillStyle = gradient;\r\n    context.beginPath();\r\n    context.arc(cloud.x, cloud.y, radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction drawThrowables() {\r\n  const elapsed = getElapsedTime();\r\n  context.save();\r\n\r\n  for (const grenade of throwables) {\r\n    if (!grenade.detonated) {\r\n      context.globalAlpha = 1;\r\n      context.fillStyle = grenade.color;\r\n      context.beginPath();\r\n      context.arc(grenade.x, grenade.y, grenade.radius, 0, Math.PI * 2);\r\n      context.fill();\r\n\r\n      const fuseRatio = grenade.maxFuse > 0 ? clamp(grenade.fuse / grenade.maxFuse, 0, 1) : 0;\r\n      context.strokeStyle = \"rgba(255, 232, 194, 0.85)\";\r\n      context.lineWidth = 3;\r\n      context.beginPath();\r\n      context.arc(grenade.x, grenade.y, grenade.radius * 0.65, -Math.PI / 2, -Math.PI / 2 + Math.PI * 2 * fuseRatio);\r\n      context.stroke();\r\n\r\n      const sparkOffsetX = Math.cos(elapsed * 20) * grenade.radius * 0.4;\r\n      const sparkOffsetY = Math.sin(elapsed * 24) * grenade.radius * 0.2 - grenade.radius * 0.8;\r\n      context.fillStyle = \"rgba(255, 240, 210, 0.9)\";\r\n      context.beginPath();\r\n      context.arc(grenade.x + sparkOffsetX, grenade.y + sparkOffsetY, 3.2, 0, Math.PI * 2);\r\n      context.fill();\r\n    } else {\r\n      const duration = Math.max(grenade.explosionDuration, 0.001);\r\n      const progress = clamp(1 - grenade.explosionTimer / duration, 0, 1);\r\n      const alpha = clamp(1 - progress, 0, 1);\r\n\r\n      if (grenade.effectType === \"flash\") {\r\n        const flashRadius = grenade.explosionRadius * (0.8 + progress * 0.5);\r\n        const flashAlpha = Math.max(0, Math.min(1, 0.75 * alpha + 0.15));\r\n        context.fillStyle = `rgba(255, 255, 224, ${flashAlpha.toFixed(3)})`;\r\n        context.beginPath();\r\n        context.arc(grenade.x, grenade.y, flashRadius, 0, Math.PI * 2);\r\n        context.fill();\r\n      } else if (grenade.effectType === \"smoke\") {\r\n        const puffRadius = grenade.explosionRadius * (0.6 + progress * 0.6);\r\n        const puffAlpha = Math.max(0, Math.min(0.65, 0.5 * alpha + 0.1));\r\n        context.fillStyle = `rgba(180, 200, 220, ${puffAlpha.toFixed(3)})`;\r\n        context.beginPath();\r\n        context.arc(grenade.x, grenade.y, puffRadius, 0, Math.PI * 2);\r\n        context.fill();\r\n      } else {\r\n        const outerRadius = grenade.explosionRadius * (0.65 + progress * 0.4);\r\n        const ringAlpha = Math.max(0, Math.min(1, 0.7 * alpha));\r\n        context.strokeStyle = `rgba(255, 196, 120, ${ringAlpha.toFixed(3)})`;\r\n        context.lineWidth = 6 * (1 - progress * 0.6);\r\n        context.beginPath();\r\n        context.arc(grenade.x, grenade.y, outerRadius, 0, Math.PI * 2);\r\n        context.stroke();\r\n\r\n        const coreAlpha = Math.max(0, Math.min(1, 0.75 * alpha));\r\n        context.fillStyle = `rgba(255, 118, 64, ${coreAlpha.toFixed(3)})`;\r\n        context.beginPath();\r\n        context.arc(grenade.x, grenade.y, outerRadius * 0.6, 0, Math.PI * 2);\r\n        context.fill();\r\n      }\r\n    }\r\n  }\r\n\r\n  context.restore();\r\n  drawSmokeClouds();\r\n}\r\n\r\nexport { throwEquippedWeapon, updateThrowables, drawThrowables };\r\n\r\n\r\n\r\n\r\n\r\n\r\n","let activeCamera = null;\n\nconst performanceStats = {\n  enemiesTotal: 0,\n  enemiesCulled: 0,\n  squadTotal: 0,\n  squadCulled: 0,\n  remoteTotal: 0,\n  remoteCulled: 0,\n  vehicleTotal: 0,\n  vehicleCulled: 0,\n  destructibleTotal: 0,\n  destructibleCulled: 0,\n  interactableTotal: 0,\n  interactableCulled: 0,\n  buildingTotal: 0,\n  buildingCulled: 0,\n  resourceTotal: 0,\n  resourceCulled: 0\n};\n\nfunction resetPerformanceStats() {\n  for (const key of Object.keys(performanceStats)) {\n    performanceStats[key] = 0;\n  }\n}\n\nfunction setActiveCamera(camera) {\n  activeCamera = camera || null;\n}\n\nfunction getActiveCamera() {\n  return activeCamera;\n}\n\nfunction isWithinView(x, halfWidth = 0, margin = 240) {\n  const camera = activeCamera;\n  if (!camera) {\n    return true;\n  }\n  const left = (camera.left ?? 0) - margin;\n  const right = (camera.right ?? ((camera.left ?? 0) + ((camera.halfWidth ?? 0) * 2))) + margin;\n  const min = x - halfWidth;\n  const max = x + halfWidth;\n  return max >= left && min <= right;\n}\n\nfunction recordVisibility(prefix, culled) {\n  const totalKey = `${prefix}Total`;\n  const culledKey = `${prefix}Culled`;\n  if (Object.prototype.hasOwnProperty.call(performanceStats, totalKey)) {\n    performanceStats[totalKey] += 1;\n    if (culled && Object.prototype.hasOwnProperty.call(performanceStats, culledKey)) {\n      performanceStats[culledKey] += 1;\n    }\n  }\n}\n\nexport { setActiveCamera, getActiveCamera, isWithinView, resetPerformanceStats, recordVisibility, performanceStats };\r\n","const SUPPLY_DROP_TYPES = {\r\n  ammo: {\r\n    id: \"ammo\",\r\n    label: \"Ammo Cache\",\r\n    description: \"Refills magazines and reserves for all weapons.\",\r\n    weight: 0.45,\r\n    crateColor: \"#4d7cff\",\r\n    glowColor: \"#b5c8ff\",\n    materialsReward: 20\r\n  },\r\n  medkit: {\r\n    id: \"medkit\",\r\n    label: \"Field Medkit\",\r\n    description: \"Restores health and grants brief damage resistance.\",\r\n    weight: 0.35,\r\n    crateColor: \"#ff6f6f\",\r\n    glowColor: \"#ffb4b4\",\n    materialsReward: 25\r\n  },\r\n  heavy: {\r\n    id: \"heavy\",\r\n    label: \"Heavy Arsenal\",\r\n    description: \"Drops a powerful heavy weapon with fresh ammo.\",\r\n    weight: 0.2,\r\n    crateColor: \"#ffb347\",\r\n    glowColor: \"#ffe0a3\",\n    weaponId: \"thunderCannon\",\n    materialsReward: 35,\r\n    weaponId: \"thunderCannon\"\r\n  }\r\n};\r\n\r\nconst SUPPLY_DROP_SETTINGS = {\r\n  initialDelay: 18,\r\n  intervalMin: 26,\r\n  intervalMax: 38,\r\n  maxActiveDrops: 3,\r\n  spawnHeight: 280,\r\n  driftSpeed: 18,\r\n  descentAcceleration: 140,\r\n  maxDescentSpeed: 180,\r\n  pickupRadius: 68,\r\n  despawnDelay: 12,\r\n  collectedFanfare: 3.5,\r\n  warningLead: 6,\r\n  armorBoostDuration: 6,\r\n  armorBoostValue: 0.4\r\n};\r\n\r\nexport { SUPPLY_DROP_TYPES, SUPPLY_DROP_SETTINGS };\r\n","import { addMaterials, spawnSalvagePickup } from \"../../state/resources.js\";\r\n\r\nimport { canvas, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { stickman, getTotalHeight } from \"../../state/entities.js\";\r\nimport { WEAPON_DEFINITIONS } from \"../../config/weapons.js\";\r\nimport { SUPPLY_DROP_TYPES, SUPPLY_DROP_SETTINGS } from \"../../config/supplyDrops.js\";\r\nimport { ensureAmmoEntry, refillWeaponAmmo } from \"../../state/ammo.js\";\r\nimport { getWeaponInventory, addWeaponToInventory } from \"../../state/weapons.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst supplyDrops = [];\r\nconst manager = {\r\n  nextDropTimer: SUPPLY_DROP_SETTINGS.initialDelay,\r\n  nextDropTypeId: chooseWeightedType(),\r\n  incomingMessage: null,\r\n  incomingTimer: 0,\r\n  incomingDuration: 3,\r\n  rewardMessage: null,\r\n  rewardTimer: 0,\r\n  rewardDuration: SUPPLY_DROP_SETTINGS.collectedFanfare,\r\n  dropSequence: 0\r\n};\r\n\r\nfunction randomBetween(min, max) {\r\n  return min + Math.random() * (max - min);\r\n}\r\n\r\nfunction chooseWeightedType() {\r\n  const entries = Object.values(SUPPLY_DROP_TYPES);\r\n  if (entries.length === 0) {\r\n    return null;\r\n  }\r\n  const totalWeight = entries.reduce((sum, entry) => sum + (entry.weight ?? 1), 0);\r\n  let roll = Math.random() * totalWeight;\r\n  for (const entry of entries) {\r\n    const weight = entry.weight ?? 1;\r\n    if (roll <= weight) {\r\n      return entry.id;\r\n    }\r\n    roll -= weight;\r\n  }\r\n  return entries[entries.length - 1].id;\r\n}\r\n\r\nfunction scheduleNextDrop() {\r\n  manager.nextDropTimer = randomBetween(SUPPLY_DROP_SETTINGS.intervalMin, SUPPLY_DROP_SETTINGS.intervalMax);\r\n  manager.nextDropTypeId = chooseWeightedType();\r\n}\r\n\r\nfunction spawnSupplyDrop(typeId) {\r\n  const definition = SUPPLY_DROP_TYPES[typeId] ?? SUPPLY_DROP_TYPES.ammo;\r\n  const width = 52;\r\n  const height = 42;\r\n  const envWidth = getEnvironmentWidth();\n  const clampedWidth = Math.max(width * 0.6, envWidth * 0.05);\n  const dropRange = Math.max(0, envWidth - clampedWidth * 2);\n  const x = clamp(envWidth * (0.2 + Math.random() * 0.6), clampedWidth, envWidth - clampedWidth);\r\n  const spawnY = -SUPPLY_DROP_SETTINGS.spawnHeight;\r\n  const drop = {\r\n    id: `supply-${manager.dropSequence += 1}`,\r\n    typeId: definition.id,\r\n    label: definition.label,\r\n    description: definition.description,\r\n    crateColor: definition.crateColor ?? \"#4d7cff\",\r\n    glowColor: definition.glowColor ?? \"#9ab5ff\",\r\n    width,\r\n    height,\r\n    x,\r\n    y: spawnY,\r\n    vx: (Math.random() * 2 - 1) * SUPPLY_DROP_SETTINGS.driftSpeed,\r\n    vy: 0,\r\n    state: \"descending\",\r\n    timer: 0,\r\n    highlight: 0,\r\n    despawnTimer: SUPPLY_DROP_SETTINGS.despawnDelay,\r\n    parachutePhase: 0\r\n  };\r\n  supplyDrops.push(drop);\r\n  manager.incomingMessage = `${definition.label} inbound!`;\r\n  manager.incomingTimer = manager.incomingDuration;\r\n}\r\n\r\nfunction applyAmmoReward() {\r\n  const inventory = getWeaponInventory();\r\n  for (const weaponId of inventory) {\r\n    const entry = ensureAmmoEntry(weaponId);\r\n    if (!entry || entry.capacity === Number.POSITIVE_INFINITY) {\r\n      continue;\r\n    }\r\n    refillWeaponAmmo(weaponId);\r\n  }\r\n  stickman.reloading = false;\r\n}\r\n\r\nfunction applyMedkitReward() {\r\n  const healAmount = 70;\r\n  stickman.health = Math.min(stickman.maxHealth, stickman.health + healAmount);\r\n  stickman.invulnerability = Math.max(stickman.invulnerability, SUPPLY_DROP_SETTINGS.armorBoostValue ?? 0.4);\r\n}\r\n\r\nfunction applyHeavyWeaponReward() {\r\n  const heavyType = SUPPLY_DROP_TYPES.heavy;\r\n  const weaponId = heavyType?.weaponId ?? null;\r\n  if (weaponId && WEAPON_DEFINITIONS[weaponId]) {\r\n    addWeaponToInventory(weaponId, { autoEquip: true });\r\n    ensureAmmoEntry(weaponId);\r\n    refillWeaponAmmo(weaponId);\r\n  }\r\n}\r\n\r\nfunction applySupplyDropReward(typeId) {\r\n  switch (typeId) {\r\n    case \"medkit\":\r\n      applyMedkitReward();\r\n      manager.rewardMessage = \"Health restored\";\r\n      break;\r\n    case \"heavy\":\r\n      applyHeavyWeaponReward();\r\n      manager.rewardMessage = \"Heavy weapon acquired\";\r\n      break;\r\n    case \"ammo\":\r\n    default:\r\n      applyAmmoReward();\r\n      manager.rewardMessage = \"Ammo resupply\";\r\n      break;\r\n  }\r\n  manager.rewardTimer = manager.rewardDuration;\r\n  const rewardType = SUPPLY_DROP_TYPES[typeId];\r\n  if (rewardType?.materialsReward) {\r\n    const immediateGain = Math.max(0, Math.round(rewardType.materialsReward * 0.7));\r\n    if (immediateGain > 0) {\r\n      addMaterials(immediateGain);\r\n      manager.rewardMessage = `${manager.rewardMessage} (+${immediateGain} materials)`;\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateHighlight(drop, delta) {\r\n  const playerX = stickman.x;\r\n  const pose = stickman.currentPose ?? POSES.standing;\r\n  const playerFeetY = stickman.y + getTotalHeight(pose);\r\n  const crateCenterX = drop.x;\r\n  const crateCenterY = drop.y + drop.height * 0.5;\r\n  const dx = playerX - crateCenterX;\r\n  const dy = playerFeetY - crateCenterY;\r\n  const distance = Math.hypot(dx, dy);\r\n  if (distance <= SUPPLY_DROP_SETTINGS.pickupRadius) {\r\n    drop.highlight = clamp(drop.highlight + delta * 4, 0, 1);\r\n    return true;\r\n  }\r\n  drop.highlight = clamp(drop.highlight - delta * 2, 0, 1);\r\n  return false;\r\n}\r\n\r\nfunction pickupDrop(drop) {\r\n  applySupplyDropReward(drop.typeId);\r\n  drop.state = \"collected\";\r\n  drop.despawnTimer = SUPPLY_DROP_SETTINGS.collectedFanfare;\r\n  drop.highlight = 1;\r\n  const rewardMaterials = SUPPLY_DROP_TYPES[drop.typeId]?.materialsReward ?? 0;\r\n  if (rewardMaterials > 0) {\r\n    const salvagePortion = Math.max(0, Math.round(rewardMaterials * 0.3));\r\n    if (salvagePortion > 0) {\r\n      const chunks = Math.max(1, Math.round(salvagePortion / 12));\r\n      const amountPer = Math.max(1, Math.round(salvagePortion / chunks));\r\n      for (let i = 0; i < chunks; i += 1) {\r\n        const jitter = (Math.random() - 0.5) * 60;\r\n        spawnSalvagePickup({\r\n          x: drop.x + jitter,\r\n          y: drop.y,\r\n          amount: amountPer,\r\n          vy: -160 - Math.random() * 60\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\nfunction updateSupplyDrops(delta) {\r\n  if (manager.nextDropTimer <= 0 && supplyDrops.length < SUPPLY_DROP_SETTINGS.maxActiveDrops) {\r\n    spawnSupplyDrop(manager.nextDropTypeId);\r\n    scheduleNextDrop();\r\n  }\r\n\r\n  if (manager.incomingTimer > 0) {\r\n    manager.incomingTimer = Math.max(0, manager.incomingTimer - delta);\r\n  }\r\n  if (manager.rewardTimer > 0) {\r\n    manager.rewardTimer = Math.max(0, manager.rewardTimer - delta);\r\n  }\r\n\r\n  for (let i = supplyDrops.length - 1; i >= 0; i -= 1) {\r\n    const drop = supplyDrops[i];\r\n    drop.timer += delta;\r\n    if (drop.state === \"descending\") {\r\n      drop.vy = Math.min(SUPPLY_DROP_SETTINGS.maxDescentSpeed, drop.vy + SUPPLY_DROP_SETTINGS.descentAcceleration * delta);\r\n      drop.y += drop.vy * delta;\r\n      const envWidth = getEnvironmentWidth();\n      drop.x = clamp(drop.x + drop.vx * delta, drop.width * 0.5, envWidth - drop.width * 0.5);\r\n      drop.parachutePhase += delta;\r\n      if (drop.y >= GROUND_Y - drop.height) {\r\n        drop.y = GROUND_Y - drop.height;\r\n        drop.vy = 0;\r\n        drop.state = \"ready\";\r\n        drop.timer = 0;\r\n      }\r\n    } else if (drop.state === \"ready\") {\r\n      const withinPickup = updateHighlight(drop, delta);\r\n      if (withinPickup) {\r\n        pickupDrop(drop);\r\n      } else {\r\n        drop.despawnTimer -= delta;\r\n        if (drop.despawnTimer <= 0) {\r\n          supplyDrops.splice(i, 1);\r\n          continue;\r\n        }\r\n      }\r\n    } else if (drop.state === \"collected\") {\r\n      drop.highlight = clamp(drop.highlight - delta * 0.6, 0, 1);\r\n      drop.despawnTimer -= delta;\r\n      if (drop.despawnTimer <= 0) {\r\n        supplyDrops.splice(i, 1);\r\n        continue;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction getSupplyDrops() {\r\n  return supplyDrops;\r\n}\r\n\r\nfunction getSupplyDropStatus() {\r\n  return {\r\n    timeUntilNext: Math.max(0, manager.nextDropTimer),\r\n    nextDropLabel: SUPPLY_DROP_TYPES[manager.nextDropTypeId]?.label ?? null,\r\n    incomingMessage: manager.incomingTimer > 0 ? manager.incomingMessage : null,\r\n    incomingAlpha: manager.incomingTimer > 0 ? manager.incomingTimer / manager.incomingDuration : 0,\r\n    rewardMessage: manager.rewardTimer > 0 ? manager.rewardMessage : null,\r\n    rewardAlpha: manager.rewardTimer > 0 ? manager.rewardTimer / manager.rewardDuration : 0,\r\n    activeCount: supplyDrops.length\r\n  };\r\n}\r\n\r\nexport { updateSupplyDrops, getSupplyDrops, getSupplyDropStatus };\r\n\r\n","\r\nimport { context } from \"../../environment/canvas.js\";\r\nimport { isWithinView, recordVisibility } from \"./culling.js\";\r\nimport { SUPPLY_DROP_SETTINGS, SUPPLY_DROP_TYPES } from \"../../config/supplyDrops.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { getSupplyDrops } from \"../world/supplyDrops.js\";\r\n\r\nfunction drawCrate(drop) {\r\n  const baseAlpha = drop.state === \"collected\" ? clamp(drop.despawnTimer / SUPPLY_DROP_SETTINGS.collectedFanfare, 0, 1) : 1;\r\n  context.save();\r\n  context.globalAlpha = baseAlpha;\r\n\r\n  if (drop.state === \"descending\") {\r\n    const parachuteWidth = drop.width * 1.8;\r\n    const canopyHeight = drop.height * 0.9;\r\n    context.fillStyle = drop.glowColor;\r\n    context.beginPath();\r\n    context.moveTo(drop.x - parachuteWidth * 0.5, drop.y + canopyHeight * 0.2);\r\n    context.quadraticCurveTo(drop.x, drop.y - canopyHeight * 0.8, drop.x + parachuteWidth * 0.5, drop.y + canopyHeight * 0.2);\r\n    context.closePath();\r\n    context.fill();\r\n\r\n    context.strokeStyle = drop.glowColor;\r\n    context.lineWidth = 2;\r\n    context.beginPath();\r\n    context.moveTo(drop.x - parachuteWidth * 0.3, drop.y + canopyHeight * 0.25);\r\n    context.lineTo(drop.x - drop.width * 0.25, drop.y + drop.height * 0.1);\r\n    context.moveTo(drop.x + parachuteWidth * 0.3, drop.y + canopyHeight * 0.25);\r\n    context.lineTo(drop.x + drop.width * 0.25, drop.y + drop.height * 0.1);\r\n    context.stroke();\r\n  }\r\n\r\n  const topColor = drop.glowColor;\r\n  const bodyColor = drop.crateColor;\r\n  const highlightAlpha = drop.highlight ?? 0;\r\n\r\n  context.fillStyle = bodyColor;\r\n  context.fillRect(drop.x - drop.width * 0.5, drop.y, drop.width, drop.height);\r\n  context.fillStyle = topColor;\r\n  context.fillRect(drop.x - drop.width * 0.5, drop.y - drop.height * 0.25, drop.width, drop.height * 0.25);\r\n\r\n  context.strokeStyle = \"rgba(12, 16, 24, 0.65)\";\r\n  context.lineWidth = 3;\r\n  context.strokeRect(drop.x - drop.width * 0.5, drop.y, drop.width, drop.height);\r\n\r\n  if (highlightAlpha > 0) {\r\n    context.globalAlpha = highlightAlpha * 0.6;\r\n    context.fillStyle = drop.glowColor;\r\n    context.beginPath();\r\n    context.arc(drop.x, drop.y + drop.height * 0.5, SUPPLY_DROP_SETTINGS.pickupRadius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n\r\n  context.restore();\r\n}\r\n\r\nfunction drawSupplyDrops() {\r\n  const drops = getSupplyDrops();\r\n  if (drops.length === 0) {\r\n    return;\r\n  }\r\n\r\n  context.save();\r\n  context.textAlign = \"center\";\r\n  context.font = \"15px 'Segoe UI', Arial, sans-serif\";\r\n\r\n  for (const drop of drops) {\r\n    const culled = !isWithinView(drop.x, 60, 360);\r\n    recordVisibility(\"resource\", culled);\r\n    if (culled) {\r\n      continue;\r\n    }\r\n    drawCrate(drop);\r\n    const typeDef = SUPPLY_DROP_TYPES[drop.typeId];\r\n    if (drop.state !== \"descending\") {\r\n      context.fillStyle = drop.glowColor;\r\n      context.globalAlpha = 0.9;\r\n      context.fillText(typeDef?.label ?? drop.label ?? \"Supply Drop\", drop.x, drop.y - 16);\r\n    }\r\n  }\r\n\r\n  context.restore();\r\n}\r\n\r\nexport { drawSupplyDrops };\r\n","import { POSES } from \"../../config/constants.js\";\r\nimport { stickman, squadmates, enemies } from \"../../state/entities.js\";\r\nimport { vehicles, VEHICLE_DEFINITIONS } from \"../../state/vehicles.js\";\r\nimport { pointer, refreshPointerWorld, input } from \"../input/index.js\";\r\nimport { getCamera } from \"../../state/camera.js\";\r\n\r\nconst POINTER_INACTIVE_TIMEOUT = Number.POSITIVE_INFINITY;\r\nconst POINTER_DEADZONE = 4;\r\n\r\nfunction normalizeAngle(angle) {\r\n  let result = angle;\r\n  while (result <= -Math.PI) {\r\n    result += Math.PI * 2;\r\n  }\r\n  while (result > Math.PI) {\r\n    result -= Math.PI * 2;\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction shortestAngleDiff(current, target) {\r\n  return normalizeAngle(target - current);\r\n}\r\n\r\nfunction dampAngle(current, target, smoothing, delta) {\r\n  const diff = shortestAngleDiff(current, target);\r\n  if (!Number.isFinite(diff)) {\r\n    return target;\r\n  }\r\n  const rate = Math.max(0, smoothing ?? 0.18);\r\n  const factor = 1 - Math.exp(-rate * Math.max(delta, 0));\r\n  return normalizeAngle(current + diff * factor);\r\n}\r\n\r\nfunction ensureAimRecord(record, fallbackSmoothing = 0.18) {\r\n  if (!record) {\r\n    return {\r\n      angle: 0,\r\n      targetAngle: 0,\r\n      vectorX: 1,\r\n      vectorY: 0,\r\n      magnitude: 0,\r\n      anchorX: 0,\r\n      anchorY: 0,\r\n      targetX: 0,\r\n      targetY: 0,\r\n      smoothing: fallbackSmoothing,\r\n      active: false,\r\n      lastUpdated: 0\r\n    };\r\n  }\r\n  if (typeof record.smoothing !== \"number\") {\r\n    record.smoothing = fallbackSmoothing;\r\n  }\r\n  return record;\r\n}\r\n\r\nfunction updateAimRecord(record, { targetAngle, targetX, targetY, anchorX, anchorY, smoothing, active }, delta) {\r\n  const aim = ensureAimRecord(record, smoothing);\r\n  const now = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n  const nextAngle = dampAngle(aim.angle ?? targetAngle, targetAngle, smoothing ?? aim.smoothing, delta);\r\n  const vectorX = Math.cos(nextAngle);\r\n  const vectorY = Math.sin(nextAngle);\r\n  aim.targetAngle = targetAngle;\r\n  aim.angle = nextAngle;\r\n  aim.vectorX = Number.isFinite(vectorX) ? vectorX : 1;\r\n  aim.vectorY = Number.isFinite(vectorY) ? vectorY : 0;\r\n  aim.anchorX = anchorX;\r\n  aim.anchorY = anchorY;\r\n  aim.targetX = targetX;\r\n  aim.targetY = targetY;\r\n  aim.magnitude = Math.hypot(targetX - anchorX, targetY - anchorY);\r\n  aim.active = Boolean(active);\r\n  aim.lastUpdated = now;\r\n  return aim;\r\n}\r\n\r\nfunction getPointerWorld() {\r\n  const camera = getCamera();\r\n  const offsetX = camera?.offsetX ?? 0;\r\n  const offsetY = camera?.y ?? 0;\r\n  return {\r\n    x: pointer.screenX + offsetX,\r\n    y: pointer.screenY + offsetY\r\n  };\r\n}\r\n\r\nfunction pointerIsActive(now) {\r\n  if (!pointer.active) {\r\n    return false;\r\n  }\r\n  if (!Number.isFinite(POINTER_INACTIVE_TIMEOUT)) {\r\n    return true;\r\n  }\r\n  const last = pointer.lastUpdate ?? 0;\r\n  return now - last <= POINTER_INACTIVE_TIMEOUT;\r\n}\r\n\r\nfunction getFallbackAngle() {\r\n  if (input.left && !input.right) {\r\n    return Math.PI;\r\n  }\r\n  if (input.right && !input.left) {\r\n    return 0;\r\n  }\r\n  if (input.down && !stickman.onGround) {\r\n    return Math.PI * 0.5;\r\n  }\r\n  if (stickman.vx && Math.abs(stickman.vx) > 6) {\r\n    return stickman.vx > 0 ? 0 : Math.PI;\r\n  }\r\n  return stickman.facing >= 0 ? 0 : Math.PI;\r\n}\r\n\r\nfunction getShoulderAnchor(entity, pose) {\r\n  const resolvedPose = pose ?? POSES.standing;\r\n  const headRadius = resolvedPose.headRadius ?? 16;\r\n  const shoulderYOffset = resolvedPose.armLength ? resolvedPose.armLength * 0.2 : 6;\r\n  const neckY = entity.y + headRadius * 2;\r\n  const shoulderY = neckY + shoulderYOffset;\r\n  return {\r\n    x: entity.x,\r\n    y: shoulderY\r\n  };\r\n}\r\n\r\nfunction updatePlayerAim(delta) {\r\n  const now = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n  const pose = stickman.rolling ? POSES.rolling : (stickman.crouching ? POSES.crouching : POSES.standing);\r\n  const anchor = getShoulderAnchor(stickman, pose);\r\n  const pointerWorld = getPointerWorld();\r\n  const pointerVectorX = pointerWorld.x - anchor.x;\r\n  const pointerVectorY = pointerWorld.y - anchor.y;\r\n  const pointerDistance = Math.hypot(pointerVectorX, pointerVectorY);\r\n  const pointerHasSignal = (pointer.lastUpdate ?? 0) > 0;\r\n  const pointerWithinReach = pointerDistance >= POINTER_DEADZONE;\r\n  const pointerIsLive = pointerIsActive(now);\r\n  const pointerEffective = pointerWithinReach && (pointerIsLive || pointerHasSignal);\r\n\r\n  let targetX;\r\n  let targetY;\r\n  let targetAngle;\r\n\r\n  if (pointerEffective) {\r\n    targetX = pointerWorld.x;\r\n    targetY = pointerWorld.y;\r\n    targetAngle = Math.atan2(pointerVectorY, pointerVectorX);\r\n  } else if (stickman.aim) {\r\n    const previousAngle = stickman.aim.targetAngle ?? stickman.aim.angle ?? getFallbackAngle();\r\n    const reach = 320;\r\n    targetAngle = previousAngle;\r\n    targetX = anchor.x + Math.cos(previousAngle) * reach;\r\n    targetY = anchor.y + Math.sin(previousAngle) * reach;\r\n  } else {\r\n    const fallbackAngle = getFallbackAngle();\r\n    targetAngle = fallbackAngle;\r\n    const reach = 320;\r\n    targetX = anchor.x + Math.cos(fallbackAngle) * reach;\r\n    targetY = anchor.y + Math.sin(fallbackAngle) * reach;\r\n  }\r\n\r\n  const aim = updateAimRecord(stickman.aim, {\r\n    targetAngle: normalizeAngle(targetAngle),\r\n    targetX,\r\n    targetY,\r\n    anchorX: anchor.x,\r\n    anchorY: anchor.y,\r\n    smoothing: stickman.aim?.smoothing ?? 22,\r\n    magnitude: pointerDistance,\r\n    active: pointerEffective\r\n  }, delta);\r\n  stickman.aim = aim;\r\n\r\n  if (pointerEffective && aim) {\r\n    stickman.facing = aim.vectorX >= 0 ? 1 : -1;\r\n  }\r\n}\r\n\r\nfunction findEnemyById(id) {\r\n  if (!id) {\r\n    return null;\r\n  }\r\n  return enemies.find((enemy) => enemy.id === id) ?? null;\r\n}\r\n\r\nfunction updateSquadAims(delta) {\r\n  for (const ally of squadmates) {\r\n    const pose = POSES.standing;\r\n    const anchor = getShoulderAnchor(ally, pose);\r\n    const enemy = findEnemyById(ally.targetEnemyId);\r\n    const targetX = enemy ? enemy.x : stickman.aim?.targetX ?? (ally.x + ally.facing * 120);\r\n    const targetY = enemy ? enemy.y + enemy.height * 0.35 : stickman.aim?.targetY ?? ally.y;\r\n    const angle = Math.atan2(targetY - anchor.y, targetX - anchor.x);\r\n    ally.aim = updateAimRecord(ally.aim, {\r\n      targetAngle: normalizeAngle(angle),\r\n      targetX,\r\n      targetY,\r\n      anchorX: anchor.x,\r\n      anchorY: anchor.y,\r\n      smoothing: ally.aim?.smoothing ?? 18,\r\n      active: Boolean(enemy)\r\n    }, delta);\r\n    if (ally.aim) {\r\n      ally.facing = ally.aim.vectorX >= 0 ? 1 : -1;\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateEnemyAims(delta) {\r\n  const targetAnchor = getShoulderAnchor(stickman, stickman.rolling ? POSES.rolling : (stickman.crouching ? POSES.crouching : POSES.standing));\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const anchor = {\r\n      x: enemy.x,\r\n      y: enemy.y + (enemy.height ?? 100) * 0.35\r\n    };\r\n    const targetX = targetAnchor.x;\r\n    const targetY = targetAnchor.y;\r\n    const angle = Math.atan2(targetY - anchor.y, targetX - anchor.x);\r\n    enemy.aim = updateAimRecord(enemy.aim, {\r\n      targetAngle: normalizeAngle(angle),\r\n      targetX,\r\n      targetY,\r\n      anchorX: anchor.x,\r\n      anchorY: anchor.y,\r\n      smoothing: enemy.aim?.smoothing ?? 12,\r\n      active: true\r\n    }, delta);\r\n    if (enemy.aim) {\r\n      enemy.facing = enemy.aim.vectorX >= 0 ? 1 : -1;\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateVehicleMountAims(delta) {\r\n  for (const vehicle of vehicles) {\r\n    const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n    if (!definition) {\r\n      continue;\r\n    }\r\n    const mountDefs = definition.mountedWeapons ?? [];\r\n    if (!Array.isArray(vehicle.mounts)) {\r\n      vehicle.mounts = [];\r\n    }\r\n    for (let index = 0; index < mountDefs.length; index += 1) {\r\n      const mountDef = mountDefs[index];\r\n      if (!mountDef) {\r\n        continue;\r\n      }\r\n      const mountState = vehicle.mounts[index] ?? (vehicle.mounts[index] = {});\r\n      const mountOffset = mountDef.offset ?? { x: 0, y: 0 };\r\n      const followFacing = mountDef.followVehicleFacing !== false;\r\n      const facingMultiplier = followFacing ? (vehicle.facing ?? 1) : 1;\r\n      const anchorX = vehicle.x + (mountOffset.x ?? 0) * facingMultiplier;\r\n      const anchorY = vehicle.y + (mountOffset.y ?? 0);\r\n      let targetX;\r\n      let targetY;\r\n      let active = false;\r\n      if (vehicle.driverId === \"player-stickman\" && stickman.aim) {\r\n        targetX = stickman.aim.targetX;\r\n        targetY = stickman.aim.targetY;\r\n        active = stickman.aim.active;\r\n      } else {\r\n        const baseFacing = (mountDef.facing ?? 1) * (followFacing ? (vehicle.facing ?? 1) : 1);\r\n        const fallbackAngle = baseFacing >= 0 ? 0 : Math.PI;\r\n        const reach = mountDef.range ?? 220;\r\n        targetX = anchorX + Math.cos(fallbackAngle) * reach;\r\n        targetY = anchorY + Math.sin(fallbackAngle) * reach;\r\n      }\r\n      const angle = Math.atan2(targetY - anchorY, targetX - anchorX);\r\n      mountState.aim = updateAimRecord(mountState.aim, {\r\n        targetAngle: normalizeAngle(angle),\r\n        targetX,\r\n        targetY,\r\n        anchorX,\r\n        anchorY,\r\n        smoothing: mountState.aim?.smoothing ?? 14,\r\n        active\r\n      }, delta);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateAimSystem(delta) {\r\n  refreshPointerWorld();\r\n  updatePlayerAim(delta);\r\n  updateSquadAims(delta);\r\n  updateEnemyAims(delta);\r\n  updateVehicleMountAims(delta);\r\n}\r\n\r\nfunction getStickmanShoulderAnchor() {\r\n  const pose = stickman.rolling ? POSES.rolling : (stickman.crouching ? POSES.crouching : POSES.standing);\r\n  return getShoulderAnchor(stickman, pose);\r\n}\r\n\r\nexport { updateAimSystem, getPointerWorld, getStickmanShoulderAnchor, getShoulderAnchor };","import { context, GROUND_Y } from \"../../environment/canvas.js\";\nimport { SPEED, POSES } from \"../../config/constants.js\";\nimport { getShoulderAnchor } from \"../aim/index.js\";\nimport { clamp } from \"../utils/math.js\";\nimport { getElapsedTime } from \"../utils/time.js\";\n\nfunction resolveAim(entity, pose, aimRecord, fallbackFacing = 1) {\n  const fallbackAngle = fallbackFacing >= 0 ? 0 : Math.PI;\n  const anchor = getShoulderAnchor(entity, pose);\n  if (!aimRecord) {\n    const vx = Math.cos(fallbackAngle);\n    const vy = Math.sin(fallbackAngle);\n    return {\n      angle: fallbackAngle,\n      vectorX: vx,\n      vectorY: vy,\n      anchorX: anchor.x,\n      anchorY: anchor.y,\n      active: false\n    };\n  }\n  const angle = Number.isFinite(aimRecord.angle) ? aimRecord.angle : fallbackAngle;\n  const vectorX = Number.isFinite(aimRecord.vectorX) ? aimRecord.vectorX : Math.cos(angle);\n  const vectorY = Number.isFinite(aimRecord.vectorY) ? aimRecord.vectorY : Math.sin(angle);\n  const anchorX = Number.isFinite(aimRecord.anchorX) ? aimRecord.anchorX : anchor.x;\n  const anchorY = Number.isFinite(aimRecord.anchorY) ? aimRecord.anchorY : anchor.y;\n  return {\n    angle,\n    vectorX,\n    vectorY,\n    anchorX,\n    anchorY,\n    active: Boolean(aimRecord.active)\n  };\n}\n\nfunction computeArmSegments(anchor, { length, aimAngle, bendDirection = 1, stretch = 1, elbowOffset = 10 }) {\n  const effectiveLength = Math.max(0, length * stretch);\n  const elbowDistance = effectiveLength * 0.55;\n  const offset = elbowOffset * bendDirection;\n  const cos = Math.cos(aimAngle);\n  const sin = Math.sin(aimAngle);\n  const elbowX = anchor.x + cos * elbowDistance - sin * offset;\n  const elbowY = anchor.y + sin * elbowDistance + cos * offset;\n  const handX = anchor.x + cos * effectiveLength;\n  const handY = anchor.y + sin * effectiveLength;\n  return {\n    elbow: { x: elbowX, y: elbowY },\n    hand: { x: handX, y: handY }\n  };\n}\n\nfunction computeLegSegments(hip, { length, offsetX, phase, lift }) {\n  const footX = hip.x + offsetX;\n  const footY = GROUND_Y;\n  const swing = Math.max(0, -phase);\n  const kneeLift = swing * lift;\n  const kneeYBase = hip.y + length * 0.6;\n  const kneeY = Math.min(kneeYBase, footY - length * 0.42 - kneeLift);\n  const kneeX = hip.x + offsetX * 0.5;\n  return {\n    knee: { x: kneeX, y: kneeY },\n    foot: { x: footX, y: footY }\n  };\n}\n\nfunction drawLimb(hip, limb, color, lineWidth, alpha = 1) {\n  context.save();\n  context.strokeStyle = color;\n  context.lineWidth = lineWidth;\n  context.lineCap = \"round\";\n  context.globalAlpha = alpha;\n  context.beginPath();\n  context.moveTo(hip.x, hip.y);\n  context.lineTo(limb.knee.x, limb.knee.y);\n  context.lineTo(limb.foot.x, limb.foot.y);\n  context.stroke();\n  context.restore();\n}\n\nfunction drawArm(shoulder, arm, color, lineWidth, alpha = 1) {\n  context.save();\n  context.strokeStyle = color;\n  context.lineWidth = lineWidth;\n  context.lineCap = \"round\";\n  context.globalAlpha = alpha;\n  context.beginPath();\n  context.moveTo(shoulder.x, shoulder.y);\n  context.lineTo(arm.elbow.x, arm.elbow.y);\n  context.lineTo(arm.hand.x, arm.hand.y);\n  context.stroke();\n  context.restore();\n}\n\nfunction drawHand(point, radius, color) {\n  context.save();\n  context.fillStyle = color;\n  context.beginPath();\n  context.arc(point.x, point.y, radius, 0, Math.PI * 2);\n  context.fill();\n  context.restore();\n}\n\nfunction getWeaponVisual(weapon) {\n  if (!weapon || !weapon.category) {\n    return null;\n  }\n  const category = weapon.category;\n  if (category.startsWith(\"melee\")) {\n    const isMid = category.includes(\"mid\") || category.includes(\"long\");\n    const length = isMid ? 72 : 56;\n    return {\n      length,\n      thickness: isMid ? 6 : 5,\n      color: \"#ffcc80\",\n      detailColor: \"#ffdca6\",\n      handleOffset: length * 0.5,\n      strapColor: \"#ffe6b8\"\n    };\n  }\n  if (category.startsWith(\"ranged-heavy\")) {\n    const length = 68;\n    return {\n      length,\n      thickness: 12,\n      color: \"#4d596b\",\n      detailColor: \"#9aa9c7\",\n      handleOffset: length * 0.32,\n      strapColor: \"#5f6d82\"\n    };\n  }\n  if (category.startsWith(\"ranged-mid\")) {\n    const length = 50;\n    return {\n      length,\n      thickness: 9,\n      color: \"#4a5668\",\n      detailColor: \"#8294b8\",\n      handleOffset: length * 0.28,\n      strapColor: \"#7687ab\"\n    };\n  }\n  if (category.startsWith(\"ranged\")) {\n    const length = 38;\n    return {\n      length,\n      thickness: 7,\n      color: \"#4f5a6b\",\n      detailColor: \"#9aa9c7\",\n      handleOffset: length * 0.22,\n      strapColor: \"#7c8baa\"\n    };\n  }\n  if (category.startsWith(\"throwable\")) {\n    return {\n      length: 18,\n      thickness: 10,\n      color: \"#adb7c4\",\n      detailColor: \"#e3e6eb\",\n      handleOffset: 6,\n      strapColor: \"#c6ccd8\"\n    };\n  }\n  return null;\n}\n\nfunction drawWeaponSprite(weaponVisual, hand, supportHand, aimAngle) {\n  if (!weaponVisual) {\n    return;\n  }\n  const { length, thickness, color, detailColor, handleOffset, strapColor } = weaponVisual;\n  context.save();\n  context.translate(hand.x, hand.y);\n  context.rotate(aimAngle);\n  context.fillStyle = color;\n  context.fillRect(-handleOffset, -thickness * 0.5, length, thickness);\n  if (detailColor) {\n    context.fillStyle = detailColor;\n    context.fillRect(-handleOffset + length * 0.2, -thickness * 0.33, length * 0.18, thickness * 0.66);\n    context.fillRect(-handleOffset + length * 0.7, -thickness * 0.18, length * 0.12, thickness * 0.36);\n  }\n  context.restore();\n\n  if (supportHand) {\n    context.save();\n    context.strokeStyle = strapColor ?? color;\n    context.lineWidth = Math.max(2, thickness * 0.25);\n    context.beginPath();\n    context.moveTo(hand.x, hand.y);\n    context.lineTo(supportHand.x, supportHand.y);\n    context.stroke();\n    context.restore();\n  }\n}\n\nfunction drawRoundedRectPath(x, y, width, height, radius) {\n  const r = Math.max(0, Math.min(radius, Math.min(width, height) * 0.5));\n  context.beginPath();\n  context.moveTo(x + r, y);\n  context.lineTo(x + width - r, y);\n  context.quadraticCurveTo(x + width, y, x + width, y + r);\n  context.lineTo(x + width, y + height - r);\n  context.quadraticCurveTo(x + width, y + height, x + width - r, y + height);\n  context.lineTo(x + r, y + height);\n  context.quadraticCurveTo(x, y + height, x, y + height - r);\n  context.lineTo(x, y + r);\n  context.quadraticCurveTo(x, y, x + r, y);\n  context.closePath();\n}\n\nfunction drawJetpackCosmetic(style, { entityX, shoulder, hip }) {\n  if (!style) {\n    return;\n  }\n  const baseY = shoulder.y + 4;\n  const packHeightDual = Math.max(32, hip.y - baseY + 12);\n  if (style.type === \"dual\") {\n    const packWidth = 12;\n    const offset = 18;\n    context.save();\n    context.globalAlpha = 0.9;\n    context.fillStyle = style.bodyColor ?? \"#1f2d44\";\n    context.fillRect(entityX - offset - packWidth / 2, baseY, packWidth, packHeightDual);\n    context.fillRect(entityX + offset - packWidth / 2, baseY, packWidth, packHeightDual);\n    if (style.accentColor) {\n      context.strokeStyle = style.accentColor;\n      context.lineWidth = 3;\n      context.beginPath();\n      context.moveTo(entityX - offset, baseY + 6);\n      context.lineTo(entityX - offset, baseY + packHeightDual - 10);\n      context.moveTo(entityX + offset, baseY + 6);\n      context.lineTo(entityX + offset, baseY + packHeightDual - 10);\n      context.stroke();\n    }\n    context.restore();\n\n    if (style.exhaustColor) {\n      const flameWidth = packWidth * 0.8;\n      const flameHeight = 18;\n      context.save();\n      context.fillStyle = style.exhaustColor;\n      context.globalAlpha = style.exhaustAlpha ?? 0.7;\n      context.beginPath();\n      context.moveTo(entityX - offset - flameWidth / 2, baseY + packHeightDual);\n      context.lineTo(entityX - offset, baseY + packHeightDual + flameHeight);\n      context.lineTo(entityX - offset + flameWidth / 2, baseY + packHeightDual);\n      context.closePath();\n      context.fill();\n      context.beginPath();\n      context.moveTo(entityX + offset - flameWidth / 2, baseY + packHeightDual);\n      context.lineTo(entityX + offset, baseY + packHeightDual + flameHeight);\n      context.lineTo(entityX + offset + flameWidth / 2, baseY + packHeightDual);\n      context.closePath();\n      context.fill();\n      context.restore();\n    }\n    return;\n  }\n  if (style.type === \"shielded\") {\n    const packWidth = 28;\n    const packHeight = Math.max(36, hip.y - baseY + 16);\n    context.save();\n    context.globalAlpha = 0.92;\n    context.fillStyle = style.bodyColor ?? \"#3a2f2f\";\n    drawRoundedRectPath(entityX - packWidth / 2, baseY, packWidth, packHeight, 10);\n    context.fill();\n    if (style.panelColor) {\n      context.fillStyle = style.panelColor;\n      drawRoundedRectPath(entityX - packWidth / 2 + 4, baseY + 6, packWidth - 8, packHeight - 12, 6);\n      context.fill();\n    }\n    context.restore();\n    if (style.exhaustColor) {\n      context.save();\n      context.fillStyle = style.exhaustColor;\n      context.globalAlpha = style.exhaustAlpha ?? 0.8;\n      const flameWidth = 20;\n      const flameHeight = 20;\n      context.beginPath();\n      context.moveTo(entityX - flameWidth / 2, baseY + packHeight);\n      context.lineTo(entityX, baseY + packHeight + flameHeight);\n      context.lineTo(entityX + flameWidth / 2, baseY + packHeight);\n      context.closePath();\n      context.fill();\n      context.restore();\n    }\n    return;\n  }\n}\n\nfunction drawArmorCosmetic(style, { entityX, shoulder, hip, lineWidth }) {\n  if (!style) {\n    return;\n  }\n  const topY = shoulder.y + 4;\n  const bottomY = hip.y - 10;\n  if (style.type === \"harness\") {\n    context.save();\n    context.strokeStyle = style.strapColor ?? \"#444b63\";\n    context.lineWidth = Math.max(3, lineWidth * 0.85);\n    context.lineCap = \"round\";\n    context.beginPath();\n    context.moveTo(entityX - 16, topY);\n    context.lineTo(entityX - 6, bottomY);\n    context.moveTo(entityX + 16, topY);\n    context.lineTo(entityX + 6, bottomY);\n    context.stroke();\n    if (style.accentColor) {\n      context.strokeStyle = style.accentColor;\n      context.lineWidth = 2.4;\n      context.beginPath();\n      context.moveTo(entityX - 14, topY + 16);\n      context.lineTo(entityX + 14, topY + 16);\n      context.stroke();\n    }\n    context.restore();\n    return;\n  }\n  if (style.type === \"plating\") {\n    const chestWidth = 34;\n    const chestHeight = Math.max(28, bottomY - topY);\n    const chestX = entityX - chestWidth / 2;\n    context.save();\n    context.globalAlpha = 0.94;\n    context.fillStyle = style.plateColor ?? \"#212733\";\n    drawRoundedRectPath(chestX, topY, chestWidth, chestHeight, 10);\n    context.fill();\n    if (style.trimColor) {\n      context.strokeStyle = style.trimColor;\n      context.lineWidth = 2;\n      drawRoundedRectPath(chestX + 1, topY + 1, chestWidth - 2, chestHeight - 2, 9);\n      context.stroke();\n    }\n    if (style.glowColor) {\n      context.fillStyle = style.glowColor;\n      context.globalAlpha = 0.7;\n      context.beginPath();\n      context.arc(entityX, topY + chestHeight * 0.55, 4, 0, Math.PI * 2);\n      context.fill();\n    }\n    context.restore();\n    return;\n  }\n  if (style.type === \"webbing\") {\n    const strapWidth = 36;\n    const strapHeight = 5;\n    context.save();\n    context.globalAlpha = 0.9;\n    context.fillStyle = style.strapColor ?? \"#2f3a44\";\n    for (let i = 0; i < 3; i += 1) {\n      const y = topY + 6 + i * 10;\n      context.fillRect(entityX - strapWidth / 2, y, strapWidth, strapHeight);\n    }\n    if (style.pouchColor) {\n      const pouchWidth = 10;\n      const pouchHeight = 12;\n      const y = bottomY - pouchHeight - 2;\n      context.fillStyle = style.pouchColor;\n      context.fillRect(entityX - pouchWidth - 4, y, pouchWidth, pouchHeight);\n      context.fillRect(entityX + 4, y, pouchWidth, pouchHeight);\n    }\n    if (style.accentColor) {\n      context.strokeStyle = style.accentColor;\n      context.lineWidth = 2;\n      context.beginPath();\n      context.moveTo(entityX - 18, topY + 12);\n      context.lineTo(entityX + 18, topY + 12);\n      context.stroke();\n    }\n    context.restore();\n  }\n}\n\nfunction drawHelmetCosmetic(style, { headCenterX, headCenterY, headRadius, aimAngle }) {\n  if (!style) {\n    return;\n  }\n  const shellRadius = headRadius + 2;\n  if (style.type === \"visor\") {\n    context.save();\n    context.lineCap = \"round\";\n    context.strokeStyle = style.shellColor ?? \"#1a2233\";\n    context.lineWidth = headRadius * 0.7;\n    context.beginPath();\n    context.arc(headCenterX, headCenterY, shellRadius, Math.PI * 0.55, Math.PI * 1.45);\n    context.stroke();\n    if (style.accentColor) {\n      context.strokeStyle = style.accentColor;\n      context.lineWidth = headRadius * 0.32;\n      context.beginPath();\n      context.arc(headCenterX, headCenterY, shellRadius - 1, Math.PI * 0.6, Math.PI * 1.4);\n      context.stroke();\n    }\n    context.restore();\n\n    context.save();\n    context.translate(headCenterX, headCenterY);\n    context.rotate(aimAngle);\n    const visorWidth = headRadius * 1.5;\n    const visorHeight = headRadius * 0.8;\n    context.fillStyle = style.visorColor ?? \"#68e7ff\";\n    context.globalAlpha = style.visorAlpha ?? 0.65;\n    context.fillRect(-visorWidth / 2, -visorHeight / 2, visorWidth, visorHeight);\n    context.globalAlpha = 1;\n    context.strokeStyle = style.shellColor ?? \"#1a2233\";\n    context.lineWidth = 2;\n    context.strokeRect(-visorWidth / 2, -visorHeight / 2, visorWidth, visorHeight);\n    context.restore();\n    return;\n  }\n  if (style.type === \"plated\") {\n    context.save();\n    context.lineCap = \"round\";\n    context.strokeStyle = style.shellColor ?? \"#2f2a3f\";\n    context.lineWidth = headRadius * 0.8;\n    context.beginPath();\n    context.arc(headCenterX, headCenterY, shellRadius, Math.PI * 0.6, Math.PI * 1.4);\n    context.stroke();\n    if (style.accentColor) {\n      context.strokeStyle = style.accentColor;\n      context.lineWidth = headRadius * 0.38;\n      context.beginPath();\n      context.arc(headCenterX, headCenterY, shellRadius - 1, Math.PI * 0.7, Math.PI * 1.3);\n      context.stroke();\n    }\n    if (style.trimColor) {\n      context.strokeStyle = style.trimColor;\n      context.lineWidth = 2.4;\n      context.beginPath();\n      context.arc(headCenterX, headCenterY, shellRadius + 1, Math.PI * 0.52, Math.PI * 1.48);\n      context.stroke();\n    }\n    context.restore();\n  }\n}\n\nfunction renderStickFigure(params) {\n  const {\n    entity,\n    pose = POSES.standing,\n    aim: aimRecord = null,\n    weapon = null,\n    weaponVisual: providedWeaponVisual = null,\n    cosmetics = null,\n    primaryColor = \"#f4f7ff\",\n    supportColor = primaryColor,\n    lineWidth = 4,\n    crouching = false,\n    rolling = false,\n    label = null,\n    labelColor = \"#d0d4de\",\n    showHealthBar = false,\n    healthRatio = null,\n    healthColor = \"#5fffb5\",\n    flashColor = null,\n    flashAmount = 0,\n    highlightColor = null,\n    attackInfo = null\n  } = params;\n\n  const resolvedPose = pose ?? POSES.standing;\n  const fallbackFacing = entity.facing ?? ((entity.vx ?? 0) >= 0 ? 1 : -1);\n  const aim = resolveAim(entity, resolvedPose, aimRecord, fallbackFacing);\n  const weaponVisual = providedWeaponVisual ?? getWeaponVisual(weapon);\n\n  const headRadius = resolvedPose.headRadius ?? 16;\n  const bodyLength = resolvedPose.bodyLength ?? 34;\n  const legLength = resolvedPose.legLength ?? 36;\n  const armLength = resolvedPose.armLength ?? 28;\n\n  const velocityX = entity.vx ?? 0;\n  const speedRatio = clamp(Math.abs(velocityX) / SPEED, 0, 1);\n  const elapsed = getElapsedTime();\n  const torsoLean = clamp(velocityX / SPEED, -1, 1) * 0.28;\n\n  const crouchOffset = crouching ? 6 : 0;\n  const headCenterX = entity.x + torsoLean * 6;\n  const headCenterY = entity.y + headRadius - crouchOffset * 0.5;\n  const neckY = entity.y + headRadius * 2 - crouchOffset * 0.6;\n  const shoulderY = neckY + 6 - crouchOffset * 0.4;\n  const hipX = entity.x + torsoLean * 4;\n  const hipY = shoulderY + bodyLength - crouchOffset;\n\n  const shoulder = { x: headCenterX, y: shoulderY };\n  const hip = { x: hipX, y: hipY };\n\n  const stridePhase = elapsed * (4.8 + speedRatio * 5.6);\n  const baseSpacing = legLength * (0.25 + speedRatio * 0.18) * (crouching ? 0.7 : 1);\n  const liftHeight = crouching ? 5 : Math.max(8, legLength * 0.22);\n  const leftPhase = Math.sin(stridePhase);\n  const rightPhase = Math.sin(stridePhase + Math.PI);\n  const leanOffset = torsoLean * 6;\n  const leftOffset = -baseSpacing + leftPhase * speedRatio * legLength * 0.3 + leanOffset;\n  const rightOffset = baseSpacing + rightPhase * speedRatio * legLength * 0.3 + leanOffset;\n\n  const leftLeg = computeLegSegments(hip, { length: legLength, offsetX: leftOffset, phase: leftPhase, lift: liftHeight });\n  const rightLeg = computeLegSegments(hip, { length: legLength, offsetX: rightOffset, phase: rightPhase, lift: liftHeight });\n\n  const aimAngle = aim.angle;\n  const dirX = aim.vectorX;\n  const dirY = aim.vectorY;\n  const forwardSign = dirX >= 0 ? 1 : -1;\n\n  let frontAngle = aimAngle;\n  let frontStretch = 1;\n  let frontElbowOffset = 12 + speedRatio * 6;\n  let supportAngle = aimAngle - forwardSign * 0.22;\n  let supportStretch = 0.92;\n  let supportElbowOffset = 8 + speedRatio * 4;\n\n  if (attackInfo?.active) {\n    const progress = clamp(attackInfo.progress ?? 0, 0, 1);\n    if ((attackInfo.type ?? \"\").startsWith(\"melee\")) {\n      frontStretch = 1.1 + progress * 0.25;\n      frontElbowOffset = 12 + progress * 16;\n      frontAngle = aimAngle + forwardSign * progress * 0.45;\n      supportAngle = aimAngle - forwardSign * (0.35 - progress * 0.18);\n      supportStretch = 0.86;\n    } else if ((attackInfo.type ?? \"\").startsWith(\"ranged\")) {\n      frontStretch = 1;\n      frontElbowOffset = 12 + progress * 10;\n      supportAngle = aimAngle - forwardSign * (0.18 - progress * 0.08);\n      supportStretch = 0.94;\n    }\n  }\n\n  const frontArm = computeArmSegments(shoulder, {\n    length: armLength,\n    aimAngle: frontAngle,\n    bendDirection: forwardSign,\n    stretch: frontStretch,\n    elbowOffset: frontElbowOffset\n  });\n\n  const supportArm = computeArmSegments(shoulder, {\n    length: armLength * supportStretch,\n    aimAngle: supportAngle,\n    bendDirection: -forwardSign,\n    stretch: supportStretch,\n    elbowOffset: supportElbowOffset\n  });\n\n  const backLeg = forwardSign >= 0 ? leftLeg : rightLeg;\n  const frontLeg = forwardSign >= 0 ? rightLeg : leftLeg;\n  const backArm = forwardSign >= 0 ? supportArm : frontArm;\n  const frontArmToDraw = forwardSign >= 0 ? frontArm : supportArm;\n  const supportArmToDraw = forwardSign >= 0 ? supportArm : frontArm;\n\n  const baseLineWidth = lineWidth;\n\n  const cosmeticsData = cosmetics ?? null;\n  const helmetStyle = cosmeticsData?.helmet?.style ?? null;\n  const armorStyle = cosmeticsData?.armor?.style ?? null;\n  const jetpackStyle = cosmeticsData?.jetpack?.style ?? null;\n\n  if (jetpackStyle && jetpackStyle.type !== \"none\") {\n    drawJetpackCosmetic(jetpackStyle, {\n      entityX: entity.x,\n      shoulder,\n      hip\n    });\n  }\n\n  drawLimb(hip, backLeg, primaryColor, baseLineWidth, 0.55);\n  drawLimb(hip, frontLeg, primaryColor, baseLineWidth, 1);\n\n  context.save();\n  context.strokeStyle = primaryColor;\n  context.lineWidth = baseLineWidth;\n  context.lineCap = \"round\";\n  context.beginPath();\n  context.moveTo(shoulder.x, neckY);\n  context.lineTo(hip.x, hip.y);\n  context.stroke();\n  context.restore();\n\n  if (armorStyle && armorStyle.type !== \"none\") {\n    drawArmorCosmetic(armorStyle, {\n      entityX: entity.x,\n      shoulder,\n      hip,\n      lineWidth: baseLineWidth\n    });\n  }\n\n  drawArm(shoulder, backArm, supportColor, baseLineWidth * 0.9, 0.45);\n\n  drawWeaponSprite(weaponVisual, frontArm.hand, supportArm.hand, aimAngle);\n\n  drawArm(shoulder, supportArmToDraw, supportColor, baseLineWidth * 0.9, 0.8);\n  drawArm(shoulder, frontArmToDraw, primaryColor, baseLineWidth, 1);\n\n  drawHand(supportArm.hand, 3.2, supportColor);\n  drawHand(frontArm.hand, 3.4, primaryColor);\n\n  context.save();\n  context.strokeStyle = primaryColor;\n  context.lineWidth = baseLineWidth;\n  context.lineCap = \"round\";\n  context.beginPath();\n  context.arc(headCenterX, headCenterY, headRadius, 0, Math.PI * 2);\n  context.stroke();\n  context.restore();\n\n  if (helmetStyle && helmetStyle.type !== \"none\") {\n    drawHelmetCosmetic(helmetStyle, {\n      headCenterX,\n      headCenterY,\n      headRadius,\n      aimAngle\n    });\n  }\n\n  if (highlightColor) {\n    context.save();\n    context.strokeStyle = highlightColor;\n    context.lineWidth = baseLineWidth * 0.6;\n    context.globalAlpha = 0.6;\n    context.beginPath();\n    context.arc(entity.x, entity.y + headRadius, headRadius + 6, 0, Math.PI * 2);\n    context.stroke();\n    context.restore();\n  }\n\n  if (flashColor && flashAmount > 0) {\n    context.save();\n    context.fillStyle = flashColor;\n    context.globalAlpha = clamp(flashAmount, 0, 1);\n    context.beginPath();\n    context.arc(frontArm.hand.x + dirX * 6, frontArm.hand.y + dirY * 6, 10, 0, Math.PI * 2);\n    context.fill();\n    context.restore();\n  }\n\n  if (showHealthBar && healthRatio != null) {\n    const width = 90;\n    const height = 8;\n    const barX = entity.x - width / 2;\n    const barY = entity.y - headRadius * 1.6;\n    context.save();\n    context.fillStyle = \"#232733\";\n    context.fillRect(barX, barY, width, height);\n    context.fillStyle = healthColor;\n    context.fillRect(barX, barY, width * clamp(healthRatio, 0, 1), height);\n    context.strokeStyle = \"#404653\";\n    context.lineWidth = 1.5;\n    context.strokeRect(barX, barY, width, height);\n    context.restore();\n  }\n\n  if (label) {\n    context.save();\n    context.fillStyle = labelColor;\n    context.font = \"14px 'Segoe UI', Arial, sans-serif\";\n    context.textAlign = \"center\";\n    context.fillText(label, entity.x, entity.y - headRadius * 1.9);\n    context.restore();\n  }\n}\n\nexport { renderStickFigure, getWeaponVisual };","import { context } from \"../../environment/canvas.js\";\nimport { isWithinView, recordVisibility } from \"./culling.js\";\nimport { getDestructibles } from \"../../state/destructibles.js\";\nimport { getElapsedTime } from \"../utils/time.js\";\nimport { clamp } from \"../utils/math.js\";\n\nfunction drawBarrierBody(destructible, template, elapsed) {\n  const width = destructible.width;\n  const height = destructible.height;\n  const top = -height;\n  const bodyColor = template.bodyColor ?? \"#555\";\n  const accentColor = template.accentColor ?? \"#888\";\n  const edgeColor = template.edgeColor ?? \"#333\";\n  const crackColor = template.damageHighlight ?? \"#d5dde8\";\n  const damageRatio = clamp(1 - (destructible.health / destructible.maxHealth), 0, 1);\n  context.fillStyle = bodyColor;\n  context.fillRect(-width / 2, top, width, height);\n\n  context.fillStyle = accentColor;\n  context.fillRect(-width / 2, top, width, Math.max(10, height * 0.12));\n  context.fillRect(-width / 2, top + height * 0.55, width, Math.max(8, height * 0.1));\n\n  context.strokeStyle = edgeColor;\n  context.lineWidth = 4;\n  context.strokeRect(-width / 2, top, width, height);\n\n  if (damageRatio > 0) {\n    const crackCount = 3 + Math.floor(damageRatio * 3);\n    const phase = elapsed * 3 + destructible.x * 0.02;\n    context.strokeStyle = crackColor;\n    context.lineWidth = 2;\n    for (let i = 0; i < crackCount; i += 1) {\n      const offset = (i + 1) / (crackCount + 1);\n      const startX = -width * 0.45 + width * offset;\n      const crackHeight = height * (0.2 + damageRatio * 0.5);\n      const wobble = Math.sin(phase + i * 1.7) * 12;\n      context.beginPath();\n      context.moveTo(startX, top + height * 0.18);\n      context.lineTo(startX + wobble * 0.3, top + height * 0.18 + crackHeight * 0.45);\n      context.lineTo(startX + wobble, top + height * 0.18 + crackHeight);\n      context.stroke();\n    }\n  }\n}\n\nfunction drawRubble(destructible, template, progress) {\n  const width = destructible.width;\n  const rubbleHeight = Math.max(8, (template.rubbleHeight ?? 32) * progress);\n  const debrisColor = template.debrisColor ?? template.bodyColor ?? \"#4a4a4a\";\n  context.fillStyle = debrisColor;\n  context.beginPath();\n  context.moveTo(-width / 2, 0);\n  context.lineTo(-width * 0.35, -rubbleHeight * 0.3);\n  context.lineTo(-width * 0.12, -rubbleHeight);\n  context.lineTo(width * 0.08, -rubbleHeight * 0.65);\n  context.lineTo(width * 0.32, -rubbleHeight * 0.9);\n  context.lineTo(width / 2, 0);\n  context.closePath();\n  context.fill();\n\n  context.fillStyle = \"rgba(30, 32, 40, 0.6)\";\n  context.fillRect(-width / 2, 0, width, Math.max(6, rubbleHeight * 0.2));\n}\n\nfunction drawStreetCar(destructible, template, elapsed) {\n  const width = destructible.width;\n  const height = destructible.height;\n  const top = -height;\n  const facing = destructible.facing ?? 1;\n  const damageRatio = clamp(1 - (destructible.health / destructible.maxHealth), 0, 1);\n\n  context.save();\n  context.scale(facing, 1);\n\n  const bodyColor = template.bodyColor ?? \"#b13d30\";\n  const windowColor = template.glassColor ?? \"#4ac3ff\";\n  const accentColor = template.accentColor ?? \"#f7f9ff\";\n  const edgeColor = template.edgeColor ?? \"#1c1d25\";\n\n  const bodyTop = top + height * 0.15;\n  const cabinHeight = height * 0.55;\n  const wheelRadius = Math.max(12, height * 0.18);\n\n  context.fillStyle = bodyColor;\n  context.beginPath();\n  context.moveTo(-width / 2, bodyTop + height * 0.1);\n  context.lineTo(-width * 0.42, top + cabinHeight * 0.45);\n  context.lineTo(-width * 0.25, top);\n  context.lineTo(width * 0.22, top);\n  context.lineTo(width * 0.45, top + cabinHeight * 0.5);\n  context.lineTo(width / 2, bodyTop + height * 0.1);\n  context.closePath();\n  context.fill();\n\n  context.fillStyle = windowColor;\n  const windowHeight = cabinHeight * 0.55;\n  context.fillRect(-width * 0.28, top + cabinHeight * 0.12, width * 0.42, windowHeight);\n\n  context.fillStyle = accentColor;\n  context.fillRect(-width / 2, bodyTop + cabinHeight * 0.55, width, height * 0.2);\n\n  context.fillStyle = edgeColor;\n  context.beginPath();\n  context.arc(-width * 0.28, wheelRadius * -0.15, wheelRadius, 0, Math.PI * 2);\n  context.arc(width * 0.28, wheelRadius * -0.15, wheelRadius, 0, Math.PI * 2);\n  context.fill();\n\n  if (!destructible.destroyed && damageRatio > 0.05) {\n    context.strokeStyle = \"rgba(0, 0, 0, 0.35)\";\n    context.lineWidth = 2;\n    context.beginPath();\n    context.moveTo(-width * 0.12, top + cabinHeight * 0.8);\n    context.lineTo(-width * 0.22, bodyTop + height * 0.55);\n    context.lineTo(-width * 0.05, bodyTop + height * 0.7);\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(width * 0.18, top + cabinHeight * 0.6);\n    context.lineTo(width * 0.3, bodyTop + height * 0.4);\n    context.lineTo(width * 0.12, bodyTop + height * 0.65);\n    context.stroke();\n  }\n\n  context.restore();\n}\r\nfunction drawBarrelCluster(destructible, template, elapsed) {\n  const width = destructible.width;\n  const height = destructible.height;\n  const damageRatio = clamp(1 - (destructible.health / destructible.maxHealth), 0, 1);\n  const barrelRadius = width * 0.22;\n  const barrelHeight = height * 0.48;\n  const top = -height;\n  const bodyColor = template.bodyColor ?? \"#c0671c\";\n  const stripeColor = template.stripeColor ?? template.accentColor ?? \"#ffd45f\";\n  const edgeColor = template.edgeColor ?? \"#2f1a08\";\n\n  const positions = [\n    { x: -width * 0.22, y: top + height * 0.45 },\n    { x: width * 0.22, y: top + height * 0.5 },\n    { x: 0, y: top + height * 0.1 }\n  ];\n\n  const visibleCount = destructible.destroyed ? 1 : 3;\n  for (let i = 0; i < visibleCount; i += 1) {\n    const pos = positions[i];\n    context.save();\n    context.translate(pos.x, pos.y);\n    context.fillStyle = bodyColor;\n    context.beginPath();\n    context.ellipse(0, 0, barrelRadius, barrelHeight * 0.5, 0, 0, Math.PI * 2);\n    context.fill();\n\n    context.fillRect(-barrelRadius, -barrelHeight * 0.5, barrelRadius * 2, barrelHeight);\n\n    context.fillStyle = stripeColor;\n    context.fillRect(-barrelRadius, -barrelHeight * 0.12, barrelRadius * 2, barrelHeight * 0.24);\n\n    context.strokeStyle = edgeColor;\n    context.lineWidth = 3;\n    context.strokeRect(-barrelRadius, -barrelHeight * 0.5, barrelRadius * 2, barrelHeight);\n    context.restore();\n  }\n\n  if (!destructible.destroyed && damageRatio > 0.2) {\n    const flicker = 0.2 + Math.abs(Math.sin(elapsed * 8 + destructible.x * 0.05)) * 0.3 * damageRatio;\n    context.fillStyle = `rgba(255, 174, 72, ${flicker.toFixed(3)})`;\n    context.beginPath();\n    context.ellipse(0, top + height * 0.1, width * 0.12, height * 0.18, 0, 0, Math.PI * 2);\n    context.fill();\n  }\n}\r\nfunction drawHealthTick(width, ratio, yOffset) {\n  const clamped = clamp(ratio, 0, 1);\n  const barWidth = width * 0.85;\n  context.fillStyle = \"rgba(0, 0, 0, 0.45)\";\n  context.fillRect(-barWidth / 2, yOffset, barWidth, 5);\n  context.fillStyle = clamped > 0.5 ? \"#58ec8c\" : clamped > 0.25 ? \"#ffd15c\" : \"#ff675c\";\n  context.fillRect(-barWidth / 2, yOffset, barWidth * clamped, 5);\n}\n\nfunction drawSmokeColumn(destructible, template, elapsed) {\n  if ((destructible.smokeTimer ?? 0) <= 0) {\n    return;\n  }\n  const duration = template.smokeDuration ?? 1.5;\n  const lifeRatio = clamp((destructible.smokeTimer ?? 0) / duration, 0, 1);\n  const baseAlpha = 0.25 + lifeRatio * 0.35;\n  const layers = 4;\n  for (let i = 0; i < layers; i += 1) {\n    const phase = elapsed * (0.4 + i * 0.15) + destructible.x * 0.03 + i * 1.3;\n    const radius = (destructible.width * 0.35) * (1 + lifeRatio * 0.6 + i * 0.15);\n    context.globalAlpha = clamp(baseAlpha - i * 0.06, 0, 0.45);\n    context.fillStyle = \"#9fb6c8\";\n    context.beginPath();\n    context.arc(\n      Math.sin(phase) * destructible.width * 0.12,\n      -destructible.height * (0.65 + i * 0.2) - Math.cos(phase * 0.6) * 6,\n      radius * 0.3,\n      0,\n      Math.PI * 2\n    );\n    context.fill();\n  }\n  context.globalAlpha = 1;\n}\n\nfunction drawDestructible(destructible, elapsed) {\n  const template = destructible.template;\n  if (!template) {\n    return;\n  }\n\n  const shakeMag = destructible.shakeMagnitude ?? 0;\n  const shakeTimer = destructible.shakeTimer ?? 0;\n  const wobblePhase = elapsed * 8 + destructible.x * 0.05;\n  const shakeX = shakeTimer > 0 ? Math.sin(wobblePhase) * shakeMag * 0.35 : 0;\n  const shakeY = shakeTimer > 0 ? Math.cos(wobblePhase * 0.75) * shakeMag * 0.22 : 0;\n\n  context.save();\n  context.translate(destructible.x + shakeX, destructible.y + shakeY);\n\n  if (destructible.destroyed) {\n    drawRubble(destructible, template, clamp(destructible.rubbleLevel ?? 0, 0, 1));\n  }\n\n  if (!destructible.destroyed || (destructible.rubbleLevel ?? 0) < 1) {\n    switch (template.material) {\n      case \"vehicle\":\n        drawStreetCar(destructible, template, elapsed);\n        break;\n      case \"volatile\":\n        drawBarrelCluster(destructible, template, elapsed);\n        break;\n      default:\n        drawBarrierBody(destructible, template, elapsed);\n        break;\n    }\n  }\n\n  if (!destructible.destroyed && destructible.maxHealth > 0) {\n    const healthRatio = clamp(destructible.health / destructible.maxHealth, 0, 1);\n    if (healthRatio < 0.95) {\n      drawHealthTick(destructible.width, healthRatio, -destructible.height - 10);\n    }\n  }\n\n  const flashTimer = destructible.flashTimer ?? 0;\n  if (flashTimer > 0) {\n    const alpha = clamp(flashTimer / 0.2, 0, 1) * 0.45;\n    context.fillStyle = `rgba(255, 255, 255, ${alpha.toFixed(3)})`;\n    context.fillRect(-destructible.width / 2, -destructible.height, destructible.width, destructible.height);\n  }\n\n  drawSmokeColumn(destructible, template, elapsed);\n  context.restore();\n}\n\nfunction drawDestructibles() {\n  const elapsed = getElapsedTime();\n  const items = getDestructibles();\n  if (!items || items.length === 0) {\n    return;\n  }\n\n  context.save();\n  for (const destructible of items) {\n    const halfWidth = ((destructible.width ?? 120) * 0.5) + 50;\n    const culled = !isWithinView(destructible.x, halfWidth, 320);\n    recordVisibility(\"destructible\", culled);\n    if (culled) {\n      continue;\n    }\n    drawDestructible(destructible, elapsed);\n  }\n  context.restore();\n}\n\nexport { drawDestructibles };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { BUILDING_DEFINITIONS } from \"../../config/buildings.js\";\r\nimport { spendMaterials, getMaterialCount, spawnSalvagePickup } from \"../../state/resources.js\";\r\nimport { getEnvironmentPlatforms, getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { stickman, squadmates, enemies } from \"../../state/entities.js\";\r\nimport { GROUND_Y, canvas } from \"../../environment/canvas.js\";\r\nimport {\r\n  getStructures,\r\n  addStructure,\r\n  getBuildState,\r\n  getBuildingDefinitions,\r\n  getBlueprintByIndex,\r\n  resetStructures\r\n} from \"../../state/buildings.js\";\r\nimport { spawnProjectile } from \"../combat/projectiles.js\";\r\nimport { applyDamageToEnemy } from \"../combat/damageHandlers.js\";\r\nimport { spawnRingBurst } from \"../effects/particles.js\";\r\nimport { spawnDynamicLight } from \"../effects/lighting.js\";\r\nimport { input } from \"../input/index.js\";\r\n\r\nconst GRID_SIZE = 20;\r\n\r\nfunction snapToGrid(value) {\r\n  return Math.round(value / GRID_SIZE) * GRID_SIZE;\r\n}\r\n\r\nfunction getGroundYAt(x, halfWidth) {\r\n  let bestY = GROUND_Y;\r\n  const platforms = getEnvironmentPlatforms();\r\n  for (const platform of platforms) {\r\n    const left = platform.x - halfWidth;\r\n    const right = platform.x + platform.width + halfWidth;\r\n    if (x >= left && x <= right && platform.y < bestY) {\r\n      bestY = platform.y;\r\n    }\r\n  }\r\n  return bestY;\r\n}\r\n\r\nfunction clampBlueprintIndex(index) {\r\n  const defs = getBuildingDefinitions();\r\n  if (defs.length === 0) {\r\n    return 0;\r\n  }\r\n  return ((index % defs.length) + defs.length) % defs.length;\r\n}\r\n\r\nfunction cycleBlueprint(direction) {\r\n  const state = getBuildState();\r\n  state.blueprintIndex = clampBlueprintIndex(state.blueprintIndex + direction);\r\n}\r\n\r\nfunction calculatePreview() {\r\n  const state = getBuildState();\r\n  const blueprint = getBlueprintByIndex(state.blueprintIndex);\r\n  if (!blueprint) {\r\n    state.lastPreview.valid = false;\r\n    return state.lastPreview;\r\n  }\r\n  const halfWidth = (blueprint.width ?? 120) / 2;\r\n  const rawX = snapToGrid(stickman.x + stickman.facing * Math.max(140, halfWidth + 30));\r\n  const envWidth = getEnvironmentWidth();\n  const clampedX = Math.max(halfWidth + 30, Math.min(envWidth - halfWidth - 30, rawX));\r\n  const groundY = getGroundYAt(clampedX, halfWidth);\r\n  const cost = blueprint.cost ?? 0;\r\n  state.lastPreview = {\r\n    x: clampedX,\r\n    y: groundY,\r\n    width: blueprint.width,\r\n    height: blueprint.height,\r\n    blueprintId: blueprint.id,\r\n    cost,\r\n    color: blueprint.color,\r\n    accentColor: blueprint.accentColor,\r\n    strokeColor: blueprint.strokeColor,\r\n    ambient: blueprint.ambient ?? null,\r\n    valid: getMaterialCount() >= cost\r\n  };\r\n  return state.lastPreview;\r\n}\r\n\r\nfunction createStructureFromBlueprint(blueprint, preview) {\r\n  return {\r\n    id: `${blueprint.id}-${Date.now().toString(36)}-${Math.floor(Math.random() * 1000)}`,\r\n    type: blueprint.id,\r\n    x: preview.x,\r\n    y: preview.y,\r\n    width: blueprint.width,\r\n    height: blueprint.height,\r\n    health: blueprint.maxHealth,\r\n    maxHealth: blueprint.maxHealth,\r\n    color: blueprint.color,\r\n    accentColor: blueprint.accentColor,\r\n    strokeColor: blueprint.strokeColor,\r\n    ambient: blueprint.ambient ?? null,\r\n    blocking: blueprint.blocking ?? false,\r\n    turret: blueprint.turret ?? null,\r\n    shield: blueprint.shield ?? null,\r\n    trap: blueprint.trap ?? null,\r\n    fireCooldown: 0,\r\n    trapCooldown: 0,\r\n    flashTimer: 0\r\n  };\r\n}\r\n\r\nfunction placeStructure() {\r\n  const state = getBuildState();\r\n  const preview = calculatePreview();\r\n  if (!preview.valid) {\r\n    return false;\r\n  }\r\n  const blueprint = getBlueprintByIndex(state.blueprintIndex);\r\n  if (!blueprint) {\r\n    return false;\r\n  }\r\n  if (!spendMaterials(blueprint.cost ?? 0)) {\r\n    state.lastPreview.valid = false;\r\n    return false;\r\n  }\r\n  const structure = createStructureFromBlueprint(blueprint, preview);\r\n  addStructure(structure);\r\n  spawnRingBurst({\r\n    x: structure.x,\r\n    y: structure.y - (structure.height ?? 80),\r\n    startRadius: 20,\r\n    endRadius: Math.max(90, structure.width ?? 120),\r\n    color: blueprint.accentColor ?? \"#8cffd4\",\r\n    ttl: 0.35\r\n  });\r\n  return true;\r\n}\r\n\r\nfunction toggleBuildMode(forceState) {\r\n  const state = getBuildState();\r\n  if (typeof forceState === \"boolean\") {\r\n    state.active = forceState;\r\n  } else {\r\n    state.active = !state.active;\r\n  }\r\n  if (!state.active) {\r\n    state.lastPreview.valid = false;\r\n  } else {\r\n    calculatePreview();\r\n  }\r\n}\r\n\r\nfunction handleBuildInputs() {\r\n  const state = getBuildState();\r\n  if (input.buildToggleBuffered) {\r\n    toggleBuildMode();\r\n    input.buildToggleBuffered = false;\r\n  }\r\n  if (!state.active) {\r\n    input.buildCycleBuffered = 0;\r\n    input.buildConfirmBuffered = false;\r\n    input.buildCancelBuffered = false;\r\n    return;\r\n  }\r\n  if (input.buildCycleBuffered !== 0) {\r\n    cycleBlueprint(input.buildCycleBuffered);\r\n    input.buildCycleBuffered = 0;\r\n    calculatePreview();\r\n  }\r\n  if (input.buildCancelBuffered) {\r\n    toggleBuildMode(false);\r\n    input.buildCancelBuffered = false;\r\n  }\r\n  if (input.buildConfirmBuffered || input.attackBuffered) {\r\n    if (placeStructure()) {\r\n      input.buildConfirmBuffered = false;\r\n      input.attackBuffered = false;\r\n      input.attackDown = false;\r\n      calculatePreview();\r\n    } else {\r\n      input.buildConfirmBuffered = false;\r\n      input.attackBuffered = false;\r\n    }\r\n  }\r\n}\r\n\r\nfunction damageStructure(structure, amount) {\r\n  if (!structure || amount <= 0) {\r\n    return;\r\n  }\r\n  structure.health = Math.max(0, structure.health - amount);\r\n  structure.flashTimer = 0.25;\r\n}\r\n\r\nfunction destroyStructure(structures, index, structure) {\r\n  spawnRingBurst({\r\n    x: structure.x,\r\n    y: structure.y - (structure.height ?? 80),\r\n    startRadius: 30,\r\n    endRadius: Math.max(120, (structure.width ?? 120) * 1.4),\r\n    color: structure.accentColor ?? \"#ffb347\",\r\n    ttl: 0.4\r\n  });\r\n  structures.splice(index, 1);\r\n  const salvage = Math.max(5, Math.round((structure.maxHealth ?? 200) / 15));\r\n  spawnSalvagePickup({\r\n    x: structure.x,\r\n    y: structure.y - (structure.height ?? 80),\r\n    amount: salvage,\r\n    vy: -150\r\n  });\r\n}\r\n\r\nfunction updateTurret(structure, delta) {\r\n  const turret = structure.turret;\r\n  if (!turret) {\r\n    return;\r\n  }\r\n  structure.fireCooldown = Math.max(0, (structure.fireCooldown ?? 0) - delta);\r\n  if (structure.fireCooldown > 0) {\r\n    return;\r\n  }\r\n  let bestEnemy = null;\r\n  let bestDist = Number.POSITIVE_INFINITY;\r\n  const muzzleY = structure.y - (structure.height ?? 100) + 24;\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const dx = enemy.x - structure.x;\r\n    const dy = (enemy.y + enemy.height * 0.5) - muzzleY;\r\n    const distance = Math.hypot(dx, dy);\r\n    if (distance > (turret.range ?? 420)) {\r\n      continue;\r\n    }\r\n    if (distance < bestDist) {\r\n      bestDist = distance;\r\n      bestEnemy = enemy;\r\n    }\r\n  }\r\n  if (!bestEnemy) {\r\n    return;\r\n  }\r\n  const dx = bestEnemy.x - structure.x;\r\n  const dy = (bestEnemy.y + bestEnemy.height * 0.5) - muzzleY;\r\n  const distance = Math.max(1, Math.hypot(dx, dy));\r\n  const speed = turret.projectile?.speed ?? 520;\r\n  const vx = (dx / distance) * speed;\r\n  const vy = (dy / distance) * speed;\r\n  spawnProjectile({\r\n    x: structure.x,\r\n    y: muzzleY,\r\n    vx,\r\n    vy,\r\n    radius: turret.projectile?.radius ?? 6,\r\n    lifetime: 1.4,\r\n    damage: turret.projectile?.damage ?? 18,\r\n    color: turret.projectile?.color ?? \"#ffd57a\",\r\n    facing: Math.sign(dx) || 1,\r\n    gravityFactor: 0.05\r\n  });\r\n  structure.fireCooldown = turret.cooldown ?? 1.2;\r\n}\r\n\r\nfunction applyShieldField(structure, delta) {\r\n  const shield = structure.shield;\r\n  if (!shield) {\r\n    return;\r\n  }\r\n  const radius = shield.radius ?? 220;\r\n  const emitY = structure.y - (structure.height ?? 100) * 0.6;\r\n  const actors = [stickman, ...squadmates];\r\n  for (const actor of actors) {\r\n    if (!actor || actor.health <= 0) {\r\n      continue;\r\n    }\r\n    const dx = actor.x - structure.x;\r\n    const dy = (actor.y + actor.height) - emitY;\r\n    if (Math.hypot(dx, dy) <= radius) {\r\n      actor.structureShieldTimer = Math.max(actor.structureShieldTimer ?? 0, shield.buffDuration ?? 0.6);\r\n      actor.structureShieldStrength = Math.max(actor.structureShieldStrength ?? 0, shield.damageReduction ?? 0.4);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateTrap(structure, delta) {\r\n  const trap = structure.trap;\r\n  if (!trap) {\r\n    return;\r\n  }\r\n  structure.trapCooldown = Math.max(0, (structure.trapCooldown ?? 0) - delta);\r\n  if (structure.trapCooldown > 0) {\r\n    return;\r\n  }\r\n  const radius = trap.radius ?? 140;\r\n  const originY = structure.y - (structure.height ?? 24) * 0.5;\r\n  let triggered = false;\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const dx = enemy.x - structure.x;\r\n    const dy = (enemy.y + enemy.height * 0.5) - originY;\r\n    if (Math.hypot(dx, dy) <= radius) {\r\n      applyDamageToEnemy(enemy, {\r\n        damage: trap.damage ?? 24,\r\n        knockback: 160,\r\n        launch: 0,\r\n        facing: Math.sign(dx) || 1\r\n      });\r\n      enemy.stunTimer = Math.max(enemy.stunTimer ?? 0, trap.stun ?? 0.6);\r\n      triggered = true;\r\n    }\r\n  }\r\n  if (triggered) {\r\n    structure.trapCooldown = trap.cooldown ?? 2.6;\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: structure.x,\r\n      y: originY,\r\n      radius: radius * 1.2,\r\n      intensity: 1.4,\r\n      color: trap.color ?? \"#9af0ff\",\r\n      ttl: 0.25,\r\n      flicker: 0.5,\r\n      decay: 1.2\r\n    });\r\n    spawnRingBurst({\r\n      x: structure.x,\r\n      y: originY,\r\n      startRadius: radius * 0.6,\r\n      endRadius: radius * 1.3,\r\n      color: trap.color ?? \"#9af0ff\",\r\n      ttl: 0.3,\r\n      lineWidth: 5\r\n    });\r\n  }\r\n}\r\n\r\nfunction updateStructureCollisions(structure, delta) {\r\n  const halfWidth = (structure.width ?? 120) / 2;\r\n  const topY = structure.y - (structure.height ?? 80);\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const horizontalOverlap = Math.abs(enemy.x - structure.x) - (halfWidth + enemy.radius - 6);\r\n    const verticalOverlap = (enemy.y + enemy.height) - topY;\r\n    if (horizontalOverlap <= 0 && verticalOverlap > -40) {\r\n      damageStructure(structure, (enemy.attackDamage ?? 12) * delta);\r\n      enemy.vx *= 0.2;\r\n      enemy.stateTimer = Math.max(enemy.stateTimer ?? 0, 0.2);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateStructures(delta) {\r\n  const structures = getStructures();\r\n  for (let i = structures.length - 1; i >= 0; i -= 1) {\r\n    const structure = structures[i];\r\n    structure.flashTimer = Math.max(0, (structure.flashTimer ?? 0) - delta);\r\n    updateStructureCollisions(structure, delta);\r\n    updateTurret(structure, delta);\r\n    applyShieldField(structure, delta);\r\n    updateTrap(structure, delta);\r\n    if (structure.health <= 0) {\r\n      destroyStructure(structures, i, structure);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updateBuildingSystem(delta) {\r\n  handleBuildInputs();\r\n  updateStructures(delta);\r\n  const state = getBuildState();\r\n  if (state.active) {\r\n    calculatePreview();\r\n  }\r\n}\r\n\r\nfunction getBuildingHudStatus() {\r\n  const state = getBuildState();\r\n  const blueprint = getBlueprintByIndex(state.blueprintIndex);\r\n  return {\r\n    active: state.active,\r\n    resources: getMaterialCount(),\r\n    blueprintName: blueprint?.name ?? \"None\",\r\n    cost: blueprint?.cost ?? 0,\r\n    valid: state.lastPreview.valid\r\n  };\r\n}\r\n\r\nresetStructures();\r\n\r\nexport {\r\n  updateBuildingSystem,\r\n  getStructures,\r\n  getBuildState,\r\n  calculatePreview,\r\n  getBuildingHudStatus,\r\n  toggleBuildMode,\r\n  cycleBlueprint,\r\n  placeStructure\r\n};\r\n\r\n","const coopState = {\n  active: false,\n  connected: 0,\n  bestConnected: 0,\n  maxParticipants: 100,\n  packetsPerSecond: 0,\n  averageLatency: 0,\n  hostId: `coop-host-${Math.random().toString(36).slice(2, 8)}`,\n  lastOutcome: \"inactive\"\n};\n\nfunction activateCoop(maxParticipants = coopState.maxParticipants) {\n  coopState.active = true;\n  coopState.lastOutcome = \"active\";\n  coopState.maxParticipants = Math.max(1, Math.floor(maxParticipants ?? coopState.maxParticipants));\n}\n\nfunction deactivateCoop(outcome = \"inactive\") {\n  coopState.active = false;\n  coopState.connected = 0;\n  coopState.packetsPerSecond = 0;\n  coopState.averageLatency = 0;\n  coopState.lastOutcome = outcome ?? \"inactive\";\n}\n\nfunction setCoopParticipants(count, maxParticipants = coopState.maxParticipants) {\n  const value = Math.max(0, Math.floor(count ?? 0));\n  coopState.connected = value;\n  coopState.bestConnected = Math.max(coopState.bestConnected, value);\n  if (typeof maxParticipants === \"number\" && Number.isFinite(maxParticipants)) {\n    coopState.maxParticipants = Math.max(value, Math.floor(maxParticipants));\n  }\n}\n\nfunction setCoopMetrics({ packetsPerSecond, averageLatency } = {}) {\n  if (typeof packetsPerSecond === \"number\" && Number.isFinite(packetsPerSecond)) {\n    coopState.packetsPerSecond = Math.max(0, packetsPerSecond);\n  }\n  if (typeof averageLatency === \"number\" && Number.isFinite(averageLatency)) {\n    coopState.averageLatency = Math.max(0, averageLatency);\n  }\n}\n\nfunction setCoopOutcome(outcome) {\n  if (typeof outcome === \"string\" && outcome.trim()) {\n    coopState.lastOutcome = outcome.trim();\n  }\n}\n\nfunction resetCoopStats() {\n  coopState.bestConnected = 0;\n  coopState.packetsPerSecond = 0;\n  coopState.averageLatency = 0;\n}\n\nfunction getCoopHudStatus() {\n  return {\n    active: coopState.active,\n    participants: coopState.connected,\n    maxParticipants: coopState.maxParticipants,\n    bestParticipants: coopState.bestConnected,\n    packetsPerSecond: coopState.packetsPerSecond,\n    averageLatency: coopState.averageLatency,\n    hostId: coopState.hostId,\n    lastOutcome: coopState.lastOutcome\n  };\n}\n\nexport {\n  activateCoop,\n  deactivateCoop,\n  setCoopParticipants,\n  setCoopMetrics,\n  setCoopOutcome,\n  resetCoopStats,\n  getCoopHudStatus\n};\r\n","const INTERACTABLE_TEMPLATES = {\n  pushCrate: {\n    category: \"movable\",\n    width: 96,\n    height: 72,\n    mass: 3.2,\n    friction: 3.6,\n    maxSpeed: 160,\n    pushImpulse: 360,\n    hitImpulse: 520,\n    bodyColor: \"#8b6f4a\",\n    edgeColor: \"#4a3b28\",\n    braceColor: \"#c59b61\",\n    highlightColor: \"#ffd89a\"\n  },\n  kickBarrel: {\n    category: \"rolling\",\n    radius: 30,\n    height: 78,\n    mass: 1.1,\n    friction: 1.8,\n    maxSpeed: 320,\n    pushImpulse: 280,\n    hitImpulse: 680,\n    bodyColor: \"#a33b32\",\n    stripeColor: \"#ffd45f\",\n    edgeColor: \"#3a1c18\",\n    topColor: \"#c95b4f\"\n  },\n  shockTrap: {\n    category: \"trap\",\n    width: 110,\n    height: 20,\n    damage: 24,\n    knockback: 90,\n    launch: -160,\n    cooldown: 2.8,\n    stunDuration: 0.75,\n    bodyColor: \"#2a374b\",\n    accentColor: \"#6ddcff\",\n    glowColor: \"#8cf7ff\"\n  }\n};\n\nexport { INTERACTABLE_TEMPLATES };\r\n","import { INTERACTABLE_TEMPLATES } from \"../config/interactables.js\";\nimport { getEnvironmentInteractableSpawns, onEnvironmentChange } from \"./environment.js\";\n\nfunction createInteractableFromSpawn(spawn) {\n  const baseTemplate = INTERACTABLE_TEMPLATES[spawn.type];\n  if (!baseTemplate) {\n    throw new Error(`Unknown interactable template: ${spawn.type}`);\n  }\n\n  const templateOverrides = spawn.templateOverrides ?? {};\n  const template = { ...baseTemplate, ...templateOverrides };\n  const width = spawn.width ?? template.width ?? (template.radius ? template.radius * 2 : 64);\n  const height = spawn.height ?? template.height ?? 48;\n  const radius = spawn.radius ?? template.radius ?? Math.max(width, height) * 0.5;\n\n  const interactable = {\n    id: spawn.id,\n    type: spawn.type,\n    template,\n    x: spawn.x,\n    y: spawn.baseY,\n    vx: 0,\n    vy: 0,\n    width,\n    height,\n    radius,\n    state: template.initialState ?? \"idle\",\n    timer: 0,\n    cooldown: 0,\n    highlight: 0,\n    triggered: false,\n    flashTimer: 0,\n    smokeTimer: 0,\n    mass: template.mass ?? 1,\n    friction: template.friction ?? 2,\n    maxSpeed: template.maxSpeed ?? 240,\n    pushImpulse: template.pushImpulse ?? 240,\n    hitImpulse: template.hitImpulse ?? template.pushImpulse ?? 320,\n    facing: spawn.facing ?? 1,\n    minX: spawn.minX ?? null,\n    maxX: spawn.maxX ?? null\n  };\n\n  if (spawn.overrides && typeof spawn.overrides === \"object\") {\n    Object.assign(interactable, spawn.overrides);\n  }\n\n  return interactable;\n}\n\nfunction createInitialState() {\n  return getEnvironmentInteractableSpawns().map((spawn) => createInteractableFromSpawn(spawn));\n}\n\nconst interactables = createInitialState();\n\nfunction resetInteractables() {\n  interactables.length = 0;\n  const fresh = createInitialState();\n  for (const item of fresh) {\n    interactables.push(item);\n  }\n}\n\nfunction getInteractables() {\n  return interactables;\n}\n\nfunction getInteractableById(id) {\n  return interactables.find((item) => item.id === id) ?? null;\n}\n\nonEnvironmentChange(() => {\n  resetInteractables();\n});\n\nexport { interactables, getInteractables, getInteractableById, resetInteractables };\r\n","import { context } from \"../../environment/canvas.js\";\nimport { isWithinView, recordVisibility } from \"./culling.js\";\nimport { getInteractables } from \"../../state/interactables.js\";\nimport { clamp } from \"../utils/math.js\";\nimport { getElapsedTime } from \"../utils/time.js\";\n\nfunction drawCrate(interactable, template, elapsed) {\n  const halfWidth = (interactable.width ?? 96) / 2;\n  const height = interactable.height ?? 72;\n  const top = interactable.y - height;\n  const sway = Math.sin(elapsed * 4 + interactable.x * 0.02) * (interactable.vx ?? 0) * 0.002;\n\n  context.save();\n  context.translate(interactable.x, interactable.y);\n  context.rotate(sway);\n\n  context.fillStyle = template.bodyColor ?? \"#8b6f4a\";\n  context.fillRect(-halfWidth, -height, halfWidth * 2, height);\n\n  context.strokeStyle = template.edgeColor ?? \"#4a3b28\";\n  context.lineWidth = 4;\n  context.strokeRect(-halfWidth, -height, halfWidth * 2, height);\n\n  context.strokeStyle = template.braceColor ?? \"#c59b61\";\n  context.lineWidth = 3;\n  const braceInset = halfWidth * 0.4;\n  context.beginPath();\n  context.moveTo(-halfWidth, -height + 8);\n  context.lineTo(-braceInset, -height + height * 0.4);\n  context.moveTo(halfWidth, -height + 8);\n  context.lineTo(braceInset, -height + height * 0.4);\n  context.moveTo(-halfWidth, -height + height * 0.55);\n  context.lineTo(-braceInset, -8);\n  context.moveTo(halfWidth, -height + height * 0.55);\n  context.lineTo(braceInset, -8);\n  context.stroke();\n\n  context.restore();\n}\n\nfunction drawBarrel(interactable, template, elapsed) {\n  const radius = interactable.radius ?? 30;\n  const height = interactable.height ?? radius * 2.2;\n  const top = interactable.y - height;\n  const wobble = Math.sin(elapsed * 6 + interactable.x * 0.05) * (interactable.vx ?? 0) * 0.003;\n\n  context.save();\n  context.translate(interactable.x, top + height / 2);\n  context.rotate(wobble);\n\n  context.fillStyle = template.bodyColor ?? \"#a33b32\";\n  context.beginPath();\n  context.ellipse(0, 0, radius, height * 0.5, 0, 0, Math.PI * 2);\n  context.fill();\n\n  context.fillStyle = template.topColor ?? \"#c95b4f\";\n  context.beginPath();\n  context.ellipse(0, -height * 0.5, radius * 0.95, radius * 0.55, 0, 0, Math.PI * 2);\n  context.fill();\n\n  context.fillStyle = template.edgeColor ?? \"#3a1c18\";\n  context.beginPath();\n  context.ellipse(0, height * 0.5, radius * 0.95, radius * 0.55, 0, 0, Math.PI * 2);\n  context.fill();\n\n  context.strokeStyle = template.stripeColor ?? \"#ffd45f\";\n  context.lineWidth = 5;\n  context.beginPath();\n  context.moveTo(-radius * 0.85, -height * 0.25);\n  context.lineTo(radius * 0.85, -height * 0.1);\n  context.moveTo(-radius * 0.85, height * 0.05);\n  context.lineTo(radius * 0.85, height * 0.2);\n  context.stroke();\n\n  context.restore();\n}\n\nfunction drawTrap(interactable, template, elapsed) {\n  const halfWidth = (interactable.width ?? 110) / 2;\n  const height = interactable.height ?? 20;\n  const top = interactable.y - height;\n  const glow = template.glowColor ?? \"#8cf7ff\";\n  const accent = template.accentColor ?? \"#6ddcff\";\n  const body = template.bodyColor ?? \"#2a374b\";\n  const pulse = Math.sin(elapsed * 5 + interactable.x * 0.04) * 0.15 + 0.35 + (interactable.cooldown > 0 ? 0.1 : 0.35);\n\n  context.save();\n  context.translate(interactable.x, 0);\n\n  context.fillStyle = body;\n  context.fillRect(-halfWidth, top, halfWidth * 2, height);\n\n  context.fillStyle = accent;\n  context.fillRect(-halfWidth * 0.9, top + height * 0.25, halfWidth * 1.8, height * 0.35);\n\n  context.globalAlpha = clamp(pulse, 0, 1);\n  context.fillStyle = glow;\n  context.fillRect(-halfWidth, top - 6, halfWidth * 2, height * 0.2);\n  context.fillRect(-halfWidth, top + height - 4, halfWidth * 2, height * 0.2);\n  context.globalAlpha = 1;\n\n  context.restore();\n}\n\nfunction drawInteractable(interactable, elapsed) {\n  const template = interactable.template ?? {};\n  switch (template.category) {\n    case \"movable\":\n      drawCrate(interactable, template, elapsed);\n      break;\n    case \"rolling\":\n      drawBarrel(interactable, template, elapsed);\n      break;\n    case \"trap\":\n      drawTrap(interactable, template, elapsed);\n      break;\n    default:\n      break;\n  }\n\n  const flash = interactable.flashTimer ?? 0;\n  if (flash > 0) {\n    const alpha = clamp(flash / 0.2, 0, 1) * 0.4;\n    const halfWidth = interactable.width ? interactable.width / 2 : interactable.radius;\n    const height = interactable.height ?? halfWidth * 1.4;\n    context.save();\n    context.fillStyle = `rgba(255, 255, 255, ${alpha.toFixed(3)})`;\n    context.translate(interactable.x, interactable.y);\n    context.fillRect(-halfWidth, -height, halfWidth * 2, height);\n    context.restore();\n  }\n\n  const highlight = clamp(interactable.highlight ?? 0, 0, 1);\n  if (highlight > 0.01) {\n    const templateHighlight = template.highlightColor ?? template.accentColor ?? \"#ffd89a\";\n    const halfWidth = interactable.width ? interactable.width / 2 : interactable.radius;\n    const height = interactable.height ?? halfWidth * 1.4;\n    context.save();\n    context.globalAlpha = highlight * 0.45;\n    context.fillStyle = templateHighlight;\n    context.translate(interactable.x, interactable.y);\n    context.fillRect(-halfWidth * 1.15, -height * 1.05, halfWidth * 2.3, height * 1.3);\n    context.restore();\n  }\n}\n\nfunction drawInteractables() {\n  const items = getInteractables();\n  if (!items || items.length === 0) {\n    return;\n  }\n  const elapsed = getElapsedTime();\n  context.save();\n  for (const interactable of items) {\n    const halfWidth = ((interactable.width ?? 80) * 0.5) + 36;\n    const culled = !isWithinView(interactable.x, halfWidth, 280);\n    recordVisibility(\"interactable\", culled);\n    if (culled) {\n      continue;\n    }\n    drawInteractable(interactable, elapsed);\n  }\n  context.restore();\n}\n\nexport { drawInteractables };\r\n","import { stickman } from \"../../state/entities.js\";\r\n\r\nconst muzzleFlashes = [];\r\nconst shieldBursts = [];\r\nconst throwableBursts = [];\r\nconst notices = [];\r\nconst shotIndicators = [];\r\n\r\nconst filters = {\r\n  weapons: true,\r\n  shield: true,\r\n  throwables: true\r\n};\r\n\r\nconst FILTER_TOGGLE_MAP = {\r\n  Digit6: \"weapons\",\r\n  Digit7: \"shield\",\r\n  Digit8: \"throwables\"\r\n};\r\n\r\nfunction pushNotice(message, ttl = 1.8) {\r\n  const last = notices[notices.length - 1];\r\n  if (last && last.message === message) {\r\n    last.ttl = ttl;\r\n    last.maxTtl = ttl;\r\n    last.age = 0;\r\n    return;\r\n  }\r\n  notices.push({ message, ttl, maxTtl: ttl, age: 0 });\r\n  while (notices.length > 6) {\r\n    notices.shift();\r\n  }\r\n}\r\n\r\nfunction pushThrowableBurst(type, detail = {}, ttl = 0.4) {\r\n  const burst = {\r\n    type,\r\n    x: detail.x ?? stickman.x,\r\n    y: detail.y ?? stickman.y,\r\n    radius: detail.radius ?? 110,\r\n    ttl,\r\n    maxTtl: ttl\r\n  };\r\n  throwableBursts.push(burst);\r\n  return burst;\r\n}\r\n\r\nfunction shouldCapture(category) {\r\n  return filters[category] !== false;\r\n}\r\n\r\nfunction toggleFilter(category) {\r\n  filters[category] = !filters[category];\r\n  const pretty = category.charAt(0).toUpperCase() + category.slice(1);\r\n  const stateLabel = filters[category] ? \"ON\" : \"OFF\";\r\n  pushNotice(`Debug filter ${pretty} ${stateLabel}`, 1.4);\r\n  if (!filters[category]) {\r\n    if (category === \"weapons\") {\r\n      muzzleFlashes.length = 0;\r\n      shotIndicators.length = 0;\r\n    } else if (category === \"shield\") {\r\n      shieldBursts.length = 0;\r\n    } else if (category === \"throwables\") {\r\n      throwableBursts.length = 0;\r\n    }\r\n  }\r\n}\r\n\r\nfunction handleFilterToggle(event) {\r\n  if (!event.altKey || event.repeat) {\r\n    return;\r\n  }\r\n  const category = FILTER_TOGGLE_MAP[event.code];\r\n  if (!category) {\r\n    return;\r\n  }\r\n  if (typeof event.preventDefault === \"function\") {\r\n    event.preventDefault();\r\n  }\r\n  toggleFilter(category);\r\n}\r\n\r\nfunction handleMuzzleFlash(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const ttl = 0.12;\r\n  muzzleFlashes.push({\r\n    weaponId: detail.weaponId ?? \"unknown\",\r\n    x: detail.x ?? stickman.x,\r\n    y: detail.y ?? stickman.y,\r\n    facing: detail.facing ?? stickman.facing ?? 1,\r\n    ttl,\r\n    maxTtl: ttl\r\n  });\r\n}\r\n\r\nfunction handleShotFired(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const ttl = 0.4;\r\n  const weaponId = detail.weaponId ?? \"unknown\";\r\n  const existing = shotIndicators.find((entry) => entry.weaponId === weaponId);\r\n  if (existing) {\r\n    existing.ttl = ttl;\r\n    existing.maxTtl = ttl;\r\n    existing.age = 0;\r\n    return;\r\n  }\r\n  shotIndicators.push({ weaponId, ttl, maxTtl: ttl, age: 0 });\r\n  while (shotIndicators.length > 5) {\r\n    shotIndicators.shift();\r\n  }\r\n}\r\n\r\nfunction handleReloadStart(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const weaponId = event?.detail?.weaponId ?? \"unknown\";\r\n  pushNotice(`Reloading ${weaponId}`);\r\n}\r\n\r\nfunction handleReloadFinish(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const weaponId = event?.detail?.weaponId ?? \"unknown\";\r\n  pushNotice(`Reload complete ${weaponId}`, 1.4);\r\n}\r\n\r\nfunction handleRecoilKick(event) {\r\n  if (!shouldCapture(\"weapons\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const weaponId = detail.weaponId ?? \"unknown\";\r\n  const horizontal = detail.recoil?.horizontal ?? 0;\r\n  const vertical = detail.recoil?.vertical ?? 0;\r\n  const magnitude = Math.hypot(horizontal, vertical);\r\n  if (magnitude <= 0) {\r\n    return;\r\n  }\r\n  pushNotice(`Recoil ${weaponId}: ${magnitude.toFixed(2)}`, 1.2);\r\n}\r\n\r\n\nfunction handleEnvironmentChanged(event) {\r\n  const env = event?.detail?.environment;\r\n  const name = env?.name ?? env?.id;\r\n  if (!name) {\r\n    return;\r\n  }\r\n  pushNotice(`Environment set to ${name}`, 2.2);\r\n}\n\r\nfunction handleShieldHit(event) {\r\n  if (!shouldCapture(\"shield\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const ttl = 0.28;\r\n  const center = {\r\n    x: detail.center?.x ?? stickman.x,\r\n    y: detail.center?.y ?? stickman.y\r\n  };\r\n  shieldBursts.push({\r\n    type: \"hit\",\r\n    absorb: detail.absorb ?? 0,\r\n    center,\r\n    ttl,\r\n    maxTtl: ttl\r\n  });\r\n  if (detail.absorb !== undefined) {\r\n    pushNotice(`Shield absorb ${Math.round(detail.absorb)}`, 1.2);\r\n  }\r\n}\r\n\r\nfunction handleShieldShatter(event) {\r\n  if (!shouldCapture(\"shield\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const ttl = 0.45;\r\n  const center = {\r\n    x: detail.center?.x ?? stickman.x,\r\n    y: detail.center?.y ?? stickman.y\r\n  };\r\n  shieldBursts.push({\r\n    type: \"shatter\",\r\n    center,\r\n    ttl,\r\n    maxTtl: ttl\r\n  });\r\n  const reason = detail.reason ?? \"shatter\";\r\n  pushNotice(`Shield ${reason}`, 1.6);\r\n}\r\n\r\nfunction handleShieldEnd(event) {\r\n  if (!shouldCapture(\"shield\")) {\r\n    return;\r\n  }\r\n  const reason = event?.detail?.reason ?? \"ended\";\r\n  if (reason === \"shatter\") {\r\n    return;\r\n  }\r\n  pushNotice(`Shield ${reason}`, 1.4);\r\n}\r\n\r\nfunction handleThrowableThrown(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const effect = detail.effectType ?? \"unknown\";\r\n  pushNotice(`Throwable thrown (${effect})`, 1.4);\r\n}\r\n\r\nfunction handleThrowableExplosion(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  pushThrowableBurst(\"explosion\", detail, 0.55);\r\n  if (detail.damage !== undefined) {\r\n    pushNotice(`Explosion damage ${detail.damage}`, 1.6);\r\n  } else {\r\n    pushNotice(\"Explosion triggered\", 1.4);\r\n  }\r\n}\r\n\r\nfunction handleThrowableFlashBurst(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  pushThrowableBurst(\"flash\", detail, 0.45);\r\n  const stunDuration = detail.stunDuration ?? 0;\r\n  const stunLabel = typeof stunDuration === \"number\" ? stunDuration.toFixed(1) : String(stunDuration);\r\n  pushNotice(`Flash burst (stun ${stunLabel}s)`, 1.6);\r\n}\r\n\r\nfunction handleThrowableSmokeDetonate(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  const burst = pushThrowableBurst(\"smoke\", detail, 0.6);\r\n  burst.maxRadius = detail.radius ?? burst.radius;\r\n  const durationSeconds = Math.round(((detail.duration ?? 0) + Number.EPSILON) * 10) / 10;\r\n  pushNotice(`Smoke deployed (${durationSeconds}s)`, 1.6);\r\n}\r\n\r\nfunction handleThrowableSmokeDissipate(event) {\r\n  if (!shouldCapture(\"throwables\")) {\r\n    return;\r\n  }\r\n  const detail = event?.detail ?? {};\r\n  pushThrowableBurst(\"smoke-fade\", detail, 0.4);\r\n  pushNotice(\"Smoke dissipated\", 1.4);\r\n}\r\n\r\nlet listenersRegistered = false;\r\n\r\nfunction ensureListeners() {\r\n  if (listenersRegistered || typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n  window.addEventListener(\"weapon:muzzle-flash\", handleMuzzleFlash);\r\n  window.addEventListener(\"weapon:shot-fired\", handleShotFired);\r\n  window.addEventListener(\"weapon:reload-start\", handleReloadStart);\r\n  window.addEventListener(\"weapon:reload-finish\", handleReloadFinish);\r\n  window.addEventListener(\"weapon:recoil-kick\", handleRecoilKick);\r\n  window.addEventListener(\"shield:hit\", handleShieldHit);\r\n  window.addEventListener(\"shield:shatter\", handleShieldShatter);\r\n  window.addEventListener(\"shield:end\", handleShieldEnd);\r\n  window.addEventListener(\"throwable:thrown\", handleThrowableThrown);\r\n  window.addEventListener(\"throwable:explosion\", handleThrowableExplosion);\r\n  window.addEventListener(\"throwable:flash-burst\", handleThrowableFlashBurst);\r\n  window.addEventListener(\"throwable:smoke-detonate\", handleThrowableSmokeDetonate);\r\n  window.addEventListener(\"throwable:smoke-dissipate\", handleThrowableSmokeDissipate);\r\n  window.addEventListener(\"environment:changed\", handleEnvironmentChanged);\r\n  window.addEventListener(\"keydown\", handleFilterToggle);\r\n  listenersRegistered = true;\r\n}\r\n\r\nfunction updateList(list, delta) {\r\n  for (let i = list.length - 1; i >= 0; i -= 1) {\r\n    const entry = list[i];\r\n    entry.ttl -= delta;\r\n    entry.age = (entry.age ?? 0) + delta;\r\n    if (entry.ttl <= 0) {\r\n      list.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nfunction updatePolishDebug(delta) {\r\n  ensureListeners();\r\n  updateList(muzzleFlashes, delta);\r\n  updateList(shieldBursts, delta);\r\n  updateList(throwableBursts, delta);\r\n  updateList(notices, delta);\r\n  updateList(shotIndicators, delta);\r\n}\r\n\r\nfunction getPolishDebugState() {\r\n  ensureListeners();\r\n  return {\r\n    muzzleFlashes,\r\n    shieldBursts,\r\n    throwableBursts,\r\n    notices,\r\n    shotIndicators,\r\n    filters: { ...filters }\r\n  };\r\n}\r\n\r\nexport { updatePolishDebug, getPolishDebugState };\r\n","import { getElapsedTime } from \"../core/utils/time.js\";\r\n\r\n\r\nconst recoilState = {\r\n  horizontalKick: 0,\r\n  verticalKick: 0,\r\n  decay: 12,\r\n  lastShotTime: 0\r\n};\r\n\r\nfunction applyRecoil(kick) {\r\n  recoilState.horizontalKick += kick?.horizontal ?? 0;\r\n  recoilState.verticalKick += kick?.vertical ?? 0;\r\n  recoilState.decay = kick?.decay ?? recoilState.decay;\r\n  recoilState.lastShotTime = getElapsedTime();\r\n}\r\n\r\nfunction updateRecoil(delta) {\r\n  const decayRate = recoilState.decay ?? 12;\r\n  const decayFactor = Math.max(0, 1 - decayRate * delta);\r\n  recoilState.horizontalKick *= decayFactor;\r\n  recoilState.verticalKick *= decayFactor;\r\n}\r\n\r\nfunction getRecoilOffset() {\r\n  return {\r\n    horizontal: recoilState.horizontalKick,\r\n    vertical: recoilState.verticalKick\r\n  };\r\n}\r\n\r\nexport { applyRecoil, updateRecoil, getRecoilOffset };\r\n\r\n\r\n","import { context, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { getEnvironmentPlatforms, getEnvironmentWaterZones, getEnvironmentDecor } from \"../../state/environment.js\";\r\n\r\nfunction resolvePlatformLanding(entity, previousY, height) {\r\n  const prevFeet = previousY + height;\r\n  const platforms = getEnvironmentPlatforms();\r\n  for (const platform of platforms) {\r\n    if (entity.vy < 0) {\r\n      continue;\r\n    }\r\n    const nextFeet = entity.y + height;\r\n    if (prevFeet <= platform.y && nextFeet >= platform.y) {\r\n      if (entity.x >= platform.x && entity.x <= platform.x + platform.width) {\r\n        entity.y = platform.y - height;\r\n        entity.vy = 0;\r\n        if (Object.prototype.hasOwnProperty.call(entity, \"onGround\")) {\r\n          entity.onGround = true;\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nconst PLATFORM_STYLES = {\r\n  street: { fill: \"#2c2f36\", stroke: \"#1b1d22\" },\r\n  metro: { fill: \"#3d4252\", stroke: \"#272b37\" },\r\n  rooftop: { fill: \"#4c5566\", stroke: \"#2f3541\" },\r\n  skybridge: { fill: \"#596274\", stroke: \"#323846\" },\r\n  terrace: { fill: \"#46505f\", stroke: \"#2a303b\" },\r\n  balcony: { fill: \"#525a6a\", stroke: \"#2f3540\" },\r\n  median: { fill: \"#3a404a\", stroke: \"#23272f\" },\r\n  jungleFloor: { fill: \"#314629\", stroke: \"#1c2917\" },\r\n  stone: { fill: \"#4c5f4c\", stroke: \"#2a3628\" },\r\n  canopy: { fill: \"#3f5e3a\", stroke: \"#23361f\" },\r\n  branch: { fill: \"#594427\", stroke: \"#2e2010\" },\r\n  sand: { fill: \"#cfa665\", stroke: \"#8a6a3a\" },\r\n  cliff: { fill: \"#8b6b42\", stroke: \"#5b4426\" },\r\n  plateau: { fill: \"#b78b4f\", stroke: \"#7f6032\" },\r\n  deck: { fill: \"#303a4c\", stroke: \"#1d2431\" },\r\n  catwalk: { fill: \"#3c4a63\", stroke: \"#212a39\" },\r\n  maglev: { fill: \"#2a315a\", stroke: \"#181d33\" },\r\n  plain: { fill: \"#36404c\", stroke: \"#222730\" }\r\n};\r\n\r\nfunction drawWaterBodies() {\r\n  const zones = getEnvironmentWaterZones();\r\n  for (const zone of zones) {\r\n    const gradient = context.createLinearGradient(zone.x, zone.top, zone.x, zone.top + zone.depth);\r\n    gradient.addColorStop(0, zone.topColor ?? \"rgba(54, 98, 144, 0.88)\");\r\n    gradient.addColorStop(0.7, zone.midColor ?? \"rgba(36, 72, 112, 0.9)\");\r\n    gradient.addColorStop(1, zone.bottomColor ?? \"rgba(24, 50, 84, 0.95)\");\r\n    context.fillStyle = gradient;\r\n    context.fillRect(zone.x, zone.top, zone.width, zone.depth);\r\n\r\n    if (zone.highlight !== false) {\r\n      context.fillStyle = zone.highlightColor ?? \"rgba(255, 204, 112, 0.25)\";\r\n      context.fillRect(zone.x - 10, zone.top + 2, zone.width + 20, 4);\r\n    }\r\n\r\n    const rippleColor = zone.rippleColor ?? \"rgba(255, 255, 255, 0.12)\";\r\n    context.strokeStyle = rippleColor;\r\n    context.lineWidth = 1.6;\r\n    for (let i = 0; i < zone.width; i += 40) {\r\n      const waveY = zone.top + 6 + Math.sin((i + zone.top) * 0.03) * 3;\r\n      context.beginPath();\r\n      context.moveTo(zone.x + i, waveY);\r\n      context.quadraticCurveTo(zone.x + i + 10, waveY + 3, zone.x + i + 20, waveY);\r\n      context.stroke();\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawPlatform(platform) {\r\n  const style = PLATFORM_STYLES[platform.type] ?? PLATFORM_STYLES.plain;\r\n  context.fillStyle = style.fill;\r\n  context.fillRect(platform.x, platform.y, platform.width, platform.height);\r\n  context.strokeStyle = style.stroke;\r\n  context.lineWidth = 2;\r\n  context.strokeRect(platform.x, platform.y, platform.width, platform.height);\r\n}\r\n\r\nfunction drawBuilding(decor) {\r\n  context.save();\r\n  context.fillStyle = \"#2a3240\";\r\n  context.fillRect(decor.x, decor.y, decor.width, decor.height);\r\n  context.fillStyle = \"#4a6076\";\r\n  const floors = Math.max(3, Math.floor(decor.height / 60));\r\n  for (let f = 0; f < floors; f += 1) {\r\n    const y = decor.y + 20 + f * (decor.height / floors);\r\n    context.fillRect(decor.x + 10, y, decor.width - 20, 8);\r\n  }\r\n  context.restore();\r\n}\r\n\r\n\r\nfunction drawPalm(decor) {\r\n  const baseX = decor.baseX ?? decor.x ?? 0;\r\n  const baseY = decor.baseY ?? decor.y ?? GROUND_Y;\r\n  const height = decor.height ?? 220;\r\n  context.save();\r\n  context.translate(baseX, baseY);\r\n  context.strokeStyle = \"#3c2d1b\";\r\n  context.lineWidth = 8;\r\n  context.beginPath();\r\n  context.moveTo(0, 0);\r\n  context.lineTo(0, -height);\r\n  context.stroke();\r\n  context.lineWidth = 6;\r\n  context.beginPath();\r\n  context.moveTo(0, -height);\r\n  context.quadraticCurveTo(18, -height + 24, 32, -height + 58);\r\n  context.moveTo(0, -height);\r\n  context.quadraticCurveTo(-18, -height + 24, -32, -height + 58);\r\n  context.stroke();\r\n  context.fillStyle = \"#3f8f4a\";\r\n  for (let i = -2; i <= 2; i += 1) {\r\n    context.beginPath();\r\n    context.ellipse(i * 12, -height + 40, 40, 16, (Math.PI / 8) * i, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction drawRuin(decor) {\r\n  context.save();\r\n  context.fillStyle = \"#484f3d\";\r\n  context.fillRect(decor.x, decor.y, decor.width, decor.height);\r\n  context.fillStyle = \"#2f3526\";\r\n  const bricks = Math.max(2, Math.floor(decor.height / 40));\r\n  for (let i = 0; i < bricks; i += 1) {\r\n    const y = decor.y + i * (decor.height / bricks);\r\n    context.fillRect(decor.x + 4, y + 6, decor.width - 8, 6);\r\n  }\r\n  context.strokeStyle = \"#9db27e\";\r\n  context.lineWidth = 3;\r\n  context.setLineDash([6, 10]);\r\n  context.strokeRect(decor.x + 6, decor.y + 6, decor.width - 12, decor.height - 12);\r\n  context.setLineDash([]);\r\n  context.restore();\r\n}\r\n\r\nfunction drawVineArch(decor) {\r\n  context.save();\r\n  context.strokeStyle = \"#3a5c35\";\r\n  context.lineWidth = 10;\r\n  const x = decor.x;\r\n  const y = decor.y;\r\n  const width = decor.width ?? 180;\r\n  const height = decor.height ?? 120;\r\n  context.beginPath();\r\n  context.arc(x, y, width / 2, Math.PI, 0, false);\r\n  context.stroke();\r\n  context.lineWidth = 4;\r\n  context.strokeStyle = \"#5f8d4a\";\r\n  context.beginPath();\r\n  context.arc(x, y, width / 2 - 10, Math.PI, 0, false);\r\n  context.stroke();\r\n  context.fillStyle = \"#7fcf6a\";\r\n  for (let i = -3; i <= 3; i += 1) {\r\n    context.beginPath();\r\n    context.ellipse(x + i * 18, y - height * 0.4, 12, 20, Math.PI / 6, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n  context.restore();\r\n}\r\n\r\nfunction drawGlowPlant(decor) {\r\n  const x = decor.x;\r\n  const y = decor.y;\r\n  context.save();\r\n  const gradient = context.createRadialGradient(x, y, 0, x, y, 26);\r\n  gradient.addColorStop(0, \"rgba(120, 255, 191, 0.8)\");\r\n  gradient.addColorStop(1, \"rgba(120, 255, 191, 0)\");\r\n  context.fillStyle = gradient;\r\n  context.beginPath();\r\n  context.arc(x, y, 26, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.fillStyle = \"#63ffbd\";\r\n  context.beginPath();\r\n  context.arc(x, y, 8, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction drawWaterfall(decor) {\r\n  const width = decor.width ?? 80;\r\n  const height = decor.height ?? 200;\r\n  const x = decor.x - width / 2;\r\n  const y = decor.y - height;\r\n  const gradient = context.createLinearGradient(x, y, x, y + height);\r\n  gradient.addColorStop(0, \"rgba(110, 216, 255, 0.5)\");\r\n  gradient.addColorStop(1, \"rgba(110, 216, 255, 0.1)\");\r\n  context.fillStyle = gradient;\r\n  context.fillRect(x, y, width, height);\r\n  context.strokeStyle = \"rgba(173, 245, 255, 0.6)\";\r\n  context.lineWidth = 2;\r\n  for (let i = 0; i < width; i += 16) {\r\n    context.beginPath();\r\n    context.moveTo(x + i + 4, y);\r\n    context.lineTo(x + i + 8, y + height);\r\n    context.stroke();\r\n  }\r\n}\r\n\r\nfunction drawDune(decor) {\r\n  const baseX = decor.baseX ?? decor.x ?? 0;\r\n  const baseY = decor.baseY ?? decor.y ?? GROUND_Y;\r\n  const width = decor.width ?? 260;\r\n  const height = decor.height ?? 100;\r\n  context.save();\r\n  context.fillStyle = decor.color ?? \"#d59c5a\";\r\n  context.beginPath();\r\n  context.moveTo(baseX - width / 2, baseY);\r\n  context.quadraticCurveTo(baseX, baseY - height, baseX + width / 2, baseY);\r\n  context.closePath();\r\n  context.fill();\r\n  context.fillStyle = \"rgba(255, 226, 170, 0.35)\";\r\n  context.beginPath();\r\n  context.moveTo(baseX - width * 0.3, baseY - height * 0.25);\r\n  context.quadraticCurveTo(baseX, baseY - height * 0.65, baseX + width * 0.35, baseY - height * 0.28);\r\n  context.lineTo(baseX + width * 0.3, baseY - height * 0.18);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction drawRockSpire(decor) {\r\n  const baseX = decor.baseX ?? decor.x ?? 0;\r\n  const baseY = decor.baseY ?? decor.y ?? GROUND_Y;\r\n  const height = decor.height ?? 240;\r\n  context.save();\r\n  context.fillStyle = \"#7d6040\";\r\n  context.beginPath();\r\n  context.moveTo(baseX - 18, baseY);\r\n  context.lineTo(baseX + 18, baseY);\r\n  context.lineTo(baseX + 6, baseY - height);\r\n  context.lineTo(baseX - 12, baseY - height * 0.65);\r\n  context.closePath();\r\n  context.fill();\r\n  context.strokeStyle = \"#c6a37c\";\r\n  context.lineWidth = 3;\r\n  context.beginPath();\r\n  context.moveTo(baseX - 4, baseY - height * 0.3);\r\n  context.lineTo(baseX + 6, baseY - height * 0.6);\r\n  context.stroke();\r\n  context.restore();\r\n}\r\n\r\nfunction drawCampfire(decor) {\r\n  const baseX = decor.baseX ?? decor.x ?? 0;\r\n  const baseY = decor.baseY ?? decor.y ?? GROUND_Y - 20;\r\n  context.save();\r\n  context.strokeStyle = \"#5b3e24\";\r\n  context.lineWidth = 5;\r\n  context.beginPath();\r\n  context.moveTo(baseX - 16, baseY + 12);\r\n  context.lineTo(baseX + 12, baseY - 4);\r\n  context.moveTo(baseX + 16, baseY + 12);\r\n  context.lineTo(baseX - 12, baseY - 4);\r\n  context.stroke();\r\n  const gradient = context.createRadialGradient(baseX, baseY - 10, 0, baseX, baseY - 10, 36);\r\n  gradient.addColorStop(0, \"rgba(255, 174, 72, 0.95)\");\r\n  gradient.addColorStop(0.5, \"rgba(255, 116, 32, 0.6)\");\r\n  gradient.addColorStop(1, \"rgba(255, 116, 32, 0)\");\r\n  context.fillStyle = gradient;\r\n  context.beginPath();\r\n  context.arc(baseX, baseY - 10, 36, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction drawAntenna(decor) {\r\n  const x = decor.x;\r\n  const y = decor.y;\r\n  const height = decor.height ?? 300;\r\n  context.save();\r\n  context.strokeStyle = \"#b89c6d\";\r\n  context.lineWidth = 4;\r\n  context.beginPath();\r\n  context.moveTo(x, y + height);\r\n  context.lineTo(x, y);\r\n  context.stroke();\r\n  context.strokeStyle = \"#ffe6ac\";\r\n  context.lineWidth = 2;\r\n  for (let i = 0; i < 4; i += 1) {\r\n    const offset = (i + 1) * (height / 5);\r\n    context.beginPath();\r\n    context.moveTo(x - 18, y + offset);\r\n    context.lineTo(x + 18, y + offset - 12);\r\n    context.stroke();\r\n  }\r\n  context.fillStyle = \"#ffe89a\";\r\n  context.beginPath();\r\n  context.arc(x, y, 10, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction drawSpire(decor) {\r\n  const baseX = decor.baseX ?? decor.x ?? 0;\r\n  const baseY = decor.baseY ?? decor.y ?? GROUND_Y;\r\n  const height = decor.height ?? 320;\r\n  context.save();\r\n  context.fillStyle = \"#3f5ac9\";\r\n  context.beginPath();\r\n  context.moveTo(baseX - 28, baseY);\r\n  context.lineTo(baseX + 28, baseY);\r\n  context.lineTo(baseX + 8, baseY - height);\r\n  context.lineTo(baseX - 12, baseY - height * 0.6);\r\n  context.closePath();\r\n  context.fill();\r\n  context.fillStyle = \"rgba(120, 200, 255, 0.35)\";\r\n  context.beginPath();\r\n  context.moveTo(baseX, baseY - height * 0.92);\r\n  context.lineTo(baseX + 16, baseY - height * 0.4);\r\n  context.lineTo(baseX - 4, baseY - height * 0.32);\r\n  context.closePath();\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction drawHoloBillboard(decor) {\r\n  context.save();\r\n  const x = decor.x - decor.width / 2;\r\n  const y = decor.y - decor.height;\r\n  const gradient = context.createLinearGradient(x, y, x + decor.width, y + decor.height);\r\n  gradient.addColorStop(0, \"rgba(85, 170, 255, 0.4)\");\r\n  gradient.addColorStop(1, \"rgba(170, 120, 255, 0.7)\");\r\n  context.fillStyle = gradient;\r\n  context.fillRect(x, y, decor.width, decor.height);\r\n  context.strokeStyle = \"#8bd4ff\";\r\n  context.lineWidth = 3;\r\n  context.strokeRect(x, y, decor.width, decor.height);\r\n  context.fillStyle = \"#e5f5ff\";\r\n  context.font = \"18px 'Segoe UI', Arial, sans-serif\";\r\n  context.textAlign = \"center\";\r\n  context.fillText(decor.text ?? \"HOLO\", decor.x, decor.y - decor.height / 2);\r\n  context.restore();\r\n}\r\n\r\nfunction drawEnergyCoil(decor) {\r\n  const baseX = decor.baseX ?? decor.x ?? 0;\r\n  const baseY = decor.baseY ?? decor.y ?? GROUND_Y - 20;\r\n  const height = decor.height ?? 180;\r\n  context.save();\r\n  context.strokeStyle = \"#3d4e88\";\r\n  context.lineWidth = 6;\r\n  context.beginPath();\r\n  context.moveTo(baseX - 14, baseY);\r\n  context.lineTo(baseX - 14, baseY - height);\r\n  context.moveTo(baseX + 14, baseY);\r\n  context.lineTo(baseX + 14, baseY - height);\r\n  context.stroke();\r\n  context.strokeStyle = \"#7ce7ff\";\r\n  context.lineWidth = 3;\r\n  for (let y = 0; y <= height; y += 32) {\r\n    context.beginPath();\r\n    context.moveTo(baseX - 14, baseY - y);\r\n    context.quadraticCurveTo(baseX, baseY - y - 12, baseX + 14, baseY - y - 2);\r\n    context.stroke();\r\n  }\r\n  context.fillStyle = \"#9ef5ff\";\r\n  context.beginPath();\r\n  context.arc(baseX, baseY - height - 14, 18, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.restore();\r\n}\r\n\r\nfunction drawHovercar(decor) {\r\n  context.save();\r\n  context.fillStyle = \"#5d8fff\";\r\n  context.beginPath();\r\n  context.ellipse(decor.x, decor.y, 46, 16, 0, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.fillStyle = \"#1f2536\";\r\n  context.fillRect(decor.x - 26, decor.y - 8, 52, 16);\r\n  context.restore();\r\n}\r\n\r\nfunction drawDecor() {\r\n  const decorItems = getEnvironmentDecor();\r\n  for (const decor of decorItems) {\r\n    switch (decor.type) {\r\n      case \"building\":\r\n        drawBuilding(decor);\r\n        break;\r\n      case \"billboard\":\r\n        context.save();\r\n        context.fillStyle = \"#1f2330\";\r\n        context.fillRect(decor.x - decor.width / 2, decor.y - decor.height, decor.width, decor.height);\r\n        context.fillStyle = \"#ffc851\";\r\n        context.font = \"18px 'Segoe UI', Arial, sans-serif\";\r\n        context.textAlign = \"center\";\r\n        context.fillText(decor.text ?? \"Ad\", decor.x, decor.y - decor.height / 2);\r\n        context.strokeStyle = \"#ffa940\";\r\n        context.lineWidth = 3;\r\n        context.strokeRect(decor.x - decor.width / 2, decor.y - decor.height, decor.width, decor.height);\r\n        context.restore();\r\n        break;\r\n      case \"streetlight\":\r\n        context.save();\r\n        context.strokeStyle = \"#707789\";\r\n        context.lineWidth = 4;\r\n        context.beginPath();\r\n        context.moveTo(decor.x, decor.y + 140);\r\n        context.lineTo(decor.x, decor.y + 30);\r\n        context.stroke();\r\n        context.fillStyle = \"#ffd97a\";\r\n        context.beginPath();\r\n        context.arc(decor.x, decor.y + 12, 10, 0, Math.PI * 2);\r\n        context.fill();\r\n        context.restore();\r\n        break;\r\n      case \"hovercar\":\r\n        drawHovercar(decor);\r\n        break;\r\n      case \"palm\":\r\n        drawPalm(decor);\r\n        break;\r\n      case \"ruin\":\r\n        drawRuin(decor);\r\n        break;\r\n      case \"vineArch\":\r\n        drawVineArch(decor);\r\n        break;\r\n      case \"glowPlant\":\r\n        drawGlowPlant(decor);\r\n        break;\r\n      case \"waterfall\":\r\n        drawWaterfall(decor);\r\n        break;\r\n      case \"dune\":\r\n        drawDune(decor);\r\n        break;\r\n      case \"rockSpire\":\r\n        drawRockSpire(decor);\r\n        break;\r\n      case \"campfire\":\r\n        drawCampfire(decor);\r\n        break;\r\n      case \"antenna\":\r\n        drawAntenna(decor);\r\n        break;\r\n      case \"spire\":\r\n        drawSpire(decor);\r\n        break;\r\n      case \"holoBillboard\":\r\n        drawHoloBillboard(decor);\r\n        break;\r\n      case \"energyCoil\":\r\n        drawEnergyCoil(decor);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawDebugArena() {\r\n  drawWaterBodies();\r\n  const platforms = getEnvironmentPlatforms();\r\n  for (const platform of platforms) {\r\n    drawPlatform(platform);\r\n  }\r\n  drawDecor();\r\n}\r\n\r\nexport { resolvePlatformLanding, drawDebugArena };\r\n","import { GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { SPEED, GRAVITY, POSES } from \"../../config/constants.js\";\r\nimport { SQUAD_COMMANDS, SQUAD_SETTINGS } from \"../../config/squad.js\";\r\nimport { stickman, squadmates, enemies, getTotalHeight } from \"../../state/entities.js\";\r\nimport { resolvePlatformLanding } from \"../world/arena.js\";\r\nimport { spawnProjectile } from \"../combat/projectiles.js\";\r\nimport { getShoulderAnchor } from \"../aim/index.js\";\r\n\r\nfunction getActiveCommand() {\r\n  return SQUAD_COMMANDS[stickman.squadCommandIndex % SQUAD_COMMANDS.length] ?? SQUAD_COMMANDS[0];\r\n}\r\n\r\nfunction cycleSquadCommand() {\r\n  if (stickman.squadCommandCooldown > 0) {\r\n    return getActiveCommand();\r\n  }\r\n  stickman.squadCommandIndex = (stickman.squadCommandIndex + 1) % SQUAD_COMMANDS.length;\r\n  const command = getActiveCommand();\r\n  stickman.squadCommandId = command?.id ?? stickman.squadCommandId;\r\n  stickman.squadCommandCooldown = SQUAD_SETTINGS.commandCooldown;\r\n  return command;\r\n}\r\n\r\nfunction setSquadCommandById(commandId) {\r\n  const index = SQUAD_COMMANDS.findIndex((command) => command.id === commandId);\r\n  if (index >= 0) {\r\n    stickman.squadCommandIndex = index;\r\n    stickman.squadCommandId = commandId;\r\n    stickman.squadCommandCooldown = SQUAD_SETTINGS.commandCooldown;\r\n  }\r\n}\r\n\r\nfunction findNearestEnemy(x, y) {\r\n  let best = null;\r\n  let bestDist = Number.POSITIVE_INFINITY;\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n    const dx = enemy.x - x;\r\n    const dy = (enemy.y + enemy.height * 0.5) - y;\r\n    const dist = Math.hypot(dx, dy);\r\n    if (dist < bestDist) {\r\n      bestDist = dist;\r\n      best = enemy;\r\n    }\r\n  }\r\n  return best;\r\n}\r\n\r\nfunction updateMovement(entity, delta) {\r\n  entity.vy += GRAVITY * delta;\r\n  const previousY = entity.y;\r\n  entity.x += entity.vx * delta;\r\n  entity.y += entity.vy * delta;\r\n  entity.onGround = false;\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  const landed = resolvePlatformLanding(entity, previousY, standingHeight);\r\n  if (!landed) {\r\n    const feetY = entity.y + standingHeight;\r\n    if (feetY >= GROUND_Y) {\r\n      entity.y = GROUND_Y - standingHeight;\r\n      entity.vy = 0;\r\n      entity.onGround = true;\r\n    }\r\n  }\r\n  entity.vx = Math.max(-SPEED, Math.min(SPEED, entity.vx));\r\n}\r\n\r\nfunction steerTowards(entity, targetX, delta, speedFactor = 1) {\r\n  const desired = targetX - entity.x;\r\n  const threshold = 12;\r\n  entity.vx = 0;\r\n  if (Math.abs(desired) > threshold) {\r\n    const dir = Math.sign(desired);\r\n    entity.vx = dir * SPEED * speedFactor;\r\n    entity.facing = dir;\r\n  }\r\n}\r\n\r\nfunction fireAtTarget(entity, target, delta) {\r\n  entity.fireCooldown = Math.max(0, (entity.fireCooldown ?? 0) - delta);\r\n  if (entity.fireCooldown > 0) {\r\n    return;\r\n  }\r\n  entity.fireCooldown = SQUAD_SETTINGS.supportFireCooldown;\r\n\r\n  const aim = entity.aim ?? null;\r\n  const anchor = aim && Number.isFinite(aim.anchorX) && Number.isFinite(aim.anchorY)\r\n    ? { x: aim.anchorX, y: aim.anchorY }\r\n    : getShoulderAnchor(entity, POSES.standing);\r\n  const targetX = target.x;\r\n  const targetY = target.y + target.height * 0.35;\r\n  const rawDirX = aim && Number.isFinite(aim.vectorX) ? aim.vectorX : targetX - anchor.x;\r\n  const rawDirY = aim && Number.isFinite(aim.vectorY) ? aim.vectorY : targetY - anchor.y;\r\n  const norm = Math.hypot(rawDirX, rawDirY) || 1;\r\n  const dirX = rawDirX / norm;\r\n  const dirY = rawDirY / norm;\r\n  const perpX = -dirY;\r\n  const perpY = dirX;\r\n\r\n  const muzzleDistance = 32;\r\n  const lateralOffset = 4 * (entity.roleIndex ?? 0) - 4;\r\n  const muzzleX = anchor.x + dirX * muzzleDistance + perpX * lateralOffset;\r\n  const muzzleY = anchor.y + dirY * muzzleDistance + perpY * lateralOffset;\r\n\r\n  const speed = SQUAD_SETTINGS.projectileSpeed;\r\n  const verticalLift = -18;\r\n  const vx = dirX * speed;\r\n  const vy = dirY * speed + verticalLift;\r\n  const facing = vx >= 0 ? 1 : -1;\r\n\r\n  spawnProjectile({\r\n    x: muzzleX,\r\n    y: muzzleY,\r\n    vx,\r\n    vy,\r\n    radius: 5,\r\n    lifetime: 0.8,\r\n    color: facing > 0 ? \"#8cffd4\" : \"#a0ffe1\",\r\n    damage: SQUAD_SETTINGS.projectileDamage,\r\n    knockback: 110,\r\n    facing\r\n  });\r\n  entity.flashTimer = 0.12;\r\n}\r\n\r\nfunction updateSquadmate(squadmate, delta) {\r\n  const command = getActiveCommand();\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  const feetY = squadmate.y + standingHeight;\r\n  if (feetY >= GROUND_Y - 2 && Math.abs(squadmate.vy) < 1) {\r\n    squadmate.onGround = true;\r\n  }\r\n\r\n  squadmate.targetEnemyId = null;\r\n\r\n  switch (command?.id) {\r\n    case \"attack\": {\r\n      const target = findNearestEnemy(squadmate.x, squadmate.y);\r\n      if (target && Math.abs(target.x - stickman.x) <= SQUAD_SETTINGS.commandRange) {\r\n        steerTowards(squadmate, target.x - 24, delta, 0.95);\r\n        fireAtTarget(squadmate, target, delta);\r\n        squadmate.targetEnemyId = target.id;\r\n      } else {\r\n        steerTowards(squadmate, stickman.x - 60, delta, 0.8);\r\n      }\r\n      break;\r\n    }\r\n    case \"defend\": {\r\n      const offset = (squadmate.roleIndex ?? 0) * 40 - 40;\r\n      steerTowards(squadmate, stickman.x + offset, delta, 0.7);\r\n      const target = findNearestEnemy(squadmate.x, squadmate.y);\r\n      if (target && Math.abs(target.x - stickman.x) <= SQUAD_SETTINGS.defendRadius) {\r\n        fireAtTarget(squadmate, target, delta);\r\n        squadmate.targetEnemyId = target.id;\r\n      }\r\n      break;\r\n    }\r\n    case \"flank\": {\r\n      const flankSide = (squadmate.roleIndex ?? 0) % 2 === 0 ? -1 : 1;\r\n      const offset = flankSide * SQUAD_SETTINGS.flankOffset;\r\n      steerTowards(squadmate, stickman.x + offset, delta, 0.9);\r\n      const target = findNearestEnemy(squadmate.x, squadmate.y);\r\n      if (target) {\r\n        fireAtTarget(squadmate, target, delta);\r\n        squadmate.targetEnemyId = target.id;\r\n      }\r\n      break;\r\n    }\r\n    case \"hold\":\r\n    default: {\r\n      const offset = (squadmate.roleIndex ?? 0) * 36 - 36;\r\n      steerTowards(squadmate, stickman.x + offset, delta, 0.6);\r\n      break;\r\n    }\r\n  }\r\n\r\n  updateMovement(squadmate, delta);\r\n  squadmate.flashTimer = Math.max(0, (squadmate.flashTimer ?? 0) - delta);\r\n}\r\n\r\nfunction updateSquadmates(delta) {\r\n  stickman.squadCommandCooldown = Math.max(0, stickman.squadCommandCooldown - delta);\r\n  let roleIndex = 0;\r\n  for (const squadmate of squadmates) {\r\n    squadmate.roleIndex = roleIndex;\r\n    roleIndex += 1;\r\n    updateSquadmate(squadmate, delta);\r\n  }\r\n}\r\n\r\nfunction getSquadStatus() {\r\n  return {\r\n    command: getActiveCommand(),\r\n    cooldown: stickman.squadCommandCooldown,\r\n    members: squadmates\r\n  };\r\n}\r\n\r\nexport { updateSquadmates, cycleSquadCommand, setSquadCommandById, getSquadStatus };\r\n","import { canvas, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { vehicles, VEHICLE_DEFINITIONS, getVehicleById } from \"../../state/vehicles.js\";\r\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { stickman, getTotalHeight } from \"../../state/entities.js\";\r\nimport { input } from \"../input/index.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { spawnProjectile } from \"../combat/projectiles.js\";\r\nimport { POSES, GRAVITY } from \"../../config/constants.js\";\r\n\r\nconst PLAYER_DRIVER_ID = \"player-stickman\";\r\n\r\nfunction getPlayerVehicle() {\r\n  return stickman.vehicleId ? getVehicleById(stickman.vehicleId) : null;\r\n}\r\n\r\nfunction applyIdleDrag(vehicle, dragAmount, delta) {\r\n  if (dragAmount <= 0) {\r\n    return;\r\n  }\r\n  const drag = dragAmount * delta;\r\n  if (vehicle.vx > 0) {\r\n    vehicle.vx = Math.max(0, vehicle.vx - drag);\r\n  } else if (vehicle.vx < 0) {\r\n    vehicle.vx = Math.min(0, vehicle.vx + drag);\r\n  }\r\n}\r\n\r\nfunction applyGroundDriverInput(vehicle, definition, delta) {\r\n  const accelerateRight = input.right && !input.left;\r\n  const accelerateLeft = input.left && !input.right;\r\n  const direction = accelerateRight ? 1 : accelerateLeft ? -1 : 0;\r\n  const acceleration = definition.acceleration ?? 0;\r\n  const braking = definition.braking ?? 600;\r\n  const maxSpeed = definition.maxSpeed ?? 360;\r\n  const idleDrag = definition.idleDrag ?? 0;\r\n\r\n  if (direction !== 0 && acceleration > 0) {\r\n    vehicle.vx += direction * acceleration * delta;\r\n  }\r\n\r\n  if (input.down && vehicle.onGround && braking > 0) {\r\n    const brake = braking * delta;\r\n    if (vehicle.vx > 0) {\r\n      vehicle.vx = Math.max(0, vehicle.vx - brake);\r\n    } else if (vehicle.vx < 0) {\r\n      vehicle.vx = Math.min(0, vehicle.vx + brake);\r\n    }\r\n  } else if (direction === 0) {\r\n    applyIdleDrag(vehicle, idleDrag, delta);\r\n  }\r\n\r\n  if (maxSpeed > 0) {\r\n    vehicle.vx = clamp(vehicle.vx, -maxSpeed, maxSpeed);\r\n  }\r\n\r\n  if (direction !== 0) {\r\n    vehicle.facing = direction;\r\n  } else if (Math.abs(vehicle.vx) > 8) {\r\n    vehicle.facing = vehicle.vx > 0 ? 1 : -1;\r\n  }\r\n}\r\n\r\nfunction syncStickmanWithVehicle(vehicle, definition) {\r\n  const seat = definition.driverSeat ?? { x: 0, y: definition.height };\r\n  const baseHeight = getTotalHeight(POSES.standing);\r\n  const seatWorldX = vehicle.x + seat.x;\r\n  const seatWorldY = vehicle.y + seat.y;\r\n  const envWidth = getEnvironmentWidth();\r\n  const clampedX = clamp(seatWorldX, 40, envWidth - 40);\r\n  stickman.x = clampedX;\r\n  stickman.y = seatWorldY - baseHeight;\r\n  stickman.vx = vehicle.vx;\r\n  stickman.vy = vehicle.vy;\r\n  const movementType = definition.movementType ?? \"ground\";\r\n  if (movementType === \"air\") {\r\n    stickman.onGround = false;\r\n  } else if (movementType === \"water\") {\r\n    stickman.onGround = true;\r\n  } else {\r\n    stickman.onGround = vehicle.onGround;\r\n  }\r\n  stickman.facing = vehicle.facing ?? stickman.facing;\r\n}\r\n\r\nfunction enterVehicle(vehicle) {\r\n  const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n  if (!definition) {\r\n    return;\r\n  }\r\n\r\n  vehicle.driverId = PLAYER_DRIVER_ID;\r\n  vehicle.enterCooldown = 0.45;\r\n  stickman.vehicleId = vehicle.id;\r\n  stickman.controlMode = \"vehicle\";\r\n  stickman.vehicleCandidateId = null;\r\n  stickman.attacking = false;\r\n  stickman.currentAttack = null;\r\n  stickman.attackIndex = -1;\r\n  stickman.attackElapsed = 0;\r\n  stickman.comboWindowOpen = false;\r\n  stickman.comboWindowTimer = 0;\r\n  stickman.nextAttackQueued = false;\r\n  stickman.hitboxSpawned = false;\r\n  stickman.activeHitboxes.length = 0;\r\n  stickman.crouching = false;\r\n  stickman.rolling = false;\r\n  syncStickmanWithVehicle(vehicle, definition);\r\n}\r\n\r\nfunction exitVehicle(vehicle, options = {}) {\r\n  const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n  if (!definition) {\r\n    stickman.vehicleId = null;\r\n    stickman.controlMode = \"onFoot\";\r\n    return;\r\n  }\r\n\r\n  vehicle.driverId = null;\r\n  if (!options.skipCooldown) {\r\n    vehicle.enterCooldown = Math.max(vehicle.enterCooldown, options.cooldown ?? 0.35);\r\n  }\r\n\r\n  const baseHeight = getTotalHeight(POSES.standing);\r\n  const preferRight = options.preferDirection ?? (vehicle.facing >= 0 ? 1 : -1);\r\n  const exitOffsets = definition.exitOffsets ?? [];\r\n  const fallbackOffset = preferRight >= 0 ? { x: definition.width * 0.6, y: 0 } : { x: -definition.width * 0.6, y: 0 };\r\n  const chosenOffset = preferRight >= 0 ? exitOffsets[0] ?? fallbackOffset : exitOffsets[1] ?? fallbackOffset;\r\n\r\n  stickman.vehicleId = null;\r\n  stickman.controlMode = \"onFoot\";\r\n  stickman.vehicleCandidateId = null;\r\n  const envWidth = getEnvironmentWidth();\r\n  stickman.x = clamp(vehicle.x + chosenOffset.x, 40, envWidth - 40);\r\n  stickman.y = GROUND_Y - baseHeight;\r\n  if (options.inheritVelocity === false) {\r\n    stickman.vx = 0;\r\n    stickman.vy = 0;\r\n  } else {\r\n    stickman.vx = vehicle.vx * 0.5;\r\n    stickman.vy = Math.min(vehicle.vy, 0);\r\n  }\r\n  stickman.onGround = true;\r\n  stickman.facing = preferRight >= 0 ? 1 : -1;\r\n}\r\n\r\nfunction forcePlayerExitVehicle(options = {}) {\r\n  const vehicle = getPlayerVehicle();\r\n  if (!vehicle) {\r\n    stickman.vehicleId = null;\r\n    stickman.controlMode = \"onFoot\";\r\n    return;\r\n  }\r\n  exitVehicle(vehicle, { skipCooldown: true, inheritVelocity: false, ...options });\r\n}\r\n\r\nfunction handleVehicleInteraction(interactRequested) {\r\n  if (stickman.vehicleId) {\r\n    stickman.vehicleCandidateId = null;\r\n    const vehicle = getPlayerVehicle();\r\n    if (interactRequested && vehicle && vehicle.enterCooldown <= 0.01) {\r\n      exitVehicle(vehicle, { preferDirection: vehicle.facing });\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (stickman.health <= 0) {\r\n    stickman.vehicleCandidateId = null;\r\n    return;\r\n  }\r\n\r\n  let bestVehicle = null;\r\n  let bestScore = Number.POSITIVE_INFINITY;\r\n  const playerHeight = getTotalHeight(POSES.standing);\r\n  const playerFeetY = stickman.y + playerHeight;\r\n\r\n  for (const vehicle of vehicles) {\r\n    const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n    if (!definition) {\r\n      continue;\r\n    }\r\n    if (vehicle.driverId) {\r\n      continue;\r\n    }\r\n    if (vehicle.enterCooldown > 0) {\r\n      continue;\r\n    }\r\n\r\n    const horizontal = Math.abs(stickman.x - vehicle.x);\r\n    const maxHorizontal = definition.enterRadius ?? 64;\r\n    if (horizontal > maxHorizontal) {\r\n      continue;\r\n    }\r\n\r\n    const vehicleFeet = vehicle.y + definition.height;\r\n    const vertical = Math.abs(playerFeetY - vehicleFeet);\r\n    const movementType = definition.movementType ?? \"ground\";\r\n    let verticalAllowance;\r\n    if (movementType === \"air\") {\r\n      verticalAllowance = Math.max(120, (definition.hoverMinAltitude ?? 0) + 80);\r\n    } else if (movementType === \"water\") {\r\n      verticalAllowance = Math.max(90, (definition.waterSurfaceOffset ?? 24) + 70);\r\n    } else {\r\n      verticalAllowance = 80;\r\n    }\r\n    if (vertical > verticalAllowance) {\r\n      continue;\r\n    }\r\n\r\n    const score = horizontal + vertical * 0.5;\r\n    if (score < bestScore) {\r\n      bestScore = score;\r\n      bestVehicle = vehicle;\r\n    }\r\n  }\r\n\r\n  stickman.vehicleCandidateId = bestVehicle?.id ?? null;\r\n\r\n  if (interactRequested && bestVehicle) {\r\n    enterVehicle(bestVehicle);\r\n  }\r\n}\r\n\r\nfunction updateGroundVehicle(vehicle, definition, delta, isControlled) {\r\n  if (isControlled) {\r\n    applyGroundDriverInput(vehicle, definition, delta);\r\n  } else {\r\n    applyIdleDrag(vehicle, definition.idleDrag ?? 0, delta);\r\n  }\r\n\r\n  const airDrag = definition.airDrag ?? 1;\r\n  if (!vehicle.onGround && airDrag > 0 && airDrag < 1) {\r\n    vehicle.vx *= Math.pow(airDrag, Math.max(0, delta * 60));\r\n  }\r\n\r\n  vehicle.vy += GRAVITY * delta;\r\n  vehicle.x += vehicle.vx * delta;\r\n  vehicle.y += vehicle.vy * delta;\r\n\r\n  const groundTop = GROUND_Y - definition.height;\r\n  if (vehicle.y >= groundTop) {\r\n    vehicle.y = groundTop;\r\n    vehicle.vy = 0;\r\n    vehicle.onGround = true;\r\n  } else {\r\n    vehicle.onGround = false;\r\n  }\r\n\r\n  const halfWidth = definition.width * 0.5;\r\n  const minX = halfWidth + 32;\r\n  const envWidth = getEnvironmentWidth();\r\n  const maxX = envWidth - halfWidth - 32;\r\n  vehicle.x = clamp(vehicle.x, minX, maxX);\r\n  if (vehicle.x === minX || vehicle.x === maxX) {\r\n    vehicle.vx = 0;\r\n  }\r\n\r\n  const targetTilt = clamp(vehicle.vx / Math.max(1, definition.maxSpeed ?? 360) * 0.12, -0.25, 0.25);\r\n  vehicle.tilt += (targetTilt - vehicle.tilt) * Math.min(1, delta * 10);\r\n}\r\n\r\nfunction updateWaterVehicle(vehicle, definition, delta, isControlled) {\r\n  const acceleration = definition.waterAcceleration ?? definition.acceleration ?? 220;\r\n  const maxSpeed = definition.waterMaxSpeed ?? definition.maxSpeed ?? 220;\r\n  const reverseSpeed = definition.waterReverseSpeed ?? Math.max(80, maxSpeed * 0.6);\r\n  const idleDrag = definition.waterIdleDrag ?? definition.idleDrag ?? 200;\r\n  const brakeStrength = (definition.turnDrag ?? 220);\r\n  const bobAmplitude = definition.bobAmplitude ?? 4;\r\n  const bobSpeed = definition.bobSpeed ?? 1.4;\r\n  const splashIntensity = definition.splashIntensity ?? 0.3;\r\n  const waterSurface = vehicle.waterLineY ?? (GROUND_Y - (definition.waterSurfaceOffset ?? 24));\r\n  const buoyancyPoint = definition.buoyancyPoint ?? 0.55;\r\n  const submergedOffset = definition.submergedOffset ?? 0;\r\n\r\n  const steerRight = isControlled && input.right && !input.left;\r\n  const steerLeft = isControlled && input.left && !input.right;\r\n  const direction = steerRight ? 1 : steerLeft ? -1 : 0;\r\n\r\n  if (direction !== 0 && acceleration > 0) {\r\n    vehicle.vx += direction * acceleration * delta;\r\n  } else {\r\n    applyIdleDrag(vehicle, idleDrag, delta);\r\n  }\r\n\r\n  if (isControlled && input.down) {\r\n    const brake = brakeStrength * delta;\r\n    if (vehicle.vx > 0) {\r\n      vehicle.vx = Math.max(vehicle.vx - brake, -reverseSpeed);\r\n    } else if (vehicle.vx < 0) {\r\n      vehicle.vx = Math.min(vehicle.vx + brake, reverseSpeed);\r\n    } else if (brake > 0) {\r\n      vehicle.vx = clamp(vehicle.vx - vehicle.facing * brake * 0.15, -reverseSpeed, reverseSpeed);\r\n    }\r\n  }\r\n\r\n  vehicle.vx = clamp(vehicle.vx, -reverseSpeed, maxSpeed);\r\n\r\n  if (direction !== 0) {\r\n    vehicle.facing = direction;\r\n  } else if (Math.abs(vehicle.vx) > 4) {\r\n    vehicle.facing = vehicle.vx > 0 ? 1 : -1;\r\n  }\r\n\r\n  vehicle.x += vehicle.vx * delta;\r\n  const halfWidth = definition.width * 0.5;\r\n  const minX = halfWidth + 32;\r\n  const envWidth = getEnvironmentWidth();\r\n  const maxX = envWidth - halfWidth - 32;\r\n  vehicle.x = clamp(vehicle.x, minX, maxX);\r\n  if (vehicle.x === minX || vehicle.x === maxX) {\r\n    vehicle.vx = 0;\r\n  }\r\n\r\n  vehicle.vy = 0;\r\n\r\n  vehicle.bobPhase = (vehicle.bobPhase ?? 0) + delta * (bobSpeed * (isControlled ? 1.2 : 0.85));\r\n  const bobOffset = Math.sin(vehicle.bobPhase) * bobAmplitude;\r\n  const sprayOffset = Math.sin(vehicle.bobPhase * 0.5 + vehicle.x * 0.02) * splashIntensity * 6;\r\n  const targetY = waterSurface - definition.height * buoyancyPoint + submergedOffset + bobOffset + sprayOffset;\r\n  vehicle.y += (targetY - vehicle.y) * Math.min(1, delta * 6.5);\r\n\r\n  vehicle.onGround = false;\r\n\r\n  const tiltTarget = clamp(vehicle.vx / Math.max(1, maxSpeed) * 0.22 + Math.sin(vehicle.bobPhase + vehicle.facing * 0.4) * 0.05, -0.45, 0.45);\r\n  vehicle.tilt += (tiltTarget - vehicle.tilt) * Math.min(1, delta * 5);\r\n}\r\n\r\nfunction updateAirVehicle(vehicle, definition, delta, isControlled) {\r\n  const horizontalAcceleration = definition.horizontalAcceleration ?? definition.acceleration ?? 0;\r\n  const horizontalMaxSpeed = definition.horizontalMaxSpeed ?? definition.maxSpeed ?? 320;\r\n  const horizontalDrag = definition.horizontalDrag ?? definition.idleDrag ?? 200;\r\n  const airDrag = definition.airDrag ?? 0.97;\r\n  const minAltitude = definition.hoverMinAltitude ?? 0;\r\n  const maxAltitude = Math.max(minAltitude, definition.hoverMaxAltitude ?? minAltitude);\r\n  const altitudeRate = definition.altitudeRate ?? 160;\r\n  const autopilotStrength = definition.autopilotStrength ?? 4;\r\n  const verticalDamping = definition.verticalDamping ?? 0.9;\r\n  const maxVerticalSpeed = definition.maxVerticalSpeed ?? 220;\r\n  const liftPower = definition.liftPower ?? 0;\r\n  const descendPower = definition.descendPower ?? liftPower;\r\n\r\n  const accelerateRight = isControlled && input.right && !input.left;\r\n  const accelerateLeft = isControlled && input.left && !input.right;\r\n  const direction = accelerateRight ? 1 : accelerateLeft ? -1 : 0;\r\n\r\n  if (direction !== 0 && horizontalAcceleration > 0) {\r\n    vehicle.vx += direction * horizontalAcceleration * delta;\r\n  } else {\r\n    applyIdleDrag(vehicle, horizontalDrag, delta);\r\n  }\r\n\r\n  if (horizontalMaxSpeed > 0) {\r\n    vehicle.vx = clamp(vehicle.vx, -horizontalMaxSpeed, horizontalMaxSpeed);\r\n  }\r\n\r\n  if (direction !== 0) {\r\n    vehicle.facing = direction;\r\n  } else if (Math.abs(vehicle.vx) > 6) {\r\n    vehicle.facing = vehicle.vx > 0 ? 1 : -1;\r\n  }\r\n\r\n  vehicle.vx *= Math.pow(airDrag, delta * 60);\r\n\r\n  const gravity = GRAVITY * (definition.gravityScale ?? 0.25);\r\n  vehicle.vy += gravity * delta;\r\n\r\n  if (!Number.isFinite(vehicle.preferredAltitude)) {\r\n    vehicle.preferredAltitude = definition.spawnHover ?? minAltitude;\r\n  }\r\n\r\n  if (isControlled) {\r\n    if (input.jump) {\r\n      vehicle.preferredAltitude += altitudeRate * delta;\r\n    }\r\n    if (input.down) {\r\n      vehicle.preferredAltitude -= altitudeRate * delta;\r\n    }\r\n  } else {\r\n    const altitude = GROUND_Y - (vehicle.y + definition.height);\r\n    vehicle.preferredAltitude += (altitude - vehicle.preferredAltitude) * Math.min(1, delta * 0.5);\r\n  }\r\n\r\n  vehicle.preferredAltitude = clamp(vehicle.preferredAltitude, minAltitude, maxAltitude);\r\n\r\n  const altitude = clamp(GROUND_Y - (vehicle.y + definition.height), minAltitude, maxAltitude);\r\n  const altitudeError = vehicle.preferredAltitude - altitude;\r\n  vehicle.vy -= altitudeError * autopilotStrength * delta;\r\n\r\n  if (isControlled && liftPower > 0) {\r\n    if (input.jump) {\r\n      vehicle.vy -= liftPower * 0.25 * delta;\r\n    }\r\n    if (input.down) {\r\n      vehicle.vy += descendPower * 0.25 * delta;\r\n    }\r\n  }\r\n\r\n  vehicle.vy *= Math.pow(verticalDamping, delta * 60);\r\n  if (maxVerticalSpeed > 0) {\r\n    vehicle.vy = clamp(vehicle.vy, -maxVerticalSpeed, maxVerticalSpeed);\r\n  }\r\n\r\n  vehicle.x += vehicle.vx * delta;\r\n  vehicle.y += vehicle.vy * delta;\r\n\r\n  const halfWidth = definition.width * 0.5;\r\n  const minX = halfWidth + 32;\r\n  const envWidth = getEnvironmentWidth();\r\n  const maxX = envWidth - halfWidth - 32;\r\n  vehicle.x = clamp(vehicle.x, minX, maxX);\r\n  if (vehicle.x === minX || vehicle.x === maxX) {\r\n    vehicle.vx = 0;\r\n  }\r\n\r\n  const newAltitude = clamp(GROUND_Y - (vehicle.y + definition.height), minAltitude, maxAltitude);\r\n  vehicle.y = GROUND_Y - definition.height - newAltitude;\r\n  if ((newAltitude === minAltitude && vehicle.vy > 0) || (newAltitude === maxAltitude && vehicle.vy < 0)) {\r\n    vehicle.vy = 0;\r\n  }\r\n\r\n  vehicle.onGround = false;\r\n\r\n  const targetTilt = clamp(vehicle.vx / Math.max(1, horizontalMaxSpeed) * 0.35 - altitudeError * 0.02, -0.6, 0.6);\r\n  vehicle.tilt += (targetTilt - vehicle.tilt) * Math.min(1, delta * 6);\r\n}\r\n\r\nfunction fireMountedWeaponProjectile(vehicle, mountDef, mountState) {\r\n  const aim = mountState.aim ?? null;\r\n  const baseAngle = aim && Number.isFinite(aim.angle) ? aim.angle : Math.atan2(aim?.vectorY ?? 0, aim?.vectorX ?? (mountDef.facing ?? 1));\r\n  const cos = Math.cos(baseAngle);\r\n  const sin = Math.sin(baseAngle);\r\n  const offset = mountDef.offset ?? { x: 0, y: 0 };\r\n  const anchorX = Number.isFinite(aim?.anchorX) ? aim.anchorX : vehicle.x + offset.x;\r\n  const anchorY = Number.isFinite(aim?.anchorY) ? aim.anchorY : vehicle.y + offset.y;\r\n  const muzzles = mountDef.muzzles && mountDef.muzzles.length > 0 ? mountDef.muzzles : [{ x: mountDef.muzzle?.x ?? 0, y: mountDef.muzzle?.y ?? 0 }];\r\n  const muzzleIndex = mountState.muzzleIndex ?? 0;\r\n  const muzzle = muzzles[muzzleIndex % muzzles.length];\r\n  mountState.muzzleIndex = (muzzleIndex + 1) % muzzles.length;\r\n  const localX = muzzle?.x ?? 0;\r\n  const localY = muzzle?.y ?? 0;\r\n  const muzzleX = anchorX + localX * cos - localY * sin;\r\n  const muzzleY = anchorY + localX * sin + localY * cos;\r\n\r\n  const projectileDef = mountDef.projectile ?? {};\r\n  const speed = projectileDef.speed ?? 600;\r\n  const scatterRadians = (mountDef.scatter ?? 0) * (Math.PI / 180);\r\n  const randomOffset = scatterRadians > 0 ? (Math.random() - 0.5) * scatterRadians : 0;\r\n  const finalAngle = baseAngle + randomOffset;\r\n  const vx = Math.cos(finalAngle) * speed;\r\n  const vy = Math.sin(finalAngle) * speed + (projectileDef.verticalSpeed ?? 0);\r\n  const facing = vx >= 0 ? 1 : -1;\r\n\r\n  spawnProjectile({\r\n    x: muzzleX,\r\n    y: muzzleY,\r\n    vx,\r\n    vy,\r\n    radius: projectileDef.radius ?? 5,\r\n    lifetime: projectileDef.lifetime ?? 1.3,\r\n    color: projectileDef.color ?? \"#ffd27a\",\r\n    damage: projectileDef.damage ?? 12,\r\n    knockback: projectileDef.knockback ?? 80,\r\n    facing,\r\n    gravityFactor: projectileDef.gravityFactor ?? 0.12\r\n  });\r\n\r\n  mountState.flashTimer = mountDef.flashDuration ?? 0.1;\r\n  mountState.lastMuzzleX = muzzleX;\r\n  mountState.lastMuzzleY = muzzleY;\r\n}\r\n\r\nfunction updateMountedWeaponsForVehicle(vehicle, definition, delta, isControlled) {\r\n  const mountDefs = definition.mountedWeapons ?? [];\r\n  const mounts = vehicle.mounts ?? [];\r\n  if (mountDefs.length === 0 || mounts.length === 0) {\r\n    return;\r\n  }\r\n\r\n  const wantsPrimary = isControlled && input.attackDown;\r\n  const wantsSecondary = isControlled && input.throwDown;\r\n\r\n  for (let index = 0; index < mountDefs.length; index += 1) {\r\n    const mountDef = mountDefs[index];\r\n    const mountState = mounts[index];\r\n    if (!mountDef || !mountState) {\r\n      continue;\r\n    }\r\n\r\n    mountState.cooldown = Math.max(0, (mountState.cooldown ?? 0) - delta);\r\n    mountState.flashTimer = Math.max(0, (mountState.flashTimer ?? 0) - delta);\r\n\r\n    let shouldFire = false;\r\n    const binding = mountDef.binding ?? \"primary\";\r\n    if (isControlled) {\r\n      if (binding === \"primary\") {\r\n        shouldFire = wantsPrimary;\r\n      } else if (binding === \"secondary\") {\r\n        shouldFire = wantsSecondary;\r\n      }\r\n    } else if (mountDef.autoFire) {\r\n      shouldFire = true;\r\n    }\r\n\r\n    if (!shouldFire || mountState.cooldown > 0) {\r\n      continue;\r\n    }\r\n\r\n    fireMountedWeaponProjectile(vehicle, mountDef, mountState);\r\n    mountState.cooldown = mountDef.fireInterval ?? 0.2;\r\n  }\r\n}\r\n\r\nfunction updateVehicles(delta) {\r\n  for (const vehicle of vehicles) {\r\n    const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n    if (!definition) {\r\n      continue;\r\n    }\r\n\r\n    vehicle.enterCooldown = Math.max(0, vehicle.enterCooldown - delta);\r\n    vehicle.damageFlash = Math.max(0, vehicle.damageFlash - delta);\r\n\r\n    const isControlled = vehicle.driverId === PLAYER_DRIVER_ID;\r\n    const movementType = definition.movementType ?? \"ground\";\r\n\r\n    if (movementType === \"air\") {\r\n      updateAirVehicle(vehicle, definition, delta, isControlled);\r\n    } else if (movementType === \"water\") {\r\n      updateWaterVehicle(vehicle, definition, delta, isControlled);\r\n    } else {\r\n      updateGroundVehicle(vehicle, definition, delta, isControlled);\r\n    }\r\n\r\n    updateMountedWeaponsForVehicle(vehicle, definition, delta, isControlled);\r\n\r\n    if (isControlled) {\r\n      syncStickmanWithVehicle(vehicle, definition);\r\n    } else if (movementType === \"ground\") {\r\n      vehicle.tilt += (0 - vehicle.tilt) * Math.min(1, delta * 10);\r\n    }\r\n  }\r\n}\r\n\r\nexport { updateVehicles, handleVehicleInteraction, getPlayerVehicle, forcePlayerExitVehicle };\r\n\r\n\r\n","import { context, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { POSES, SPEED } from \"../../config/constants.js\";\r\nimport { getEnvironmentDefinition } from \"../../state/environment.js\";\r\nimport { stickman, trainingDummy, enemies, squadmates, getRemotePlayers } from \"../../state/entities.js\";\r\nimport { getServerBrowserState } from \"../../state/serverBrowser.js\";\r\nimport { vehicles, VEHICLE_DEFINITIONS, getVehicleById } from \"../../state/vehicles.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { getElapsedTime } from \"../utils/time.js\";\r\nimport { getCurrentWeapon, getWeaponSlots } from \"../combat/weapons.js\";\r\nimport { getAmmoStatus } from \"../../state/ammo.js\";\r\nimport { getCosmeticSelections, getCosmeticOption } from \"../../state/cosmetics.js\";\r\nimport { drawProjectiles } from \"../combat/projectiles.js\";\r\nimport { drawThrowables } from \"../combat/throwables.js\";\r\nimport { drawGadgets, getGadgetStatus } from \"../gadgets/index.js\";\r\nimport { drawSupplyDrops } from \"./supplyDrops.js\";\r\nimport { renderStickFigure, getWeaponVisual } from \"./stickFigure.js\";\r\nimport { drawDestructibles } from \"./destructibles.js\";\r\nimport { drawBuildings, drawBuildPreview } from \"./buildings.js\";\r\nimport { drawSalvagePickups } from \"./resources.js\";\r\nimport { getSurvivalHudStatus } from \"../survival/index.js\";\r\nimport { getCoopHudStatus } from \"../../state/coop.js\";\r\nimport { getSandboxHudStatus } from \"../sandbox/index.js\";\r\nimport { getCampaignHudStatus } from \"../campaign/index.js\";\r\nimport { drawInteractables } from \"./interactables.js\";\r\nimport { getBuildingHudStatus } from \"../building/index.js\";\r\nimport { drawParticles } from \"../effects/particles.js\";\r\nimport { getPolishDebugState } from \"../events/polishDebug.js\";\r\nimport { getRecoilOffset } from \"../../state/recoil.js\";\r\nimport { getSupplyDropStatus } from \"../world/supplyDrops.js\";\r\nimport { getP2PStatus } from \"../network/p2p.js\";\r\nimport { getSquadStatus } from \"../squad/index.js\";\r\nimport { setActiveCamera, isWithinView, resetPerformanceStats, recordVisibility, performanceStats } from \"./culling.js\";\r\nimport { getPlayerVehicle } from \"../vehicles/index.js\";\r\nimport { getStickmanShoulderAnchor } from \"../aim/index.js\";\r\n\r\nconst SQUAD_WEAPON_TEMPLATE = { id: \"squadCarbine\", name: \"Support Carbine\", category: \"ranged-mid\" };\r\n\r\n\r\nconst UI_TITLE_FONT = \"16px 'Segoe UI Semibold', 'Segoe UI', Arial, sans-serif\";\r\nconst UI_TEXT_FONT = \"14px 'Segoe UI', Arial, sans-serif\";\r\nconst UI_SMALL_FONT = \"12px 'Segoe UI', Arial, sans-serif\";\r\n\r\nfunction drawRoundedRectPath(ctx, x, y, width, height, radius = 8) {\r\n  const r = Math.min(radius, width * 0.5, height * 0.5);\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + r, y);\r\n  ctx.lineTo(x + width - r, y);\r\n  ctx.arcTo(x + width, y, x + width, y + r, r);\r\n  ctx.lineTo(x + width, y + height - r);\r\n  ctx.arcTo(x + width, y + height, x + width - r, y + height, r);\r\n  ctx.lineTo(x + r, y + height);\r\n  ctx.arcTo(x, y + height, x, y + height - r, r);\r\n  ctx.lineTo(x, y + r);\r\n  ctx.arcTo(x, y, x + r, y, r);\r\n  ctx.closePath();\r\n}\r\n\r\nfunction drawUiPanel(x, y, width, height, options = {}) {\r\n  const ctx = context;\r\n  ctx.save();\r\n  const radius = options.radius ?? 12;\r\n  drawRoundedRectPath(ctx, x, y, width, height, radius);\r\n  ctx.fillStyle = options.fill ?? \"rgba(12, 18, 28, 0.78)\";\r\n  ctx.fill();\r\n  if (options.stroke !== false) {\r\n    ctx.strokeStyle = options.stroke ?? \"rgba(140, 170, 210, 0.22)\";\r\n    ctx.lineWidth = options.strokeWidth ?? 1.4;\r\n    ctx.stroke();\r\n  }\r\n  if (options.accent) {\r\n    ctx.fillStyle = options.accent;\r\n    ctx.fillRect(x, y, width, options.accentHeight ?? 3);\r\n  }\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawUiProgressBar(x, y, width, height, progress, options = {}) {\r\n  const ctx = context;\r\n  const radius = options.radius ?? height * 0.5;\r\n  const clampedProgress = clamp(progress ?? 0, 0, 1);\r\n  ctx.save();\r\n  drawRoundedRectPath(ctx, x, y, width, height, radius);\r\n  ctx.fillStyle = options.background ?? \"rgba(255, 255, 255, 0.08)\";\r\n  ctx.fill();\r\n  ctx.clip();\r\n  ctx.fillStyle = options.fill ?? \"#8cffd4\";\r\n  ctx.fillRect(x, y, width * clampedProgress, height);\r\n  ctx.restore();\r\n  if (options.border !== false) {\r\n    ctx.save();\r\n    drawRoundedRectPath(ctx, x, y, width, height, radius);\r\n    ctx.strokeStyle = options.border ?? \"rgba(140, 170, 210, 0.35)\";\r\n    ctx.lineWidth = options.borderWidth ?? 1;\r\n    ctx.stroke();\r\n    ctx.restore();\r\n  }\r\n}\r\n\r\nfunction drawUiTag(text, x, y, options = {}) {\r\n  const ctx = context;\r\n  ctx.save();\r\n  ctx.font = UI_SMALL_FONT;\r\n  ctx.textAlign = \"left\";\r\n  ctx.textBaseline = \"middle\";\r\n  const paddingX = options.paddingX ?? 10;\r\n  const height = options.height ?? 20;\r\n  const width = Math.ceil(ctx.measureText(text).width) + paddingX * 2;\r\n  drawRoundedRectPath(ctx, x, y, width, height, height * 0.5);\r\n  ctx.fillStyle = options.background ?? \"rgba(140, 170, 220, 0.32)\";\r\n  ctx.fill();\r\n  if (options.border) {\r\n    ctx.strokeStyle = options.border;\r\n    ctx.stroke();\r\n  }\r\n  ctx.fillStyle = options.color ?? \"#e0e8ff\";\r\n  ctx.fillText(text, x + paddingX, y + height * 0.5 + (options.offsetY ?? 0));\r\n  ctx.restore();\r\n  return width;\r\n}\r\n\r\nfunction getCategoryAccent(category) {\r\n  if (!category) {\r\n    return \"rgba(146, 166, 210, 0.35)\";\r\n  }\r\n  if (category.startsWith(\"melee\")) {\r\n    return \"rgba(255, 139, 139, 0.45)\";\r\n  }\r\n  if (category.startsWith(\"ranged\")) {\r\n    return \"rgba(124, 214, 255, 0.45)\";\r\n  }\r\n  if (category === \"throwable\") {\r\n    return \"rgba(255, 205, 135, 0.45)\";\r\n  }\r\n  if (category === \"gadget\") {\r\n    return \"rgba(140, 255, 212, 0.45)\";\r\n  }\r\n  return \"rgba(146, 166, 210, 0.35)\";\r\n}\r\n\r\nfunction drawWeaponHotbar(slots, currentWeapon, ammoStatus, canvasWidth, canvasHeight) {\r\n  if (!slots || slots.length === 0) {\r\n    return;\r\n  }\r\n  const spacing = 12;\r\n  const maxSlots = slots.length;\r\n  const availableWidth = Math.min(canvasWidth * 0.9, 560);\r\n  const slotWidth = Math.min(118, Math.max(72, (availableWidth - spacing * (maxSlots - 1)) / maxSlots));\r\n  const slotHeight = slotWidth * 0.6;\r\n  const totalWidth = slotWidth * maxSlots + spacing * (maxSlots - 1);\r\n  const startX = (canvasWidth - totalWidth) / 2;\r\n  const y = canvasHeight - slotHeight - 16;\r\n\r\n  slots.forEach((slot, index) => {\r\n    const x = startX + index * (slotWidth + spacing);\r\n    const isActive = slot.id === currentWeapon?.id;\r\n    drawUiPanel(x, y, slotWidth, slotHeight, {\r\n      accent: isActive ? getCategoryAccent(slot.category ?? \"\") : \"rgba(255, 255, 255, 0.06)\",\r\n      fill: isActive ? \"rgba(18, 28, 40, 0.94)\" : \"rgba(12, 18, 28, 0.78)\",\r\n      radius: 10,\r\n      stroke: \"rgba(140, 170, 210, 0.18)\"\r\n    });\r\n    context.save();\r\n    context.textAlign = \"left\";\r\n    context.font = UI_SMALL_FONT;\r\n    context.fillStyle = isActive ? \"#f5f8ff\" : \"#aeb7cc\";\r\n    context.fillText(`${index + 1}`, x + 12, y + 18);\r\n    context.font = UI_TEXT_FONT;\r\n    context.fillStyle = isActive ? \"#f5f8ff\" : \"#d7dff1\";\r\n    const label = slot.name.length > 16 ? `${slot.name.slice(0, 15)}...` : slot.name;\r\n    context.fillText(label, x + 12, y + 38);\r\n    if (isActive && ammoStatus) {\r\n      const isInfinite = ammoStatus.capacity === Number.POSITIVE_INFINITY;\r\n      const magazineDisplay = isInfinite ? \"INF\" : `${Math.max(0, ammoStatus.magazine)}`;\r\n      const reserveDisplay = isInfinite ? \"INF\" : `${Math.max(0, ammoStatus.reserve)}`;\r\n      context.font = UI_SMALL_FONT;\r\n      context.fillStyle = \"#9aa6bf\";\r\n      context.fillText(`${magazineDisplay}/${reserveDisplay}`, x + 12, y + slotHeight - 12);\r\n    }\r\n    context.restore();\r\n  });\r\n}\r\n\r\nfunction drawUiCardStack(cards, x, startY, width) {\r\n  let y = startY;\r\n  for (const card of cards) {\r\n    const lines = card.lines ?? [];\r\n    const lineCount = lines.length;\r\n    const footer = card.footer ? 1 : 0;\r\n    const baseHeight = 40 + lineCount * 18 + footer * 20;\r\n    const height = Math.max(card.minHeight ?? 64, baseHeight);\r\n    drawUiPanel(x, y, width, height, { accent: card.accent ?? \"rgba(146, 166, 210, 0.35)\", fill: card.fill });\r\n    context.save();\r\n    context.textAlign = \"left\";\r\n    context.font = UI_TITLE_FONT;\r\n    context.fillStyle = card.titleColor ?? \"#f4f7ff\";\r\n    context.fillText(card.title, x + 16, y + 28);\r\n    context.font = UI_TEXT_FONT;\r\n    let lineY = y + 52;\r\n    for (const line of lines) {\r\n      const text = typeof line === \"string\" ? line : line.text;\r\n      const color = typeof line === \"string\" ? \"#d7dff1\" : (line.color ?? \"#d7dff1\");\r\n      context.fillStyle = color;\r\n      context.fillText(text, x + 16, lineY);\r\n      lineY += 18;\r\n    }\r\n    if (card.footer) {\r\n      context.font = UI_SMALL_FONT;\r\n      context.fillStyle = card.footerColor ?? \"#9aa6bf\";\r\n      context.fillText(card.footer, x + 16, y + height - 12);\r\n    }\r\n    context.restore();\r\n    y += height + 16;\r\n  }\r\n  return y;\r\n}\r\n\r\nfunction formatSeconds(seconds) {\r\n  const value = Math.max(0, seconds ?? 0);\r\n  return value >= 10 ? `${Math.round(value)}s` : `${value.toFixed(1)}s`;\r\n}\r\nfunction drawBackground(camera) {\r\n  resetPerformanceStats();\r\n  setActiveCamera(camera);\r\n  const environment = getEnvironmentDefinition();\r\n  const background = environment?.background ?? {};\r\n  const offsetX = camera?.offsetX ?? 0;\r\n  const gradientStops = Array.isArray(background.gradientStops) && background.gradientStops.length > 0\r\n    ? background.gradientStops\r\n    : [\r\n        { offset: 0, color: \"#111a2c\" },\r\n        { offset: 0.4, color: \"#182439\" },\r\n        { offset: 0.75, color: \"#1f2d44\" },\r\n        { offset: 1, color: \"#232f49\" }\r\n      ];\r\n  const skyGradient = context.createLinearGradient(0, 0, 0, context.canvas.height);\r\n  for (const stop of gradientStops) {\r\n    const offset = typeof stop.offset === \"number\" ? Math.min(Math.max(stop.offset, 0), 1) : 0;\r\n    const color = stop.color ?? \"#111a2c\";\r\n    skyGradient.addColorStop(offset, color);\r\n  }\r\n  context.fillStyle = skyGradient;\r\n  context.fillRect(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n  const silhouettes = Array.isArray(background.silhouettes) ? background.silhouettes : [];\r\n  for (const silhouette of silhouettes) {\r\n    const points = Array.isArray(silhouette.points) ? silhouette.points : [];\r\n    if (points.length < 3) {\r\n      continue;\r\n    }\r\n    context.fillStyle = silhouette.color ?? \"rgba(0, 0, 0, 0.45)\";\r\n    context.beginPath();\r\n    context.moveTo(points[0].x - offsetX, points[0].y);\r\n    for (let i = 1; i < points.length; i += 1) {\r\n      context.lineTo(points[i].x - offsetX, points[i].y);\r\n    }\r\n    context.closePath();\r\n    context.fill();\r\n  }\r\n\r\n  const horizon = background.horizonBand;\r\n  if (horizon) {\r\n    const height = horizon.height ?? 120;\r\n    const start = horizon.start ?? GROUND_Y - height - 30;\r\n    const band = context.createLinearGradient(0, start, 0, start + height);\r\n    band.addColorStop(0, horizon.topColor ?? \"rgba(46, 86, 126, 0.25)\");\r\n    band.addColorStop(1, horizon.bottomColor ?? \"rgba(28, 52, 84, 0)\");\r\n    context.fillStyle = band;\r\n    context.fillRect(0, start, context.canvas.width, height);\r\n  }\r\n\r\n  if (environment?.theme === \"desert\") {\r\n    const sunX = background.sun?.x ?? context.canvas.width * 0.72;\r\n    const sunY = background.sun?.y ?? context.canvas.height * 0.18;\r\n    const sunRadius = background.sun?.radius ?? 70;\r\n    const sunGradient = context.createRadialGradient(sunX, sunY, 0, sunX, sunY, sunRadius);\r\n    sunGradient.addColorStop(0, \"rgba(255, 214, 128, 0.9)\");\r\n    sunGradient.addColorStop(1, \"rgba(255, 214, 128, 0)\");\r\n    context.fillStyle = sunGradient;\r\n    context.beginPath();\r\n    context.arc(sunX, sunY, sunRadius, 0, Math.PI * 2);\r\n    context.fill();\r\n  } else if (environment?.theme === \"sci-fi\") {\r\n    const step = 110;\r\n    context.fillStyle = \"#a8c2ff\";\r\n    context.globalAlpha = 0.35;\r\n    for (let x = 0; x < context.canvas.width; x += step) {\r\n      for (let y = 0; y < GROUND_Y - 40; y += step) {\r\n        const jitterX = (Math.sin(x * 13.37 + y) * 8) % 18;\r\n        const jitterY = (Math.cos(y * 7.91 + x) * 6) % 14;\r\n        context.fillRect(x + jitterX, y + jitterY, 2, 2);\r\n      }\r\n    }\r\n    context.globalAlpha = 1;\r\n  }\r\n\r\n  if (environment?.theme === \"jungle\") {\r\n    const mistStart = GROUND_Y - 140;\r\n    const mistGradient = context.createLinearGradient(0, mistStart, 0, GROUND_Y);\r\n    mistGradient.addColorStop(0, \"rgba(60, 120, 80, 0.18)\");\r\n    mistGradient.addColorStop(1, \"rgba(40, 70, 50, 0)\");\r\n    context.fillStyle = mistGradient;\r\n    context.fillRect(0, mistStart, context.canvas.width, GROUND_Y - mistStart);\r\n  }\r\n\r\n  context.fillStyle = background.groundColor ?? \"#1b2231\";\r\n  context.fillRect(0, GROUND_Y, context.canvas.width, context.canvas.height - GROUND_Y);\r\n}\r\n\r\nfunction drawVehicles() {\r\n  const playerVehicle = getPlayerVehicle();\r\n  const candidateId = stickman.vehicleCandidateId;\r\n\r\n  for (const vehicle of vehicles) {\r\n    const definition = VEHICLE_DEFINITIONS[vehicle.type];\r\n    if (!definition) {\r\n      continue;\r\n    }\r\n\r\n    const halfWidth = (definition.width ?? 120) * 0.5 + 30;\r\n    const culled = !isWithinView(vehicle.x, halfWidth, 320);\r\n    recordVisibility(\"vehicle\", culled);\r\n    if (culled) {\r\n      continue;\r\n    }\r\n\r\n    if (!definition) {\r\n      continue;\r\n    }\r\n\r\n    const isPlayerVehicle = playerVehicle?.id === vehicle.id;\r\n    const isCandidate = !isPlayerVehicle && candidateId === vehicle.id;\r\n    const bodyWidth = definition.width ?? 120;\r\n    const bodyHeight = definition.height ?? 48;\r\n    const bodyColor = definition.colorBody ?? \"#2c3245\";\r\n    const accentColor = definition.colorAccent ?? \"#f0b239\";\r\n\r\n    context.save();\r\n    context.translate(vehicle.x, vehicle.y);\r\n    context.rotate(((vehicle.tilt ?? 0) * Math.PI) / 180);\r\n\r\n    context.fillStyle = bodyColor;\r\n    context.fillRect(-bodyWidth / 2, -bodyHeight / 2, bodyWidth, bodyHeight);\r\n\r\n    context.fillStyle = accentColor;\r\n    context.fillRect(-bodyWidth / 2, -bodyHeight / 2 - 6, bodyWidth * 0.6, 8);\r\n\r\n    context.restore();\r\n\r\n    if (isPlayerVehicle || isCandidate) {\r\n      context.save();\r\n      context.lineWidth = isPlayerVehicle ? 4 : 3;\r\n      context.strokeStyle = isPlayerVehicle ? \"#8cffd4\" : \"#ffc66d\";\r\n      context.setLineDash(isPlayerVehicle ? [] : [8, 8]);\r\n      context.strokeRect(\r\n        vehicle.x - bodyWidth / 2 - 10,\r\n        vehicle.y - bodyHeight / 2 - 12,\r\n        bodyWidth + 20,\r\n        bodyHeight + 24\r\n      );\r\n      context.restore();\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawRemotePlayers() {\r\n  const players = getRemotePlayers();\r\n  for (const remote of players) {\r\n    const culled = !isWithinView(remote.x, 36, 240);\r\n    recordVisibility(\"remote\", culled);\r\n    if (culled) {\r\n      continue;\r\n    }\r\n    renderStickFigure({\r\n      entity: remote,\r\n      pose: POSES.standing,\r\n      aim: remote.aim ?? null,\r\n      weapon: null,\r\n      primaryColor: \"#ff9cf7\",\r\n      supportColor: \"#ffc5ff\",\r\n      lineWidth: 3.2,\r\n      label: remote.name ?? remote.id ?? \"Peer\",\r\n      labelColor: \"#ffd6ff\"\r\n    });\r\n  }\r\n}\r\n\r\nfunction drawSquadmates() {\r\n  const squadStatus = getSquadStatus();\r\n  const commandId = squadStatus?.command?.id ?? \"hold\";\r\n  const commandColors = {\r\n    hold: \"#8cffd4\",\r\n    defend: \"#66b3ff\",\r\n    attack: \"#ff9f7a\",\r\n    flank: \"#ffdd6f\"\r\n  };\r\n  const outline = commandColors[commandId] ?? \"#8cffd4\";\r\n  const weaponVisual = getWeaponVisual(SQUAD_WEAPON_TEMPLATE);\r\n\r\n  for (const ally of squadmates) {\r\n    const halfWidth = 40;\r\n    const culled = !isWithinView(ally.x, halfWidth, 240);\r\n    recordVisibility(\"squad\", culled);\r\n    if (culled) {\r\n      continue;\r\n    }\r\n    const flashTimer = ally.flashTimer ?? 0;\r\n    const flashAmount = clamp(flashTimer / 0.18, 0, 1);\r\n    const highlight = ally.highlight ?? 0;\r\n    const activeShot = ally.fireCooldown != null ? ally.fireCooldown < 0.08 : false;\r\n\r\n    renderStickFigure({\r\n      entity: ally,\r\n      pose: POSES.standing,\r\n      aim: ally.aim,\r\n      weapon: SQUAD_WEAPON_TEMPLATE,\r\n      weaponVisual,\r\n      primaryColor: outline,\r\n      supportColor: outline,\r\n      lineWidth: 3.6,\r\n      attackInfo: ally.targetEnemyId || activeShot\r\n        ? { active: true, progress: activeShot ? 0.7 : 0.4, type: \"ranged-mid\" }\r\n        : null,\r\n      label: ally.name ?? \"Ally\",\r\n      labelColor: \"#cfe4ff\",\r\n      flashColor: flashTimer > 0 ? \"rgba(140, 255, 212, 0.85)\" : null,\r\n      flashAmount,\r\n      highlightColor: highlight > 0 ? \"rgba(140, 255, 212, 0.45)\" : null\r\n    });\r\n  }\r\n}\r\n\r\nfunction drawStickman() {\r\n  if (stickman.health <= 0 || stickman.vehicleId) {\r\n    return;\r\n  }\r\n\r\n  const pose = stickman.currentPose || POSES.standing;\r\n  const weapon = getCurrentWeapon();\r\n  const attack = stickman.currentAttack;\r\n  const attackDuration = attack ? attack.windup + attack.active + attack.recovery : 0;\r\n  const attackInfo = attack\r\n    ? {\r\n        active: stickman.attacking,\r\n        progress: attackDuration > 0 ? clamp(stickman.attackElapsed / attackDuration, 0, 1) : 0,\r\n        type: weapon?.category ?? \"\"\r\n      }\r\n    : null;\r\n\r\n  const cosmeticSelections = getCosmeticSelections();\r\n  const stickmanCosmetics = {\r\n    helmet: getCosmeticOption(cosmeticSelections.helmet) ?? null,\r\n    armor: getCosmeticOption(cosmeticSelections.armor) ?? null,\r\n    jetpack: getCosmeticOption(cosmeticSelections.jetpack) ?? null\r\n  };\r\n\r\n  renderStickFigure({\r\n    entity: stickman,\r\n    pose,\r\n    aim: stickman.aim,\r\n    weapon,\r\n    cosmetics: stickmanCosmetics,\r\n    primaryColor: \"#f4f7ff\",\r\n    supportColor: \"#d0d4de\",\r\n    lineWidth: 4,\r\n    crouching: stickman.crouching,\r\n    rolling: stickman.rolling,\r\n    attackInfo,\r\n    flashColor: stickman.flashBlindTimer > 0 ? \"rgba(255, 255, 224, 0.7)\" : null,\r\n    flashAmount: clamp((stickman.flashBlindTimer ?? 0) / 1.2, 0, 1),\r\n    highlightColor: stickman.structureShieldStrength > 0 ? \"rgba(124, 214, 255, 0.55)\" : null\r\n  });\r\n\r\n  drawPlayerAimDebug();\r\n}\r\n\r\nfunction drawPlayerAimDebug() {\r\n  const aim = stickman.aim;\r\n  if (!aim) {\r\n    return;\r\n  }\r\n\r\n  const anchor = getStickmanShoulderAnchor();\r\n  const hasTarget = aim.active && Number.isFinite(aim.targetX) && Number.isFinite(aim.targetY);\r\n  const reach = hasTarget ? Math.max(72, Math.min(320, aim.magnitude || 220)) : 220;\r\n  const directionX = Number.isFinite(aim.vectorX) ? aim.vectorX : (stickman.facing >= 0 ? 1 : -1);\r\n  const directionY = Number.isFinite(aim.vectorY) ? aim.vectorY : 0;\r\n  const norm = Math.hypot(directionX, directionY) || 1;\r\n  const dirX = directionX / norm;\r\n  const dirY = directionY / norm;\r\n  const targetX = hasTarget ? aim.targetX : anchor.x + dirX * reach;\r\n  const targetY = hasTarget ? aim.targetY : anchor.y + dirY * reach;\r\n\r\n  context.save();\r\n  context.lineWidth = 2;\r\n  context.setLineDash([6, 6]);\r\n  context.strokeStyle = hasTarget ? \"rgba(124, 214, 255, 0.85)\" : \"rgba(160, 196, 255, 0.7)\";\r\n  context.beginPath();\r\n  context.moveTo(anchor.x, anchor.y);\r\n  context.lineTo(targetX, targetY);\r\n  context.stroke();\r\n  context.setLineDash([]);\r\n\r\n  context.fillStyle = hasTarget ? \"rgba(124, 214, 255, 0.9)\" : \"rgba(160, 196, 255, 0.8)\";\r\n  context.beginPath();\r\n  context.arc(targetX, targetY, 4, 0, Math.PI * 2);\r\n  context.fill();\r\n\r\n  context.fillStyle = hasTarget ? \"rgba(124, 214, 255, 1)\" : \"rgba(160, 196, 255, 1)\";\r\n  context.globalAlpha = 0.45;\r\n  context.beginPath();\r\n  context.arc(anchor.x, anchor.y, 3, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.globalAlpha = 1;\r\n  context.restore();\r\n}\r\n\r\nfunction drawHitboxes() {\r\n  for (const hitbox of stickman.activeHitboxes) {\r\n    const alpha = clamp(hitbox.remaining / hitbox.duration, 0, 1);\r\n    context.fillStyle = `rgba(255, 153, 102, ${0.2 * alpha})`;\r\n    context.beginPath();\r\n    context.arc(hitbox.x, hitbox.y, hitbox.radius, 0, Math.PI * 2);\r\n    context.fill();\r\n\r\n    context.strokeStyle = `rgba(255, 198, 141, ${alpha})`;\r\n    context.lineWidth = 2;\r\n    context.beginPath();\r\n    context.arc(hitbox.x, hitbox.y, hitbox.radius, 0, Math.PI * 2);\r\n    context.stroke();\r\n  }\r\n}\r\n\r\nfunction drawTrainingDummy() {\r\n  const dummy = trainingDummy;\r\n  const elapsed = getElapsedTime();\r\n  const headRadius = 20;\r\n  const topY = dummy.y;\r\n  const shake = dummy.shakeTimer > 0 ? Math.sin(elapsed * 40) * dummy.shakeMagnitude * clamp(dummy.shakeTimer / 0.4, 0, 1) : 0;\r\n  const offsetX = dummy.health > 0 ? shake : 0;\r\n  const bodyColor = dummy.health > 0 ? (dummy.flashTimer > 0 ? \"#ffe3af\" : \"#9ca4b8\") : \"#3b3f49\";\r\n\r\n  context.lineWidth = 5;\r\n  context.strokeStyle = bodyColor;\r\n  context.lineCap = \"round\";\r\n\r\n  const centerX = dummy.x + offsetX;\r\n  context.beginPath();\r\n  context.arc(centerX, topY + headRadius, headRadius, 0, Math.PI * 2);\r\n  context.stroke();\r\n\r\n  context.beginPath();\r\n  context.moveTo(centerX, topY + headRadius * 2);\r\n  context.lineTo(centerX, GROUND_Y - headRadius);\r\n  context.stroke();\r\n\r\n  context.beginPath();\r\n  context.moveTo(centerX, GROUND_Y - headRadius);\r\n  context.lineTo(centerX - 28, GROUND_Y);\r\n  context.moveTo(centerX, GROUND_Y - headRadius);\r\n  context.lineTo(centerX + 28, GROUND_Y);\r\n  context.stroke();\r\n\r\n  const armY = topY + headRadius * 2.4;\r\n  context.beginPath();\r\n  context.moveTo(centerX, armY);\r\n  context.lineTo(centerX - 36, armY + 18);\r\n  context.moveTo(centerX, armY);\r\n  context.lineTo(centerX + 36, armY + 18);\r\n  context.stroke();\r\n\r\n  const barWidth = 140;\r\n  const barHeight = 10;\r\n  const barX = centerX - barWidth / 2;\r\n  const barY = topY - 24;\r\n  context.fillStyle = \"#23262d\";\r\n  context.fillRect(barX, barY, barWidth, barHeight);\r\n  const healthRatio = dummy.health / dummy.maxHealth;\r\n  context.fillStyle = dummy.health > 0 ? \"#5fffb5\" : \"#44474f\";\r\n  context.fillRect(barX, barY, barWidth * clamp(healthRatio, 0, 1), barHeight);\r\n  context.strokeStyle = \"#50535b\";\r\n  context.strokeRect(barX, barY, barWidth, barHeight);\r\n\r\n  context.fillStyle = \"#cfd3df\";\r\n  context.font = \"14px 'Segoe UI', Arial, sans-serif\";\r\n  context.textAlign = \"center\";\r\n  const label = dummy.health > 0 ? `Training Dummy ${Math.round(dummy.health)}/${dummy.maxHealth}` : \"Respawning...\";\r\n  context.fillText(label, centerX, barY - 6);\r\n  context.textAlign = \"left\";\r\n}\r\n\r\nfunction drawEnemies() {\r\n  for (const enemy of enemies) {\r\n    if (enemy.health <= 0) {\r\n      continue;\r\n    }\r\n\r\n    const halfWidth = (enemy.radius ?? 22) + 48;\r\n    const culled = !isWithinView(enemy.x, halfWidth, 260);\r\n    recordVisibility(\"enemies\", culled);\r\n    if (culled) {\r\n      continue;\r\n    }\r\n\r\n    const headRadius = 18;\r\n    const bodyLength = Math.max(38, (enemy.height ?? 118) - headRadius * 2 - 26);\r\n    const enemyPose = { headRadius, bodyLength, legLength: 42, armLength: 30 };\r\n    const bodyColor = enemy.stunTimer > 0 ? \"#ffd166\" : (enemy.flashTimer > 0 ? \"#ff9488\" : \"#fa5b4a\");\r\n    const flashTimer = enemy.flashTimer ?? 0;\r\n    const flashAmount = clamp(flashTimer / 0.18, 0, 1);\r\n    const highlightColor = enemy.shakeTimer > 0 ? \"rgba(255, 139, 126, 0.35)\" : null;\r\n\r\n    renderStickFigure({\r\n      entity: enemy,\r\n      pose: enemyPose,\r\n      aim: enemy.aim,\r\n      weapon: null,\r\n      primaryColor: bodyColor,\r\n      supportColor: \"#fca289\",\r\n      lineWidth: 4.4,\r\n      showHealthBar: true,\r\n      healthRatio: enemy.health / enemy.maxHealth,\r\n      healthColor: \"#ff6f61\",\r\n      flashColor: flashTimer > 0 ? \"rgba(255, 148, 136, 0.85)\" : null,\r\n      flashAmount,\r\n      highlightColor,\r\n      attackInfo: enemy.state === \"attack-active\" ? { active: true, progress: 0.8, type: \"melee-mid\" } : null\r\n    });\r\n  }\r\n}\r\n\r\n\r\nfunction drawHud() {\r\n  const canvasWidth = context.canvas.width;\r\n  const canvasHeight = context.canvas.height;\r\n\r\n  const currentWeapon = getCurrentWeapon();\r\n  const weaponSlots = getWeaponSlots();\r\n  const ammoStatus = currentWeapon ? getAmmoStatus(currentWeapon.id) : null;\r\n  const gadgetStatus = getGadgetStatus();\r\n  const recoilOffset = getRecoilOffset();\r\n  const buildingHud = getBuildingHudStatus();\r\n  const materials = Math.max(0, buildingHud?.resources ?? 0);\r\n\r\n  if ((stickman.flashBlindTimer ?? 0) > 0) {\r\n    const overlayAlpha = Math.min(0.55, (stickman.flashBlindTimer ?? 0) / 1.2);\r\n    context.fillStyle = `rgba(255, 255, 224, ${overlayAlpha})`;\r\n    context.fillRect(0, 0, canvasWidth, canvasHeight);\r\n  }\r\n\r\n  context.save();\r\n  context.textAlign = \"left\";\r\n  context.textBaseline = \"alphabetic\";\r\n\r\n  const maxHealth = Math.max(1, stickman.maxHealth ?? 100);\r\n  const healthRatio = clamp(stickman.health / maxHealth, 0, 1);\r\n  const shieldMax = gadgetStatus?.shieldMaxStrength ?? 0;\r\n  const shieldStrength = gadgetStatus?.shieldStrength ?? 0;\r\n  const shieldRatio = shieldMax > 0 ? clamp(shieldStrength / shieldMax, 0, 1) : 0;\r\n  const shieldActive = (gadgetStatus?.shieldActive ?? false) || shieldStrength > 0;\r\n\r\n  const vitalsWidth = 308;\r\n  const vitalsHeight = shieldActive ? 158 : 138;\r\n  const vitalsX = 24;\r\n  const vitalsY = canvasHeight - vitalsHeight - 32;\r\n\r\n  drawUiPanel(vitalsX, vitalsY, vitalsWidth, vitalsHeight, { accent: \"#5dc2ff\" });\r\n\r\n  context.font = UI_TITLE_FONT;\r\n  context.fillStyle = \"#f4f7ff\";\r\n  context.fillText(\"Player Vitals\", vitalsX + 16, vitalsY + 30);\r\n\r\n  context.font = UI_TEXT_FONT;\r\n  context.fillStyle = \"#d7dff1\";\r\n  context.fillText(`Health ${Math.round(stickman.health)} / ${Math.round(maxHealth)}`, vitalsX + 16, vitalsY + 56);\r\n  drawUiProgressBar(vitalsX + 16, vitalsY + 62, vitalsWidth - 32, 10, healthRatio, { fill: \"#ff7d7d\" });\r\n\r\n  let vitalsLineY = vitalsY + 88;\r\n\r\n  if (shieldActive) {\r\n    context.fillStyle = \"#cbeaff\";\r\n    context.fillText(`Shield ${Math.round(shieldStrength)} / ${Math.round(shieldMax)}`, vitalsX + 16, vitalsLineY);\r\n    drawUiProgressBar(vitalsX + 16, vitalsLineY + 6, vitalsWidth - 32, 10, shieldRatio, { fill: \"#7cd6ff\" });\r\n    vitalsLineY += 32;\r\n  }\r\n\r\n  context.fillStyle = \"#9aa6bf\";\r\n  context.fillText(`Materials ${materials}`, vitalsX + 16, vitalsLineY);\r\n  vitalsLineY += 22;\r\n\r\n  const throwable = weaponSlots.find((slot) => slot.category === \"throwable\");\r\n  const gadgetSlot = weaponSlots.find((slot) => slot.category === \"gadget\");\r\n  const throwCooldown = Math.max(0, stickman.throwCooldown ?? 0);\r\n  const gadgetCooldown = Math.max(0, gadgetStatus?.gadgetCooldown ?? 0);\r\n  const throwCooldownMax = Math.max(throwable?.throwable?.cooldownSeconds ?? 0, throwCooldown);\r\n  const gadgetCooldownMax = Math.max(gadgetSlot?.gadget?.cooldownSeconds ?? 0, gadgetCooldown);\r\n\r\n  const statusTags = [];\r\n\r\n  if (stickman.comboWindowOpen) {\r\n    statusTags.push({ text: \"Combo window open\", background: \"rgba(255, 205, 135, 0.32)\", color: \"#ffe0b8\" });\r\n  }\r\n  if (throwable) {\r\n    if (throwCooldown > 0.05) {\r\n      statusTags.push({ text: `Throw ${formatSeconds(throwCooldown)}`, background: \"rgba(255, 173, 102, 0.32)\", color: \"#ffd7a8\" });\r\n    } else {\r\n      statusTags.push({ text: \"Throw ready\", background: \"rgba(140, 255, 212, 0.28)\", color: \"#d6ffee\" });\r\n    }\r\n  }\r\n  if (gadgetSlot) {\r\n    if (gadgetCooldown > 0.05) {\r\n      statusTags.push({ text: `Gadget ${formatSeconds(gadgetCooldown)}`, background: \"rgba(124, 214, 255, 0.28)\", color: \"#d6f1ff\" });\r\n    } else {\r\n      statusTags.push({ text: \"Gadget ready\", background: \"rgba(124, 214, 255, 0.2)\", color: \"#d6f1ff\" });\r\n    }\r\n  }\r\n  if ((stickman.stunTimer ?? 0) > 0) {\r\n    statusTags.push({ text: `Stunned ${formatSeconds(stickman.stunTimer)}`, background: \"rgba(255, 140, 122, 0.32)\", color: \"#ffe0d6\" });\r\n  }\r\n  if ((stickman.flashBlindTimer ?? 0) > 0) {\r\n    statusTags.push({ text: `Blinded ${formatSeconds(stickman.flashBlindTimer)}`, background: \"rgba(255, 230, 128, 0.32)\", color: \"#fff2c4\" });\r\n  }\r\n  if ((stickman.smokeSlowTimer ?? 0) > 0) {\r\n    statusTags.push({ text: `Smoke slow ${formatSeconds(stickman.smokeSlowTimer)}`, background: \"rgba(168, 186, 208, 0.32)\", color: \"#e1e7f1\" });\r\n  }\r\n  if (stickman.health <= 0) {\r\n    statusTags.push({ text: \"Downed\", background: \"rgba(255, 125, 109, 0.36)\", color: \"#ffe1d6\" });\r\n  }\r\n\r\n  if (statusTags.length > 0) {\r\n    let tagX = vitalsX + 16;\r\n    let tagY = vitalsLineY;\r\n    for (const tag of statusTags) {\r\n      const width = drawUiTag(tag.text, tagX, tagY, tag);\r\n      tagX += width + 8;\r\n      if (tagX + width > vitalsX + vitalsWidth - 16) {\r\n        tagX = vitalsX + 16;\r\n        tagY += 24;\r\n      }\r\n    }\r\n    vitalsLineY = tagY + 28;\r\n  }\r\n\r\n  const weaponPanelWidth = 320;\r\n  const weaponPanelHeight = 212;\r\n  const weaponPanelX = canvasWidth - weaponPanelWidth - 24;\r\n  const weaponPanelY = 24;\r\n  drawUiPanel(weaponPanelX, weaponPanelY, weaponPanelWidth, weaponPanelHeight, { accent: getCategoryAccent(currentWeapon?.category ?? \"\") });\r\n\r\n  context.font = UI_TITLE_FONT;\r\n  context.fillStyle = \"#f4f7ff\";\r\n  context.fillText(\"Weapon\", weaponPanelX + 16, weaponPanelY + 30);\r\n\r\n  context.font = UI_TEXT_FONT;\r\n  context.fillStyle = \"#d7dff1\";\r\n  context.fillText(currentWeapon?.name ?? \"Unarmed\", weaponPanelX + 16, weaponPanelY + 56);\r\n\r\n  if (currentWeapon?.category) {\r\n    context.font = UI_SMALL_FONT;\r\n    context.fillStyle = \"#9aa6bf\";\r\n    context.fillText(currentWeapon.category.replace(/-/g, \" \").toUpperCase(), weaponPanelX + 16, weaponPanelY + 74);\r\n  }\r\n\r\n  let weaponLineY = weaponPanelY + 100;\r\n\r\n  if (ammoStatus) {\r\n    const isInfinite = ammoStatus.capacity === Number.POSITIVE_INFINITY;\r\n    const magazineDisplay = isInfinite ? \"INF\" : `${Math.max(0, ammoStatus.magazine)}`;\r\n    const reserveDisplay = isInfinite ? \"INF\" : `${Math.max(0, ammoStatus.reserve)}`;\r\n    context.font = UI_TEXT_FONT;\r\n    context.fillStyle = \"#d7dff1\";\r\n    context.fillText(`Magazine ${magazineDisplay}   Reserve ${reserveDisplay}`, weaponPanelX + 16, weaponLineY);\r\n    weaponLineY += 18;\r\n    if (!isInfinite && ammoStatus.capacity > 0) {\r\n      drawUiProgressBar(weaponPanelX + 16, weaponLineY, weaponPanelWidth - 32, 8, clamp(ammoStatus.magazine / ammoStatus.capacity, 0, 1), { fill: \"#ffd27f\" });\r\n      weaponLineY += 20;\r\n    }\r\n    if (ammoStatus.reloading && ammoStatus.reloadSeconds > 0) {\r\n      const reloadProgress = 1 - clamp(ammoStatus.reloadTimer / ammoStatus.reloadSeconds, 0, 1);\r\n      drawUiProgressBar(weaponPanelX + 16, weaponLineY, weaponPanelWidth - 32, 6, reloadProgress, { fill: \"#ffcf7a\" });\r\n      weaponLineY += 16;\r\n      context.font = UI_SMALL_FONT;\r\n      context.fillStyle = \"#ffcf7a\";\r\n      context.fillText(`Reloading ${formatSeconds(ammoStatus.reloadTimer)}`, weaponPanelX + 16, weaponLineY + 4);\r\n      weaponLineY += 18;\r\n    }\r\n  } else {\r\n    context.font = UI_TEXT_FONT;\r\n    context.fillStyle = \"#9aa6bf\";\r\n    context.fillText(\"No ammunition required\", weaponPanelX + 16, weaponLineY);\r\n    weaponLineY += 18;\r\n  }\r\n\r\n  if (throwable) {\r\n    const ready = throwCooldown <= 0.05;\r\n    context.font = UI_SMALL_FONT;\r\n    context.fillStyle = ready ? \"#8cffd4\" : \"#ffcf7a\";\r\n    context.fillText(`Throw ${ready ? \"ready\" : formatSeconds(throwCooldown)}`, weaponPanelX + 16, weaponLineY);\r\n    weaponLineY += 14;\r\n    if (throwCooldownMax > 0) {\r\n      const throwProgress = ready ? 1 : 1 - clamp(throwCooldown / throwCooldownMax, 0, 1);\r\n      drawUiProgressBar(weaponPanelX + 16, weaponLineY, weaponPanelWidth - 32, 6, throwProgress, { fill: \"#ffd27f\" });\r\n      weaponLineY += 16;\r\n    }\r\n  }\r\n\r\n  if (gadgetSlot) {\r\n    const ready = gadgetCooldown <= 0.05;\r\n    context.font = UI_SMALL_FONT;\r\n    context.fillStyle = ready ? \"#8cffd4\" : \"#7cd6ff\";\r\n    context.fillText(`Gadget ${ready ? \"ready\" : formatSeconds(gadgetCooldown)}`, weaponPanelX + 16, weaponLineY);\r\n    weaponLineY += 14;\r\n    if (gadgetCooldownMax > 0) {\r\n      const gadgetProgress = ready ? 1 : 1 - clamp(gadgetCooldown / gadgetCooldownMax, 0, 1);\r\n      drawUiProgressBar(weaponPanelX + 16, weaponLineY, weaponPanelWidth - 32, 6, gadgetProgress, { fill: \"#7cd6ff\" });\r\n      weaponLineY += 16;\r\n    }\r\n  }\r\n\r\n  const recoilMagnitude = Math.hypot(recoilOffset?.horizontal ?? 0, recoilOffset?.vertical ?? 0);\r\n  if (recoilMagnitude > 0.05) {\r\n    context.font = UI_SMALL_FONT;\r\n    context.fillStyle = \"#9aa6bf\";\r\n    context.fillText(`Recoil offset H ${(recoilOffset.horizontal ?? 0).toFixed(2)}  V ${(recoilOffset.vertical ?? 0).toFixed(2)}`, weaponPanelX + 16, weaponLineY);\r\n    weaponLineY += 18;\r\n  }\r\n\r\n  const weaponBadges = [];\r\n  if ((gadgetStatus?.turretCount ?? 0) > 0) {\r\n    weaponBadges.push({ text: `Turrets ${gadgetStatus.turretCount}`, background: \"rgba(140, 255, 212, 0.25)\", color: \"#d6ffee\" });\r\n  }\r\n  if (gadgetStatus?.grappleActive) {\r\n    weaponBadges.push({ text: \"Grapple active\", background: \"rgba(124, 214, 255, 0.25)\", color: \"#d6f1ff\" });\r\n  }\r\n  if (weaponBadges.length > 0) {\r\n    let badgeX = weaponPanelX + 16;\r\n    const badgeY = weaponPanelY + weaponPanelHeight - 28;\r\n    for (const badge of weaponBadges) {\r\n      const width = drawUiTag(badge.text, badgeX, badgeY, badge);\r\n      badgeX += width + 8;\r\n    }\r\n  }\r\n\r\n  const helpLines = [\r\n    \"Move: WASD / Arrows   Jump: Space   Roll: Shift\",\r\n    \"Attack: Left Click or J   Throw: Right Click or G\",\r\n    \"Build Mode: B toggle   , / . cycle blueprints\",\r\n    \"Toggle Modes: Y Survival   K Sandbox   F9 Co-Op\"\r\n  ];\r\n  const helpHeight = 32 + helpLines.length * 18;\r\n  drawUiPanel(24, 24, 360, helpHeight, { accent: \"rgba(146, 166, 210, 0.35)\" });\r\n  context.font = UI_TITLE_FONT;\r\n  context.fillStyle = \"#f4f7ff\";\r\n  context.fillText(\"Core Controls\", 40, 48);\r\n  context.font = UI_TEXT_FONT;\r\n  context.fillStyle = \"#d7dff1\";\r\n  let helpY = 70;\r\n  for (const line of helpLines) {\r\n    context.fillText(line, 40, helpY);\r\n    helpY += 18;\r\n  }\r\n\r\n  const cards = [];\r\n  const campaignHud = getCampaignHudStatus();\r\n  if (campaignHud) {\r\n    if (campaignHud.stage && campaignHud.stage !== \"inactive\") {\r\n      const lines = [];\r\n      const missionName = campaignHud.missionName ?? \"Story Mission\";\r\n      const totalMissions = Math.max(0, campaignHud.totalMissions ?? 0);\r\n      const missionIndex = campaignHud.missionIndex ?? -1;\r\n      let missionLabel = missionName;\r\n      if (totalMissions > 0 && missionIndex >= 0) {\r\n        missionLabel += ` (${missionIndex + 1}/${totalMissions})`;\r\n      }\r\n      lines.push({ text: missionLabel, color: \"#fce6b3\" });\r\n      const objective = campaignHud.objective ?? {};\r\n      if (objective.type === \"eliminate\" && objective.target > 0) {\r\n        const progress = Math.min(objective.target, Math.round(objective.progress ?? 0));\r\n        lines.push(`${objective.label ?? \"Eliminate\"}: ${progress}/${objective.target}`);\r\n      } else if (objective.type === \"survive\" && (objective.remaining ?? 0) > 0) {\r\n        lines.push(`${objective.label ?? \"Hold out\"}: ${formatSeconds(objective.remaining)}`);\r\n      } else if (objective.label) {\r\n        lines.push(objective.label);\r\n      }\r\n      if (campaignHud.message) {\r\n        lines.push({ text: campaignHud.message, color: \"#d7dff1\" });\r\n      }\r\n      cards.push({ title: \"Campaign\", accent: \"#ffd66c\", lines, footer: \"Press Q for briefing\" });\r\n    } else {\r\n      cards.push({ title: \"Campaign\", accent: \"rgba(255, 214, 108, 0.22)\", lines: [\"Press Q to begin missions.\"] });\r\n    }\r\n  }\r\n\r\n  const survivalHud = getSurvivalHudStatus();\r\n  if (survivalHud) {\r\n    const lines = [];\r\n    const active = Boolean(survivalHud.active);\r\n    const waveValue = Math.max(1, survivalHud.wave || survivalHud.bestWave || 1);\r\n    lines.push(active ? `Wave ${Math.max(1, survivalHud.wave || 1)}` : `Best Wave ${Math.max(1, survivalHud.bestWave || waveValue)}`);\r\n    if (active) {\r\n      if (survivalHud.stage === \"rest\") {\r\n        lines.push(`Resupply ${formatSeconds(survivalHud.timer ?? 0)}`);\r\n      } else if (survivalHud.stage === \"countdown\") {\r\n        lines.push(`Deploying ${formatSeconds(survivalHud.timer ?? 0)}`);\r\n      } else {\r\n        lines.push(`Enemies ${survivalHud.enemiesAlive}`);\r\n      }\r\n      lines.push(`Kills ${survivalHud.kills ?? 0}`);\r\n    } else if (survivalHud.lastOutcome === \"defeat\") {\r\n      lines.push(\"Defeated last run\");\r\n      lines.push(`Kills ${survivalHud.kills ?? 0} | Materials ${survivalHud.runReward ?? 0}`);\r\n    } else {\r\n      lines.push(\"Press Y to launch waves.\");\r\n      if ((survivalHud.bestKills ?? 0) > 0) {\r\n        lines.push(`Best kills ${survivalHud.bestKills}`);\r\n      }\r\n    }\r\n    cards.push({\r\n      title: \"Survival\",\r\n      accent: active ? \"#ffd66c\" : \"rgba(255, 214, 108, 0.18)\",\r\n      lines,\r\n      footer: active ? \"Press Y to exit Survival\" : \"Press Y to begin Survival\"\r\n    });\r\n  }\r\n\r\n  const sandboxHud = getSandboxHudStatus();\r\n  if (sandboxHud) {\r\n    const lines = [];\r\n    const active = Boolean(sandboxHud.active);\r\n    if (active) {\r\n      lines.push(`Wave ${Math.max(1, sandboxHud.wave || 1)}`);\r\n      if (sandboxHud.inRest && (sandboxHud.restTimer ?? 0) > 0) {\r\n        lines.push(`Next wave ${formatSeconds(sandboxHud.restTimer ?? 0)}`);\r\n      } else {\r\n        lines.push(`Enemies ${sandboxHud.enemiesAlive}`);\r\n      }\r\n      lines.push(`Kills ${sandboxHud.kills ?? 0}`);\r\n    } else {\r\n      lines.push(\"Press K to start full-arsenal skirmish.\");\r\n      if ((sandboxHud.bestWave ?? 0) > 0 || (sandboxHud.bestKills ?? 0) > 0) {\r\n        lines.push(`Best Wave ${Math.max(1, sandboxHud.bestWave ?? 0)} | Kills ${sandboxHud.bestKills ?? 0}`);\r\n      }\r\n    }\r\n    cards.push({\r\n      title: \"Sandbox\",\r\n      accent: active ? \"#8cffd4\" : \"rgba(140, 255, 212, 0.2)\",\r\n      lines,\r\n      footer: active ? \"Press K to exit Sandbox Skirmish\" : \"Press K to toggle Sandbox\"\r\n    });\r\n  }\r\n\r\n  const coopHud = getCoopHudStatus();\r\n  if (coopHud) {\r\n    const lines = [];\r\n    const active = Boolean(coopHud.active);\r\n    if (active) {\r\n      const participants = Math.max(0, coopHud.participants || 1);\r\n      const maxParticipants = Math.max(participants, coopHud.maxParticipants || participants);\r\n      lines.push(`${participants}/${maxParticipants} connected`);\r\n      lines.push(`Latency ${Math.max(0, coopHud.averageLatency ?? 0).toFixed(0)} ms`);\r\n      lines.push(`Throughput ${Math.max(0, coopHud.packetsPerSecond ?? 0).toFixed(1)} pkt/s`);\r\n    } else {\r\n      lines.push(\"Press F9 to open Massive Co-Op.\");\r\n      if (coopHud.lastOutcome && coopHud.lastOutcome !== \"inactive\") {\r\n        lines.push(`Last session: ${coopHud.lastOutcome}`);\r\n      }\r\n    }\r\n    cards.push({\r\n      title: \"Massive Co-Op\",\r\n      accent: active ? \"#8cffd4\" : \"rgba(140, 255, 212, 0.18)\",\r\n      lines,\r\n      footer: active ? \"Press F9 to disconnect\" : \"Press F9 to connect\"\r\n    });\r\n  }\r\n\r\n  const supplyStatus = getSupplyDropStatus();\r\n  if (supplyStatus && (supplyStatus.incomingMessage || supplyStatus.rewardMessage || (supplyStatus.activeCount ?? 0) > 0)) {\r\n    const lines = [];\r\n    if (supplyStatus.incomingMessage) {\r\n      lines.push({ text: supplyStatus.incomingMessage, color: \"#d6f1ff\" });\r\n    }\r\n    if ((supplyStatus.timeUntilNext ?? 0) > 0.2 && supplyStatus.nextDropLabel) {\r\n      lines.push(`Next drop ${supplyStatus.nextDropLabel}: ${formatSeconds(supplyStatus.timeUntilNext ?? 0)}`);\r\n    }\r\n    if ((supplyStatus.activeCount ?? 0) > 0) {\r\n      lines.push(`Drops on field ${supplyStatus.activeCount}`);\r\n    }\r\n    if (supplyStatus.rewardMessage) {\r\n      lines.push({ text: `Reward ${supplyStatus.rewardMessage}`, color: \"#8cffd4\" });\r\n    }\r\n    cards.push({ title: \"Supply Drops\", accent: \"#8cffd4\", lines });\r\n  }\r\n\r\n  const p2pStatus = getP2PStatus?.();\r\n  if (p2pStatus && p2pStatus.status && p2pStatus.status !== \"inactive\") {\r\n    const lines = [];\r\n    lines.push(`Status: ${p2pStatus.status}`);\r\n    if (p2pStatus.status !== \"connected\") {\r\n      lines.push(\"Use window.P2P.createOffer() in console\");\r\n    } else {\r\n      lines.push(`Remote peers ${getRemotePlayers().length}`);\r\n    }\r\n    cards.push({ title: \"P2P Session\", accent: \"rgba(146, 166, 210, 0.35)\", lines });\r\n  }\r\n\r\n  const cardsStartY = weaponPanelY + weaponPanelHeight + 16;\r\n  const cardsBottom = drawUiCardStack(cards, weaponPanelX, cardsStartY, weaponPanelWidth);\r\n\r\n  drawWeaponHotbar(weaponSlots, currentWeapon, ammoStatus, canvasWidth, canvasHeight);\r\n\r\n  const perfMetrics = [\r\n    [\"En\", \"enemies\"],\r\n    [\"Sq\", \"squad\"],\r\n    [\"Veh\", \"vehicle\"],\r\n    [\"Net\", \"remote\"],\r\n    [\"Dst\", \"destructible\"],\r\n    [\"Bld\", \"building\"],\r\n    [\"Int\", \"interactable\"],\r\n    [\"Res\", \"resource\"]\r\n  ];\r\n  const performanceEntries = [];\r\n  for (const [label, key] of perfMetrics) {\r\n    const totalKey = `${key}Total`;\r\n    const culledKey = `${key}Culled`;\r\n    const total = performanceStats[totalKey] ?? 0;\r\n    if (total <= 0) {\r\n      continue;\r\n    }\r\n    const visible = Math.max(0, total - (performanceStats[culledKey] ?? 0));\r\n    performanceEntries.push(`${label} ${visible}/${total}`);\r\n  }\r\n\r\n  let perfPanelTop = canvasHeight - 24;\r\n  if (performanceEntries.length > 0) {\r\n    context.font = UI_SMALL_FONT;\r\n    const perfText = performanceEntries.join(\"   \");\r\n    const perfWidth = Math.max(200, Math.ceil(context.measureText(perfText).width) + 32);\r\n    const perfHeight = 48;\r\n    const perfX = canvasWidth - perfWidth - 24;\r\n    const perfY = canvasHeight - perfHeight - 24;\r\n    drawUiPanel(perfX, perfY, perfWidth, perfHeight, { accent: \"rgba(146, 166, 210, 0.35)\", radius: 10 });\r\n    context.save();\r\n    context.font = UI_SMALL_FONT;\r\n    context.fillStyle = \"#9aa6bf\";\r\n    context.fillText(\"Performance\", perfX + 16, perfY + 20);\r\n    context.fillStyle = \"#d0d7e9\";\r\n    context.fillText(perfText, perfX + 16, perfY + perfHeight - 12);\r\n    context.restore();\r\n    perfPanelTop = perfY;\r\n  }\r\n\r\n  const debugState = getPolishDebugState();\r\n  const notices = debugState?.notices?.slice(-4).reverse() ?? [];\r\n  const shotIndicators = debugState?.shotIndicators ?? [];\r\n  const debugLines = [];\r\n  for (const notice of notices) {\r\n    const life = notice.maxTtl > 0 ? clamp(notice.ttl / notice.maxTtl, 0, 1) : 1;\r\n    debugLines.push({ text: notice.message, alpha: life });\r\n  }\r\n  for (const indicator of shotIndicators) {\r\n    const life = indicator.maxTtl > 0 ? clamp(indicator.ttl / indicator.maxTtl, 0, 1) : 1;\r\n    debugLines.push({ text: `Shot: ${indicator.weaponId}`, alpha: life });\r\n  }\r\n  const activeFilters = Object.entries(debugState?.filters ?? {}).filter(([, value]) => value);\r\n  if (activeFilters.length > 0) {\r\n    debugLines.push({ text: `Filters ${activeFilters.map(([key]) => key).join(', ')}`, alpha: 0.85, color: \"#9aa6bf\" });\r\n  }\r\n  if (debugLines.length > 0) {\r\n    const debugHeight = 32 + debugLines.length * 18;\r\n    let debugY = cardsBottom + 12;\r\n    const maxDebugY = perfPanelTop - debugHeight - 12;\r\n    if (debugY > maxDebugY) {\r\n      debugY = maxDebugY;\r\n    }\r\n    drawUiPanel(weaponPanelX, debugY, weaponPanelWidth, debugHeight, { accent: \"rgba(146, 166, 210, 0.25)\", radius: 10, fill: \"rgba(10, 16, 26, 0.82)\" });\r\n    context.save();\r\n    context.font = UI_SMALL_FONT;\r\n    context.fillStyle = \"#9aa6bf\";\r\n    context.fillText(\"Debug Feed\", weaponPanelX + 16, debugY + 20);\r\n    let debugLineY = debugY + 38;\r\n    for (const entry of debugLines) {\r\n      context.globalAlpha = entry.alpha ?? 1;\r\n      context.fillStyle = entry.color ?? \"#d0d7e9\";\r\n      context.fillText(entry.text, weaponPanelX + 16, debugLineY);\r\n      debugLineY += 18;\r\n    }\r\n    context.restore();\r\n  }\r\n\r\n  context.restore();\r\n}\r\n\r\nfunction drawGadgetsLayer() {\r\n  drawGadgets();\r\n}\r\n\r\nfunction drawPolishDebugEffects() {\r\n  const { muzzleFlashes, shieldBursts, throwableBursts } = getPolishDebugState();\r\n  if (muzzleFlashes.length === 0 && shieldBursts.length === 0 && throwableBursts.length === 0) {\r\n    return;\r\n  }\r\n\r\n  context.save();\r\n\r\n  for (const flash of muzzleFlashes) {\r\n    const life = clamp(flash.ttl / flash.maxTtl, 0, 1);\r\n    const alpha = 0.25 + life * 0.6;\r\n    const radius = 12 + (1 - life) * 14;\r\n    const offset = (flash.facing ?? 1) * (10 + (1 - life) * 6);\r\n    context.globalAlpha = alpha;\r\n    context.fillStyle = \"#ffd27a\";\r\n    context.beginPath();\r\n    context.arc(flash.x + offset, flash.y, radius, 0, Math.PI * 2);\r\n    context.fill();\r\n  }\r\n\r\n  for (const burst of shieldBursts) {\r\n    const life = clamp(burst.ttl / burst.maxTtl, 0, 1);\r\n    const alpha = (burst.type === \"shatter\" ? 0.55 : 0.35) * life;\r\n    if (alpha <= 0) {\r\n      continue;\r\n    }\r\n    const radiusBase = burst.type === \"shatter\" ? 120 : 80;\r\n    const radius = radiusBase * (1 - life * 0.35);\r\n    context.globalAlpha = alpha;\r\n    context.lineWidth = burst.type === \"shatter\" ? 6 : 3;\r\n    context.strokeStyle = burst.type === \"shatter\" ? \"#7cd6ff\" : \"#9be9ff\";\r\n    context.beginPath();\r\n    context.arc(burst.center.x, burst.center.y, radius, 0, Math.PI * 2);\r\n    context.stroke();\r\n  }\r\n\r\n  for (const burst of throwableBursts) {\r\n    const life = clamp(burst.ttl / burst.maxTtl, 0, 1);\r\n    if (life <= 0) {\r\n      continue;\r\n    }\r\n    let stroke = \"#ffb347\";\r\n    if (burst.type === \"flash\") {\r\n      stroke = \"#fff6d0\";\r\n    } else if (burst.type === \"smoke\" || burst.type === \"smoke-fade\") {\r\n      stroke = \"#9db8ca\";\r\n    }\r\n    const radius = burst.radius * (1 + (1 - life) * 0.35);\r\n    context.globalAlpha = (burst.type === \"smoke-fade\" ? 0.3 : 0.45) * life;\r\n    context.lineWidth = burst.type === \"flash\" ? 5 : 4;\r\n    context.strokeStyle = stroke;\r\n    context.beginPath();\r\n    context.arc(burst.x, burst.y, radius, 0, Math.PI * 2);\r\n    context.stroke();\r\n  }\r\n\r\n  context.restore();\r\n}\r\n\r\nfunction drawProjectilesLayer() {\r\n  drawProjectiles();\r\n  drawThrowables();\r\n  drawParticles();\r\n  drawPolishDebugEffects();\r\n}\r\n\r\nfunction drawServerBrowser() {\r\n  const state = getServerBrowserState();\r\n  if (!state.visible) {\r\n    return;\r\n  }\r\n\r\n  const panelWidth = 480;\r\n  const panelHeight = 420;\r\n  const x = context.canvas.width * 0.5 - panelWidth * 0.5;\r\n  const y = context.canvas.height * 0.5 - panelHeight * 0.5;\r\n\r\n  context.save();\r\n  context.fillStyle = \"rgba(12, 16, 24, 0.82)\";\r\n  context.fillRect(x, y, panelWidth, panelHeight);\r\n  context.strokeStyle = \"#6f7fa0\";\r\n  context.lineWidth = 3;\r\n  context.strokeRect(x, y, panelWidth, panelHeight);\r\n\r\n  context.fillStyle = \"#cfe3ff\";\r\n  context.font = \"18px 'Segoe UI', Arial, sans-serif\";\r\n  context.textAlign = \"left\";\r\n  context.fillText(\"Server Browser\", x + 20, y + 32);\r\n\r\n  context.font = \"13px 'Segoe UI', Arial, sans-serif\";\r\n  context.fillStyle = \"#9aa9c7\";\r\n  context.fillText(\"Join: Enter  |  Navigate: [ / ]  |  Close: L\", x + 20, y + 52);\r\n  context.fillText(\"Toggle: L  |  Join: Enter  |  Host: H  |  Stop: U  |  Next: ] or /  |  Prev: [\", x + 20, y + 68);\r\n\r\n  let statusY = y + 88;\r\n  if (state.error) {\r\n    context.fillStyle = \"#ff8080\";\r\n    context.fillText(state.error, x + 20, statusY);\r\n    statusY += 18;\r\n  }\r\n  if (state.statusMessage) {\r\n    context.fillStyle = \"#8cffd4\";\r\n    context.fillText(state.statusMessage, x + 20, statusY);\r\n    statusY += 18;\r\n  }\r\n  if (state.joinError) {\r\n    context.fillStyle = \"#ff9a9a\";\r\n    context.fillText(state.joinError, x + 20, statusY);\r\n    statusY += 18;\r\n  }\r\n  if (state.joinStatus) {\r\n    context.fillStyle = \"#cfe3ff\";\r\n    context.fillText(state.joinStatus, x + 20, statusY);\r\n    statusY += 18;\r\n  }\r\n\r\n  const listTop = statusY + 12;\r\n  const rowHeight = 34;\r\n  const listBottom = y + panelHeight - 140;\r\n  const servers = state.servers ?? [];\r\n  const maxRows = Math.max(0, Math.floor((listBottom - listTop) / rowHeight));\r\n  const rowsToDraw = Math.min(servers.length, Math.min(maxRows, 8));\r\n\r\n  context.font = \"14px 'Segoe UI', Arial, sans-serif\";\r\n  for (let i = 0; i < rowsToDraw; i += 1) {\r\n    const server = servers[i];\r\n    const rowY = listTop + i * rowHeight;\r\n    const isSelected = i === state.selectedIndex;\r\n    if (isSelected) {\r\n      context.fillStyle = \"rgba(108, 132, 220, 0.4)\";\r\n      context.fillRect(x + 12, rowY - 6, panelWidth - 24, rowHeight - 4);\r\n    }\r\n    context.fillStyle = \"#e4ecff\";\r\n    context.fillText(server.name ?? server.id ?? \"Server\", x + 24, rowY + 8);\r\n    context.fillStyle = \"#9aa9c7\";\r\n    const details = `${server.map ?? \"Unknown\"} | ${server.players ?? \"?\"}/${server.maxPlayers ?? \"?\"} | ${server.region ?? \"--\"}`;\r\n    context.fillText(details, x + 24, rowY + 22);\r\n  }\r\n\r\n  if (servers.length === 0) {\r\n    context.fillStyle = \"#a6b2cf\";\r\n    context.fillText(\"No servers available.\", x + 24, listTop + 16);\r\n  }\r\n\r\n  const snippet = (value, limit = 64) => {\r\n    if (typeof value !== \"string\") {\r\n      return \"\";\r\n    }\r\n    return value.length > limit ? `${value.slice(0, limit)}...` : value;\r\n  };\r\n\r\n  const p2p = state.p2p ?? {};\r\n  let p2pY = y + panelHeight - 120;\r\n  context.font = \"12px 'Segoe UI', Arial, sans-serif\";\r\n  context.fillStyle = \"#9aa9c7\";\r\n  context.fillText(\"P2P Handshake\", x + 20, p2pY);\r\n  p2pY += 16;\r\n\r\n  if (p2p.error) {\r\n    context.fillStyle = \"#ff8080\";\r\n    context.fillText(p2p.error, x + 20, p2pY);\r\n    p2pY += 16;\r\n  }\r\n\r\n  if (state.hosting) {\r\n    if (p2p.pendingOffer) {\r\n      context.fillStyle = \"#ffd27f\";\r\n      context.fillText(\"Generating offer...\", x + 20, p2pY);\r\n      p2pY += 16;\r\n    } else if (p2p.offer) {\r\n      context.fillStyle = \"#8cffd4\";\r\n      context.fillText(\"Offer ready and shared with joiners.\", x + 20, p2pY);\r\n      p2pY += 16;\r\n      context.fillStyle = \"#9aa9c7\";\r\n      context.fillText(snippet(p2p.offer), x + 20, p2pY);\r\n      p2pY += 16;\r\n    } else {\r\n      context.fillStyle = \"#9aa9c7\";\r\n      context.fillText(\"Preparing host offer...\", x + 20, p2pY);\r\n      p2pY += 16;\r\n    }\r\n\r\n    if (p2p.pendingAnswer) {\r\n      context.fillStyle = \"#ffd27f\";\r\n      context.fillText(\"Waiting for a joiner answer...\", x + 20, p2pY);\r\n      p2pY += 16;\r\n    }\r\n  } else {\r\n    if (p2p.pendingAnswer) {\r\n      context.fillStyle = \"#ffd27f\";\r\n      context.fillText(\"Generating answer...\", x + 20, p2pY);\r\n      p2pY += 16;\r\n    } else if (p2p.answer) {\r\n      context.fillStyle = \"#8cffd4\";\r\n      context.fillText(\"Answer applied. Waiting for host handshake.\", x + 20, p2pY);\r\n      p2pY += 16;\r\n      context.fillStyle = \"#9aa9c7\";\r\n      context.fillText(snippet(p2p.answer), x + 20, p2pY);\r\n      p2pY += 16;\r\n    } else {\r\n      context.fillStyle = \"#9aa9c7\";\r\n      context.fillText(\"Waiting for host offer...\", x + 20, p2pY);\r\n      p2pY += 16;\r\n    }\r\n  }\r\n\r\n  const localCandidates = Array.isArray(p2p.localCandidates) ? p2p.localCandidates : [];\r\n  const remoteCandidates = Array.isArray(p2p.remoteCandidates) ? p2p.remoteCandidates : [];\r\n\r\n  if (p2p.pendingCandidates) {\r\n    context.fillStyle = \"#ffd27f\";\r\n    context.fillText(\"Processing ICE candidates...\", x + 20, p2pY);\r\n    p2pY += 16;\r\n  }\r\n\r\n  const candidateSummary =\r\n    \"Local ICE ready: \" + localCandidates.length + \"  |  Remote applied: \" + remoteCandidates.length;\r\n  context.fillStyle = \"#9aa9c7\";\r\n  context.fillText(candidateSummary, x + 20, p2pY);\r\n  p2pY += 16;\r\n\r\n  if (localCandidates.length > 0) {\r\n    const lastLocalLabel = \"Last local: \" + snippet(localCandidates[localCandidates.length - 1], 54);\r\n    context.fillStyle = \"#6f86d0\";\r\n    context.fillText(lastLocalLabel, x + 20, p2pY);\r\n    p2pY += 16;\r\n  } else if (!p2p.pendingCandidates) {\r\n    context.fillStyle = \"#9aa9c7\";\r\n    context.fillText(\"Local ICE will appear shortly after offer/answer.\", x + 20, p2pY);\r\n    p2pY += 16;\r\n  }\r\n\r\n  if (remoteCandidates.length > 0) {\r\n    const lastRemoteLabel = \"Last remote: \" + snippet(remoteCandidates[remoteCandidates.length - 1], 54);\r\n    context.fillStyle = \"#6fd0c5\";\r\n    context.fillText(lastRemoteLabel, x + 20, p2pY);\r\n    p2pY += 16;\r\n  } else if (!p2p.pendingCandidates) {\r\n    context.fillStyle = \"#9aa9c7\";\r\n    if (state.hosting) {\r\n      context.fillText(\"Press N after players send their ICE (M).\", x + 20, p2pY);\r\n    } else {\r\n      context.fillText(\"Press M to copy your ICE and send it to the host.\", x + 20, p2pY);\r\n    }\r\n    p2pY += 16;\r\n  }\r\n\r\n  context.restore();\r\n}\r\nexport { drawBackground, drawDestructibles, drawBuildings, drawInteractables, drawVehicles, drawSupplyDrops, drawRemotePlayers, drawServerBrowser, drawSquadmates, drawStickman, drawHitboxes, drawBuildPreview, drawTrainingDummy, drawEnemies, drawHud, drawProjectilesLayer, drawGadgetsLayer };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { context } from \"../../environment/canvas.js\";\nimport { getScenarioEditorState } from \"../scenario/index.js\";\nimport { getScenarioSlots } from \"../../state/scenarios.js\";\n\nfunction drawWrappedText(text, x, y, maxWidth, lineHeight) {\n  const words = String(text ?? \"\").split(/\\s+/).filter(Boolean);\n  if (words.length === 0) {\n    return 0;\n  }\n  let line = \"\";\n  let cursorY = y;\n  let lines = 0;\n  for (const word of words) {\n    const candidate = line.length > 0 ? `${line} ${word}` : word;\n    if (context.measureText(candidate).width > maxWidth && line) {\n      context.fillText(line, x, cursorY);\n      line = word;\n      cursorY += lineHeight;\n      lines += 1;\n    } else {\n      line = candidate;\n    }\n  }\n  if (line) {\n    context.fillText(line, x, cursorY);\n    lines += 1;\n  }\n  return lines;\n}\n\nfunction drawScenarioToast(message, alpha = 1) {\n  const text = String(message ?? \"\").trim();\n  if (!text) {\n    return;\n  }\n  context.save();\n  context.globalAlpha = Math.max(0, Math.min(1, alpha));\n  context.font = \"14px 'Segoe UI', Arial, sans-serif\";\n  const padding = 12;\n  const textWidth = context.measureText(text).width;\n  const boxWidth = Math.min(context.canvas.width - 48, textWidth + padding * 2);\n  const boxHeight = 32;\n  const x = context.canvas.width - boxWidth - 24;\n  const y = context.canvas.height - boxHeight - 32;\n  context.fillStyle = \"rgba(12, 20, 36, 0.88)\";\n  context.fillRect(x, y, boxWidth, boxHeight);\n  context.strokeStyle = \"rgba(140, 168, 255, 0.55)\";\n  context.lineWidth = 1;\n  context.strokeRect(x + 0.5, y + 0.5, boxWidth - 1, boxHeight - 1);\n  context.fillStyle = \"#dce6ff\";\n  context.fillText(text, x + padding, y + 20);\n  context.restore();\n}\n\nfunction formatPercent(value) {\n  return `${Math.round((value ?? 0) * 100)}%`;\n}\n\nfunction drawScenarioOverlay() {\n  const state = getScenarioEditorState();\n  const {\n    visible,\n    fieldIndex = 0,\n    fields = [],\n    scenario,\n    environmentName,\n    message,\n    messageTimer = 0,\n    slotIndex = 0\n  } = state;\n\n  const showMessage = Boolean(message) && messageTimer > 0.03;\n  if (!visible && !showMessage) {\n    return;\n  }\n\n  const width = context.canvas.width;\n  const height = context.canvas.height;\n\n  if (visible) {\n    context.save();\n    context.fillStyle = \"rgba(8, 12, 20, 0.65)\";\n    context.fillRect(0, 0, width, height);\n\n    const panelWidth = Math.min(width - 140, 620);\n    const panelHeight = Math.min(height - 120, 420);\n    const panelX = (width - panelWidth) * 0.5;\n    const panelY = (height - panelHeight) * 0.5;\n\n    context.fillStyle = \"rgba(14, 20, 36, 0.94)\";\n    context.fillRect(panelX, panelY, panelWidth, panelHeight);\n    context.strokeStyle = \"rgba(140, 168, 255, 0.85)\";\n    context.lineWidth = 2;\n    context.strokeRect(panelX + 0.5, panelY + 0.5, panelWidth - 1, panelHeight - 1);\n\n    const padding = 26;\n    let cursorY = panelY + padding;\n    const leftX = panelX + padding;\n    const valueX = panelX + panelWidth - padding;\n\n    context.fillStyle = \"#f2f5ff\";\n    context.font = \"20px 'Segoe UI', Arial, sans-serif\";\n    context.fillText(\"Scenario Editor\", leftX, cursorY);\n    cursorY += 30;\n\n    context.fillStyle = \"#9aa9c7\";\n    context.font = \"13px 'Segoe UI', Arial, sans-serif\";\n    context.fillText(\"F8 close   ?/? fields   ?/? adjust   Enter apply   E edit text   R reset\", leftX, cursorY);\n    cursorY += 26;\n\n    context.font = \"14px 'Segoe UI', Arial, sans-serif\";\n    context.fillStyle = \"#8cffd4\";\n    const scenarioLabel = scenario ? `${slotIndex + 1}. ${scenario.name}` : `Slot ${slotIndex + 1}`;\n    context.fillText(scenarioLabel, leftX, cursorY);\n    cursorY += 24;\n\n    const totalSlots = getScenarioSlots().length;\n\n    context.font = \"15px 'Segoe UI', Arial, sans-serif\";\n    fields.forEach((field, index) => {\n      let valueText = \"--\";\n      if (!scenario) {\n        valueText = \"N/A\";\n      } else {\n        switch (field.id) {\n          case \"scenarioSlot\":\n            valueText = `${slotIndex + 1} / ${totalSlots}`;\n            break;\n          case \"name\":\n            valueText = scenario.name;\n            break;\n          case \"environmentId\":\n            valueText = environmentName;\n            break;\n          case \"startingMaterials\":\n            valueText = `${scenario.startingMaterials}`;\n            break;\n          case \"enemyCount\":\n            valueText = `${scenario.enemyCount}`;\n            break;\n          case \"playerSpawnRatio\":\n            valueText = formatPercent(scenario.playerSpawnRatio);\n            break;\n          case \"dummySpawnRatio\":\n            valueText = formatPercent(scenario.dummySpawnRatio);\n            break;\n          case \"enemySpawnLeft\":\n            valueText = formatPercent(scenario.enemySpawnRatios?.[0]);\n            break;\n          case \"enemySpawnRight\":\n            valueText = formatPercent(scenario.enemySpawnRatios?.[1]);\n            break;\n          case \"description\":\n            valueText = scenario.description ?? \"\";\n            break;\n          default:\n            valueText = \"\";\n            break;\n        }\n      }\n\n      const rowY = cursorY + index * 28;\n      const isActive = index === fieldIndex;\n      if (isActive) {\n        context.fillStyle = \"rgba(92, 128, 220, 0.3)\";\n        context.fillRect(leftX - 12, rowY - 22, panelWidth - padding * 2 + 24, 28);\n      }\n\n      context.fillStyle = isActive ? \"#dfe7ff\" : \"#c5cee4\";\n      context.fillText(field.label, leftX, rowY);\n\n      context.fillStyle = isActive ? \"#8cffd4\" : \"#9aa9c7\";\n      context.font = field.id === \"description\" ? \"13px 'Segoe UI', Arial, sans-serif\" : \"15px 'Segoe UI', Arial, sans-serif\";\n      const textWidth = context.measureText(valueText).width;\n      context.fillText(valueText, Math.max(leftX, valueX - textWidth), rowY);\n      context.font = \"15px 'Segoe UI', Arial, sans-serif\";\n    });\n\n    let descriptionTop = cursorY + fields.length * 28 + 12;\n    if (scenario?.description) {\n      context.fillStyle = \"#9aa9c7\";\n      context.font = \"12px 'Segoe UI', Arial, sans-serif\";\n      const maxWidth = panelWidth - padding * 2;\n      const lines = drawWrappedText(scenario.description, leftX, descriptionTop, maxWidth, 16);\n      descriptionTop += lines * 16 + 8;\n    }\n\n    const footerY = panelY + panelHeight - padding + 4;\n    context.fillStyle = \"#7f8aad\";\n    context.font = \"12px 'Segoe UI', Arial, sans-serif\";\n    context.fillText(\"Apply to rebuild the arena with new spawns and resources.\", leftX, footerY);\n\n    context.restore();\n  }\n\n  if (showMessage && !visible) {\n    drawScenarioToast(message, Math.min(1, messageTimer / 0.4));\n  }\n}\n\nexport { drawScenarioOverlay };\r\n","import { stickman } from \"../../state/entities.js\";\r\nimport { POSES, ROLL_DURATION } from \"../../config/constants.js\";\r\nimport { getCurrentWeapon } from \"./weapons.js\";\r\n\r\nfunction determinePose() {\r\n  if (stickman.rolling) {\r\n    return POSES.rolling;\r\n  }\r\n  if (stickman.crouching) {\r\n    return POSES.crouching;\r\n  }\r\n  return POSES.standing;\r\n}\r\n\r\nfunction startRoll(direction) {\r\n  if (stickman.vehicleId) {\r\n    return;\r\n  }\r\n  if (!stickman.onGround || stickman.rolling || stickman.attacking || stickman.health <= 0 || (stickman.stunTimer ?? 0) > 0) {\r\n    return;\r\n  }\r\n\r\n  const { left, right } = direction;\r\n  if (left && !right) {\r\n    stickman.facing = -1;\r\n  } else if (right && !left) {\r\n    stickman.facing = 1;\r\n  }\r\n\r\n  stickman.rolling = true;\r\n  stickman.rollTimer = ROLL_DURATION;\r\n  stickman.crouching = false;\r\n  stickman.vy = 0;\r\n}\r\n\r\nfunction startAttack(index) {\r\n  const weapon = getCurrentWeapon();\r\n  const attackChain = weapon?.attackChain ?? [];\r\n  const attack = attackChain[index];\r\n  if (!attack) {\r\n    return;\r\n  }\r\n\r\n  stickman.attacking = true;\r\n  stickman.attackIndex = index;\r\n  stickman.currentAttack = attack;\r\n  stickman.attackElapsed = 0;\r\n  stickman.comboWindowOpen = false;\r\n  stickman.comboWindowTimer = 0;\r\n  stickman.nextAttackQueued = false;\r\n  stickman.hitboxSpawned = false;\r\n  stickman.attackInstanceId += 1;\r\n}\r\n\r\nfunction attemptAttack() {\r\n  if (stickman.vehicleId) {\r\n    return;\r\n  }\r\n  if (stickman.rolling || stickman.health <= 0 || (stickman.stunTimer ?? 0) > 0 || stickman.reloading) {\r\n    return;\r\n  }\r\n\r\n  const weapon = getCurrentWeapon();\r\n  const attackChain = weapon?.attackChain ?? [];\r\n  if (attackChain.length === 0) {\r\n    return;\r\n  }\r\n\r\n  if (!stickman.attacking) {\r\n    startAttack(0);\r\n    return;\r\n  }\r\n\r\n  if (stickman.comboWindowOpen && stickman.attackIndex + 1 < attackChain.length) {\r\n    stickman.nextAttackQueued = true;\r\n  }\r\n}\r\n\r\nfunction advanceAttack(delta, spawnHitboxFn) {\r\n  if (stickman.vehicleId) {\r\n    stickman.attacking = false;\r\n    stickman.currentAttack = null;\r\n    stickman.attackElapsed = 0;\r\n    stickman.comboWindowOpen = false;\r\n    stickman.comboWindowTimer = 0;\r\n    stickman.hitboxSpawned = false;\r\n    stickman.attackIndex = -1;\r\n    return;\r\n  }\r\n  const attack = stickman.currentAttack;\r\n  if (!attack) {\r\n    return;\r\n  }\r\n  if ((stickman.stunTimer ?? 0) > 0 || stickman.reloading) {\r\n    stickman.attacking = false;\r\n    stickman.currentAttack = null;\r\n    stickman.attackElapsed = 0;\r\n    stickman.comboWindowOpen = false;\r\n    stickman.comboWindowTimer = 0;\r\n    stickman.hitboxSpawned = false;\r\n    return;\r\n  }\r\n\r\n  stickman.attackElapsed += delta;\r\n\r\n  if (!stickman.hitboxSpawned && stickman.attackElapsed >= attack.windup) {\r\n    spawnHitboxFn(attack);\r\n    stickman.hitboxSpawned = true;\r\n  }\r\n\r\n  if (!stickman.comboWindowOpen && stickman.attackElapsed >= attack.comboStart) {\r\n    stickman.comboWindowOpen = true;\r\n    stickman.comboWindowTimer = attack.comboWindow;\r\n  }\r\n\r\n  if (stickman.comboWindowOpen) {\r\n    stickman.comboWindowTimer -= delta;\r\n    if (stickman.comboWindowTimer <= 0) {\r\n      stickman.comboWindowOpen = false;\r\n    }\r\n  }\r\n\r\n  const weapon = getCurrentWeapon();\r\n  const attackChain = weapon?.attackChain ?? [];\r\n\r\n  if (stickman.attackElapsed >= attack.windup + attack.active + attack.recovery) {\r\n    const nextIndex = stickman.attackIndex + 1;\r\n    const shouldChain = stickman.nextAttackQueued && nextIndex < attackChain.length;\r\n\r\n    stickman.attacking = false;\r\n    stickman.currentAttack = null;\r\n    stickman.attackElapsed = 0;\r\n    stickman.comboWindowOpen = false;\r\n    stickman.comboWindowTimer = 0;\r\n    stickman.hitboxSpawned = false;\r\n    stickman.nextAttackQueued = false;\r\n\r\n    if (shouldChain) {\r\n      startAttack(nextIndex);\r\n    } else {\r\n      stickman.attackIndex = -1;\r\n    }\r\n  }\r\n}\r\n\r\nexport { determinePose, startRoll, attemptAttack, advanceAttack };\r\n","import { canvas } from \"../../environment/canvas.js\";\r\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { interactables, getInteractables } from \"../../state/interactables.js\";\r\nimport { stickman, enemies, squadmates, getTotalHeight } from \"../../state/entities.js\";\r\nimport { POSES } from \"../../config/constants.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\nimport { spawnRingBurst, spawnSmokePuffs } from \"../effects/particles.js\";\r\nimport { spawnDynamicLight } from \"../effects/lighting.js\";\r\nimport { applyDamageToEnemy, applyDamageToPlayer } from \"../combat/damageHandlers.js\";\r\n\r\nconst PLAYER_HALF_WIDTH = 22;\r\nconst ALLY_HALF_WIDTH = 20;\r\nconst ENEMY_HALF_WIDTH = 24;\r\n\r\nfunction approachZero(value, deltaValue) {\r\n  if (value > 0) {\r\n    return Math.max(0, value - deltaValue);\r\n  }\r\n  if (value < 0) {\r\n    return Math.min(0, value + deltaValue);\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction getActorProfile(actor, options = {}) {\r\n  if (!actor) {\r\n    return null;\r\n  }\r\n  const pose = options.pose ?? (actor === stickman ? stickman.currentPose ?? POSES.standing : POSES.standing);\r\n  const height = options.height ?? (actor.height ?? getTotalHeight(pose));\r\n  const halfWidth = options.halfWidth ?? (actor.radius ?? PLAYER_HALF_WIDTH);\r\n  const vx = options.vx ?? actor.vx ?? 0;\r\n  const onGround = options.onGround ?? actor.onGround ?? true;\r\n  return {\r\n    ref: actor,\r\n    x: actor.x,\r\n    y: actor.y,\r\n    vx,\r\n    onGround,\r\n    facing: actor.facing ?? 1,\r\n    height,\r\n    halfWidth\r\n  };\r\n}\r\n\r\nfunction applyPushFromActor(interactable, template, actorProfile, delta) {\r\n  if (!actorProfile || (template.category !== \"movable\" && template.category !== \"rolling\")) {\r\n    return;\r\n  }\r\n\r\n  const actorFeet = actorProfile.y + actorProfile.height;\r\n  const verticalGap = Math.abs(actorFeet - interactable.y);\r\n  const verticalThreshold = interactable.height * 0.6 + actorProfile.height * 0.25 + 24;\r\n  if (verticalGap > verticalThreshold) {\r\n    return;\r\n  }\r\n\r\n  const interactHalf = interactable.width ? interactable.width / 2 : interactable.radius;\r\n  const dx = actorProfile.x - interactable.x;\r\n  const overlap = actorProfile.halfWidth + interactHalf - Math.abs(dx);\r\n  if (overlap <= 0) {\r\n    return;\r\n  }\r\n\r\n  const direction = dx >= 0 ? 1 : -1;\r\n  const impulseBase = template.pushImpulse ?? 260;\r\n  const isPlayer = actorProfile.ref === stickman;\r\n  const velocityInfluence = Math.abs(actorProfile.vx) * (isPlayer ? 0.7 : 0.45);\r\n  const appliedImpulse = (impulseBase + velocityInfluence) * delta;\r\n\r\n  interactable.vx += direction * appliedImpulse;\r\n  const maxSpeed = template.maxSpeed ?? interactable.maxSpeed ?? 240;\r\n  interactable.vx = clamp(interactable.vx, -maxSpeed, maxSpeed);\r\n\r\n  const targetActorX = interactable.x + direction * (interactHalf + actorProfile.halfWidth + 0.5);\r\n  if (direction > 0) {\r\n    actorProfile.ref.x = Math.min(actorProfile.ref.x, targetActorX);\r\n  } else {\r\n    actorProfile.ref.x = Math.max(actorProfile.ref.x, targetActorX);\r\n  }\r\n\r\n  if (actorProfile.ref === stickman) {\r\n    const envWidth = getEnvironmentWidth();\r\n    stickman.x = clamp(stickman.x, 40, envWidth - 40);\r\n  }\r\n\r\n  interactable.flashTimer = Math.max(interactable.flashTimer, 0.12);\r\n  interactable.state = template.category === \"rolling\" ? \"rolling\" : \"pushed\";\r\n}\r\n\r\nfunction updateTrap(interactable, template, delta) {\r\n  interactable.cooldown = Math.max(0, (interactable.cooldown ?? 0) - delta);\r\n  if (interactable.cooldown > 0) {\r\n    return;\r\n  }\r\n\r\n  const effectiveHalf = interactable.width ? interactable.width / 2 : interactable.radius;\r\n  const detectionRadius = effectiveHalf + 26;\r\n  const damage = template.damage ?? 0;\r\n  const knockback = template.knockback ?? 80;\r\n  const launch = template.launch ?? -140;\r\n  const stun = template.stunDuration ?? 0.6;\r\n\r\n  let triggered = false;\r\n\r\n  const actors = [];\r\n  actors.push(getActorProfile(stickman, { halfWidth: PLAYER_HALF_WIDTH, vx: stickman.vx }));\r\n  for (const enemy of enemies) {\r\n    if (enemy.health > 0) {\r\n      actors.push(getActorProfile(enemy, { halfWidth: ENEMY_HALF_WIDTH }));\r\n    }\r\n  }\r\n\r\n  for (const profile of actors) {\r\n    if (!profile) {\r\n      continue;\r\n    }\r\n    const feet = profile.y + profile.height;\r\n    const verticalGap = Math.abs(feet - interactable.y);\r\n    if (verticalGap > interactable.height * 0.8 + profile.height * 0.35) {\r\n      continue;\r\n    }\r\n    const dx = profile.x - interactable.x;\r\n    const distance = Math.abs(dx);\r\n    if (distance > detectionRadius + profile.halfWidth) {\r\n      continue;\r\n    }\r\n\r\n    const facing = dx >= 0 ? 1 : -1;\r\n    triggered = true;\r\n    if (profile.ref === stickman) {\r\n      applyDamageToPlayer(\r\n        { attackDamage: damage, attackKnockback: knockback, attackLaunch: launch, facing },\r\n        { damage, knockback, launch, facing }\r\n      );\r\n      stickman.stunTimer = Math.max(stickman.stunTimer ?? 0, stun);\r\n    } else {\r\n      applyDamageToEnemy(profile.ref, {\r\n        damage,\r\n        knockback,\r\n        launch: Math.abs(launch),\r\n        facing\r\n      });\r\n      profile.ref.stunTimer = Math.max(profile.ref.stunTimer ?? 0, stun * 0.8);\r\n    }\r\n  }\r\n\r\n  if (triggered) {\r\n    interactable.cooldown = template.cooldown ?? 2.4;\r\n    interactable.flashTimer = 0.25;\r\n    interactable.state = \"triggered\";\r\n    interactable.timer = template.cooldown ?? 2.4;\r\n\r\n    spawnRingBurst({\r\n      x: interactable.x,\r\n      y: interactable.y - interactable.height * 0.5,\r\n      startRadius: effectiveHalf * 0.6,\r\n      endRadius: effectiveHalf * 1.6,\r\n      color: template.glowColor ?? \"#96f7ff\",\r\n      ttl: 0.35,\r\n      lineWidth: 6\r\n    });\r\n    spawnSmokePuffs({\r\n      x: interactable.x,\r\n      y: interactable.y - interactable.height * 0.5,\r\n      radius: effectiveHalf * 1.2,\r\n      maxRadius: effectiveHalf * 1.8,\r\n      ttl: 0.4\r\n    });\r\n    spawnDynamicLight({\r\n      type: \"point\",\r\n      x: interactable.x,\r\n      y: interactable.y,\r\n      radius: effectiveHalf * 3,\r\n      intensity: 1.4,\r\n      color: template.glowColor ?? \"#8cf7ff\",\r\n      ttl: 0.22,\r\n      flicker: 0.5,\r\n      decay: 0.8\r\n    });\r\n  }\r\n}\r\n\r\nfunction updateInteractable(interactable, delta) {\r\n  const template = interactable.template ?? {};\r\n\r\n  interactable.flashTimer = Math.max(0, (interactable.flashTimer ?? 0) - delta);\r\n  interactable.timer = Math.max(0, (interactable.timer ?? 0) - delta);\r\n\r\n  const playerHeight = getTotalHeight(stickman.currentPose ?? POSES.standing);\r\n  const playerFeet = stickman.y + playerHeight;\r\n  const verticalGap = Math.abs(playerFeet - interactable.y);\r\n  const horizGap = Math.abs(stickman.x - interactable.x);\r\n  const near = verticalGap < interactable.height + playerHeight * 0.25 + 32 && horizGap < (interactable.width ? interactable.width : interactable.radius * 2) + 120;\r\n  const highlightTarget = near ? 1 : 0;\r\n  interactable.highlight += (highlightTarget - interactable.highlight) * clamp(delta * 6, 0, 1);\r\n  interactable.highlight = clamp(interactable.highlight, 0, 1);\r\n\r\n  if (template.category === \"trap\") {\r\n    updateTrap(interactable, template, delta);\r\n    return;\r\n  }\r\n\r\n  const frictionStrength = (interactable.friction ?? 2) * (template.category === \"rolling\" ? 24 : 32);\r\n  interactable.vx = approachZero(interactable.vx, frictionStrength * delta);\r\n  if (Math.abs(interactable.vx) < 2) {\r\n    interactable.vx = 0;\r\n  }\r\n\r\n  interactable.x += interactable.vx * delta;\r\n\r\n  const interactHalf = interactable.width ? interactable.width / 2 : interactable.radius;\r\n  const padding = 24;\r\n  const envWidthLimits = getEnvironmentWidth();\r\n  let minX = interactable.minX ?? interactHalf + padding;\r\n  let maxX = interactable.maxX ?? envWidthLimits - interactHalf - padding;\r\n  if (minX > maxX) {\r\n    const mid = (minX + maxX) / 2;\r\n    minX = mid;\r\n    maxX = mid;\r\n  }\r\n  if (interactable.x <= minX) {\r\n    interactable.x = minX;\r\n    interactable.vx = Math.max(0, interactable.vx);\r\n  }\r\n  if (interactable.x >= maxX) {\r\n    interactable.x = maxX;\r\n    interactable.vx = Math.min(0, interactable.vx);\r\n  }\r\n\r\n  const playerProfile = getActorProfile(stickman, { halfWidth: PLAYER_HALF_WIDTH, vx: stickman.vx });\r\n  applyPushFromActor(interactable, template, playerProfile, delta);\r\n\r\n  for (const ally of squadmates) {\r\n    if (!ally || ally.state === \"defeated\") {\r\n      continue;\r\n    }\r\n    applyPushFromActor(interactable, template, getActorProfile(ally, { halfWidth: ALLY_HALF_WIDTH }), delta);\r\n  }\r\n}\r\n\r\nfunction updateInteractables(delta) {\r\n  if (delta <= 0) {\r\n    return;\r\n  }\r\n  for (const interactable of interactables) {\r\n    updateInteractable(interactable, delta);\r\n  }\r\n}\r\n\r\nfunction handleInteractableHitboxCollision(hitbox) {\r\n  let hit = false;\r\n  for (const interactable of interactables) {\r\n    const template = interactable.template ?? {};\r\n    if (template.category !== \"movable\" && template.category !== \"rolling\") {\r\n      continue;\r\n    }\r\n    if (hitbox.hitTargets.has(interactable.id)) {\r\n      continue;\r\n    }\r\n    const interactHalf = interactable.radius ?? (interactable.width ? interactable.width / 2 : 32);\r\n    const centerY = interactable.y - (interactable.height ?? interactHalf);\r\n    const dx = hitbox.x - interactable.x;\r\n    const dy = hitbox.y - centerY;\r\n    const distance = Math.hypot(dx, dy);\r\n    if (distance > hitbox.radius + interactHalf) {\r\n      continue;\r\n    }\r\n\r\n    hitbox.hitTargets.add(interactable.id);\r\n    const direction = dx >= 0 ? 1 : -1;\r\n    const impulse = template.hitImpulse ?? interactable.hitImpulse ?? 420;\r\n    interactable.vx += direction * impulse;\r\n    const maxSpeed = template.maxSpeed ?? interactable.maxSpeed ?? 260;\r\n    interactable.vx = clamp(interactable.vx, -maxSpeed, maxSpeed);\r\n    interactable.flashTimer = Math.max(interactable.flashTimer, 0.16);\r\n    interactable.state = template.category === \"rolling\" ? \"rolling\" : \"nudged\";\r\n    hit = true;\r\n  }\r\n  return hit;\r\n}\r\n\r\nexport { getInteractables, updateInteractables, handleInteractableHitboxCollision };\r\n\r\n\r\n","import { stickman, trainingDummy, enemies } from \"../../state/entities.js\";\r\nimport { getCurrentWeapon } from \"./weapons.js\";\r\nimport { spawnProjectile } from \"./projectiles.js\";\r\nimport { applyDamageToDummy, applyDamageToEnemy, applyDamageToPlayer } from \"./damageHandlers.js\";\r\nimport { handleHitboxCollision } from \"../world/destructibles.js\";\r\nimport { handleInteractableHitboxCollision } from \"../world/interactables.js\";\r\nimport { consumeAmmo, startReload, registerShot } from \"../../state/ammo.js\";\r\nimport { applyRecoil } from \"../../state/recoil.js\";\r\n\r\nfunction spawnHitbox(attack) {\r\n  stickman.activeHitboxes.push({\r\n    id: stickman.attackInstanceId,\r\n    attackIndex: stickman.attackIndex,\r\n    remaining: attack.active,\r\n    duration: attack.active,\r\n    offsetX: attack.range,\r\n    heightOffset: attack.heightOffset,\r\n    radius: attack.radius,\r\n    damage: attack.damage,\r\n    knockback: attack.knockback,\r\n    launch: attack.launch,\r\n    ownerFacing: stickman.facing,\r\n    hitTargets: new Set(),\r\n    x: 0,\r\n    y: 0\r\n  });\r\n}\r\n\r\nfunction updateHitboxes(delta, baseHeight) {\r\n  stickman.activeHitboxes = stickman.activeHitboxes.filter((hitbox) => {\r\n    hitbox.remaining -= delta;\r\n    hitbox.ownerFacing = stickman.facing;\r\n    hitbox.x = stickman.x + stickman.facing * hitbox.offsetX;\r\n    hitbox.y = stickman.y + baseHeight + hitbox.heightOffset;\r\n    return hitbox.remaining > 0;\r\n  });\r\n}\r\n\r\nfunction resolveHitDetection() {\r\n  for (const hitbox of stickman.activeHitboxes) {\r\n    if (trainingDummy.health > 0 && !hitbox.hitTargets.has(trainingDummy.id)) {\r\n      const dx = hitbox.x - trainingDummy.x;\r\n      const dy = hitbox.y - (trainingDummy.y + trainingDummy.height * 0.55);\r\n      const distance = Math.hypot(dx, dy);\r\n      if (distance <= hitbox.radius + trainingDummy.radius) {\r\n        hitbox.hitTargets.add(trainingDummy.id);\r\n        applyDamageToDummy({\r\n          damage: hitbox.damage,\r\n          knockback: hitbox.knockback,\r\n          launch: hitbox.launch,\r\n          facing: hitbox.ownerFacing\r\n        });\r\n      }\r\n    }\r\n\r\n    for (const enemy of enemies) {\r\n      if (enemy.health <= 0 || hitbox.hitTargets.has(enemy.id)) {\r\n        continue;\r\n      }\r\n      const dx = hitbox.x - enemy.x;\r\n      const dy = hitbox.y - (enemy.y + enemy.height * 0.5);\r\n      const distance = Math.hypot(dx, dy);\r\n      if (distance <= hitbox.radius + enemy.radius) {\r\n        hitbox.hitTargets.add(enemy.id);\r\n        applyDamageToEnemy(enemy, {\r\n          damage: hitbox.damage,\r\n          knockback: hitbox.knockback,\r\n          launch: hitbox.launch,\r\n          facing: hitbox.ownerFacing\r\n        });\r\n      }\r\n    }\r\n\r\n    handleHitboxCollision(hitbox);\r\n    handleInteractableHitboxCollision(hitbox);\r\n  }\r\n}\r\n\r\nfunction fireEquippedWeaponProjectile() {\r\n  const weapon = getCurrentWeapon();\r\n  if (!weapon || !weapon.category?.startsWith(\"ranged\")) {\n    return false;\n  }\r\n\r\n  if (!consumeAmmo(weapon.id)) {\r\n    if (startReload(weapon.id)) {\r\n      stickman.attacking = false;\r\n      stickman.currentAttack = null;\r\n      stickman.attackIndex = -1;\r\n      if (typeof window !== \"undefined\") {\r\n        window.dispatchEvent(new CustomEvent(\"weapon:reload-start\", { detail: { weaponId: weapon.id } }));\r\n      }\r\n    }\r\n      return false;\r\n  }\r\n\r\n  const projectileConfig = weapon.projectile ?? {};\r\n  const speed = projectileConfig.speed ?? 460;\r\n\r\n  const aim = stickman.aim ?? null;\r\n  const rawDirX = Number.isFinite(aim?.vectorX) ? aim.vectorX : (stickman.facing || 1);\r\n  const rawDirY = Number.isFinite(aim?.vectorY) ? aim.vectorY : 0;\r\n  const normLength = Math.hypot(rawDirX, rawDirY) || 1;\r\n  const dirX = rawDirX / normLength;\r\n  const dirY = rawDirY / normLength;\r\n\r\n  const anchorX = Number.isFinite(aim?.anchorX) ? aim.anchorX : stickman.x;\r\n  const anchorY = Number.isFinite(aim?.anchorY) ? aim.anchorY : stickman.y + 24;\r\n\r\n  const muzzleDistance = projectileConfig.muzzleDistance ?? 38;\r\n  const sideOffset = projectileConfig.muzzleSideOffset ?? 0;\r\n  const verticalOffset = projectileConfig.muzzleVerticalOffset ?? 0;\r\n\r\n  const perpX = -dirY;\r\n  const perpY = dirX;\r\n\r\n  const muzzleX = anchorX + dirX * muzzleDistance + perpX * sideOffset;\r\n  const muzzleY = anchorY + dirY * muzzleDistance + perpY * sideOffset + verticalOffset;\r\n\r\n  const baseAngle = Math.atan2(dirY, dirX);\r\n  const spreadAngle = registerShot(weapon.id);\r\n  const finalAngle = baseAngle + spreadAngle;\r\n  const vx = Math.cos(finalAngle) * speed + (projectileConfig.initialVx ?? 0);\r\n  const vy = Math.sin(finalAngle) * speed + (projectileConfig.initialVy ?? 0);\r\n\r\n  const facing = vx >= 0 ? 1 : -1;\r\n\r\n  if (weapon.recoil) {\r\n    applyRecoil(weapon.recoil);\r\n    if (typeof window !== \"undefined\") {\r\n      window.dispatchEvent(new CustomEvent(\"weapon:recoil-kick\", { detail: { weaponId: weapon.id, recoil: weapon.recoil } }));\r\n    }\r\n  }\r\n\r\n  if (typeof window !== \"undefined\") {\r\n    window.dispatchEvent(\r\n      new CustomEvent(\"weapon:muzzle-flash\", {\r\n        detail: {\r\n          weaponId: weapon.id,\r\n          x: muzzleX,\r\n          y: muzzleY,\r\n          facing,\r\n          direction: { x: dirX, y: dirY }\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  spawnProjectile({\r\n    x: muzzleX,\r\n    y: muzzleY,\r\n    vx,\r\n    vy,\r\n    radius: projectileConfig.radius ?? 5,\r\n    lifetime: projectileConfig.lifetime ?? 0.9,\r\n    color: projectileConfig.color ?? \"#ffca7a\",\r\n    damage: projectileConfig.damage ?? 10,\r\n    knockback: projectileConfig.knockback ?? 60,\r\n    facing,\r\n    gravityFactor: projectileConfig.gravityFactor ?? 0.2\r\n  });\r\n\r\n  if (typeof window !== \"undefined\") {\n    window.dispatchEvent(new CustomEvent(\"weapon:shot-fired\", { detail: { weaponId: weapon.id } }));\n  }\n\n  return true;\n}\r\n\r\nexport { spawnHitbox, updateHitboxes, resolveHitDetection, applyDamageToEnemy, applyDamageToPlayer, fireEquippedWeaponProjectile };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { POSES } from \"../../config/constants.js\";\nimport { GROUND_Y } from \"../../environment/canvas.js\";\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\nimport { stickman, remotePlayers, upsertRemotePlayer, getTotalHeight } from \"../../state/entities.js\";\nimport { input } from \"../input/index.js\";\nimport { resetSurvival } from \"../survival/index.js\";\nimport { deactivateSandboxSkirmish } from \"../sandbox/index.js\";\nimport { activateCoop, deactivateCoop, setCoopParticipants, setCoopMetrics, setCoopOutcome, getCoopHudStatus } from \"../../state/coop.js\";\n\nconst COOP_SETTINGS = {\n  maxParticipants: 100,\n  spawnInterval: 0.25,\n  spawnBatchSize: 12,\n  orbitRadius: 420,\n  orbitVariance: 260,\n  bobHeight: 46,\n  speedMin: 0.4,\n  speedMax: 1.1\n};\n\nconst simulatedParticipants = new Map();\nlet spawnTimer = 0;\nlet statsTimer = 0;\nlet packetCounter = 0;\n\nconst standingHeight = getTotalHeight(POSES.standing);\nconst baseY = GROUND_Y - standingHeight;\n\nfunction createSimulatedParticipant(index) {\n  const id = `coop-${index}-${Math.random().toString(36).slice(2, 8)}`;\n  const radius = COOP_SETTINGS.orbitRadius + Math.random() * COOP_SETTINGS.orbitVariance;\n  const angle = Math.random() * Math.PI * 2;\n  const speed = COOP_SETTINGS.speedMin + Math.random() * (COOP_SETTINGS.speedMax - COOP_SETTINGS.speedMin);\n  const latency = 30 + Math.random() * 110;\n  return {\n    id,\n    name: `Agent ${index + 1}`,\n    angle,\n    radius,\n    speed,\n    latency,\n    latencyTarget: latency,\n    latencyTimer: 1 + Math.random() * 2,\n    x: stickman.x + Math.cos(angle) * radius,\n    y: baseY,\n    jitter: Math.random() * Math.PI * 2\n  };\n}\n\nfunction ensureSimulatedParticipants(delta) {\n  const maxParticipants = COOP_SETTINGS.maxParticipants;\n  if (simulatedParticipants.size >= maxParticipants) {\n    return;\n  }\n  spawnTimer += delta;\n  if (spawnTimer < COOP_SETTINGS.spawnInterval) {\n    return;\n  }\n  spawnTimer = 0;\n  const batch = Math.min(COOP_SETTINGS.spawnBatchSize, maxParticipants - simulatedParticipants.size);\n  for (let i = 0; i < batch; i += 1) {\n    const index = simulatedParticipants.size;\n    const participant = createSimulatedParticipant(index);\n    simulatedParticipants.set(participant.id, participant);\n  }\n}\n\nfunction updateParticipant(participant, delta, width) {\n  participant.angle = (participant.angle + participant.speed * delta) % (Math.PI * 2);\n  const orbitX = stickman.x + Math.cos(participant.angle) * participant.radius;\n  const clampMargin = 120;\n  const minX = clampMargin;\n  const maxX = Math.max(clampMargin, width - clampMargin);\n  participant.x = Math.min(maxX, Math.max(minX, orbitX));\n  const bobOffset = Math.sin(participant.angle * 2 + participant.jitter) * COOP_SETTINGS.bobHeight;\n  participant.y = baseY + bobOffset;\n\n  participant.latencyTimer -= delta;\n  if (participant.latencyTimer <= 0) {\n    participant.latencyTarget = 24 + Math.random() * 160;\n    participant.latencyTimer = 1.5 + Math.random() * 2.5;\n  }\n  const latencyDelta = participant.latencyTarget - participant.latency;\n  participant.latency += latencyDelta * Math.min(1, delta * 0.6);\n\n  const facing = participant.x >= stickman.x ? 1 : -1;\n  upsertRemotePlayer({\n    id: participant.id,\n    name: participant.name,\n    x: participant.x,\n    y: participant.y,\n    facing,\n    commandId: \"support\"\n  });\n  packetCounter += 1;\n  return participant.latency;\n}\n\nfunction removeSimulatedParticipants() {\n  for (const id of simulatedParticipants.keys()) {\n    remotePlayers.delete(id);\n  }\n  simulatedParticipants.clear();\n}\n\nfunction activateMassiveCoop() {\n  activateCoop(COOP_SETTINGS.maxParticipants);\n  setCoopOutcome(\"active\");\n  spawnTimer = 0;\n  statsTimer = 0;\n  packetCounter = 0;\n  removeSimulatedParticipants();\n  resetSurvival();\n  deactivateSandboxSkirmish(\"coop\");\n}\n\nfunction deactivateMassiveCoop(outcome = \"inactive\") {\n  deactivateCoop(outcome);\n  removeSimulatedParticipants();\n  spawnTimer = 0;\n  statsTimer = 0;\n  packetCounter = 0;\n}\n\nfunction updateMassiveCoop(delta) {\n  if (input.coopToggleBuffered) {\n    input.coopToggleBuffered = false;\n    const hud = getCoopHudStatus();\n    if (hud?.active) {\n      deactivateMassiveCoop(\"aborted\");\n    } else {\n      activateMassiveCoop();\n    }\n  }\n\n  const hud = getCoopHudStatus();\n  if (!hud?.active) {\n    return;\n  }\n\n  ensureSimulatedParticipants(delta);\n\n  const envWidth = getEnvironmentWidth();\n  let latencySum = 0;\n  let latencyCount = 0;\n  for (const participant of simulatedParticipants.values()) {\n    latencySum += updateParticipant(participant, delta, envWidth);\n    latencyCount += 1;\n  }\n\n  setCoopParticipants(simulatedParticipants.size + 1, COOP_SETTINGS.maxParticipants);\n\n  statsTimer += delta;\n  if (statsTimer >= 1) {\n    const packetsPerSecond = packetCounter / statsTimer;\n    const averageLatency = latencyCount > 0 ? latencySum / latencyCount : 0;\n    setCoopMetrics({ packetsPerSecond, averageLatency });\n    packetCounter = 0;\n    statsTimer = 0;\n  }\n}\n\nexport { updateMassiveCoop, deactivateMassiveCoop };\r\n","import { GRAVITY } from \"../../config/constants.js\";\r\nimport { canvas, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { getEnvironmentWidth } from \"../../state/environment.js\";\r\nimport { stickman, enemies } from \"../../state/entities.js\";\r\nimport { resolvePlatformLanding } from \"./arena.js\";\r\nimport { applyDamageToPlayer } from \"../combat/damageHandlers.js\";\r\n\r\nfunction updateEnemyAI(enemy, delta) {\r\n  enemy.invulnerability = Math.max(0, enemy.invulnerability - delta);\r\n  enemy.attackCooldown = Math.max(0, enemy.attackCooldown - delta);\r\n  enemy.stunTimer = Math.max(0, (enemy.stunTimer ?? 0) - delta);\r\n  enemy.smokeSlowTimer = Math.max(0, (enemy.smokeSlowTimer ?? 0) - delta);\r\n  if (enemy.smokeSlowTimer <= 0) {\r\n    enemy.smokeSlowStrength = 1;\r\n  }\r\n\r\n  if (enemy.flashTimer > 0) {\r\n    enemy.flashTimer = Math.max(0, enemy.flashTimer - delta);\r\n  }\r\n\r\n  if (enemy.shakeTimer > 0) {\r\n    enemy.shakeTimer = Math.max(0, enemy.shakeTimer - delta);\r\n  }\r\n\r\n  enemy.shakeMagnitude = Math.max(0, enemy.shakeMagnitude - delta * 20);\r\n\r\n  if (enemy.health <= 0) {\r\n    enemy.respawnTimer = Math.max(0, enemy.respawnTimer - delta);\r\n    if (enemy.respawnTimer === 0) {\r\n      enemy.health = enemy.maxHealth;\r\n      enemy.x = enemy.spawnX;\r\n      enemy.y = enemy.spawnY;\r\n      enemy.vx = 0;\r\n      enemy.vy = 0;\r\n      enemy.state = \"patrol\";\r\n      enemy.stateTimer = 1 + Math.random();\r\n      enemy.attackCooldown = 0.6;\r\n      enemy.onGround = true;\r\n      enemy.stunTimer = 0;\r\n      enemy.smokeSlowTimer = 0;\r\n      enemy.smokeSlowStrength = 1;\r\n    }\r\n    return;\r\n  }\r\n\r\n  const targetX = stickman.x;\r\n  const distanceX = targetX - enemy.x;\r\n  const absDistance = Math.abs(distanceX);\r\n  enemy.facing = distanceX >= 0 ? 1 : -1;\r\n\r\n  const stunned = enemy.stunTimer > 0;\r\n  const slowMultiplier = enemy.smokeSlowTimer > 0 ? Math.max(0.2, Math.min(1, enemy.smokeSlowStrength ?? 1)) : 1;\r\n  const moveSpeed = enemy.moveSpeed * slowMultiplier;\r\n  const effectiveAggression = enemy.aggressionRange * (enemy.smokeSlowTimer > 0 ? 0.85 : 1);\r\n  const disengageDistance = effectiveAggression * 1.8;\r\n  const shouldChase = !stunned && absDistance < effectiveAggression;\r\n\r\n  if (absDistance > disengageDistance) {\r\n    enemy.vx = 0;\r\n    enemy.state = \"idle\";\r\n    return;\r\n  }\r\n\r\n  if (stunned) {\r\n    enemy.state = \"stunned\";\r\n    enemy.vx = 0;\r\n    enemy.attackWindup = 0;\r\n    enemy.attackActive = 0;\r\n    enemy.stateTimer = Math.max(enemy.stateTimer, enemy.stunTimer);\r\n    enemy.attackCooldown = Math.max(enemy.attackCooldown, enemy.stunTimer + 0.2);\r\n  } else if (enemy.state === \"stunned\") {\r\n    enemy.state = \"idle\";\r\n    enemy.stateTimer = 0.6;\r\n  }\r\n\r\n  if (!stunned) {\r\n  switch (enemy.state) {\r\n    case \"idle\":\r\n      enemy.vx = 0;\r\n      enemy.stateTimer -= delta;\r\n      if (enemy.stateTimer <= 0) {\r\n        enemy.state = \"patrol\";\r\n        enemy.stateTimer = 1.2 + Math.random();\r\n        enemy.facing = Math.random() < 0.5 ? -1 : 1;\r\n      }\r\n      if (shouldChase) {\r\n        enemy.state = \"chase\";\r\n      }\r\n      break;\r\n    case \"patrol\":\r\n      enemy.vx = moveSpeed * enemy.facing;\r\n      if (enemy.x <= enemy.patrolRange.min) {\r\n        enemy.facing = 1;\r\n      } else if (enemy.x >= enemy.patrolRange.max) {\r\n        enemy.facing = -1;\r\n      }\r\n      enemy.stateTimer -= delta;\r\n      if (enemy.stateTimer <= 0) {\r\n        enemy.state = \"idle\";\r\n        enemy.stateTimer = 1 + Math.random();\r\n        enemy.vx = 0;\r\n      }\r\n      if (shouldChase) {\r\n        enemy.state = \"chase\";\r\n      }\r\n      break;\r\n    case \"chase\":\r\n      if (!shouldChase) {\r\n        enemy.state = \"patrol\";\r\n        break;\r\n      }\r\n      const chaseDir = distanceX >= 0 ? 1 : -1;\r\n      enemy.vx = moveSpeed * chaseDir;\r\n      if (absDistance <= enemy.attackRange && enemy.attackCooldown <= 0) {\r\n        enemy.state = \"attack-windup\";\r\n        enemy.attackWindup = 0.35;\r\n        enemy.attackActive = 0.16;\r\n        enemy.vx = 0;\r\n      }\r\n      break;\r\n    case \"attack-windup\":\r\n      enemy.vx = 0;\r\n      enemy.attackWindup -= delta;\r\n      if (enemy.attackWindup <= 0) {\r\n        enemy.state = \"attack-active\";\r\n        enemy.attackActive = 0.16;\r\n      }\r\n      break;\r\n    case \"attack-active\":\r\n      enemy.vx = moveSpeed * 0.35 * enemy.facing;\r\n      enemy.attackActive -= delta;\r\n      if (enemy.attackActive <= 0) {\r\n        enemy.state = \"recover\";\r\n        enemy.stateTimer = 0.4;\r\n        enemy.attackCooldown = 1.2;\r\n      }\r\n      break;\r\n    case \"recover\":\r\n      enemy.vx = 0;\r\n      enemy.stateTimer -= delta;\r\n      if (enemy.stateTimer <= 0) {\r\n        enemy.state = shouldChase ? \"chase\" : \"idle\";\r\n        enemy.stateTimer = 0.9 + Math.random() * 0.4;\r\n      }\r\n      break;\r\n    default:\r\n      enemy.vx = 0;\r\n      break;\r\n  }\r\n  }\r\n\r\n  const previousY = enemy.y;\r\n  enemy.vy += GRAVITY * delta;\r\n  enemy.x += enemy.vx * delta;\r\n  enemy.y += enemy.vy * delta;\r\n  enemy.onGround = false;\r\n\r\n  const landed = resolvePlatformLanding(enemy, previousY, enemy.height);\r\n  if (!landed && enemy.y + enemy.height >= GROUND_Y) {\r\n    enemy.y = GROUND_Y - enemy.height;\r\n    enemy.vy = 0;\r\n    enemy.onGround = true;\r\n  }\r\n\r\n  const envWidth = getEnvironmentWidth();\r\n  enemy.x = Math.max(60, Math.min(envWidth - 60, enemy.x));\r\n}\r\n\r\nfunction updateEnemyAttacks(enemy) {\r\n  if (enemy.health <= 0) {\r\n    return;\r\n  }\r\n  if (enemy.state !== \"attack-active\") {\r\n    return;\r\n  }\r\n\r\n  const attackReach = enemy.attackRange + enemy.radius;\r\n  const dx = stickman.x - enemy.x;\r\n  const dy = stickman.y - enemy.y;\r\n  const distanceSq = dx * dx + dy * dy;\r\n  if (distanceSq <= attackReach * attackReach) {\r\n    applyDamageToPlayer(enemy);\r\n  }\r\n}\r\n\r\nfunction updateEnemies(delta) {\r\n  for (const enemy of enemies) {\r\n    updateEnemyAI(enemy, delta);\r\n  }\r\n  for (const enemy of enemies) {\r\n    updateEnemyAttacks(enemy);\r\n  }\r\n}\r\n\r\nexport { updateEnemyAI, updateEnemyAttacks, updateEnemies };\r\n\r\n\r\n\r\n\r\n","import { NETWORK_CONFIG } from \"../../config/network.js\";\r\nimport { getP2P } from \"./p2p.js\";\r\nimport {\r\n  getServerBrowserState,\r\n  setVisible,\r\n  toggleVisible,\r\n  setServers,\r\n  setError,\r\n  setStatusMessage,\r\n  setJoinStatus,\r\n  setJoinError,\r\n  setJoinedSessionId,\r\n  selectNext,\r\n  recordFetchTimestamp,\r\n  setFetching,\r\n  setHostingSession,\r\n  setHostingMetrics,\r\n  updateHostingHeartbeatTimestamp,\r\n  clearHosting,\r\n  clearP2PState,\r\n  setP2POffer,\r\n  setP2PAnswer,\r\n  setP2PLocalCandidates,\r\n  setP2PRemoteCandidates,\r\n  setP2PPending,\r\n  setP2PError\r\n} from \"../../state/serverBrowser.js\";\r\nconst CANDIDATE_PUSH_MIN_INTERVAL_MS = 1000;\r\n\r\nlet lastHostCandidatePushAt = 0;\r\nlet lastJoinCandidatePushAt = 0;\r\nlet lastSentHostCandidates = [];\r\nlet lastSentJoinCandidates = [];\r\nlet pendingHostCandidateTimeout = null;\r\nlet pendingJoinCandidateTimeout = null;\r\nlet pendingJoinCandidatePayload = null;\r\n\r\n\r\nfunction getApiBase() {\r\n  return (NETWORK_CONFIG.serverApiBase ?? \"\").replace(/\\/$/, \"\");\r\n}\r\n\r\nfunction getHostSecret() {\r\n  return NETWORK_CONFIG.hostSecret ?? \"\";\r\n}\r\n\r\nfunction getSessionId() {\r\n  if (typeof crypto !== \"undefined\" && crypto.randomUUID) {\r\n    return crypto.randomUUID();\r\n  }\r\n  return `session-${Math.random().toString(36).slice(2, 10)}`;\r\n}\r\n\r\nfunction sanitizeSignal(raw) {\r\n  if (typeof raw !== \"string\") {\r\n    return \"\";\r\n  }\r\n  return raw.trim();\r\n}\r\n\r\nasync function copyToClipboard(text) {\r\n  if (!text || typeof navigator === \"undefined\" || !navigator.clipboard?.writeText) {\r\n    return false;\r\n  }\r\n  try {\r\n    await navigator.clipboard.writeText(text);\r\n    return true;\r\n  } catch (error) {\r\n    console.warn(\"Clipboard write failed\", error);\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction normalizeCandidate(candidate) {\r\n  if (typeof candidate === \"string\") {\r\n    return sanitizeSignal(candidate);\r\n  }\r\n  if (candidate && typeof candidate === \"object\") {\r\n    try {\r\n      return sanitizeSignal(JSON.stringify(candidate));\r\n    } catch {\r\n      return \"\";\r\n    }\r\n  }\r\n  return \"\";\r\n}\r\n\r\nfunction normalizeCandidateList(list) {\r\n  if (!Array.isArray(list)) {\r\n    return [];\r\n  }\r\n  return list\r\n    .map((candidate) => normalizeCandidate(candidate))\r\n    .filter((candidate) => candidate.length > 0);\r\n}\r\n\r\nfunction arraysEqual(a = [], b = []) {\r\n  if (a.length !== b.length) {\r\n    return false;\r\n  }\r\n  for (let index = 0; index < a.length; index += 1) {\r\n    if (a[index] !== b[index]) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction mapServerEntry(server) {\r\n  if (!server || typeof server !== \"object\") {\r\n    return null;\r\n  }\r\n  const metadata = server.metadata ?? {};\r\n  return {\r\n    id: server.id,\r\n    name: server.name ?? server.id,\r\n    map: server.map ?? metadata.map ?? \"Unknown\",\r\n    players: metadata.playerCount ?? server.playerCount ?? server.players ?? 0,\r\n    maxPlayers: server.maxPlayers ?? metadata.maxPlayers ?? 0,\r\n    region: server.region ?? metadata.region ?? \"--\",\r\n    mode: server.mode ?? metadata.mode ?? \"\",\r\n    enemyCount: metadata.enemyCount ?? null,\r\n    alliesCount: metadata.alliesCount ?? null,\r\n    updatedAt: server.updatedAt ?? null,\r\n    signal: {\r\n      hostOffer: server.signal?.hostOffer ?? null,\r\n      hostCandidates: Array.isArray(server.signal?.hostCandidates) ? server.signal.hostCandidates.slice() : [],\r\n      joinAnswer: server.signal?.joinAnswer ?? null,\r\n      joinCandidates: Array.isArray(server.signal?.joinCandidates) ? server.signal.joinCandidates.slice() : []\r\n    }\r\n  };\r\n}\r\n\r\nfunction cacheUpdatedSession(server) {\r\n  const mapped = mapServerEntry(server);\r\n  if (!mapped) {\r\n    return;\r\n  }\r\n  const state = getServerBrowserState();\r\n  const index = state.servers.findIndex((entry) => entry.id === mapped.id);\r\n  if (index >= 0) {\r\n    state.servers[index] = mapped;\r\n  } else {\r\n    state.servers.push(mapped);\r\n  }\r\n}\r\n\r\nfunction resetCandidateTracking() {\r\n  lastSentHostCandidates = [];\r\n  lastSentJoinCandidates = [];\r\n  lastHostCandidatePushAt = 0;\r\n  lastJoinCandidatePushAt = 0;\r\n  if (pendingHostCandidateTimeout) {\r\n    clearTimeout(pendingHostCandidateTimeout);\r\n    pendingHostCandidateTimeout = null;\r\n  }\r\n  if (pendingJoinCandidateTimeout) {\r\n    clearTimeout(pendingJoinCandidateTimeout);\r\n    pendingJoinCandidateTimeout = null;\r\n  }\r\n  pendingJoinCandidatePayload = null;\r\n}\r\n\r\nfunction scheduleHostCandidatePush() {\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting || !state.hostingSessionId) {\r\n    return;\r\n  }\r\n  const now = Date.now();\r\n  const delay = Math.max(0, CANDIDATE_PUSH_MIN_INTERVAL_MS - (now - lastHostCandidatePushAt));\r\n  if (delay > 0) {\r\n    if (!pendingHostCandidateTimeout) {\r\n      pendingHostCandidateTimeout = setTimeout(() => {\r\n        pendingHostCandidateTimeout = null;\r\n        pushHostCandidatesNow();\r\n      }, delay);\r\n    }\r\n    return;\r\n  }\r\n  pushHostCandidatesNow();\r\n}\r\n\r\nfunction pushHostCandidatesNow() {\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting || !state.hostingSessionId) {\r\n    return;\r\n  }\r\n  lastHostCandidatePushAt = Date.now();\r\n  heartbeatSession().catch((error) => console.warn(\"[serverBrowser] heartbeat update failed\", error));\r\n}\r\n\r\nfunction scheduleJoinerCandidatePush(candidates) {\r\n  const state = getServerBrowserState();\r\n  if (!state.joinedSessionId || !Array.isArray(candidates) || candidates.length === 0) {\r\n    return;\r\n  }\r\n  const now = Date.now();\r\n  const delay = Math.max(0, CANDIDATE_PUSH_MIN_INTERVAL_MS - (now - lastJoinCandidatePushAt));\r\n  if (delay > 0) {\r\n    pendingJoinCandidatePayload = candidates.slice();\r\n    if (!pendingJoinCandidateTimeout) {\r\n      pendingJoinCandidateTimeout = setTimeout(() => {\r\n        const payload = pendingJoinCandidatePayload;\r\n        pendingJoinCandidateTimeout = null;\r\n        pendingJoinCandidatePayload = null;\r\n        pushJoinerCandidatesNow(payload);\r\n      }, delay);\r\n    }\r\n    return;\r\n  }\r\n  pushJoinerCandidatesNow(candidates);\r\n}\r\n\r\nfunction pushJoinerCandidatesNow(candidates) {\r\n  const state = getServerBrowserState();\r\n  if (!state.joinedSessionId || !Array.isArray(candidates) || candidates.length === 0) {\r\n    return;\r\n  }\r\n  lastJoinCandidatePushAt = Date.now();\r\n  postJoinerUpdate(state.joinedSessionId, { signalCandidates: candidates }).catch((error) => {\r\n    console.warn(\"[serverBrowser] failed to publish joiner candidates\", error);\r\n  });\r\n}\r\n\r\nfunction handleLocalCandidateUpdate(candidates) {\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting) {\r\n    lastSentHostCandidates = [];\r\n  }\r\n  if (!state.joinedSessionId) {\r\n    lastSentJoinCandidates = [];\r\n  }\r\n  if (!Array.isArray(candidates) || candidates.length === 0) {\r\n    if (!state.hosting && !state.joinedSessionId) {\r\n      resetCandidateTracking();\r\n      setJoinedSessionId(null);\r\n    }\r\n    return;\r\n  }\r\n  if (state.hosting && state.hostingSessionId && !arraysEqual(lastSentHostCandidates, candidates)) {\r\n    lastSentHostCandidates = candidates.slice();\r\n    scheduleHostCandidatePush();\r\n  }\r\n  if (state.joinedSessionId && !arraysEqual(lastSentJoinCandidates, candidates)) {\r\n    lastSentJoinCandidates = candidates.slice();\r\n    scheduleJoinerCandidatePush(candidates.slice());\r\n  }\r\n}\r\n\r\nasync function fetchSessionDetail(serverId) {\r\n  const apiBase = getApiBase();\r\n  if (!apiBase) {\r\n    throw new Error(\"Server API base not configured\");\r\n  }\r\n  console.debug(`[serverBrowser] fetching session detail for ${serverId}`);\r\n  const response = await fetch(`${apiBase}/sessions/${serverId}`);\r\n  if (response.status === 404) {\r\n    console.warn(`[serverBrowser] session ${serverId} no longer exists (404)`);\r\n    return { notFound: true };\r\n  }\r\n  if (!response.ok) {\r\n    console.warn(`[serverBrowser] session detail request failed ${response.status} for ${serverId}`);\r\n    throw new Error(`Session lookup failed (HTTP ${response.status})`);\r\n  }\r\n  const payload = await response.json();\r\n  console.debug(`[serverBrowser] received session detail for ${serverId}`);\r\n  return payload;\r\n}\r\n\r\nfunction syncLocalCandidates() {\r\n  const state = getServerBrowserState();\r\n  let p2p;\r\n  try {\r\n    p2p = getP2P();\r\n  } catch {\r\n    if ((state.p2p?.localCandidates ?? []).length > 0) {\r\n      setP2PLocalCandidates([]);\r\n      handleLocalCandidateUpdate([]);\r\n    }\r\n    return [];\r\n  }\r\n  if (!p2p?.getLocalCandidates) {\r\n    if ((state.p2p?.localCandidates ?? []).length > 0) {\r\n      setP2PLocalCandidates([]);\r\n      handleLocalCandidateUpdate([]);\r\n    }\r\n    return [];\r\n  }\r\n  const previous = Array.isArray(state.p2p?.localCandidates) ? state.p2p.localCandidates.slice() : [];\r\n  const normalized = normalizeCandidateList(p2p.getLocalCandidates() ?? []);\r\n  if (!arraysEqual(previous, normalized)) {\r\n    setP2PLocalCandidates(normalized);\r\n    handleLocalCandidateUpdate(normalized);\r\n  }\r\n  return normalized;\r\n}\r\n\r\n\r\nfunction parseCandidateInput(rawInput) {\r\n  const sanitized = sanitizeSignal(rawInput);\r\n  if (!sanitized) {\r\n    return [];\r\n  }\r\n  try {\r\n    const parsed = JSON.parse(sanitized);\r\n    if (Array.isArray(parsed)) {\r\n      return normalizeCandidateList(parsed);\r\n    }\r\n    if (parsed && typeof parsed === \"object\") {\r\n      return normalizeCandidateList([parsed]);\r\n    }\r\n    if (typeof parsed === \"string\") {\r\n      return normalizeCandidateList([parsed]);\r\n    }\r\n  } catch {\r\n    // fall through to newline parsing\r\n  }\r\n  const segments = sanitized\r\n    .split(/\\r?\\n+/)\r\n    .map((segment) => segment.trim())\r\n    .filter((segment) => segment.length > 0);\r\n  return normalizeCandidateList(segments);\r\n}\r\n\r\nasync function copyLocalCandidates({ silent = false } = {}) {\r\n  try {\r\n    setP2PPending({ candidates: true });\r\n    const candidates = syncLocalCandidates();\r\n    if (candidates.length === 0) {\r\n      if (!silent) {\r\n        setStatusMessage(\"No ICE candidates yet. Wait a moment after generating offer/answer.\");\r\n      }\r\n      return { copied: false, count: 0 };\r\n    }\r\n    const payload = candidates.join(\"\\n\");\r\n    const copied = await copyToClipboard(payload);\r\n    if (!silent) {\r\n      if (copied) {\r\n        setStatusMessage(`Copied ${candidates.length} ICE candidate${candidates.length === 1 ? \"\" : \"s\"}.`);\r\n      } else {\r\n        setStatusMessage(\"Candidates ready. Copy manually if clipboard access is blocked.\");\r\n      }\r\n    }\r\n    return { copied, count: candidates.length, payload };\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to copy ICE candidates\";\r\n    setP2PError(message);\r\n    throw error;\r\n  } finally {\r\n    setP2PPending({ candidates: false });\r\n  }\r\n}\r\n\r\nfunction mergeCandidates(existing, incoming) {\r\n  const merged = [...existing, ...incoming];\r\n  const seen = new Set();\r\n  const unique = [];\r\n  for (const candidate of merged) {\r\n    if (!seen.has(candidate)) {\r\n      seen.add(candidate);\r\n      unique.push(candidate);\r\n    }\r\n  }\r\n  return unique;\r\n}\r\n\r\nasync function promptForRemoteCandidates() {\r\n  if (typeof window === \"undefined\" || typeof window.prompt !== \"function\") {\r\n    throw new Error(\"Prompts unavailable in this environment\");\r\n  }\r\n  const state = getServerBrowserState();\r\n  const existing = (state.p2p.remoteCandidates ?? []).join(\"\\n\");\r\n  const input = window.prompt(\"Paste remote ICE candidates (JSON array or newline separated)\", existing);\r\n  if (input == null) {\r\n    setStatusMessage(\"Candidate entry cancelled.\");\r\n    return null;\r\n  }\r\n  const candidates = parseCandidateInput(input);\r\n  if (candidates.length === 0) {\r\n    setStatusMessage(\"No valid ICE candidates detected.\");\r\n    throw new Error(\"No ICE candidates provided\");\r\n  }\r\n  const p2p = getP2POrThrow();\r\n  setP2PError(null);\r\n  setP2PPending({ candidates: true });\r\n  try {\r\n    for (const candidate of candidates) {\r\n      await p2p.addRemoteCandidate(candidate);\r\n    }\r\n    const merged = mergeCandidates(state.p2p.remoteCandidates ?? [], candidates);\r\n    setP2PRemoteCandidates(merged);\r\n    setStatusMessage(`Applied ${candidates.length} ICE candidate${candidates.length === 1 ? \"\" : \"s\"}.`);\r\n    return candidates;\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to apply ICE candidates\";\r\n    setP2PError(message);\r\n    throw error;\r\n  } finally {\r\n    setP2PPending({ candidates: false });\r\n  }\r\n}function getP2POrThrow() {\r\n  try {\r\n    return getP2P();\r\n  } catch (error) {\r\n    const message = error?.message ?? \"P2P subsystem unavailable\";\r\n    setP2PError(message);\r\n    throw error;\r\n  }\r\n}\r\n\r\nfunction buildHostingMetadata(metrics, fallbackPlayerCount) {\r\n  const playerCount = metrics?.playerCount ?? fallbackPlayerCount;\r\n  return {\r\n    playerCount,\r\n    enemyCount: metrics?.enemyCount ?? 0,\r\n    alliesCount: metrics?.alliesCount ?? Math.max(0, playerCount - 1)\r\n  };\r\n}\r\n\r\nasync function fetchServerList({ silent = false } = {}) {\r\n  const apiBase = getApiBase();\r\n  if (!apiBase) {\r\n    setError(\"Server list URL not configured\");\r\n    setServers([]);\r\n    return;\r\n  }\r\n  setFetching(true);\r\n  if (!silent) {\r\n    setStatusMessage(\"Fetching server list...\");\r\n  }\r\n  try {\r\n    const response = await fetch(`${apiBase}/sessions`, {\r\n      headers: { Accept: \"application/json\" }\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}`);\r\n    }\r\n    const data = await response.json();\r\n    const servers = Array.isArray(data) ? data : Array.isArray(data?.servers) ? data.servers : [];\r\n    const mappedServers = servers\r\n      .map((server) => mapServerEntry(server))\r\n      .filter(Boolean);\r\n    const staleThresholdMs = Math.max(30_000, Math.round((NETWORK_CONFIG.hostTtlSeconds ?? 150) * 1000 * 1.1));\r\n    const now = Date.now();\r\n    const filteredServers = mappedServers.filter((server) => {\r\n      if (!server.updatedAt) {\r\n        return true;\r\n      }\r\n      const updatedAtMs = Date.parse(server.updatedAt);\r\n      if (Number.isNaN(updatedAtMs)) {\r\n        return true;\r\n      }\r\n      return now - updatedAtMs <= staleThresholdMs;\r\n    });\r\n    setServers(filteredServers);\r\n    setError(null);\r\n    if (!silent) {\r\n      setStatusMessage(filteredServers.length === 0 ? \"No active sessions.\" : \"Fetched session list.\");\r\n    }\r\n  } catch (error) {\r\n    setServers([]);\r\n    setError(`Failed to fetch servers: ${error.message}`);\r\n    if (!silent) {\r\n      setStatusMessage(\"Unable to reach session service.\");\r\n    }\r\n  } finally {\r\n    setFetching(false);\r\n  }\r\n}\r\n\r\nasync function hostSession({\r\n  id = getSessionId(),\r\n  name = NETWORK_CONFIG.hostName ?? \"Stickman Lobby\",\r\n  region = NETWORK_CONFIG.defaultRegion ?? \"na\",\r\n  map = \"Neo District\",\r\n  playerCount = 1,\r\n  maxPlayers = 4,\r\n  mode = \"freeplay\",\r\n  signal = null\r\n} = {}) {\r\n  const apiBase = getApiBase();\r\n  const secret = getHostSecret();\r\n  if (!apiBase) {\r\n    throw new Error(\"Server API base not configured\");\r\n  }\r\n  if (!secret) {\r\n    throw new Error(\"Host secret not provided\");\r\n  }\r\n  const state = getServerBrowserState();\r\n  const metrics = state.hostingMetrics ?? {};\r\n  const ttlSeconds = NETWORK_CONFIG.hostTtlSeconds ?? 150;\r\n  const computedPlayerCount = metrics.playerCount ?? playerCount;\r\n  const effectiveSignal = signal ?? {\r\n    hostOffer: state.p2p.offer ?? null,\r\n    hostCandidates: state.p2p.localCandidates ?? []\r\n  };\r\n  const response = await fetch(`${apiBase}/sessions`, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      \"x-session-secret\": secret\r\n    },\r\n    body: JSON.stringify({\r\n      id,\r\n      name,\r\n      region,\r\n      map,\r\n      mode,\r\n      playerCount: computedPlayerCount,\r\n      maxPlayers,\r\n      ttlSeconds,\r\n      metadata: buildHostingMetadata(metrics, computedPlayerCount),\r\n      signal: {\r\n        hostOffer: effectiveSignal.hostOffer ?? null,\r\n        hostCandidates: Array.isArray(effectiveSignal.hostCandidates) ? effectiveSignal.hostCandidates : []\r\n      }\r\n    })\r\n  });\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to host session (HTTP ${response.status})`);\r\n  }\r\n  const payload = await response.json();\r\n  setP2PLocalCandidates(Array.isArray(effectiveSignal.hostCandidates) ? effectiveSignal.hostCandidates : []);\r\n  setHostingSession({ id, expiresAt: Date.now() + (payload?.ttlSeconds ?? ttlSeconds) * 1000 });\r\n  setStatusMessage(`Hosting ${name}`);\r\n  return { id, ttlSeconds: payload?.ttlSeconds ?? ttlSeconds };\r\n}\r\n\r\nasync function heartbeatSession() {\r\n  const apiBase = getApiBase();\r\n  const secret = getHostSecret();\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting || !state.hostingSessionId || !apiBase || !secret) {\r\n    return;\r\n  }\r\n  const metrics = state.hostingMetrics ?? {};\r\n  const computedPlayerCount = metrics.playerCount ?? 1;\r\n  try {\r\n    const response = await fetch(`${apiBase}/sessions/${state.hostingSessionId}/heartbeat`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"x-session-secret\": secret\r\n      },\r\n      body: JSON.stringify({\r\n        playerCount: computedPlayerCount,\r\n        ttlSeconds: NETWORK_CONFIG.hostTtlSeconds ?? 150,\r\n        metadata: buildHostingMetadata(metrics, computedPlayerCount),\r\n        signal: {\r\n          hostOffer: state.p2p.offer ?? null,\r\n          hostCandidates: Array.isArray(state.p2p.localCandidates) ? state.p2p.localCandidates : []\r\n        }\r\n      })\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}`);\r\n    }\r\n    const payload = await response.json();\r\n    updateHostingHeartbeatTimestamp(performance.now());\r\n    if (payload?.ttlSeconds) {\r\n      setHostingSession({ id: state.hostingSessionId, expiresAt: Date.now() + payload.ttlSeconds * 1000 });\r\n    }\r\n  } catch (error) {\r\n    console.warn(\"Heartbeat failed\", error);\r\n    setStatusMessage(\"Heartbeat failed; hosting paused.\");\r\n    clearHosting();\r\n    resetCandidateTracking();\r\n  }\r\n}\r\n\r\nasync function stopHosting() {\r\n  const apiBase = getApiBase();\r\n  const secret = getHostSecret();\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting || !state.hostingSessionId || !apiBase || !secret) {\r\n    clearHosting();\r\n    resetCandidateTracking();\r\n    return;\r\n  }\r\n  try {\r\n    await fetch(`${apiBase}/sessions/${state.hostingSessionId}`, {\r\n      method: \"DELETE\",\r\n      headers: {\r\n        \"x-session-secret\": secret\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.warn(\"Failed to stop hosting\", error);\r\n  } finally {\r\n    clearHosting();\r\n    resetCandidateTracking();\r\n  }\r\n}\r\n\r\nasync function joinServer(serverId, payload = {}) {\r\n  const apiBase = getApiBase();\r\n  if (!apiBase) {\r\n    throw new Error(\"Server API base not configured\");\r\n  }\r\n  setJoinStatus(\"Contacting host...\");\r\n  setJoinError(null);\r\n  const url = `${apiBase}/sessions/${serverId}/join`;\r\n  const response = await fetch(url, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\"\r\n    },\r\n    body: JSON.stringify(payload)\r\n  });\r\n  if (!response.ok) {\r\n    const message = `Join failed (HTTP ${response.status})`;\r\n    setJoinStatus(null);\r\n    setJoinError(message);\r\n    throw new Error(message);\r\n  }\r\n  const result = await response.json();\r\n  const joinedName = result?.session?.name ?? serverId;\r\n  clearP2PState();\r\n  resetCandidateTracking();\r\n  cacheUpdatedSession(result?.session);\r\n  setJoinStatus(`Joined ${joinedName}`);\r\n  setStatusMessage(\"Joined lobby. Establishing connection...\");\r\n  return result;\r\n}\r\n\r\n\r\nasync function postJoinerUpdate(sessionId, payload = {}) {\r\n  const apiBase = getApiBase();\r\n  if (!apiBase || !sessionId) {\r\n    return;\r\n  }\r\n  if (!payload || Object.keys(payload).length === 0) {\r\n    return;\r\n  }\r\n  try {\r\n    const response = await fetch(`${apiBase}/sessions/${sessionId}/join`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify(payload)\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}`);\r\n    }\r\n    const result = await response.json();\r\n    if (result?.session) {\r\n      cacheUpdatedSession(result.session);\r\n      if (Array.isArray(result.session.signal?.hostCandidates) && result.session.signal.hostCandidates.length > 0) {\r\n        applyRemoteCandidates(result.session.signal.hostCandidates);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.warn(`[serverBrowser] joiner update failed for ${sessionId}`, error);\r\n  }\r\n}\r\n\r\n\r\nfunction showServerBrowser() {\r\n  setVisible(true);\r\n  recordFetchTimestamp(0);\r\n  fetchServerList();\r\n}\r\n\r\nfunction hideServerBrowser() {\r\n  setVisible(false);\r\n}\r\n\r\nfunction updateServerBrowser(delta, timestamp) {\r\n  const state = getServerBrowserState();\r\n  pumpSignalUpdates();\r\n  syncLocalCandidates();\r\n\r\n  const baseInterval = NETWORK_CONFIG.refreshIntervalMs ?? 10000;\r\n  const backgroundInterval = Math.min(baseInterval, 3000);\r\n  const refreshInterval = state.visible ? baseInterval : backgroundInterval;\r\n  const shouldPoll = state.visible || state.hosting || Boolean(state.joinedSessionId);\r\n  if (shouldPoll && timestamp - state.lastFetch >= refreshInterval && !state.fetching) {\r\n    recordFetchTimestamp(timestamp);\r\n    fetchServerList({ silent: !state.visible });\r\n  }\r\n\r\n  if (!state.visible) {\r\n    if (state.hosting) {\r\n      const interval = NETWORK_CONFIG.heartbeatIntervalMs ?? 45000;\r\n      if (timestamp - state.hostingLastHeartbeat >= interval) {\r\n        heartbeatSession();\r\n      }\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (state.hosting) {\r\n    const interval = NETWORK_CONFIG.heartbeatIntervalMs ?? 45000;\r\n    if (timestamp - state.hostingLastHeartbeat >= interval) {\r\n      heartbeatSession();\r\n    }\r\n  }\r\n  pumpSignalUpdates();\r\n}\r\n\r\n\r\nasync function ensureHostOffer({ forceRegenerate = false } = {}) {\r\n  const state = getServerBrowserState();\r\n  const shouldRebuild = forceRegenerate || !state.p2p.offer;\r\n  if (!shouldRebuild) {\r\n    syncLocalCandidates();\r\n    return state.p2p.offer;\r\n  }\r\n  const p2p = getP2POrThrow();\r\n  setP2PError(null);\r\n  setP2PPending({ offer: true });\r\n  try {\r\n    const offer = await p2p.createOffer();\r\n    setP2POffer(offer);\r\n    syncLocalCandidates();\r\n    return offer;\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to create offer\";\r\n    setP2PError(message);\r\n    throw error;\r\n  } finally {\r\n    setP2PPending({ offer: false });\r\n  }\r\n}\r\n\r\nasync function copyHostOffer({ forceRegenerate = false, silent = false } = {}) {\r\n  const offer = await ensureHostOffer({ forceRegenerate });\r\n  const copied = await copyToClipboard(offer);\r\n  if (!silent) {\r\n    if (copied) {\r\n      setStatusMessage(\"Offer copied. Share it with your party.\");\r\n    } else {\r\n      setStatusMessage(\"Offer ready. Copy it manually if clipboard access is blocked.\");\r\n    }\r\n  }\r\n  return { offer, copied };\r\n}\r\n\r\nasync function acceptHostOffer(rawOffer, { autoCopyAnswer = true } = {}) {\r\n  const offerString = sanitizeSignal(rawOffer);\r\n  if (!offerString) {\r\n    throw new Error(\"Offer empty\");\r\n  }\r\n  let normalizedOffer;\r\n  try {\r\n    normalizedOffer = JSON.stringify(JSON.parse(offerString));\r\n  } catch (error) {\r\n    setP2PError(\"Offer must be valid JSON\");\r\n    throw error;\r\n  }\r\n  const p2p = getP2POrThrow();\r\n  setP2PError(null);\r\n  setP2PPending({ answer: true });\r\n  try {\r\n    const answer = await p2p.createAnswer(normalizedOffer);\r\n    setP2PAnswer(answer);\r\n    syncLocalCandidates();\r\n    if (autoCopyAnswer) {\r\n      const copied = await copyToClipboard(answer);\r\n      if (copied) {\r\n        setStatusMessage(\"Answer copied. Send it back to the host.\");\r\n      } else {\r\n        setStatusMessage(\"Answer ready. Copy it manually for the host.\");\r\n      }\r\n    } else {\r\n      setStatusMessage(\"Answer ready. Share it with the host.\");\r\n    }\r\n    return answer;\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to build answer\";\r\n    setP2PError(message);\r\n    throw error;\r\n  } finally {\r\n    setP2PPending({ answer: false });\r\n  }\r\n}\r\n\r\nasync function applyJoinerAnswer(rawAnswer) {\r\n  const answerString = sanitizeSignal(rawAnswer);\r\n  if (!answerString) {\r\n    throw new Error(\"Answer empty\");\r\n  }\r\n  let normalizedAnswer;\r\n  try {\r\n    normalizedAnswer = JSON.stringify(JSON.parse(answerString));\r\n  } catch (error) {\r\n    setP2PError(\"Answer must be valid JSON\");\r\n    throw error;\r\n  }\r\n  const p2p = getP2POrThrow();\r\n  setP2PError(null);\r\n  try {\r\n    await p2p.acceptRemoteDescription(normalizedAnswer);\r\n    setP2PAnswer(normalizedAnswer);\r\n    setStatusMessage(\"Answer applied. Waiting for connection...\");\r\n  } catch (error) {\r\n    const message = error?.message ?? \"Failed to accept answer\";\r\n    setP2PError(message);\r\n    throw error;\r\n  }\r\n}\r\n\r\n\r\nfunction applyRemoteCandidates(candidates) {\r\n  if (!Array.isArray(candidates) || candidates.length === 0) {\r\n    return;\r\n  }\r\n  const normalized = normalizeCandidateList(candidates);\r\n  if (normalized.length === 0) {\r\n    return;\r\n  }\r\n  let p2p;\r\n  try {\r\n    p2p = getP2POrThrow();\r\n  } catch (error) {\r\n    console.warn(\"P2P unavailable while applying candidates\", error);\r\n    return;\r\n  }\r\n  const state = getServerBrowserState();\r\n  const current = Array.isArray(state.p2p.remoteCandidates) ? state.p2p.remoteCandidates : [];\r\n  const seen = new Set(current);\r\n  const updated = current.slice();\r\n  for (const candidate of normalized) {\r\n    if (seen.has(candidate)) {\r\n      continue;\r\n    }\r\n    try {\r\n      p2p.addRemoteCandidate(candidate);\r\n      updated.push(candidate);\r\n      seen.add(candidate);\r\n    } catch (error) {\r\n      console.warn(\"Failed to add ICE candidate\", error);\r\n    }\r\n  }\r\n  setP2PRemoteCandidates(updated);\r\n}\r\n\r\nfunction pumpSignalUpdates() {\r\n  const state = getServerBrowserState();\r\n  if (state.hosting && state.hostingSessionId) {\r\n    const hostSession = state.servers.find((entry) => entry.id === state.hostingSessionId);\r\n    const signal = hostSession?.signal ?? null;\r\n    if (signal) {\r\n      if (signal.joinAnswer && state.p2p.answer !== signal.joinAnswer) {\r\n        applyJoinerAnswer(signal.joinAnswer).catch((error) => {\r\n          console.warn(\"Failed to apply joiner answer\", error);\r\n        });\r\n      }\r\n      if (Array.isArray(signal.joinCandidates) && signal.joinCandidates.length > 0) {\r\n        applyRemoteCandidates(signal.joinCandidates);\r\n      }\r\n      if (signal.joinAnswer && (state.hostingMetrics?.playerCount ?? 1) < 2) {\r\n        setHostingMetrics({ playerCount: Math.max(2, state.hostingMetrics?.playerCount ?? 1) });\r\n        heartbeatSession().catch((error) => console.warn(\"Heartbeat update failed\", error));\r\n      }\r\n    }\r\n  }\r\n  if (state.joinedSessionId) {\r\n    const joinedSession = state.servers.find((entry) => entry.id === state.joinedSessionId);\r\n    const signal = joinedSession?.signal ?? null;\r\n    if (signal && Array.isArray(signal.hostCandidates) && signal.hostCandidates.length > 0) {\r\n      applyRemoteCandidates(signal.hostCandidates);\r\n    } else if (!joinedSession) {\r\n      setJoinedSessionId(null);\r\n    }\r\n  }\r\n}\r\n\r\nasync function promptForHostOffer() {\r\n  if (typeof window === \"undefined\" || typeof window.prompt !== \"function\") {\r\n    throw new Error(\"Prompts unavailable in this environment\");\r\n  }\r\n  const input = window.prompt(\"Paste the host offer JSON\", \"\");\r\n  if (input == null) {\r\n    setStatusMessage(\"Offer entry cancelled.\");\r\n    return null;\r\n  }\r\n  try {\r\n    return await acceptHostOffer(input, { autoCopyAnswer: true });\r\n  } catch (error) {\r\n    setStatusMessage(\"Invalid offer. Please try again.\");\r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function promptForJoinerAnswer() {\r\n  if (typeof window === \"undefined\" || typeof window.prompt !== \"function\") {\r\n    throw new Error(\"Prompts unavailable in this environment\");\r\n  }\r\n  const input = window.prompt(\"Paste the player's answer JSON\", \"\");\r\n  if (input == null) {\r\n    setStatusMessage(\"Answer entry cancelled.\");\r\n    return null;\r\n  }\r\n  try {\r\n    await applyJoinerAnswer(input);\r\n    return input;\r\n  } catch (error) {\r\n    setStatusMessage(\"Invalid answer. Ask the player to resend it.\");\r\n    throw error;\r\n  }\r\n}\r\n\r\nfunction attemptHostSession() {\r\n  const state = getServerBrowserState();\r\n  if (state.hosting) {\r\n    setStatusMessage(\"Already hosting.\");\r\n    return Promise.resolve({ alreadyHosting: true });\r\n  }\r\n  clearP2PState();\r\n  resetCandidateTracking();\r\n  setJoinedSessionId(null);\r\n  setStatusMessage(\"Preparing host offer...\");\r\n  setError(null);\r\n  return ensureHostOffer({ forceRegenerate: true })\r\n    .then((offer) => {\r\n      const candidates = syncLocalCandidates();\r\n      return hostSession({\r\n        signal: {\r\n          hostOffer: offer,\r\n          hostCandidates: candidates\r\n        }\r\n      }).then((result) => {\r\n        setStatusMessage(`Hosting ${state.hostingSessionId ?? result.id}`);\r\n        return result;\r\n      });\r\n    })\r\n    .catch((error) => {\r\n      const message = typeof error?.message === \"string\" ? error.message : \"Host failed\";\r\n      setError(message);\r\n      setStatusMessage(null);\r\n      throw error;\r\n    });\r\n}\r\n\r\nfunction attemptStopHosting() {\r\n  const state = getServerBrowserState();\r\n  if (!state.hosting) {\r\n    setStatusMessage(\"Not hosting any session.\");\r\n    return Promise.resolve({ alreadyStopped: true });\r\n  }\r\n  setStatusMessage(\"Stopping session...\");\r\n  setError(null);\r\n  return stopHosting()\r\n    .then(() => {\r\n      setStatusMessage(\"Hosting stopped.\");\r\n      setJoinedSessionId(null);\r\n    })\r\n    .catch((error) => {\r\n      const message = typeof error?.message === \"string\" ? error.message : \"Stop failed\";\r\n      setError(message);\r\n      throw error;\r\n    });\r\n}\r\n\r\nfunction attemptJoinSession(server) {\r\n  if (!server) {\r\n    setJoinError(\"No server selected.\");\r\n    return Promise.reject(new Error(\"No server selected\"));\r\n  }\r\n  const resolveSignal = () => {\r\n    const directSignal = server.signal ?? {};\r\n    if (directSignal.hostOffer) {\r\n      console.debug(`[serverBrowser] using cached signal for ${server.id}`);\r\n      return Promise.resolve({ server, signal: directSignal });\r\n    }\r\n    console.debug(`[serverBrowser] cached signal missing for ${server.id}, fetching detail`);\r\n    setStatusMessage(\"Syncing host signal...\");\r\n    return fetchSessionDetail(server.id).then((result) => {\r\n      if (result?.notFound) {\r\n        console.warn(`[serverBrowser] session ${server.id} vanished before join`);\r\n        const state = getServerBrowserState();\r\n        const index = state.servers.findIndex((entry) => entry.id === server.id);\r\n        if (index >= 0) {\r\n          state.servers.splice(index, 1);\r\n        }\r\n        setJoinedSessionId(null);\r\n        throw new Error(\"Session no longer available\");\r\n      }\r\n      const refreshed = result?.session;\r\n      const refreshedSignal = refreshed?.signal ?? {};\r\n      if (!refreshedSignal.hostOffer) {\r\n        throw new Error(\"Host offer unavailable. Ask the host to refresh.\");\r\n      }\r\n      const state = getServerBrowserState();\r\n      const updatedEntry = {\r\n        ...server,\r\n        signal: {\r\n          hostOffer: refreshedSignal.hostOffer ?? null,\r\n          hostCandidates: Array.isArray(refreshedSignal.hostCandidates) ? refreshedSignal.hostCandidates.slice() : [],\r\n          joinAnswer: refreshedSignal.joinAnswer ?? null,\r\n          joinCandidates: Array.isArray(refreshedSignal.joinCandidates) ? refreshedSignal.joinCandidates.slice() : []\r\n        },\r\n        updatedAt: refreshed?.updatedAt ?? server.updatedAt\r\n      };\r\n      const index = state.servers.findIndex((entry) => entry.id === server.id);\r\n      if (index >= 0) {\r\n        state.servers[index] = updatedEntry;\r\n      }\r\n      console.debug(`[serverBrowser] refreshed signal for ${server.id}`);\r\n      return { server: updatedEntry, signal: updatedEntry.signal };\r\n    });\r\n  };\r\n\r\n  return resolveSignal()\r\n    .then(({ server: resolvedServer, signal }) => {\r\n      clearP2PState();\r\n      resetCandidateTracking();\r\n      setJoinError(null);\r\n      console.debug(`[serverBrowser] applying host offer for ${resolvedServer.id}`);\r\n      setStatusMessage(`Connecting to ${resolvedServer.name ?? resolvedServer.id}...`);\r\n      setError(null);\r\n      return acceptHostOffer(signal.hostOffer, { autoCopyAnswer: false })\r\n        .then((answer) => {\r\n          const candidates = syncLocalCandidates();\r\n          console.debug(`[serverBrowser] posting join payload for ${resolvedServer.id}`);\r\n          return joinServer(resolvedServer.id, {\r\n            signalAnswer: answer,\r\n            signalCandidates: candidates\r\n          }).then((result) => {\r\n            setJoinedSessionId(resolvedServer.id);\r\n            if (Array.isArray(result?.session?.signal?.hostCandidates)) {\r\n              applyRemoteCandidates(result.session.signal.hostCandidates);\r\n            }\r\n            setStatusMessage(`Joined ${result?.session?.name ?? resolvedServer.name ?? resolvedServer.id}`);\r\n            return result;\r\n          });\r\n        });\r\n    })\r\n    .catch((error) => {\r\n      const message = typeof error?.message === \"string\" ? error.message : \"Join failed\";\r\n      console.warn(`[serverBrowser] join failed for ${server.id}: ${message}`);\r\n      setJoinError(message);\r\n      setStatusMessage(null);\r\n      throw error;\r\n    });\r\n}\r\n\r\nexport {\r\n  getServerBrowserState,\r\n  setVisible,\r\n  toggleVisible,\r\n  showServerBrowser,\r\n  hideServerBrowser,\r\n  fetchServerList,\r\n  hostSession,\r\n  joinServer,\r\n  stopHosting,\r\n  updateServerBrowser,\r\n  selectNext,\r\n  heartbeatSession as hostHeartbeat,\r\n  attemptHostSession,\r\n  attemptStopHosting,\r\n  attemptJoinSession,\r\n  copyHostOffer,\r\n  promptForHostOffer,\r\n  promptForJoinerAnswer,\r\n  ensureHostOffer,\r\n  acceptHostOffer,\r\n  applyJoinerAnswer,\r\n  copyLocalCandidates,\r\n  promptForRemoteCandidates,\r\n  syncLocalCandidates\r\n};\r\n\r\nexport const hostServer = hostSession;\r\n\r\nif (typeof window !== \"undefined\") {\r\n  window.ServerBrowser = {\r\n    fetch: fetchServerList,\r\n    host: hostSession,\r\n    join: joinServer,\r\n    stop: stopHosting,\r\n    attemptHost: attemptHostSession,\r\n    attemptStop: attemptStopHosting,\r\n    attemptJoin: attemptJoinSession,\r\n    copyOffer: copyHostOffer,\r\n    regenerateOffer: () => copyHostOffer({ forceRegenerate: true, silent: true }),\r\n    promptOffer: promptForHostOffer,\r\n    promptAnswer: promptForJoinerAnswer,\r\n    copyCandidates: copyLocalCandidates,\r\n    promptCandidates: promptForRemoteCandidates,\r\n    syncCandidates: syncLocalCandidates,\r\n    state: getServerBrowserState\r\n  };\r\n}\r\n\r\nexport { setHostingMetrics } from \"../../state/serverBrowser.js\";\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { SPEED, JUMP_SPEED, ROLL_SPEED, GRAVITY, POSES } from \"../../config/constants.js\";\r\nimport { canvas, GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { getEnvironmentWidth, setEnvironment } from \"../../state/environment.js\";\r\nimport { setCameraTargetX, updateCamera } from \"../../state/camera.js\";\r\nimport { setMaterialCount } from \"../../state/resources.js\";\r\nimport { input } from \"../input/index.js\";\r\nimport { stickman, trainingDummy, enemies, getTotalHeight, getRemotePlayers, squadmates } from \"../../state/entities.js\";\r\nimport { determinePose, startRoll, attemptAttack, advanceAttack } from \"../combat/playerActions.js\";\r\nimport { spawnHitbox, updateHitboxes, resolveHitDetection, fireEquippedWeaponProjectile } from \"../combat/melee.js\";\r\nimport { throwEquippedWeapon, updateThrowables } from \"../combat/throwables.js\";\r\nimport { deployGadget, updateGadgets, updateGadgetMovement, clearGadgets } from \"../gadgets/index.js\";\r\nimport { updateTrainingDummy } from \"./trainingDummy.js\";\r\nimport { updateSalvagePickups } from \"../resources/index.js\";\r\nimport { updateSurvival } from \"../survival/index.js\";\nimport { updateMassiveCoop } from \"../coop/index.js\";\nimport { updateSandboxSkirmish } from \"../sandbox/index.js\";\r\nimport { updateCampaign } from \"../campaign/index.js\";\r\nimport { updateBuildingSystem } from \"../building/index.js\";\r\nimport { updateDamagePopups } from \"../effects/damage.js\";\r\nimport { updateParticles } from \"../effects/particles.js\";\r\nimport { updateLighting } from \"../effects/lighting.js\";\r\nimport { updateEnemies } from \"./enemyAI.js\";\r\nimport { updateProjectiles } from \"../combat/projectiles.js\";\r\nimport { updateVehicles, handleVehicleInteraction, getPlayerVehicle, forcePlayerExitVehicle } from \"../vehicles/index.js\";\r\nimport { updateSupplyDrops } from \"./supplyDrops.js\";\r\nimport { updateDestructibles } from \"./destructibles.js\";\r\nimport { updateInteractables } from \"./interactables.js\";\r\nimport { updateEnemySpawner, spawnEnemies } from \"./enemySpawner.js\";\r\nimport { updateServerBrowser, showServerBrowser, hideServerBrowser, selectNext as selectServerBrowser, attemptJoinSession, getServerBrowserState, setHostingMetrics, attemptHostSession, attemptStopHosting, copyHostOffer, promptForHostOffer, promptForJoinerAnswer, copyLocalCandidates, promptForRemoteCandidates } from \"../network/serverBrowser.js\";\r\nimport { updateP2P } from \"../network/p2p.js\";\r\nimport { updateSquadmates, cycleSquadCommand, setSquadCommandById } from \"../squad/index.js\";\r\nimport { updateRagdolls } from \"../effects/ragdoll.js\";\r\nimport { updatePolishDebug } from \"../events/polishDebug.js\";\r\nimport { resolvePlatformLanding } from \"./arena.js\";\r\nimport { advanceTime } from \"../utils/time.js\";\r\nimport { getCurrentWeapon } from \"../combat/weapons.js\";\r\nimport { updateRecoil } from \"../../state/recoil.js\";\r\nimport { updateAmmoTimers, getAmmoStatus, startReload as requestReload } from \"../../state/ammo.js\";\r\nimport { updateAimSystem } from \"../aim/index.js\";\r\nimport { updateLoadoutSystem, isLoadoutEditorVisible } from \"../loadout/index.js\";\r\nimport { updateCosmeticSystem, isCosmeticEditorVisible } from \"../cosmetics/index.js\";\r\nimport { updateScenarioSystem, isScenarioEditorVisible, consumeScenarioApplication, setScenarioRuntimeApplied } from \"../scenario/index.js\";\r\n\r\n\r\nfunction clampPlayerX() {\r\n  const envWidth = getEnvironmentWidth();\r\n  const margin = 40;\r\n  const maxX = Math.max(margin, envWidth - margin);\r\n  stickman.x = Math.max(margin, Math.min(maxX, stickman.x));\r\n}\r\n\r\nfunction clampToArena(value, margin, envWidth) {\r\n  const width = Math.max(1, envWidth ?? getEnvironmentWidth());\r\n  return Math.max(margin, Math.min(width - margin, value));\r\n}\r\n\r\nfunction applyScenarioConfiguration(request) {\r\n  const scenario = request?.scenario;\r\n  if (!scenario) {\r\n    return;\r\n  }\r\n\r\n  setEnvironment(scenario.environmentId);\r\n  const envWidth = getEnvironmentWidth();\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  const playerX = clampToArena(envWidth * (scenario.playerSpawnRatio ?? 0.5), 40, envWidth);\r\n\r\n  stickman.x = playerX;\r\n  stickman.y = GROUND_Y - standingHeight;\r\n  stickman.vx = 0;\r\n  stickman.vy = 0;\r\n  stickman.onGround = true;\r\n  stickman.controlMode = \"onFoot\";\r\n  stickman.vehicleId = null;\r\n  stickman.vehicleCandidateId = null;\r\n  stickman.rollTimer = 0;\r\n  stickman.crouching = false;\r\n  stickman.attacking = false;\r\n  stickman.attackIndex = -1;\r\n  stickman.currentAttack = null;\r\n  stickman.attackElapsed = 0;\r\n  stickman.comboWindowOpen = false;\r\n  stickman.comboWindowTimer = 0;\r\n  stickman.hitboxSpawned = false;\r\n  stickman.activeHitboxes.length = 0;\r\n  stickman.throwCooldown = 0;\r\n  stickman.gadgetCooldown = 0;\r\n  stickman.reloading = false;\r\n  stickman.flashBlindTimer = 0;\r\n  stickman.smokeSlowTimer = 0;\r\n  stickman.smokeSlowStrength = 1;\r\n  stickman.health = stickman.maxHealth;\r\n  stickman.invulnerability = 0;\r\n\r\n  const dummyX = clampToArena(envWidth * (scenario.dummySpawnRatio ?? 0.8), 80, envWidth);\r\n  trainingDummy.x = dummyX;\r\n  trainingDummy.y = GROUND_Y - trainingDummy.height;\r\n  trainingDummy.health = trainingDummy.maxHealth;\r\n  trainingDummy.flashTimer = 0;\r\n  trainingDummy.shakeTimer = 0;\r\n  trainingDummy.shakeMagnitude = 0;\r\n  trainingDummy.respawnTimer = 0;\r\n\r\n  squadmates.forEach((ally, index) => {\r\n    const offset = -140 + index * 90;\r\n    ally.x = clampToArena(playerX + offset, 60, envWidth);\r\n    ally.y = GROUND_Y - getTotalHeight(POSES.standing);\r\n    ally.vx = 0;\r\n    ally.vy = 0;\r\n    ally.onGround = true;\r\n    ally.state = \"follow\";\r\n    ally.targetEnemyId = null;\r\n    ally.fireCooldown = 0;\r\n  });\r\n\r\n  enemies.length = 0;\r\n\r\n  const leftSpawn = clampToArena(envWidth * (scenario.enemySpawnRatios?.[0] ?? 0.25), 40, envWidth);\r\n  const rightSpawn = clampToArena(envWidth * (scenario.enemySpawnRatios?.[1] ?? 0.75), 40, envWidth);\r\n  const spawnPoints = [leftSpawn, rightSpawn];\r\n\r\n  setMaterialCount(Math.max(0, scenario.startingMaterials ?? 0));\r\n  setScenarioRuntimeApplied({ scenarioId: scenario.id, spawnOverride: { context: \"scenario\", points: spawnPoints } });\r\n\r\n  const count = Math.max(0, Math.round(scenario.enemyCount ?? 0));\r\n  if (count > 0) {\r\n    spawnEnemies(count, { context: \"scenario\", autoRespawn: false });\r\n  }\r\n}\r\n\r\nfunction updatePlayerAlive(delta) {\r\n  if (stickman.vehicleId) {\r\n    return;\r\n  }\r\n\r\n  stickman.crouching = input.down && stickman.onGround && !stickman.rolling && !stickman.attacking;\r\n\r\n  if (stickman.rolling) {\r\n    stickman.vx = stickman.facing * ROLL_SPEED;\r\n    stickman.vy = 0;\r\n    stickman.rollTimer -= delta;\r\n    if (stickman.rollTimer <= 0) {\r\n      stickman.rolling = false;\r\n    }\r\n  } else {\r\n    let moveSpeed = SPEED;\r\n    if (stickman.crouching) {\r\n      moveSpeed *= 0.55;\r\n    }\r\n    if (stickman.attacking) {\r\n      moveSpeed *= 0.7;\r\n    }\r\n    if (stickman.reloading) {\r\n      moveSpeed *= 0.8;\r\n    }\r\n    if (stickman.smokeSlowTimer > 0) {\r\n      const slowFactor = stickman.smokeSlowStrength ?? 0.6;\r\n      moveSpeed *= Math.max(0.1, Math.min(1, slowFactor));\r\n    }\r\n    if (stickman.stunTimer > 0) {\r\n      moveSpeed *= 0.25;\r\n    }\r\n\r\n    stickman.vx = 0;\r\n    if (input.left) {\r\n      stickman.vx -= moveSpeed;\r\n      stickman.facing = -1;\r\n    }\r\n    if (input.right) {\r\n      stickman.vx += moveSpeed;\r\n      stickman.facing = 1;\r\n    }\r\n\r\n    const canJump = stickman.stunTimer <= 0;\r\n    if (stickman.onGround && canJump && input.jump && !stickman.crouching && !stickman.attacking) {\r\n      stickman.vy = -JUMP_SPEED;\r\n      stickman.onGround = false;\r\n    }\r\n\r\n    stickman.vy += GRAVITY * delta;\r\n  }\r\n\r\n  const previousY = stickman.y;\r\n  stickman.x += stickman.vx * delta;\r\n  stickman.y += stickman.vy * delta;\r\n  stickman.onGround = false;\r\n\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  const landedPlatform = resolvePlatformLanding(stickman, previousY, standingHeight);\r\n\r\n  if (!landedPlatform) {\r\n    const feetY = stickman.y + standingHeight;\r\n    if (feetY >= GROUND_Y) {\r\n      stickman.y = GROUND_Y - standingHeight;\r\n      stickman.vy = 0;\r\n      stickman.onGround = true;\r\n    }\r\n  }\r\n\r\n  clampPlayerX();\r\n}\r\n\r\nfunction updatePlayerInVehicle() {\r\n  const vehicle = getPlayerVehicle();\r\n  if (!vehicle) {\r\n    stickman.vehicleId = null;\r\n    stickman.controlMode = \"onFoot\";\r\n    return;\r\n  }\r\n  stickman.controlMode = \"vehicle\";\r\n  stickman.crouching = false;\r\n  stickman.rolling = false;\r\n  stickman.onGround = vehicle.onGround || vehicle.waterLineY != null;\r\n}\r\n\r\n\r\nfunction updatePlayerDead(delta) {\r\n  const standingHeight = getTotalHeight(POSES.standing);\r\n  stickman.vehicleId = null;\r\n  stickman.controlMode = \"onFoot\";\r\n  stickman.vehicleCandidateId = null;\r\n  stickman.deadTimer = Math.max(0, stickman.deadTimer - delta);\r\n  stickman.vx *= 0.9;\r\n  stickman.vy += GRAVITY * delta;\r\n  stickman.x += stickman.vx * delta;\r\n  stickman.y += stickman.vy * delta;\r\n\r\n  const feetY = stickman.y + standingHeight;\r\n  if (feetY >= GROUND_Y) {\r\n    stickman.y = GROUND_Y - standingHeight;\r\n    stickman.vy = 0;\r\n    stickman.onGround = true;\r\n  }\r\n\r\n  clampPlayerX();\r\n\r\n  if (stickman.deadTimer === 0) {\r\n    stickman.health = stickman.maxHealth;\r\n    stickman.invulnerability = 1.2;\r\n    stickman.throwCooldown = 0;\r\n    stickman.gadgetCooldown = 0;\r\n    stickman.reloading = false;\r\n    stickman.stunTimer = 0;\r\n    stickman.flashBlindTimer = 0;\r\n    stickman.smokeSlowTimer = 0;\r\n    stickman.smokeSlowStrength = 1;\r\n    clearGadgets();\r\n    const envWidth = getEnvironmentWidth();\r\n    stickman.x = envWidth * 0.5;\r\n    stickman.y = GROUND_Y - standingHeight;\r\n    stickman.vx = 0;\r\n    stickman.vy = 0;\r\n    stickman.onGround = true;\r\n  }\r\n}\r\n\r\nfunction updateGame(delta) {\r\n  advanceTime(delta);\r\n  updateBuildingSystem(delta);\r\n  updateSalvagePickups(delta);\r\n  updateSurvival(delta);\n  updateMassiveCoop(delta);\n  updateSandboxSkirmish(delta);\r\n  updateCampaign(delta);\r\n  stickman.invulnerability = Math.max(0, stickman.invulnerability - delta);\r\n  stickman.structureShieldTimer = Math.max(0, (stickman.structureShieldTimer ?? 0) - delta);\r\n  if (stickman.structureShieldTimer <= 0) {\r\n    stickman.structureShieldStrength = 0;\r\n  }\r\n  stickman.throwCooldown = Math.max(0, stickman.throwCooldown - delta);\r\n  stickman.gadgetCooldown = Math.max(0, (stickman.gadgetCooldown ?? 0) - delta);\r\n  stickman.stunTimer = Math.max(0, (stickman.stunTimer ?? 0) - delta);\r\n  stickman.flashBlindTimer = Math.max(0, (stickman.flashBlindTimer ?? 0) - delta);\r\n  stickman.smokeSlowTimer = Math.max(0, (stickman.smokeSlowTimer ?? 0) - delta);\r\n  if (stickman.smokeSlowTimer <= 0) {\r\n    stickman.smokeSlowStrength = 1;\r\n  }\r\n\r\n  updateLoadoutSystem(delta);\r\n  updateCosmeticSystem(delta);\r\n  updateScenarioSystem(delta);\r\n  const loadoutMenuOpen = isLoadoutEditorVisible();\r\n  const cosmeticMenuOpen = isCosmeticEditorVisible();\r\n  const scenarioMenuOpen = isScenarioEditorVisible();\r\n  const overlayMenuOpen = loadoutMenuOpen || cosmeticMenuOpen || scenarioMenuOpen;\r\n\r\n  const scenarioRequest = consumeScenarioApplication();\r\n  if (scenarioRequest) {\r\n    applyScenarioConfiguration(scenarioRequest);\r\n  }\r\n\r\n  const interactRequested = overlayMenuOpen ? false : input.interactBuffered;\r\n  input.interactBuffered = false;\r\n  const squadCycleRequested = overlayMenuOpen ? false : input.squadCommandCycleBuffered;\r\n  const squadSelectRequested = overlayMenuOpen ? null : input.squadCommandSelect;\r\n  const serverBrowserToggleRequested = overlayMenuOpen ? false : input.serverBrowserToggleBuffered;\r\n  const serverBrowserNavigate = overlayMenuOpen ? 0 : input.serverBrowserNavigate;\r\n  const serverBrowserJoinRequested = overlayMenuOpen ? false : input.serverBrowserJoinBuffered;\r\n  const serverBrowserHostRequested = overlayMenuOpen ? false : input.serverBrowserHostBuffered;\r\n  const serverBrowserStopRequested = overlayMenuOpen ? false : input.serverBrowserStopHostBuffered;\r\n  const serverBrowserCopyOfferRequested = overlayMenuOpen ? false : input.serverBrowserCopyOfferBuffered;\r\n  const serverBrowserPasteOfferRequested = overlayMenuOpen ? false : input.serverBrowserPasteOfferBuffered;\r\n  const serverBrowserAcceptAnswerRequested = overlayMenuOpen ? false : input.serverBrowserAcceptAnswerBuffered;\r\n  const serverBrowserCopyCandidatesRequested = overlayMenuOpen ? false : input.serverBrowserCopyCandidatesBuffered;\r\n  const serverBrowserPasteCandidatesRequested = overlayMenuOpen ? false : input.serverBrowserPasteCandidatesBuffered;\r\n  input.squadCommandCycleBuffered = false;\r\n  input.squadCommandSelect = null;\r\n  input.serverBrowserToggleBuffered = false;\r\n  input.serverBrowserNavigate = 0;\r\n  input.serverBrowserJoinBuffered = false;\r\n  input.serverBrowserHostBuffered = false;\r\n  input.serverBrowserStopHostBuffered = false;\r\n  input.serverBrowserCopyOfferBuffered = false;\r\n  input.serverBrowserPasteOfferBuffered = false;\r\n  input.serverBrowserAcceptAnswerBuffered = false;\r\n  input.serverBrowserCopyCandidatesBuffered = false;\r\n  input.serverBrowserPasteCandidatesBuffered = false;\r\n\r\n  const rawAttackRequested = !overlayMenuOpen && stickman.health > 0 ? input.attackBuffered : false;\r\n  const rawThrowRequested = !overlayMenuOpen && stickman.health > 0 ? input.throwBuffered : false;\r\n  const rawReloadRequested = !overlayMenuOpen && stickman.health > 0 ? input.reloadBuffered : false;\r\n\r\n  input.attackBuffered = false;\r\n  input.throwBuffered = false;\r\n  input.reloadBuffered = false;\r\n\r\n  const rollAttempted = overlayMenuOpen ? false : input.roll;\r\n  input.roll = false;\r\n\r\n  handleVehicleInteraction(interactRequested);\r\n  if (squadCycleRequested) {\r\n    cycleSquadCommand();\r\n  }\r\n  if (squadSelectRequested) {\r\n    setSquadCommandById(squadSelectRequested);\r\n  }\r\n  if (serverBrowserToggleRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      hideServerBrowser();\r\n    } else {\r\n      showServerBrowser();\r\n    }\r\n  }\r\n  if (serverBrowserNavigate !== 0) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      selectServerBrowser(serverBrowserNavigate);\r\n    }\r\n  }\r\n  if (serverBrowserJoinRequested) {\r\n    const state = getServerBrowserState();\r\n    const selectedServer = state.visible ? state.servers[state.selectedIndex] : null;\r\n    if (selectedServer) {\r\n      attemptJoinSession(selectedServer).catch((error) => console.warn(\"Join failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserHostRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      attemptHostSession().catch((error) => console.warn(\"Host failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserStopRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      attemptStopHosting().catch((error) => console.warn(\"Stop hosting failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserCopyOfferRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible && state.hosting) {\r\n      copyHostOffer({ forceRegenerate: false, silent: false }).catch((error) => console.warn(\"Offer copy failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserPasteOfferRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      promptForHostOffer().catch((error) => console.warn(\"Offer accept failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserAcceptAnswerRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible && state.hosting) {\r\n      promptForJoinerAnswer().catch((error) => console.warn(\"Answer apply failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserCopyCandidatesRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible && state.hosting) {\r\n      copyLocalCandidates({ silent: false }).catch((error) => console.warn(\"Candidate copy failed\", error));\r\n    }\r\n  }\r\n  if (serverBrowserPasteCandidatesRequested) {\r\n    const state = getServerBrowserState();\r\n    if (state.visible) {\r\n      promptForRemoteCandidates().catch((error) => console.warn(\"Candidate apply failed\", error));\r\n    }\r\n  }\r\n  let playerVehicle = getPlayerVehicle();\r\n  let inVehicle = Boolean(playerVehicle);\r\n\r\n  if (stickman.health <= 0 && inVehicle) {\r\n    forcePlayerExitVehicle({ preferDirection: playerVehicle?.facing });\r\n    playerVehicle = null;\r\n    inVehicle = false;\r\n  }\r\n\r\n  if (rollAttempted && stickman.health > 0 && !inVehicle) {\r\n    startRoll({ left: input.left, right: input.right });\r\n  }\r\n\r\n  if (!inVehicle && stickman.controlMode === \"vehicle\") {\r\n    stickman.controlMode = \"onFoot\";\r\n  }\r\n\r\n  const canAct = !overlayMenuOpen && !inVehicle && stickman.stunTimer <= 0 && !stickman.reloading;\r\n\r\n  const attackRequested = canAct ? rawAttackRequested : false;\r\n  const throwRequested = canAct ? rawThrowRequested : false;\r\n  const reloadRequested = canAct ? rawReloadRequested : false;\r\n\r\n  if (stickman.health > 0) {\r\n    if (inVehicle) {\r\n      updatePlayerInVehicle();\r\n    } else {\r\n      updatePlayerAlive(delta);\r\n    }\r\n  } else {\r\n    updatePlayerDead(delta);\r\n  }\r\n\r\n  stickman.currentPose = determinePose();\r\n  const baseHeight = getTotalHeight(stickman.currentPose);\r\n\r\n  const remotePlayerCount = getRemotePlayers().length;\r\n  const aliveEnemies = enemies.reduce((count, enemy) => count + (enemy.health > 0 ? 1 : 0), 0);\r\n  const activeAllies = squadmates.reduce((count, ally) => count + (ally && ally.state !== \"defeated\" ? 1 : 0), 0);\r\n  setHostingMetrics({\r\n    playerCount: 1 + remotePlayerCount,\r\n    enemyCount: aliveEnemies,\r\n    alliesCount: activeAllies\r\n  });\r\n\r\n  const timestampNow = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n  updateVehicles(delta);\r\n  updateSupplyDrops(delta);\r\n  updateDestructibles(delta);\r\n  updateInteractables(delta);\r\n  updateEnemySpawner(delta);\r\n  updateServerBrowser(delta, timestampNow);\r\n  updateP2P(delta);\r\n  updateSquadmates(delta);\r\n  for (const ally of squadmates) {\r\n    if (!ally) {\r\n      continue;\r\n    }\r\n    ally.structureShieldTimer = Math.max(0, (ally.structureShieldTimer ?? 0) - delta);\r\n    if (ally.structureShieldTimer <= 0) {\r\n      ally.structureShieldStrength = 0;\r\n    }\r\n  }\r\n  playerVehicle = getPlayerVehicle();\r\n  inVehicle = Boolean(playerVehicle);\r\n  if (inVehicle) {\r\n    stickman.controlMode = \"vehicle\";\r\n  }\r\n\r\n  updateAimSystem(delta);\r\n\r\n  if (!canAct) {\r\n    stickman.attacking = false;\r\n    stickman.currentAttack = null;\r\n    stickman.attackElapsed = 0;\r\n    stickman.comboWindowOpen = false;\r\n    stickman.comboWindowTimer = 0;\r\n    stickman.nextAttackQueued = false;\r\n    stickman.hitboxSpawned = false;\r\n    stickman.attackIndex = -1;\r\n    stickman.activeHitboxes.length = 0;\r\n  }\r\n\r\n  stickman.fireCooldown = Math.max(0, (stickman.fireCooldown ?? 0) - delta);\r\n\r\n  const weapon = getCurrentWeapon();\r\n  const weaponCategory = weapon?.category ?? \"\";\r\n  const attackChain = weapon?.attackChain ?? [];\r\n  const hasMeleeChain = attackChain.length > 0;\r\n  const isRangedWeapon = weaponCategory.startsWith(\"ranged\");\r\n  const isThrowableWeapon = weaponCategory === \"throwable\";\r\n  const isGadgetWeapon = weaponCategory === \"gadget\";\r\n\r\n  if (isGadgetWeapon) {\r\n    if (attackRequested || throwRequested) {\r\n      deployGadget(weapon);\r\n    }\r\n    stickman.activeHitboxes.length = 0;\r\n  } else if (isThrowableWeapon) {\r\n    if (attackRequested || throwRequested) {\r\n      throwEquippedWeapon();\r\n    }\r\n    stickman.activeHitboxes.length = 0;\r\n  } else if (isRangedWeapon && !hasMeleeChain) {\r\n    stickman.activeHitboxes.length = 0;\r\n    if (weapon) {\r\n      const ammoStatus = getAmmoStatus(weapon.id);\r\n      const fireInterval = Math.max(weapon.fireInterval ?? 0.26, 0.05);\r\n      const isAutoFire = weapon.auto === true;\r\n      const holdFire = isAutoFire && input.attackDown && canAct;\r\n      if (reloadRequested) {\r\n        if (requestReload(weapon.id)) {\r\n          stickman.attacking = false;\r\n          stickman.currentAttack = null;\r\n          stickman.attackIndex = -1;\r\n        }\r\n      }\r\n      const shouldAttemptShot = (attackRequested || holdFire) && stickman.fireCooldown <= 0;\r\n      if (shouldAttemptShot) {\r\n        const fired = fireEquippedWeaponProjectile();\r\n        if (fired) {\r\n          stickman.fireCooldown = fireInterval;\r\n        }\r\n      }\r\n      if (ammoStatus && ammoStatus.magazine <= 0 && ammoStatus.reserve > 0 && !ammoStatus.reloading) {\r\n        requestReload(weapon.id);\r\n      }\r\n    }\r\n  } else if (hasMeleeChain) {\r\n    if (attackRequested) {\r\n      attemptAttack();\r\n    }\r\n\r\n    if (stickman.attacking) {\r\n      advanceAttack(delta, spawnHitbox);\r\n    }\r\n\r\n    updateHitboxes(delta, baseHeight);\r\n    resolveHitDetection();\r\n  } else {\r\n    stickman.activeHitboxes.length = 0;\r\n    if (isRangedWeapon) {\r\n      const fireInterval = Math.max(weapon?.fireInterval ?? 0.26, 0.05);\r\n      const isAutoFire = weapon?.auto === true;\r\n      const holdFire = isAutoFire && input.attackDown && canAct;\r\n      const shouldAttemptShot = (attackRequested || holdFire) && stickman.fireCooldown <= 0;\r\n      if (shouldAttemptShot) {\r\n        const fired = fireEquippedWeaponProjectile();\r\n        if (fired) {\r\n          stickman.fireCooldown = fireInterval;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  setCameraTargetX(stickman.x);\r\n  updateCamera(delta);\r\n\r\n  updateTrainingDummy(delta);\r\n  updateThrowables(delta);\r\n  updateGadgets(delta);\r\n  updateGadgetMovement(delta);\r\n  updateAmmoTimers(delta, weapon?.id ?? null);\r\n  updateRecoil(delta);\r\n  updateDamagePopups(delta);\r\n  updateParticles(delta);\r\n  updateLighting(delta);\r\n  updatePolishDebug(delta);\r\n  updateProjectiles(delta);\r\n  updateRagdolls(delta, GROUND_Y);\r\n  updateEnemies(delta);\r\n}\r\n\r\nexport { updateGame };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import { spawnRingBurst } from \"../effects/particles.js\";\r\nimport { GROUND_Y } from \"../../environment/canvas.js\";\r\nimport { stickman } from \"../../state/entities.js\";\r\nimport { getResourceState, addMaterials } from \"../../state/resources.js\";\r\nimport { clamp } from \"../utils/math.js\";\r\n\r\nconst SALVAGE_GRAVITY = 520;\r\n\r\nfunction updateSalvagePickups(delta) {\r\n  const state = getResourceState();\r\n  for (let i = state.pickups.length - 1; i >= 0; i -= 1) {\r\n    const pickup = state.pickups[i];\r\n    if (!pickup) {\r\n      state.pickups.splice(i, 1);\r\n      continue;\r\n    }\r\n    pickup.ttl -= delta;\r\n    if (pickup.ttl <= 0) {\r\n      state.pickups.splice(i, 1);\r\n      continue;\r\n    }\r\n    pickup.vy = (pickup.vy ?? -80) + SALVAGE_GRAVITY * delta;\r\n    pickup.x += (pickup.vx ?? 0) * delta;\r\n    pickup.y += pickup.vy * delta;\r\n    if (pickup.y >= GROUND_Y - 12) {\r\n      pickup.y = GROUND_Y - 12;\r\n      pickup.vx = (pickup.vx ?? 0) * 0.65;\r\n      pickup.vy *= -0.35;\r\n    }\r\n    const dx = pickup.x - stickman.x;\r\n    const dy = pickup.y - (stickman.y + stickman.currentPose?.headRadius ?? 16);\r\n    const distance = Math.hypot(dx, dy);\r\n    if (distance < 38) {\r\n      addMaterials(pickup.amount ?? 5);\r\n      spawnRingBurst({\r\n        x: pickup.x,\r\n        y: pickup.y,\r\n        startRadius: 12,\r\n        endRadius: 46,\r\n        color: \"#a9ffd1\",\r\n        ttl: 0.28\r\n      });\r\n      state.pickups.splice(i, 1);\r\n    }\r\n  }\r\n}\r\n\r\nexport { updateSalvagePickups };\r\n","import { trainingDummy } from \"../../state/entities.js\";\r\n\r\nfunction updateTrainingDummy(delta) {\r\n  if (trainingDummy.flashTimer > 0) {\r\n    trainingDummy.flashTimer = Math.max(0, trainingDummy.flashTimer - delta);\r\n  }\r\n\r\n  if (trainingDummy.shakeTimer > 0) {\r\n    trainingDummy.shakeTimer = Math.max(0, trainingDummy.shakeTimer - delta);\r\n  }\r\n\r\n  trainingDummy.shakeMagnitude = Math.max(0, trainingDummy.shakeMagnitude - delta * 20);\r\n\r\n  if (trainingDummy.health <= 0) {\r\n    trainingDummy.respawnTimer = Math.max(0, trainingDummy.respawnTimer - delta);\r\n    if (trainingDummy.respawnTimer === 0) {\r\n      trainingDummy.health = trainingDummy.maxHealth;\r\n      trainingDummy.flashTimer = 0;\r\n      trainingDummy.shakeTimer = 0;\r\n      trainingDummy.shakeMagnitude = 0;\r\n    }\r\n  }\r\n}\r\n\r\nexport { updateTrainingDummy };\r\n","import \"./styles.css\";\r\nimport { context } from \"./environment/canvas.js\";\r\nimport { getCamera } from \"./state/camera.js\";\r\nimport { initializeEnvironmentControls } from \"./state/environment.js\";\r\n\r\nimport { initializeInput } from \"./core/input/index.js\";\r\nimport { initializeWeaponControls } from \"./core/combat/weapons.js\";\r\nimport { initializeLoadoutSystem } from \"./core/loadout/index.js\";\r\nimport { initializeCosmeticSystem } from \"./core/cosmetics/index.js\";\r\nimport { initializeScenarioSystem } from \"./core/scenario/index.js\";\r\nimport { initializeAudioSystem } from \"./core/audio/index.js\";\r\nimport { initializeP2PNetworking } from \"./core/network/p2p.js\";\r\nimport { drawBackground, drawDestructibles, drawInteractables, drawVehicles, drawSupplyDrops, drawRemotePlayers, drawServerBrowser, drawSquadmates, drawStickman, drawHitboxes, drawTrainingDummy, drawEnemies, drawHud, drawProjectilesLayer, drawGadgetsLayer } from \"./core/render/index.js\";\r\nimport { drawLoadoutOverlay } from \"./core/render/loadout.js\";\r\nimport { drawCosmeticOverlay } from \"./core/render/cosmetics.js\";\r\nimport { drawScenarioOverlay } from \"./core/render/scenario.js\";\r\nimport { drawDebugArena } from \"./core/world/arena.js\";\r\nimport { drawDamagePopups } from \"./core/effects/damage.js\";\r\nimport { drawLighting } from \"./core/effects/lighting.js\";\r\nimport { drawRagdolls } from \"./core/effects/ragdoll.js\";\r\nimport { updateGame } from \"./core/world/update.js\";\r\n\r\ninitializeInput();\r\ninitializeWeaponControls();\r\ninitializeLoadoutSystem();\r\ninitializeCosmeticSystem();\r\ninitializeScenarioSystem();\r\ninitializeAudioSystem();\r\ninitializeP2PNetworking();\r\ninitializeEnvironmentControls();\r\n\r\nlet lastTime = performance.now();\r\n\r\nfunction loop(timestamp) {\r\n  const delta = Math.min((timestamp - lastTime) / 1000, 0.1);\r\n  lastTime = timestamp;\r\n\r\n  updateGame(delta);\r\n\r\n  const camera = getCamera();\r\n  drawBackground(camera);\r\n\r\n  context.save();\r\n  context.translate(-camera.offsetX, 0);\r\n\r\n  drawDebugArena();\r\n  drawDestructibles();\r\n  drawInteractables();\r\n  drawVehicles();\r\n  drawSupplyDrops();\r\n  drawRemotePlayers();\r\n  drawSquadmates();\r\n  drawTrainingDummy();\r\n  drawEnemies();\r\n  drawGadgetsLayer();\r\n  drawRagdolls();\r\n  drawStickman();\r\n  drawHitboxes();\r\n  drawProjectilesLayer();\r\n  drawLighting();\r\n  drawDamagePopups();\r\n  context.restore();\r\n\r\n  drawHud();\r\n  drawServerBrowser();\r\n  drawLoadoutOverlay();\r\n  drawCosmeticOverlay();\r\n  drawScenarioOverlay();\r\n\r\n  window.requestAnimationFrame(loop);\r\n}\r\n\r\nwindow.requestAnimationFrame(loop);\r\n\r\n","import { context } from \"../../environment/canvas.js\";\nimport { getLoadoutEditorState } from \"../loadout/index.js\";\nimport { WEAPON_DEFINITIONS } from \"../../config/weapons.js\";\n\nfunction drawWrappedText(text, x, y, maxWidth, lineHeight) {\n  if (!text) {\n    return 0;\n  }\n  const words = String(text).split(/\\s+/);\n  let line = \"\";\n  let lines = 0;\n  for (const word of words) {\n    const candidate = line.length > 0 ? `${line} ${word}` : word;\n    if (context.measureText(candidate).width > maxWidth && line) {\n      context.fillText(line, x, y);\n      line = word;\n      y += lineHeight;\n      lines += 1;\n    } else {\n      line = candidate;\n    }\n  }\n  if (line) {\n    context.fillText(line, x, y);\n    lines += 1;\n  }\n  return lines;\n}\n\nfunction drawLoadoutMessage(message, alpha = 1) {\n  const text = String(message ?? \"\").trim();\n  if (!text) {\n    return;\n  }\n  context.save();\n  context.globalAlpha = alpha;\n  context.font = \"14px 'Segoe UI', Arial, sans-serif\";\n  const padding = 12;\n  const textWidth = context.measureText(text).width;\n  const boxWidth = Math.min(context.canvas.width - 48, textWidth + padding * 2);\n  const boxHeight = 32;\n  const x = 24;\n  const y = 24;\n  context.fillStyle = \"rgba(10, 16, 28, 0.84)\";\n  context.fillRect(x, y, boxWidth, boxHeight);\n  context.strokeStyle = \"rgba(140, 168, 255, 0.55)\";\n  context.lineWidth = 1;\n  context.strokeRect(x + 0.5, y + 0.5, boxWidth - 1, boxHeight - 1);\n  context.fillStyle = \"#dce6ff\";\n  context.fillText(text, x + padding, y + 20);\n  context.restore();\n}\n\nfunction drawLoadoutOptions(activeSlot, optionIndex, originX, originY) {\n  if (!activeSlot) {\n    return originY;\n  }\n  const options = Array.isArray(activeSlot.allowedWeaponIds) ? activeSlot.allowedWeaponIds : [];\n  if (options.length === 0) {\n    context.fillStyle = \"#8a96b9\";\n    context.font = \"13px 'Segoe UI', Arial, sans-serif\";\n    context.fillText(\"No compatible items for this slot.\", originX, originY);\n    return originY + 20;\n  }\n  context.font = \"13px 'Segoe UI', Arial, sans-serif\";\n  const lineHeight = 22;\n  let cursorY = originY;\n  options.forEach((weaponId, idx) => {\n    const weapon = WEAPON_DEFINITIONS[weaponId];\n    const label = weapon?.name ?? weaponId;\n    context.fillStyle = idx === optionIndex ? \"#ffcf7a\" : \"#aab5d5\";\n    context.fillText(label, originX, cursorY);\n    cursorY += lineHeight;\n  });\n  return cursorY;\n}\n\nfunction drawLoadoutOverlay() {\n  const state = getLoadoutEditorState();\n  const { visible, slots, slotIndex, optionIndex, message, messageTimer } = state;\n  const showMessage = Boolean(message) && messageTimer > 0.03;\n  if (!visible && !showMessage) {\n    return;\n  }\n\n  const width = context.canvas.width;\n  const height = context.canvas.height;\n\n  context.save();\n\n  if (visible) {\n    context.fillStyle = \"rgba(6, 10, 18, 0.65)\";\n    context.fillRect(0, 0, width, height);\n\n    const panelWidth = Math.min(width - 120, 560);\n    const baseSlotHeight = 36;\n    const headerHeight = 80;\n    const detailHeight = 160;\n    const footerHeight = 48;\n    const panelHeight = Math.min(height - 120, headerHeight + slots.length * baseSlotHeight + detailHeight + footerHeight);\n    const panelX = (width - panelWidth) * 0.5;\n    const panelY = (height - panelHeight) * 0.5;\n\n    context.fillStyle = \"rgba(12, 18, 32, 0.94)\";\n    context.fillRect(panelX, panelY, panelWidth, panelHeight);\n    context.strokeStyle = \"rgba(120, 150, 240, 0.9)\";\n    context.lineWidth = 2;\n    context.strokeRect(panelX + 0.5, panelY + 0.5, panelWidth - 1, panelHeight - 1);\n\n    const padding = 26;\n    let cursorY = panelY + padding + 6;\n    const leftX = panelX + padding;\n\n    context.fillStyle = \"#f2f5ff\";\n    context.font = \"20px 'Segoe UI', Arial, sans-serif\";\n    context.fillText(\"Loadout Editor\", leftX, cursorY);\n    cursorY += 28;\n\n    context.fillStyle = \"#9aa9c7\";\n    context.font = \"13px 'Segoe UI', Arial, sans-serif\";\n    context.fillText(\"?/? choose slot   ?/? cycle weapons   R reset   Enter/Esc close\", leftX, cursorY);\n    cursorY += 30;\n\n    context.font = \"15px 'Segoe UI', Arial, sans-serif\";\n    const slotAreaLeft = leftX;\n    const slotAreaRight = panelX + panelWidth - padding;\n    const activeColor = \"rgba(92, 128, 220, 0.22)\";\n    const inactiveLabel = \"#c5cee4\";\n    const activeLabel = \"#dfe7ff\";\n    const activeValue = \"#8cffd4\";\n    const inactiveValue = \"#9da9cc\";\n\n    slots.forEach((slot, idx) => {\n      const rowY = cursorY + idx * baseSlotHeight;\n      if (idx === slotIndex) {\n        context.fillStyle = activeColor;\n        context.fillRect(slotAreaLeft - 12, rowY - 24, panelWidth - padding * 2 + 24, baseSlotHeight);\n      }\n      const labelColor = idx === slotIndex ? activeLabel : inactiveLabel;\n      const valueColor = idx === slotIndex ? activeValue : inactiveValue;\n      const slotLabel = slot.label ?? slot.slotId;\n      const weaponName = slot.weapon?.name ?? \"Empty\";\n      context.fillStyle = labelColor;\n      context.fillText(slotLabel, slotAreaLeft, rowY);\n      context.fillStyle = valueColor;\n      context.fillText(weaponName, slotAreaRight - context.measureText(weaponName).width, rowY);\n    });\n\n    cursorY += slots.length * baseSlotHeight + 22;\n    const activeSlot = slots[slotIndex] ?? null;\n\n    context.font = \"14px 'Segoe UI', Arial, sans-serif\";\n    context.fillStyle = \"#dce6ff\";\n    context.fillText(\"Available weapons\", leftX, cursorY);\n    cursorY += 24;\n\n    const optionsBottom = drawLoadoutOptions(activeSlot, optionIndex, leftX, cursorY);\n    cursorY = Math.max(cursorY + 24, optionsBottom + 6);\n\n    if (activeSlot?.weapon) {\n      const weapon = activeSlot.weapon;\n      context.font = \"13px 'Segoe UI', Arial, sans-serif\";\n      context.fillStyle = \"#8cffd4\";\n      context.fillText(`Selected: ${weapon.name}`, leftX, cursorY);\n      cursorY += 20;\n      context.fillStyle = \"#9aa9c7\";\n      context.font = \"12px 'Segoe UI', Arial, sans-serif\";\n      context.fillText(`Category: ${weapon.category ?? \"unknown\"}`, leftX, cursorY);\n      cursorY += 18;\n      if (weapon.description) {\n        const maxWidth = panelWidth - padding * 2;\n        cursorY += drawWrappedText(weapon.description, leftX, cursorY, maxWidth, 16) * 16;\n      }\n    }\n\n    const footerY = panelY + panelHeight - padding;\n    context.font = \"12px 'Segoe UI', Arial, sans-serif\";\n    context.fillStyle = \"#7f8aad\";\n    context.fillText(\"Changes apply instantly and persist locally.\", leftX, footerY);\n  }\n\n  if (showMessage && !visible) {\n    const fade = Math.max(0, Math.min(1, messageTimer / 0.4));\n    drawLoadoutMessage(message, fade);\n  }\n\n  context.restore();\n}\n\nexport { drawLoadoutOverlay };\r\n","import { context } from \"../../environment/canvas.js\";\nimport { getCosmeticEditorState } from \"../cosmetics/index.js\";\n\nfunction drawWrappedText(text, x, y, maxWidth, lineHeight) {\n  const words = String(text ?? \"\").split(/\\s+/).filter(Boolean);\n  if (words.length === 0) {\n    return 0;\n  }\n  let line = \"\";\n  let cursorY = y;\n  let lines = 0;\n  for (const word of words) {\n    const candidate = line.length > 0 ? `${line} ${word}` : word;\n    if (context.measureText(candidate).width > maxWidth && line) {\n      context.fillText(line, x, cursorY);\n      line = word;\n      cursorY += lineHeight;\n      lines += 1;\n    } else {\n      line = candidate;\n    }\n  }\n  if (line) {\n    context.fillText(line, x, cursorY);\n    lines += 1;\n  }\n  return lines;\n}\n\nfunction drawCosmeticToast(message, alpha = 1) {\n  const text = String(message ?? \"\").trim();\n  if (!text) {\n    return;\n  }\n  context.save();\n  context.globalAlpha = Math.max(0, Math.min(1, alpha));\n  context.font = \"14px 'Segoe UI', Arial, sans-serif\";\n  const padding = 12;\n  const textWidth = context.measureText(text).width;\n  const boxWidth = Math.min(context.canvas.width - 48, textWidth + padding * 2);\n  const boxHeight = 32;\n  const x = 24;\n  const y = context.canvas.height - boxHeight - 32;\n  context.fillStyle = \"rgba(12, 18, 32, 0.9)\";\n  context.fillRect(x, y, boxWidth, boxHeight);\n  context.strokeStyle = \"rgba(140, 168, 255, 0.55)\";\n  context.lineWidth = 1;\n  context.strokeRect(x + 0.5, y + 0.5, boxWidth - 1, boxHeight - 1);\n  context.fillStyle = \"#dce6ff\";\n  context.fillText(text, x + padding, y + 20);\n  context.restore();\n}\n\nfunction drawCosmeticOverlay() {\n  const state = getCosmeticEditorState();\n  const {\n    visible,\n    categories = [],\n    categoryIndex = 0,\n    optionIndex = 0,\n    options = [],\n    activeCategory = null,\n    selections = {},\n    message = null,\n    messageTimer = 0\n  } = state;\n  const showMessage = Boolean(message) && messageTimer > 0.03;\n\n  if (!visible && !showMessage) {\n    return;\n  }\n\n  const width = context.canvas.width;\n  const height = context.canvas.height;\n\n  if (visible) {\n    context.save();\n    context.fillStyle = \"rgba(6, 10, 18, 0.65)\";\n    context.fillRect(0, 0, width, height);\n\n    const panelWidth = Math.min(width - 140, 620);\n    const panelHeight = Math.min(height - 120, 420);\n    const panelX = (width - panelWidth) * 0.5;\n    const panelY = (height - panelHeight) * 0.5;\n\n    context.fillStyle = \"rgba(14, 20, 32, 0.94)\";\n    context.fillRect(panelX, panelY, panelWidth, panelHeight);\n    context.strokeStyle = \"rgba(140, 168, 255, 0.85)\";\n    context.lineWidth = 2;\n    context.strokeRect(panelX + 0.5, panelY + 0.5, panelWidth - 1, panelHeight - 1);\n\n    const padding = 26;\n    let cursorY = panelY + padding + 4;\n    const leftX = panelX + padding;\n\n    context.fillStyle = \"#f2f5ff\";\n    context.font = \"20px 'Segoe UI', Arial, sans-serif\";\n    context.fillText(\"Cosmetic Customization\", leftX, cursorY);\n    cursorY += 28;\n\n    context.fillStyle = \"#9aa9c7\";\n    context.font = \"13px 'Segoe UI', Arial, sans-serif\";\n    context.fillText(\"F7 close   ?/? categories   ?/? cycle variants   R reset\", leftX, cursorY);\n    cursorY += 26;\n\n    const categoryColumnWidth = 200;\n    const categoryRowHeight = 32;\n    const optionColumnX = leftX + categoryColumnWidth + 28;\n    const optionMaxWidth = panelX + panelWidth - padding - optionColumnX;\n\n    context.font = \"15px 'Segoe UI', Arial, sans-serif\";\n    categories.forEach((category, index) => {\n      const rowY = cursorY + index * categoryRowHeight;\n      const isActive = index === categoryIndex;\n      if (isActive) {\n        context.fillStyle = \"rgba(92, 128, 220, 0.22)\";\n        context.fillRect(leftX - 10, rowY - 22, categoryColumnWidth + 20, categoryRowHeight);\n      }\n      context.fillStyle = isActive ? \"#dfe7ff\" : \"#c5cee4\";\n      context.fillText(category.label, leftX, rowY);\n      const selectedId = selections?.[category.id];\n      const selectedOption = category.options?.find((option) => option.id === selectedId) ?? null;\n      if (selectedOption) {\n        context.fillStyle = isActive ? \"#8cffd4\" : \"#9aa9c7\";\n        context.font = \"12px 'Segoe UI', Arial, sans-serif\";\n        context.fillText(selectedOption.name, leftX, rowY + 14);\n        context.font = \"15px 'Segoe UI', Arial, sans-serif\";\n      }\n    });\n\n    let optionsY = cursorY;\n    context.font = \"15px 'Segoe UI', Arial, sans-serif\";\n    context.fillStyle = \"#dce6ff\";\n    context.fillText(activeCategory?.label ?? \"Variants\", optionColumnX, optionsY);\n    optionsY += 24;\n\n    if (options.length === 0) {\n      context.fillStyle = \"#8a96b9\";\n      context.font = \"13px 'Segoe UI', Arial, sans-serif\";\n      context.fillText(\"No cosmetics available for this category.\", optionColumnX, optionsY);\n      optionsY += 22;\n    } else {\n      options.forEach((option, idx) => {\n        const isHighlighted = idx === optionIndex;\n        const isSelected = option.selected;\n        context.font = \"14px 'Segoe UI', Arial, sans-serif\";\n        context.fillStyle = isHighlighted ? \"#ffcf7a\" : (isSelected ? \"#8cffd4\" : \"#aab5d5\");\n        const prefix = isSelected ? \"� \" : \"\";\n        context.fillText(`${prefix}${option.name}`, optionColumnX, optionsY);\n        optionsY += 22;\n      });\n    }\n\n    const descriptionY = optionsY + 10;\n    const selectedOption = options[optionIndex] ?? null;\n    if (selectedOption?.description) {\n      context.fillStyle = \"#9aa9c7\";\n      context.font = \"12px 'Segoe UI', Arial, sans-serif\";\n      const lines = drawWrappedText(selectedOption.description, optionColumnX, descriptionY, optionMaxWidth, 16);\n      optionsY = descriptionY + lines * 16 + 10;\n    }\n\n    const footerY = panelY + panelHeight - padding + 4;\n    context.fillStyle = \"#7f8aad\";\n    context.font = \"12px 'Segoe UI', Arial, sans-serif\";\n    context.fillText(\"Selections save locally and apply instantly.\", leftX, footerY);\n\n    context.restore();\n  }\n\n  if (showMessage && !visible) {\n    drawCosmeticToast(message, Math.min(1, messageTimer / 0.4));\n  }\n}\n\nexport { drawCosmeticOverlay };\r\n"],"names":["module","exports","styleElement","nonce","setAttribute","stylesInDOM","getIndexByIdentifier","identifier","result","i","length","modulesToDom","list","options","idCountMap","identifiers","item","id","base","count","concat","indexByIdentifier","obj","css","media","sourceMap","supports","layer","references","updater","addElementStyle","byIndex","splice","push","api","domAPI","update","newObj","remove","lastIdentifiers","newList","index","newLastIdentifiers","_i","_index","styleSheet","cssText","firstChild","removeChild","appendChild","document","createTextNode","cssWithMappingToString","toString","this","map","content","needLayer","join","modules","dedupe","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","___CSS_LOADER_EXPORT___","element","createElement","setAttributes","attributes","insert","memo","style","target","styleTarget","querySelector","window","HTMLIFrameElement","contentDocument","head","e","getTarget","Error","insertStyleElement","styleTagTransform","apply","parentNode","removeStyleElement","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","prop","prototype","hasOwnProperty","call","nc","locals","canvas","getElementById","getContext","GROUND_Y","height","levelWidth","width","baseGround","scaleX","value","scalePlatforms","platform","x","scaleWaterZones","zone","scaleDecor","decor","scaled","baseX","Array","isArray","points","point","scaleDestructibles","scaleInteractables","minX","maxX","scaleAmbientLights","light","radius","addCentralWater","zones","overrides","widthRatio","topOffset","depth","top","highlight","highlightColor","topColor","midColor","bottomColor","rippleColor","neoPlatforms","y","type","neoWaterZones","neoDecor","text","neoDestructibles","baseY","facing","neoInteractables","neoAmbientLights","intensity","color","smoothing","flicker","verdantPlatforms","verdantWater","verdantDecor","verdantDestructibles","templateOverrides","bodyColor","accentColor","stripeColor","damageHighlight","debrisColor","verdantInteractables","edgeColor","braceColor","glowColor","verdantAmbientLights","dunePlatforms","duneWater","duneDecor","duneDestructibles","glassColor","duneInteractables","duneAmbientLights","orbitalPlatforms","orbitalDecor","orbitalDestructibles","orbitalInteractables","orbitalAmbientLights","direction","fov","Math","PI","stretch","ENVIRONMENT_DEFINITIONS","neoDistrict","name","theme","background","gradientStops","offset","horizonBand","start","groundColor","silhouettes","platforms","waterZones","destructibles","interactables","ambientLights","spawn","player","trainingDummy","squadOffsets","enemies","verdantWilds","sunsetDunes","orbitalSpire","ENVIRONMENT_SEQUENCE","resourceState","materials","pickups","nextPickupId","getMaterialCount","setMaterialCount","amount","max","floor","addMaterials","source","Number","isFinite","round","spawnSalvagePickup","vx","random","vy","ttl","pickup","maxTtl","collected","currentEnvironmentId","keys","listeners","Set","controlsInitialized","getEnvironmentDefinition","fallbackId","environment","getEnvironmentPlatforms","getEnvironmentSpawnSettings","notifyListeners","listener","error","console","dispatchEvent","CustomEvent","detail","setEnvironment","environmentId","onEnvironmentChange","add","immediate","delete","cameraState","targetX","getHalfViewWidth","clampCameraX","half","envWidth","min","resetCamera","getCamera","clampedX","left","halfWidth","right","offsetX","input","seal","jump","down","roll","attackBuffered","throwBuffered","reloadBuffered","interactBuffered","attackDown","throwDown","squadCommandCycleBuffered","squadCommandSelect","serverBrowserToggleBuffered","serverBrowserNavigate","serverBrowserJoinBuffered","serverBrowserHostBuffered","serverBrowserStopHostBuffered","serverBrowserCopyOfferBuffered","serverBrowserPasteOfferBuffered","serverBrowserAcceptAnswerBuffered","serverBrowserCopyCandidatesBuffered","serverBrowserPasteCandidatesBuffered","buildToggleBuffered","buildCycleBuffered","buildConfirmBuffered","buildCancelBuffered","survivalToggleBuffered","sandboxToggleBuffered","coopToggleBuffered","campaignStartBuffered","pointer","screenX","screenY","worldX","worldY","active","lastUpdate","refreshPointerWorld","camera","offsetY","updatePointerPosition","event","rect","getBoundingClientRect","localX","clientX","localY","clientY","scaleY","performance","now","Date","initialized","handleKey","isDown","code","preventDefault","resetInputs","combatFists","description","category","attackChain","windup","recovery","comboStart","comboWindow","range","heightOffset","damage","knockback","launch","shockBaton","strikerPistol","fireInterval","auto","spread","perShot","projectile","speed","lifetime","gravityFactor","ammo","magazine","reserve","reloadSeconds","recoil","horizontal","vertical","decay","vectorSmg","fragGrenade","throwable","fuseSeconds","explosionRadius","arcVelocity","bounciness","cooldownSeconds","explosionDuration","selfDamageScale","selfKnockbackScale","effectType","flashBang","stunDuration","playerStunDuration","smokeCanister","smokeDuration","smokeRadius","smokeExpansion","smokeSlowMultiplier","smokeTickDuration","turretDrone","gadget","duration","maxActive","spawnOffset","baseColor","headColor","grappleRig","maxLength","maxRise","travelSpeed","pullSpeed","thunderCannon","shieldBubble","strength","DEFAULT_LOADOUT","SPEED","GRAVITY","standing","headRadius","bodyLength","legLength","armLength","strideMultiplier","armSwingAmplitude","legSwingAmplitude","crouching","rolling","SQUAD_COMMANDS","label","order","createAimState","baseAngle","cos","sin","angle","targetAngle","vectorX","vectorY","magnitude","anchorX","anchorY","targetY","lastUpdated","getTotalHeight","pose","createGruntEnemy","spawnX","spawnSettings","predefined","resolvedX","spawnY","enemyY","contextTag","context","autoRespawn","spawnSide","initialFacing","slice","onGround","state","stateTimer","patrolRange","aggressionRange","attackRange","moveSpeed","health","maxHealth","attackCooldown","attackWindup","attackActive","attackDamage","attackKnockback","attackLaunch","baseStats","flashTimer","shakeTimer","shakeMagnitude","invulnerability","respawnTimer","stunTimer","smokeSlowTimer","smokeSlowStrength","spawnContext","aim","createSquadmate","fireCooldown","commandTimer","targetEnemyId","structureShieldTimer","structureShieldStrength","roleIndex","standingHeight","playerSpawnX","stickman","controlMode","vehicleId","vehicleCandidateId","squadCommandIndex","squadCommandId","squadCommandCooldown","rollTimer","currentPose","attacking","attackIndex","currentAttack","attackElapsed","attackInstanceId","comboWindowOpen","comboWindowTimer","nextAttackQueued","hitboxSpawned","activeHitboxes","deadTimer","throwCooldown","gadgetCooldown","reloading","flashBlindTimer","equippedWeaponId","squadmates","Map","upsertRemotePlayer","existing","set","commandId","getRemotePlayers","from","values","enemySpawnXs","ensureSandboxEnemies","playerX","enemyXs","requiredSandbox","sandboxEnemies","filter","enemy","existingSides","indexOf","side","has","fallback","newEnemy","removeSandboxEnemies","restoreSandboxEnemies","forEach","initializeSandboxEnemy","poseHeight","playerY","offsets","ally","allyX","allyY","applyEnvironmentSpawn","weaponState","inventory","activeIndex","getCurrentWeaponId","setActiveWeaponByIndex","isValidIndex","getWeaponInventory","setWeaponInventory","newInventory","equipId","provided","unique","desiredId","includes","ensureEquippedWeaponValid","existingIndex","ammoState","ensureAmmoEntry","weaponId","def","ammoDef","spreadDef","hasAmmo","capacity","POSITIVE_INFINITY","entry","current","reloadTimer","getAmmoStatus","startReload","refillWeaponAmmo","setWeaponInfiniteAmmo","resetAllWeaponAmmo","clear","previousWeaponState","getCurrentWeapon","equipWeaponIndex","previousId","cancelReload","ammoStatus","LOADOUT_SLOTS","allowedCategories","defaultWeaponId","LOADOUT_STORAGE_KEY","getAllowedWeaponsForSlot","slot","categories","weapon","sort","b","localeCompare","resolveDefaultWeapon","allowed","preferred","candidate","createAssignments","slotId","assignments","getAssignmentIndex","findIndex","ensureAssignmentsUnique","seen","find","applyLoadout","preserveEquipped","weaponList","saveLoadout","localStorage","payload","setItem","warn","getResolvedLoadoutSlots","assignment","allowedWeaponIds","uiState","visible","slotIndex","optionIndex","message","messageTimer","syncOptionIndex","slots","resolvedSlots","total","clampSlotIndex","activeSlot","currentIndex","setMessage","moveSlot","delta","cycleOption","changed","conflictIndex","setSlotWeapon","cycleSlotWeapon","updatedSlot","weaponName","handleReset","firstWeapon","handlePointerEvent","stopPropagation","shellColor","visorColor","visorAlpha","trimColor","strapColor","plateColor","pouchColor","exhaustColor","exhaustAlpha","panelColor","COSMETIC_ITEMS","reduce","option","DEFAULT_COSMETICS","helmet","armor","jetpack","COSMETIC_STORAGE_KEY","cosmeticState","selections","getOptionsForCategory","categoryId","normalizeSelection","optionId","ensureSelectionsValid","next","getCosmeticSelections","getCosmeticOption","categoryIndex","getCategories","resolvedCategories","clampCategoryIndex","activeCategory","selectedId","moveCategory","normalized","cycleCosmeticSelection","SCENARIO_STORAGE_KEY","DEFAULT_SCENARIOS","startingMaterials","enemyCount","playerSpawnRatio","dummySpawnRatio","enemySpawnRatios","cloneScenario","scenario","parse","scenarioData","scenarios","validateEnvironmentId","normalizeRatio","saveScenarios","getScenarioSlots","ensureScenarioIndex","setScenarioField","field","trim","adjustScenarioNumber","step","raw","getItem","parsed","normalizeScenario","loadScenarios","FIELDS","editable","fieldIndex","runtimeState","pendingApplication","appliedScenarioId","spawnOverride","getEnvironmentLabel","cycleField","clampFieldIndex","adjustField","nextIndex","cycleSlot","sequence","cycleScenarioEnvironment","toFixed","SOUND_DEFINITIONS","shot","generator","ctx","sampleRate","buffer","createBuffer","getChannelData","t","envelope","exp","body","click","noise","playbackRate","gain","pan","muzzle","spark","fizz","reloadStart","tone","partial","reloadFinish","overtone","thump","grenadeThrow","swish","explosion","boom","roar","flash","shimmer","smokePulse","wave","shieldHit","shieldShatter","crystal","sparkle","shards","shieldEnd","debris","clink","environmentChime","harmonic","EVENT_SOUND_MAP","sound","cooldown","audioContext","masterGain","sfxGain","musicGain","soundtrackStarted","intensityTimer","targetMusicLevel","currentMusicLevel","soundBuffers","lastEventTimes","soundtrackSources","handleEventSound","eventName","config","cooldownMs","shouldPlay","resumeContext","soundId","createBufferSource","rateRange","randomBetween","gainNode","createGain","baseGain","clampVolume","destination","panRange","createStereoPanner","panner","connect","playSound","startSoundtrack","bumpMusicIntensity","activeSources","createLoopingSource","channel","baseFreq","wobble","airy","createPadBuffer","phase","hit","createPulseBuffer","note","sub","createBassBuffer","Boolean","loop","startTime","currentTime","resume","catch","getP2P","P2P","peerId","peerConnection","outboundChannel","inboundChannel","lastSendTime","connectionStatus","localDescriptionString","localCandidates","ensurePeerConnection","RTCPeerConnection","iceServers","createDataChannel","ordered","setupDataChannel","addEventListener","connectionState","getP2PStatus","status","localDescription","serverBrowserState","servers","selectedIndex","lastFetch","fetching","statusMessage","hosting","hostingSessionId","hostingLastHeartbeat","hostingExpiresAt","joinStatus","joinError","hostingMetrics","playerCount","alliesCount","p2p","offer","answer","pendingOffer","pendingAnswer","pendingCandidates","remoteCandidates","getServerBrowserState","setVisible","setServers","previousSelection","matchedIndex","server","setError","setStatusMessage","setJoinStatus","setJoinError","setJoinedSessionId","joinedSessionId","recordFetchTimestamp","timestamp","setFetching","setHostingSession","expiresAt","clearHosting","clearP2PState","setHostingMetrics","metrics","setP2PAnswer","setP2PLocalCandidates","candidates","every","setP2PRemoteCandidates","setP2PError","setP2PPending","VEHICLE_DEFINITIONS","buggy","movementType","wheelRadius","wheelBase","driverSeat","exitOffsets","enterRadius","acceleration","braking","maxSpeed","idleDrag","airDrag","baseHealth","colorBody","colorAccent","colorDetail","raptorHeli","mountedWeapons","binding","muzzles","scatter","flashDuration","flashRadius","barrelLength","barrelWidth","barrelColor","horizontalAcceleration","horizontalMaxSpeed","horizontalDrag","liftPower","descendPower","gravityScale","maxVerticalSpeed","verticalDamping","hoverMinAltitude","hoverMaxAltitude","spawnHover","autopilotStrength","rotorSpan","rotorThickness","tailLength","arrowJet","wingSpan","tideSkiff","waterSurfaceOffset","waterAcceleration","waterMaxSpeed","waterReverseSpeed","waterIdleDrag","turnDrag","bobAmplitude","bobSpeed","buoyancyPoint","splashIntensity","stormBarge","abyssSub","submergedOffset","scoutDrone","vehicleCounter","createVehicle","centerX","waterLineY","preferredAltitude","hover","minAltitude","altitude","surfaceOffset","vehicle","tilt","driverId","enterCooldown","damageFlash","bobPhase","mounts","mountDef","muzzleIndex","lastMuzzleX","lastMuzzleY","vehicles","elapsed","getElapsedTime","persistentSurvivalStats","bestWave","bestKills","bestReward","survivalState","stage","timer","enemiesAlive","lastReward","kills","runReward","lastOutcome","resetSurvivalState","preserveStats","preserve","syncPersistentStats","setSurvivalStage","setSurvivalTimer","setSurvivalEnemiesAlive","setSurvivalLastReward","reward","addSurvivalImmediateReward","setSurvivalLastOutcome","outcome","getSurvivalState","RAGDOLL_BLUEPRINTS","ragdolls","spawnRagdoll","kind","originX","originY","baseVx","baseVy","blueprint","part","life","maxLife","damagePopups","spawnDamagePopup","particles","rings","listenersAttached","BLOOD_COLORS","BLOOD_MIST_COLORS","SPARK_COLORS","DUST_COLOR_MAP","sand","stone","steel","default","pickRandom","spawnRingBurst","ring","startRadius","endRadius","lineWidth","spawnBloodSpray","maxDamage","speedBase","gravity","mistCount","dir","spawnImpactSparks","palette","spawnImpactDust","resolvePalette","paletteName","spawnGroundDust","spawnShieldRing","center","spawnShieldHitParticles","ensureListeners","spawnMuzzleParticles","spawnShieldShatter","spawnExplosionParticles","spawnFlashBurst","spawnSmokePuffs","spawnSmokeDissipateRing","paletteMap","concrete","volatile","generic","material","baseSpeed","spawnDestructibleHitParticles","maxRadius","turrets","acquireTarget","turret","targets","ref","getTargets","closest","closestDistSq","Infinity","dx","dy","distSq","fireTurret","sign","distance","hypot","spawnProjectile","fireTimer","grappleState","tetherLength","retracting","endGrapple","shieldState","maxStrength","maxDuration","getShieldCenter","dispatchShieldEvent","deactivateShield","reason","remainingStrength","deployGadget","gadgetConfig","baseHeight","spawnYBase","createTurret","shift","deployTurret","clampRect","clamp","apex","launchLength","startGrapple","activateShield","spawnEnemies","override","spawnPoints","resolveSpawnPoints","spawned","sideIndex","hasAlive","some","SURVIVAL_CONTEXT","clearSurvivalEnemies","endSurvivalRun","applySurvivalScaling","baseDamage","baseMove","waveIndex","healthMultiplier","damageMultiplier","speedMultiplier","survivalWave","spawnSurvivalEnemies","requested","previousIds","updateSurvival","percent","targetHealth","healStickmanForSurvival","alive","incrementSurvivalWave","desired","cap","grantWaveRewards","missing","resetSurvival","CAMPAIGN_SETTINGS","briefingDuration","successHoldDuration","failureHoldDuration","betweenMissionsDelay","startKeyLabel","CAMPAIGN_MISSIONS","briefing","objective","batchSize","replenishDelay","rewards","successMessage","failureMessage","campaignState","missionIndex","missionId","completedMissions","totalMissions","stageTimer","progress","remaining","getCampaignState","getCampaignMissionDefinition","getCampaignMissions","setCampaignActive","setCampaignStage","setCampaignMessage","setCampaignProgress","setCampaignSpawnCooldown","setCampaignLastOutcome","getCampaignSettings","CAMPAIGN_CONTEXT","clearCampaignEnemies","spawnCampaignEnemies","remainingQuota","remainingKills","delay","beginMissionActive","messageFallback","startMission","mission","configureCampaignMission","completeCampaign","settings","continueToNextMission","success","handleMissionSuccess","applyMissionRewards","nextValue","setCompletedMissions","holdTime","handleCampaignInput","startIndex","missions","startCampaign","retryCurrentMission","SANDBOX_CONTEXT","sandboxState","arsenalGranted","inRest","restTimer","lastWaveDuration","runTime","waveStartTime","previousInventory","previousEquippedId","previousMaterials","clearSkirmishEnemies","ensureMaterialFloor","force","grantFullArsenal","allWeapons","preferredId","applySkirmishScaling","deactivateSandboxSkirmish","currentInventory","restorePreviousLoadout","applyDamageToDummy","popupY","burstY","applyDamageToEnemy","impactX","impactY","incrementCampaignProgress","recordCampaignEnemyDefeated","recordSandboxKill","killReward","incrementSurvivalKills","applyDamageToPlayer","baseKnockback","baseLaunch","adjustedHit","absorb","residualDamage","absorbShieldHit","finalDamage","finalKnockback","finalLaunch","finalFacing","shieldReduction","DESTRUCTIBLE_TEMPLATES","concreteBarrier","rubbleHeight","shakeFactor","salvage","streetCar","deathBlast","minDamageRatio","fuelBarrelCluster","timberWall","sandbagLine","roverWreck","plasmaCell","createInitialState","getEnvironmentDestructibleSpawns","baseTemplate","template","destructible","destroyed","smokeTimer","rubbleLevel","deathTriggered","spawnConfig","assign","createDestructibleFromSpawn","computeExplosionFalloff","minRatio","falloff","applyExplosionImpulse","maxKnockback","includeTrainingDummy","includeEnemies","includePlayer","summary","dummyHit","enemiesHit","playerHit","damageCap","knockbackCap","radiusSafe","dummyX","dummyY","ratio","enemyX","playerHeight","playerCenterY","getBounds","bottom","circleIntersectsDestructible","distanceToDestructible","damageDestructible","applied","appliedDamage","baseShake","cause","spawnDamageEffects","centerY","blast","damageDestructiblesInRadius","sourceId","salvageAmount","chunks","amountPer","triggerDestructibleDeath","damageMax","hits","handleProjectileCollision","handleHitboxCollision","hitbox","hitTargets","fresh","resetDestructibles","BUILDING_DEFINITIONS","barricade","cost","strokeColor","blocking","watchtower","shieldEmitter","shield","damageReduction","buffDuration","ambient","shockTrap","trap","stun","structures","buildState","blueprintIndex","lastPreview","valid","getBuildingDefinitions","defs","resetStructures","persistentLights","transientLights","environmentAmbientLights","getEnvironmentAmbientLights","clampIntensity","rgba","alpha","r","g","trimmed","startsWith","hex","split","char","numeric","parseInt","isNaN","match","parseColor","setPersistentLight","props","targetIntensity","spawnDynamicLight","isLightVisible","drawPointLight","gradient","createRadialGradient","addColorStop","fillStyle","beginPath","arc","fill","drawConeLight","save","translate","rotate","scale","halfFov","moveTo","closePath","restore","projectiles","lightCooldown","circleOverlap","ax","ay","ar","bx","by","br","radii","throwables","smokeClouds","dispatchThrowableEvent","detonate","grenade","detonated","explosionTimer","fuse","baseDetail","applyFlashEffect","cloud","baseRadius","slowMultiplier","tick","tickTimer","spawnSmokeCloud","cloudId","damageFalloff","destructibleFalloff","offsetRadius","spawnExplosionDebris","applyExplosiveDamage","activeCamera","performanceStats","enemiesTotal","enemiesCulled","squadTotal","squadCulled","remoteTotal","remoteCulled","vehicleTotal","vehicleCulled","destructibleTotal","destructibleCulled","interactableTotal","interactableCulled","buildingTotal","buildingCulled","resourceTotal","resourceCulled","margin","prefix","culled","totalKey","culledKey","SUPPLY_DROP_TYPES","weight","crateColor","materialsReward","medkit","heavy","supplyDrops","manager","nextDropTimer","nextDropTypeId","chooseWeightedType","incomingMessage","incomingTimer","incomingDuration","rewardMessage","rewardTimer","rewardDuration","dropSequence","entries","totalWeight","sum","applySupplyDropReward","typeId","heavyType","autoEquip","addWeaponToInventory","applyHeavyWeaponReward","applyAmmoReward","rewardType","immediateGain","updateHighlight","drop","POSES","playerFeetY","pickupDrop","despawnTimer","rewardMaterials","salvagePortion","jitter","updateSupplyDrops","getEnvironmentWidth","clampedWidth","parachutePhase","spawnSupplyDrop","drawCrate","baseAlpha","globalAlpha","parachuteWidth","canopyHeight","quadraticCurveTo","strokeStyle","lineTo","stroke","highlightAlpha","fillRect","strokeRect","POINTER_INACTIVE_TIMEOUT","normalizeAngle","updateAimRecord","record","fallbackSmoothing","ensureAimRecord","nextAngle","diff","shortestAngleDiff","rate","dampAngle","getFallbackAngle","abs","getShoulderAnchor","entity","resolvedPose","shoulderYOffset","shoulderY","findEnemyById","updateAimSystem","anchor","pointerWorld","getPointerWorld","pointerVectorX","pointerVectorY","pointerDistance","pointerHasSignal","pointerWithinReach","pointerIsLive","pointerIsActive","pointerEffective","atan2","previousAngle","reach","fallbackAngle","updatePlayerAim","updateSquadAims","targetAnchor","updateEnemyAims","mountDefs","mountState","mountOffset","followFacing","followVehicleFacing","facingMultiplier","updateVehicleMountAims","computeArmSegments","aimAngle","bendDirection","elbowOffset","effectiveLength","elbowDistance","elbow","hand","computeLegSegments","hip","lift","footX","footY","kneeLift","kneeYBase","kneeY","knee","foot","drawLimb","limb","lineCap","drawArm","shoulder","arm","drawHand","getWeaponVisual","isMid","thickness","detailColor","handleOffset","drawRoundedRectPath","renderStickFigure","params","aimRecord","weaponVisual","providedWeaponVisual","cosmetics","primaryColor","supportColor","labelColor","showHealthBar","healthRatio","healthColor","flashColor","flashAmount","attackInfo","fallbackFacing","resolveAim","velocityX","speedRatio","torsoLean","crouchOffset","headCenterX","headCenterY","neckY","stridePhase","baseSpacing","liftHeight","leftPhase","rightPhase","leanOffset","rightOffset","leftLeg","rightLeg","dirX","dirY","forwardSign","frontAngle","frontStretch","frontElbowOffset","supportAngle","supportStretch","supportElbowOffset","frontArm","supportArm","backLeg","frontLeg","backArm","frontArmToDraw","supportArmToDraw","baseLineWidth","cosmeticsData","helmetStyle","armorStyle","jetpackStyle","entityX","packHeightDual","packWidth","flameWidth","flameHeight","packHeight","drawJetpackCosmetic","topY","bottomY","chestWidth","chestHeight","chestX","strapWidth","strapHeight","pouchWidth","pouchHeight","drawArmorCosmetic","supportHand","drawWeaponSprite","shellRadius","visorWidth","visorHeight","drawHelmetCosmetic","barX","barY","font","textAlign","fillText","drawDestructible","shakeMag","wobblePhase","shakeX","shakeY","drawRubble","damageRatio","windowColor","bodyTop","cabinHeight","windowHeight","drawStreetCar","barrelRadius","barrelHeight","positions","visibleCount","pos","ellipse","drawBarrelCluster","crackColor","crackCount","startX","crackHeight","drawBarrierBody","yOffset","clamped","barWidth","drawHealthTick","lifeRatio","drawSmokeColumn","rawX","groundY","bestY","getGroundYAt","blueprintId","placeStructure","preview","canAfford","spendMaterials","structure","trapCooldown","createStructureFromBlueprint","addStructure","toggleBuildMode","forceState","damageStructure","destroyStructure","updateTurret","bestEnemy","bestDist","muzzleY","applyShieldField","emitY","actors","actor","updateTrap","triggered","updateStructureCollisions","horizontalOverlap","verticalOverlap","updateBuildingSystem","clampBlueprintIndex","cycleBlueprint","handleBuildInputs","updateStructures","coopState","connected","bestConnected","maxParticipants","packetsPerSecond","averageLatency","hostId","getCoopHudStatus","participants","bestParticipants","INTERACTABLE_TEMPLATES","pushCrate","mass","friction","pushImpulse","hitImpulse","kickBarrel","getEnvironmentInteractableSpawns","interactable","initialState","createInteractableFromSpawn","drawInteractable","sway","braceInset","drawBarrel","glow","accent","pulse","drawTrap","templateHighlight","resetInteractables","muzzleFlashes","shieldBursts","throwableBursts","notices","shotIndicators","filters","weapons","FILTER_TOGGLE_MAP","Digit6","Digit7","Digit8","pushNotice","last","age","pushThrowableBurst","burst","shouldCapture","handleFilterToggle","altKey","repeat","charAt","toUpperCase","toggleFilter","handleMuzzleFlash","handleShotFired","handleReloadStart","handleReloadFinish","handleRecoilKick","handleEnvironmentChanged","env","handleShieldHit","handleShieldShatter","handleShieldEnd","handleThrowableThrown","handleThrowableExplosion","handleThrowableFlashBurst","String","handleThrowableSmokeDetonate","EPSILON","handleThrowableSmokeDissipate","listenersRegistered","updateList","getPolishDebugState","recoilState","horizontalKick","verticalKick","lastShotTime","resolvePlatformLanding","previousY","prevFeet","nextFeet","PLATFORM_STYLES","street","metro","rooftop","skybridge","terrace","balcony","median","jungleFloor","canopy","branch","cliff","plateau","deck","catwalk","maglev","plain","drawPlatform","drawBuilding","floors","f","drawPalm","drawRuin","bricks","setLineDash","drawVineArch","drawGlowPlant","drawWaterfall","createLinearGradient","drawDune","drawRockSpire","drawCampfire","drawAntenna","drawSpire","drawHoloBillboard","drawEnergyCoil","drawHovercar","getActiveCommand","findNearestEnemy","best","dist","steerTowards","speedFactor","fireAtTarget","rawDirX","rawDirY","norm","perpX","perpY","lateralOffset","updateSquadmate","squadmate","command","updateMovement","PLAYER_DRIVER_ID","getPlayerVehicle","applyIdleDrag","dragAmount","drag","syncStickmanWithVehicle","seat","seatWorldX","seatWorldY","exitVehicle","skipCooldown","preferRight","preferDirection","fallbackOffset","chosenOffset","inheritVelocity","updateGroundVehicle","isControlled","accelerateRight","accelerateLeft","brake","applyGroundDriverInput","pow","groundTop","targetTilt","updateWaterVehicle","reverseSpeed","brakeStrength","waterSurface","steerRight","steerLeft","bobOffset","sprayOffset","tiltTarget","updateAirVehicle","maxAltitude","altitudeRate","altitudeError","newAltitude","fireMountedWeaponProjectile","muzzleX","projectileDef","scatterRadians","finalAngle","verticalSpeed","updateMountedWeaponsForVehicle","wantsPrimary","wantsSecondary","shouldFire","autoFire","SQUAD_WEAPON_TEMPLATE","UI_TITLE_FONT","UI_TEXT_FONT","UI_SMALL_FONT","arcTo","drawUiPanel","strokeWidth","accentHeight","drawUiProgressBar","clampedProgress","clip","border","borderWidth","drawUiTag","textBaseline","paddingX","ceil","measureText","getCategoryAccent","formatSeconds","seconds","drawHud","canvasWidth","canvasHeight","currentWeapon","weaponSlots","gadgetStatus","turretCount","grappleActive","shieldActive","shieldStrength","shieldMaxStrength","getGadgetStatus","recoilOffset","buildingHud","resources","blueprintName","getBuildingHudStatus","overlayAlpha","shieldMax","shieldRatio","vitalsHeight","vitalsY","vitalsX","vitalsWidth","vitalsLineY","gadgetSlot","throwCooldownMax","gadgetCooldownMax","statusTags","tagX","tagY","tag","weaponPanelWidth","weaponPanelX","weaponPanelY","replace","weaponLineY","isInfinite","magazineDisplay","reserveDisplay","ready","weaponBadges","badgeX","badgeY","badge","helpLines","helpY","line","cards","campaignHud","missionName","missionDescription","getCampaignHudStatus","lines","missionLabel","title","footer","survivalHud","getSurvivalHudStatus","waveValue","sandboxHud","materialFloor","coopHud","supplyStatus","timeUntilNext","nextDropLabel","incomingAlpha","rewardAlpha","activeCount","p2pStatus","cardsBottom","card","minHeight","titleColor","lineY","footerColor","drawUiCardStack","maxSlots","availableWidth","slotWidth","slotHeight","isActive","drawWeaponHotbar","perfMetrics","performanceEntries","perfPanelTop","perfText","perfWidth","perfHeight","perfX","perfY","debugState","reverse","debugLines","notice","indicator","activeFilters","debugHeight","debugY","maxDebugY","debugLineY","drawProjectilesLayer","drawProjectiles","flashAlpha","puffRadius","puffAlpha","outerRadius","ringAlpha","coreAlpha","fuseRatio","maxFuse","sparkOffsetX","sparkOffsetY","drawSmokeClouds","drawThrowables","particle","sizeFactor","drawParticles","drawPolishDebugEffects","formatPercent","startAttack","attack","getActorProfile","applyPushFromActor","actorProfile","actorFeet","interactHalf","impulseBase","isPlayer","appliedImpulse","targetActorX","updateInteractable","playerFeet","verticalGap","horizGap","highlightTarget","effectiveHalf","detectionRadius","profile","feet","frictionStrength","deltaValue","envWidthLimits","mid","handleInteractableHitboxCollision","impulse","spawnHitbox","ownerFacing","fireEquippedWeaponProjectile","consumeAmmo","projectileConfig","normLength","muzzleDistance","sideOffset","muzzleSideOffset","muzzleVerticalOffset","spreadState","effectiveDegrees","radians","registerShot","initialVx","initialVy","kick","simulatedParticipants","spawnTimer","statsTimer","packetCounter","createSimulatedParticipant","latency","latencyTarget","latencyTimer","updateParticipant","participant","orbitX","latencyDelta","removeSimulatedParticipants","updateMassiveCoop","hud","deactivateCoop","deactivateMassiveCoop","activateCoop","size","batch","ensureSimulatedParticipants","latencySum","latencyCount","setCoopParticipants","setCoopMetrics","updateEnemyAI","distanceX","absDistance","stunned","effectiveAggression","shouldChase","chaseDir","updateEnemyAttacks","attackReach","lastHostCandidatePushAt","lastJoinCandidatePushAt","lastSentHostCandidates","lastSentJoinCandidates","pendingHostCandidateTimeout","pendingJoinCandidateTimeout","pendingJoinCandidatePayload","getApiBase","getSessionId","crypto","randomUUID","sanitizeSignal","async","copyToClipboard","navigator","clipboard","writeText","normalizeCandidateList","normalizeCandidate","arraysEqual","mapServerEntry","metadata","players","maxPlayers","region","mode","updatedAt","signal","hostOffer","hostCandidates","joinAnswer","joinCandidates","cacheUpdatedSession","mapped","resetCandidateTracking","clearTimeout","pushHostCandidatesNow","heartbeatSession","pushJoinerCandidatesNow","sessionId","apiBase","response","fetch","method","headers","ok","json","session","applyRemoteCandidates","postJoinerUpdate","signalCandidates","handleLocalCandidateUpdate","setTimeout","scheduleHostCandidatePush","scheduleJoinerCandidatePush","syncLocalCandidates","getLocalCandidates","previous","copyLocalCandidates","silent","copied","promptForRemoteCandidates","prompt","rawInput","sanitized","segment","parseCandidateInput","getP2POrThrow","addRemoteCandidate","merged","incoming","mergeCandidates","buildHostingMetadata","fallbackPlayerCount","fetchServerList","Accept","mappedServers","staleThresholdMs","filteredServers","updatedAtMs","hostSession","secret","computedPlayerCount","effectiveSignal","ttlSeconds","stopHosting","joinServer","serverId","url","joinedName","ensureHostOffer","forceRegenerate","createOffer","setP2POffer","copyHostOffer","acceptHostOffer","rawOffer","autoCopyAnswer","offerString","normalizedOffer","createAnswer","applyJoinerAnswer","rawAnswer","answerString","normalizedAnswer","acceptRemoteDescription","updated","pumpSignalUpdates","joinedSession","promptForHostOffer","promptForJoinerAnswer","attemptHostSession","Promise","resolve","alreadyHosting","then","attemptStopHosting","alreadyStopped","attemptJoinSession","directSignal","debug","notFound","fetchSessionDetail","refreshed","refreshedSignal","updatedEntry","resolveSignal","resolvedServer","signalAnswer","reject","clampPlayerX","clampToArena","updateGame","advanceTime","updateSalvagePickups","countSkirmishEnemies","variance","randomOffset","existingIds","spawnNextSkirmishWave","updateSandboxSkirmish","decrementCampaignStageTimer","decrementCampaignSpawnCooldown","decrementCampaignRemaining","removeDefeatedCampaignEnemies","handleMissionFailure","updateCampaign","updateLoadoutSystem","updateCosmeticSystem","updateScenarioSystem","loadoutMenuOpen","cosmeticMenuOpen","scenarioMenuOpen","overlayMenuOpen","scenarioRequest","pending","consumeScenarioApplication","request","scenarioId","setScenarioRuntimeApplied","applyScenarioConfiguration","interactRequested","squadCycleRequested","squadSelectRequested","serverBrowserToggleRequested","serverBrowserJoinRequested","serverBrowserHostRequested","serverBrowserStopRequested","serverBrowserCopyOfferRequested","serverBrowserPasteOfferRequested","serverBrowserAcceptAnswerRequested","serverBrowserCopyCandidatesRequested","serverBrowserPasteCandidatesRequested","rawAttackRequested","rawThrowRequested","rawReloadRequested","rollAttempted","bestVehicle","bestScore","vehicleFeet","verticalAllowance","score","enterVehicle","handleVehicleInteraction","cycleSquadCommand","setSquadCommandById","selectedServer","playerVehicle","inVehicle","forcePlayerExitVehicle","startRoll","canAct","attackRequested","throwRequested","reloadRequested","updatePlayerInVehicle","slowFactor","canJump","updatePlayerAlive","updatePlayerDead","timestampNow","updateVehicles","updateDestructibles","updateInteractables","backgroundInterval","refreshInterval","interval","updateServerBrowser","maxAgeMs","pruneRemotePlayers","readyState","send","updateP2P","updateSquadmates","weaponCategory","hasMeleeChain","isRangedWeapon","isThrowableWeapon","forwardOffset","verticalOffset","forwardSpeed","verticalBoost","throwEquippedWeapon","holdFire","attemptAttack","spawnHitboxFn","shouldChain","advanceAttack","updateHitboxes","resolveHitDetection","updateCamera","updateTrainingDummy","effectiveRadius","pdx","pdy","dissipated","updateSmokeClouds","updateThrowables","updateTurrets","updateShield","updateGadgets","progressSpeed","updateGrapple","updateGrappleState","updateGadgetMovement","activeWeaponId","completedReloads","needed","loaded","updateAmmoTimers","decayRate","decayFactor","updateRecoil","popup","updateDamagePopups","p","updateParticles","anchors","updateEnvironmentLights","playerFacing","baseIntensity","updateFlashlights","structureLights","lerp","updateLighting","updatePolishDebug","tracerRadius","updateProjectiles","piece","updateRagdolls","updateEnemies","ServerBrowser","host","stop","attemptHost","attemptStop","attemptJoin","copyOffer","regenerateOffer","promptOffer","promptAnswer","copyCandidates","promptCandidates","syncCandidates","button","NaN","newAssignments","loadLoadout","defaultPrevented","shiftKey","loadCosmetics","fieldId","nextName","nextDescription","editFieldPrompt","resetScenario","queueScenarioApply","AudioCtor","AudioContext","webkitAudioContext","ensureContext","loadSoundBuffers","registerEventListeners","clearInterval","setInterval","cancelScheduledValues","linearRampToValueAtTime","prime","removeEventListener","setupPrimeHandlers","setLocalDescription","remoteDescriptionString","setRemoteDescription","RTCSessionDescription","candidateString","RTCIceCandidate","addIceCandidate","getLocalDescription","getStatus","close","cycleEnvironment","lastTime","requestAnimationFrame","resetPerformanceStats","setActiveCamera","skyGradient","silhouette","horizon","band","sunX","sun","sunY","sunRadius","sunGradient","jitterX","jitterY","mistStart","mistGradient","drawBackground","getEnvironmentWaterZones","waveY","drawWaterBodies","decorItems","getEnvironmentDecor","drawDecor","drawDebugArena","items","drawDestructibles","drawInteractables","candidateId","isPlayerVehicle","isCandidate","bodyWidth","bodyHeight","drawVehicles","drops","typeDef","drawSupplyDrops","remote","drawRemotePlayers","squadStatus","outline","hold","defend","flank","activeShot","drawSquadmates","dummy","shake","armY","drawTrainingDummy","enemyPose","drawEnemies","drawShield","baseWidth","remainingRatio","headHeight","drawTurrets","currentX","currentY","drawGrapple","drawRagdolls","attackDuration","cosmeticSelections","stickmanCosmetics","getStickmanShoulderAnchor","hasTarget","directionX","directionY","drawPlayerAimDebug","drawStickman","drawHitboxes","globalCompositeOperation","drawLighting","opacity","drawDamagePopups","panelHeight","panelWidth","statusY","listTop","listBottom","maxRows","rowsToDraw","rowY","rowHeight","details","snippet","limit","p2pY","candidateSummary","lastLocalLabel","lastRemoteLabel","drawServerBrowser","getLoadoutEditorState","showMessage","baseSlotHeight","headerHeight","detailHeight","footerHeight","panelX","panelY","padding","cursorY","leftX","slotAreaLeft","slotAreaRight","activeColor","inactiveLabel","activeLabel","activeValue","inactiveValue","idx","valueColor","slotLabel","optionsBottom","drawLoadoutOptions","maxWidth","words","word","drawWrappedText","footerY","textWidth","boxWidth","boxHeight","drawLoadoutMessage","drawLoadoutOverlay","resolvedOptions","selected","getCosmeticEditorState","categoryColumnWidth","categoryRowHeight","optionColumnX","optionMaxWidth","selectedOption","optionsY","isHighlighted","isSelected","descriptionY","drawCosmeticToast","drawCosmeticOverlay","fields","environmentName","getScenarioEditorState","valueX","scenarioLabel","totalSlots","valueText","descriptionTop","drawScenarioToast","drawScenarioOverlay"],"sourceRoot":""}